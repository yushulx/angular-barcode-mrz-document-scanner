"use strict";var xqe=Object.defineProperty,wqe=Object.defineProperties,Sqe=Object.getOwnPropertyDescriptors,UP=Object.getOwnPropertySymbols,ope=Object.prototype.hasOwnProperty,spe=Object.prototype.propertyIsEnumerable,rpe=(fi,Ss,na)=>Ss in fi?xqe(fi,Ss,{enumerable:!0,configurable:!0,writable:!0,value:na}):fi[Ss]=na,qe=(fi,Ss)=>{for(var na in Ss||(Ss={}))ope.call(Ss,na)&&rpe(fi,na,Ss[na]);if(UP)for(var na of UP(Ss))spe.call(Ss,na)&&rpe(fi,na,Ss[na]);return fi},Ht=(fi,Ss)=>wqe(fi,Sqe(Ss)),Jl=(fi,Ss)=>{var na={};for(var wl in fi)ope.call(fi,wl)&&Ss.indexOf(wl)<0&&(na[wl]=fi[wl]);if(null!=fi&&UP)for(var wl of UP(fi))Ss.indexOf(wl)<0&&spe.call(fi,wl)&&(na[wl]=fi[wl]);return na};(self.webpackChunkangular_barcode_mrz_document_scanner=self.webpackChunkangular_barcode_mrz_document_scanner||[]).push([[179],{582:()=>{function fi(p){return"function"==typeof p}function Ss(p){const u=p(f=>{Error.call(f),f.stack=(new Error).stack});return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}const na=Ss(p=>function(u){p(this),this.message=u?`${u.length} errors occurred during unsubscription:\n${u.map((f,g)=>`${g+1}) ${f.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=u});function wl(p,l){if(p){const u=p.indexOf(l);0<=u&&p.splice(u,1)}}class vu{constructor(l){this.initialTeardown=l,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let l;if(!this.closed){this.closed=!0;const{_parentage:u}=this;if(u)if(this._parentage=null,Array.isArray(u))for(const m of u)m.remove(this);else u.remove(this);const{initialTeardown:f}=this;if(fi(f))try{f()}catch(m){l=m instanceof na?m.errors:[m]}const{_finalizers:g}=this;if(g){this._finalizers=null;for(const m of g)try{iU(m)}catch(v){l=null!=l?l:[],v instanceof na?l=[...l,...v.errors]:l.push(v)}}if(l)throw new na(l)}}add(l){var u;if(l&&l!==this)if(this.closed)iU(l);else{if(l instanceof vu){if(l.closed||l._hasParent(this))return;l._addParent(this)}(this._finalizers=null!==(u=this._finalizers)&&void 0!==u?u:[]).push(l)}}_hasParent(l){const{_parentage:u}=this;return u===l||Array.isArray(u)&&u.includes(l)}_addParent(l){const{_parentage:u}=this;this._parentage=Array.isArray(u)?(u.push(l),u):u?[u,l]:l}_removeParent(l){const{_parentage:u}=this;u===l?this._parentage=null:Array.isArray(u)&&wl(u,l)}remove(l){const{_finalizers:u}=this;u&&wl(u,l),l instanceof vu&&l._removeParent(this)}}vu.EMPTY=(()=>{const p=new vu;return p.closed=!0,p})();const tU=vu.EMPTY;function nU(p){return p instanceof vu||p&&"closed"in p&&fi(p.remove)&&fi(p.add)&&fi(p.unsubscribe)}function iU(p){fi(p)?p():p.unsubscribe()}const Rm={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},u3={setTimeout(p,l,...u){const{delegate:f}=u3;return(null==f?void 0:f.setTimeout)?f.setTimeout(p,l,...u):setTimeout(p,l,...u)},clearTimeout(p){const{delegate:l}=u3;return((null==l?void 0:l.clearTimeout)||clearTimeout)(p)},delegate:void 0};function rU(p){u3.setTimeout(()=>{const{onUnhandledError:l}=Rm;if(!l)throw p;l(p)})}function oU(){}const upe=VP("C",void 0,void 0);function VP(p,l,u){return{kind:p,value:l,error:u}}let km=null;function d3(p){if(Rm.useDeprecatedSynchronousErrorHandling){const l=!km;if(l&&(km={errorThrown:!1,error:null}),p(),l){const{errorThrown:u,error:f}=km;if(km=null,u)throw f}}else p()}class jP extends vu{constructor(l){super(),this.isStopped=!1,l?(this.destination=l,nU(l)&&l.add(this)):this.destination=vpe}static create(l,u,f){return new h3(l,u,f)}next(l){this.isStopped?GP(function hpe(p){return VP("N",p,void 0)}(l),this):this._next(l)}error(l){this.isStopped?GP(function dpe(p){return VP("E",void 0,p)}(l),this):(this.isStopped=!0,this._error(l))}complete(){this.isStopped?GP(upe,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(l){this.destination.next(l)}_error(l){try{this.destination.error(l)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ppe=Function.prototype.bind;function HP(p,l){return ppe.call(p,l)}class gpe{constructor(l){this.partialObserver=l}next(l){const{partialObserver:u}=this;if(u.next)try{u.next(l)}catch(f){f3(f)}}error(l){const{partialObserver:u}=this;if(u.error)try{u.error(l)}catch(f){f3(f)}else f3(l)}complete(){const{partialObserver:l}=this;if(l.complete)try{l.complete()}catch(u){f3(u)}}}class h3 extends jP{constructor(l,u,f){let g;if(super(),fi(l)||!l)g={next:null!=l?l:void 0,error:null!=u?u:void 0,complete:null!=f?f:void 0};else{let m;this&&Rm.useDeprecatedNextContext?(m=Object.create(l),m.unsubscribe=()=>this.unsubscribe(),g={next:l.next&&HP(l.next,m),error:l.error&&HP(l.error,m),complete:l.complete&&HP(l.complete,m)}):g=l}this.destination=new gpe(g)}}function f3(p){Rm.useDeprecatedSynchronousErrorHandling?function fpe(p){Rm.useDeprecatedSynchronousErrorHandling&&km&&(km.errorThrown=!0,km.error=p)}(p):rU(p)}function GP(p,l){const{onStoppedNotification:u}=Rm;u&&u3.setTimeout(()=>u(p,l))}const vpe={closed:!0,next:oU,error:function mpe(p){throw p},complete:oU},zP="function"==typeof Symbol&&Symbol.observable||"@@observable";function Mm(p){return p}let Fs=(()=>{class p{constructor(u){u&&(this._subscribe=u)}lift(u){const f=new p;return f.source=this,f.operator=u,f}subscribe(u,f,g){const m=function _pe(p){return p&&p instanceof jP||function ype(p){return p&&fi(p.next)&&fi(p.error)&&fi(p.complete)}(p)&&nU(p)}(u)?u:new h3(u,f,g);return d3(()=>{const{operator:v,source:_}=this;m.add(v?v.call(m,_):_?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(u){try{return this._subscribe(u)}catch(f){u.error(f)}}forEach(u,f){return new(f=aU(f))((g,m)=>{const v=new h3({next:_=>{try{u(_)}catch(b){m(b),v.unsubscribe()}},error:m,complete:g});this.subscribe(v)})}_subscribe(u){var f;return null===(f=this.source)||void 0===f?void 0:f.subscribe(u)}[zP](){return this}pipe(...u){return function sU(p){return 0===p.length?Mm:1===p.length?p[0]:function(u){return p.reduce((f,g)=>g(f),u)}}(u)(this)}toPromise(u){return new(u=aU(u))((f,g)=>{let m;this.subscribe(v=>m=v,v=>g(v),()=>f(m))})}}return p.create=l=>new p(l),p})();function aU(p){var l;return null!==(l=null!=p?p:Rm.Promise)&&void 0!==l?l:Promise}const Cpe=Ss(p=>function(){p(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let If=(()=>{class p extends Fs{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(u){const f=new lU(this,this);return f.operator=u,f}_throwIfClosed(){if(this.closed)throw new Cpe}next(u){d3(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const f of this.currentObservers)f.next(u)}})}error(u){d3(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=u;const{observers:f}=this;for(;f.length;)f.shift().error(u)}})}complete(){d3(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:u}=this;for(;u.length;)u.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var u;return(null===(u=this.observers)||void 0===u?void 0:u.length)>0}_trySubscribe(u){return this._throwIfClosed(),super._trySubscribe(u)}_subscribe(u){return this._throwIfClosed(),this._checkFinalizedStatuses(u),this._innerSubscribe(u)}_innerSubscribe(u){const{hasError:f,isStopped:g,observers:m}=this;return f||g?tU:(this.currentObservers=null,m.push(u),new vu(()=>{this.currentObservers=null,wl(m,u)}))}_checkFinalizedStatuses(u){const{hasError:f,thrownError:g,isStopped:m}=this;f?u.error(g):m&&u.complete()}asObservable(){const u=new Fs;return u.source=this,u}}return p.create=(l,u)=>new lU(l,u),p})();class lU extends If{constructor(l,u){super(),this.destination=l,this.source=u}next(l){var u,f;null===(f=null===(u=this.destination)||void 0===u?void 0:u.next)||void 0===f||f.call(u,l)}error(l){var u,f;null===(f=null===(u=this.destination)||void 0===u?void 0:u.error)||void 0===f||f.call(u,l)}complete(){var l,u;null===(u=null===(l=this.destination)||void 0===l?void 0:l.complete)||void 0===u||u.call(l)}_subscribe(l){var u,f;return null!==(f=null===(u=this.source)||void 0===u?void 0:u.subscribe(l))&&void 0!==f?f:tU}}function cU(p){return fi(null==p?void 0:p.lift)}function Ea(p){return l=>{if(cU(l))return l.lift(function(u){try{return p(u,this)}catch(f){this.error(f)}});throw new TypeError("Unable to lift unknown Observable type")}}function ga(p,l,u,f,g){return new bpe(p,l,u,f,g)}class bpe extends jP{constructor(l,u,f,g,m,v){super(l),this.onFinalize=m,this.shouldUnsubscribe=v,this._next=u?function(_){try{u(_)}catch(b){l.error(b)}}:super._next,this._error=g?function(_){try{g(_)}catch(b){l.error(b)}finally{this.unsubscribe()}}:super._error,this._complete=f?function(){try{f()}catch(_){l.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var l;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:u}=this;super.unsubscribe(),!u&&(null===(l=this.onFinalize)||void 0===l||l.call(this))}}}function co(p,l){return Ea((u,f)=>{let g=0;u.subscribe(ga(f,m=>{f.next(p.call(l,m,g++))}))})}function Om(p){return this instanceof Om?(this.v=p,this):new Om(p)}function Spe(p,l,u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g,f=u.apply(p,l||[]),m=[];return g={},v("next"),v("throw"),v("return"),g[Symbol.asyncIterator]=function(){return this},g;function v(O){f[O]&&(g[O]=function(j){return new Promise(function(W,J){m.push([O,j,W,J])>1||_(O,j)})})}function _(O,j){try{!function b(O){O.value instanceof Om?Promise.resolve(O.value.v).then(S,I):k(m[0][2],O)}(f[O](j))}catch(W){k(m[0][3],W)}}function S(O){_("next",O)}function I(O){_("throw",O)}function k(O,j){O(j),m.shift(),m.length&&_(m[0][0],m[0][1])}}function Tpe(p){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,l=p[Symbol.asyncIterator];return l?l.call(p):(p=function hU(p){var l="function"==typeof Symbol&&Symbol.iterator,u=l&&p[l],f=0;if(u)return u.call(p);if(p&&"number"==typeof p.length)return{next:function(){return p&&f>=p.length&&(p=void 0),{value:p&&p[f++],done:!p}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}(p),u={},f("next"),f("throw"),f("return"),u[Symbol.asyncIterator]=function(){return this},u);function f(m){u[m]=p[m]&&function(v){return new Promise(function(_,b){!function g(m,v,_,b){Promise.resolve(b).then(function(S){m({value:S,done:_})},v)}(_,b,(v=p[m](v)).done,v.value)})}}}const fU=p=>p&&"number"==typeof p.length&&"function"!=typeof p;function pU(p){return fi(null==p?void 0:p.then)}function gU(p){return fi(p[zP])}function mU(p){return Symbol.asyncIterator&&fi(null==p?void 0:p[Symbol.asyncIterator])}function vU(p){return new TypeError(`You provided ${null!==p&&"object"==typeof p?"an invalid object":`'${p}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const yU=function Epe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function _U(p){return fi(null==p?void 0:p[yU])}function CU(p){return Spe(this,arguments,function*(){const u=p.getReader();try{for(;;){const{value:f,done:g}=yield Om(u.read());if(g)return yield Om(void 0);yield yield Om(f)}}finally{u.releaseLock()}})}function bU(p){return fi(null==p?void 0:p.getReader)}function fh(p){if(p instanceof Fs)return p;if(null!=p){if(gU(p))return function Dpe(p){return new Fs(l=>{const u=p[zP]();if(fi(u.subscribe))return u.subscribe(l);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(p);if(fU(p))return function Ape(p){return new Fs(l=>{for(let u=0;u<p.length&&!l.closed;u++)l.next(p[u]);l.complete()})}(p);if(pU(p))return function Ppe(p){return new Fs(l=>{p.then(u=>{l.closed||(l.next(u),l.complete())},u=>l.error(u)).then(null,rU)})}(p);if(mU(p))return xU(p);if(_U(p))return function Rpe(p){return new Fs(l=>{for(const u of p)if(l.next(u),l.closed)return;l.complete()})}(p);if(bU(p))return function kpe(p){return xU(CU(p))}(p)}throw vU(p)}function xU(p){return new Fs(l=>{(function Mpe(p,l){var u,f,g,m;return function xpe(p,l,u,f){return new(u||(u=Promise))(function(m,v){function _(I){try{S(f.next(I))}catch(k){v(k)}}function b(I){try{S(f.throw(I))}catch(k){v(k)}}function S(I){I.done?m(I.value):function g(m){return m instanceof u?m:new u(function(v){v(m)})}(I.value).then(_,b)}S((f=f.apply(p,l||[])).next())})}(this,void 0,void 0,function*(){try{for(u=Tpe(p);!(f=yield u.next()).done;)if(l.next(f.value),l.closed)return}catch(v){g={error:v}}finally{try{f&&!f.done&&(m=u.return)&&(yield m.call(u))}finally{if(g)throw g.error}}l.complete()})})(p,l).catch(u=>l.error(u))})}function Ef(p,l,u,f=0,g=!1){const m=l.schedule(function(){u(),g?p.add(this.schedule(null,f)):this.unsubscribe()},f);if(p.add(m),!g)return m}function ma(p,l,u=1/0){return fi(l)?ma((f,g)=>co((m,v)=>l(f,m,g,v))(fh(p(f,g))),u):("number"==typeof l&&(u=l),Ea((f,g)=>function Ope(p,l,u,f,g,m,v,_){const b=[];let S=0,I=0,k=!1;const O=()=>{k&&!b.length&&!S&&l.complete()},j=J=>S<f?W(J):b.push(J),W=J=>{m&&l.next(J),S++;let K=!1;fh(u(J,I++)).subscribe(ga(l,Q=>{null==g||g(Q),m?j(Q):l.next(Q)},()=>{K=!0},void 0,()=>{if(K)try{for(S--;b.length&&S<f;){const Q=b.shift();v?Ef(l,v,()=>W(Q)):W(Q)}O()}catch(Q){l.error(Q)}}))};return p.subscribe(ga(l,j,()=>{k=!0,O()})),()=>{null==_||_()}}(f,g,p,u)))}function bC(p=1/0){return ma(Mm,p)}const Df=new Fs(p=>p.complete());function XP(p){return p[p.length-1]}function wU(p){return fi(XP(p))?p.pop():void 0}function xC(p){return function Lpe(p){return p&&fi(p.schedule)}(XP(p))?p.pop():void 0}function SU(p,l=0){return Ea((u,f)=>{u.subscribe(ga(f,g=>Ef(f,p,()=>f.next(g),l),()=>Ef(f,p,()=>f.complete(),l),g=>Ef(f,p,()=>f.error(g),l)))})}function TU(p,l=0){return Ea((u,f)=>{f.add(p.schedule(()=>u.subscribe(f),l))})}function IU(p,l){if(!p)throw new Error("Iterable cannot be null");return new Fs(u=>{Ef(u,l,()=>{const f=p[Symbol.asyncIterator]();Ef(u,l,()=>{f.next().then(g=>{g.done?u.complete():u.next(g.value)})},0,!0)})})}function va(p,l){return l?function Hpe(p,l){if(null!=p){if(gU(p))return function Bpe(p,l){return fh(p).pipe(TU(l),SU(l))}(p,l);if(fU(p))return function Upe(p,l){return new Fs(u=>{let f=0;return l.schedule(function(){f===p.length?u.complete():(u.next(p[f++]),u.closed||this.schedule())})})}(p,l);if(pU(p))return function Wpe(p,l){return fh(p).pipe(TU(l),SU(l))}(p,l);if(mU(p))return IU(p,l);if(_U(p))return function Vpe(p,l){return new Fs(u=>{let f;return Ef(u,l,()=>{f=p[yU](),Ef(u,l,()=>{let g,m;try{({value:g,done:m}=f.next())}catch(v){return void u.error(v)}m?u.complete():u.next(g)},0,!0)}),()=>fi(null==f?void 0:f.return)&&f.return()})}(p,l);if(bU(p))return function jpe(p,l){return IU(CU(p),l)}(p,l)}throw vU(p)}(p,l):fh(p)}function p3(p){return p<=0?()=>Df:Ea((l,u)=>{let f=0;l.subscribe(ga(u,g=>{++f<=p&&(u.next(g),p<=f&&u.complete())}))})}function $P(p,l,...u){return!0===l?(p(),null):!1===l?null:l(...u).pipe(p3(1)).subscribe(()=>p())}function Qr(p){for(let l in p)if(p[l]===Qr)return l;throw Error("Could not find renamed property on target object.")}function qP(p,l){for(const u in l)l.hasOwnProperty(u)&&!p.hasOwnProperty(u)&&(p[u]=l[u])}function Wr(p){if("string"==typeof p)return p;if(Array.isArray(p))return"["+p.map(Wr).join(", ")+"]";if(null==p)return""+p;if(p.overriddenName)return`${p.overriddenName}`;if(p.name)return`${p.name}`;const l=p.toString();if(null==l)return""+l;const u=l.indexOf("\n");return-1===u?l:l.substring(0,u)}function KP(p,l){return null==p||""===p?null===l?"":l:null==l||""===l?p:p+" "+l}const Ype=Qr({__forward_ref__:Qr});function uo(p){return p.__forward_ref__=uo,p.toString=function(){return Wr(this())},p}function Fi(p){return EU(p)?p():p}function EU(p){return"function"==typeof p&&p.hasOwnProperty(Ype)&&p.__forward_ref__===uo}class br extends Error{constructor(l,u){super(function JP(p,l){return`NG0${Math.abs(p)}${l?": "+l:""}`}(l,u)),this.code=l}}function pi(p){return"string"==typeof p?p:null==p?"":String(p)}function Da(p){return"function"==typeof p?p.name||p.toString():"object"==typeof p&&null!=p&&"function"==typeof p.type?p.type.name||p.type.toString():pi(p)}function g3(p,l){const u=l?` in ${l}`:"";throw new br(-201,`No provider for ${Da(p)} found${u}`)}function wc(p,l){null==p&&function Zr(p,l,u,f){throw new Error(`ASSERTION ERROR: ${p}`+(null==f?"":` [Expected=> ${u} ${f} ${l} <=Actual]`))}(l,p,null,"!=")}function ur(p){return{token:p.token,providedIn:p.providedIn||null,factory:p.factory,value:void 0}}function _d(p){return{providers:p.providers||[],imports:p.imports||[]}}function QP(p){return DU(p,m3)||DU(p,PU)}function DU(p,l){return p.hasOwnProperty(l)?p[l]:null}function AU(p){return p&&(p.hasOwnProperty(ZP)||p.hasOwnProperty(Zpe))?p[ZP]:null}const m3=Qr({\u0275prov:Qr}),ZP=Qr({\u0275inj:Qr}),PU=Qr({ngInjectableDef:Qr}),Zpe=Qr({ngInjectorDef:Qr});var si=(()=>((si=si||{})[si.Default=0]="Default",si[si.Host=1]="Host",si[si.Self=2]="Self",si[si.SkipSelf=4]="SkipSelf",si[si.Optional=8]="Optional",si))();let e6;function Kp(p){const l=e6;return e6=p,l}function RU(p,l,u){const f=QP(p);return f&&"root"==f.providedIn?void 0===f.value?f.value=f.factory():f.value:u&si.Optional?null:void 0!==l?l:void g3(Wr(p),"Injector")}function Jp(p){return{toString:p}.toString()}var Cd=(()=>((Cd=Cd||{})[Cd.OnPush=0]="OnPush",Cd[Cd.Default=1]="Default",Cd))(),ph=(()=>{return(p=ph||(ph={}))[p.Emulated=0]="Emulated",p[p.None=2]="None",p[p.ShadowDom=3]="ShadowDom",ph;var p})();const tge="undefined"!=typeof globalThis&&globalThis,nge="undefined"!=typeof window&&window,ige="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,zr=tge||"undefined"!=typeof global&&global||nge||ige,O0={},eo=[],v3=Qr({\u0275cmp:Qr}),t6=Qr({\u0275dir:Qr}),n6=Qr({\u0275pipe:Qr}),kU=Qr({\u0275mod:Qr}),Pf=Qr({\u0275fac:Qr}),wC=Qr({__NG_ELEMENT_ID__:Qr});let rge=0;function Sl(p){return Jp(()=>{const u={},f={type:p.type,providersResolver:null,decls:p.decls,vars:p.vars,factory:null,template:p.template||null,consts:p.consts||null,ngContentSelectors:p.ngContentSelectors,hostBindings:p.hostBindings||null,hostVars:p.hostVars||0,hostAttrs:p.hostAttrs||null,contentQueries:p.contentQueries||null,declaredInputs:u,inputs:null,outputs:null,exportAs:p.exportAs||null,onPush:p.changeDetection===Cd.OnPush,directiveDefs:null,pipeDefs:null,selectors:p.selectors||eo,viewQuery:p.viewQuery||null,features:p.features||null,data:p.data||{},encapsulation:p.encapsulation||ph.Emulated,id:"c",styles:p.styles||eo,_:null,setInput:null,schemas:p.schemas||null,tView:null},g=p.directives,m=p.features,v=p.pipes;return f.id+=rge++,f.inputs=LU(p.inputs,u),f.outputs=LU(p.outputs),m&&m.forEach(_=>_(f)),f.directiveDefs=g?()=>("function"==typeof g?g():g).map(MU):null,f.pipeDefs=v?()=>("function"==typeof v?v():v).map(OU):null,f})}function MU(p){return Za(p)||function Qp(p){return p[t6]||null}(p)}function OU(p){return function Fm(p){return p[n6]||null}(p)}const FU={};function gh(p){return Jp(()=>{const l={type:p.type,bootstrap:p.bootstrap||eo,declarations:p.declarations||eo,imports:p.imports||eo,exports:p.exports||eo,transitiveCompileScopes:null,schemas:p.schemas||null,id:p.id||null};return null!=p.id&&(FU[p.id]=p.type),l})}function LU(p,l){if(null==p)return O0;const u={};for(const f in p)if(p.hasOwnProperty(f)){let g=p[f],m=g;Array.isArray(g)&&(m=g[1],g=g[0]),u[g]=f,l&&(l[g]=m)}return u}const ii=Sl;function Za(p){return p[v3]||null}function yu(p,l){const u=p[kU]||null;if(!u&&!0===l)throw new Error(`Type ${Wr(p)} does not have '\u0275mod' property.`);return u}function mh(p){return Array.isArray(p)&&"object"==typeof p[1]}function xd(p){return Array.isArray(p)&&!0===p[1]}function o6(p){return 0!=(8&p.flags)}function b3(p){return 2==(2&p.flags)}function x3(p){return 1==(1&p.flags)}function wd(p){return null!==p.template}function uge(p){return 0!=(512&p[2])}function Wm(p,l){return p.hasOwnProperty(Pf)?p[Pf]:null}class fge{constructor(l,u,f){this.previousValue=l,this.currentValue=u,this.firstChange=f}isFirstChange(){return this.firstChange}}function Cu(){return BU}function BU(p){return p.type.prototype.ngOnChanges&&(p.setInput=gge),pge}function pge(){const p=UU(this),l=null==p?void 0:p.current;if(l){const u=p.previous;if(u===O0)p.previous=l;else for(let f in l)u[f]=l[f];p.current=null,this.ngOnChanges(l)}}function gge(p,l,u,f){const g=UU(p)||function mge(p,l){return p[WU]=l}(p,{previous:O0,current:null}),m=g.current||(g.current={}),v=g.previous,_=this.declaredInputs[u],b=v[_];m[_]=new fge(b&&b.currentValue,l,v===O0),p[f]=l}Cu.ngInherit=!0;const WU="__ngSimpleChanges__";function UU(p){return p[WU]||null}let u6;function as(p){return!!p.listen}const VU={createRenderer:(p,l)=>function d6(){return void 0!==u6?u6:"undefined"!=typeof document?document:void 0}()};function Ls(p){for(;Array.isArray(p);)p=p[0];return p}function w3(p,l){return Ls(l[p])}function xu(p,l){return Ls(l[p.index])}function h6(p,l){return p.data[l]}function Tc(p,l){const u=l[p];return mh(u)?u:u[0]}function f6(p){return 128==(128&p[2])}function Zp(p,l){return null==l?null:p[l]}function HU(p){p[18]=0}function p6(p,l){p[5]+=l;let u=p,f=p[3];for(;null!==f&&(1===l&&1===u[5]||-1===l&&0===u[5]);)f[5]+=l,u=f,f=f[3]}const gi={lFrame:QU(null),bindingsEnabled:!0};function zU(){return gi.bindingsEnabled}function Gt(){return gi.lFrame.lView}function xr(){return gi.lFrame.tView}function ia(){let p=YU();for(;null!==p&&64===p.type;)p=p.parent;return p}function YU(){return gi.lFrame.currentTNode}function vh(p,l){const u=gi.lFrame;u.currentTNode=p,u.isParent=l}function g6(){return gi.lFrame.isParent}function U0(){return gi.lFrame.bindingIndex++}function Oge(p,l){const u=gi.lFrame;u.bindingIndex=u.bindingRootIndex=p,v6(l)}function v6(p){gi.lFrame.currentDirectiveIndex=p}function _6(p){gi.lFrame.currentQueryIndex=p}function Lge(p){const l=p[1];return 2===l.type?l.declTNode:1===l.type?p[6]:null}function KU(p,l,u){if(u&si.SkipSelf){let g=l,m=p;for(;!(g=g.parent,null!==g||u&si.Host||(g=Lge(m),null===g||(m=m[15],10&g.type))););if(null===g)return!1;l=g,p=m}const f=gi.lFrame=JU();return f.currentTNode=l,f.lView=p,!0}function T3(p){const l=JU(),u=p[1];gi.lFrame=l,l.currentTNode=u.firstChild,l.lView=p,l.tView=u,l.contextLView=p,l.bindingIndex=u.bindingStartIndex,l.inI18n=!1}function JU(){const p=gi.lFrame,l=null===p?null:p.child;return null===l?QU(p):l}function QU(p){const l={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:p,child:null,inI18n:!1};return null!==p&&(p.child=l),l}function ZU(){const p=gi.lFrame;return gi.lFrame=p.parent,p.currentTNode=null,p.lView=null,p}const eV=ZU;function I3(){const p=ZU();p.isParent=!0,p.tView=null,p.selectedIndex=-1,p.contextLView=null,p.elementDepthCount=0,p.currentDirectiveIndex=-1,p.currentNamespace=null,p.bindingRootIndex=-1,p.bindingIndex=-1,p.currentQueryIndex=0}function Il(){return gi.lFrame.selectedIndex}function eg(p){gi.lFrame.selectedIndex=p}function ls(){const p=gi.lFrame;return h6(p.tView,p.selectedIndex)}function E3(p,l){for(let u=l.directiveStart,f=l.directiveEnd;u<f;u++){const m=p.data[u].type.prototype,{ngAfterContentInit:v,ngAfterContentChecked:_,ngAfterViewInit:b,ngAfterViewChecked:S,ngOnDestroy:I}=m;v&&(p.contentHooks||(p.contentHooks=[])).push(-u,v),_&&((p.contentHooks||(p.contentHooks=[])).push(u,_),(p.contentCheckHooks||(p.contentCheckHooks=[])).push(u,_)),b&&(p.viewHooks||(p.viewHooks=[])).push(-u,b),S&&((p.viewHooks||(p.viewHooks=[])).push(u,S),(p.viewCheckHooks||(p.viewCheckHooks=[])).push(u,S)),null!=I&&(p.destroyHooks||(p.destroyHooks=[])).push(u,I)}}function D3(p,l,u){tV(p,l,3,u)}function A3(p,l,u,f){(3&p[2])===u&&tV(p,l,u,f)}function C6(p,l){let u=p[2];(3&u)===l&&(u&=2047,u+=1,p[2]=u)}function tV(p,l,u,f){const m=null!=f?f:-1,v=l.length-1;let _=0;for(let b=void 0!==f?65535&p[18]:0;b<v;b++)if("number"==typeof l[b+1]){if(_=l[b],null!=f&&_>=f)break}else l[b]<0&&(p[18]+=65536),(_<m||-1==m)&&(zge(p,u,l,b),p[18]=(4294901760&p[18])+b+2),b++}function zge(p,l,u,f){const g=u[f]<0,m=u[f+1],_=p[g?-u[f]:u[f]];if(g){if(p[2]>>11<p[18]>>16&&(3&p[2])===l){p[2]+=2048;try{m.call(_)}finally{}}}else try{m.call(_)}finally{}}class DC{constructor(l,u,f){this.factory=l,this.resolving=!1,this.canSeeViewProviders=u,this.injectImpl=f}}function P3(p,l,u){const f=as(p);let g=0;for(;g<u.length;){const m=u[g];if("number"==typeof m){if(0!==m)break;g++;const v=u[g++],_=u[g++],b=u[g++];f?p.setAttribute(l,_,b,v):l.setAttributeNS(v,_,b)}else{const v=m,_=u[++g];x6(v)?f&&p.setProperty(l,v,_):f?p.setAttribute(l,v,_):l.setAttribute(v,_),g++}}return g}function nV(p){return 3===p||4===p||6===p}function x6(p){return 64===p.charCodeAt(0)}function R3(p,l){if(null!==l&&0!==l.length)if(null===p||0===p.length)p=l.slice();else{let u=-1;for(let f=0;f<l.length;f++){const g=l[f];"number"==typeof g?u=g:0===u||iV(p,u,g,null,-1===u||2===u?l[++f]:null)}}return p}function iV(p,l,u,f,g){let m=0,v=p.length;if(-1===l)v=-1;else for(;m<p.length;){const _=p[m++];if("number"==typeof _){if(_===l){v=-1;break}if(_>l){v=m-1;break}}}for(;m<p.length;){const _=p[m];if("number"==typeof _)break;if(_===u){if(null===f)return void(null!==g&&(p[m+1]=g));if(f===p[m+1])return void(p[m+2]=g)}m++,null!==f&&m++,null!==g&&m++}-1!==v&&(p.splice(v,0,l),m=v+1),p.splice(m++,0,u),null!==f&&p.splice(m++,0,f),null!==g&&p.splice(m++,0,g)}function rV(p){return-1!==p}function V0(p){return 32767&p}function j0(p,l){let u=function Kge(p){return p>>16}(p),f=l;for(;u>0;)f=f[15],u--;return f}let w6=!0;function k3(p){const l=w6;return w6=p,l}let Jge=0;function PC(p,l){const u=T6(p,l);if(-1!==u)return u;const f=l[1];f.firstCreatePass&&(p.injectorIndex=l.length,S6(f.data,p),S6(l,null),S6(f.blueprint,null));const g=M3(p,l),m=p.injectorIndex;if(rV(g)){const v=V0(g),_=j0(g,l),b=_[1].data;for(let S=0;S<8;S++)l[m+S]=_[v+S]|b[v+S]}return l[m+8]=g,m}function S6(p,l){p.push(0,0,0,0,0,0,0,0,l)}function T6(p,l){return-1===p.injectorIndex||p.parent&&p.parent.injectorIndex===p.injectorIndex||null===l[p.injectorIndex+8]?-1:p.injectorIndex}function M3(p,l){if(p.parent&&-1!==p.parent.injectorIndex)return p.parent.injectorIndex;let u=0,f=null,g=l;for(;null!==g;){const m=g[1],v=m.type;if(f=2===v?m.declTNode:1===v?g[6]:null,null===f)return-1;if(u++,g=g[15],-1!==f.injectorIndex)return f.injectorIndex|u<<16}return-1}function O3(p,l,u){!function Qge(p,l,u){let f;"string"==typeof u?f=u.charCodeAt(0)||0:u.hasOwnProperty(wC)&&(f=u[wC]),null==f&&(f=u[wC]=Jge++);const g=255&f;l.data[p+(g>>5)]|=1<<g}(p,l,u)}function aV(p,l,u){if(u&si.Optional)return p;g3(l,"NodeInjector")}function lV(p,l,u,f){if(u&si.Optional&&void 0===f&&(f=null),0==(u&(si.Self|si.Host))){const g=p[9],m=Kp(void 0);try{return g?g.get(l,f,u&si.Optional):RU(l,f,u&si.Optional)}finally{Kp(m)}}return aV(f,l,u)}function cV(p,l,u,f=si.Default,g){if(null!==p){const m=function nme(p){if("string"==typeof p)return p.charCodeAt(0)||0;const l=p.hasOwnProperty(wC)?p[wC]:void 0;return"number"==typeof l?l>=0?255&l:eme:l}(u);if("function"==typeof m){if(!KU(l,p,f))return f&si.Host?aV(g,u,f):lV(l,u,f,g);try{const v=m(f);if(null!=v||f&si.Optional)return v;g3(u)}finally{eV()}}else if("number"==typeof m){let v=null,_=T6(p,l),b=-1,S=f&si.Host?l[16][6]:null;for((-1===_||f&si.SkipSelf)&&(b=-1===_?M3(p,l):l[_+8],-1!==b&&hV(f,!1)?(v=l[1],_=V0(b),l=j0(b,l)):_=-1);-1!==_;){const I=l[1];if(dV(m,_,I.data)){const k=tme(_,l,u,v,f,S);if(k!==uV)return k}b=l[_+8],-1!==b&&hV(f,l[1].data[_+8]===S)&&dV(m,_,l)?(v=I,_=V0(b),l=j0(b,l)):_=-1}}}return lV(l,u,f,g)}const uV={};function eme(){return new H0(ia(),Gt())}function tme(p,l,u,f,g,m){const v=l[1],_=v.data[p+8],I=function F3(p,l,u,f,g){const m=p.providerIndexes,v=l.data,_=1048575&m,b=p.directiveStart,I=m>>20,O=g?_+I:p.directiveEnd;for(let j=f?_:_+I;j<O;j++){const W=v[j];if(j<b&&u===W||j>=b&&W.type===u)return j}if(g){const j=v[b];if(j&&wd(j)&&j.type===u)return b}return null}(_,v,u,null==f?b3(_)&&w6:f!=v&&0!=(3&_.type),g&si.Host&&m===_);return null!==I?RC(l,v,I,_):uV}function RC(p,l,u,f){let g=p[u];const m=l.data;if(function Yge(p){return p instanceof DC}(g)){const v=g;v.resolving&&function Xpe(p,l){const u=l?`. Dependency path: ${l.join(" > ")} > ${p}`:"";throw new br(-200,`Circular dependency in DI detected for ${p}${u}`)}(Da(m[u]));const _=k3(v.canSeeViewProviders);v.resolving=!0;const b=v.injectImpl?Kp(v.injectImpl):null;KU(p,f,si.Default);try{g=p[u]=v.factory(void 0,m,p,f),l.firstCreatePass&&u>=f.directiveStart&&function Gge(p,l,u){const{ngOnChanges:f,ngOnInit:g,ngDoCheck:m}=l.type.prototype;if(f){const v=BU(l);(u.preOrderHooks||(u.preOrderHooks=[])).push(p,v),(u.preOrderCheckHooks||(u.preOrderCheckHooks=[])).push(p,v)}g&&(u.preOrderHooks||(u.preOrderHooks=[])).push(0-p,g),m&&((u.preOrderHooks||(u.preOrderHooks=[])).push(p,m),(u.preOrderCheckHooks||(u.preOrderCheckHooks=[])).push(p,m))}(u,m[u],l)}finally{null!==b&&Kp(b),k3(_),v.resolving=!1,eV()}}return g}function dV(p,l,u){return!!(u[l+(p>>5)]&1<<p)}function hV(p,l){return!(p&si.Self||p&si.Host&&l)}class H0{constructor(l,u){this._tNode=l,this._lView=u}get(l,u,f){return cV(this._tNode,this._lView,l,f,u)}}function tl(p){return Jp(()=>{const l=p.prototype.constructor,u=l[Pf]||I6(l),f=Object.prototype;let g=Object.getPrototypeOf(p.prototype).constructor;for(;g&&g!==f;){const m=g[Pf]||I6(g);if(m&&m!==u)return m;g=Object.getPrototypeOf(g)}return m=>new m})}function I6(p){return EU(p)?()=>{const l=I6(Fi(p));return l&&l()}:Wm(p)}const z0="__parameters__";function X0(p,l,u){return Jp(()=>{const f=function E6(p){return function(...u){if(p){const f=p(...u);for(const g in f)this[g]=f[g]}}}(l);function g(...m){if(this instanceof g)return f.apply(this,m),this;const v=new g(...m);return _.annotation=v,_;function _(b,S,I){const k=b.hasOwnProperty(z0)?b[z0]:Object.defineProperty(b,z0,{value:[]})[z0];for(;k.length<=I;)k.push(null);return(k[I]=k[I]||[]).push(v),b}}return u&&(g.prototype=Object.create(u.prototype)),g.prototype.ngMetadataName=p,g.annotationCls=g,g})}class Yi{constructor(l,u){this._desc=l,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof u?this.__NG_ELEMENT_ID__=u:void 0!==u&&(this.\u0275prov=ur({token:this,providedIn:u.providedIn||"root",factory:u.factory}))}toString(){return`InjectionToken ${this._desc}`}}const rme=new Yi("AnalyzeForEntryComponents");function yh(p,l){p.forEach(u=>Array.isArray(u)?yh(u,l):l(u))}function pV(p,l,u){l>=p.length?p.push(u):p.splice(l,0,u)}function L3(p,l){return l>=p.length-1?p.pop():p.splice(l,1)[0]}function Ic(p,l,u){let f=$0(p,l);return f>=0?p[1|f]=u:(f=~f,function ame(p,l,u,f){let g=p.length;if(g==l)p.push(u,f);else if(1===g)p.push(f,p[0]),p[0]=u;else{for(g--,p.push(p[g-1],p[g]);g>l;)p[g]=p[g-2],g--;p[l]=u,p[l+1]=f}}(p,f,l,u)),f}function A6(p,l){const u=$0(p,l);if(u>=0)return p[1|u]}function $0(p,l){return function vV(p,l,u){let f=0,g=p.length>>u;for(;g!==f;){const m=f+(g-f>>1),v=p[m<<u];if(l===v)return m<<u;v>l?g=m:f=m+1}return~(g<<u)}(p,l,1)}const LC={},R6="__NG_DI_FLAG__",B3="ngTempTokenPath",pme=/\n/gm,_V="__source",mme=Qr({provide:String,useValue:Qr});let NC;function CV(p){const l=NC;return NC=p,l}function vme(p,l=si.Default){if(void 0===NC)throw new br(203,"");return null===NC?RU(p,void 0,l):NC.get(p,l&si.Optional?null:void 0,l)}function ri(p,l=si.Default){return(function ege(){return e6}()||vme)(Fi(p),l)}const yme=ri;function k6(p){const l=[];for(let u=0;u<p.length;u++){const f=Fi(p[u]);if(Array.isArray(f)){if(0===f.length)throw new br(900,"");let g,m=si.Default;for(let v=0;v<f.length;v++){const _=f[v],b=_me(_);"number"==typeof b?-1===b?g=_.token:m|=b:g=_}l.push(ri(g,m))}else l.push(ri(f))}return l}function BC(p,l){return p[R6]=l,p.prototype[R6]=l,p}function _me(p){return p[R6]}const W3=BC(X0("Inject",p=>({token:p})),-1),ng=BC(X0("Optional"),8),WC=BC(X0("SkipSelf"),4);class AV{constructor(l){this.changingThisBreaksApplicationSecurity=l}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function ig(p){return p instanceof AV?p.changingThisBreaksApplicationSecurity:p}const Vme=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,jme=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Ns=(()=>((Ns=Ns||{})[Ns.NONE=0]="NONE",Ns[Ns.HTML=1]="HTML",Ns[Ns.STYLE=2]="STYLE",Ns[Ns.SCRIPT=3]="SCRIPT",Ns[Ns.URL=4]="URL",Ns[Ns.RESOURCE_URL=5]="RESOURCE_URL",Ns))();function U6(p){const l=function HC(){const p=Gt();return p&&p[12]}();return l?l.sanitize(Ns.URL,p)||"":function VC(p,l){const u=function Nme(p){return p instanceof AV&&p.getTypeName()||null}(p);if(null!=u&&u!==l){if("ResourceURL"===u&&"URL"===l)return!0;throw new Error(`Required a safe ${l}, got a ${u} (see https://g.co/ng/security#xss)`)}return u===l}(p,"URL")?ig(p):function H3(p){return(p=String(p)).match(Vme)||p.match(jme)?p:"unsafe:"+p}(pi(p))}const WV="__ngContext__";function nl(p,l){p[WV]=l}function j6(p){const l=function GC(p){return p[WV]||null}(p);return l?Array.isArray(l)?l:l.lView:null}function G6(p){return p.ngOriginalError}function dve(p,...l){p.error(...l)}class zC{constructor(){this._console=console}handleError(l){const u=this._findOriginalError(l),f=function uve(p){return p&&p.ngErrorLogger||dve}(l);f(this._console,"ERROR",l),u&&f(this._console,"ORIGINAL ERROR",u)}_findOriginalError(l){let u=l&&G6(l);for(;u&&G6(u);)u=G6(u);return u||null}}const bve=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(zr))();function Ch(p){return p instanceof Function?p():p}var Ec=(()=>((Ec=Ec||{})[Ec.Important=1]="Important",Ec[Ec.DashCase=2]="DashCase",Ec))();function Y6(p,l){return undefined(p,l)}function YC(p){const l=p[3];return xd(l)?l[3]:l}function X6(p){return $V(p[13])}function $6(p){return $V(p[4])}function $V(p){for(;null!==p&&!xd(p);)p=p[4];return p}function Q0(p,l,u,f,g){if(null!=f){let m,v=!1;xd(f)?m=f:mh(f)&&(v=!0,f=f[0]);const _=Ls(f);0===p&&null!==u?null==g?ej(l,u,_):Um(l,u,_,g||null,!0):1===p&&null!==u?Um(l,u,_,g||null,!0):2===p?function aj(p,l,u){const f=z3(p,l);f&&function Fve(p,l,u,f){as(p)?p.removeChild(l,u,f):l.removeChild(u)}(p,f,l,u)}(l,_,v):3===p&&l.destroyNode(_),null!=m&&function Bve(p,l,u,f,g){const m=u[7];m!==Ls(u)&&Q0(l,p,f,m,g);for(let _=10;_<u.length;_++){const b=u[_];XC(b[1],b,p,l,f,m)}}(l,p,m,u,g)}}function K6(p,l,u){if(as(p))return p.createElement(l,u);{const f=null!==u?function Cge(p){const l=p.toLowerCase();return"svg"===l?"http://www.w3.org/2000/svg":"math"===l?"http://www.w3.org/1998/MathML/":null}(u):null;return null===f?p.createElement(l):p.createElementNS(f,l)}}function KV(p,l){const u=p[9],f=u.indexOf(l),g=l[3];1024&l[2]&&(l[2]&=-1025,p6(g,-1)),u.splice(f,1)}function J6(p,l){if(p.length<=10)return;const u=10+l,f=p[u];if(f){const g=f[17];null!==g&&g!==p&&KV(g,f),l>0&&(p[u-1][4]=f[4]);const m=L3(p,10+l);!function Eve(p,l){XC(p,l,l[11],2,null,null),l[0]=null,l[6]=null}(f[1],f);const v=m[19];null!==v&&v.detachView(m[1]),f[3]=null,f[4]=null,f[2]&=-129}return f}function JV(p,l){if(!(256&l[2])){const u=l[11];as(u)&&u.destroyNode&&XC(p,l,u,3,null,null),function Pve(p){let l=p[13];if(!l)return Q6(p[1],p);for(;l;){let u=null;if(mh(l))u=l[13];else{const f=l[10];f&&(u=f)}if(!u){for(;l&&!l[4]&&l!==p;)mh(l)&&Q6(l[1],l),l=l[3];null===l&&(l=p),mh(l)&&Q6(l[1],l),u=l&&l[4]}l=u}}(l)}}function Q6(p,l){if(!(256&l[2])){l[2]&=-129,l[2]|=256,function Ove(p,l){let u;if(null!=p&&null!=(u=p.destroyHooks))for(let f=0;f<u.length;f+=2){const g=l[u[f]];if(!(g instanceof DC)){const m=u[f+1];if(Array.isArray(m))for(let v=0;v<m.length;v+=2){const _=g[m[v]],b=m[v+1];try{b.call(_)}finally{}}else try{m.call(g)}finally{}}}}(p,l),function Mve(p,l){const u=p.cleanup,f=l[7];let g=-1;if(null!==u)for(let m=0;m<u.length-1;m+=2)if("string"==typeof u[m]){const v=u[m+1],_="function"==typeof v?v(l):Ls(l[v]),b=f[g=u[m+2]],S=u[m+3];"boolean"==typeof S?_.removeEventListener(u[m],b,S):S>=0?f[g=S]():f[g=-S].unsubscribe(),m+=2}else{const v=f[g=u[m+1]];u[m].call(v)}if(null!==f){for(let m=g+1;m<f.length;m++)f[m]();l[7]=null}}(p,l),1===l[1].type&&as(l[11])&&l[11].destroy();const u=l[17];if(null!==u&&xd(l[3])){u!==l[3]&&KV(u,l);const f=l[19];null!==f&&f.detachView(p)}}}function QV(p,l,u){return function ZV(p,l,u){let f=l;for(;null!==f&&40&f.type;)f=(l=f).parent;if(null===f)return u[0];if(2&f.flags){const g=p.data[f.directiveStart].encapsulation;if(g===ph.None||g===ph.Emulated)return null}return xu(f,u)}(p,l.parent,u)}function Um(p,l,u,f,g){as(p)?p.insertBefore(l,u,f,g):l.insertBefore(u,f,g)}function ej(p,l,u){as(p)?p.appendChild(l,u):l.appendChild(u)}function tj(p,l,u,f,g){null!==f?Um(p,l,u,f,g):ej(p,l,u)}function z3(p,l){return as(p)?p.parentNode(l):l.parentNode}let rj=function ij(p,l,u){return 40&p.type?xu(p,u):null};function Y3(p,l,u,f){const g=QV(p,f,l),m=l[11],_=function nj(p,l,u){return rj(p,l,u)}(f.parent||l[6],f,l);if(null!=g)if(Array.isArray(u))for(let b=0;b<u.length;b++)tj(m,g,u[b],_,!1);else tj(m,g,u,_,!1)}function X3(p,l){if(null!==l){const u=l.type;if(3&u)return xu(l,p);if(4&u)return eR(-1,p[l.index]);if(8&u){const f=l.child;if(null!==f)return X3(p,f);{const g=p[l.index];return xd(g)?eR(-1,g):Ls(g)}}if(32&u)return Y6(l,p)()||Ls(p[l.index]);{const f=sj(p,l);return null!==f?Array.isArray(f)?f[0]:X3(YC(p[16]),f):X3(p,l.next)}}return null}function sj(p,l){return null!==l?p[16][6].projection[l.projection]:null}function eR(p,l){const u=10+p+1;if(u<l.length){const f=l[u],g=f[1].firstChild;if(null!==g)return X3(f,g)}return l[7]}function tR(p,l,u,f,g,m,v){for(;null!=u;){const _=f[u.index],b=u.type;if(v&&0===l&&(_&&nl(Ls(_),f),u.flags|=4),64!=(64&u.flags))if(8&b)tR(p,l,u.child,f,g,m,!1),Q0(l,p,g,_,m);else if(32&b){const S=Y6(u,f);let I;for(;I=S();)Q0(l,p,g,I,m);Q0(l,p,g,_,m)}else 16&b?lj(p,l,f,u,g,m):Q0(l,p,g,_,m);u=v?u.projectionNext:u.next}}function XC(p,l,u,f,g,m){tR(u,f,p.firstChild,l,g,m,!1)}function lj(p,l,u,f,g,m){const v=u[16],b=v[6].projection[f.projection];if(Array.isArray(b))for(let S=0;S<b.length;S++)Q0(l,p,g,b[S],m);else tR(p,l,b,v[3],g,m,!0)}function cj(p,l,u){as(p)?p.setAttribute(l,"style",u):l.style.cssText=u}function nR(p,l,u){as(p)?""===u?p.removeAttribute(l,"class"):p.setAttribute(l,"class",u):l.className=u}function uj(p,l,u){let f=p.length;for(;;){const g=p.indexOf(l,u);if(-1===g)return g;if(0===g||p.charCodeAt(g-1)<=32){const m=l.length;if(g+m===f||p.charCodeAt(g+m)<=32)return g}u=g+1}}const dj="ng-template";function Uve(p,l,u){let f=0;for(;f<p.length;){let g=p[f++];if(u&&"class"===g){if(g=p[f],-1!==uj(g.toLowerCase(),l,0))return!0}else if(1===g){for(;f<p.length&&"string"==typeof(g=p[f++]);)if(g.toLowerCase()===l)return!0;return!1}}return!1}function hj(p){return 4===p.type&&p.value!==dj}function Vve(p,l,u){return l===(4!==p.type||u?p.value:dj)}function jve(p,l,u){let f=4;const g=p.attrs||[],m=function zve(p){for(let l=0;l<p.length;l++)if(nV(p[l]))return l;return p.length}(g);let v=!1;for(let _=0;_<l.length;_++){const b=l[_];if("number"!=typeof b){if(!v)if(4&f){if(f=2|1&f,""!==b&&!Vve(p,b,u)||""===b&&1===l.length){if(Sd(f))return!1;v=!0}}else{const S=8&f?b:l[++_];if(8&f&&null!==p.attrs){if(!Uve(p.attrs,S,u)){if(Sd(f))return!1;v=!0}continue}const k=Hve(8&f?"class":b,g,hj(p),u);if(-1===k){if(Sd(f))return!1;v=!0;continue}if(""!==S){let O;O=k>m?"":g[k+1].toLowerCase();const j=8&f?O:null;if(j&&-1!==uj(j,S,0)||2&f&&S!==O){if(Sd(f))return!1;v=!0}}}}else{if(!v&&!Sd(f)&&!Sd(b))return!1;if(v&&Sd(b))continue;v=!1,f=b|1&f}}return Sd(f)||v}function Sd(p){return 0==(1&p)}function Hve(p,l,u,f){if(null===l)return-1;let g=0;if(f||!u){let m=!1;for(;g<l.length;){const v=l[g];if(v===p)return g;if(3===v||6===v)m=!0;else{if(1===v||2===v){let _=l[++g];for(;"string"==typeof _;)_=l[++g];continue}if(4===v)break;if(0===v){g+=4;continue}}g+=m?1:2}return-1}return function Yve(p,l){let u=p.indexOf(4);if(u>-1)for(u++;u<p.length;){const f=p[u];if("number"==typeof f)return-1;if(f===l)return u;u++}return-1}(l,p)}function fj(p,l,u=!1){for(let f=0;f<l.length;f++)if(jve(p,l[f],u))return!0;return!1}function pj(p,l){return p?":not("+l.trim()+")":l}function $ve(p){let l=p[0],u=1,f=2,g="",m=!1;for(;u<p.length;){let v=p[u];if("string"==typeof v)if(2&f){const _=p[++u];g+="["+v+(_.length>0?'="'+_+'"':"")+"]"}else 8&f?g+="."+v:4&f&&(g+=" "+v);else""!==g&&!Sd(v)&&(l+=pj(m,g),g=""),f=v,m=m||!Sd(f);u++}return""!==g&&(l+=pj(m,g)),l}const mi={};function to(p){gj(xr(),Gt(),Il()+p,!1)}function gj(p,l,u,f){if(!f)if(3==(3&l[2])){const m=p.preOrderCheckHooks;null!==m&&D3(l,m,u)}else{const m=p.preOrderHooks;null!==m&&A3(l,m,0,u)}eg(u)}function $3(p,l){return p<<17|l<<2}function Td(p){return p>>17&32767}function iR(p){return 2|p}function Mf(p){return(131068&p)>>2}function rR(p,l){return-131069&p|l<<2}function oR(p){return 1|p}function Ij(p,l){const u=p.contentQueries;if(null!==u)for(let f=0;f<u.length;f+=2){const g=u[f],m=u[f+1];if(-1!==m){const v=p.data[m];_6(g),v.contentQueries(2,l[m],m)}}}function $C(p,l,u,f,g,m,v,_,b,S){const I=l.blueprint.slice();return I[0]=g,I[2]=140|f,HU(I),I[3]=I[15]=p,I[8]=u,I[10]=v||p&&p[10],I[11]=_||p&&p[11],I[12]=b||p&&p[12]||null,I[9]=S||p&&p[9]||null,I[6]=m,I[16]=2==l.type?p[16]:I,I}function Z0(p,l,u,f,g){let m=p.data[l];if(null===m)m=function pR(p,l,u,f,g){const m=YU(),v=g6(),b=p.data[l]=function h0e(p,l,u,f,g,m){return{type:u,index:f,insertBeforeIndex:null,injectorIndex:l?l.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:g,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:l,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,v?m:m&&m.parent,u,l,f,g);return null===p.firstChild&&(p.firstChild=b),null!==m&&(v?null==m.child&&null!==b.parent&&(m.child=b):null===m.next&&(m.next=b)),b}(p,l,u,f,g),function Mge(){return gi.lFrame.inI18n}()&&(m.flags|=64);else if(64&m.type){m.type=u,m.value=f,m.attrs=g;const v=function EC(){const p=gi.lFrame,l=p.currentTNode;return p.isParent?l:l.parent}();m.injectorIndex=null===v?-1:v.injectorIndex}return vh(m,!0),m}function ey(p,l,u,f){if(0===u)return-1;const g=l.length;for(let m=0;m<u;m++)l.push(f),p.blueprint.push(f),p.data.push(null);return g}function qC(p,l,u){T3(l);try{const f=p.viewQuery;null!==f&&wR(1,f,u);const g=p.template;null!==g&&Ej(p,l,g,1,u),p.firstCreatePass&&(p.firstCreatePass=!1),p.staticContentQueries&&Ij(p,l),p.staticViewQueries&&wR(2,p.viewQuery,u);const m=p.components;null!==m&&function c0e(p,l){for(let u=0;u<l.length;u++)P0e(p,l[u])}(l,m)}catch(f){throw p.firstCreatePass&&(p.incompleteFirstPass=!0,p.firstCreatePass=!1),f}finally{l[2]&=-5,I3()}}function ty(p,l,u,f){const g=l[2];if(256!=(256&g)){T3(l);try{HU(l),function XU(p){return gi.lFrame.bindingIndex=p}(p.bindingStartIndex),null!==u&&Ej(p,l,u,2,f);const v=3==(3&g);if(v){const S=p.preOrderCheckHooks;null!==S&&D3(l,S,null)}else{const S=p.preOrderHooks;null!==S&&A3(l,S,0,null),C6(l,0)}if(function D0e(p){for(let l=X6(p);null!==l;l=$6(l)){if(!l[2])continue;const u=l[9];for(let f=0;f<u.length;f++){const g=u[f],m=g[3];0==(1024&g[2])&&p6(m,1),g[2]|=1024}}}(l),function E0e(p){for(let l=X6(p);null!==l;l=$6(l))for(let u=10;u<l.length;u++){const f=l[u],g=f[1];f6(f)&&ty(g,f,g.template,f[8])}}(l),null!==p.contentQueries&&Ij(p,l),v){const S=p.contentCheckHooks;null!==S&&D3(l,S)}else{const S=p.contentHooks;null!==S&&A3(l,S,1),C6(l,1)}!function a0e(p,l){const u=p.hostBindingOpCodes;if(null!==u)try{for(let f=0;f<u.length;f++){const g=u[f];if(g<0)eg(~g);else{const m=g,v=u[++f],_=u[++f];Oge(v,m),_(2,l[m])}}}finally{eg(-1)}}(p,l);const _=p.components;null!==_&&function l0e(p,l){for(let u=0;u<l.length;u++)A0e(p,l[u])}(l,_);const b=p.viewQuery;if(null!==b&&wR(2,b,f),v){const S=p.viewCheckHooks;null!==S&&D3(l,S)}else{const S=p.viewHooks;null!==S&&A3(l,S,2),C6(l,2)}!0===p.firstUpdatePass&&(p.firstUpdatePass=!1),l[2]&=-73,1024&l[2]&&(l[2]&=-1025,p6(l[3],-1))}finally{I3()}}}function u0e(p,l,u,f){const g=l[10],v=function jU(p){return 4==(4&p[2])}(l);try{!v&&g.begin&&g.begin(),v&&qC(p,l,f),ty(p,l,u,f)}finally{!v&&g.end&&g.end()}}function Ej(p,l,u,f,g){const m=Il(),v=2&f;try{eg(-1),v&&l.length>20&&gj(p,l,20,!1),u(f,g)}finally{eg(m)}}function gR(p,l,u){!zU()||(function _0e(p,l,u,f){const g=u.directiveStart,m=u.directiveEnd;p.firstCreatePass||PC(u,l),nl(f,l);const v=u.initialInputs;for(let _=g;_<m;_++){const b=p.data[_],S=wd(b);S&&S0e(l,u,b);const I=RC(l,p,_,u);nl(I,l),null!==v&&T0e(0,_-g,I,b,0,v),S&&(Tc(u.index,l)[8]=I)}}(p,l,u,xu(u,l)),128==(128&u.flags)&&function C0e(p,l,u){const f=u.directiveStart,g=u.directiveEnd,v=u.index,_=function Fge(){return gi.lFrame.currentDirectiveIndex}();try{eg(v);for(let b=f;b<g;b++){const S=p.data[b],I=l[b];v6(b),(null!==S.hostBindings||0!==S.hostVars||null!==S.hostAttrs)&&Lj(S,I)}}finally{eg(-1),v6(_)}}(p,l,u))}function mR(p,l,u=xu){const f=l.localNames;if(null!==f){let g=l.index+1;for(let m=0;m<f.length;m+=2){const v=f[m+1],_=-1===v?u(l,p):p[v];p[g++]=_}}}function Aj(p){const l=p.tView;return null===l||l.incompleteFirstPass?p.tView=J3(1,null,p.template,p.decls,p.vars,p.directiveDefs,p.pipeDefs,p.viewQuery,p.schemas,p.consts):l}function J3(p,l,u,f,g,m,v,_,b,S){const I=20+f,k=I+g,O=function d0e(p,l){const u=[];for(let f=0;f<l;f++)u.push(f<p?null:mi);return u}(I,k),j="function"==typeof S?S():S;return O[1]={type:p,blueprint:O,template:u,queries:null,viewQuery:_,declTNode:l,data:O.slice().fill(null,I),bindingStartIndex:I,expandoStartIndex:k,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof v?v():v,firstChild:null,schemas:b,consts:j,incompleteFirstPass:!1}}function Mj(p,l,u){for(let f in p)if(p.hasOwnProperty(f)){const g=p[f];(u=null===u?{}:u).hasOwnProperty(f)?u[f].push(l,g):u[f]=[l,g]}return u}function vR(p,l,u,f){let g=!1;if(zU()){const m=function b0e(p,l,u){const f=p.directiveRegistry;let g=null;if(f)for(let m=0;m<f.length;m++){const v=f[m];fj(u,v.selectors,!1)&&(g||(g=[]),O3(PC(u,l),p,v.type),wd(v)?(Nj(p,u),g.unshift(v)):g.push(v))}return g}(p,l,u),v=null===f?null:{"":-1};if(null!==m){g=!0,Bj(u,p.data.length,m.length);for(let I=0;I<m.length;I++){const k=m[I];k.providersResolver&&k.providersResolver(k)}let _=!1,b=!1,S=ey(p,l,m.length,null);for(let I=0;I<m.length;I++){const k=m[I];u.mergedAttrs=R3(u.mergedAttrs,k.hostAttrs),Wj(p,u,l,S,k),w0e(S,k,v),null!==k.contentQueries&&(u.flags|=8),(null!==k.hostBindings||null!==k.hostAttrs||0!==k.hostVars)&&(u.flags|=128);const O=k.type.prototype;!_&&(O.ngOnChanges||O.ngOnInit||O.ngDoCheck)&&((p.preOrderHooks||(p.preOrderHooks=[])).push(u.index),_=!0),!b&&(O.ngOnChanges||O.ngDoCheck)&&((p.preOrderCheckHooks||(p.preOrderCheckHooks=[])).push(u.index),b=!0),S++}!function f0e(p,l){const f=l.directiveEnd,g=p.data,m=l.attrs,v=[];let _=null,b=null;for(let S=l.directiveStart;S<f;S++){const I=g[S],k=I.inputs,O=null===m||hj(l)?null:I0e(k,m);v.push(O),_=Mj(k,S,_),b=Mj(I.outputs,S,b)}null!==_&&(_.hasOwnProperty("class")&&(l.flags|=16),_.hasOwnProperty("style")&&(l.flags|=32)),l.initialInputs=v,l.inputs=_,l.outputs=b}(p,u)}v&&function x0e(p,l,u){if(l){const f=p.localNames=[];for(let g=0;g<l.length;g+=2){const m=u[l[g+1]];if(null==m)throw new br(-301,!1);f.push(l[g],m)}}}(u,f,v)}return u.mergedAttrs=R3(u.mergedAttrs,u.attrs),g}function Fj(p,l,u,f,g,m){const v=m.hostBindings;if(v){let _=p.hostBindingOpCodes;null===_&&(_=p.hostBindingOpCodes=[]);const b=~l.index;(function y0e(p){let l=p.length;for(;l>0;){const u=p[--l];if("number"==typeof u&&u<0)return u}return 0})(_)!=b&&_.push(b),_.push(f,g,v)}}function Lj(p,l){null!==p.hostBindings&&p.hostBindings(1,l)}function Nj(p,l){l.flags|=2,(p.components||(p.components=[])).push(l.index)}function w0e(p,l,u){if(u){if(l.exportAs)for(let f=0;f<l.exportAs.length;f++)u[l.exportAs[f]]=p;wd(l)&&(u[""]=p)}}function Bj(p,l,u){p.flags|=1,p.directiveStart=l,p.directiveEnd=l+u,p.providerIndexes=l}function Wj(p,l,u,f,g){p.data[f]=g;const m=g.factory||(g.factory=Wm(g.type)),v=new DC(m,wd(g),null);p.blueprint[f]=v,u[f]=v,Fj(p,l,0,f,ey(p,u,g.hostVars,mi),g)}function S0e(p,l,u){const f=xu(l,p),g=Aj(u),m=p[10],v=Q3(p,$C(p,g,null,u.onPush?64:16,f,l,m,m.createRenderer(f,u),null,null));p[l.index]=v}function bh(p,l,u,f,g,m){const v=xu(p,l);!function yR(p,l,u,f,g,m,v){if(null==m)as(p)?p.removeAttribute(l,g,u):l.removeAttribute(g);else{const _=null==v?pi(m):v(m,f||"",g);as(p)?p.setAttribute(l,g,_,u):u?l.setAttributeNS(u,g,_):l.setAttribute(g,_)}}(l[11],v,m,p.value,u,f,g)}function T0e(p,l,u,f,g,m){const v=m[l];if(null!==v){const _=f.setInput;for(let b=0;b<v.length;){const S=v[b++],I=v[b++],k=v[b++];null!==_?f.setInput(u,k,S,I):u[I]=k}}}function I0e(p,l){let u=null,f=0;for(;f<l.length;){const g=l[f];if(0!==g)if(5!==g){if("number"==typeof g)break;p.hasOwnProperty(g)&&(null===u&&(u=[]),u.push(g,p[g],l[f+1])),f+=2}else f+=2;else f+=4}return u}function Uj(p,l,u,f){return new Array(p,!0,!1,l,null,0,f,u,null,null)}function A0e(p,l){const u=Tc(l,p);if(f6(u)){const f=u[1];80&u[2]?ty(f,u,f.template,u[8]):u[5]>0&&_R(u)}}function _R(p){for(let f=X6(p);null!==f;f=$6(f))for(let g=10;g<f.length;g++){const m=f[g];if(1024&m[2]){const v=m[1];ty(v,m,v.template,m[8])}else m[5]>0&&_R(m)}const u=p[1].components;if(null!==u)for(let f=0;f<u.length;f++){const g=Tc(u[f],p);f6(g)&&g[5]>0&&_R(g)}}function P0e(p,l){const u=Tc(l,p),f=u[1];(function R0e(p,l){for(let u=l.length;u<p.blueprint.length;u++)l.push(p.blueprint[u])})(f,u),qC(f,u,u[8])}function Q3(p,l){return p[13]?p[14][4]=l:p[13]=l,p[14]=l,l}function CR(p){for(;p;){p[2]|=64;const l=YC(p);if(uge(p)&&!l)return p;p=l}return null}function Vj(p){!function bR(p){for(let l=0;l<p.components.length;l++){const u=p.components[l],f=j6(u),g=f[1];u0e(g,f,g.template,u)}}(p[8])}function wR(p,l,u){_6(0),l(p,u)}const M0e=(()=>Promise.resolve(null))();function jj(p){return p[7]||(p[7]=[])}function Hj(p){return p.cleanup||(p.cleanup=[])}function zj(p,l){const u=p[9],f=u?u.get(zC,null):null;f&&f.handleError(l)}function Yj(p,l,u,f,g){for(let m=0;m<u.length;){const v=u[m++],_=u[m++],b=l[v],S=p.data[v];null!==S.setInput?S.setInput(b,g,f,_):b[_]=g}}function Of(p,l,u){const f=w3(l,p);!function qV(p,l,u){as(p)?p.setValue(l,u):l.textContent=u}(p[11],f,u)}function Z3(p,l,u){let f=u?p.styles:null,g=u?p.classes:null,m=0;if(null!==l)for(let v=0;v<l.length;v++){const _=l[v];"number"==typeof _?m=_:1==m?g=KP(g,_):2==m&&(f=KP(f,_+": "+l[++v]+";"))}u?p.styles=f:p.stylesWithoutHost=f,u?p.classes=g:p.classesWithoutHost=g}const SR=new Yi("INJECTOR",-1);class Xj{get(l,u=LC){if(u===LC){const f=new Error(`NullInjectorError: No provider for ${Wr(l)}!`);throw f.name="NullInjectorError",f}return u}}const TR=new Yi("Set Injector scope."),KC={},L0e={};let IR;function $j(){return void 0===IR&&(IR=new Xj),IR}function qj(p,l=null,u=null,f){const g=Kj(p,l,u,f);return g._resolveInjectorDefTypes(),g}function Kj(p,l=null,u=null,f){return new N0e(p,u,l||$j(),f)}class N0e{constructor(l,u,f,g=null){this.parent=f,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const m=[];u&&yh(u,_=>this.processProvider(_,l,u)),yh([l],_=>this.processInjectorType(_,[],m)),this.records.set(SR,ny(void 0,this));const v=this.records.get(TR);this.scope=null!=v?v.value:null,this.source=g||("object"==typeof l?null:Wr(l))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(l=>l.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(l,u=LC,f=si.Default){this.assertNotDestroyed();const g=CV(this),m=Kp(void 0);try{if(!(f&si.SkipSelf)){let _=this.records.get(l);if(void 0===_){const b=function z0e(p){return"function"==typeof p||"object"==typeof p&&p instanceof Yi}(l)&&QP(l);_=b&&this.injectableDefInScope(b)?ny(ER(l),KC):null,this.records.set(l,_)}if(null!=_)return this.hydrate(l,_)}return(f&si.Self?$j():this.parent).get(l,u=f&si.Optional&&u===LC?null:u)}catch(v){if("NullInjectorError"===v.name){if((v[B3]=v[B3]||[]).unshift(Wr(l)),g)throw v;return function Cme(p,l,u,f){const g=p[B3];throw l[_V]&&g.unshift(l[_V]),p.message=function bme(p,l,u,f=null){p=p&&"\n"===p.charAt(0)&&"\u0275"==p.charAt(1)?p.substr(2):p;let g=Wr(l);if(Array.isArray(l))g=l.map(Wr).join(" -> ");else if("object"==typeof l){let m=[];for(let v in l)if(l.hasOwnProperty(v)){let _=l[v];m.push(v+":"+("string"==typeof _?JSON.stringify(_):Wr(_)))}g=`{${m.join(", ")}}`}return`${u}${f?"("+f+")":""}[${g}]: ${p.replace(pme,"\n  ")}`}("\n"+p.message,g,u,f),p.ngTokenPath=g,p[B3]=null,p}(v,l,"R3InjectorError",this.source)}throw v}finally{Kp(m),CV(g)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(l=>this.get(l))}toString(){const l=[];return this.records.forEach((f,g)=>l.push(Wr(g))),`R3Injector[${l.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new br(205,!1)}processInjectorType(l,u,f){if(!(l=Fi(l)))return!1;let g=AU(l);const m=null==g&&l.ngModule||void 0,v=void 0===m?l:m,_=-1!==f.indexOf(v);if(void 0!==m&&(g=AU(m)),null==g)return!1;if(null!=g.imports&&!_){let I;f.push(v);try{yh(g.imports,k=>{this.processInjectorType(k,u,f)&&(void 0===I&&(I=[]),I.push(k))})}finally{}if(void 0!==I)for(let k=0;k<I.length;k++){const{ngModule:O,providers:j}=I[k];yh(j,W=>this.processProvider(W,O,j||eo))}}this.injectorDefTypes.add(v);const b=Wm(v)||(()=>new v);this.records.set(v,ny(b,KC));const S=g.providers;if(null!=S&&!_){const I=l;yh(S,k=>this.processProvider(k,I,S))}return void 0!==m&&void 0!==l.providers}processProvider(l,u,f){let g=iy(l=Fi(l))?l:Fi(l&&l.provide);const m=function W0e(p,l,u){return Qj(p)?ny(void 0,p.useValue):ny(Jj(p),KC)}(l);if(iy(l)||!0!==l.multi)this.records.get(g);else{let v=this.records.get(g);v||(v=ny(void 0,KC,!0),v.factory=()=>k6(v.multi),this.records.set(g,v)),g=l,v.multi.push(l)}this.records.set(g,m)}hydrate(l,u){return u.value===KC&&(u.value=L0e,u.value=u.factory()),"object"==typeof u.value&&u.value&&function G0e(p){return null!==p&&"object"==typeof p&&"function"==typeof p.ngOnDestroy}(u.value)&&this.onDestroy.add(u.value),u.value}injectableDefInScope(l){if(!l.providedIn)return!1;const u=Fi(l.providedIn);return"string"==typeof u?"any"===u||u===this.scope:this.injectorDefTypes.has(u)}}function ER(p){const l=QP(p),u=null!==l?l.factory:Wm(p);if(null!==u)return u;if(p instanceof Yi)throw new br(204,!1);if(p instanceof Function)return function B0e(p){const l=p.length;if(l>0)throw function FC(p,l){const u=[];for(let f=0;f<p;f++)u.push(l);return u}(l,"?"),new br(204,!1);const u=function Jpe(p){const l=p&&(p[m3]||p[PU]);if(l){const u=function Qpe(p){if(p.hasOwnProperty("name"))return p.name;const l=(""+p).match(/^function\s*([^\s(]+)/);return null===l?"":l[1]}(p);return console.warn(`DEPRECATED: DI is instantiating a token "${u}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${u}" class.`),l}return null}(p);return null!==u?()=>u.factory(p):()=>new p}(p);throw new br(204,!1)}function Jj(p,l,u){let f;if(iy(p)){const g=Fi(p);return Wm(g)||ER(g)}if(Qj(p))f=()=>Fi(p.useValue);else if(function V0e(p){return!(!p||!p.useFactory)}(p))f=()=>p.useFactory(...k6(p.deps||[]));else if(function U0e(p){return!(!p||!p.useExisting)}(p))f=()=>ri(Fi(p.useExisting));else{const g=Fi(p&&(p.useClass||p.provide));if(!function H0e(p){return!!p.deps}(p))return Wm(g)||ER(g);f=()=>new g(...k6(p.deps))}return f}function ny(p,l,u=!1){return{factory:p,value:l,multi:u?[]:void 0}}function Qj(p){return null!==p&&"object"==typeof p&&mme in p}function iy(p){return"function"==typeof p}let ec=(()=>{class p{static create(u,f){var g;if(Array.isArray(u))return qj({name:""},f,u,"");{const m=null!==(g=u.name)&&void 0!==g?g:"";return qj({name:m},u.parent,u.providers,m)}}}return p.THROW_IF_NOT_FOUND=LC,p.NULL=new Xj,p.\u0275prov=ur({token:p,providedIn:"any",factory:()=>ri(SR)}),p.__NG_ELEMENT_ID__=-1,p})();function Z0e(p,l){E3(j6(p)[1],ia())}function Ur(p){let l=function uH(p){return Object.getPrototypeOf(p.prototype).constructor}(p.type),u=!0;const f=[p];for(;l;){let g;if(wd(p))g=l.\u0275cmp||l.\u0275dir;else{if(l.\u0275cmp)throw new br(903,"");g=l.\u0275dir}if(g){if(u){f.push(g);const v=p;v.inputs=PR(p.inputs),v.declaredInputs=PR(p.declaredInputs),v.outputs=PR(p.outputs);const _=g.hostBindings;_&&iye(p,_);const b=g.viewQuery,S=g.contentQueries;if(b&&tye(p,b),S&&nye(p,S),qP(p.inputs,g.inputs),qP(p.declaredInputs,g.declaredInputs),qP(p.outputs,g.outputs),wd(g)&&g.data.animation){const I=p.data;I.animation=(I.animation||[]).concat(g.data.animation)}}const m=g.features;if(m)for(let v=0;v<m.length;v++){const _=m[v];_&&_.ngInherit&&_(p),_===Ur&&(u=!1)}}l=Object.getPrototypeOf(l)}!function eye(p){let l=0,u=null;for(let f=p.length-1;f>=0;f--){const g=p[f];g.hostVars=l+=g.hostVars,g.hostAttrs=R3(g.hostAttrs,u=R3(u,g.hostAttrs))}}(f)}function PR(p){return p===O0?{}:p===eo?[]:p}function tye(p,l){const u=p.viewQuery;p.viewQuery=u?(f,g)=>{l(f,g),u(f,g)}:l}function nye(p,l){const u=p.contentQueries;p.contentQueries=u?(f,g,m)=>{l(f,g,m),u(f,g,m)}:l}function iye(p,l){const u=p.hostBindings;p.hostBindings=u?(f,g)=>{l(f,g),u(f,g)}:l}let eT=null;function ry(){if(!eT){const p=zr.Symbol;if(p&&p.iterator)eT=p.iterator;else{const l=Object.getOwnPropertyNames(Map.prototype);for(let u=0;u<l.length;++u){const f=l[u];"entries"!==f&&"size"!==f&&Map.prototype[f]===Map.prototype.entries&&(eT=f)}}}return eT}function JC(p){return!!function RR(p){return null!==p&&("function"==typeof p||"object"==typeof p)}(p)&&(Array.isArray(p)||!(p instanceof Map)&&ry()in p)}function il(p,l,u){return!Object.is(p[l],u)&&(p[l]=u,!0)}function wh(p,l,u,f){const g=Gt();return il(g,U0(),l)&&(xr(),bh(ls(),g,p,l,u,f)),wh}function rl(p,l,u,f,g,m,v,_){const b=Gt(),S=xr(),I=p+20,k=S.firstCreatePass?function uye(p,l,u,f,g,m,v,_,b){const S=l.consts,I=Z0(l,p,4,v||null,Zp(S,_));vR(l,u,I,Zp(S,b)),E3(l,I);const k=I.tViews=J3(2,I,f,g,m,l.directiveRegistry,l.pipeRegistry,null,l.schemas,S);return null!==l.queries&&(l.queries.template(l,I),k.queries=l.queries.embeddedTView(I)),I}(I,S,b,l,u,f,g,m,v):S.data[I];vh(k,!1);const O=b[11].createComment("");Y3(S,b,O,k),nl(O,b),Q3(b,b[I]=Uj(O,b,O,k)),x3(k)&&gR(S,b,k),null!=v&&mR(b,k,_)}function qt(p,l=si.Default){const u=Gt();return null===u?ri(p,l):cV(ia(),u,Fi(p),l)}function LR(){throw new Error("invalid")}function Dr(p,l,u){const f=Gt();return il(f,U0(),l)&&function Dc(p,l,u,f,g,m,v,_){const b=xu(l,u);let I,S=l.inputs;!_&&null!=S&&(I=S[f])?(Yj(p,u,I,f,g),b3(l)&&function g0e(p,l){const u=Tc(l,p);16&u[2]||(u[2]|=64)}(u,l.index)):3&l.type&&(f=function p0e(p){return"class"===p?"className":"for"===p?"htmlFor":"formaction"===p?"formAction":"innerHtml"===p?"innerHTML":"readonly"===p?"readOnly":"tabindex"===p?"tabIndex":p}(f),g=null!=v?v(g,l.value||"",f):g,as(m)?m.setProperty(b,f,g):x6(f)||(b.setProperty?b.setProperty(f,g):b[f]=g))}(xr(),ls(),f,p,l,f[11],u,!1),Dr}function NR(p,l,u,f,g){const v=g?"class":"style";Yj(p,u,l.inputs[v],v,f)}function Kt(p,l,u,f){const g=Gt(),m=xr(),v=20+p,_=g[11],b=g[v]=K6(_,l,function Hge(){return gi.lFrame.currentNamespace}()),S=m.firstCreatePass?function kye(p,l,u,f,g,m,v){const _=l.consts,S=Z0(l,p,2,g,Zp(_,m));return vR(l,u,S,Zp(_,v)),null!==S.attrs&&Z3(S,S.attrs,!1),null!==S.mergedAttrs&&Z3(S,S.mergedAttrs,!0),null!==l.queries&&l.queries.elementStart(l,S),S}(v,m,g,0,l,u,f):m.data[v];vh(S,!0);const I=S.mergedAttrs;null!==I&&P3(_,b,I);const k=S.classes;null!==k&&nR(_,b,k);const O=S.styles;return null!==O&&cj(_,b,O),64!=(64&S.flags)&&Y3(m,g,b,S),0===function Ige(){return gi.lFrame.elementDepthCount}()&&nl(b,g),function Ege(){gi.lFrame.elementDepthCount++}(),x3(S)&&(gR(m,g,S),function Dj(p,l,u){if(o6(l)){const g=l.directiveEnd;for(let m=l.directiveStart;m<g;m++){const v=p.data[m];v.contentQueries&&v.contentQueries(1,u[m],m)}}}(m,S,g)),null!==f&&mR(g,S),Kt}function zt(){let p=ia();g6()?function m6(){gi.lFrame.isParent=!1}():(p=p.parent,vh(p,!1));const l=p;!function Dge(){gi.lFrame.elementDepthCount--}();const u=xr();return u.firstCreatePass&&(E3(u,p),o6(p)&&u.queries.elementEnd(p)),null!=l.classesWithoutHost&&function $ge(p){return 0!=(16&p.flags)}(l)&&NR(u,l,Gt(),l.classesWithoutHost,!0),null!=l.stylesWithoutHost&&function qge(p){return 0!=(32&p.flags)}(l)&&NR(u,l,Gt(),l.stylesWithoutHost,!1),zt}function dr(p,l,u,f){return Kt(p,l,u,f),zt(),dr}function ZC(p){return!!p&&"function"==typeof p.then}const UR=function RH(p){return!!p&&"function"==typeof p.subscribe};function oi(p,l,u,f){const g=Gt(),m=xr(),v=ia();return function MH(p,l,u,f,g,m,v,_){const b=x3(f),I=p.firstCreatePass&&Hj(p),k=l[8],O=jj(l);let j=!0;if(3&f.type||_){const K=xu(f,l),Q=_?_(K):K,ie=O.length,oe=_?le=>_(Ls(le[f.index])):f.index;if(as(u)){let le=null;if(!_&&b&&(le=function Fye(p,l,u,f){const g=p.cleanup;if(null!=g)for(let m=0;m<g.length-1;m+=2){const v=g[m];if(v===u&&g[m+1]===f){const _=l[7],b=g[m+2];return _.length>b?_[b]:null}"string"==typeof v&&(m+=2)}return null}(p,l,g,f.index)),null!==le)(le.__ngLastListenerFn__||le).__ngNextListenerFn__=m,le.__ngLastListenerFn__=m,j=!1;else{m=VR(f,l,k,m,!1);const he=u.listen(Q,g,m);O.push(m,he),I&&I.push(g,oe,ie,ie+1)}}else m=VR(f,l,k,m,!0),Q.addEventListener(g,m,v),O.push(m),I&&I.push(g,oe,ie,v)}else m=VR(f,l,k,m,!1);const W=f.outputs;let J;if(j&&null!==W&&(J=W[g])){const K=J.length;if(K)for(let Q=0;Q<K;Q+=2){const _e=l[J[Q]][J[Q+1]].subscribe(m),Ve=O.length;O.push(m,_e),I&&I.push(g,f.index,Ve,-(Ve+1))}}}(m,g,g[11],v,p,l,!!u,f),oi}function OH(p,l,u,f){try{return!1!==u(f)}catch(g){return zj(p,g),!1}}function VR(p,l,u,f,g){return function m(v){if(v===Function)return f;const _=2&p.flags?Tc(p.index,l):l;0==(32&l[2])&&CR(_);let b=OH(l,0,f,v),S=m.__ngNextListenerFn__;for(;S;)b=OH(l,0,S,v)&&b,S=S.__ngNextListenerFn__;return g&&!1===b&&(v.preventDefault(),v.returnValue=!1),b}}function Tu(p=1){return function Nge(p){return(gi.lFrame.contextLView=function Bge(p,l){for(;p>0;)l=l[15],p--;return l}(p,gi.lFrame.contextLView))[8]}(p)}function GH(p,l,u,f,g){const m=p[u+1],v=null===l;let _=f?Td(m):Mf(m),b=!1;for(;0!==_&&(!1===b||v);){const I=p[_+1];Vye(p[_],l)&&(b=!0,p[_+1]=f?oR(I):iR(I)),_=f?Td(I):Mf(I)}b&&(p[u+1]=f?iR(m):oR(m))}function Vye(p,l){return null===p||null==l||(Array.isArray(p)?p[1]:p)===l||!(!Array.isArray(p)||"string"!=typeof l)&&$0(p,l)>=0}function iT(p,l){return function Ed(p,l,u,f){const g=Gt(),m=xr(),v=function kf(p){const l=gi.lFrame,u=l.bindingIndex;return l.bindingIndex=l.bindingIndex+p,u}(2);m.firstUpdatePass&&function ZH(p,l,u,f){const g=p.data;if(null===g[u+1]){const m=g[Il()],v=function QH(p,l){return l>=p.expandoStartIndex}(p,u);(function iG(p,l){return 0!=(p.flags&(l?16:32))})(m,f)&&null===l&&!v&&(l=!1),l=function Kye(p,l,u,f){const g=function y6(p){const l=gi.lFrame.currentDirectiveIndex;return-1===l?null:p[l]}(p);let m=f?l.residualClasses:l.residualStyles;if(null===g)0===(f?l.classBindings:l.styleBindings)&&(u=eb(u=HR(null,p,l,u,f),l.attrs,f),m=null);else{const v=l.directiveStylingLast;if(-1===v||p[v]!==g)if(u=HR(g,p,l,u,f),null===m){let b=function Jye(p,l,u){const f=u?l.classBindings:l.styleBindings;if(0!==Mf(f))return p[Td(f)]}(p,l,f);void 0!==b&&Array.isArray(b)&&(b=HR(null,p,l,b[1],f),b=eb(b,l.attrs,f),function Qye(p,l,u,f){p[Td(u?l.classBindings:l.styleBindings)]=f}(p,l,f,b))}else m=function Zye(p,l,u){let f;const g=l.directiveEnd;for(let m=1+l.directiveStylingLast;m<g;m++)f=eb(f,p[m].hostAttrs,u);return eb(f,l.attrs,u)}(p,l,f)}return void 0!==m&&(f?l.residualClasses=m:l.residualStyles=m),u}(g,m,l,f),function Wye(p,l,u,f,g,m){let v=m?l.classBindings:l.styleBindings,_=Td(v),b=Mf(v);p[f]=u;let I,S=!1;if(Array.isArray(u)){const k=u;I=k[1],(null===I||$0(k,I)>0)&&(S=!0)}else I=u;if(g)if(0!==b){const O=Td(p[_+1]);p[f+1]=$3(O,_),0!==O&&(p[O+1]=rR(p[O+1],f)),p[_+1]=function Jve(p,l){return 131071&p|l<<17}(p[_+1],f)}else p[f+1]=$3(_,0),0!==_&&(p[_+1]=rR(p[_+1],f)),_=f;else p[f+1]=$3(b,0),0===_?_=f:p[b+1]=rR(p[b+1],f),b=f;S&&(p[f+1]=iR(p[f+1])),GH(p,I,f,!0),GH(p,I,f,!1),function Uye(p,l,u,f,g){const m=g?p.residualClasses:p.residualStyles;null!=m&&"string"==typeof l&&$0(m,l)>=0&&(u[f+1]=oR(u[f+1]))}(l,I,p,f,m),v=$3(_,b),m?l.classBindings=v:l.styleBindings=v}(g,m,l,u,v,f)}}(m,p,v,f),l!==mi&&il(g,v,l)&&function tG(p,l,u,f,g,m,v,_){if(!(3&l.type))return;const b=p.data,S=b[_+1];rT(function yj(p){return 1==(1&p)}(S)?nG(b,l,u,g,Mf(S),v):void 0)||(rT(m)||function vj(p){return 2==(2&p)}(S)&&(m=nG(b,null,u,g,_,v)),function Wve(p,l,u,f,g){const m=as(p);if(l)g?m?p.addClass(u,f):u.classList.add(f):m?p.removeClass(u,f):u.classList.remove(f);else{let v=-1===f.indexOf("-")?void 0:Ec.DashCase;if(null==g)m?p.removeStyle(u,f,v):u.style.removeProperty(f);else{const _="string"==typeof g&&g.endsWith("!important");_&&(g=g.slice(0,-10),v|=Ec.Important),m?p.setStyle(u,f,g,v):u.style.setProperty(f,g,_?"important":"")}}}(f,v,w3(Il(),u),g,m))}(m,m.data[Il()],g,g[11],p,g[v+1]=function n_e(p,l){return null==p||("string"==typeof l?p+=l:"object"==typeof p&&(p=Wr(ig(p)))),p}(l,u),f,v)}(p,l,null,!0),iT}function HR(p,l,u,f,g){let m=null;const v=u.directiveEnd;let _=u.directiveStylingLast;for(-1===_?_=u.directiveStart:_++;_<v&&(m=l[_],f=eb(f,m.hostAttrs,g),m!==p);)_++;return null!==p&&(u.directiveStylingLast=_),f}function eb(p,l,u){const f=u?1:2;let g=-1;if(null!==l)for(let m=0;m<l.length;m++){const v=l[m];"number"==typeof v?g=v:g===f&&(Array.isArray(p)||(p=void 0===p?[]:["",p]),Ic(p,v,!!u||l[++m]))}return void 0===p?null:p}function nG(p,l,u,f,g,m){const v=null===l;let _;for(;g>0;){const b=p[g],S=Array.isArray(b),I=S?b[1]:b,k=null===I;let O=u[g+1];O===mi&&(O=k?eo:void 0);let j=k?A6(O,f):I===f?O:void 0;if(S&&!rT(j)&&(j=A6(b,f)),rT(j)&&(_=j,v))return _;const W=p[g+1];g=v?Td(W):Mf(W)}if(null!==l){let b=m?l.residualClasses:l.residualStyles;null!=b&&(_=A6(b,f))}return _}function rT(p){return void 0!==p}function Nn(p,l=""){const u=Gt(),f=xr(),g=p+20,m=f.firstCreatePass?Z0(f,g,1,l,null):f.data[g],v=u[g]=function q6(p,l){return as(p)?p.createText(l):p.createTextNode(l)}(u[11],l);Y3(f,u,v,m),vh(m,!1)}function Ac(p,l,u){const f=Gt(),g=function sy(p,l,u,f){return il(p,U0(),u)?l+pi(u)+f:mi}(f,p,l,u);return g!==mi&&Of(f,Il(),g),Ac}const oT="en-US";let IG=oT;function YR(p,l,u,f,g){if(p=Fi(p),Array.isArray(p))for(let m=0;m<p.length;m++)YR(p[m],l,u,f,g);else{const m=xr(),v=Gt();let _=iy(p)?p:Fi(p.provide),b=Jj(p);const S=ia(),I=1048575&S.providerIndexes,k=S.directiveStart,O=S.providerIndexes>>20;if(iy(p)||!p.multi){const j=new DC(b,g,qt),W=$R(_,l,g?I:I+O,k);-1===W?(O3(PC(S,v),m,_),XR(m,p,l.length),l.push(_),S.directiveStart++,S.directiveEnd++,g&&(S.providerIndexes+=1048576),u.push(j),v.push(j)):(u[W]=j,v[W]=j)}else{const j=$R(_,l,I+O,k),W=$R(_,l,I,I+O),J=j>=0&&u[j],K=W>=0&&u[W];if(g&&!K||!g&&!J){O3(PC(S,v),m,_);const Q=function b1e(p,l,u,f,g){const m=new DC(p,u,qt);return m.multi=[],m.index=l,m.componentProviders=0,KG(m,g,f&&!u),m}(g?C1e:_1e,u.length,g,f,b);!g&&K&&(u[W].providerFactory=Q),XR(m,p,l.length,0),l.push(_),S.directiveStart++,S.directiveEnd++,g&&(S.providerIndexes+=1048576),u.push(Q),v.push(Q)}else XR(m,p,j>-1?j:W,KG(u[g?W:j],b,!g&&f));!g&&f&&K&&u[W].componentProviders++}}}function XR(p,l,u,f){const g=iy(l),m=function j0e(p){return!!p.useClass}(l);if(g||m){const b=(m?Fi(l.useClass):l).prototype.ngOnDestroy;if(b){const S=p.destroyHooks||(p.destroyHooks=[]);if(!g&&l.multi){const I=S.indexOf(u);-1===I?S.push(u,[f,b]):S[I+1].push(f,b)}else S.push(u,b)}}}function KG(p,l,u){return u&&p.componentProviders++,p.multi.push(l)-1}function $R(p,l,u,f){for(let g=u;g<f;g++)if(l[g]===p)return g;return-1}function _1e(p,l,u,f){return qR(this.multi,[])}function C1e(p,l,u,f){const g=this.multi;let m;if(this.providerFactory){const v=this.providerFactory.componentProviders,_=RC(u,u[1],this.providerFactory.index,f);m=_.slice(0,v),qR(g,m);for(let b=v;b<_.length;b++)m.push(_[b])}else m=[],qR(g,m);return m}function qR(p,l){for(let u=0;u<p.length;u++)l.push((0,p[u])());return l}function ko(p,l=[]){return u=>{u.providersResolver=(f,g)=>function y1e(p,l,u){const f=xr();if(f.firstCreatePass){const g=wd(p);YR(u,f.data,f.blueprint,g,!0),YR(l,f.data,f.blueprint,g,!1)}}(f,g?g(p):p,l)}}class JG{}class S1e{resolveComponentFactory(l){throw function w1e(p){const l=Error(`No component factory found for ${Wr(p)}. Did you add it to @NgModule.entryComponents?`);return l.ngComponent=p,l}(l)}}let ob=(()=>{class p{}return p.NULL=new S1e,p})();function T1e(){return yy(ia(),Gt())}function yy(p,l){return new Pc(xu(p,l))}let Pc=(()=>{class p{constructor(u){this.nativeElement=u}}return p.__NG_ELEMENT_ID__=T1e,p})();class ZG{}let Ff=(()=>{class p{}return p.__NG_ELEMENT_ID__=()=>function D1e(){const p=Gt(),u=Tc(ia().index,p);return function E1e(p){return p[11]}(mh(u)?u:p)}(),p})(),A1e=(()=>{class p{}return p.\u0275prov=ur({token:p,providedIn:"root",factory:()=>null}),p})();class sb{constructor(l){this.full=l,this.major=l.split(".")[0],this.minor=l.split(".")[1],this.patch=l.split(".").slice(2).join(".")}}const P1e=new sb("13.3.10"),KR={};function uT(p,l,u,f,g=!1){for(;null!==u;){const m=l[u.index];if(null!==m&&f.push(Ls(m)),xd(m))for(let _=10;_<m.length;_++){const b=m[_],S=b[1].firstChild;null!==S&&uT(b[1],b,S,f)}const v=u.type;if(8&v)uT(p,l,u.child,f);else if(32&v){const _=Y6(u,l);let b;for(;b=_();)f.push(b)}else if(16&v){const _=sj(l,u);if(Array.isArray(_))f.push(..._);else{const b=YC(l[16]);uT(b[1],b,_,f,!0)}}u=g?u.projectionNext:u.next}return f}class ab{constructor(l,u){this._lView=l,this._cdRefInjectingView=u,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const l=this._lView,u=l[1];return uT(u,l,u.firstChild,[])}get context(){return this._lView[8]}set context(l){this._lView[8]=l}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const l=this._lView[3];if(xd(l)){const u=l[8],f=u?u.indexOf(this):-1;f>-1&&(J6(l,f),L3(u,f))}this._attachedToViewContainer=!1}JV(this._lView[1],this._lView)}onDestroy(l){!function kj(p,l,u,f){const g=jj(l);null===u?g.push(f):(g.push(u),p.firstCreatePass&&Hj(p).push(f,g.length-1))}(this._lView[1],this._lView,null,l)}markForCheck(){CR(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function xR(p,l,u){const f=l[10];f.begin&&f.begin();try{ty(p,l,p.template,u)}catch(g){throw zj(l,g),g}finally{f.end&&f.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new br(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Ave(p,l){XC(p,l,l[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(l){if(this._attachedToViewContainer)throw new br(902,"");this._appRef=l}}class R1e extends ab{constructor(l){super(l),this._view=l}detectChanges(){Vj(this._view)}checkNoChanges(){}get context(){return null}}class ez extends ob{constructor(l){super(),this.ngModule=l}resolveComponentFactory(l){const u=Za(l);return new JR(u,this.ngModule)}}function tz(p){const l=[];for(let u in p)p.hasOwnProperty(u)&&l.push({propName:p[u],templateName:u});return l}class JR extends JG{constructor(l,u){super(),this.componentDef=l,this.ngModule=u,this.componentType=l.type,this.selector=function qve(p){return p.map($ve).join(",")}(l.selectors),this.ngContentSelectors=l.ngContentSelectors?l.ngContentSelectors:[],this.isBoundToModule=!!u}get inputs(){return tz(this.componentDef.inputs)}get outputs(){return tz(this.componentDef.outputs)}create(l,u,f,g){const m=(g=g||this.ngModule)?function M1e(p,l){return{get:(u,f,g)=>{const m=p.get(u,KR,g);return m!==KR||f===KR?m:l.get(u,f,g)}}}(l,g.injector):l,v=m.get(ZG,VU),_=m.get(A1e,null),b=v.createRenderer(null,this.componentDef),S=this.componentDef.selectors[0][0]||"div",I=f?function Rj(p,l,u){if(as(p))return p.selectRootElement(l,u===ph.ShadowDom);let f="string"==typeof l?p.querySelector(l):l;return f.textContent="",f}(b,f,this.componentDef.encapsulation):K6(v.createRenderer(null,this.componentDef),S,function k1e(p){const l=p.toLowerCase();return"svg"===l?"svg":"math"===l?"math":null}(S)),k=this.componentDef.onPush?576:528,O=function cH(p,l){return{components:[],scheduler:p||bve,clean:M0e,playerHandler:l||null,flags:0}}(),j=J3(0,null,null,1,0,null,null,null,null,null),W=$C(null,j,O,k,null,null,v,b,_,m);let J,K;T3(W);try{const Q=function aH(p,l,u,f,g,m){const v=u[1];u[20]=p;const b=Z0(v,20,2,"#host",null),S=b.mergedAttrs=l.hostAttrs;null!==S&&(Z3(b,S,!0),null!==p&&(P3(g,p,S),null!==b.classes&&nR(g,p,b.classes),null!==b.styles&&cj(g,p,b.styles)));const I=f.createRenderer(p,l),k=$C(u,Aj(l),null,l.onPush?64:16,u[20],b,f,I,m||null,null);return v.firstCreatePass&&(O3(PC(b,u),v,l.type),Nj(v,b),Bj(b,u.length,1)),Q3(u,k),u[20]=k}(I,this.componentDef,W,v,b);if(I)if(f)P3(b,I,["ng-version",P1e.full]);else{const{attrs:ie,classes:oe}=function Kve(p){const l=[],u=[];let f=1,g=2;for(;f<p.length;){let m=p[f];if("string"==typeof m)2===g?""!==m&&l.push(m,p[++f]):8===g&&u.push(m);else{if(!Sd(g))break;g=m}f++}return{attrs:l,classes:u}}(this.componentDef.selectors[0]);ie&&P3(b,I,ie),oe&&oe.length>0&&nR(b,I,oe.join(" "))}if(K=h6(j,20),void 0!==u){const ie=K.projection=[];for(let oe=0;oe<this.ngContentSelectors.length;oe++){const le=u[oe];ie.push(null!=le?Array.from(le):null)}}J=function lH(p,l,u,f,g){const m=u[1],v=function v0e(p,l,u){const f=ia();p.firstCreatePass&&(u.providersResolver&&u.providersResolver(u),Wj(p,f,l,ey(p,l,1,null),u));const g=RC(l,p,f.directiveStart,f);nl(g,l);const m=xu(f,l);return m&&nl(m,l),g}(m,u,l);if(f.components.push(v),p[8]=v,g&&g.forEach(b=>b(v,l)),l.contentQueries){const b=ia();l.contentQueries(1,v,b.directiveStart)}const _=ia();return!m.firstCreatePass||null===l.hostBindings&&null===l.hostAttrs||(eg(_.index),Fj(u[1],_,0,_.directiveStart,_.directiveEnd,l),Lj(l,v)),v}(Q,this.componentDef,W,O,[Z0e]),qC(j,W,null)}finally{I3()}return new F1e(this.componentType,J,yy(K,W),W,K)}}class F1e extends class x1e{}{constructor(l,u,f,g,m){super(),this.location=f,this._rootLView=g,this._tNode=m,this.instance=u,this.hostView=this.changeDetectorRef=new R1e(g),this.componentType=l}get injector(){return new H0(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(l){this.hostView.onDestroy(l)}}class Lf{}class nz{}const _y=new Map;class oz extends Lf{constructor(l,u){super(),this._parent=u,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new ez(this);const f=yu(l);this._bootstrapComponents=Ch(f.bootstrap),this._r3Injector=Kj(l,u,[{provide:Lf,useValue:this},{provide:ob,useValue:this.componentFactoryResolver}],Wr(l)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(l)}get(l,u=ec.THROW_IF_NOT_FOUND,f=si.Default){return l===ec||l===Lf||l===SR?this:this._r3Injector.get(l,u,f)}destroy(){const l=this._r3Injector;!l.destroyed&&l.destroy(),this.destroyCbs.forEach(u=>u()),this.destroyCbs=null}onDestroy(l){this.destroyCbs.push(l)}}class QR extends nz{constructor(l){super(),this.moduleType=l,null!==yu(l)&&function N1e(p){const l=new Set;!function u(f){const g=yu(f,!0),m=g.id;null!==m&&(function iz(p,l,u){if(l&&l!==u)throw new Error(`Duplicate module registered for ${p} - ${Wr(l)} vs ${Wr(l.name)}`)}(m,_y.get(m),f),_y.set(m,f));const v=Ch(g.imports);for(const _ of v)l.has(_)||(l.add(_),u(_))}(p)}(l)}create(l){return new oz(this.moduleType,l)}}function Ad(p,l,u){const f=function Tl(){const p=gi.lFrame;let l=p.bindingRootIndex;return-1===l&&(l=p.bindingRootIndex=p.tView.bindingStartIndex),l}()+p,g=Gt();return g[f]===mi?function xh(p,l,u){return p[l]=u}(g,f,u?l.call(u):l()):function QC(p,l){return p[l]}(g,f)}function ZR(p){return l=>{setTimeout(p,void 0,l)}}const us=class eCe extends If{constructor(l=!1){super(),this.__isAsync=l}emit(l){super.next(l)}subscribe(l,u,f){var g,m,v;let _=l,b=u||(()=>null),S=f;if(l&&"object"==typeof l){const k=l;_=null===(g=k.next)||void 0===g?void 0:g.bind(k),b=null===(m=k.error)||void 0===m?void 0:m.bind(k),S=null===(v=k.complete)||void 0===v?void 0:v.bind(k)}this.__isAsync&&(b=ZR(b),_&&(_=ZR(_)),S&&(S=ZR(S)));const I=super.subscribe({next:_,error:b,complete:S});return l instanceof vu&&l.add(I),I}};Symbol;let Nf=(()=>{class p{}return p.__NG_ELEMENT_ID__=rCe,p})();const nCe=Nf,iCe=class extends nCe{constructor(l,u,f){super(),this._declarationLView=l,this._declarationTContainer=u,this.elementRef=f}createEmbeddedView(l){const u=this._declarationTContainer.tViews,f=$C(this._declarationLView,u,l,16,null,u.declTNode,null,null,null,null);f[17]=this._declarationLView[this._declarationTContainer.index];const m=this._declarationLView[19];return null!==m&&(f[19]=m.createEmbeddedView(u)),qC(u,f,l),new ab(f)}};function rCe(){return function dT(p,l){return 4&p.type?new iCe(l,p,yy(p,l)):null}(ia(),Gt())}let Pd=(()=>{class p{}return p.__NG_ELEMENT_ID__=oCe,p})();function oCe(){return function fz(p,l){let u;const f=l[p.index];if(xd(f))u=f;else{let g;if(8&p.type)g=Ls(f);else{const m=l[11];g=m.createComment("");const v=xu(p,l);Um(m,z3(m,v),g,function Lve(p,l){return as(p)?p.nextSibling(l):l.nextSibling}(m,v),!1)}l[p.index]=u=Uj(f,l,g,p),Q3(l,u)}return new dz(u,p,l)}(ia(),Gt())}const sCe=Pd,dz=class extends sCe{constructor(l,u,f){super(),this._lContainer=l,this._hostTNode=u,this._hostLView=f}get element(){return yy(this._hostTNode,this._hostLView)}get injector(){return new H0(this._hostTNode,this._hostLView)}get parentInjector(){const l=M3(this._hostTNode,this._hostLView);if(rV(l)){const u=j0(l,this._hostLView),f=V0(l);return new H0(u[1].data[f+8],u)}return new H0(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(l){const u=hz(this._lContainer);return null!==u&&u[l]||null}get length(){return this._lContainer.length-10}createEmbeddedView(l,u,f){const g=l.createEmbeddedView(u||{});return this.insert(g,f),g}createComponent(l,u,f,g,m){const v=l&&!function OC(p){return"function"==typeof p}(l);let _;if(v)_=u;else{const k=u||{};_=k.index,f=k.injector,g=k.projectableNodes,m=k.ngModuleRef}const b=v?l:new JR(Za(l)),S=f||this.parentInjector;if(!m&&null==b.ngModule){const O=(v?S:this.parentInjector).get(Lf,null);O&&(m=O)}const I=b.create(S,g,void 0,m);return this.insert(I.hostView,_),I}insert(l,u){const f=l._lView,g=f[1];if(function Tge(p){return xd(p[3])}(f)){const I=this.indexOf(l);if(-1!==I)this.detach(I);else{const k=f[3],O=new dz(k,k[6],k[3]);O.detach(O.indexOf(l))}}const m=this._adjustIndex(u),v=this._lContainer;!function Rve(p,l,u,f){const g=10+f,m=u.length;f>0&&(u[g-1][4]=l),f<m-10?(l[4]=u[g],pV(u,10+f,l)):(u.push(l),l[4]=null),l[3]=u;const v=l[17];null!==v&&u!==v&&function kve(p,l){const u=p[9];l[16]!==l[3][3][16]&&(p[2]=!0),null===u?p[9]=[l]:u.push(l)}(v,l);const _=l[19];null!==_&&_.insertView(p),l[2]|=128}(g,f,v,m);const _=eR(m,v),b=f[11],S=z3(b,v[7]);return null!==S&&function Dve(p,l,u,f,g,m){f[0]=g,f[6]=l,XC(p,f,u,1,g,m)}(g,v[6],b,f,S,_),l.attachToViewContainerRef(),pV(tk(v),m,l),l}move(l,u){return this.insert(l,u)}indexOf(l){const u=hz(this._lContainer);return null!==u?u.indexOf(l):-1}remove(l){const u=this._adjustIndex(l,-1),f=J6(this._lContainer,u);f&&(L3(tk(this._lContainer),u),JV(f[1],f))}detach(l){const u=this._adjustIndex(l,-1),f=J6(this._lContainer,u);return f&&null!=L3(tk(this._lContainer),u)?new ab(f):null}_adjustIndex(l,u=0){return null==l?this.length+u:l}};function hz(p){return p[8]}function tk(p){return p[8]||(p[8]=[])}function pT(...p){}const gk=new Yi("Application Initializer");let mk=(()=>{class p{constructor(u){this.appInits=u,this.resolve=pT,this.reject=pT,this.initialized=!1,this.done=!1,this.donePromise=new Promise((f,g)=>{this.resolve=f,this.reject=g})}runInitializers(){if(this.initialized)return;const u=[],f=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let g=0;g<this.appInits.length;g++){const m=this.appInits[g]();if(ZC(m))u.push(m);else if(UR(m)){const v=new Promise((_,b)=>{m.subscribe({complete:_,error:b})});u.push(v)}}Promise.all(u).then(()=>{f()}).catch(g=>{this.reject(g)}),0===u.length&&f(),this.initialized=!0}}return p.\u0275fac=function(u){return new(u||p)(ri(gk,8))},p.\u0275prov=ur({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();const db=new Yi("AppId",{providedIn:"root",factory:function Fz(){return`${vk()}${vk()}${vk()}`}});function vk(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Lz=new Yi("Platform Initializer"),Nz=new Yi("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Bz=new Yi("appBootstrapListener");let MCe=(()=>{class p{log(u){console.log(u)}warn(u){console.warn(u)}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=ur({token:p,factory:p.\u0275fac,providedIn:"platform"}),p})();const sg=new Yi("LocaleId",{providedIn:"root",factory:()=>yme(sg,si.Optional|si.SkipSelf)||function OCe(){return"undefined"!=typeof $localize&&$localize.locale||oT}()});class LCe{constructor(l,u){this.ngModuleFactory=l,this.componentFactories=u}}let Wz=(()=>{class p{compileModuleSync(u){return new QR(u)}compileModuleAsync(u){return Promise.resolve(this.compileModuleSync(u))}compileModuleAndAllComponentsSync(u){const f=this.compileModuleSync(u),m=Ch(yu(u).declarations).reduce((v,_)=>{const b=Za(_);return b&&v.push(new JR(b)),v},[]);return new LCe(f,m)}compileModuleAndAllComponentsAsync(u){return Promise.resolve(this.compileModuleAndAllComponentsSync(u))}clearCache(){}clearCacheFor(u){}getModuleId(u){}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=ur({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();const BCe=(()=>Promise.resolve(0))();function yk(p){"undefined"==typeof Zone?BCe.then(()=>{p&&p.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",p)}class Aa{constructor({enableLongStackTrace:l=!1,shouldCoalesceEventChangeDetection:u=!1,shouldCoalesceRunChangeDetection:f=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new us(!1),this.onMicrotaskEmpty=new us(!1),this.onStable=new us(!1),this.onError=new us(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const g=this;g._nesting=0,g._outer=g._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),l&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!f&&u,g.shouldCoalesceRunChangeDetection=f,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=function WCe(){let p=zr.requestAnimationFrame,l=zr.cancelAnimationFrame;if("undefined"!=typeof Zone&&p&&l){const u=p[Zone.__symbol__("OriginalDelegate")];u&&(p=u);const f=l[Zone.__symbol__("OriginalDelegate")];f&&(l=f)}return{nativeRequestAnimationFrame:p,nativeCancelAnimationFrame:l}}().nativeRequestAnimationFrame,function jCe(p){const l=()=>{!function VCe(p){p.isCheckStableRunning||-1!==p.lastRequestAnimationFrameId||(p.lastRequestAnimationFrameId=p.nativeRequestAnimationFrame.call(zr,()=>{p.fakeTopEventTask||(p.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{p.lastRequestAnimationFrameId=-1,Ck(p),p.isCheckStableRunning=!0,_k(p),p.isCheckStableRunning=!1},void 0,()=>{},()=>{})),p.fakeTopEventTask.invoke()}),Ck(p))}(p)};p._inner=p._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(u,f,g,m,v,_)=>{try{return Uz(p),u.invokeTask(g,m,v,_)}finally{(p.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||p.shouldCoalesceRunChangeDetection)&&l(),Vz(p)}},onInvoke:(u,f,g,m,v,_,b)=>{try{return Uz(p),u.invoke(g,m,v,_,b)}finally{p.shouldCoalesceRunChangeDetection&&l(),Vz(p)}},onHasTask:(u,f,g,m)=>{u.hasTask(g,m),f===g&&("microTask"==m.change?(p._hasPendingMicrotasks=m.microTask,Ck(p),_k(p)):"macroTask"==m.change&&(p.hasPendingMacrotasks=m.macroTask))},onHandleError:(u,f,g,m)=>(u.handleError(g,m),p.runOutsideAngular(()=>p.onError.emit(m)),!1)})}(g)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Aa.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Aa.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(l,u,f){return this._inner.run(l,u,f)}runTask(l,u,f,g){const m=this._inner,v=m.scheduleEventTask("NgZoneEvent: "+g,l,UCe,pT,pT);try{return m.runTask(v,u,f)}finally{m.cancelTask(v)}}runGuarded(l,u,f){return this._inner.runGuarded(l,u,f)}runOutsideAngular(l){return this._outer.run(l)}}const UCe={};function _k(p){if(0==p._nesting&&!p.hasPendingMicrotasks&&!p.isStable)try{p._nesting++,p.onMicrotaskEmpty.emit(null)}finally{if(p._nesting--,!p.hasPendingMicrotasks)try{p.runOutsideAngular(()=>p.onStable.emit(null))}finally{p.isStable=!0}}}function Ck(p){p.hasPendingMicrotasks=!!(p._hasPendingMicrotasks||(p.shouldCoalesceEventChangeDetection||p.shouldCoalesceRunChangeDetection)&&-1!==p.lastRequestAnimationFrameId)}function Uz(p){p._nesting++,p.isStable&&(p.isStable=!1,p.onUnstable.emit(null))}function Vz(p){p._nesting--,_k(p)}class HCe{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new us,this.onMicrotaskEmpty=new us,this.onStable=new us,this.onError=new us}run(l,u,f){return l.apply(u,f)}runGuarded(l,u,f){return l.apply(u,f)}runOutsideAngular(l){return l()}runTask(l,u,f,g){return l.apply(u,f)}}let bk=(()=>{class p{constructor(u){this._ngZone=u,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),u.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Aa.assertNotInAngularZone(),yk(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())yk(()=>{for(;0!==this._callbacks.length;){let u=this._callbacks.pop();clearTimeout(u.timeoutId),u.doneCb(this._didWork)}this._didWork=!1});else{let u=this.getPendingTasks();this._callbacks=this._callbacks.filter(f=>!f.updateCb||!f.updateCb(u)||(clearTimeout(f.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(u=>({source:u.source,creationLocation:u.creationLocation,data:u.data})):[]}addCallback(u,f,g){let m=-1;f&&f>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(v=>v.timeoutId!==m),u(this._didWork,this.getPendingTasks())},f)),this._callbacks.push({doneCb:u,timeoutId:m,updateCb:g})}whenStable(u,f,g){if(g&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(u,f,g),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(u,f,g){return[]}}return p.\u0275fac=function(u){return new(u||p)(ri(Aa))},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})(),GCe=(()=>{class p{constructor(){this._applications=new Map,xk.addToWindow(this)}registerApplication(u,f){this._applications.set(u,f)}unregisterApplication(u){this._applications.delete(u)}unregisterAllApplications(){this._applications.clear()}getTestability(u){return this._applications.get(u)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(u,f=!0){return xk.findTestabilityInTree(this,u,f)}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=ur({token:p,factory:p.\u0275fac,providedIn:"platform"}),p})();class zCe{addToWindow(l){}findTestabilityInTree(l,u,f){return null}}let xk=new zCe,Hm=null;const jz=new Yi("AllowMultipleToken"),Hz=new Yi("PlatformOnDestroy");class Gz{constructor(l,u){this.name=l,this.token=u}}function zz(p,l,u=[]){const f=`Platform: ${l}`,g=new Yi(f);return(m=[])=>{let v=wk();if(!v||v.injector.get(jz,!1)){const _=[...u,...m,{provide:g,useValue:!0}];p?p(_):function qCe(p){if(Hm&&!Hm.get(jz,!1))throw new br(400,"");Hm=p;const l=p.get(Yz),u=p.get(Lz,null);u&&u.forEach(f=>f())}(function JCe(p=[],l){return ec.create({name:l,providers:[{provide:TR,useValue:"platform"},{provide:Hz,useValue:()=>Hm=null},...p]})}(_,f))}return function KCe(p){const l=wk();if(!l)throw new br(401,"");return l}()}}function wk(){var p;return null!==(p=null==Hm?void 0:Hm.get(Yz))&&void 0!==p?p:null}let Yz=(()=>{class p{constructor(u){this._injector=u,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(u,f){const _=function QCe(p,l){let u;return u="noop"===p?new HCe:("zone.js"===p?void 0:p)||new Aa({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==l?void 0:l.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==l?void 0:l.ngZoneRunCoalescing)}),u}(f?f.ngZone:void 0,{ngZoneEventCoalescing:f&&f.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:f&&f.ngZoneRunCoalescing||!1}),b=[{provide:Aa,useValue:_}];return _.run(()=>{const S=ec.create({providers:b,parent:this.injector,name:u.moduleType.name}),I=u.create(S),k=I.injector.get(zC,null);if(!k)throw new br(402,"");return _.runOutsideAngular(()=>{const O=_.onError.subscribe({next:j=>{k.handleError(j)}});I.onDestroy(()=>{Tk(this._modules,I),O.unsubscribe()})}),function ZCe(p,l,u){try{const f=u();return ZC(f)?f.catch(g=>{throw l.runOutsideAngular(()=>p.handleError(g)),g}):f}catch(f){throw l.runOutsideAngular(()=>p.handleError(f)),f}}(k,_,()=>{const O=I.injector.get(mk);return O.runInitializers(),O.donePromise.then(()=>(function E_e(p){wc(p,"Expected localeId to be defined"),"string"==typeof p&&(IG=p.toLowerCase().replace(/_/g,"-"))}(I.injector.get(sg,oT)||oT),this._moduleDoBootstrap(I),I))})})}bootstrapModule(u,f=[]){const g=Xz({},f);return function XCe(p,l,u){const f=new QR(u);return Promise.resolve(f)}(0,0,u).then(m=>this.bootstrapModuleFactory(m,g))}_moduleDoBootstrap(u){const f=u.injector.get(Sk);if(u._bootstrapComponents.length>0)u._bootstrapComponents.forEach(g=>f.bootstrap(g));else{if(!u.instance.ngDoBootstrap)throw new br(403,"");u.instance.ngDoBootstrap(f)}this._modules.push(u)}onDestroy(u){this._destroyListeners.push(u)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new br(404,"");this._modules.slice().forEach(f=>f.destroy()),this._destroyListeners.forEach(f=>f());const u=this._injector.get(Hz,null);null==u||u(),this._destroyed=!0}get destroyed(){return this._destroyed}}return p.\u0275fac=function(u){return new(u||p)(ri(ec))},p.\u0275prov=ur({token:p,factory:p.\u0275fac,providedIn:"platform"}),p})();function Xz(p,l){return Array.isArray(l)?l.reduce(Xz,p):Object.assign(Object.assign({},p),l)}let Sk=(()=>{class p{constructor(u,f,g,m){this._zone=u,this._injector=f,this._exceptionHandler=g,this._initStatus=m,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const v=new Fs(b=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{b.next(this._stable),b.complete()})}),_=new Fs(b=>{let S;this._zone.runOutsideAngular(()=>{S=this._zone.onStable.subscribe(()=>{Aa.assertNotInAngularZone(),yk(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,b.next(!0))})})});const I=this._zone.onUnstable.subscribe(()=>{Aa.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{b.next(!1)}))});return()=>{S.unsubscribe(),I.unsubscribe()}});this.isStable=function Gpe(...p){const l=xC(p),u=function Npe(p,l){return"number"==typeof XP(p)?p.pop():l}(p,1/0),f=p;return f.length?1===f.length?fh(f[0]):bC(u)(va(f,l)):Df}(v,_.pipe(function zpe(p={}){const{connector:l=(()=>new If),resetOnError:u=!0,resetOnComplete:f=!0,resetOnRefCountZero:g=!0}=p;return m=>{let v=null,_=null,b=null,S=0,I=!1,k=!1;const O=()=>{null==_||_.unsubscribe(),_=null},j=()=>{O(),v=b=null,I=k=!1},W=()=>{const J=v;j(),null==J||J.unsubscribe()};return Ea((J,K)=>{S++,!k&&!I&&O();const Q=b=null!=b?b:l();K.add(()=>{S--,0===S&&!k&&!I&&(_=$P(W,g))}),Q.subscribe(K),v||(v=new h3({next:ie=>Q.next(ie),error:ie=>{k=!0,O(),_=$P(j,u,ie),Q.error(ie)},complete:()=>{I=!0,O(),_=$P(j,f),Q.complete()}}),va(J).subscribe(v))})(m)}}()))}bootstrap(u,f){if(!this._initStatus.done)throw new br(405,"");let g;g=u instanceof JG?u:this._injector.get(ob).resolveComponentFactory(u),this.componentTypes.push(g.componentType);const m=function $Ce(p){return p.isBoundToModule}(g)?void 0:this._injector.get(Lf),_=g.create(ec.NULL,[],f||g.selector,m),b=_.location.nativeElement,S=_.injector.get(bk,null),I=S&&_.injector.get(GCe);return S&&I&&I.registerApplication(b,S),_.onDestroy(()=>{this.detachView(_.hostView),Tk(this.components,_),I&&I.unregisterApplication(b)}),this._loadComponent(_),_}tick(){if(this._runningTick)throw new br(101,"");try{this._runningTick=!0;for(let u of this._views)u.detectChanges()}catch(u){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(u))}finally{this._runningTick=!1}}attachView(u){const f=u;this._views.push(f),f.attachToAppRef(this)}detachView(u){const f=u;Tk(this._views,f),f.detachFromAppRef()}_loadComponent(u){this.attachView(u.hostView),this.tick(),this.components.push(u),this._injector.get(Bz,[]).concat(this._bootstrapListeners).forEach(g=>g(u))}ngOnDestroy(){this._views.slice().forEach(u=>u.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return p.\u0275fac=function(u){return new(u||p)(ri(Aa),ri(ec),ri(zC),ri(mk))},p.\u0275prov=ur({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();function Tk(p,l){const u=p.indexOf(l);u>-1&&p.splice(u,1)}let qz=!0,gT=(()=>{class p{}return p.__NG_ELEMENT_ID__=nbe,p})();function nbe(p){return function ibe(p,l,u){if(b3(p)&&!u){const f=Tc(p.index,l);return new ab(f,f)}return 47&p.type?new ab(l[16],l):null}(ia(),Gt(),16==(16&p))}class eY{constructor(){}supports(l){return JC(l)}create(l){return new cbe(l)}}const lbe=(p,l)=>l;class cbe{constructor(l){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=l||lbe}forEachItem(l){let u;for(u=this._itHead;null!==u;u=u._next)l(u)}forEachOperation(l){let u=this._itHead,f=this._removalsHead,g=0,m=null;for(;u||f;){const v=!f||u&&u.currentIndex<nY(f,g,m)?u:f,_=nY(v,g,m),b=v.currentIndex;if(v===f)g--,f=f._nextRemoved;else if(u=u._next,null==v.previousIndex)g++;else{m||(m=[]);const S=_-g,I=b-g;if(S!=I){for(let O=0;O<S;O++){const j=O<m.length?m[O]:m[O]=0,W=j+O;I<=W&&W<S&&(m[O]=j+1)}m[v.previousIndex]=I-S}}_!==b&&l(v,_,b)}}forEachPreviousItem(l){let u;for(u=this._previousItHead;null!==u;u=u._nextPrevious)l(u)}forEachAddedItem(l){let u;for(u=this._additionsHead;null!==u;u=u._nextAdded)l(u)}forEachMovedItem(l){let u;for(u=this._movesHead;null!==u;u=u._nextMoved)l(u)}forEachRemovedItem(l){let u;for(u=this._removalsHead;null!==u;u=u._nextRemoved)l(u)}forEachIdentityChange(l){let u;for(u=this._identityChangesHead;null!==u;u=u._nextIdentityChange)l(u)}diff(l){if(null==l&&(l=[]),!JC(l))throw new br(900,"");return this.check(l)?this:null}onDestroy(){}check(l){this._reset();let g,m,v,u=this._itHead,f=!1;if(Array.isArray(l)){this.length=l.length;for(let _=0;_<this.length;_++)m=l[_],v=this._trackByFn(_,m),null!==u&&Object.is(u.trackById,v)?(f&&(u=this._verifyReinsertion(u,m,v,_)),Object.is(u.item,m)||this._addIdentityChange(u,m)):(u=this._mismatch(u,m,v,_),f=!0),u=u._next}else g=0,function cye(p,l){if(Array.isArray(p))for(let u=0;u<p.length;u++)l(p[u]);else{const u=p[ry()]();let f;for(;!(f=u.next()).done;)l(f.value)}}(l,_=>{v=this._trackByFn(g,_),null!==u&&Object.is(u.trackById,v)?(f&&(u=this._verifyReinsertion(u,_,v,g)),Object.is(u.item,_)||this._addIdentityChange(u,_)):(u=this._mismatch(u,_,v,g),f=!0),u=u._next,g++}),this.length=g;return this._truncate(u),this.collection=l,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let l;for(l=this._previousItHead=this._itHead;null!==l;l=l._next)l._nextPrevious=l._next;for(l=this._additionsHead;null!==l;l=l._nextAdded)l.previousIndex=l.currentIndex;for(this._additionsHead=this._additionsTail=null,l=this._movesHead;null!==l;l=l._nextMoved)l.previousIndex=l.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(l,u,f,g){let m;return null===l?m=this._itTail:(m=l._prev,this._remove(l)),null!==(l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(f,null))?(Object.is(l.item,u)||this._addIdentityChange(l,u),this._reinsertAfter(l,m,g)):null!==(l=null===this._linkedRecords?null:this._linkedRecords.get(f,g))?(Object.is(l.item,u)||this._addIdentityChange(l,u),this._moveAfter(l,m,g)):l=this._addAfter(new ube(u,f),m,g),l}_verifyReinsertion(l,u,f,g){let m=null===this._unlinkedRecords?null:this._unlinkedRecords.get(f,null);return null!==m?l=this._reinsertAfter(m,l._prev,g):l.currentIndex!=g&&(l.currentIndex=g,this._addToMoves(l,g)),l}_truncate(l){for(;null!==l;){const u=l._next;this._addToRemovals(this._unlink(l)),l=u}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(l,u,f){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(l);const g=l._prevRemoved,m=l._nextRemoved;return null===g?this._removalsHead=m:g._nextRemoved=m,null===m?this._removalsTail=g:m._prevRemoved=g,this._insertAfter(l,u,f),this._addToMoves(l,f),l}_moveAfter(l,u,f){return this._unlink(l),this._insertAfter(l,u,f),this._addToMoves(l,f),l}_addAfter(l,u,f){return this._insertAfter(l,u,f),this._additionsTail=null===this._additionsTail?this._additionsHead=l:this._additionsTail._nextAdded=l,l}_insertAfter(l,u,f){const g=null===u?this._itHead:u._next;return l._next=g,l._prev=u,null===g?this._itTail=l:g._prev=l,null===u?this._itHead=l:u._next=l,null===this._linkedRecords&&(this._linkedRecords=new tY),this._linkedRecords.put(l),l.currentIndex=f,l}_remove(l){return this._addToRemovals(this._unlink(l))}_unlink(l){null!==this._linkedRecords&&this._linkedRecords.remove(l);const u=l._prev,f=l._next;return null===u?this._itHead=f:u._next=f,null===f?this._itTail=u:f._prev=u,l}_addToMoves(l,u){return l.previousIndex===u||(this._movesTail=null===this._movesTail?this._movesHead=l:this._movesTail._nextMoved=l),l}_addToRemovals(l){return null===this._unlinkedRecords&&(this._unlinkedRecords=new tY),this._unlinkedRecords.put(l),l.currentIndex=null,l._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=l,l._prevRemoved=null):(l._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=l),l}_addIdentityChange(l,u){return l.item=u,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=l:this._identityChangesTail._nextIdentityChange=l,l}}class ube{constructor(l,u){this.item=l,this.trackById=u,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class dbe{constructor(){this._head=null,this._tail=null}add(l){null===this._head?(this._head=this._tail=l,l._nextDup=null,l._prevDup=null):(this._tail._nextDup=l,l._prevDup=this._tail,l._nextDup=null,this._tail=l)}get(l,u){let f;for(f=this._head;null!==f;f=f._nextDup)if((null===u||u<=f.currentIndex)&&Object.is(f.trackById,l))return f;return null}remove(l){const u=l._prevDup,f=l._nextDup;return null===u?this._head=f:u._nextDup=f,null===f?this._tail=u:f._prevDup=u,null===this._head}}class tY{constructor(){this.map=new Map}put(l){const u=l.trackById;let f=this.map.get(u);f||(f=new dbe,this.map.set(u,f)),f.add(l)}get(l,u){const g=this.map.get(l);return g?g.get(l,u):null}remove(l){const u=l.trackById;return this.map.get(u).remove(l)&&this.map.delete(u),l}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function nY(p,l,u){const f=p.previousIndex;if(null===f)return f;let g=0;return u&&f<u.length&&(g=u[f]),f+l+g}function rY(){return new yT([new eY])}let yT=(()=>{class p{constructor(u){this.factories=u}static create(u,f){if(null!=f){const g=f.factories.slice();u=u.concat(g)}return new p(u)}static extend(u){return{provide:p,useFactory:f=>p.create(u,f||rY()),deps:[[p,new WC,new ng]]}}find(u){const f=this.factories.find(g=>g.supports(u));if(null!=f)return f;throw new br(901,"")}}return p.\u0275prov=ur({token:p,providedIn:"root",factory:rY}),p})();const mbe=zz(null,"core",[]);let vbe=(()=>{class p{constructor(u){}}return p.\u0275fac=function(u){return new(u||p)(ri(Sk))},p.\u0275mod=gh({type:p}),p.\u0275inj=_d({}),p})(),_T=null;function Ih(){return _T}const Iu=new Yi("DocumentToken");let zm=(()=>{class p{historyGo(u){throw new Error("Not implemented")}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=ur({token:p,factory:function(){return function bbe(){return ri(sY)}()},providedIn:"platform"}),p})();const xbe=new Yi("Location Initialized");let sY=(()=>{class p extends zm{constructor(u){super(),this._doc=u,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ih().getBaseHref(this._doc)}onPopState(u){const f=Ih().getGlobalEventTarget(this._doc,"window");return f.addEventListener("popstate",u,!1),()=>f.removeEventListener("popstate",u)}onHashChange(u){const f=Ih().getGlobalEventTarget(this._doc,"window");return f.addEventListener("hashchange",u,!1),()=>f.removeEventListener("hashchange",u)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(u){this.location.pathname=u}pushState(u,f,g){aY()?this._history.pushState(u,f,g):this.location.hash=g}replaceState(u,f,g){aY()?this._history.replaceState(u,f,g):this.location.hash=g}forward(){this._history.forward()}back(){this._history.back()}historyGo(u=0){this._history.go(u)}getState(){return this._history.state}}return p.\u0275fac=function(u){return new(u||p)(ri(Iu))},p.\u0275prov=ur({token:p,factory:function(){return function wbe(){return new sY(ri(Iu))}()},providedIn:"platform"}),p})();function aY(){return!!window.history.pushState}function Pk(p,l){if(0==p.length)return l;if(0==l.length)return p;let u=0;return p.endsWith("/")&&u++,l.startsWith("/")&&u++,2==u?p+l.substring(1):1==u?p+l:p+"/"+l}function lY(p){const l=p.match(/#|\?|$/),u=l&&l.index||p.length;return p.slice(0,u-("/"===p[u-1]?1:0))+p.slice(u)}function Bf(p){return p&&"?"!==p[0]?"?"+p:p}let by=(()=>{class p{historyGo(u){throw new Error("Not implemented")}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=ur({token:p,factory:function(){return function Sbe(p){const l=ri(Iu).location;return new cY(ri(zm),l&&l.origin||"")}()},providedIn:"root"}),p})();const Rk=new Yi("appBaseHref");let cY=(()=>{class p extends by{constructor(u,f){if(super(),this._platformLocation=u,this._removeListenerFns=[],null==f&&(f=this._platformLocation.getBaseHrefFromDOM()),null==f)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=f}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}prepareExternalUrl(u){return Pk(this._baseHref,u)}path(u=!1){const f=this._platformLocation.pathname+Bf(this._platformLocation.search),g=this._platformLocation.hash;return g&&u?`${f}${g}`:f}pushState(u,f,g,m){const v=this.prepareExternalUrl(g+Bf(m));this._platformLocation.pushState(u,f,v)}replaceState(u,f,g,m){const v=this.prepareExternalUrl(g+Bf(m));this._platformLocation.replaceState(u,f,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(u=0){var f,g;null===(g=(f=this._platformLocation).historyGo)||void 0===g||g.call(f,u)}}return p.\u0275fac=function(u){return new(u||p)(ri(zm),ri(Rk,8))},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})(),Tbe=(()=>{class p extends by{constructor(u,f){super(),this._platformLocation=u,this._baseHref="",this._removeListenerFns=[],null!=f&&(this._baseHref=f)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}path(u=!1){let f=this._platformLocation.hash;return null==f&&(f="#"),f.length>0?f.substring(1):f}prepareExternalUrl(u){const f=Pk(this._baseHref,u);return f.length>0?"#"+f:f}pushState(u,f,g,m){let v=this.prepareExternalUrl(g+Bf(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.pushState(u,f,v)}replaceState(u,f,g,m){let v=this.prepareExternalUrl(g+Bf(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.replaceState(u,f,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(u=0){var f,g;null===(g=(f=this._platformLocation).historyGo)||void 0===g||g.call(f,u)}}return p.\u0275fac=function(u){return new(u||p)(ri(zm),ri(Rk,8))},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})(),kk=(()=>{class p{constructor(u,f){this._subject=new us,this._urlChangeListeners=[],this._platformStrategy=u;const g=this._platformStrategy.getBaseHref();this._platformLocation=f,this._baseHref=lY(uY(g)),this._platformStrategy.onPopState(m=>{this._subject.emit({url:this.path(!0),pop:!0,state:m.state,type:m.type})})}path(u=!1){return this.normalize(this._platformStrategy.path(u))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(u,f=""){return this.path()==this.normalize(u+Bf(f))}normalize(u){return p.stripTrailingSlash(function Ebe(p,l){return p&&l.startsWith(p)?l.substring(p.length):l}(this._baseHref,uY(u)))}prepareExternalUrl(u){return u&&"/"!==u[0]&&(u="/"+u),this._platformStrategy.prepareExternalUrl(u)}go(u,f="",g=null){this._platformStrategy.pushState(g,"",u,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+Bf(f)),g)}replaceState(u,f="",g=null){this._platformStrategy.replaceState(g,"",u,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+Bf(f)),g)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(u=0){var f,g;null===(g=(f=this._platformStrategy).historyGo)||void 0===g||g.call(f,u)}onUrlChange(u){this._urlChangeListeners.push(u),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(f=>{this._notifyUrlChangeListeners(f.url,f.state)}))}_notifyUrlChangeListeners(u="",f){this._urlChangeListeners.forEach(g=>g(u,f))}subscribe(u,f,g){return this._subject.subscribe({next:u,error:f,complete:g})}}return p.normalizeQueryParams=Bf,p.joinWithSlash=Pk,p.stripTrailingSlash=lY,p.\u0275fac=function(u){return new(u||p)(ri(by),ri(zm))},p.\u0275prov=ur({token:p,factory:function(){return function Ibe(){return new kk(ri(by),ri(zm))}()},providedIn:"root"}),p})();function uY(p){return p.replace(/\/index.html$/,"")}class fxe{constructor(l,u,f,g){this.$implicit=l,this.ngForOf=u,this.index=f,this.count=g}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let _Y=(()=>{class p{constructor(u,f,g){this._viewContainer=u,this._template=f,this._differs=g,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(u){this._ngForOf=u,this._ngForOfDirty=!0}set ngForTrackBy(u){this._trackByFn=u}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(u){u&&(this._template=u)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const u=this._ngForOf;!this._differ&&u&&(this._differ=this._differs.find(u).create(this.ngForTrackBy))}if(this._differ){const u=this._differ.diff(this._ngForOf);u&&this._applyChanges(u)}}_applyChanges(u){const f=this._viewContainer;u.forEachOperation((g,m,v)=>{if(null==g.previousIndex)f.createEmbeddedView(this._template,new fxe(g.item,this._ngForOf,-1,-1),null===v?void 0:v);else if(null==v)f.remove(null===m?void 0:m);else if(null!==m){const _=f.get(m);f.move(_,v),CY(_,g)}});for(let g=0,m=f.length;g<m;g++){const _=f.get(g).context;_.index=g,_.count=m,_.ngForOf=this._ngForOf}u.forEachIdentityChange(g=>{CY(f.get(g.currentIndex),g)})}static ngTemplateContextGuard(u,f){return!0}}return p.\u0275fac=function(u){return new(u||p)(qt(Pd),qt(Nf),qt(yT))},p.\u0275dir=ii({type:p,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),p})();function CY(p,l){p.context.$implicit=l.item}let AT=(()=>{class p{constructor(u,f){this._viewContainer=u,this._context=new pxe,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=f}set ngIf(u){this._context.$implicit=this._context.ngIf=u,this._updateView()}set ngIfThen(u){bY("ngIfThen",u),this._thenTemplateRef=u,this._thenViewRef=null,this._updateView()}set ngIfElse(u){bY("ngIfElse",u),this._elseTemplateRef=u,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(u,f){return!0}}return p.\u0275fac=function(u){return new(u||p)(qt(Pd),qt(Nf))},p.\u0275dir=ii({type:p,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),p})();class pxe{constructor(){this.$implicit=null,this.ngIf=null}}function bY(p,l){if(l&&!l.createEmbeddedView)throw new Error(`${p} must be a TemplateRef, but received '${Wr(l)}'.`)}let Vxe=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=gh({type:p}),p.\u0275inj=_d({}),p})();let zxe=(()=>{class p{}return p.\u0275prov=ur({token:p,providedIn:"root",factory:()=>new Yxe(ri(Iu),window)}),p})();class Yxe{constructor(l,u){this.document=l,this.window=u,this.offset=()=>[0,0]}setOffset(l){this.offset=Array.isArray(l)?()=>l:l}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(l){this.supportsScrolling()&&this.window.scrollTo(l[0],l[1])}scrollToAnchor(l){if(!this.supportsScrolling())return;const u=function Xxe(p,l){const u=p.getElementById(l)||p.getElementsByName(l)[0];if(u)return u;if("function"==typeof p.createTreeWalker&&p.body&&(p.body.createShadowRoot||p.body.attachShadow)){const f=p.createTreeWalker(p.body,NodeFilter.SHOW_ELEMENT);let g=f.currentNode;for(;g;){const m=g.shadowRoot;if(m){const v=m.getElementById(l)||m.querySelector(`[name="${l}"]`);if(v)return v}g=f.nextNode()}}return null}(this.document,l);u&&(this.scrollToElement(u),u.focus())}setHistoryScrollRestoration(l){if(this.supportScrollRestoration()){const u=this.window.history;u&&u.scrollRestoration&&(u.scrollRestoration=l)}}scrollToElement(l){const u=l.getBoundingClientRect(),f=u.left+this.window.pageXOffset,g=u.top+this.window.pageYOffset,m=this.offset();this.window.scrollTo(f-m[0],g-m[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const l=TY(this.window.history)||TY(Object.getPrototypeOf(this.window.history));return!(!l||!l.writable&&!l.set)}catch(l){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(l){return!1}}}function TY(p){return Object.getOwnPropertyDescriptor(p,"scrollRestoration")}class Yk extends class qxe extends class Cbe{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function _be(p){_T||(_T=p)}(new Yk)}onAndCancel(l,u,f){return l.addEventListener(u,f,!1),()=>{l.removeEventListener(u,f,!1)}}dispatchEvent(l,u){l.dispatchEvent(u)}remove(l){l.parentNode&&l.parentNode.removeChild(l)}createElement(l,u){return(u=u||this.getDefaultDocument()).createElement(l)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(l){return l.nodeType===Node.ELEMENT_NODE}isShadowRoot(l){return l instanceof DocumentFragment}getGlobalEventTarget(l,u){return"window"===u?window:"document"===u?l:"body"===u?l.body:null}getBaseHref(l){const u=function Kxe(){return gb=gb||document.querySelector("base"),gb?gb.getAttribute("href"):null}();return null==u?null:function Jxe(p){PT=PT||document.createElement("a"),PT.setAttribute("href",p);const l=PT.pathname;return"/"===l.charAt(0)?l:`/${l}`}(u)}resetBaseElement(){gb=null}getUserAgent(){return window.navigator.userAgent}getCookie(l){return function uxe(p,l){l=encodeURIComponent(l);for(const u of p.split(";")){const f=u.indexOf("="),[g,m]=-1==f?[u,""]:[u.slice(0,f),u.slice(f+1)];if(g.trim()===l)return decodeURIComponent(m)}return null}(document.cookie,l)}}let PT,gb=null;const IY=new Yi("TRANSITION_ID"),Zxe=[{provide:gk,useFactory:function Qxe(p,l,u){return()=>{u.get(mk).donePromise.then(()=>{const f=Ih(),g=l.querySelectorAll(`style[ng-transition="${p}"]`);for(let m=0;m<g.length;m++)f.remove(g[m])})}},deps:[IY,Iu,ec],multi:!0}];class Xk{static init(){!function YCe(p){xk=p}(new Xk)}addToWindow(l){zr.getAngularTestability=(f,g=!0)=>{const m=l.findTestabilityInTree(f,g);if(null==m)throw new Error("Could not find testability for element.");return m},zr.getAllAngularTestabilities=()=>l.getAllTestabilities(),zr.getAllAngularRootElements=()=>l.getAllRootElements(),zr.frameworkStabilizers||(zr.frameworkStabilizers=[]),zr.frameworkStabilizers.push(f=>{const g=zr.getAllAngularTestabilities();let m=g.length,v=!1;const _=function(b){v=v||b,m--,0==m&&f(v)};g.forEach(function(b){b.whenStable(_)})})}findTestabilityInTree(l,u,f){if(null==u)return null;const g=l.getTestability(u);return null!=g?g:f?Ih().isShadowRoot(u)?this.findTestabilityInTree(l,u.host,!0):this.findTestabilityInTree(l,u.parentElement,!0):null}}let ewe=(()=>{class p{build(){return new XMLHttpRequest}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})();const RT=new Yi("EventManagerPlugins");let kT=(()=>{class p{constructor(u,f){this._zone=f,this._eventNameToPlugin=new Map,u.forEach(g=>g.manager=this),this._plugins=u.slice().reverse()}addEventListener(u,f,g){return this._findPluginFor(f).addEventListener(u,f,g)}addGlobalEventListener(u,f,g){return this._findPluginFor(f).addGlobalEventListener(u,f,g)}getZone(){return this._zone}_findPluginFor(u){const f=this._eventNameToPlugin.get(u);if(f)return f;const g=this._plugins;for(let m=0;m<g.length;m++){const v=g[m];if(v.supports(u))return this._eventNameToPlugin.set(u,v),v}throw new Error(`No event manager plugin found for event ${u}`)}}return p.\u0275fac=function(u){return new(u||p)(ri(RT),ri(Aa))},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})();class EY{constructor(l){this._doc=l}addGlobalEventListener(l,u,f){const g=Ih().getGlobalEventTarget(this._doc,l);if(!g)throw new Error(`Unsupported event target ${g} for event ${u}`);return this.addEventListener(g,u,f)}}let DY=(()=>{class p{constructor(){this._stylesSet=new Set}addStyles(u){const f=new Set;u.forEach(g=>{this._stylesSet.has(g)||(this._stylesSet.add(g),f.add(g))}),this.onStylesAdded(f)}onStylesAdded(u){}getAllStyles(){return Array.from(this._stylesSet)}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})(),mb=(()=>{class p extends DY{constructor(u){super(),this._doc=u,this._hostNodes=new Map,this._hostNodes.set(u.head,[])}_addStylesToHost(u,f,g){u.forEach(m=>{const v=this._doc.createElement("style");v.textContent=m,g.push(f.appendChild(v))})}addHost(u){const f=[];this._addStylesToHost(this._stylesSet,u,f),this._hostNodes.set(u,f)}removeHost(u){const f=this._hostNodes.get(u);f&&f.forEach(AY),this._hostNodes.delete(u)}onStylesAdded(u){this._hostNodes.forEach((f,g)=>{this._addStylesToHost(u,g,f)})}ngOnDestroy(){this._hostNodes.forEach(u=>u.forEach(AY))}}return p.\u0275fac=function(u){return new(u||p)(ri(Iu))},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})();function AY(p){Ih().remove(p)}const $k={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},qk=/%COMP%/g;function MT(p,l,u){for(let f=0;f<l.length;f++){let g=l[f];Array.isArray(g)?MT(p,g,u):(g=g.replace(qk,p),u.push(g))}return u}function kY(p){return l=>{if("__ngUnwrap__"===l)return p;!1===p(l)&&(l.preventDefault(),l.returnValue=!1)}}let Kk=(()=>{class p{constructor(u,f,g){this.eventManager=u,this.sharedStylesHost=f,this.appId=g,this.rendererByCompId=new Map,this.defaultRenderer=new Jk(u)}createRenderer(u,f){if(!u||!f)return this.defaultRenderer;switch(f.encapsulation){case ph.Emulated:{let g=this.rendererByCompId.get(f.id);return g||(g=new swe(this.eventManager,this.sharedStylesHost,f,this.appId),this.rendererByCompId.set(f.id,g)),g.applyToHost(u),g}case 1:case ph.ShadowDom:return new awe(this.eventManager,this.sharedStylesHost,u,f);default:if(!this.rendererByCompId.has(f.id)){const g=MT(f.id,f.styles,[]);this.sharedStylesHost.addStyles(g),this.rendererByCompId.set(f.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return p.\u0275fac=function(u){return new(u||p)(ri(kT),ri(mb),ri(db))},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})();class Jk{constructor(l){this.eventManager=l,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(l,u){return u?document.createElementNS($k[u]||u,l):document.createElement(l)}createComment(l){return document.createComment(l)}createText(l){return document.createTextNode(l)}appendChild(l,u){l.appendChild(u)}insertBefore(l,u,f){l&&l.insertBefore(u,f)}removeChild(l,u){l&&l.removeChild(u)}selectRootElement(l,u){let f="string"==typeof l?document.querySelector(l):l;if(!f)throw new Error(`The selector "${l}" did not match any elements`);return u||(f.textContent=""),f}parentNode(l){return l.parentNode}nextSibling(l){return l.nextSibling}setAttribute(l,u,f,g){if(g){u=g+":"+u;const m=$k[g];m?l.setAttributeNS(m,u,f):l.setAttribute(u,f)}else l.setAttribute(u,f)}removeAttribute(l,u,f){if(f){const g=$k[f];g?l.removeAttributeNS(g,u):l.removeAttribute(`${f}:${u}`)}else l.removeAttribute(u)}addClass(l,u){l.classList.add(u)}removeClass(l,u){l.classList.remove(u)}setStyle(l,u,f,g){g&(Ec.DashCase|Ec.Important)?l.style.setProperty(u,f,g&Ec.Important?"important":""):l.style[u]=f}removeStyle(l,u,f){f&Ec.DashCase?l.style.removeProperty(u):l.style[u]=""}setProperty(l,u,f){l[u]=f}setValue(l,u){l.nodeValue=u}listen(l,u,f){return"string"==typeof l?this.eventManager.addGlobalEventListener(l,u,kY(f)):this.eventManager.addEventListener(l,u,kY(f))}}class swe extends Jk{constructor(l,u,f,g){super(l),this.component=f;const m=MT(g+"-"+f.id,f.styles,[]);u.addStyles(m),this.contentAttr=function iwe(p){return"_ngcontent-%COMP%".replace(qk,p)}(g+"-"+f.id),this.hostAttr=function rwe(p){return"_nghost-%COMP%".replace(qk,p)}(g+"-"+f.id)}applyToHost(l){super.setAttribute(l,this.hostAttr,"")}createElement(l,u){const f=super.createElement(l,u);return super.setAttribute(f,this.contentAttr,""),f}}class awe extends Jk{constructor(l,u,f,g){super(l),this.sharedStylesHost=u,this.hostEl=f,this.shadowRoot=f.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const m=MT(g.id,g.styles,[]);for(let v=0;v<m.length;v++){const _=document.createElement("style");_.textContent=m[v],this.shadowRoot.appendChild(_)}}nodeOrShadowRoot(l){return l===this.hostEl?this.shadowRoot:l}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(l,u){return super.appendChild(this.nodeOrShadowRoot(l),u)}insertBefore(l,u,f){return super.insertBefore(this.nodeOrShadowRoot(l),u,f)}removeChild(l,u){return super.removeChild(this.nodeOrShadowRoot(l),u)}parentNode(l){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(l)))}}let lwe=(()=>{class p extends EY{constructor(u){super(u)}supports(u){return!0}addEventListener(u,f,g){return u.addEventListener(f,g,!1),()=>this.removeEventListener(u,f,g)}removeEventListener(u,f,g){return u.removeEventListener(f,g)}}return p.\u0275fac=function(u){return new(u||p)(ri(Iu))},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})();const OY=["alt","control","meta","shift"],uwe={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},FY={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},dwe={alt:p=>p.altKey,control:p=>p.ctrlKey,meta:p=>p.metaKey,shift:p=>p.shiftKey};let hwe=(()=>{class p extends EY{constructor(u){super(u)}supports(u){return null!=p.parseEventName(u)}addEventListener(u,f,g){const m=p.parseEventName(f),v=p.eventCallback(m.fullKey,g,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ih().onAndCancel(u,m.domEventName,v))}static parseEventName(u){const f=u.toLowerCase().split("."),g=f.shift();if(0===f.length||"keydown"!==g&&"keyup"!==g)return null;const m=p._normalizeKey(f.pop());let v="";if(OY.forEach(b=>{const S=f.indexOf(b);S>-1&&(f.splice(S,1),v+=b+".")}),v+=m,0!=f.length||0===m.length)return null;const _={};return _.domEventName=g,_.fullKey=v,_}static getEventFullKey(u){let f="",g=function fwe(p){let l=p.key;if(null==l){if(l=p.keyIdentifier,null==l)return"Unidentified";l.startsWith("U+")&&(l=String.fromCharCode(parseInt(l.substring(2),16)),3===p.location&&FY.hasOwnProperty(l)&&(l=FY[l]))}return uwe[l]||l}(u);return g=g.toLowerCase()," "===g?g="space":"."===g&&(g="dot"),OY.forEach(m=>{m!=g&&dwe[m](u)&&(f+=m+".")}),f+=g,f}static eventCallback(u,f,g){return m=>{p.getEventFullKey(m)===u&&g.runGuarded(()=>f(m))}}static _normalizeKey(u){return"esc"===u?"escape":u}}return p.\u0275fac=function(u){return new(u||p)(ri(Iu))},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})();const vwe=zz(mbe,"browser",[{provide:Nz,useValue:"browser"},{provide:Lz,useValue:function pwe(){Yk.makeCurrent(),Xk.init()},multi:!0},{provide:Iu,useFactory:function mwe(){return function bge(p){u6=p}(document),document},deps:[]}]),ywe=[{provide:TR,useValue:"root"},{provide:zC,useFactory:function gwe(){return new zC},deps:[]},{provide:RT,useClass:lwe,multi:!0,deps:[Iu,Aa,Nz]},{provide:RT,useClass:hwe,multi:!0,deps:[Iu]},{provide:Kk,useClass:Kk,deps:[kT,mb,db]},{provide:ZG,useExisting:Kk},{provide:DY,useExisting:mb},{provide:mb,useClass:mb,deps:[Iu]},{provide:bk,useClass:bk,deps:[Aa]},{provide:kT,useClass:kT,deps:[RT,Aa]},{provide:class $xe{},useClass:ewe,deps:[]}];let _we=(()=>{class p{constructor(u){if(u)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(u){return{ngModule:p,providers:[{provide:db,useValue:u.appId},{provide:IY,useExisting:db},Zxe]}}}return p.\u0275fac=function(u){return new(u||p)(ri(p,12))},p.\u0275mod=gh({type:p}),p.\u0275inj=_d({providers:ywe,imports:[Vxe,vbe]}),p})();"undefined"!=typeof window&&window;const{isArray:Pwe}=Array,{getPrototypeOf:Rwe,prototype:kwe,keys:Mwe}=Object;function BY(p){if(1===p.length){const l=p[0];if(Pwe(l))return{args:l,keys:null};if(function Owe(p){return p&&"object"==typeof p&&Rwe(p)===kwe}(l)){const u=Mwe(l);return{args:u.map(f=>l[f]),keys:u}}}return{args:p,keys:null}}const{isArray:Fwe}=Array;function WY(p){return co(l=>function Lwe(p,l){return Fwe(l)?p(...l):p(l)}(p,l))}function UY(p,l){return p.reduce((u,f,g)=>(u[f]=l[g],u),{})}let VY=(()=>{class p{constructor(u,f){this._renderer=u,this._elementRef=f,this.onChange=g=>{},this.onTouched=()=>{}}setProperty(u,f){this._renderer.setProperty(this._elementRef.nativeElement,u,f)}registerOnTouched(u){this.onTouched=u}registerOnChange(u){this.onChange=u}setDisabledState(u){this.setProperty("disabled",u)}}return p.\u0275fac=function(u){return new(u||p)(qt(Ff),qt(Pc))},p.\u0275dir=ii({type:p}),p})(),Ym=(()=>{class p extends VY{}return p.\u0275fac=function(){let l;return function(f){return(l||(l=tl(p)))(f||p)}}(),p.\u0275dir=ii({type:p,features:[Ur]}),p})();const Eh=new Yi("NgValueAccessor"),Wwe={provide:Eh,useExisting:uo(()=>OT),multi:!0},Vwe=new Yi("CompositionEventMode");let OT=(()=>{class p extends VY{constructor(u,f,g){super(u,f),this._compositionMode=g,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Uwe(){const p=Ih()?Ih().getUserAgent():"";return/android (\d+)/.test(p.toLowerCase())}())}writeValue(u){this.setProperty("value",null==u?"":u)}_handleInput(u){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(u)}_compositionStart(){this._composing=!0}_compositionEnd(u){this._composing=!1,this._compositionMode&&this.onChange(u)}}return p.\u0275fac=function(u){return new(u||p)(qt(Ff),qt(Pc),qt(Vwe,8))},p.\u0275dir=ii({type:p,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(u,f){1&u&&oi("input",function(m){return f._handleInput(m.target.value)})("blur",function(){return f.onTouched()})("compositionstart",function(){return f._compositionStart()})("compositionend",function(m){return f._compositionEnd(m.target.value)})},features:[ko([Wwe]),Ur]}),p})();const ol=new Yi("NgValidators"),cg=new Yi("NgAsyncValidators");function QY(p){return null!=p}function ZY(p){const l=ZC(p)?va(p):p;return UR(l),l}function eX(p){let l={};return p.forEach(u=>{l=null!=u?Object.assign(Object.assign({},l),u):l}),0===Object.keys(l).length?null:l}function tX(p,l){return l.map(u=>u(p))}function nX(p){return p.map(l=>function Hwe(p){return!p.validate}(l)?l:u=>l.validate(u))}function Zk(p){return null!=p?function iX(p){if(!p)return null;const l=p.filter(QY);return 0==l.length?null:function(u){return eX(tX(u,l))}}(nX(p)):null}function e4(p){return null!=p?function rX(p){if(!p)return null;const l=p.filter(QY);return 0==l.length?null:function(u){return function Nwe(...p){const l=wU(p),{args:u,keys:f}=BY(p),g=new Fs(m=>{const{length:v}=u;if(!v)return void m.complete();const _=new Array(v);let b=v,S=v;for(let I=0;I<v;I++){let k=!1;fh(u[I]).subscribe(ga(m,O=>{k||(k=!0,S--),_[I]=O},()=>b--,void 0,()=>{(!b||!k)&&(S||m.next(f?UY(f,_):_),m.complete())}))}});return l?g.pipe(WY(l)):g}(tX(u,l).map(ZY)).pipe(co(eX))}}(nX(p)):null}function oX(p,l){return null===p?[l]:Array.isArray(p)?[...p,l]:[p,l]}function t4(p){return p?Array.isArray(p)?p:[p]:[]}function LT(p,l){return Array.isArray(p)?p.includes(l):p===l}function lX(p,l){const u=t4(l);return t4(p).forEach(g=>{LT(u,g)||u.push(g)}),u}function cX(p,l){return t4(l).filter(u=>!LT(p,u))}class uX{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(l){this._rawValidators=l||[],this._composedValidatorFn=Zk(this._rawValidators)}_setAsyncValidators(l){this._rawAsyncValidators=l||[],this._composedAsyncValidatorFn=e4(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(l){this._onDestroyCallbacks.push(l)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(l=>l()),this._onDestroyCallbacks=[]}reset(l){this.control&&this.control.reset(l)}hasError(l,u){return!!this.control&&this.control.hasError(l,u)}getError(l,u){return this.control?this.control.getError(l,u):null}}class ug extends uX{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Pl extends uX{get formDirective(){return null}get path(){return null}}let hX=(()=>{class p extends class dX{constructor(l){this._cd=l}is(l){var u,f,g;return"submitted"===l?!!(null===(u=this._cd)||void 0===u?void 0:u.submitted):!!(null===(g=null===(f=this._cd)||void 0===f?void 0:f.control)||void 0===g?void 0:g[l])}}{constructor(u){super(u)}}return p.\u0275fac=function(u){return new(u||p)(qt(ug,2))},p.\u0275dir=ii({type:p,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(u,f){2&u&&iT("ng-untouched",f.is("untouched"))("ng-touched",f.is("touched"))("ng-pristine",f.is("pristine"))("ng-dirty",f.is("dirty"))("ng-valid",f.is("valid"))("ng-invalid",f.is("invalid"))("ng-pending",f.is("pending"))},features:[Ur]}),p})();function vb(p,l){(function r4(p,l){const u=function sX(p){return p._rawValidators}(p);null!==l.validator?p.setValidators(oX(u,l.validator)):"function"==typeof u&&p.setValidators([u]);const f=function aX(p){return p._rawAsyncValidators}(p);null!==l.asyncValidator?p.setAsyncValidators(oX(f,l.asyncValidator)):"function"==typeof f&&p.setAsyncValidators([f]);const g=()=>p.updateValueAndValidity();UT(l._rawValidators,g),UT(l._rawAsyncValidators,g)})(p,l),l.valueAccessor.writeValue(p.value),function Qwe(p,l){l.valueAccessor.registerOnChange(u=>{p._pendingValue=u,p._pendingChange=!0,p._pendingDirty=!0,"change"===p.updateOn&&pX(p,l)})}(p,l),function eSe(p,l){const u=(f,g)=>{l.valueAccessor.writeValue(f),g&&l.viewToModelUpdate(f)};p.registerOnChange(u),l._registerOnDestroy(()=>{p._unregisterOnChange(u)})}(p,l),function Zwe(p,l){l.valueAccessor.registerOnTouched(()=>{p._pendingTouched=!0,"blur"===p.updateOn&&p._pendingChange&&pX(p,l),"submit"!==p.updateOn&&p.markAsTouched()})}(p,l),function Jwe(p,l){if(l.valueAccessor.setDisabledState){const u=f=>{l.valueAccessor.setDisabledState(f)};p.registerOnDisabledChange(u),l._registerOnDestroy(()=>{p._unregisterOnDisabledChange(u)})}}(p,l)}function UT(p,l){p.forEach(u=>{u.registerOnValidatorChange&&u.registerOnValidatorChange(l)})}function pX(p,l){p._pendingDirty&&p.markAsDirty(),p.setValue(p._pendingValue,{emitModelToViewChange:!1}),l.viewToModelUpdate(p._pendingValue),p._pendingChange=!1}function a4(p,l){const u=p.indexOf(l);u>-1&&p.splice(u,1)}const yb="VALID",jT="INVALID",xy="PENDING",_b="DISABLED";function c4(p){return(HT(p)?p.validators:p)||null}function yX(p){return Array.isArray(p)?Zk(p):p||null}function u4(p,l){return(HT(l)?l.asyncValidators:p)||null}function _X(p){return Array.isArray(p)?e4(p):p||null}function HT(p){return null!=p&&!Array.isArray(p)&&"object"==typeof p}const d4=p=>p instanceof f4;function bX(p){return(p=>p instanceof SX)(p)?p.value:p.getRawValue()}function xX(p,l){const u=d4(p),f=p.controls;if(!(u?Object.keys(f):f).length)throw new br(1e3,"");if(!f[l])throw new br(1001,"")}function wX(p,l){d4(p),p._forEachChild((f,g)=>{if(void 0===l[g])throw new br(1002,"")})}class h4{constructor(l,u){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=l,this._rawAsyncValidators=u,this._composedValidatorFn=yX(this._rawValidators),this._composedAsyncValidatorFn=_X(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(l){this._rawValidators=this._composedValidatorFn=l}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(l){this._rawAsyncValidators=this._composedAsyncValidatorFn=l}get parent(){return this._parent}get valid(){return this.status===yb}get invalid(){return this.status===jT}get pending(){return this.status==xy}get disabled(){return this.status===_b}get enabled(){return this.status!==_b}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(l){this._rawValidators=l,this._composedValidatorFn=yX(l)}setAsyncValidators(l){this._rawAsyncValidators=l,this._composedAsyncValidatorFn=_X(l)}addValidators(l){this.setValidators(lX(l,this._rawValidators))}addAsyncValidators(l){this.setAsyncValidators(lX(l,this._rawAsyncValidators))}removeValidators(l){this.setValidators(cX(l,this._rawValidators))}removeAsyncValidators(l){this.setAsyncValidators(cX(l,this._rawAsyncValidators))}hasValidator(l){return LT(this._rawValidators,l)}hasAsyncValidator(l){return LT(this._rawAsyncValidators,l)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(l={}){this.touched=!0,this._parent&&!l.onlySelf&&this._parent.markAsTouched(l)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(l=>l.markAllAsTouched())}markAsUntouched(l={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(u=>{u.markAsUntouched({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}markAsDirty(l={}){this.pristine=!1,this._parent&&!l.onlySelf&&this._parent.markAsDirty(l)}markAsPristine(l={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(u=>{u.markAsPristine({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}markAsPending(l={}){this.status=xy,!1!==l.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!l.onlySelf&&this._parent.markAsPending(l)}disable(l={}){const u=this._parentMarkedDirty(l.onlySelf);this.status=_b,this.errors=null,this._forEachChild(f=>{f.disable(Object.assign(Object.assign({},l),{onlySelf:!0}))}),this._updateValue(),!1!==l.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},l),{skipPristineCheck:u})),this._onDisabledChange.forEach(f=>f(!0))}enable(l={}){const u=this._parentMarkedDirty(l.onlySelf);this.status=yb,this._forEachChild(f=>{f.enable(Object.assign(Object.assign({},l),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},l),{skipPristineCheck:u})),this._onDisabledChange.forEach(f=>f(!1))}_updateAncestors(l){this._parent&&!l.onlySelf&&(this._parent.updateValueAndValidity(l),l.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(l){this._parent=l}updateValueAndValidity(l={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===yb||this.status===xy)&&this._runAsyncValidator(l.emitEvent)),!1!==l.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!l.onlySelf&&this._parent.updateValueAndValidity(l)}_updateTreeValidity(l={emitEvent:!0}){this._forEachChild(u=>u._updateTreeValidity(l)),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?_b:yb}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(l){if(this.asyncValidator){this.status=xy,this._hasOwnPendingAsyncValidator=!0;const u=ZY(this.asyncValidator(this));this._asyncValidationSubscription=u.subscribe(f=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(f,{emitEvent:l})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(l,u={}){this.errors=l,this._updateControlsErrors(!1!==u.emitEvent)}get(l){return function rSe(p,l,u){if(null==l||(Array.isArray(l)||(l=l.split(u)),Array.isArray(l)&&0===l.length))return null;let f=p;return l.forEach(g=>{f=d4(f)?f.controls.hasOwnProperty(g)?f.controls[g]:null:(p=>p instanceof sSe)(f)&&f.at(g)||null}),f}(this,l,".")}getError(l,u){const f=u?this.get(u):this;return f&&f.errors?f.errors[l]:null}hasError(l,u){return!!this.getError(l,u)}get root(){let l=this;for(;l._parent;)l=l._parent;return l}_updateControlsErrors(l){this.status=this._calculateStatus(),l&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(l)}_initObservables(){this.valueChanges=new us,this.statusChanges=new us}_calculateStatus(){return this._allControlsDisabled()?_b:this.errors?jT:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(xy)?xy:this._anyControlsHaveStatus(jT)?jT:yb}_anyControlsHaveStatus(l){return this._anyControls(u=>u.status===l)}_anyControlsDirty(){return this._anyControls(l=>l.dirty)}_anyControlsTouched(){return this._anyControls(l=>l.touched)}_updatePristine(l={}){this.pristine=!this._anyControlsDirty(),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}_updateTouched(l={}){this.touched=this._anyControlsTouched(),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}_isBoxedValue(l){return"object"==typeof l&&null!==l&&2===Object.keys(l).length&&"value"in l&&"disabled"in l}_registerOnCollectionChange(l){this._onCollectionChange=l}_setUpdateStrategy(l){HT(l)&&null!=l.updateOn&&(this._updateOn=l.updateOn)}_parentMarkedDirty(l){return!l&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class SX extends h4{constructor(l=null,u,f){super(c4(u),u4(f,u)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(l),this._setUpdateStrategy(u),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),HT(u)&&u.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(l)?l.value:l)}setValue(l,u={}){this.value=this._pendingValue=l,this._onChange.length&&!1!==u.emitModelToViewChange&&this._onChange.forEach(f=>f(this.value,!1!==u.emitViewToModelChange)),this.updateValueAndValidity(u)}patchValue(l,u={}){this.setValue(l,u)}reset(l=this.defaultValue,u={}){this._applyFormState(l),this.markAsPristine(u),this.markAsUntouched(u),this.setValue(this.value,u),this._pendingChange=!1}_updateValue(){}_anyControls(l){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(l){this._onChange.push(l)}_unregisterOnChange(l){a4(this._onChange,l)}registerOnDisabledChange(l){this._onDisabledChange.push(l)}_unregisterOnDisabledChange(l){a4(this._onDisabledChange,l)}_forEachChild(l){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(l){this._isBoxedValue(l)?(this.value=this._pendingValue=l.value,l.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=l}}class f4 extends h4{constructor(l,u,f){super(c4(u),u4(f,u)),this.controls=l,this._initObservables(),this._setUpdateStrategy(u),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(l,u){return this.controls[l]?this.controls[l]:(this.controls[l]=u,u.setParent(this),u._registerOnCollectionChange(this._onCollectionChange),u)}addControl(l,u,f={}){this.registerControl(l,u),this.updateValueAndValidity({emitEvent:f.emitEvent}),this._onCollectionChange()}removeControl(l,u={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}setControl(l,u,f={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],u&&this.registerControl(l,u),this.updateValueAndValidity({emitEvent:f.emitEvent}),this._onCollectionChange()}contains(l){return this.controls.hasOwnProperty(l)&&this.controls[l].enabled}setValue(l,u={}){wX(this,l),Object.keys(l).forEach(f=>{xX(this,f),this.controls[f].setValue(l[f],{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u)}patchValue(l,u={}){null!=l&&(Object.keys(l).forEach(f=>{this.controls[f]&&this.controls[f].patchValue(l[f],{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u))}reset(l={},u={}){this._forEachChild((f,g)=>{f.reset(l[g],{onlySelf:!0,emitEvent:u.emitEvent})}),this._updatePristine(u),this._updateTouched(u),this.updateValueAndValidity(u)}getRawValue(){return this._reduceChildren({},(l,u,f)=>(l[f]=bX(u),l))}_syncPendingControls(){let l=this._reduceChildren(!1,(u,f)=>!!f._syncPendingControls()||u);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){Object.keys(this.controls).forEach(u=>{const f=this.controls[u];f&&l(f,u)})}_setUpControls(){this._forEachChild(l=>{l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(l){for(const u of Object.keys(this.controls)){const f=this.controls[u];if(this.contains(u)&&l(f))return!0}return!1}_reduceValue(){return this._reduceChildren({},(l,u,f)=>((u.enabled||this.disabled)&&(l[f]=u.value),l))}_reduceChildren(l,u){let f=l;return this._forEachChild((g,m)=>{f=u(f,g,m)}),f}_allControlsDisabled(){for(const l of Object.keys(this.controls))if(this.controls[l].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class sSe extends h4{constructor(l,u,f){super(c4(u),u4(f,u)),this.controls=l,this._initObservables(),this._setUpdateStrategy(u),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(l){return this.controls[l]}push(l,u={}){this.controls.push(l),this._registerControl(l),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}insert(l,u,f={}){this.controls.splice(l,0,u),this._registerControl(u),this.updateValueAndValidity({emitEvent:f.emitEvent})}removeAt(l,u={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),this.updateValueAndValidity({emitEvent:u.emitEvent})}setControl(l,u,f={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),u&&(this.controls.splice(l,0,u),this._registerControl(u)),this.updateValueAndValidity({emitEvent:f.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(l,u={}){wX(this,l),l.forEach((f,g)=>{xX(this,g),this.at(g).setValue(f,{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u)}patchValue(l,u={}){null!=l&&(l.forEach((f,g)=>{this.at(g)&&this.at(g).patchValue(f,{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u))}reset(l=[],u={}){this._forEachChild((f,g)=>{f.reset(l[g],{onlySelf:!0,emitEvent:u.emitEvent})}),this._updatePristine(u),this._updateTouched(u),this.updateValueAndValidity(u)}getRawValue(){return this.controls.map(l=>bX(l))}clear(l={}){this.controls.length<1||(this._forEachChild(u=>u._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:l.emitEvent}))}_syncPendingControls(){let l=this.controls.reduce((u,f)=>!!f._syncPendingControls()||u,!1);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){this.controls.forEach((u,f)=>{l(u,f)})}_updateValue(){this.value=this.controls.filter(l=>l.enabled||this.disabled).map(l=>l.value)}_anyControls(l){return this.controls.some(u=>u.enabled&&l(u))}_setUpControls(){this._forEachChild(l=>this._registerControl(l))}_allControlsDisabled(){for(const l of this.controls)if(l.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(l){l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)}}const cSe={provide:ug,useExisting:uo(()=>g4)},EX=(()=>Promise.resolve(null))();let g4=(()=>{class p extends ug{constructor(u,f,g,m,v){super(),this._changeDetectorRef=v,this.control=new SX,this._registered=!1,this.update=new us,this._parent=u,this._setValidators(f),this._setAsyncValidators(g),this.valueAccessor=function s4(p,l){if(!l)return null;let u,f,g;return Array.isArray(l),l.forEach(m=>{m.constructor===OT?u=m:function iSe(p){return Object.getPrototypeOf(p.constructor)===Ym}(m)?f=m:g=m}),g||f||u||null}(0,m)}ngOnChanges(u){if(this._checkForErrors(),!this._registered||"name"in u){if(this._registered&&(this._checkName(),this.formDirective)){const f=u.name.previousValue;this.formDirective.removeControl({name:f,path:this._getPath(f)})}this._setUpControl()}"isDisabled"in u&&this._updateDisabled(u),function o4(p,l){if(!p.hasOwnProperty("model"))return!1;const u=p.model;return!!u.isFirstChange()||!Object.is(l,u.currentValue)}(u,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(u){this.viewModel=u,this.update.emit(u)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){vb(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(u){EX.then(()=>{var f;this.control.setValue(u,{emitViewToModelChange:!1}),null===(f=this._changeDetectorRef)||void 0===f||f.markForCheck()})}_updateDisabled(u){const f=u.isDisabled.currentValue,g=""===f||f&&"false"!==f;EX.then(()=>{var m;g&&!this.control.disabled?this.control.disable():!g&&this.control.disabled&&this.control.enable(),null===(m=this._changeDetectorRef)||void 0===m||m.markForCheck()})}_getPath(u){return this._parent?function BT(p,l){return[...l.path,p]}(u,this._parent):[u]}}return p.\u0275fac=function(u){return new(u||p)(qt(Pl,9),qt(ol,10),qt(cg,10),qt(Eh,10),qt(gT,8))},p.\u0275dir=ii({type:p,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ko([cSe]),Ur,Cu]}),p})(),AX=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=gh({type:p}),p.\u0275inj=_d({}),p})();const CSe={provide:Eh,useExisting:uo(()=>_4),multi:!0};function LX(p,l){return null==p?`${l}`:(l&&"object"==typeof l&&(l="Object"),`${p}: ${l}`.slice(0,50))}let _4=(()=>{class p extends Ym{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(u){this._compareWith=u}writeValue(u){this.value=u;const g=LX(this._getOptionId(u),u);this.setProperty("value",g)}registerOnChange(u){this.onChange=f=>{this.value=this._getOptionValue(f),u(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(u){for(const f of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(f),u))return f;return null}_getOptionValue(u){const f=function bSe(p){return p.split(":")[0]}(u);return this._optionMap.has(f)?this._optionMap.get(f):u}}return p.\u0275fac=function(){let l;return function(f){return(l||(l=tl(p)))(f||p)}}(),p.\u0275dir=ii({type:p,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(u,f){1&u&&oi("change",function(m){return f.onChange(m.target.value)})("blur",function(){return f.onTouched()})},inputs:{compareWith:"compareWith"},features:[ko([CSe]),Ur]}),p})(),C4=(()=>{class p{constructor(u,f,g){this._element=u,this._renderer=f,this._select=g,this._select&&(this.id=this._select._registerOption())}set ngValue(u){null!=this._select&&(this._select._optionMap.set(this.id,u),this._setElementValue(LX(this.id,u)),this._select.writeValue(this._select.value))}set value(u){this._setElementValue(u),this._select&&this._select.writeValue(this._select.value)}_setElementValue(u){this._renderer.setProperty(this._element.nativeElement,"value",u)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return p.\u0275fac=function(u){return new(u||p)(qt(Pc),qt(Ff),qt(_4,9))},p.\u0275dir=ii({type:p,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),p})();const xSe={provide:Eh,useExisting:uo(()=>b4),multi:!0};function NX(p,l){return null==p?`${l}`:("string"==typeof l&&(l=`'${l}'`),l&&"object"==typeof l&&(l="Object"),`${p}: ${l}`.slice(0,50))}let b4=(()=>{class p extends Ym{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(u){this._compareWith=u}writeValue(u){let f;if(this.value=u,Array.isArray(u)){const g=u.map(m=>this._getOptionId(m));f=(m,v)=>{m._setSelected(g.indexOf(v.toString())>-1)}}else f=(g,m)=>{g._setSelected(!1)};this._optionMap.forEach(f)}registerOnChange(u){this.onChange=f=>{const g=[],m=f.selectedOptions;if(void 0!==m){const v=m;for(let _=0;_<v.length;_++){const S=this._getOptionValue(v[_].value);g.push(S)}}else{const v=f.options;for(let _=0;_<v.length;_++){const b=v[_];if(b.selected){const S=this._getOptionValue(b.value);g.push(S)}}}this.value=g,u(g)}}_registerOption(u){const f=(this._idCounter++).toString();return this._optionMap.set(f,u),f}_getOptionId(u){for(const f of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(f)._value,u))return f;return null}_getOptionValue(u){const f=function wSe(p){return p.split(":")[0]}(u);return this._optionMap.has(f)?this._optionMap.get(f)._value:u}}return p.\u0275fac=function(){let l;return function(f){return(l||(l=tl(p)))(f||p)}}(),p.\u0275dir=ii({type:p,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(u,f){1&u&&oi("change",function(m){return f.onChange(m.target)})("blur",function(){return f.onTouched()})},inputs:{compareWith:"compareWith"},features:[ko([xSe]),Ur]}),p})(),x4=(()=>{class p{constructor(u,f,g){this._element=u,this._renderer=f,this._select=g,this._select&&(this.id=this._select._registerOption(this))}set ngValue(u){null!=this._select&&(this._value=u,this._setElementValue(NX(this.id,u)),this._select.writeValue(this._select.value))}set value(u){this._select?(this._value=u,this._setElementValue(NX(this.id,u)),this._select.writeValue(this._select.value)):this._setElementValue(u)}_setElementValue(u){this._renderer.setProperty(this._element.nativeElement,"value",u)}_setSelected(u){this._renderer.setProperty(this._element.nativeElement,"selected",u)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return p.\u0275fac=function(u){return new(u||p)(qt(Pc),qt(Ff),qt(b4,9))},p.\u0275dir=ii({type:p,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),p})(),MSe=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=gh({type:p}),p.\u0275inj=_d({imports:[[AX]]}),p})(),OSe=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=gh({type:p}),p.\u0275inj=_d({imports:[MSe]}),p})();function Bi(...p){return va(p,xC(p))}class Md extends If{constructor(l){super(),this._value=l}get value(){return this.getValue()}_subscribe(l){const u=super._subscribe(l);return!u.closed&&l.next(this._value),u}getValue(){const{hasError:l,thrownError:u,_value:f}=this;if(l)throw u;return this._throwIfClosed(),f}next(l){super.next(this._value=l)}}function XX(p,l,u){p?Ef(u,p,l):l()}function GT(p,l){const u=fi(p)?p:()=>p,f=g=>g.error(u());return new Fs(l?g=>l.schedule(f,0,g):f)}const zT=Ss(p=>function(){p(this),this.name="EmptyError",this.message="no elements in sequence"});function S4(...p){return function NSe(){return bC(1)}()(va(p,xC(p)))}function $X(p){return new Fs(l=>{fh(p()).subscribe(l)})}function qX(){return Ea((p,l)=>{let u=null;p._refCount++;const f=ga(l,void 0,void 0,void 0,()=>{if(!p||p._refCount<=0||0<--p._refCount)return void(u=null);const g=p._connection,m=u;u=null,g&&(!m||g===m)&&g.unsubscribe(),l.unsubscribe()});p.subscribe(f),f.closed||(u=p.connect())})}class BSe extends Fs{constructor(l,u){super(),this.source=l,this.subjectFactory=u,this._subject=null,this._refCount=0,this._connection=null,cU(l)&&(this.lift=l.lift)}_subscribe(l){return this.getSubject().subscribe(l)}getSubject(){const l=this._subject;return(!l||l.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:l}=this;this._subject=this._connection=null,null==l||l.unsubscribe()}connect(){let l=this._connection;if(!l){l=this._connection=new vu;const u=this.getSubject();l.add(this.source.subscribe(ga(u,void 0,()=>{this._teardown(),u.complete()},f=>{this._teardown(),u.error(f)},()=>this._teardown()))),l.closed&&(this._connection=null,l=vu.EMPTY)}return l}refCount(){return qX()(this)}}function $m(p,l){return Ea((u,f)=>{let g=null,m=0,v=!1;const _=()=>v&&!g&&f.complete();u.subscribe(ga(f,b=>{null==g||g.unsubscribe();let S=0;const I=m++;fh(p(b,I)).subscribe(g=ga(f,k=>f.next(l?l(b,k,I,S++):k),()=>{g=null,_()}))},()=>{v=!0,_()}))})}function USe(p,l,u,f,g){return(m,v)=>{let _=u,b=l,S=0;m.subscribe(ga(v,I=>{const k=S++;b=_?p(b,I,k):(_=!0,I),f&&v.next(b)},g&&(()=>{_&&v.next(b),v.complete()})))}}function KX(p,l){return Ea(USe(p,l,arguments.length>=2,!0))}function wy(p,l){return Ea((u,f)=>{let g=0;u.subscribe(ga(f,m=>p.call(l,m,g++)&&f.next(m)))})}function dg(p){return Ea((l,u)=>{let m,f=null,g=!1;f=l.subscribe(ga(u,void 0,void 0,v=>{m=fh(p(v,dg(p)(l))),f?(f.unsubscribe(),f=null,m.subscribe(u)):g=!0})),g&&(f.unsubscribe(),f=null,m.subscribe(u))})}function bb(p,l){return fi(l)?ma(p,l,1):ma(p,1)}function T4(p){return p<=0?()=>Df:Ea((l,u)=>{let f=[];l.subscribe(ga(u,g=>{f.push(g),p<f.length&&f.shift()},()=>{for(const g of f)u.next(g);u.complete()},void 0,()=>{f=null}))})}function JX(p=VSe){return Ea((l,u)=>{let f=!1;l.subscribe(ga(u,g=>{f=!0,u.next(g)},()=>f?u.complete():u.error(p())))})}function VSe(){return new zT}function QX(p){return Ea((l,u)=>{let f=!1;l.subscribe(ga(u,g=>{f=!0,u.next(g)},()=>{f||u.next(p),u.complete()}))})}function Sy(p,l){const u=arguments.length>=2;return f=>f.pipe(p?wy((g,m)=>p(g,m,f)):Mm,p3(1),u?QX(l):JX(()=>new zT))}function Rc(p,l,u){const f=fi(p)||l||u?{next:p,error:l,complete:u}:p;return f?Ea((g,m)=>{var v;null===(v=f.subscribe)||void 0===v||v.call(f);let _=!0;g.subscribe(ga(m,b=>{var S;null===(S=f.next)||void 0===S||S.call(f,b),m.next(b)},()=>{var b;_=!1,null===(b=f.complete)||void 0===b||b.call(f),m.complete()},b=>{var S;_=!1,null===(S=f.error)||void 0===S||S.call(f,b),m.error(b)},()=>{var b,S;_&&(null===(b=f.unsubscribe)||void 0===b||b.call(f)),null===(S=f.finalize)||void 0===S||S.call(f)}))}):Mm}class Uf{constructor(l,u){this.id=l,this.url=u}}class I4 extends Uf{constructor(l,u,f="imperative",g=null){super(l,u),this.navigationTrigger=f,this.restoredState=g}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class xb extends Uf{constructor(l,u,f){super(l,u),this.urlAfterRedirects=f}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ZX extends Uf{constructor(l,u,f){super(l,u),this.reason=f}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class GSe extends Uf{constructor(l,u,f){super(l,u),this.error=f}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class zSe extends Uf{constructor(l,u,f,g){super(l,u),this.urlAfterRedirects=f,this.state=g}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class YSe extends Uf{constructor(l,u,f,g){super(l,u),this.urlAfterRedirects=f,this.state=g}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class XSe extends Uf{constructor(l,u,f,g,m){super(l,u),this.urlAfterRedirects=f,this.state=g,this.shouldActivate=m}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class $Se extends Uf{constructor(l,u,f,g){super(l,u),this.urlAfterRedirects=f,this.state=g}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qSe extends Uf{constructor(l,u,f,g){super(l,u),this.urlAfterRedirects=f,this.state=g}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class e${constructor(l){this.route=l}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class t${constructor(l){this.route=l}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class KSe{constructor(l){this.snapshot=l}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class JSe{constructor(l){this.snapshot=l}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class QSe{constructor(l){this.snapshot=l}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ZSe{constructor(l){this.snapshot=l}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class n${constructor(l,u,f){this.routerEvent=l,this.position=u,this.anchor=f}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Xi="primary";class e3e{constructor(l){this.params=l||{}}has(l){return Object.prototype.hasOwnProperty.call(this.params,l)}get(l){if(this.has(l)){const u=this.params[l];return Array.isArray(u)?u[0]:u}return null}getAll(l){if(this.has(l)){const u=this.params[l];return Array.isArray(u)?u:[u]}return[]}get keys(){return Object.keys(this.params)}}function Ty(p){return new e3e(p)}const i$="ngNavigationCancelingError";function E4(p){const l=Error("NavigationCancelingError: "+p);return l[i$]=!0,l}function n3e(p,l,u){const f=u.path.split("/");if(f.length>p.length||"full"===u.pathMatch&&(l.hasChildren()||f.length<p.length))return null;const g={};for(let m=0;m<f.length;m++){const v=f[m],_=p[m];if(v.startsWith(":"))g[v.substring(1)]=_;else if(v!==_.path)return null}return{consumed:p.slice(0,f.length),posParams:g}}function Dh(p,l){const u=p?Object.keys(p):void 0,f=l?Object.keys(l):void 0;if(!u||!f||u.length!=f.length)return!1;let g;for(let m=0;m<u.length;m++)if(g=u[m],!r$(p[g],l[g]))return!1;return!0}function r$(p,l){if(Array.isArray(p)&&Array.isArray(l)){if(p.length!==l.length)return!1;const u=[...p].sort(),f=[...l].sort();return u.every((g,m)=>f[m]===g)}return p===l}function o$(p){return Array.prototype.concat.apply([],p)}function s$(p){return p.length>0?p[p.length-1]:null}function Pa(p,l){for(const u in p)p.hasOwnProperty(u)&&l(p[u],u)}function Ah(p){return UR(p)?p:ZC(p)?va(Promise.resolve(p)):Bi(p)}const o3e={exact:function c$(p,l,u){if(!Km(p.segments,l.segments)||!YT(p.segments,l.segments,u)||p.numberOfChildren!==l.numberOfChildren)return!1;for(const f in l.children)if(!p.children[f]||!c$(p.children[f],l.children[f],u))return!1;return!0},subset:u$},a$={exact:function s3e(p,l){return Dh(p,l)},subset:function a3e(p,l){return Object.keys(l).length<=Object.keys(p).length&&Object.keys(l).every(u=>r$(p[u],l[u]))},ignored:()=>!0};function l$(p,l,u){return o3e[u.paths](p.root,l.root,u.matrixParams)&&a$[u.queryParams](p.queryParams,l.queryParams)&&!("exact"===u.fragment&&p.fragment!==l.fragment)}function u$(p,l,u){return d$(p,l,l.segments,u)}function d$(p,l,u,f){if(p.segments.length>u.length){const g=p.segments.slice(0,u.length);return!(!Km(g,u)||l.hasChildren()||!YT(g,u,f))}if(p.segments.length===u.length){if(!Km(p.segments,u)||!YT(p.segments,u,f))return!1;for(const g in l.children)if(!p.children[g]||!u$(p.children[g],l.children[g],f))return!1;return!0}{const g=u.slice(0,p.segments.length),m=u.slice(p.segments.length);return!!(Km(p.segments,g)&&YT(p.segments,g,f)&&p.children[Xi])&&d$(p.children[Xi],l,m,f)}}function YT(p,l,u){return l.every((f,g)=>a$[u](p[g].parameters,f.parameters))}class qm{constructor(l,u,f){this.root=l,this.queryParams=u,this.fragment=f}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ty(this.queryParams)),this._queryParamMap}toString(){return u3e.serialize(this)}}class hr{constructor(l,u){this.segments=l,this.children=u,this.parent=null,Pa(u,(f,g)=>f.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return XT(this)}}class wb{constructor(l,u){this.path=l,this.parameters=u}get parameterMap(){return this._parameterMap||(this._parameterMap=Ty(this.parameters)),this._parameterMap}toString(){return m$(this)}}function Km(p,l){return p.length===l.length&&p.every((u,f)=>u.path===l[f].path)}class h${}class f${parse(l){const u=new _3e(l);return new qm(u.parseRootSegment(),u.parseQueryParams(),u.parseFragment())}serialize(l){const u=`/${Sb(l.root,!0)}`,f=function f3e(p){const l=Object.keys(p).map(u=>{const f=p[u];return Array.isArray(f)?f.map(g=>`${$T(u)}=${$T(g)}`).join("&"):`${$T(u)}=${$T(f)}`}).filter(u=>!!u);return l.length?`?${l.join("&")}`:""}(l.queryParams);return`${u}${f}${"string"==typeof l.fragment?`#${function d3e(p){return encodeURI(p)}(l.fragment)}`:""}`}}const u3e=new f$;function XT(p){return p.segments.map(l=>m$(l)).join("/")}function Sb(p,l){if(!p.hasChildren())return XT(p);if(l){const u=p.children[Xi]?Sb(p.children[Xi],!1):"",f=[];return Pa(p.children,(g,m)=>{m!==Xi&&f.push(`${m}:${Sb(g,!1)}`)}),f.length>0?`${u}(${f.join("//")})`:u}{const u=function c3e(p,l){let u=[];return Pa(p.children,(f,g)=>{g===Xi&&(u=u.concat(l(f,g)))}),Pa(p.children,(f,g)=>{g!==Xi&&(u=u.concat(l(f,g)))}),u}(p,(f,g)=>g===Xi?[Sb(p.children[Xi],!1)]:[`${g}:${Sb(f,!1)}`]);return 1===Object.keys(p.children).length&&null!=p.children[Xi]?`${XT(p)}/${u[0]}`:`${XT(p)}/(${u.join("//")})`}}function p$(p){return encodeURIComponent(p).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function $T(p){return p$(p).replace(/%3B/gi,";")}function D4(p){return p$(p).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function qT(p){return decodeURIComponent(p)}function g$(p){return qT(p.replace(/\+/g,"%20"))}function m$(p){return`${D4(p.path)}${function h3e(p){return Object.keys(p).map(l=>`;${D4(l)}=${D4(p[l])}`).join("")}(p.parameters)}`}const p3e=/^[^\/()?;=#]+/;function KT(p){const l=p.match(p3e);return l?l[0]:""}const g3e=/^[^=?&#]+/,v3e=/^[^&#]+/;class _3e{constructor(l){this.url=l,this.remaining=l}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new hr([],{}):new hr([],this.parseChildren())}parseQueryParams(){const l={};if(this.consumeOptional("?"))do{this.parseQueryParam(l)}while(this.consumeOptional("&"));return l}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const l=[];for(this.peekStartsWith("(")||l.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),l.push(this.parseSegment());let u={};this.peekStartsWith("/(")&&(this.capture("/"),u=this.parseParens(!0));let f={};return this.peekStartsWith("(")&&(f=this.parseParens(!1)),(l.length>0||Object.keys(u).length>0)&&(f[Xi]=new hr(l,u)),f}parseSegment(){const l=KT(this.remaining);if(""===l&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(l),new wb(qT(l),this.parseMatrixParams())}parseMatrixParams(){const l={};for(;this.consumeOptional(";");)this.parseParam(l);return l}parseParam(l){const u=KT(this.remaining);if(!u)return;this.capture(u);let f="";if(this.consumeOptional("=")){const g=KT(this.remaining);g&&(f=g,this.capture(f))}l[qT(u)]=qT(f)}parseQueryParam(l){const u=function m3e(p){const l=p.match(g3e);return l?l[0]:""}(this.remaining);if(!u)return;this.capture(u);let f="";if(this.consumeOptional("=")){const v=function y3e(p){const l=p.match(v3e);return l?l[0]:""}(this.remaining);v&&(f=v,this.capture(f))}const g=g$(u),m=g$(f);if(l.hasOwnProperty(g)){let v=l[g];Array.isArray(v)||(v=[v],l[g]=v),v.push(m)}else l[g]=m}parseParens(l){const u={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const f=KT(this.remaining),g=this.remaining[f.length];if("/"!==g&&")"!==g&&";"!==g)throw new Error(`Cannot parse url '${this.url}'`);let m;f.indexOf(":")>-1?(m=f.substr(0,f.indexOf(":")),this.capture(m),this.capture(":")):l&&(m=Xi);const v=this.parseChildren();u[m]=1===Object.keys(v).length?v[Xi]:new hr([],v),this.consumeOptional("//")}return u}peekStartsWith(l){return this.remaining.startsWith(l)}consumeOptional(l){return!!this.peekStartsWith(l)&&(this.remaining=this.remaining.substring(l.length),!0)}capture(l){if(!this.consumeOptional(l))throw new Error(`Expected "${l}".`)}}class v${constructor(l){this._root=l}get root(){return this._root.value}parent(l){const u=this.pathFromRoot(l);return u.length>1?u[u.length-2]:null}children(l){const u=A4(l,this._root);return u?u.children.map(f=>f.value):[]}firstChild(l){const u=A4(l,this._root);return u&&u.children.length>0?u.children[0].value:null}siblings(l){const u=P4(l,this._root);return u.length<2?[]:u[u.length-2].children.map(g=>g.value).filter(g=>g!==l)}pathFromRoot(l){return P4(l,this._root).map(u=>u.value)}}function A4(p,l){if(p===l.value)return l;for(const u of l.children){const f=A4(p,u);if(f)return f}return null}function P4(p,l){if(p===l.value)return[l];for(const u of l.children){const f=P4(p,u);if(f.length)return f.unshift(l),f}return[]}class Vf{constructor(l,u){this.value=l,this.children=u}toString(){return`TreeNode(${this.value})`}}function Iy(p){const l={};return p&&p.children.forEach(u=>l[u.value.outlet]=u),l}class y$ extends v${constructor(l,u){super(l),this.snapshot=u,R4(this,l)}toString(){return this.snapshot.toString()}}function _$(p,l){const u=function C3e(p,l){const v=new JT([],{},{},"",{},Xi,l,null,p.root,-1,{});return new b$("",new Vf(v,[]))}(p,l),f=new Md([new wb("",{})]),g=new Md({}),m=new Md({}),v=new Md({}),_=new Md(""),b=new Ey(f,g,v,_,m,Xi,l,u.root);return b.snapshot=u.root,new y$(new Vf(b,[]),u)}class Ey{constructor(l,u,f,g,m,v,_,b){this.url=l,this.params=u,this.queryParams=f,this.fragment=g,this.data=m,this.outlet=v,this.component=_,this._futureSnapshot=b}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(co(l=>Ty(l)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(co(l=>Ty(l)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function C$(p,l="emptyOnly"){const u=p.pathFromRoot;let f=0;if("always"!==l)for(f=u.length-1;f>=1;){const g=u[f],m=u[f-1];if(g.routeConfig&&""===g.routeConfig.path)f--;else{if(m.component)break;f--}}return function b3e(p){return p.reduce((l,u)=>({params:Object.assign(Object.assign({},l.params),u.params),data:Object.assign(Object.assign({},l.data),u.data),resolve:Object.assign(Object.assign({},l.resolve),u._resolvedData)}),{params:{},data:{},resolve:{}})}(u.slice(f))}class JT{constructor(l,u,f,g,m,v,_,b,S,I,k){this.url=l,this.params=u,this.queryParams=f,this.fragment=g,this.data=m,this.outlet=v,this.component=_,this.routeConfig=b,this._urlSegment=S,this._lastPathIndex=I,this._resolve=k}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ty(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ty(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(f=>f.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class b$ extends v${constructor(l,u){super(u),this.url=l,R4(this,u)}toString(){return x$(this._root)}}function R4(p,l){l.value._routerState=p,l.children.forEach(u=>R4(p,u))}function x$(p){const l=p.children.length>0?` { ${p.children.map(x$).join(", ")} } `:"";return`${p.value}${l}`}function k4(p){if(p.snapshot){const l=p.snapshot,u=p._futureSnapshot;p.snapshot=u,Dh(l.queryParams,u.queryParams)||p.queryParams.next(u.queryParams),l.fragment!==u.fragment&&p.fragment.next(u.fragment),Dh(l.params,u.params)||p.params.next(u.params),function i3e(p,l){if(p.length!==l.length)return!1;for(let u=0;u<p.length;++u)if(!Dh(p[u],l[u]))return!1;return!0}(l.url,u.url)||p.url.next(u.url),Dh(l.data,u.data)||p.data.next(u.data)}else p.snapshot=p._futureSnapshot,p.data.next(p._futureSnapshot.data)}function M4(p,l){const u=Dh(p.params,l.params)&&function l3e(p,l){return Km(p,l)&&p.every((u,f)=>Dh(u.parameters,l[f].parameters))}(p.url,l.url);return u&&!(!p.parent!=!l.parent)&&(!p.parent||M4(p.parent,l.parent))}function Tb(p,l,u){if(u&&p.shouldReuseRoute(l.value,u.value.snapshot)){const f=u.value;f._futureSnapshot=l.value;const g=function w3e(p,l,u){return l.children.map(f=>{for(const g of u.children)if(p.shouldReuseRoute(f.value,g.value.snapshot))return Tb(p,f,g);return Tb(p,f)})}(p,l,u);return new Vf(f,g)}{if(p.shouldAttach(l.value)){const m=p.retrieve(l.value);if(null!==m){const v=m.route;return v.value._futureSnapshot=l.value,v.children=l.children.map(_=>Tb(p,_)),v}}const f=function S3e(p){return new Ey(new Md(p.url),new Md(p.params),new Md(p.queryParams),new Md(p.fragment),new Md(p.data),p.outlet,p.component,p)}(l.value),g=l.children.map(m=>Tb(p,m));return new Vf(f,g)}}function QT(p){return"object"==typeof p&&null!=p&&!p.outlets&&!p.segmentPath}function Ib(p){return"object"==typeof p&&null!=p&&p.outlets}function O4(p,l,u,f,g){let m={};if(f&&Pa(f,(_,b)=>{m[b]=Array.isArray(_)?_.map(S=>`${S}`):`${_}`}),p===l)return new qm(u,m,g);const v=w$(p,l,u);return new qm(v,m,g)}function w$(p,l,u){const f={};return Pa(p.children,(g,m)=>{f[m]=g===l?u:w$(g,l,u)}),new hr(p.segments,f)}class S${constructor(l,u,f){if(this.isAbsolute=l,this.numberOfDoubleDots=u,this.commands=f,l&&f.length>0&&QT(f[0]))throw new Error("Root segment cannot have matrix parameters");const g=f.find(Ib);if(g&&g!==s$(f))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class F4{constructor(l,u,f){this.segmentGroup=l,this.processChildren=u,this.index=f}}function T$(p,l,u){if(p||(p=new hr([],{})),0===p.segments.length&&p.hasChildren())return ZT(p,l,u);const f=function P3e(p,l,u){let f=0,g=l;const m={match:!1,pathIndex:0,commandIndex:0};for(;g<p.segments.length;){if(f>=u.length)return m;const v=p.segments[g],_=u[f];if(Ib(_))break;const b=`${_}`,S=f<u.length-1?u[f+1]:null;if(g>0&&void 0===b)break;if(b&&S&&"object"==typeof S&&void 0===S.outlets){if(!E$(b,S,v))return m;f+=2}else{if(!E$(b,{},v))return m;f++}g++}return{match:!0,pathIndex:g,commandIndex:f}}(p,l,u),g=u.slice(f.commandIndex);if(f.match&&f.pathIndex<p.segments.length){const m=new hr(p.segments.slice(0,f.pathIndex),{});return m.children[Xi]=new hr(p.segments.slice(f.pathIndex),p.children),ZT(m,0,g)}return f.match&&0===g.length?new hr(p.segments,{}):f.match&&!p.hasChildren()?L4(p,l,u):f.match?ZT(p,0,g):L4(p,l,u)}function ZT(p,l,u){if(0===u.length)return new hr(p.segments,{});{const f=function A3e(p){return Ib(p[0])?p[0].outlets:{[Xi]:p}}(u),g={};return Pa(f,(m,v)=>{"string"==typeof m&&(m=[m]),null!==m&&(g[v]=T$(p.children[v],l,m))}),Pa(p.children,(m,v)=>{void 0===f[v]&&(g[v]=m)}),new hr(p.segments,g)}}function L4(p,l,u){const f=p.segments.slice(0,l);let g=0;for(;g<u.length;){const m=u[g];if(Ib(m)){const b=R3e(m.outlets);return new hr(f,b)}if(0===g&&QT(u[0])){f.push(new wb(p.segments[l].path,I$(u[0]))),g++;continue}const v=Ib(m)?m.outlets[Xi]:`${m}`,_=g<u.length-1?u[g+1]:null;v&&_&&QT(_)?(f.push(new wb(v,I$(_))),g+=2):(f.push(new wb(v,{})),g++)}return new hr(f,{})}function R3e(p){const l={};return Pa(p,(u,f)=>{"string"==typeof u&&(u=[u]),null!==u&&(l[f]=L4(new hr([],{}),0,u))}),l}function I$(p){const l={};return Pa(p,(u,f)=>l[f]=`${u}`),l}function E$(p,l,u){return p==u.path&&Dh(l,u.parameters)}class M3e{constructor(l,u,f,g){this.routeReuseStrategy=l,this.futureState=u,this.currState=f,this.forwardEvent=g}activate(l){const u=this.futureState._root,f=this.currState?this.currState._root:null;this.deactivateChildRoutes(u,f,l),k4(this.futureState.root),this.activateChildRoutes(u,f,l)}deactivateChildRoutes(l,u,f){const g=Iy(u);l.children.forEach(m=>{const v=m.value.outlet;this.deactivateRoutes(m,g[v],f),delete g[v]}),Pa(g,(m,v)=>{this.deactivateRouteAndItsChildren(m,f)})}deactivateRoutes(l,u,f){const g=l.value,m=u?u.value:null;if(g===m)if(g.component){const v=f.getContext(g.outlet);v&&this.deactivateChildRoutes(l,u,v.children)}else this.deactivateChildRoutes(l,u,f);else m&&this.deactivateRouteAndItsChildren(u,f)}deactivateRouteAndItsChildren(l,u){l.value.component&&this.routeReuseStrategy.shouldDetach(l.value.snapshot)?this.detachAndStoreRouteSubtree(l,u):this.deactivateRouteAndOutlet(l,u)}detachAndStoreRouteSubtree(l,u){const f=u.getContext(l.value.outlet),g=f&&l.value.component?f.children:u,m=Iy(l);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],g);if(f&&f.outlet){const v=f.outlet.detach(),_=f.children.onOutletDeactivated();this.routeReuseStrategy.store(l.value.snapshot,{componentRef:v,route:l,contexts:_})}}deactivateRouteAndOutlet(l,u){const f=u.getContext(l.value.outlet),g=f&&l.value.component?f.children:u,m=Iy(l);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],g);f&&f.outlet&&(f.outlet.deactivate(),f.children.onOutletDeactivated(),f.attachRef=null,f.resolver=null,f.route=null)}activateChildRoutes(l,u,f){const g=Iy(u);l.children.forEach(m=>{this.activateRoutes(m,g[m.value.outlet],f),this.forwardEvent(new ZSe(m.value.snapshot))}),l.children.length&&this.forwardEvent(new JSe(l.value.snapshot))}activateRoutes(l,u,f){const g=l.value,m=u?u.value:null;if(k4(g),g===m)if(g.component){const v=f.getOrCreateContext(g.outlet);this.activateChildRoutes(l,u,v.children)}else this.activateChildRoutes(l,u,f);else if(g.component){const v=f.getOrCreateContext(g.outlet);if(this.routeReuseStrategy.shouldAttach(g.snapshot)){const _=this.routeReuseStrategy.retrieve(g.snapshot);this.routeReuseStrategy.store(g.snapshot,null),v.children.onOutletReAttached(_.contexts),v.attachRef=_.componentRef,v.route=_.route.value,v.outlet&&v.outlet.attach(_.componentRef,_.route.value),k4(_.route.value),this.activateChildRoutes(l,null,v.children)}else{const _=function O3e(p){for(let l=p.parent;l;l=l.parent){const u=l.routeConfig;if(u&&u._loadedConfig)return u._loadedConfig;if(u&&u.component)return null}return null}(g.snapshot),b=_?_.module.componentFactoryResolver:null;v.attachRef=null,v.route=g,v.resolver=b,v.outlet&&v.outlet.activateWith(g,b),this.activateChildRoutes(l,null,v.children)}}else this.activateChildRoutes(l,null,f)}}class N4{constructor(l,u){this.routes=l,this.module=u}}function hg(p){return"function"==typeof p}function Jm(p){return p instanceof qm}const Eb=Symbol("INITIAL_VALUE");function Db(){return $m(p=>function FSe(...p){const l=xC(p),u=wU(p),{args:f,keys:g}=BY(p);if(0===f.length)return va([],l);const m=new Fs(function LSe(p,l,u=Mm){return f=>{XX(l,()=>{const{length:g}=p,m=new Array(g);let v=g,_=g;for(let b=0;b<g;b++)XX(l,()=>{const S=va(p[b],l);let I=!1;S.subscribe(ga(f,k=>{m[b]=k,I||(I=!0,_--),_||f.next(u(m.slice()))},()=>{--v||f.complete()}))},f)},f)}}(f,l,g?v=>UY(g,v):Mm));return u?m.pipe(WY(u)):m}(p.map(l=>l.pipe(p3(1),function WSe(...p){const l=xC(p);return Ea((u,f)=>{(l?S4(p,u,l):S4(p,u)).subscribe(f)})}(Eb)))).pipe(KX((l,u)=>{let f=!1;return u.reduce((g,m,v)=>g!==Eb?g:(m===Eb&&(f=!0),f||!1!==m&&v!==u.length-1&&!Jm(m)?g:m),l)},Eb),wy(l=>l!==Eb),co(l=>Jm(l)?l:!0===l),p3(1)))}class U3e{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Ab,this.attachRef=null}}class Ab{constructor(){this.contexts=new Map}onChildOutletCreated(l,u){const f=this.getOrCreateContext(l);f.outlet=u,this.contexts.set(l,f)}onChildOutletDestroyed(l){const u=this.getContext(l);u&&(u.outlet=null,u.attachRef=null)}onOutletDeactivated(){const l=this.contexts;return this.contexts=new Map,l}onOutletReAttached(l){this.contexts=l}getOrCreateContext(l){let u=this.getContext(l);return u||(u=new U3e,this.contexts.set(l,u)),u}getContext(l){return this.contexts.get(l)||null}}let B4=(()=>{class p{constructor(u,f,g,m,v){this.parentContexts=u,this.location=f,this.resolver=g,this.changeDetector=v,this.activated=null,this._activatedRoute=null,this.activateEvents=new us,this.deactivateEvents=new us,this.attachEvents=new us,this.detachEvents=new us,this.name=m||Xi,u.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const u=this.parentContexts.getContext(this.name);u&&u.route&&(u.attachRef?this.attach(u.attachRef,u.route):this.activateWith(u.route,u.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const u=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(u.instance),u}attach(u,f){this.activated=u,this._activatedRoute=f,this.location.insert(u.hostView),this.attachEvents.emit(u.instance)}deactivate(){if(this.activated){const u=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(u)}}activateWith(u,f){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=u;const v=(f=f||this.resolver).resolveComponentFactory(u._futureSnapshot.routeConfig.component),_=this.parentContexts.getOrCreateContext(this.name).children,b=new V3e(u,_,this.location.injector);this.activated=this.location.createComponent(v,this.location.length,b),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return p.\u0275fac=function(u){return new(u||p)(qt(Ab),qt(Pd),qt(ob),function kC(p){return function Zge(p,l){if("class"===l)return p.classes;if("style"===l)return p.styles;const u=p.attrs;if(u){const f=u.length;let g=0;for(;g<f;){const m=u[g];if(nV(m))break;if(0===m)g+=2;else if("number"==typeof m)for(g++;g<f&&"string"==typeof u[g];)g++;else{if(m===l)return u[g+1];g+=2}}}return null}(ia(),p)}("name"),qt(gT))},p.\u0275dir=ii({type:p,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),p})();class V3e{constructor(l,u,f){this.route=l,this.childContexts=u,this.parent=f}get(l,u){return l===Ey?this.route:l===Ab?this.childContexts:this.parent.get(l,u)}}let D$=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["ng-component"]],decls:1,vars:0,template:function(u,f){1&u&&dr(0,"router-outlet")},directives:[B4],encapsulation:2}),p})();function A$(p,l=""){for(let u=0;u<p.length;u++){const f=p[u];j3e(f,H3e(l,f))}}function j3e(p,l){p.children&&A$(p.children,l)}function H3e(p,l){return l?p||l.path?p&&!l.path?`${p}/`:!p&&l.path?l.path:`${p}/${l.path}`:"":p}function W4(p){const l=p.children&&p.children.map(W4),u=l?Object.assign(Object.assign({},p),{children:l}):Object.assign({},p);return!u.component&&(l||u.loadChildren)&&u.outlet&&u.outlet!==Xi&&(u.component=D$),u}function Au(p){return p.outlet||Xi}function P$(p,l){const u=p.filter(f=>Au(f)===l);return u.push(...p.filter(f=>Au(f)!==l)),u}const R$={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function eI(p,l,u){var f;if(""===l.path)return"full"===l.pathMatch&&(p.hasChildren()||u.length>0)?Object.assign({},R$):{matched:!0,consumedSegments:[],remainingSegments:u,parameters:{},positionalParamSegments:{}};const m=(l.matcher||n3e)(u,p,l);if(!m)return Object.assign({},R$);const v={};Pa(m.posParams,(b,S)=>{v[S]=b.path});const _=m.consumed.length>0?Object.assign(Object.assign({},v),m.consumed[m.consumed.length-1].parameters):v;return{matched:!0,consumedSegments:m.consumed,remainingSegments:u.slice(m.consumed.length),parameters:_,positionalParamSegments:null!==(f=m.posParams)&&void 0!==f?f:{}}}function tI(p,l,u,f,g="corrected"){if(u.length>0&&function Y3e(p,l,u){return u.some(f=>nI(p,l,f)&&Au(f)!==Xi)}(p,u,f)){const v=new hr(l,function z3e(p,l,u,f){const g={};g[Xi]=f,f._sourceSegment=p,f._segmentIndexShift=l.length;for(const m of u)if(""===m.path&&Au(m)!==Xi){const v=new hr([],{});v._sourceSegment=p,v._segmentIndexShift=l.length,g[Au(m)]=v}return g}(p,l,f,new hr(u,p.children)));return v._sourceSegment=p,v._segmentIndexShift=l.length,{segmentGroup:v,slicedSegments:[]}}if(0===u.length&&function X3e(p,l,u){return u.some(f=>nI(p,l,f))}(p,u,f)){const v=new hr(p.segments,function G3e(p,l,u,f,g,m){const v={};for(const _ of f)if(nI(p,u,_)&&!g[Au(_)]){const b=new hr([],{});b._sourceSegment=p,b._segmentIndexShift="legacy"===m?p.segments.length:l.length,v[Au(_)]=b}return Object.assign(Object.assign({},g),v)}(p,l,u,f,p.children,g));return v._sourceSegment=p,v._segmentIndexShift=l.length,{segmentGroup:v,slicedSegments:u}}const m=new hr(p.segments,p.children);return m._sourceSegment=p,m._segmentIndexShift=l.length,{segmentGroup:m,slicedSegments:u}}function nI(p,l,u){return(!(p.hasChildren()||l.length>0)||"full"!==u.pathMatch)&&""===u.path}function k$(p,l,u,f){return!!(Au(p)===f||f!==Xi&&nI(l,u,p))&&("**"===p.path||eI(l,p,u).matched)}function M$(p,l,u){return 0===l.length&&!p.children[u]}class iI{constructor(l){this.segmentGroup=l||null}}class O${constructor(l){this.urlTree=l}}function Pb(p){return GT(new iI(p))}function F$(p){return GT(new O$(p))}class J3e{constructor(l,u,f,g,m){this.configLoader=u,this.urlSerializer=f,this.urlTree=g,this.config=m,this.allowRedirects=!0,this.ngModule=l.get(Lf)}apply(){const l=tI(this.urlTree.root,[],[],this.config).segmentGroup,u=new hr(l.segments,l.children);return this.expandSegmentGroup(this.ngModule,this.config,u,Xi).pipe(co(m=>this.createUrlTree(U4(m),this.urlTree.queryParams,this.urlTree.fragment))).pipe(dg(m=>{if(m instanceof O$)return this.allowRedirects=!1,this.match(m.urlTree);throw m instanceof iI?this.noMatchError(m):m}))}match(l){return this.expandSegmentGroup(this.ngModule,this.config,l.root,Xi).pipe(co(g=>this.createUrlTree(U4(g),l.queryParams,l.fragment))).pipe(dg(g=>{throw g instanceof iI?this.noMatchError(g):g}))}noMatchError(l){return new Error(`Cannot match any routes. URL Segment: '${l.segmentGroup}'`)}createUrlTree(l,u,f){const g=l.segments.length>0?new hr([],{[Xi]:l}):l;return new qm(g,u,f)}expandSegmentGroup(l,u,f,g){return 0===f.segments.length&&f.hasChildren()?this.expandChildren(l,u,f).pipe(co(m=>new hr([],m))):this.expandSegment(l,f,u,f.segments,g,!0)}expandChildren(l,u,f){const g=[];for(const m of Object.keys(f.children))"primary"===m?g.unshift(m):g.push(m);return va(g).pipe(bb(m=>{const v=f.children[m],_=P$(u,m);return this.expandSegmentGroup(l,_,v,m).pipe(co(b=>({segment:b,outlet:m})))}),KX((m,v)=>(m[v.outlet]=v.segment,m),{}),function jSe(p,l){const u=arguments.length>=2;return f=>f.pipe(p?wy((g,m)=>p(g,m,f)):Mm,T4(1),u?QX(l):JX(()=>new zT))}())}expandSegment(l,u,f,g,m,v){return va(f).pipe(bb(_=>this.expandSegmentAgainstRoute(l,u,f,_,g,m,v).pipe(dg(S=>{if(S instanceof iI)return Bi(null);throw S}))),Sy(_=>!!_),dg((_,b)=>{if(_ instanceof zT||"EmptyError"===_.name)return M$(u,g,m)?Bi(new hr([],{})):Pb(u);throw _}))}expandSegmentAgainstRoute(l,u,f,g,m,v,_){return k$(g,u,m,v)?void 0===g.redirectTo?this.matchSegmentAgainstRoute(l,u,g,m,v):_&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(l,u,f,g,m,v):Pb(u):Pb(u)}expandSegmentAgainstRouteUsingRedirect(l,u,f,g,m,v){return"**"===g.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(l,f,g,v):this.expandRegularSegmentAgainstRouteUsingRedirect(l,u,f,g,m,v)}expandWildCardWithParamsAgainstRouteUsingRedirect(l,u,f,g){const m=this.applyRedirectCommands([],f.redirectTo,{});return f.redirectTo.startsWith("/")?F$(m):this.lineralizeSegments(f,m).pipe(ma(v=>{const _=new hr(v,{});return this.expandSegment(l,_,u,v,g,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(l,u,f,g,m,v){const{matched:_,consumedSegments:b,remainingSegments:S,positionalParamSegments:I}=eI(u,g,m);if(!_)return Pb(u);const k=this.applyRedirectCommands(b,g.redirectTo,I);return g.redirectTo.startsWith("/")?F$(k):this.lineralizeSegments(g,k).pipe(ma(O=>this.expandSegment(l,u,f,O.concat(S),v,!1)))}matchSegmentAgainstRoute(l,u,f,g,m){if("**"===f.path)return f.loadChildren?(f._loadedConfig?Bi(f._loadedConfig):this.configLoader.load(l.injector,f)).pipe(co(k=>(f._loadedConfig=k,new hr(g,{})))):Bi(new hr(g,{}));const{matched:v,consumedSegments:_,remainingSegments:b}=eI(u,f,g);return v?this.getChildConfig(l,f,g).pipe(ma(I=>{const k=I.module,O=I.routes,{segmentGroup:j,slicedSegments:W}=tI(u,_,b,O),J=new hr(j.segments,j.children);if(0===W.length&&J.hasChildren())return this.expandChildren(k,O,J).pipe(co(oe=>new hr(_,oe)));if(0===O.length&&0===W.length)return Bi(new hr(_,{}));const K=Au(f)===m;return this.expandSegment(k,J,O,W,K?Xi:m,!0).pipe(co(ie=>new hr(_.concat(ie.segments),ie.children)))})):Pb(u)}getChildConfig(l,u,f){return u.children?Bi(new N4(u.children,l)):u.loadChildren?void 0!==u._loadedConfig?Bi(u._loadedConfig):this.runCanLoadGuards(l.injector,u,f).pipe(ma(g=>g?this.configLoader.load(l.injector,u).pipe(co(m=>(u._loadedConfig=m,m))):function q3e(p){return GT(E4(`Cannot load children because the guard of the route "path: '${p.path}'" returned false`))}(u))):Bi(new N4([],l))}runCanLoadGuards(l,u,f){const g=u.canLoad;return g&&0!==g.length?Bi(g.map(v=>{const _=l.get(v);let b;if(function L3e(p){return p&&hg(p.canLoad)}(_))b=_.canLoad(u,f);else{if(!hg(_))throw new Error("Invalid CanLoad guard");b=_(u,f)}return Ah(b)})).pipe(Db(),Rc(v=>{if(!Jm(v))return;const _=E4(`Redirecting to "${this.urlSerializer.serialize(v)}"`);throw _.url=v,_}),co(v=>!0===v)):Bi(!0)}lineralizeSegments(l,u){let f=[],g=u.root;for(;;){if(f=f.concat(g.segments),0===g.numberOfChildren)return Bi(f);if(g.numberOfChildren>1||!g.children[Xi])return GT(new Error(`Only absolute redirects can have named outlets. redirectTo: '${l.redirectTo}'`));g=g.children[Xi]}}applyRedirectCommands(l,u,f){return this.applyRedirectCreatreUrlTree(u,this.urlSerializer.parse(u),l,f)}applyRedirectCreatreUrlTree(l,u,f,g){const m=this.createSegmentGroup(l,u.root,f,g);return new qm(m,this.createQueryParams(u.queryParams,this.urlTree.queryParams),u.fragment)}createQueryParams(l,u){const f={};return Pa(l,(g,m)=>{if("string"==typeof g&&g.startsWith(":")){const _=g.substring(1);f[m]=u[_]}else f[m]=g}),f}createSegmentGroup(l,u,f,g){const m=this.createSegments(l,u.segments,f,g);let v={};return Pa(u.children,(_,b)=>{v[b]=this.createSegmentGroup(l,_,f,g)}),new hr(m,v)}createSegments(l,u,f,g){return u.map(m=>m.path.startsWith(":")?this.findPosParam(l,m,g):this.findOrReturn(m,f))}findPosParam(l,u,f){const g=f[u.path.substring(1)];if(!g)throw new Error(`Cannot redirect to '${l}'. Cannot find '${u.path}'.`);return g}findOrReturn(l,u){let f=0;for(const g of u){if(g.path===l.path)return u.splice(f),g;f++}return l}}function U4(p){const l={};for(const f of Object.keys(p.children)){const m=U4(p.children[f]);(m.segments.length>0||m.hasChildren())&&(l[f]=m)}return function Q3e(p){if(1===p.numberOfChildren&&p.children[Xi]){const l=p.children[Xi];return new hr(p.segments.concat(l.segments),l.children)}return p}(new hr(p.segments,l))}class L${constructor(l){this.path=l,this.route=this.path[this.path.length-1]}}class rI{constructor(l,u){this.component=l,this.route=u}}function eTe(p,l,u){const f=p._root;return Rb(f,l?l._root:null,u,[f.value])}function oI(p,l,u){const f=function nTe(p){if(!p)return null;for(let l=p.parent;l;l=l.parent){const u=l.routeConfig;if(u&&u._loadedConfig)return u._loadedConfig}return null}(l);return(f?f.module.injector:u).get(p)}function Rb(p,l,u,f,g={canDeactivateChecks:[],canActivateChecks:[]}){const m=Iy(l);return p.children.forEach(v=>{(function iTe(p,l,u,f,g={canDeactivateChecks:[],canActivateChecks:[]}){const m=p.value,v=l?l.value:null,_=u?u.getContext(p.value.outlet):null;if(v&&m.routeConfig===v.routeConfig){const b=function rTe(p,l,u){if("function"==typeof u)return u(p,l);switch(u){case"pathParamsChange":return!Km(p.url,l.url);case"pathParamsOrQueryParamsChange":return!Km(p.url,l.url)||!Dh(p.queryParams,l.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!M4(p,l)||!Dh(p.queryParams,l.queryParams);default:return!M4(p,l)}}(v,m,m.routeConfig.runGuardsAndResolvers);b?g.canActivateChecks.push(new L$(f)):(m.data=v.data,m._resolvedData=v._resolvedData),Rb(p,l,m.component?_?_.children:null:u,f,g),b&&_&&_.outlet&&_.outlet.isActivated&&g.canDeactivateChecks.push(new rI(_.outlet.component,v))}else v&&kb(l,_,g),g.canActivateChecks.push(new L$(f)),Rb(p,null,m.component?_?_.children:null:u,f,g)})(v,m[v.value.outlet],u,f.concat([v.value]),g),delete m[v.value.outlet]}),Pa(m,(v,_)=>kb(v,u.getContext(_),g)),g}function kb(p,l,u){const f=Iy(p),g=p.value;Pa(f,(m,v)=>{kb(m,g.component?l?l.children.getContext(v):null:l,u)}),u.canDeactivateChecks.push(new rI(g.component&&l&&l.outlet&&l.outlet.isActivated?l.outlet.component:null,g))}class fTe{}function N$(p){return new Fs(l=>l.error(p))}class gTe{constructor(l,u,f,g,m,v){this.rootComponentType=l,this.config=u,this.urlTree=f,this.url=g,this.paramsInheritanceStrategy=m,this.relativeLinkResolution=v}recognize(){const l=tI(this.urlTree.root,[],[],this.config.filter(v=>void 0===v.redirectTo),this.relativeLinkResolution).segmentGroup,u=this.processSegmentGroup(this.config,l,Xi);if(null===u)return null;const f=new JT([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Xi,this.rootComponentType,null,this.urlTree.root,-1,{}),g=new Vf(f,u),m=new b$(this.url,g);return this.inheritParamsAndData(m._root),m}inheritParamsAndData(l){const u=l.value,f=C$(u,this.paramsInheritanceStrategy);u.params=Object.freeze(f.params),u.data=Object.freeze(f.data),l.children.forEach(g=>this.inheritParamsAndData(g))}processSegmentGroup(l,u,f){return 0===u.segments.length&&u.hasChildren()?this.processChildren(l,u):this.processSegment(l,u,u.segments,f)}processChildren(l,u){const f=[];for(const m of Object.keys(u.children)){const v=u.children[m],_=P$(l,m),b=this.processSegmentGroup(_,v,m);if(null===b)return null;f.push(...b)}const g=B$(f);return function mTe(p){p.sort((l,u)=>l.value.outlet===Xi?-1:u.value.outlet===Xi?1:l.value.outlet.localeCompare(u.value.outlet))}(g),g}processSegment(l,u,f,g){for(const m of l){const v=this.processSegmentAgainstRoute(m,u,f,g);if(null!==v)return v}return M$(u,f,g)?[]:null}processSegmentAgainstRoute(l,u,f,g){if(l.redirectTo||!k$(l,u,f,g))return null;let m,v=[],_=[];if("**"===l.path){const j=f.length>0?s$(f).parameters:{};m=new JT(f,j,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,V$(l),Au(l),l.component,l,W$(u),U$(u)+f.length,j$(l))}else{const j=eI(u,l,f);if(!j.matched)return null;v=j.consumedSegments,_=j.remainingSegments,m=new JT(v,j.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,V$(l),Au(l),l.component,l,W$(u),U$(u)+v.length,j$(l))}const b=function vTe(p){return p.children?p.children:p.loadChildren?p._loadedConfig.routes:[]}(l),{segmentGroup:S,slicedSegments:I}=tI(u,v,_,b.filter(j=>void 0===j.redirectTo),this.relativeLinkResolution);if(0===I.length&&S.hasChildren()){const j=this.processChildren(b,S);return null===j?null:[new Vf(m,j)]}if(0===b.length&&0===I.length)return[new Vf(m,[])];const k=Au(l)===g,O=this.processSegment(b,S,I,k?Xi:g);return null===O?null:[new Vf(m,O)]}}function yTe(p){const l=p.value.routeConfig;return l&&""===l.path&&void 0===l.redirectTo}function B$(p){const l=[],u=new Set;for(const f of p){if(!yTe(f)){l.push(f);continue}const g=l.find(m=>f.value.routeConfig===m.value.routeConfig);void 0!==g?(g.children.push(...f.children),u.add(g)):l.push(f)}for(const f of u){const g=B$(f.children);l.push(new Vf(f.value,g))}return l.filter(f=>!u.has(f))}function W$(p){let l=p;for(;l._sourceSegment;)l=l._sourceSegment;return l}function U$(p){let l=p,u=l._segmentIndexShift?l._segmentIndexShift:0;for(;l._sourceSegment;)l=l._sourceSegment,u+=l._segmentIndexShift?l._segmentIndexShift:0;return u-1}function V$(p){return p.data||{}}function j$(p){return p.resolve||{}}function H$(p){return[...Object.keys(p),...Object.getOwnPropertySymbols(p)]}function V4(p){return $m(l=>{const u=p(l);return u?va(u).pipe(co(()=>l)):Bi(l)})}class ITe extends class TTe{shouldDetach(l){return!1}store(l,u){}shouldAttach(l){return!1}retrieve(l){return null}shouldReuseRoute(l,u){return l.routeConfig===u.routeConfig}}{}const j4=new Yi("ROUTES");class G${constructor(l,u,f,g){this.injector=l,this.compiler=u,this.onLoadStartListener=f,this.onLoadEndListener=g}load(l,u){if(u._loader$)return u._loader$;this.onLoadStartListener&&this.onLoadStartListener(u);const g=this.loadModuleFactory(u.loadChildren).pipe(co(m=>{this.onLoadEndListener&&this.onLoadEndListener(u);const v=m.create(l);return new N4(o$(v.injector.get(j4,void 0,si.Self|si.Optional)).map(W4),v)}),dg(m=>{throw u._loader$=void 0,m}));return u._loader$=new BSe(g,()=>new If).pipe(qX()),u._loader$}loadModuleFactory(l){return Ah(l()).pipe(ma(u=>u instanceof nz?Bi(u):va(this.compiler.compileModuleAsync(u))))}}class DTe{shouldProcessUrl(l){return!0}extract(l){return l}merge(l,u){return l}}function ATe(p){throw p}function PTe(p,l,u){return l.parse("/")}function z$(p,l){return Bi(null)}const RTe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},kTe={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let kc=(()=>{class p{constructor(u,f,g,m,v,_,b){this.rootComponentType=u,this.urlSerializer=f,this.rootContexts=g,this.location=m,this.config=b,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new If,this.errorHandler=ATe,this.malformedUriErrorHandler=PTe,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:z$,afterPreactivation:z$},this.urlHandlingStrategy=new DTe,this.routeReuseStrategy=new ITe,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=v.get(Lf),this.console=v.get(MCe);const k=v.get(Aa);this.isNgZoneEnabled=k instanceof Aa&&Aa.isInAngularZone(),this.resetConfig(b),this.currentUrlTree=function r3e(){return new qm(new hr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new G$(v,_,O=>this.triggerEvent(new e$(O)),O=>this.triggerEvent(new t$(O))),this.routerState=_$(this.currentUrlTree,this.rootComponentType),this.transitions=new Md({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var u;return null===(u=this.location.getState())||void 0===u?void 0:u.\u0275routerPageId}setupNavigations(u){const f=this.events;return u.pipe(wy(g=>0!==g.id),co(g=>Object.assign(Object.assign({},g),{extractedUrl:this.urlHandlingStrategy.extract(g.rawUrl)})),$m(g=>{let m=!1,v=!1;return Bi(g).pipe(Rc(_=>{this.currentNavigation={id:_.id,initialUrl:_.currentRawUrl,extractedUrl:_.extractedUrl,trigger:_.source,extras:_.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),$m(_=>{const b=this.browserUrlTree.toString(),S=!this.navigated||_.extractedUrl.toString()!==b||b!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||S)&&this.urlHandlingStrategy.shouldProcessUrl(_.rawUrl))return Y$(_.source)&&(this.browserUrlTree=_.extractedUrl),Bi(_).pipe($m(k=>{const O=this.transitions.getValue();return f.next(new I4(k.id,this.serializeUrl(k.extractedUrl),k.source,k.restoredState)),O!==this.transitions.getValue()?Df:Promise.resolve(k)}),function Z3e(p,l,u,f){return $m(g=>function K3e(p,l,u,f,g){return new J3e(p,l,u,f,g).apply()}(p,l,u,g.extractedUrl,f).pipe(co(m=>Object.assign(Object.assign({},g),{urlAfterRedirects:m}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Rc(k=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:k.urlAfterRedirects})}),function _Te(p,l,u,f,g){return ma(m=>function pTe(p,l,u,f,g="emptyOnly",m="legacy"){try{const v=new gTe(p,l,u,f,g,m).recognize();return null===v?N$(new fTe):Bi(v)}catch(v){return N$(v)}}(p,l,m.urlAfterRedirects,u(m.urlAfterRedirects),f,g).pipe(co(v=>Object.assign(Object.assign({},m),{targetSnapshot:v}))))}(this.rootComponentType,this.config,k=>this.serializeUrl(k),this.paramsInheritanceStrategy,this.relativeLinkResolution),Rc(k=>{if("eager"===this.urlUpdateStrategy){if(!k.extras.skipLocationChange){const j=this.urlHandlingStrategy.merge(k.urlAfterRedirects,k.rawUrl);this.setBrowserUrl(j,k)}this.browserUrlTree=k.urlAfterRedirects}const O=new zSe(k.id,this.serializeUrl(k.extractedUrl),this.serializeUrl(k.urlAfterRedirects),k.targetSnapshot);f.next(O)}));if(S&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:O,extractedUrl:j,source:W,restoredState:J,extras:K}=_,Q=new I4(O,this.serializeUrl(j),W,J);f.next(Q);const ie=_$(j,this.rootComponentType).snapshot;return Bi(Object.assign(Object.assign({},_),{targetSnapshot:ie,urlAfterRedirects:j,extras:Object.assign(Object.assign({},K),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=_.rawUrl,_.resolve(null),Df}),V4(_=>{const{targetSnapshot:b,id:S,extractedUrl:I,rawUrl:k,extras:{skipLocationChange:O,replaceUrl:j}}=_;return this.hooks.beforePreactivation(b,{navigationId:S,appliedUrlTree:I,rawUrlTree:k,skipLocationChange:!!O,replaceUrl:!!j})}),Rc(_=>{const b=new YSe(_.id,this.serializeUrl(_.extractedUrl),this.serializeUrl(_.urlAfterRedirects),_.targetSnapshot);this.triggerEvent(b)}),co(_=>Object.assign(Object.assign({},_),{guards:eTe(_.targetSnapshot,_.currentSnapshot,this.rootContexts)})),function oTe(p,l){return ma(u=>{const{targetSnapshot:f,currentSnapshot:g,guards:{canActivateChecks:m,canDeactivateChecks:v}}=u;return 0===v.length&&0===m.length?Bi(Object.assign(Object.assign({},u),{guardsResult:!0})):function sTe(p,l,u,f){return va(p).pipe(ma(g=>function hTe(p,l,u,f,g){const m=l&&l.routeConfig?l.routeConfig.canDeactivate:null;return m&&0!==m.length?Bi(m.map(_=>{const b=oI(_,l,g);let S;if(function W3e(p){return p&&hg(p.canDeactivate)}(b))S=Ah(b.canDeactivate(p,l,u,f));else{if(!hg(b))throw new Error("Invalid CanDeactivate guard");S=Ah(b(p,l,u,f))}return S.pipe(Sy())})).pipe(Db()):Bi(!0)}(g.component,g.route,u,l,f)),Sy(g=>!0!==g,!0))}(v,f,g,p).pipe(ma(_=>_&&function F3e(p){return"boolean"==typeof p}(_)?function aTe(p,l,u,f){return va(l).pipe(bb(g=>S4(function cTe(p,l){return null!==p&&l&&l(new KSe(p)),Bi(!0)}(g.route.parent,f),function lTe(p,l){return null!==p&&l&&l(new QSe(p)),Bi(!0)}(g.route,f),function dTe(p,l,u){const f=l[l.length-1],m=l.slice(0,l.length-1).reverse().map(v=>function tTe(p){const l=p.routeConfig?p.routeConfig.canActivateChild:null;return l&&0!==l.length?{node:p,guards:l}:null}(v)).filter(v=>null!==v).map(v=>$X(()=>Bi(v.guards.map(b=>{const S=oI(b,v.node,u);let I;if(function B3e(p){return p&&hg(p.canActivateChild)}(S))I=Ah(S.canActivateChild(f,p));else{if(!hg(S))throw new Error("Invalid CanActivateChild guard");I=Ah(S(f,p))}return I.pipe(Sy())})).pipe(Db())));return Bi(m).pipe(Db())}(p,g.path,u),function uTe(p,l,u){const f=l.routeConfig?l.routeConfig.canActivate:null;if(!f||0===f.length)return Bi(!0);const g=f.map(m=>$X(()=>{const v=oI(m,l,u);let _;if(function N3e(p){return p&&hg(p.canActivate)}(v))_=Ah(v.canActivate(l,p));else{if(!hg(v))throw new Error("Invalid CanActivate guard");_=Ah(v(l,p))}return _.pipe(Sy())}));return Bi(g).pipe(Db())}(p,g.route,u))),Sy(g=>!0!==g,!0))}(f,m,p,l):Bi(_)),co(_=>Object.assign(Object.assign({},u),{guardsResult:_})))})}(this.ngModule.injector,_=>this.triggerEvent(_)),Rc(_=>{if(Jm(_.guardsResult)){const S=E4(`Redirecting to "${this.serializeUrl(_.guardsResult)}"`);throw S.url=_.guardsResult,S}const b=new XSe(_.id,this.serializeUrl(_.extractedUrl),this.serializeUrl(_.urlAfterRedirects),_.targetSnapshot,!!_.guardsResult);this.triggerEvent(b)}),wy(_=>!!_.guardsResult||(this.restoreHistory(_),this.cancelNavigationTransition(_,""),!1)),V4(_=>{if(_.guards.canActivateChecks.length)return Bi(_).pipe(Rc(b=>{const S=new $Se(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(S)}),$m(b=>{let S=!1;return Bi(b).pipe(function CTe(p,l){return ma(u=>{const{targetSnapshot:f,guards:{canActivateChecks:g}}=u;if(!g.length)return Bi(u);let m=0;return va(g).pipe(bb(v=>function bTe(p,l,u,f){return function xTe(p,l,u,f){const g=H$(p);if(0===g.length)return Bi({});const m={};return va(g).pipe(ma(v=>function wTe(p,l,u,f){const g=oI(p,l,f);return Ah(g.resolve?g.resolve(l,u):g(l,u))}(p[v],l,u,f).pipe(Rc(_=>{m[v]=_}))),T4(1),ma(()=>H$(m).length===g.length?Bi(m):Df))}(p._resolve,p,l,f).pipe(co(m=>(p._resolvedData=m,p.data=Object.assign(Object.assign({},p.data),C$(p,u).resolve),null)))}(v.route,f,p,l)),Rc(()=>m++),T4(1),ma(v=>m===g.length?Bi(u):Df))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Rc({next:()=>S=!0,complete:()=>{S||(this.restoreHistory(b),this.cancelNavigationTransition(b,"At least one route resolver didn't emit any value."))}}))}),Rc(b=>{const S=new qSe(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(S)}))}),V4(_=>{const{targetSnapshot:b,id:S,extractedUrl:I,rawUrl:k,extras:{skipLocationChange:O,replaceUrl:j}}=_;return this.hooks.afterPreactivation(b,{navigationId:S,appliedUrlTree:I,rawUrlTree:k,skipLocationChange:!!O,replaceUrl:!!j})}),co(_=>{const b=function x3e(p,l,u){const f=Tb(p,l._root,u?u._root:void 0);return new y$(f,l)}(this.routeReuseStrategy,_.targetSnapshot,_.currentRouterState);return Object.assign(Object.assign({},_),{targetRouterState:b})}),Rc(_=>{this.currentUrlTree=_.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(_.urlAfterRedirects,_.rawUrl),this.routerState=_.targetRouterState,"deferred"===this.urlUpdateStrategy&&(_.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,_),this.browserUrlTree=_.urlAfterRedirects)}),((p,l,u)=>co(f=>(new M3e(l,f.targetRouterState,f.currentRouterState,u).activate(p),f)))(this.rootContexts,this.routeReuseStrategy,_=>this.triggerEvent(_)),Rc({next(){m=!0},complete(){m=!0}}),function HSe(p){return Ea((l,u)=>{try{l.subscribe(u)}finally{u.add(p)}})}(()=>{var _;m||v||this.cancelNavigationTransition(g,`Navigation ID ${g.id} is not equal to the current navigation id ${this.navigationId}`),(null===(_=this.currentNavigation)||void 0===_?void 0:_.id)===g.id&&(this.currentNavigation=null)}),dg(_=>{if(v=!0,function t3e(p){return p&&p[i$]}(_)){const b=Jm(_.url);b||(this.navigated=!0,this.restoreHistory(g,!0));const S=new ZX(g.id,this.serializeUrl(g.extractedUrl),_.message);f.next(S),b?setTimeout(()=>{const I=this.urlHandlingStrategy.merge(_.url,this.rawUrlTree),k={skipLocationChange:g.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Y$(g.source)};this.scheduleNavigation(I,"imperative",null,k,{resolve:g.resolve,reject:g.reject,promise:g.promise})},0):g.resolve(!1)}else{this.restoreHistory(g,!0);const b=new GSe(g.id,this.serializeUrl(g.extractedUrl),_);f.next(b);try{g.resolve(this.errorHandler(_))}catch(S){g.reject(S)}}return Df}))}))}resetRootComponentType(u){this.rootComponentType=u,this.routerState.root.component=this.rootComponentType}setTransition(u){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),u))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(u=>{const f="popstate"===u.type?"popstate":"hashchange";"popstate"===f&&setTimeout(()=>{var g;const m={replaceUrl:!0},v=(null===(g=u.state)||void 0===g?void 0:g.navigationId)?u.state:null;if(v){const b=Object.assign({},v);delete b.navigationId,delete b.\u0275routerPageId,0!==Object.keys(b).length&&(m.state=b)}const _=this.parseUrl(u.url);this.scheduleNavigation(_,f,v,m)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(u){this.events.next(u)}resetConfig(u){A$(u),this.config=u.map(W4),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(u,f={}){const{relativeTo:g,queryParams:m,fragment:v,queryParamsHandling:_,preserveFragment:b}=f,S=g||this.routerState.root,I=b?this.currentUrlTree.fragment:v;let k=null;switch(_){case"merge":k=Object.assign(Object.assign({},this.currentUrlTree.queryParams),m);break;case"preserve":k=this.currentUrlTree.queryParams;break;default:k=m||null}return null!==k&&(k=this.removeEmptyProps(k)),function T3e(p,l,u,f,g){if(0===u.length)return O4(l.root,l.root,l.root,f,g);const m=function I3e(p){if("string"==typeof p[0]&&1===p.length&&"/"===p[0])return new S$(!0,0,p);let l=0,u=!1;const f=p.reduce((g,m,v)=>{if("object"==typeof m&&null!=m){if(m.outlets){const _={};return Pa(m.outlets,(b,S)=>{_[S]="string"==typeof b?b.split("/"):b}),[...g,{outlets:_}]}if(m.segmentPath)return[...g,m.segmentPath]}return"string"!=typeof m?[...g,m]:0===v?(m.split("/").forEach((_,b)=>{0==b&&"."===_||(0==b&&""===_?u=!0:".."===_?l++:""!=_&&g.push(_))}),g):[...g,m]},[]);return new S$(u,l,f)}(u);if(m.toRoot())return O4(l.root,l.root,new hr([],{}),f,g);const v=function E3e(p,l,u){if(p.isAbsolute)return new F4(l.root,!0,0);if(-1===u.snapshot._lastPathIndex){const m=u.snapshot._urlSegment;return new F4(m,m===l.root,0)}const f=QT(p.commands[0])?0:1;return function D3e(p,l,u){let f=p,g=l,m=u;for(;m>g;){if(m-=g,f=f.parent,!f)throw new Error("Invalid number of '../'");g=f.segments.length}return new F4(f,!1,g-m)}(u.snapshot._urlSegment,u.snapshot._lastPathIndex+f,p.numberOfDoubleDots)}(m,l,p),_=v.processChildren?ZT(v.segmentGroup,v.index,m.commands):T$(v.segmentGroup,v.index,m.commands);return O4(l.root,v.segmentGroup,_,f,g)}(S,this.currentUrlTree,u,k,null!=I?I:null)}navigateByUrl(u,f={skipLocationChange:!1}){const g=Jm(u)?u:this.parseUrl(u),m=this.urlHandlingStrategy.merge(g,this.rawUrlTree);return this.scheduleNavigation(m,"imperative",null,f)}navigate(u,f={skipLocationChange:!1}){return function MTe(p){for(let l=0;l<p.length;l++){const u=p[l];if(null==u)throw new Error(`The requested path contains ${u} segment at index ${l}`)}}(u),this.navigateByUrl(this.createUrlTree(u,f),f)}serializeUrl(u){return this.urlSerializer.serialize(u)}parseUrl(u){let f;try{f=this.urlSerializer.parse(u)}catch(g){f=this.malformedUriErrorHandler(g,this.urlSerializer,u)}return f}isActive(u,f){let g;if(g=!0===f?Object.assign({},RTe):!1===f?Object.assign({},kTe):f,Jm(u))return l$(this.currentUrlTree,u,g);const m=this.parseUrl(u);return l$(this.currentUrlTree,m,g)}removeEmptyProps(u){return Object.keys(u).reduce((f,g)=>{const m=u[g];return null!=m&&(f[g]=m),f},{})}processNavigations(){this.navigations.subscribe(u=>{this.navigated=!0,this.lastSuccessfulId=u.id,this.currentPageId=u.targetPageId,this.events.next(new xb(u.id,this.serializeUrl(u.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,u.resolve(!0)},u=>{this.console.warn(`Unhandled Navigation Error: ${u}`)})}scheduleNavigation(u,f,g,m,v){var _,b;if(this.disposed)return Promise.resolve(!1);let S,I,k;v?(S=v.resolve,I=v.reject,k=v.promise):k=new Promise((W,J)=>{S=W,I=J});const O=++this.navigationId;let j;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(g=this.location.getState()),j=g&&g.\u0275routerPageId?g.\u0275routerPageId:m.replaceUrl||m.skipLocationChange?null!==(_=this.browserPageId)&&void 0!==_?_:0:(null!==(b=this.browserPageId)&&void 0!==b?b:0)+1):j=0,this.setTransition({id:O,targetPageId:j,source:f,restoredState:g,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:u,extras:m,resolve:S,reject:I,promise:k,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),k.catch(W=>Promise.reject(W))}setBrowserUrl(u,f){const g=this.urlSerializer.serialize(u),m=Object.assign(Object.assign({},f.extras.state),this.generateNgRouterState(f.id,f.targetPageId));this.location.isCurrentPathEqualTo(g)||f.extras.replaceUrl?this.location.replaceState(g,"",m):this.location.go(g,"",m)}restoreHistory(u,f=!1){var g,m;if("computed"===this.canceledNavigationResolution){const v=this.currentPageId-u.targetPageId;"popstate"!==u.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(g=this.currentNavigation)||void 0===g?void 0:g.finalUrl)||0===v?this.currentUrlTree===(null===(m=this.currentNavigation)||void 0===m?void 0:m.finalUrl)&&0===v&&(this.resetState(u),this.browserUrlTree=u.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(v)}else"replace"===this.canceledNavigationResolution&&(f&&this.resetState(u),this.resetUrlToCurrentUrlTree())}resetState(u){this.routerState=u.currentRouterState,this.currentUrlTree=u.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,u.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(u,f){const g=new ZX(u.id,this.serializeUrl(u.extractedUrl),f);this.triggerEvent(g),u.resolve(!1)}generateNgRouterState(u,f){return"computed"===this.canceledNavigationResolution?{navigationId:u,\u0275routerPageId:f}:{navigationId:u}}}return p.\u0275fac=function(u){LR()},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})();function Y$(p){return"imperative"!==p}let Mb=(()=>{class p{constructor(u,f,g){this.router=u,this.route=f,this.locationStrategy=g,this.commands=null,this.href=null,this.onChanges=new If,this.subscription=u.events.subscribe(m=>{m instanceof xb&&this.updateTargetUrlAndHref()})}set routerLink(u){this.commands=null!=u?Array.isArray(u)?u:[u]:null}ngOnChanges(u){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(u,f,g,m,v){if(0!==u||f||g||m||v||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const _={skipLocationChange:Dy(this.skipLocationChange),replaceUrl:Dy(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,_),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Dy(this.preserveFragment)})}}return p.\u0275fac=function(u){return new(u||p)(qt(kc),qt(Ey),qt(by))},p.\u0275dir=ii({type:p,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(u,f){1&u&&oi("click",function(m){return f.onClick(m.button,m.ctrlKey,m.shiftKey,m.altKey,m.metaKey)}),2&u&&wh("target",f.target)("href",f.href,U6)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Cu]}),p})();function Dy(p){return""===p||!!p}class X${}class $${preload(l,u){return Bi(null)}}let q$=(()=>{class p{constructor(u,f,g,m){this.router=u,this.injector=g,this.preloadingStrategy=m,this.loader=new G$(g,f,b=>u.triggerEvent(new e$(b)),b=>u.triggerEvent(new t$(b)))}setUpPreloading(){this.subscription=this.router.events.pipe(wy(u=>u instanceof xb),bb(()=>this.preload())).subscribe(()=>{})}preload(){const u=this.injector.get(Lf);return this.processRoutes(u,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(u,f){const g=[];for(const m of f)if(m.loadChildren&&!m.canLoad&&m._loadedConfig){const v=m._loadedConfig;g.push(this.processRoutes(v.module,v.routes))}else m.loadChildren&&!m.canLoad?g.push(this.preloadConfig(u,m)):m.children&&g.push(this.processRoutes(u,m.children));return va(g).pipe(bC(),co(m=>{}))}preloadConfig(u,f){return this.preloadingStrategy.preload(f,()=>(f._loadedConfig?Bi(f._loadedConfig):this.loader.load(u.injector,f)).pipe(ma(m=>(f._loadedConfig=m,this.processRoutes(m.module,m.routes)))))}}return p.\u0275fac=function(u){return new(u||p)(ri(kc),ri(Wz),ri(ec),ri(X$))},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})(),G4=(()=>{class p{constructor(u,f,g={}){this.router=u,this.viewportScroller=f,this.options=g,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},g.scrollPositionRestoration=g.scrollPositionRestoration||"disabled",g.anchorScrolling=g.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(u=>{u instanceof I4?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=u.navigationTrigger,this.restoredId=u.restoredState?u.restoredState.navigationId:0):u instanceof xb&&(this.lastId=u.id,this.scheduleScrollEvent(u,this.router.parseUrl(u.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(u=>{u instanceof n$&&(u.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(u.position):u.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(u.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(u,f){this.router.triggerEvent(new n$(u,"popstate"===this.lastSource?this.store[this.restoredId]:null,f))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return p.\u0275fac=function(u){LR()},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})();const Qm=new Yi("ROUTER_CONFIGURATION"),K$=new Yi("ROUTER_FORROOT_GUARD"),NTe=[kk,{provide:h$,useClass:f$},{provide:kc,useFactory:function jTe(p,l,u,f,g,m,v={},_,b){const S=new kc(null,p,l,u,f,g,o$(m));return _&&(S.urlHandlingStrategy=_),b&&(S.routeReuseStrategy=b),function HTe(p,l){p.errorHandler&&(l.errorHandler=p.errorHandler),p.malformedUriErrorHandler&&(l.malformedUriErrorHandler=p.malformedUriErrorHandler),p.onSameUrlNavigation&&(l.onSameUrlNavigation=p.onSameUrlNavigation),p.paramsInheritanceStrategy&&(l.paramsInheritanceStrategy=p.paramsInheritanceStrategy),p.relativeLinkResolution&&(l.relativeLinkResolution=p.relativeLinkResolution),p.urlUpdateStrategy&&(l.urlUpdateStrategy=p.urlUpdateStrategy),p.canceledNavigationResolution&&(l.canceledNavigationResolution=p.canceledNavigationResolution)}(v,S),v.enableTracing&&S.events.subscribe(I=>{var k,O;null===(k=console.group)||void 0===k||k.call(console,`Router Event: ${I.constructor.name}`),console.log(I.toString()),console.log(I),null===(O=console.groupEnd)||void 0===O||O.call(console)}),S},deps:[h$,Ab,kk,ec,Wz,j4,Qm,[class ETe{},new ng],[class STe{},new ng]]},Ab,{provide:Ey,useFactory:function GTe(p){return p.routerState.root},deps:[kc]},q$,$$,class LTe{preload(l,u){return u().pipe(dg(()=>Bi(null)))}},{provide:Qm,useValue:{enableTracing:!1}}];function BTe(){return new Gz("Router",kc)}let J$=(()=>{class p{constructor(u,f){}static forRoot(u,f){return{ngModule:p,providers:[NTe,Q$(u),{provide:K$,useFactory:VTe,deps:[[kc,new ng,new WC]]},{provide:Qm,useValue:f||{}},{provide:by,useFactory:UTe,deps:[zm,[new W3(Rk),new ng],Qm]},{provide:G4,useFactory:WTe,deps:[kc,zxe,Qm]},{provide:X$,useExisting:f&&f.preloadingStrategy?f.preloadingStrategy:$$},{provide:Gz,multi:!0,useFactory:BTe},[z4,{provide:gk,multi:!0,useFactory:zTe,deps:[z4]},{provide:Z$,useFactory:YTe,deps:[z4]},{provide:Bz,multi:!0,useExisting:Z$}]]}}static forChild(u){return{ngModule:p,providers:[Q$(u)]}}}return p.\u0275fac=function(u){return new(u||p)(ri(K$,8),ri(kc,8))},p.\u0275mod=gh({type:p}),p.\u0275inj=_d({}),p})();function WTe(p,l,u){return u.scrollOffset&&l.setOffset(u.scrollOffset),new G4(p,l,u)}function UTe(p,l,u={}){return u.useHash?new Tbe(p,l):new cY(p,l)}function VTe(p){return"guarded"}function Q$(p){return[{provide:rme,multi:!0,useValue:p},{provide:j4,multi:!0,useValue:p}]}let z4=(()=>{class p{constructor(u){this.injector=u,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new If}appInitializer(){return this.injector.get(xbe,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let f=null;const g=new Promise(_=>f=_),m=this.injector.get(kc),v=this.injector.get(Qm);return"disabled"===v.initialNavigation?(m.setUpLocationChangeListener(),f(!0)):"enabled"===v.initialNavigation||"enabledBlocking"===v.initialNavigation?(m.hooks.afterPreactivation=()=>this.initNavigation?Bi(null):(this.initNavigation=!0,f(!0),this.resultOfPreactivationDone),m.initialNavigation()):f(!0),g})}bootstrapListener(u){const f=this.injector.get(Qm),g=this.injector.get(q$),m=this.injector.get(G4),v=this.injector.get(kc),_=this.injector.get(Sk);u===_.components[0]&&(("enabledNonBlocking"===f.initialNavigation||void 0===f.initialNavigation)&&v.initialNavigation(),g.setUpPreloading(),m.init(),v.resetRootComponentType(_.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return p.\u0275fac=function(u){return new(u||p)(ri(ec))},p.\u0275prov=ur({token:p,factory:p.\u0275fac}),p})();function zTe(p){return p.appInitializer.bind(p)}function YTe(p){return p.bootstrapListener.bind(p)}const Z$=new Yi("Router Initializer");function eq(p,l,u,f,g,m,v){try{var _=p[m](v),b=_.value}catch(S){return void u(S)}_.done?l(b):Promise.resolve(b).then(f,g)}function Fe(p){return function(){var l=this,u=arguments;return new Promise(function(f,g){var m=p.apply(l,u);function v(b){eq(m,f,g,v,_,"next",b)}function _(b){eq(m,f,g,v,_,"throw",b)}v(void 0)})}}const $Te=[{id:"reader",name:"Barcode and QR Code Reader (File)",description:"Scan barcode and QR code from image files"},{id:"scanner",name:"Barcode and QR Code Scanner (Camera)",description:"Scan barcode and QR code from camera stream"},{id:"file-detection",name:"Document Detector (File)",description:"Detect document from image files"},{id:"camera-detection",name:"Document Scanner (Camera)",description:"Detect document from camera stream"},{id:"mrz-reader",name:"MRZ Reader (File)",description:"Scan MRZ from image files"},{id:"mrz-scanner",name:"MRZ Scanner (Camera)",description:"Scan MRZ from camera stream"},{id:"document-viewer",name:"Document Viewer (File)",description:"View, edit and save documents"},{id:"acquire-image",name:"Acquire Image (TWAIN/SANE/ICA Scanner)",description:"The basic document scanning functionality"},{id:"image-editor",name:"Image Editor (TWAIN/SANE/ICA Scanner)",description:"Image editing: rotate, mirror, flip and more"}];function ji(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function Zm(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}var ev,Ph,Hn,p;"function"==typeof SuppressedError&&SuppressedError,(p=ev||(ev={}))[p.BOPM_BLOCK=0]="BOPM_BLOCK",p[p.BOPM_UPDATE=1]="BOPM_UPDATE",function(p){p[p.CCUT_AUTO=0]="CCUT_AUTO",p[p.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",p[p.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",p[p.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",p[p.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",p[p.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(Ph||(Ph={})),function(p){p[p.IPF_BINARY=0]="IPF_BINARY",p[p.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",p[p.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",p[p.IPF_NV21=3]="IPF_NV21",p[p.IPF_RGB_565=4]="IPF_RGB_565",p[p.IPF_RGB_555=5]="IPF_RGB_555",p[p.IPF_RGB_888=6]="IPF_RGB_888",p[p.IPF_ARGB_8888=7]="IPF_ARGB_8888",p[p.IPF_RGB_161616=8]="IPF_RGB_161616",p[p.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",p[p.IPF_ABGR_8888=10]="IPF_ABGR_8888",p[p.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",p[p.IPF_BGR_888=12]="IPF_BGR_888",p[p.IPF_BINARY_8=13]="IPF_BINARY_8",p[p.IPF_NV12=14]="IPF_NV12",p[p.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(Hn||(Hn={}));const tq=p=>Object.prototype.toString.call(p),Y4=p=>Array.isArray?Array.isArray(p):"[object Array]"===tq(p),X4=p=>"[object Boolean]"===tq(p),ds=p=>"number"==typeof p&&!Number.isNaN(p),Od=p=>null!==p&&"object"==typeof p&&!Array.isArray(p),nq=p=>!(!Od(p)||!(p.bytes instanceof Uint8Array)||!ds(p.width)||p.width<=0||!ds(p.height)||p.height<=0||!ds(p.stride)||p.stride<=0||!("format"in p)||"tag"in p&&!KTe(p.tag)),KTe=p=>!!Od(p)&&!!ds(p.imageId)&&"type"in p,Ay=p=>!!Od(p)&&!!ds(p.x)&&!!ds(p.y);function $4(p,l){return q4.apply(this,arguments)}function q4(){return q4=Fe(function*(p,l){return yield new Promise((u,f)=>{let g=new XMLHttpRequest;g.open("GET",p,!0),g.responseType=l,g.send(),g.onloadend=Fe(function*(){g.status<200||g.status>=300?f(p+" "+g.status):u(g.response)}),g.onerror=()=>{f(new Error("Network Error: "+g.statusText))}})}),q4.apply(this,arguments)}const Mc=(p,l)=>{let u=p.split("."),f=l.split(".");for(let g=0;g<u.length&&g<f.length;++g){let m=u[g],v=f[g];if(m===v)continue;let _=parseInt(u[g]),b=parseInt(f[g]);return _===b||Number.isNaN(_)&&Number.isNaN(b)?m<v?-1:1:_<b||Number.isNaN(_)&&Number.isInteger(b)?-1:1}return u.length===f.length?0:u.length<f.length?-1:1},tIe="function"==typeof BigInt;var sI,Us,tv,Ob,Fb,Pu,nv,K4;class Ru{get _isFetchingStarted(){return ji(this,Fb,"f")}constructor(){sI.add(this),Us.set(this,[]),tv.set(this,1),Ob.set(this,ev.BOPM_BLOCK),Fb.set(this,!1),Pu.set(this,void 0),nv.set(this,Ph.CCUT_AUTO)}setErrorListener(l){}addImageToBuffer(l){var u;if(!nq(l))throw new TypeError("Invalid 'image'.");if((null===(u=l.tag)||void 0===u?void 0:u.hasOwnProperty("imageId"))&&"number"==typeof l.tag.imageId&&this.hasImage(l.tag.imageId))throw new Error("Existed imageId.");if(ji(this,Us,"f").length>=ji(this,tv,"f"))switch(ji(this,Ob,"f")){case ev.BOPM_BLOCK:break;case ev.BOPM_UPDATE:if(ji(this,Us,"f").push(l),Od(ji(this,Pu,"f"))&&ds(ji(this,Pu,"f").imageId)&&1==ji(this,Pu,"f").keepInBuffer)for(;ji(this,Us,"f").length>ji(this,tv,"f");){const f=ji(this,Us,"f").findIndex(g=>{var m;return(null===(m=g.tag)||void 0===m?void 0:m.imageId)!==ji(this,Pu,"f").imageId});ji(this,Us,"f").splice(f,1)}else ji(this,Us,"f").splice(0,ji(this,Us,"f").length-ji(this,tv,"f"))}else ji(this,Us,"f").push(l)}getImage(){if(0===ji(this,Us,"f").length)return null;let l;if(ji(this,Pu,"f")&&ds(ji(this,Pu,"f").imageId)){const u=ji(this,sI,"m",K4).call(this,ji(this,Pu,"f").imageId);if(u<0)throw new Error(`Image with id ${ji(this,Pu,"f").imageId} doesn't exist.`);l=ji(this,Us,"f").slice(u,u+1)[0]}else l=ji(this,Us,"f").pop();if([Hn.IPF_RGB_565,Hn.IPF_RGB_555,Hn.IPF_RGB_888,Hn.IPF_ARGB_8888,Hn.IPF_RGB_161616,Hn.IPF_ARGB_16161616,Hn.IPF_ABGR_8888,Hn.IPF_ABGR_16161616,Hn.IPF_BGR_888].includes(l.format)){if(ji(this,nv,"f")===Ph.CCUT_RGB_R_CHANNEL_ONLY){Ru._onLog&&Ru._onLog("only get R channel data.");const u=new Uint8Array(l.width*l.height);for(let f=0;f<u.length;f++)switch(l.format){case Hn.IPF_RGB_565:case Hn.IPF_RGB_555:case Hn.IPF_RGB_888:case Hn.IPF_RGB_161616:u[f]=l.bytes[3*f+2];break;case Hn.IPF_ARGB_8888:case Hn.IPF_ARGB_16161616:u[f]=l.bytes[4*f+2];break;case Hn.IPF_BGR_888:u[f]=l.bytes[3*f];break;case Hn.IPF_ABGR_8888:case Hn.IPF_ABGR_16161616:u[f]=l.bytes[4*f]}l.bytes=u,l.stride=l.width,l.format=Hn.IPF_GRAYSCALED}else if(ji(this,nv,"f")===Ph.CCUT_RGB_G_CHANNEL_ONLY){Ru._onLog&&Ru._onLog("only get G channel data.");const u=new Uint8Array(l.width*l.height);for(let f=0;f<u.length;f++)switch(l.format){case Hn.IPF_RGB_565:case Hn.IPF_RGB_555:case Hn.IPF_RGB_888:case Hn.IPF_RGB_161616:case Hn.IPF_BGR_888:u[f]=l.bytes[3*f+1];break;case Hn.IPF_ARGB_8888:case Hn.IPF_ARGB_16161616:case Hn.IPF_ABGR_8888:case Hn.IPF_ABGR_16161616:u[f]=l.bytes[4*f+1]}l.bytes=u,l.stride=l.width,l.format=Hn.IPF_GRAYSCALED}else if(ji(this,nv,"f")===Ph.CCUT_RGB_B_CHANNEL_ONLY){Ru._onLog&&Ru._onLog("only get B channel data.");const u=new Uint8Array(l.width*l.height);for(let f=0;f<u.length;f++)switch(l.format){case Hn.IPF_RGB_565:case Hn.IPF_RGB_555:case Hn.IPF_RGB_888:case Hn.IPF_RGB_161616:u[f]=l.bytes[3*f];break;case Hn.IPF_ARGB_8888:case Hn.IPF_ARGB_16161616:u[f]=l.bytes[4*f];break;case Hn.IPF_BGR_888:u[f]=l.bytes[3*f+2];break;case Hn.IPF_ABGR_8888:case Hn.IPF_ABGR_16161616:u[f]=l.bytes[4*f+2]}l.bytes=u,l.stride=l.width,l.format=Hn.IPF_GRAYSCALED}}else[Hn.IPF_NV21,Hn.IPF_NV12].includes(l.format)&&Ru._onLog&&Ru._onLog("NV21 or NV12 is not supported.");return l}setNextImageToReturn(l,u){if(!((...f)=>0!==f.length&&f.every(g=>ds(g)))(l))throw new TypeError("Invalid 'imageId'.");if(void 0!==u&&!X4(u))throw new TypeError("Invalid 'keepInBuffer'.");Zm(this,Pu,{imageId:l,keepInBuffer:u},"f")}_resetNextReturnedImage(){Zm(this,Pu,null,"f")}hasImage(l){return ji(this,sI,"m",K4).call(this,l)>=0}startFetching(){Zm(this,Fb,!0,"f")}stopFetching(){Zm(this,Fb,!1,"f")}setMaxImageCount(l){if("number"!=typeof l)throw new TypeError("Invalid 'count'.");if(l<1||Math.round(l)!==l)throw new Error("Invalid 'count'.");for(Zm(this,tv,l,"f");ji(this,Us,"f")&&ji(this,Us,"f").length>l;)ji(this,Us,"f").shift()}getMaxImageCount(){return ji(this,tv,"f")}getImageCount(){return ji(this,Us,"f").length}clearBuffer(){ji(this,Us,"f").length=0}isBufferEmpty(){return 0===ji(this,Us,"f").length}setBufferOverflowProtectionMode(l){Zm(this,Ob,l,"f")}getBufferOverflowProtectionMode(){return ji(this,Ob,"f")}setColourChannelUsageType(l){Zm(this,nv,l,"f")}getColourChannelUsageType(){return ji(this,nv,"f")}}Us=new WeakMap,tv=new WeakMap,Ob=new WeakMap,Fb=new WeakMap,Pu=new WeakMap,nv=new WeakMap,sI=new WeakSet,K4=function(p){if("number"!=typeof p)throw new TypeError("Invalid 'imageId'.");return ji(this,Us,"f").findIndex(l=>{var u;return(null===(u=l.tag)||void 0===u?void 0:u.imageId)===p})};const aI="undefined"==typeof self,iq=(()=>{if(!aI&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),rq=p=>{if(null==p&&(p="./"),!aI){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p};let Lb,jf,lI,cI,nc;"undefined"!=typeof navigator&&(Lb=navigator,jf=Lb.userAgent,lI=Lb.platform,cI=Lb.mediaDevices),function(){if(!aI){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Lb.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:lI,search:"Win"},Mac:{str:lI},Linux:{str:lI}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let S=v.verStr||jf,I=v.verSearch||m;if(I instanceof Array||(I=[I]),-1!=(v.str||jf).indexOf(v.search||m)){u=m;for(let k of I){let O=S.indexOf(k);if(-1!=O){f=parseFloat(S.substring(O+k.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||jf).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=jf.indexOf("Windows NT")&&(g="HarmonyOS"),nc={browser:u,version:f,OS:g}}aI&&(nc={browser:"ssr",version:0,OS:"ssr"})}();const nIe="undefined"!=typeof WebAssembly&&jf&&!(/Safari/.test(jf)&&!/Chrome/.test(jf)&&/\(.+\s11_2_([2-6]).*\)/.test(jf)),iIe="undefined"!=typeof Worker,oq=!(!cI||!cI.getUserMedia),rIe=function(){var p=Fe(function*(){let l=!1;if(oq)try{(yield cI.getUserMedia({video:!0})).getTracks().forEach(u=>{u.stop()}),l=!0}catch(u){}return l});return function(){return p.apply(this,arguments)}}(),sq=p=>p&&"object"==typeof p&&"function"==typeof p.then;class uI extends Promise{constructor(l){let u,f;super((g,m)=>{u=g,f=m}),this._s="pending",this.resolve=g=>{this.isPending&&(sq(g)?this.task=g:(this._s="fulfilled",u(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let f;this._task=l,sq(l)?f=l:"function"==typeof l&&(f=new Promise(l)),f&&Fe(function*(){try{const g=yield f;l===u._task&&u.resolve(g)}catch(g){l===u._task&&u.reject(g)}})()}get isEmpty(){return null==this._task}}const ku={},aq=function(){var p=Fe(function*(l){let u="string"==typeof l?[l]:l,f=[];for(let g of u)f.push(ku[g]=ku[g]||new uI);yield Promise.all(f)});return function(u){return p.apply(this,arguments)}}(),dI=function(){var p=Fe(function*(l,u){let f,g="string"==typeof l?[l]:l,m=[];for(let v of g){let _;m.push(_=ku[v]=ku[v]||new uI(f=f||u())),_.isEmpty&&(_.task=f=f||u())}yield Promise.all(m)});return function(u,f){return p.apply(this,arguments)}}();let ai,lq=0;const fr=()=>lq++,Ii={};let fg,J4=!1;const Rl={},no={},wn={std:{version:"1.2.10",path:rq(iq+"../../dynamsoft-capture-vision-std@1.2.10/dist/")},core:{version:"3.2.30",path:iq}},Nb=new Proxy(wn,{get(p,l,u){let f=Reflect.get(p,l,u);return f&&f.path&&(f=f.path),f}}),Mu={dip:{wasm:!0}},Oc=function(){var p=Fe(function*(l){let u;l instanceof Array||(l=l?[l]:[]);{let m=ku.core;u=!m||m.isEmpty}let f=new Map;for(let m of l){if(m=m.toLowerCase(),"std"==m||"core"==m)continue;if(!Mu[m])throw Error("The '"+m+"' module cannot be found.");let v=Mu[m].deps;if(null==v?void 0:v.length)for(let b of v){let S=ku[b];f.has(b)||f.set(b,!S||S.isEmpty)}let _=ku[m];f.has(m)||f.set(m,!_||_.isEmpty)}let g=[];u&&g.push("core"),g.push(...f.keys()),yield dI(g,Fe(function*(){const m=[...f.entries()].filter(k=>k[1]).map(k=>k[0]),v={};for(let k in Nb){if("rootDirectory"==k)continue;let O=Nb[k];Nb.rootDirectory&&(O.startsWith("http://")||O.startsWith("https://")||(O=Nb.rootDirectory+"/"+O)),v[k]=rq(O)}const _={};for(let k of m)_[k]=Mu[k];const b={engineResourcePaths:v,autoResources:_,names:m};let S=new uI;if(u){b.needLoadCore=!0;let k=v.core+Yr._workerName;v.rootDirectory&&(k=v.rootDirectory+k),k.startsWith(location.origin)||(k=yield fetch(k).then(O=>O.blob()).then(O=>URL.createObjectURL(O))),ai=new Worker(k),ai.onerror=O=>{let j=new Error(O.message);S.reject(j)},ai.addEventListener("message",O=>{let j=O.data?O.data:O,J=j.id,K=j.body;switch(j.type){case"log":fg&&fg(j.message);break;case"task":try{Ii[J](K),delete Ii[J]}catch(Q){throw delete Ii[J],Q}break;case"event":try{Ii[J](K)}catch(Q){throw Q}break;default:console.log(O)}}),b.bLog=!!fg,b.bd=J4,b.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else yield aq("worker");let I=lq++;Ii[I]=k=>{if(k.success)Object.assign(Rl,k.versions),"{}"!==JSON.stringify(k.versions)&&(Yr._versions=k.versions),S.resolve(void 0);else{const O=Error(k.message);k.stack&&(O.stack=k.stack),S.reject(O)}},ai.postMessage({type:"loadWasm",body:b,id:I}),u&&dI("worker",()=>Promise.resolve()),yield S}))});return function(u){return p.apply(this,arguments)}}();class Yr{static get engineResourcePaths(){return Nb}static set engineResourcePaths(l){Object.assign(wn,l)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return fg}static set _onLog(l){(p=>{fg=p,ai&&ai.postMessage({type:"setBLog",body:{value:!!p}})})(l)}static get _bDebug(){return J4}static set _bDebug(l){(p=>{J4=p,ai&&ai.postMessage({type:"setBDebug",body:{value:!!p}})})(l)}static isModuleLoaded(l){return l=(l=l||"core").toLowerCase(),!!ku[l]&&ku[l].isFulfilled}static loadWasm(l){return Fe(function*(){return yield Oc(l)})()}static detectEnvironment(){return Fe(function*(){return yield Fe(function*(){return{wasm:nIe,worker:iIe,getUserMedia:oq,camera:yield rIe(),browser:nc.browser,version:nc.version,OS:nc.OS}})()})()}static getModuleVersion(){return Fe(function*(){return yield new Promise((l,u)=>{let f=fr();Ii[f]=function(){var g=Fe(function*(m){if(m.success)return l(m.versions);{let v=new Error(m.message);return v.stack=m.stack+"\n"+v.stack,u(v)}});return function(m){return g.apply(this,arguments)}}(),ai.postMessage({type:"getModuleVersion",id:f})})})()}static getVersion(){return`3.2.30(Worker: ${Rl.core&&Rl.core.worker||"Not Loaded"}, Wasm: ${Rl.core&&Rl.core.wasm||"Not Loaded"})`}static enableLogging(){Ru._onLog=console.log,Yr._onLog=console.log}static disableLogging(){Ru._onLog=null,Yr._onLog=null}static cfd(l){return Fe(function*(){return yield new Promise((u,f)=>{let g=fr();Ii[g]=function(){var m=Fe(function*(v){if(v.success)return u();{let _=new Error(v.message);return _.stack=v.stack+"\n"+_.stack,f(_)}});return function(v){return m.apply(this,arguments)}}(),ai.postMessage({type:"cfd",id:g,body:{count:l}})})})()}}var io,cq,Q4,uq,dq,hI,hq,fq,Py,pq,gq;Yr._bSupportDce4Module=-1,Yr._bSupportIRTModule=-1,Yr._versions=null,Yr._workerName="core.worker.js",Yr.browserInfo=nc,function(p){p[p.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",p[p.CRIT_BARCODE=2]="CRIT_BARCODE",p[p.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",p[p.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",p[p.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",p[p.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(io||(io={})),function(p){p[p.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",p[p.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",p[p.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",p[p.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(cq||(cq={})),function(p){p[p.EC_OK=0]="EC_OK",p[p.EC_UNKNOWN=-1e4]="EC_UNKNOWN",p[p.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",p[p.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",p[p.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",p[p.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",p[p.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",p[p.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",p[p.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",p[p.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",p[p.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",p[p.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",p[p.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",p[p.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",p[p.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",p[p.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",p[p.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",p[p.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",p[p.EC_TIMEOUT=-10026]="EC_TIMEOUT",p[p.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",p[p.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",p[p.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",p[p.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",p[p.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",p[p.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",p[p.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",p[p.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",p[p.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",p[p.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",p[p.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",p[p.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",p[p.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",p[p.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",p[p.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",p[p.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",p[p.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",p[p.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",p[p.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",p[p.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",p[p.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",p[p.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",p[p.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",p[p.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",p[p.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",p[p.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",p[p.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",p[p.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",p[p.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",p[p.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",p[p.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",p[p.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",p[p.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",p[p.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",p[p.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",p[p.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",p[p.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",p[p.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",p[p.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",p[p.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",p[p.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",p[p.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",p[p.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",p[p.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",p[p.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",p[p.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",p[p.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",p[p.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",p[p.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",p[p.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",p[p.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",p[p.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",p[p.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",p[p.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",p[p.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",p[p.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",p[p.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",p[p.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",p[p.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",p[p.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",p[p.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",p[p.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",p[p.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",p[p.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",p[p.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",p[p.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",p[p.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",p[p.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",p[p.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",p[p.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",p[p.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",p[p.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",p[p.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",p[p.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",p[p.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",p[p.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",p[p.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",p[p.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",p[p.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",p[p.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",p[p.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",p[p.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(Q4||(Q4={})),function(p){p[p.GEM_SKIP=0]="GEM_SKIP",p[p.GEM_AUTO=1]="GEM_AUTO",p[p.GEM_GENERAL=2]="GEM_GENERAL",p[p.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",p[p.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",p[p.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",p[p.GEM_REV=-2147483648]="GEM_REV"}(uq||(uq={})),function(p){p[p.GTM_SKIP=0]="GTM_SKIP",p[p.GTM_INVERTED=1]="GTM_INVERTED",p[p.GTM_ORIGINAL=2]="GTM_ORIGINAL",p[p.GTM_AUTO=4]="GTM_AUTO",p[p.GTM_REV=-2147483648]="GTM_REV"}(dq||(dq={})),function(p){p[p.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",p[p.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(hI||(hI={})),function(p){p[p.PDFRM_VECTOR=1]="PDFRM_VECTOR",p[p.PDFRM_RASTER=2]="PDFRM_RASTER",p[p.PDFRM_REV=-2147483648]="PDFRM_REV"}(hq||(hq={})),function(p){p[p.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",p[p.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(fq||(fq={})),function(p){p[p.IRUT_NULL=0]="IRUT_NULL",p[p.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",p[p.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",p[p.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",p[p.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",p[p.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",p[p.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",p[p.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",p[p.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",p[p.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",p[p.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",p[p.IRUT_CONTOURS=1024]="IRUT_CONTOURS",p[p.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",p[p.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",p[p.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",p[p.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",p[p.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",p[p.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",p[p.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",p[p.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",p[p.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",p[p.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",p[p.IRUT_CORNERS=2097152]="IRUT_CORNERS",p[p.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",p[p.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",p[p.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",p[p.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",p[p.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",p[p.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",p[p.IRUT_ALL=268435455]="IRUT_ALL"}(Py||(Py={})),function(p){p[p.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",p[p.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",p[p.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",p[p.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",p[p.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",p[p.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",p[p.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",p[p.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",p[p.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(pq||(pq={})),function(p){p[p.ST_NULL=0]="ST_NULL",p[p.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",p[p.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",p[p.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",p[p.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",p[p.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",p[p.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",p[p.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(gq||(gq={}));const pg="undefined"==typeof self,mq=pg?{}:self,vq=(()=>{if(!pg&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),yq=p=>{if(null==p&&(p="./"),!pg){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p},_q=p=>p&&"object"==typeof p&&"function"==typeof p.then;class Z4 extends Promise{constructor(l){let u,f;super((g,m)=>{u=g,f=m}),this._s="pending",this.resolve=g=>{this.isPending&&(_q(g)?this.task=g:(this._s="fulfilled",u(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let f;this._task=l,_q(l)?f=l:"function"==typeof l&&(f=new Promise(l)),f&&Fe(function*(){try{const g=yield f;l===u._task&&u.resolve(g)}catch(g){l===u._task&&u.reject(g)}})()}get isEmpty(){return null==this._task}}const fI=" is not allowed to change after `createInstance` or `loadWasm` is called.",aIe=!pg&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Cq=(p,l)=>{const u=p;if(!u._pLoad.isEmpty)throw new Error("`license`"+fI);u._license=l};!pg&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const bq=p=>{if(null==p)p=[];else{p=p instanceof Array?[...p]:[p];for(let l=0;l<p.length;++l){if(!pg){let u=document.createElement("a");u.href=p[l],p[l]=u.href}p[l].endsWith("/")||(p[l]+="/")}}return p},xq=(p,l)=>{const u=p;if(!u._pLoad.isEmpty)throw new Error("`licenseServer`"+fI);u._licenseServer=bq(l)},wq=(p,l)=>{const u=p;if(!u._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+fI);u._deviceFriendlyName=l||""};let Bb,Wb,pI,eM,Fd;"undefined"!=typeof navigator&&(Bb=navigator,Wb=Bb.userAgent,pI=Bb.platform,eM=Bb.mediaDevices),function(){if(!pg){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Bb.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:pI,search:"Win"},Mac:{str:pI},Linux:{str:pI}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let S=v.verStr||Wb,I=v.verSearch||m;if(I instanceof Array||(I=[I]),-1!=(v.str||Wb).indexOf(v.search||m)){u=m;for(let k of I){let O=S.indexOf(k);if(-1!=O){f=parseFloat(S.substring(O+k.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Wb).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=Wb.indexOf("Windows NT")&&(g="HarmonyOS"),Fd={browser:u,version:f,OS:g}}pg&&(Fd={browser:"ssr",version:0,OS:"ssr"})}();const Sq=function(){var p=Fe(function*(){return Oc("license"),dI("dynamsoft_inited",Fe(function*(){let{lt:l,l:u,ls:f,sp:g,rmk:m,cv:v}=((S,I=!1)=>{const k=S;if(k._pLoad.isEmpty){let O,j,W,J=k._license||"",K=JSON.parse(JSON.stringify(k._licenseServer)),Q=k._sessionPassword,ie=0;if(J.startsWith("t")||J.startsWith("f"))ie=0;else if(0===J.length||J.startsWith("P")||J.startsWith("L")||J.startsWith("Y")||J.startsWith("A"))ie=1;else{ie=2;const oe=J.indexOf(":");-1!=oe&&(J=J.substring(oe+1));const le=J.indexOf("?");if(-1!=le&&(j=J.substring(le+1),J=J.substring(0,le)),J.startsWith("DLC2"))ie=0;else{if(J.startsWith("DLS2")){let he;try{let _e=J.substring(4);_e=atob(_e),he=JSON.parse(_e)}catch(_e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(J=he.handshakeCode?he.handshakeCode:he.organizationID?he.organizationID:"","number"==typeof J&&(J=JSON.stringify(J)),0===K.length){let _e=[];he.mainServerURL&&(_e[0]=he.mainServerURL),he.standbyServerURL&&(_e[1]=he.standbyServerURL),K=bq(_e)}!Q&&he.sessionPassword&&(Q=he.sessionPassword),O=he.remark}J&&"200001"!==J&&!J.startsWith("200001-")||(ie=1)}}if(ie&&(I||(mq.crypto||(W="Please upgrade your browser to support online key."),mq.crypto.subtle||(W="Require https to use online key in this browser."))),W){if(1!==ie)throw new Error(W);ie=0,console.warn(W),k._lastErrorCode=-1,k._lastErrorString=W}return 1===ie&&(J="",console.warn("Applying for a public trial license ...")),{lt:ie,l:J,ls:K,sp:Q,rmk:O,cv:j}}throw new Error("Can't preprocess license again"+fI)})(ro),_=new Z4;ro._pLoad.task=_,Fe(function*(){try{yield ro._pLoad}catch(S){}})();let b=fr();Ii[b]=S=>{if(S.message&&ro._onAuthMessage){let O=ro._onAuthMessage(S.message);null!=O&&(S.message=O)}let I,k=!1;if(1===l&&(k=!0),S.success?(fg&&fg("init license success"),S.message&&console.warn(S.message),Yr._bSupportIRTModule=S.bSupportIRTModule,Yr._bSupportDce4Module=S.bSupportDce4Module,ro.bPassValidation=!0):(I=Error(S.message),S.stack&&(I.stack=S.stack),S.ltsErrorCode&&(I.ltsErrorCode=S.ltsErrorCode),k||111==S.ltsErrorCode&&-1!=S.message.toLowerCase().indexOf("trial license")&&(k=!0)),k){let O=wn.license;wn.rootDirectory&&(O=wn.rootDirectory+"/"+O),O=yq(O),(j=Fe(function*(W,J,K){if(!W._bNeverShowDialog)try{let Q=yield fetch(W.engineResourcePath+"dls.license.dialog.html");if(!Q.ok)throw Error("Get license dialog fail. Network Error: "+Q.statusText);let ie=yield Q.text();if(!ie.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let oe=document.createElement("div");oe.innerHTML=ie;let le=[];for(let F=0;F<oe.childElementCount;++F){let z=oe.children[F];z instanceof HTMLStyleElement&&(le.push(z),document.head.append(z))}let he=1==oe.childElementCount?oe.children[0]:oe;he.remove();let _e,Ve,ee,ke,xe,Le=[he],V=he.children;for(let F of V)Le.push(F);for(let F=0;F<Le.length;++F)for(let z of Le[F].children)Le.push(z);for(let F of Le)if(!_e&&F.classList.contains("dls-license-mask"))_e=F,F.addEventListener("click",z=>{if(F==z.target){he.remove();for(let $ of le)$.remove()}});else if(!Ve&&F.classList.contains("dls-license-icon-close"))Ve=F,F.addEventListener("click",()=>{he.remove();for(let z of le)z.remove()});else if(!ee&&F.classList.contains("dls-license-icon-error"))ee=F,"error"!=J&&F.remove();else if(!ke&&F.classList.contains("dls-license-icon-warn"))ke=F,"warn"!=J&&F.remove();else if(!xe&&F.classList.contains("dls-license-msg-content")){xe=F;let z=K;for(;z;){let $=z.indexOf("["),P=z.indexOf("]",$),L=z.indexOf("(",P),X=z.indexOf(")",L);if(-1==$||-1==P||-1==L||-1==X){F.appendChild(new Text(z));break}$>0&&F.appendChild(new Text(z.substring(0,$)));let ne=document.createElement("a"),Z=z.substring($+1,P);ne.innerText=Z;let te=z.substring(L+1,X);ne.setAttribute("href",te),ne.setAttribute("target","_blank"),F.appendChild(ne),z=z.substring(X+1)}}document.body.appendChild(he)}catch(Q){W._onLog&&W._onLog(Q.message||Q)}}),function(W,J,K){return j.apply(this,arguments)})({_bNeverShowDialog:ro._bNeverShowDialog,engineResourcePath:O,_onLog:fg},S.success?"warn":"error",S.message)}var j;S.success?_.resolve(void 0):_.reject(I)},yield aq("worker"),ai.postMessage({type:"dynamsoft",body:{v:"3.2.21",brtk:!!l,bptk:1===l,l:u,os:Fd,fn:ro.deviceFriendlyName,ls:f,sp:g,rmk:m,cv:v},id:b}),ro.bCallInitLicense=!0,yield _}))});return function(){return p.apply(this,arguments)}}();let Tq;no.license={},no.license.dynamsoft=Sq,no.license.getAR=Fe(function*(){{let p=ku.dynamsoft_inited;p&&p.isRejected&&(yield p)}return ai?new Promise((p,l)=>{let u=fr();Ii[u]=function(){var f=Fe(function*(g){if(g.success){delete g.success;{let m=ro.license;m&&(m.startsWith("t")||m.startsWith("f"))&&(g.pk=m)}if(Object.keys(g).length){if(g.lem){let m=Error(g.lem);m.ltsErrorCode=g.lec,delete g.lem,delete g.lec,g.ae=m}p(g)}else p(null)}else{let m=Error(g.message);g.stack&&(m.stack=g.stack),l(m)}});return function(g){return f.apply(this,arguments)}}(),ai.postMessage({type:"getAR",id:u})}):null});class ro{static setLicenseServer(l){xq(ro,l)}static get license(){return this._license}static set license(l){Cq(ro,l)}static get licenseServer(){return this._licenseServer}static set licenseServer(l){xq(ro,l)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(l){wq(ro,l)}static initLicense(l,u){if(Cq(ro,l),ro.bCallInitLicense=!0,u)return Sq()}static setDeviceFriendlyName(l){wq(ro,l)}static getDeviceFriendlyName(){return ro._deviceFriendlyName}static getDeviceUUID(){return Fe(function*(){return yield dI("dynamsoft_uuid",Fe(function*(){yield Oc();let l=new Z4,u=fr();Ii[u]=f=>{if(f.success)l.resolve(f.uuid);else{const g=Error(f.message);f.stack&&(g.stack=f.stack),l.reject(g)}},ai.postMessage({type:"getDeviceUUID",id:u}),Tq=yield l})),Tq})()}}ro._pLoad=new Z4,ro.bPassValidation=!1,ro.bCallInitLicense=!1,ro._license=aIe,ro._licenseServer=[],ro._deviceFriendlyName="",null==wn.license&&(wn.license=vq),Mu.license={wasm:!0},no.license.LicenseManager=ro;const tM="1.2.10";"string"!=typeof wn.std&&Mc(wn.std.version,tM)<0&&(wn.std={version:tM,path:yq(vq+`../../dynamsoft-capture-vision-std@${tM}/dist/`)});const Iq=p=>p&&"object"==typeof p&&"function"==typeof p.then;class Ry extends Promise{constructor(l){let u,f;super((g,m)=>{u=g,f=m}),this._s="pending",this.resolve=g=>{this.isPending&&(Iq(g)?this.task=g:(this._s="fulfilled",u(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let f;this._task=l,Iq(l)?f=l:"function"==typeof l&&(f=new Promise(l)),f&&Fe(function*(){try{const g=yield f;l===u._task&&u.resolve(g)}catch(g){l===u._task&&u.reject(g)}})()}get isEmpty(){return null==this._task}}class lIe{constructor(l){this._cvr=l}getMaxBufferedItems(){var l=this;return Fe(function*(){return yield new Promise((u,f)=>{let g=fr();Ii[g]=function(){var m=Fe(function*(v){if(v.success)return u(v.count);{let _=new Error(v.message);return _.stack=v.stack+"\n"+_.stack,f(_)}});return function(v){return m.apply(this,arguments)}}(),ai.postMessage({type:"cvr_getMaxBufferedItems",id:g,instanceID:l._cvr._instanceID})})})()}setMaxBufferedItems(l){var u=this;return Fe(function*(){return yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success)return f();{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"cvr_setMaxBufferedItems",id:m,instanceID:u._cvr._instanceID,body:{count:l}})})})()}getBufferedCharacterItemSet(){var l=this;return Fe(function*(){return yield new Promise((u,f)=>{let g=fr();Ii[g]=function(){var m=Fe(function*(v){if(v.success)return u(v.itemSet);{let _=new Error(v.message);return _.stack=v.stack+"\n"+_.stack,f(_)}});return function(v){return m.apply(this,arguments)}}(),ai.postMessage({type:"cvr_getBufferedCharacterItemSet",id:g,instanceID:l._cvr._instanceID})})})()}}var cIe={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const Eq=(p,l)=>{for(let u in l._irrRegistryState)l._irrRegistryState[u]=!1;for(let u of p._intermediateResultReceiverSet)if(u.isDce)l._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let f in u)l._irrRegistryState[f]||(l._irrRegistryState[f]=!!u[f])};class uIe{constructor(l){this._irrRegistryState=cIe,this._cvr=l}addResultReceiver(l){var u=this;return Fe(function*(){if("object"!=typeof l)throw new Error("Invalid receiver.");u._cvr._intermediateResultReceiverSet.add(l),Eq(u._cvr,u);let f=-1,g={};if(!l.isDce){if(!l._observedResultUnitTypes||!l._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");f=l._observedResultUnitTypes,l._observedTaskMap.forEach((m,v)=>{g[v]=m}),l._observedTaskMap.clear()}return yield new Promise((m,v)=>{let _=fr();Ii[_]=function(){var b=Fe(function*(S){if(S.success)return m();{let I=new Error(S.message);return I.stack=S.stack+"\n"+I.stack,v(I)}});return function(S){return b.apply(this,arguments)}}(),ai.postMessage({type:"cvr_setIrrRegistry",id:_,instanceID:u._cvr._instanceID,body:{receiverObj:u._irrRegistryState,observedResultUnitTypes:String(f),observedTaskMap:g}})})})()}removeResultReceiver(l){var u=this;return Fe(function*(){return u._cvr._intermediateResultReceiverSet.delete(l),Eq(u._cvr,u),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success)return f();{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"cvr_setIrrRegistry",id:m,instanceID:u._cvr._instanceID,body:{receiverObj:u._irrRegistryState}})})})()}getOriginalImage(){return this._cvr._dsImage}}const Dq="undefined"==typeof self,nM=(()=>{if(!Dq&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),Aq=p=>{if(null==p&&(p="./"),!Dq){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p};var iM;null==wn.cvr&&(wn.cvr=nM),Mu.cvr={js:!0,wasm:!0,deps:["license","dip"]},no.cvr={};const rM="1.2.10";"string"!=typeof wn.std&&Mc(wn.std.version,rM)<0&&(wn.std={version:rM,path:Aq(nM+`../../dynamsoft-capture-vision-std@${rM}/dist/`)});const oM="2.2.30";(!wn.dip||"string"!=typeof wn.dip&&Mc(wn.dip.version,oM)<0)&&(wn.dip={version:oM,path:Aq(nM+`../../dynamsoft-image-processing@${oM}/dist/`)});class Pq{static getVersion(){return this._version}}var gI,Rq;function kq(p,l){if(p&&p.location){const u=p.location.points;for(let f of u)f.x=f.x/l,f.y=f.y/l;kq(p.referencedItem,l)}}Pq._version=`2.2.30(Worker: ${null===(iM=Rl.cvr)||void 0===iM?void 0:iM.worker}, Wasm: loading...`,function(p){p[p.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",p[p.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(gI||(gI={})),function(p){p[p.IRUT_NULL=0]="IRUT_NULL",p[p.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",p[p.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",p[p.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",p[p.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",p[p.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",p[p.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",p[p.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",p[p.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",p[p.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",p[p.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",p[p.IRUT_CONTOURS=1024]="IRUT_CONTOURS",p[p.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",p[p.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",p[p.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",p[p.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",p[p.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",p[p.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",p[p.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",p[p.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",p[p.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",p[p.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",p[p.IRUT_CORNERS=2097152]="IRUT_CORNERS",p[p.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",p[p.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",p[p.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",p[p.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",p[p.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",p[p.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",p[p.IRUT_ALL=134217727]="IRUT_ALL"}(Rq||(Rq={}));class pr{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(Yr.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._bufferdItemsManager=null,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._compressRate=0,this._dynamsoft=!1,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get disposed(){return this.bDestroyed}static createInstance(){return Fe(function*(){if(!no.license)throw Error("Module `license` is not existed.");yield no.license.dynamsoft(),yield Oc(["cvr"]);const l=new pr,u=new Ry;let f=fr();return Ii[f]=function(){var g=Fe(function*(m){var v;if(m.success)l._instanceID=m.instanceID,l._currentSettings=JSON.parse(m.outputSettings),Pq._version=`2.2.30(Worker: ${null===(v=Rl.cvr)||void 0===v?void 0:v.worker}, Wasm: ${m.version})`,0===Yr.bSupportDce4Module&&(l._intermediateResultManager=l.getIntermediateResultManager(!0)),u.resolve(l);else{const _=Error(m.message);m.stack&&(_.stack=m.stack),u.reject(_)}});return function(m){return g.apply(this,arguments)}}(),ai.postMessage({type:"cvr_createInstance",id:f}),u})()}_singleFrameModeCallback(l){var u=this;return Fe(function*(){u._isa.getCameraView().setScanLaserVisible(!0);for(let v of u._resultReceiverSet)u._bNeedOutputOriginalImage&&v.onOriginalImageResultReceived&&v.onOriginalImageResultReceived({imageData:l});const f={bytes:new Uint8Array(l.bytes),width:l.width,height:l.height,stride:l.stride,format:l.format,tag:l.tag};u._templateName||(u._templateName=u._currentSettings.CaptureVisionTemplates[0].Name);const g=yield u.capture(f,u._templateName);g.originalImageTag=l.tag;for(let v of u._resultReceiverSet)v.isDce&&v.onCapturedResultReceived(g,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const m={originalImageHashId:g.originalImageHashId,originalImageTag:g.originalImageTag,errorCode:g.errorCode,errorString:g.errorString};for(let v of u._resultReceiverSet)if(v.onDecodedBarcodesReceived&&g.barcodeResultItems&&v.onDecodedBarcodesReceived(Object.assign(Object.assign({},m),{barcodeResultItems:g.barcodeResultItems})),v.onRecognizedTextLinesReceived&&g.textLineResultItems&&v.onRecognizedTextLinesReceived(Object.assign(Object.assign({},m),{textLineResultItems:g.textLineResultItems})),v.onDetectedQuadsReceived&&g.detectedQuadResultItems&&v.onDetectedQuadsReceived(Object.assign(Object.assign({},m),{detectedQuadResultItems:g.detectedQuadResultItems})),v.onNormalizedImagesReceived&&g.normalizedImageResultItems&&v.onNormalizedImagesReceived(Object.assign(Object.assign({},m),{normalizedImageResultItems:g.normalizedImageResultItems})),v.onParsedResultsReceived&&g.parsedResultItems&&v.onParsedResultsReceived(Object.assign(Object.assign({},m),{parsedResultItems:g.parsedResultItems})),v.onCapturedResultReceived&&!v.isDce){if(u._bNeedOutputOriginalImage){const _=g.items.findIndex(b=>1===b.type);-1!==_&&(g.items[_].imageData=l)}v.onCapturedResultReceived(g)}})()}setInput(l){if(this._checkIsDisposed(),l){if(this._isa=l,l.isCameraEnhancer){this._intermediateResultManager&&(this._isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this._isa._intermediateResultReceiver));const u=this._isa.getCameraView();if(u){const f=u._capturedResultReceiver;f.isDce=!0,this._resultReceiverSet.add(f)}}}else this._isa=null}getInput(){return this._isa}addImageSourceStateListener(l){if(this._checkIsDisposed(),"object"!=typeof l)return console.warn("Invalid ISA state listener.");l&&Object.keys(l)&&this._isaStateListenerSet.add(l)}removeImageSourceStateListener(l){return this._checkIsDisposed(),this._isaStateListenerSet.delete(l)}addResultReceiver(l){if(this._checkIsDisposed(),"object"!=typeof l)throw new Error("Invalid receiver.");l&&Object.keys(l).length&&(this._resultReceiverSet.add(l),this._setCrrRegistry())}removeResultReceiver(l){this._checkIsDisposed(),this._resultReceiverSet.delete(l),this._setCrrRegistry()}_setCrrRegistry(){var l=this;return Fe(function*(){const u={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let m of l._resultReceiverSet)m.isDce||(u.onCapturedResultReceived=!!m.onCapturedResultReceived,u.onDecodedBarcodesReceived=!!m.onDecodedBarcodesReceived,u.onRecognizedTextLinesReceived=!!m.onRecognizedTextLinesReceived,u.onDetectedQuadsReceived=!!m.onDetectedQuadsReceived,u.onNormalizedImagesReceived=!!m.onNormalizedImagesReceived,u.onParsedResultsReceived=!!m.onParsedResultsReceived);const f=new Ry;let g=fr();return Ii[g]=function(){var m=Fe(function*(v){if(v.success)f.resolve();else{let _=new Error(v.message);_.stack=v.stack+"\n"+_.stack,f.reject()}});return function(v){return m.apply(this,arguments)}}(),ai.postMessage({type:"cvr_setCrrRegistry",id:g,instanceID:l._instanceID,body:{receiver:JSON.stringify(u)}}),f})()}addResultFilter(l){var u=this;return Fe(function*(){if(u._checkIsDisposed(),"object"!=typeof l)return console.warn("Invalid filter.");if(l&&Object.keys(l)){u._resultFilterSet.add(l),u._handleFilterSwitch();for(let f of u._resultFilterSet)yield u._enableResultCrossVerification(f.verificationEnabled),yield u._enableResultDeduplication(f.duplicateFilterEnabled),yield u._setDuplicateForgetTime(f.duplicateForgetTime)}})()}removeResultFilter(l){var u=this;return Fe(function*(){u._checkIsDisposed(),u._resultFilterSet.delete(l),u._handleFilterSwitch();for(let f of u._resultFilterSet)yield u._enableResultCrossVerification(f.verificationEnabled),yield u._enableResultDeduplication(f.duplicateFilterEnabled),yield u._setDuplicateForgetTime(f.duplicateForgetTime)})()}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let l of this._resultFilterSet)l.isResultCrossVerificationEnabled(io.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),l.isResultCrossVerificationEnabled(io.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),l.isResultCrossVerificationEnabled(io.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),l.isResultCrossVerificationEnabled(io.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}startCapturing(l){var u=this;return Fe(function*(){var f,g;if(u._checkIsDisposed(),!u._bPauseScan)return;if(!u._isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");l||(l=u._currentSettings.CaptureVisionTemplates[0].Name);const m=yield u.containsTask(l);return yield Oc(m),m.includes("dlr")&&!(null===(f=no.dlr)||void 0===f?void 0:f.bLoadConfusableCharsData)&&(yield null===(g=no.dlr)||void 0===g?void 0:g.loadRecognitionData("ConfusableChars",wn.dlr)),u._isa.isCameraEnhancer&&(m.includes("ddn")?u._isa.setPixelFormat(Hn.IPF_ABGR_8888):u._isa.setPixelFormat(Hn.IPF_GRAYSCALED)),void 0!==u._isa.singleFrameMode&&"disabled"!==u._isa.singleFrameMode?(u._templateName=l,void u._isa.on("singleFrameAcquired",u._singleFrameModeCallbackBind)):(u._isa.getColourChannelUsageType()===Ph.CCUT_AUTO&&u._isa.setColourChannelUsageType(m.includes("ddn")?Ph.CCUT_FULL_CHANNEL:Ph.CCUT_Y_CHANNEL_ONLY),u._promiseStartScan&&u._promiseStartScan.isPending?u._promiseStartScan:(u._promiseStartScan=new Ry((v,_)=>{if(u.disposed)return;let b=fr();Ii[b]=function(){var S=Fe(function*(I){if(u._promiseStartScan&&!u._promiseStartScan.isFulfilled){if(!I.success){let k=new Error(I.message);return k.stack=I.stack+"\n"+k.stack,_(k)}for(let k of u._resultFilterSet)yield u.addResultFilter(k);u._bPauseScan=!1,u._bNeedOutputOriginalImage=I.bNeedOutputOriginalImage,u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=setTimeout(Fe(function*(){-1!==u._minImageCaptureInterval&&u._isa.startFetching(),u._loopReadVideo(l),v()}),0),u._isa.isCameraEnhancer&&u._isa.getCameraView().setScanLaserVisible(!0)}});return function(I){return S.apply(this,arguments)}}(),ai.postMessage({type:"cvr_startCapturing",id:b,instanceID:u._instanceID,body:{templateName:l}})}),yield u._promiseStartScan))})()}stopCapturing(){this._checkIsDisposed(),this._isa&&(this._isa.isCameraEnhancer&&(this._isa.getCameraView().setScanLaserVisible(!1),void 0!==this._isa.singleFrameMode&&"disabled"!==this._isa.singleFrameMode)?this._isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this._isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this._isa.setColourChannelUsageType(Ph.CCUT_AUTO)))}_clearVerifyList(){var l=this;return Fe(function*(){let u=fr();const f=new Ry;return Ii[u]=function(){var g=Fe(function*(m){if(m.success)return f.resolve();{let v=new Error(m.message);return v.stack=m.stack+"\n"+v.stack,f.reject(v)}});return function(m){return g.apply(this,arguments)}}(),ai.postMessage({type:"cvr_clearVerifyList",id:u,instanceID:l._instanceID}),f})()}_getIntermediateResult(){var l=this;return Fe(function*(){l._checkIsDisposed();let u=fr();const f=new Ry;return Ii[u]=function(){var g=Fe(function*(m){if(m.success)f.resolve(m.result);else{let v=new Error(m.message);v.stack=m.stack+"\n"+v.stack,f.reject(v)}});return function(m){return g.apply(this,arguments)}}(),ai.postMessage({type:"cvr_getIntermediateResult",id:u,instanceID:l._instanceID}),f})()}containsTask(l){var u=this;return Fe(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success)return f(JSON.parse(_.tasks));{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"cvr_containsTask",id:m,instanceID:u._instanceID,body:{templateName:l}})})})()}_loopReadVideo(l){var u=this;return Fe(function*(){if(u._dynamsoft=!0,u.disposed||u._bPauseScan)return;if(u._isa.isBufferEmpty())if(u._isa.hasNextImageToFetch())for(let g of u._isaStateListenerSet)g.onImageSourceStateReceived&&g.onImageSourceStateReceived(gI.ISS_BUFFER_EMPTY);else if(!u._isa.hasNextImageToFetch())for(let g of u._isaStateListenerSet)g.onImageSourceStateReceived&&g.onImageSourceStateReceived(gI.ISS_EXHAUSTED);if(-1===u._minImageCaptureInterval||u._isa.isBufferEmpty())try{u._isa.isBufferEmpty()&&pr._onLog&&pr._onLog("buffer is empty so fetch image"),pr._onLog&&pr._onLog(`DCE: start fetching a frame: ${Date.now()}`),u._dsImage=u._isa.fetchImage(),pr._onLog&&pr._onLog(`DCE: finish fetching a frame: ${Date.now()}`),u._isa.setImageFetchInterval(u._averageTime)}catch(g){return void u._reRunCurrnetFunc(l)}else if(u._isa.setImageFetchInterval(u._averageTime-(u._dsImage&&u._dsImage.tag?u._dsImage.tag.timeSpent:0)),u._dsImage=u._isa.getImage(),u._dsImage.tag&&Date.now()-u._dsImage.tag.timeStamp>200)return void u._reRunCurrnetFunc(l);if(!u._dsImage)return void u._reRunCurrnetFunc(l);for(let g of u._resultReceiverSet)u._bNeedOutputOriginalImage&&g.onOriginalImageResultReceived&&g.onOriginalImageResultReceived({imageData:u._dsImage});const f=Date.now();u._captureDsimage(u._dsImage,l).then(function(){var g=Fe(function*(m){if(pr._onLog&&pr._onLog("no js handle time: "+(Date.now()-f)),u._bPauseScan)return void u._reRunCurrnetFunc(l);m.originalImageTag=u._dsImage.tag?u._dsImage.tag:null;for(let b of u._resultReceiverSet)if(b.isDce){const S=Date.now();if(b.onCapturedResultReceived(m,{isDetectVerifyOpen:u._bOpenDetectVerify,isNormalizeVerifyOpen:u._bOpenNormalizeVerify,isBarcodeVerifyOpen:u._bOpenBarcodeVerify,isLabelVerifyOpen:u._bOpenLabelVerify}),pr._onLog){const I=Date.now()-S;I>10&&pr._onLog(`draw result time: ${I}`)}}const v={originalImageHashId:m.originalImageHashId,originalImageTag:m.originalImageTag,errorCode:m.errorCode,errorString:m.errorString};for(let b of u._resultReceiverSet)b.onDecodedBarcodesReceived&&m.barcodeResultItems&&b.onDecodedBarcodesReceived(Object.assign(Object.assign({},v),{barcodeResultItems:m.barcodeResultItems.filter(S=>!S.isFilter)})),b.onRecognizedTextLinesReceived&&m.textLineResultItems&&b.onRecognizedTextLinesReceived(Object.assign(Object.assign({},v),{textLineResultItems:m.textLineResultItems.filter(S=>!S.isFilter)})),b.onDetectedQuadsReceived&&m.detectedQuadResultItems&&b.onDetectedQuadsReceived(Object.assign(Object.assign({},v),{detectedQuadResultItems:m.detectedQuadResultItems.filter(S=>!S.isFilter)})),b.onNormalizedImagesReceived&&m.normalizedImageResultItems&&b.onNormalizedImagesReceived(Object.assign(Object.assign({},v),{normalizedImageResultItems:m.normalizedImageResultItems.filter(S=>!S.isFilter)})),b.onParsedResultsReceived&&m.parsedResultItems&&b.onParsedResultsReceived(Object.assign(Object.assign({},v),{parsedResultItems:m.parsedResultItems.filter(S=>!S.isFilter)})),b.onCapturedResultReceived&&!b.isDce&&(m.items=m.items.filter(S=>!S.isFilter),m.barcodeResultItems&&(m.barcodeResultItems=m.barcodeResultItems.filter(S=>!S.isFilter)),m.textLineResultItems&&(m.textLineResultItems=m.textLineResultItems.filter(S=>!S.isFilter)),m.detectedQuadResultItems&&(m.detectedQuadResultItems=m.detectedQuadResultItems.filter(S=>!S.isFilter)),m.normalizedImageResultItems&&(m.normalizedImageResultItems=m.normalizedImageResultItems.filter(S=>!S.isFilter)),m.parsedResultItems&&(m.parsedResultItems=m.parsedResultItems.filter(S=>!S.isFilter)),b.onCapturedResultReceived(m));const _=Date.now();if(u._minImageCaptureInterval>-1&&(5===u._averageProcessintTimeArray.length&&u._averageProcessintTimeArray.shift(),5===u._averageFetchImageTimeArray.length&&u._averageFetchImageTimeArray.shift(),u._averageProcessintTimeArray.push(Date.now()-f),u._averageFetchImageTimeArray.push(u._dsImage&&u._dsImage.tag?u._dsImage.tag.timeSpent:0),u._averageTime=Math.min(...u._averageProcessintTimeArray)-Math.max(...u._averageFetchImageTimeArray),u._averageTime=u._averageTime>0?u._averageTime:0,pr._onLog&&(pr._onLog(`minImageCaptureInterval: ${u._minImageCaptureInterval}`),pr._onLog(`averageProcessintTimeArray: ${u._averageProcessintTimeArray}`),pr._onLog(`averageFetchImageTimeArray: ${u._averageFetchImageTimeArray}`),pr._onLog(`averageTime: ${u._averageTime}`))),pr._onLog){const b=Date.now()-_;b>10&&pr._onLog(`fetch image calculate time: ${b}`)}pr._onLog&&pr._onLog(`time finish decode: ${Date.now()}`),pr._onLog&&pr._onLog("main time: "+(Date.now()-f)),pr._onLog&&pr._onLog("===================================================="),u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=u._minImageCaptureInterval>0&&u._minImageCaptureInterval>=u._averageTime?setTimeout(()=>{u._loopReadVideo(l)},u._minImageCaptureInterval-u._averageTime):setTimeout(()=>{u._loopReadVideo(l)},Math.max(u._minImageCaptureInterval,0))});return function(m){return g.apply(this,arguments)}}()).catch(g=>{u._isa.stopFetching(),u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=setTimeout(()=>{u._isa.startFetching(),u._loopReadVideo(l)},Math.max(u._minImageCaptureInterval,1e3)),"platform error"!==g.message&&setTimeout(()=>{throw g},0)})})()}_reRunCurrnetFunc(l){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(l)},0)}capture(l,u){var f=this;return Fe(function*(){var g,m;f._checkIsDisposed(),u||(u=f._currentSettings.CaptureVisionTemplates[0].Name);const v=yield f.containsTask(u);let _;if(yield Oc(v),v.includes("dlr")&&!(null===(g=no.dlr)||void 0===g?void 0:g.bLoadConfusableCharsData)&&(yield null===(m=no.dlr)||void 0===m?void 0:m.loadRecognitionData("ConfusableChars",wn.dlr)),f._dynamsoft=!1,nq(l))_=yield f._captureDsimage(l,u);else if("string"==typeof l)_="data:image/"==l.substring(0,11)?yield f._captureBase64(l,u):yield f._captureUrl(l,u);else if(l instanceof Blob)_=yield f._captureBlob(l,u);else if(l instanceof HTMLImageElement)_=yield f._captureImage(l,u);else if(l instanceof HTMLCanvasElement)_=yield f._captureCanvas(l,u);else{if(!(l instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");_=yield f._captureVideo(l,u)}return _})()}_captureDsimage(l,u){var f=this;return Fe(function*(){return yield f._captureInWorker(l,u)})()}_captureUrl(l,u){var f=this;return Fe(function*(){let g=yield $4(l,"blob");return yield f._captureBlob(g,u)})()}_captureBase64(l,u){var f=this;return Fe(function*(){l=l.substring(l.indexOf(",")+1);let g=atob(l),m=g.length,v=new Uint8Array(m);for(;m--;)v[m]=g.charCodeAt(m);return yield f._captureBlob(new Blob([v]),u)})()}_captureBlob(l,u){var f=this;return Fe(function*(){let g=null,m=null;if("undefined"!=typeof createImageBitmap)try{g=yield createImageBitmap(l)}catch(_){}var _;g||(m=yield(_=Fe(function*(b){return yield new Promise((S,I)=>{let k=URL.createObjectURL(b),O=new Image;O.src=k,O.onload=()=>{URL.revokeObjectURL(O.dbrObjUrl),S(O)},O.onerror=j=>{I(new Error("Can't convert blob to image : "+(j instanceof Event?j.type:j)))}})}),function(b){return _.apply(this,arguments)})(l));let v=yield f._captureImage(g||m,u);return g&&g.close(),v})()}_captureImage(l,u){var f=this;return Fe(function*(){let g,m,v=l instanceof HTMLImageElement?l.naturalWidth:l.width,_=l instanceof HTMLImageElement?l.naturalHeight:l.height,b=Math.max(v,_);b>f.maxCvsSideLength?(f._compressRate=f.maxCvsSideLength/b,g=Math.round(v*f._compressRate),m=Math.round(_*f._compressRate)):(g=v,m=_),f._canvas||(f._canvas=document.createElement("canvas"));const S=f._canvas;return S.width===g&&S.height===m||(S.width=g,S.height=m),S.ctx2d||(S.ctx2d=S.getContext("2d",{willReadFrequently:!0})),S.ctx2d.drawImage(l,0,0,v,_,0,0,g,m),l.dbrObjUrl&&URL.revokeObjectURL(l.dbrObjUrl),yield f._captureCanvas(S,u)})()}_captureCanvas(l,u){var f=this;return Fe(function*(){if(l.crossOrigin&&"anonymous"!=l.crossOrigin)throw"cors";if([l.width,l.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const g=l.ctx2d||l.getContext("2d",{willReadFrequently:!0}),m={bytes:Uint8Array.from(g.getImageData(0,0,l.width,l.height).data),width:l.width,height:l.height,stride:4*l.width,format:10};return yield f._captureInWorker(m,u)})()}_captureVideo(l,u){var f=this;return Fe(function*(){if(l.crossOrigin&&"anonymous"!=l.crossOrigin)throw"cors";let g,m,v=l.videoWidth,_=l.videoHeight,b=Math.max(v,_);b>f.maxCvsSideLength?(f._compressRate=f.maxCvsSideLength/b,g=Math.round(v*f._compressRate),m=Math.round(_*f._compressRate)):(g=v,m=_),f._canvas||(f._canvas=document.createElement("canvas"));const S=f._canvas;return S.width===g&&S.height===m||(S.width=g,S.height=m),S.ctx2d||(S.ctx2d=S.getContext("2d",{willReadFrequently:!0})),S.ctx2d.drawImage(l,0,0,v,_,0,0,g,m),yield f._captureCanvas(S,u)})()}_captureInWorker(l,u){var f=this;return Fe(function*(){const{bytes:g,width:m,height:v,stride:_,format:b}=l;let S=fr();const I=new Ry;return Ii[S]=function(){var k=Fe(function*(O){var j,W;if(!O.success){let J=new Error(O.message);return J.stack=O.stack+"\n"+J.stack,I.reject(J)}{const J=Date.now();pr._onLog&&(pr._onLog(`get result time from worker: ${J}`),pr._onLog("worker to main time consume: "+(J-O.workerReturnMsgTime)));try{const K=O.captureResult;l.bytes=O.bytes;for(let ie of K.items)0!==f._compressRate&&kq(ie,f._compressRate),ie.type===io.CRIT_ORIGINAL_IMAGE?ie.imageData=l:ie.type===io.CRIT_NORMALIZED_IMAGE?null===(j=no.ddn)||void 0===j||j.handleNormalizedImageResultItem(ie):ie.type===io.CRIT_PARSED_RESULT&&(null===(W=no.dcp)||void 0===W||W.handleParsedResultItem(ie));if(f._dynamsoft)for(let ie of f._resultFilterSet)ie.onDecodedBarcodesReceived(K.items),ie.onRecognizedTextLinesReceived(K.items),ie.onDetectedQuadsReceived(K.items),ie.onNormalizedImagesReceived(K.items);const Q=function(ie){const oe={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return ie.items.forEach(le=>{le.type===io.CRIT_BARCODE?oe.barcodeResultItems.push(le):le.type===io.CRIT_TEXT_LINE?oe.textLineResultItems.push(le):le.type===io.CRIT_DETECTED_QUAD?oe.detectedQuadResultItems.push(le):le.type===io.CRIT_NORMALIZED_IMAGE?oe.normalizedImageResultItems.push(le):le.type===io.CRIT_PARSED_RESULT&&oe.parsedResultItems.push(le)}),oe}(K);if(Q.barcodeResultItems.length&&(K.barcodeResultItems=Q.barcodeResultItems),Q.textLineResultItems.length&&(K.textLineResultItems=Q.textLineResultItems),Q.detectedQuadResultItems.length&&(K.detectedQuadResultItems=Q.detectedQuadResultItems),Q.normalizedImageResultItems.length&&(K.normalizedImageResultItems=Q.normalizedImageResultItems),Q.parsedResultItems.length&&(K.parsedResultItems=Q.parsedResultItems),!f._bPauseScan||!f._dynamsoft){const ie=K.intermediateResult;if(ie){let oe=0;for(let le of f._intermediateResultReceiverSet){oe++;for(let he of ie){if("onTaskResultsReceived"===he.info.callbackName){for(let _e of he.intermediateResultUnits)_e.originalImageTag=l.tag?l.tag:null;le[he.info.callbackName]&&le[he.info.callbackName]({intermediateResultUnits:he.intermediateResultUnits},he.info)}else le[he.info.callbackName]&&le[he.info.callbackName](he.result,he.info);oe===f._intermediateResultReceiverSet.size&&delete he.info.callbackName}}}K&&K.intermediateResult&&delete K.intermediateResult}return f._compressRate=0,I.resolve(K)}catch(K){return I.reject(K)}}});return function(O){return k.apply(this,arguments)}}(),pr._onLog&&pr._onLog(`send buffer to worker: ${Date.now()}`),ai.postMessage({type:"cvr_capture",id:S,instanceID:f._instanceID,body:{bytes:g,width:m,height:v,stride:_,format:b,templateName:u||"",dynamsoft:f._dynamsoft}},[g.buffer]),I})()}initSettings(l){var u=this;return Fe(function*(){return u._checkIsDisposed(),l&&["string","object"].includes(typeof l)?("string"==typeof l?l.startsWith("{")?u._currentSettings=JSON.parse(l):l=yield $4(l,"text"):"object"==typeof l&&(u._currentSettings=l,l=JSON.stringify(l)),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success){const b=JSON.parse(_.response);if(0!==b.exception){let k=new Error(b.description?b.description:"Init Settings Failed.");return k.errorCode=b.exception,g(k)}let S=[],I=JSON.parse(l).CaptureVisionTemplates;for(let k=0;k<I.length;k++){let O=yield u.containsTask(I[k].Name);S=S.concat(O)}return yield Oc([...new Set(S)]),u._bNeedOutputOriginalImage=1===u._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,f(b)}{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"cvr_initSettings",id:m,instanceID:u._instanceID,body:{settings:l}})})):console.error("Invalid template.")})()}outputSettings(l){var u=this;return Fe(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success){const b=JSON.parse(_.settings);if(0!==b.errorCode){let S=new Error(b.errorString);return S.errorCode=b.errorCode,g(S)}return delete b.errorCode,delete b.errorString,f(b)}{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"cvr_outputSettings",id:m,instanceID:u._instanceID,body:{templateName:l||"*"}})})})()}outputSettingsToFile(l,u,f){var g=this;return Fe(function*(){const m=yield g.outputSettings(l),v=new Blob([JSON.stringify(m,null,2,function(_,b){return b instanceof Array?JSON.stringify(b):b},2)],{type:"application/json"});if(f){const _=document.createElement("a");_.href=URL.createObjectURL(v),u.endsWith(".json")&&(u=u.replace(".json","")),_.download=`${u}.json`,_.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(_.href)},500)},_.click()}return v})()}getSimplifiedSettings(l){var u=this;return Fe(function*(){u._checkIsDisposed(),l||(l=u._currentSettings.CaptureVisionTemplates[0].Name);const f=yield u.containsTask(l);return yield Oc(f),yield new Promise((g,m)=>{let v=fr();Ii[v]=function(){var _=Fe(function*(b){if(b.success){const S=JSON.parse(b.settings,(I,k)=>tIe&&"barcodeFormatIds"===I?BigInt(k):k);if(S.minImageCaptureInterval=u._minImageCaptureInterval,0!==S.code){let I=new Error(S.codeString);return I.errorCode=S.errorCode,m(I)}return delete S.code,delete S.codeString,g(S)}{let S=new Error(b.message);return S.stack=b.stack+"\n"+S.stack,m(S)}});return function(b){return _.apply(this,arguments)}}(),ai.postMessage({type:"cvr_getSimplifiedSettings",id:v,instanceID:u._instanceID,body:{templateName:l}})})})()}updateSettings(l,u){var f=this;return Fe(function*(){f._checkIsDisposed();const g=yield f.containsTask(l);return yield Oc(g),yield new Promise((m,v)=>{let _=fr();Ii[_]=function(){var b=Fe(function*(S){if(S.success){const I=JSON.parse(S.response);if(u.minImageCaptureInterval&&u.minImageCaptureInterval>=-1&&(f._minImageCaptureInterval=u.minImageCaptureInterval),f._bNeedOutputOriginalImage=S.bNeedOutputOriginalImage,0!==I.exception){let k=new Error(I.description?I.description:"Update Settings Failed.");return k.errorCode=I.exception,v(k)}return f._currentSettings=yield f.outputSettings("*"),m(I)}{let I=new Error(S.message);return I.stack=S.stack+"\n"+I.stack,v(I)}});return function(S){return b.apply(this,arguments)}}(),ai.postMessage({type:"cvr_updateSettings",id:_,instanceID:f._instanceID,body:{settings:u,templateName:l}})})})()}resetSettings(){var l=this;return Fe(function*(){return l._checkIsDisposed(),yield new Promise((u,f)=>{let g=fr();Ii[g]=function(){var m=Fe(function*(v){if(v.success){const _=JSON.parse(v.response);if(0!==_.exception){let b=new Error(_.description?_.description:"Reset Settings Failed.");return b.errorCode=_.exception,f(b)}return l._currentSettings=yield l.outputSettings("*"),u(_)}{let _=new Error(v.message);return _.stack=v.stack+"\n"+_.stack,f(_)}});return function(v){return m.apply(this,arguments)}}(),ai.postMessage({type:"cvr_resetSettings",id:g,instanceID:l._instanceID})})})()}getBufferedItemsManager(){return this._bufferdItemsManager||(this._bufferdItemsManager=new lIe(this)),this._bufferdItemsManager}getIntermediateResultManager(l){if(this._checkIsDisposed(),!l&&0!==Yr.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new uIe(this)),this._intermediateResultManager}contains(l,u){return function(f,g){let m=g.x,v=g.y,_=f[0].x,b=f[0].y,S=f[1].x,I=f[1].y,k=f[2].x,O=f[2].y,j=f[3].x,W=f[3].y,J=oe(m,v,_,b,S,I),K=oe(m,v,S,I,k,O),Q=oe(m,v,k,O,j,W),ie=oe(m,v,j,W,_,b);function oe(le,he,_e,Ve,ee,ke){return(le-_e)*(ke-Ve)-(he-Ve)*(ee-_e)}return J>=0&&K>=0&&Q>=0&&ie>=0||J<=0&&K<=0&&Q<=0&&ie<=0}(l,u)}parseRequiredResources(l){var u=this;return Fe(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success)return f(JSON.parse(_.resources));{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"cvr_parseRequiredResources",id:m,instanceID:u._instanceID,body:{templateName:l}})})})()}dispose(){var l=this;return Fe(function*(){l._checkIsDisposed(),l._promiseStartScan&&l.stopCapturing(),l._isa=null,l._resultReceiverSet.clear(),l._isaStateListenerSet.clear(),l._resultFilterSet.clear(),l.bDestroyed=!0;let u=fr();Ii[u]=f=>{if(!f.success){let g=new Error(f.message);throw g.stack=f.stack+"\n"+g.stack,g}},ai.postMessage({type:"cvr_dispose",id:u,instanceID:l._instanceID})})()}_enableResultCrossVerification(l){var u=this;return Fe(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success)return f(_.result);{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"cvr_enableResultCrossVerification",id:m,instanceID:u._instanceID,body:{verificationEnabled:l}})})})()}_enableResultDeduplication(l){var u=this;return Fe(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success)return f(_.result);{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"cvr_enableResultDeduplication",id:m,instanceID:u._instanceID,body:{duplicateFilterEnabled:l}})})})()}_setDuplicateForgetTime(l){var u=this;return Fe(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success)return f(_.result);{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"cvr_setDuplicateForgetTime",id:m,instanceID:u._instanceID,body:{duplicateForgetTime:l}})})})()}_getDuplicateForgetTime(l){var u=this;return Fe(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success)return f(_.time);{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"cvr_getDuplicateForgetTime",id:m,instanceID:u._instanceID,body:{type:l}})})})()}_setThresholdValue(l,u,f){var g=this;return Fe(function*(){return yield Oc("ddn"),yield new Promise((m,v)=>{let _=fr();Ii[_]=function(){var b=Fe(function*(S){if(S.success)return m();{let I=new Error(S.message);return I.stack=S.stack+"\n"+I.stack,v(I)}});return function(S){return b.apply(this,arguments)}}(),ai.postMessage({type:"ddn_setThresholdValue",id:_,instanceID:g._instanceID,body:{threshold:l,leftLimit:u,rightLimit:f}})})})()}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}}const sM="undefined"==typeof self,dIe=(()=>{if(!sM&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})();function Me(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function Pn(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}let Ub,Hf,mI,vI,Ra;null==wn.dce&&(wn.dce=dIe),Mu.dce={wasm:!1,js:!1},no.dce={},"function"==typeof SuppressedError&&SuppressedError,"undefined"!=typeof navigator&&(Ub=navigator,Hf=Ub.userAgent,mI=Ub.platform,vI=Ub.mediaDevices),function(){if(!sM){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ub.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:mI,search:"Win"},Mac:{str:mI},Linux:{str:mI}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let S=v.verStr||Hf,I=v.verSearch||m;if(I instanceof Array||(I=[I]),-1!=(v.str||Hf).indexOf(v.search||m)){u=m;for(let k of I){let O=S.indexOf(k);if(-1!=O){f=parseFloat(S.substring(O+k.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Hf).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=Hf.indexOf("Windows NT")&&(g="HarmonyOS"),Ra={browser:u,version:f,OS:g}}sM&&(Ra={browser:"ssr",version:0,OS:"ssr"})}();const hIe="undefined"!=typeof WebAssembly&&Hf&&!(/Safari/.test(Hf)&&!/Chrome/.test(Hf)&&/\(.+\s11_2_([2-6]).*\)/.test(Hf)),fIe="undefined"!=typeof Worker,Mq=!(!vI||!vI.getUserMedia),pIe=function(){var p=Fe(function*(){let l=!1;if(Mq)try{(yield vI.getUserMedia({video:!0})).getTracks().forEach(u=>{u.stop()}),l=!0}catch(u){}return l});return function(){return p.apply(this,arguments)}}();var gIe={653:(p,l,u)=>{var f,g,m,v,_,b,S,I,k,O,W,J,K,Q,ie,oe,le,he,_e,Ve,V,F,z,$,ee=ee||{version:"5.2.1"};if(l.fabric=ee,"undefined"!=typeof document&&"undefined"!=typeof window)ee.document=document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),ee.window=window;else{var ke=new(u(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;ee.document=ke.document,ee.jsdomImplForWrapper=u(898).implForWrapper,ee.nodeCanvas=u(245).Canvas,ee.window=ke,DOMParser=ee.window.DOMParser}function xe(V,F){var z=V.canvas,$=F.targetCanvas,P=$.getContext("2d");P.translate(0,$.height),P.scale(1,-1),P.drawImage(z,0,z.height-$.height,$.width,$.height,0,0,$.width,$.height)}function Le(V,F){var z=F.targetCanvas.getContext("2d"),$=F.destinationWidth,P=F.destinationHeight,L=$*P*4,X=new Uint8Array(this.imageBuffer,0,L),ne=new Uint8ClampedArray(this.imageBuffer,0,L);V.readPixels(0,0,$,P,V.RGBA,V.UNSIGNED_BYTE,X);var Z=new ImageData(ne,$,P);z.putImageData(Z,0,0)}ee.isTouchSupported="ontouchstart"in ee.window||"ontouchstart"in ee.document||ee.window&&ee.window.navigator&&ee.window.navigator.maxTouchPoints>0,ee.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,ee.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],ee.DPI=96,ee.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",ee.commaWsp="(?:\\s+,?\\s*|,\\s*)",ee.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,ee.reNonWord=/[ \n\.,;!\?\-]/,ee.fontPaths={},ee.iMatrix=[1,0,0,1,0,0],ee.svgNS="http://www.w3.org/2000/svg",ee.perfLimitSizeTotal=2097152,ee.maxCacheSideLimit=4096,ee.minCacheSideLimit=256,ee.charWidthsCache={},ee.textureSize=2048,ee.disableStyleCopyPaste=!1,ee.enableGLFiltering=!0,ee.devicePixelRatio=ee.window.devicePixelRatio||ee.window.webkitDevicePixelRatio||ee.window.mozDevicePixelRatio||1,ee.browserShadowBlurConstant=1,ee.arcToSegmentsCache={},ee.boundsOfCurveCache={},ee.cachesBoundsOfCurve=!0,ee.forceGLPutImageData=!1,ee.initFilterBackend=function(){return ee.enableGLFiltering&&ee.isWebglSupported&&ee.isWebglSupported(ee.textureSize)?(console.log("max texture size: "+ee.maxTextureSize),new ee.WebglFilterBackend({tileSize:ee.textureSize})):ee.Canvas2dFilterBackend?new ee.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=ee),function(){function V(z,$){if(this.__eventListeners[z]){var P=this.__eventListeners[z];$?P[P.indexOf($)]=!1:ee.util.array.fill(P,!1)}}function F(z,$){var P=function(){$.apply(this,arguments),this.off(z,P)}.bind(this);this.on(z,P)}ee.Observable={fire:function(z,$){if(!this.__eventListeners)return this;var P=this.__eventListeners[z];if(!P)return this;for(var L=0,X=P.length;L<X;L++)P[L]&&P[L].call(this,$||{});return this.__eventListeners[z]=P.filter(function(ne){return!1!==ne}),this},on:function(z,$){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var P in z)this.on(P,z[P]);else this.__eventListeners[z]||(this.__eventListeners[z]=[]),this.__eventListeners[z].push($);return this},once:function(z,$){if(1===arguments.length)for(var P in z)F.call(this,P,z[P]);else F.call(this,z,$);return this},off:function(z,$){if(!this.__eventListeners)return this;if(0===arguments.length)for(z in this.__eventListeners)V.call(this,z);else if(1===arguments.length&&"object"==typeof arguments[0])for(var P in z)V.call(this,P,z[P]);else V.call(this,z,$);return this}}}(),ee.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var V=0,F=arguments.length;V<F;V++)this._onObjectAdded(arguments[V]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(V,F,z){var $=this._objects;return z?$[F]=V:$.splice(F,0,V),this._onObjectAdded&&this._onObjectAdded(V),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var V,F=this._objects,z=!1,$=0,P=arguments.length;$<P;$++)-1!==(V=F.indexOf(arguments[$]))&&(z=!0,F.splice(V,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[$]));return this.renderOnAddRemove&&z&&this.requestRenderAll(),this},forEachObject:function(V,F){for(var z=this.getObjects(),$=0,P=z.length;$<P;$++)V.call(F,z[$],$,z);return this},getObjects:function(V){return void 0===V?this._objects.concat():this._objects.filter(function(F){return F.type===V})},item:function(V){return this._objects[V]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(V,F){return this._objects.indexOf(V)>-1||!!F&&this._objects.some(function(z){return"function"==typeof z.contains&&z.contains(V,!0)})},complexity:function(){return this._objects.reduce(function(V,F){return V+(F.complexity?F.complexity():0)},0)}},ee.CommonMethods={_setOptions:function(V){for(var F in V)this.set(F,V[F])},_initGradient:function(V,F){!V||!V.colorStops||V instanceof ee.Gradient||this.set(F,new ee.Gradient(V))},_initPattern:function(V,F,z){!V||!V.source||V instanceof ee.Pattern?z&&z():this.set(F,new ee.Pattern(V,z))},_setObject:function(V){for(var F in V)this._set(F,V[F])},set:function(V,F){return"object"==typeof V?this._setObject(V):this._set(V,F),this},_set:function(V,F){this[V]=F},toggle:function(V){var F=this.get(V);return"boolean"==typeof F&&this.set(V,!F),this},get:function(V){return this[V]}},f=l,g=Math.sqrt,m=Math.atan2,v=Math.pow,_=Math.PI/180,b=Math.PI/2,ee.util={cos:function(V){if(0===V)return 1;switch(V<0&&(V=-V),V/b){case 1:case 3:return 0;case 2:return-1}return Math.cos(V)},sin:function(V){if(0===V)return 0;var F=1;switch(V<0&&(F=-1),V/b){case 1:return F;case 2:return 0;case 3:return-F}return Math.sin(V)},removeFromArray:function(V,F){var z=V.indexOf(F);return-1!==z&&V.splice(z,1),V},getRandomInt:function(V,F){return Math.floor(Math.random()*(F-V+1))+V},degreesToRadians:function(V){return V*_},radiansToDegrees:function(V){return V/_},rotatePoint:function(V,F,z){var $=new ee.Point(V.x-F.x,V.y-F.y),P=ee.util.rotateVector($,z);return new ee.Point(P.x,P.y).addEquals(F)},rotateVector:function(V,F){var z=ee.util.sin(F),$=ee.util.cos(F);return{x:V.x*$-V.y*z,y:V.x*z+V.y*$}},createVector:function(V,F){return new ee.Point(F.x-V.x,F.y-V.y)},calcAngleBetweenVectors:function(V,F){return Math.acos((V.x*F.x+V.y*F.y)/(Math.hypot(V.x,V.y)*Math.hypot(F.x,F.y)))},getHatVector:function(V){return new ee.Point(V.x,V.y).multiply(1/Math.hypot(V.x,V.y))},getBisector:function(V,F,z){var $=ee.util.createVector(V,F),P=ee.util.createVector(V,z),L=ee.util.calcAngleBetweenVectors($,P),X=L*(0===ee.util.calcAngleBetweenVectors(ee.util.rotateVector($,L),P)?1:-1)/2;return{vector:ee.util.getHatVector(ee.util.rotateVector($,X)),angle:L}},projectStrokeOnPoints:function(V,F,z){var $=[],P=F.strokeWidth/2,L=F.strokeUniform?new ee.Point(1/F.scaleX,1/F.scaleY):new ee.Point(1,1),X=function(ne){var Z=P/Math.hypot(ne.x,ne.y);return new ee.Point(ne.x*Z*L.x,ne.y*Z*L.y)};return V.length<=1||V.forEach(function(ne,Z){var te,ae,fe=new ee.Point(ne.x,ne.y);0===Z?(ae=V[Z+1],te=z?X(ee.util.createVector(ae,fe)).addEquals(fe):V[V.length-1]):Z===V.length-1?(te=V[Z-1],ae=z?X(ee.util.createVector(te,fe)).addEquals(fe):V[0]):(te=V[Z-1],ae=V[Z+1]);var be,Pe,De=ee.util.getBisector(fe,te,ae),Xe=De.vector;if("miter"===F.strokeLineJoin&&(be=-P/Math.sin(De.angle/2),Pe=new ee.Point(Xe.x*be*L.x,Xe.y*be*L.y),Math.hypot(Pe.x,Pe.y)/P<=F.strokeMiterLimit))return $.push(fe.add(Pe)),void $.push(fe.subtract(Pe));be=-P*Math.SQRT2,Pe=new ee.Point(Xe.x*be*L.x,Xe.y*be*L.y),$.push(fe.add(Pe)),$.push(fe.subtract(Pe))}),$},transformPoint:function(V,F,z){return z?new ee.Point(F[0]*V.x+F[2]*V.y,F[1]*V.x+F[3]*V.y):new ee.Point(F[0]*V.x+F[2]*V.y+F[4],F[1]*V.x+F[3]*V.y+F[5])},makeBoundingBoxFromPoints:function(V,F){if(F)for(var z=0;z<V.length;z++)V[z]=ee.util.transformPoint(V[z],F);var $=[V[0].x,V[1].x,V[2].x,V[3].x],P=ee.util.array.min($),L=ee.util.array.max($)-P,X=[V[0].y,V[1].y,V[2].y,V[3].y],ne=ee.util.array.min(X);return{left:P,top:ne,width:L,height:ee.util.array.max(X)-ne}},invertTransform:function(V){var F=1/(V[0]*V[3]-V[1]*V[2]),z=[F*V[3],-F*V[1],-F*V[2],F*V[0]],$=ee.util.transformPoint({x:V[4],y:V[5]},z,!0);return z[4]=-$.x,z[5]=-$.y,z},toFixed:function(V,F){return parseFloat(Number(V).toFixed(F))},parseUnit:function(V,F){var z=/\D{0,2}$/.exec(V),$=parseFloat(V);switch(F||(F=ee.Text.DEFAULT_SVG_FONT_SIZE),z[0]){case"mm":return $*ee.DPI/25.4;case"cm":return $*ee.DPI/2.54;case"in":return $*ee.DPI;case"pt":return $*ee.DPI/72;case"pc":return $*ee.DPI/72*12;case"em":return $*F;default:return $}},falseFunction:function(){return!1},getKlass:function(V,F){return V=ee.util.string.camelize(V.charAt(0).toUpperCase()+V.slice(1)),ee.util.resolveNamespace(F)[V]},getSvgAttributes:function(V){var F=["instantiated_by_use","style","id","class"];switch(V){case"linearGradient":F=F.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":F=F.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":F=F.concat(["offset","stop-color","stop-opacity"])}return F},resolveNamespace:function(V){if(!V)return ee;var F,z=V.split("."),$=z.length,P=f||ee.window;for(F=0;F<$;++F)P=P[z[F]];return P},loadImage:function(V,F,z,$){if(V){var P=ee.util.createImage(),L=function(){F&&F.call(z,P,!1),P=P.onload=P.onerror=null};P.onload=L,P.onerror=function(){ee.log("Error loading "+P.src),F&&F.call(z,null,!0),P=P.onload=P.onerror=null},0!==V.indexOf("data")&&null!=$&&(P.crossOrigin=$),"data:image/svg"===V.substring(0,14)&&(P.onload=null,ee.util.loadImageInDom(P,L)),P.src=V}else F&&F.call(z,V)},loadImageInDom:function(V,F){var z=ee.document.createElement("div");z.style.width=z.style.height="1px",z.style.left=z.style.top="-100%",z.style.position="absolute",z.appendChild(V),ee.document.querySelector("body").appendChild(z),V.onload=function(){F(),z.parentNode.removeChild(z),z=null}},enlivenObjects:function(V,F,z,$){var P=[],L=0,X=(V=V||[]).length;function ne(){++L===X&&F&&F(P.filter(function(Z){return Z}))}X?V.forEach(function(Z,te){Z&&Z.type?ee.util.getKlass(Z.type,z).fromObject(Z,function(ae,fe){fe||(P[te]=ae),$&&$(Z,ae,fe),ne()}):ne()}):F&&F(P)},enlivenObjectEnlivables:function(V,F,z){var $=ee.Object.ENLIVEN_PROPS.filter(function(P){return!!V[P]});ee.util.enlivenObjects($.map(function(P){return V[P]}),function(P){var L={};$.forEach(function(X,ne){L[X]=P[ne],F&&(F[X]=P[ne])}),z&&z(L)})},enlivenPatterns:function(V,F){function z(){++P===L&&F&&F($)}var $=[],P=0,L=(V=V||[]).length;L?V.forEach(function(X,ne){X&&X.source?new ee.Pattern(X,function(Z){$[ne]=Z,z()}):($[ne]=X,z())}):F&&F($)},groupSVGElements:function(V,F,z){var $;return V&&1===V.length?V[0]:(F&&(F.width&&F.height?F.centerPoint={x:F.width/2,y:F.height/2}:(delete F.width,delete F.height)),$=new ee.Group(V,F),void 0!==z&&($.sourcePath=z),$)},populateWithProperties:function(V,F,z){if(z&&Array.isArray(z))for(var $=0,P=z.length;$<P;$++)z[$]in V&&(F[z[$]]=V[z[$]])},createCanvasElement:function(){return ee.document.createElement("canvas")},copyCanvasElement:function(V){var F=ee.util.createCanvasElement();return F.width=V.width,F.height=V.height,F.getContext("2d").drawImage(V,0,0),F},toDataURL:function(V,F,z){return V.toDataURL("image/"+F,z)},createImage:function(){return ee.document.createElement("img")},multiplyTransformMatrices:function(V,F,z){return[V[0]*F[0]+V[2]*F[1],V[1]*F[0]+V[3]*F[1],V[0]*F[2]+V[2]*F[3],V[1]*F[2]+V[3]*F[3],z?0:V[0]*F[4]+V[2]*F[5]+V[4],z?0:V[1]*F[4]+V[3]*F[5]+V[5]]},qrDecompose:function(V){var F=m(V[1],V[0]),z=v(V[0],2)+v(V[1],2),$=g(z),P=(V[0]*V[3]-V[2]*V[1])/$,L=m(V[0]*V[2]+V[1]*V[3],z);return{angle:F/_,scaleX:$,scaleY:P,skewX:L/_,skewY:0,translateX:V[4],translateY:V[5]}},calcRotateMatrix:function(V){if(!V.angle)return ee.iMatrix.concat();var F=ee.util.degreesToRadians(V.angle),z=ee.util.cos(F),$=ee.util.sin(F);return[z,$,-$,z,0,0]},calcDimensionsMatrix:function(V){var F=void 0===V.scaleX?1:V.scaleX,z=void 0===V.scaleY?1:V.scaleY,$=[V.flipX?-F:F,0,0,V.flipY?-z:z,0,0],P=ee.util.multiplyTransformMatrices,L=ee.util.degreesToRadians;return V.skewX&&($=P($,[1,0,Math.tan(L(V.skewX)),1],!0)),V.skewY&&($=P($,[1,Math.tan(L(V.skewY)),0,1],!0)),$},composeMatrix:function(V){var F=[1,0,0,1,V.translateX||0,V.translateY||0],z=ee.util.multiplyTransformMatrices;return V.angle&&(F=z(F,ee.util.calcRotateMatrix(V))),(1!==V.scaleX||1!==V.scaleY||V.skewX||V.skewY||V.flipX||V.flipY)&&(F=z(F,ee.util.calcDimensionsMatrix(V))),F},resetObjectTransform:function(V){V.scaleX=1,V.scaleY=1,V.skewX=0,V.skewY=0,V.flipX=!1,V.flipY=!1,V.rotate(0)},saveObjectTransform:function(V){return{scaleX:V.scaleX,scaleY:V.scaleY,skewX:V.skewX,skewY:V.skewY,angle:V.angle,left:V.left,flipX:V.flipX,flipY:V.flipY,top:V.top}},isTransparent:function(V,F,z,$){$>0&&(F>$?F-=$:F=0,z>$?z-=$:z=0);var P,L=!0,X=V.getImageData(F,z,2*$||1,2*$||1),ne=X.data.length;for(P=3;P<ne&&0!=(L=X.data[P]<=0);P+=4);return X=null,L},parsePreserveAspectRatioAttribute:function(V){var F,z="meet",$=V.split(" ");return $&&$.length&&("meet"!==(z=$.pop())&&"slice"!==z?(F=z,z="meet"):$.length&&(F=$.pop())),{meetOrSlice:z,alignX:"none"!==F?F.slice(1,4):"none",alignY:"none"!==F?F.slice(5,8):"none"}},clearFabricFontCache:function(V){(V=(V||"").toLowerCase())?ee.charWidthsCache[V]&&delete ee.charWidthsCache[V]:ee.charWidthsCache={}},limitDimsByArea:function(V,F){var z=Math.sqrt(F*V),$=Math.floor(F/z);return{x:Math.floor(z),y:$}},capValue:function(V,F,z){return Math.max(V,Math.min(F,z))},findScaleToFit:function(V,F){return Math.min(F.width/V.width,F.height/V.height)},findScaleToCover:function(V,F){return Math.max(F.width/V.width,F.height/V.height)},matrixToSVG:function(V){return"matrix("+V.map(function(F){return ee.util.toFixed(F,ee.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(V,F){var z=ee.util.invertTransform(F),$=ee.util.multiplyTransformMatrices(z,V.calcOwnMatrix());ee.util.applyTransformToObject(V,$)},addTransformToObject:function(V,F){ee.util.applyTransformToObject(V,ee.util.multiplyTransformMatrices(F,V.calcOwnMatrix()))},applyTransformToObject:function(V,F){var z=ee.util.qrDecompose(F),$=new ee.Point(z.translateX,z.translateY);V.flipX=!1,V.flipY=!1,V.set("scaleX",z.scaleX),V.set("scaleY",z.scaleY),V.skewX=z.skewX,V.skewY=z.skewY,V.angle=z.angle,V.setPositionByOrigin($,"center","center")},sizeAfterTransform:function(V,F,z){var $=V/2,P=F/2,L=[{x:-$,y:-P},{x:$,y:-P},{x:-$,y:P},{x:$,y:P}],X=ee.util.calcDimensionsMatrix(z),ne=ee.util.makeBoundingBoxFromPoints(L,X);return{x:ne.width,y:ne.height}},mergeClipPaths:function(V,F){var z=V,$=F;z.inverted&&!$.inverted&&(z=F,$=V),ee.util.applyTransformToObject($,ee.util.multiplyTransformMatrices(ee.util.invertTransform(z.calcTransformMatrix()),$.calcTransformMatrix()));var P=z.inverted&&$.inverted;return P&&(z.inverted=$.inverted=!1),new ee.Group([z],{clipPath:$,inverted:P})}},function(){var V=Array.prototype.join,F={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},z={m:"l",M:"L"};function $(Pe,De,Xe,Re,Ae,de,tt,Ze,et,Qe,Je){var st=ee.util.cos(Pe),mt=ee.util.sin(Pe),ut=ee.util.cos(De),Ke=ee.util.sin(De),nt=Xe*Ae*ut-Re*de*Ke+tt,lt=Re*Ae*ut+Xe*de*Ke+Ze;return["C",Qe+et*(-Xe*Ae*mt-Re*de*st),Je+et*(-Re*Ae*mt+Xe*de*st),nt+et*(Xe*Ae*Ke+Re*de*ut),lt+et*(Re*Ae*Ke-Xe*de*ut),nt,lt]}function P(Pe,De,Xe,Re){var Ae=Math.atan2(De,Pe),de=Math.atan2(Re,Xe);return de>=Ae?de-Ae:2*Math.PI-(Ae-de)}function L(Pe,De,Xe){for(var et=function(st,mt,ut,Ke,nt,lt,xt){var dt=Math.PI,Dt=xt*dt/180,Rt=ee.util.sin(Dt),Nt=ee.util.cos(Dt),Ot=0,Vt=0,$t=-Nt*st*.5-Rt*mt*.5,on=-Nt*mt*.5+Rt*st*.5,dn=(ut=Math.abs(ut))*ut,sn=(Ke=Math.abs(Ke))*Ke,bn=on*on,ct=$t*$t,ht=dn*sn-dn*bn-sn*ct,Ft=0;if(ht<0){var Wt=Math.sqrt(1-ht/(dn*sn));ut*=Wt,Ke*=Wt}else Ft=(nt===lt?-1:1)*Math.sqrt(ht/(dn*bn+sn*ct));var rn=Ft*ut*on/Ke,Yn=-Ft*Ke*$t/ut,ki=Nt*rn-Rt*Yn+.5*st,Hi=Rt*rn+Nt*Yn+.5*mt,Ji=P(1,0,($t-rn)/ut,(on-Yn)/Ke),Or=P(($t-rn)/ut,(on-Yn)/Ke,(-$t-rn)/ut,(-on-Yn)/Ke);0===lt&&Or>0?Or-=2*dt:1===lt&&Or<0&&(Or+=2*dt);for(var Ga=Math.ceil(Math.abs(Or/dt*2)),ca=[],Ju=Or/Ga,eh=8/3*Math.sin(Ju/4)*Math.sin(Ju/4)/Math.sin(Ju/2),kw=Ji+Ju,em=0;em<Ga;em++)ca[em]=$(Ji,kw,Nt,Rt,ut,Ke,ki,Hi,eh,Ot,Vt),Ot=ca[em][5],Vt=ca[em][6],Ji=kw,kw+=Ju;return ca}(Xe[6]-Pe,Xe[7]-De,Xe[1],Xe[2],Xe[4],Xe[5],Xe[3]),Qe=0,Je=et.length;Qe<Je;Qe++)et[Qe][1]+=Pe,et[Qe][2]+=De,et[Qe][3]+=Pe,et[Qe][4]+=De,et[Qe][5]+=Pe,et[Qe][6]+=De;return et}function X(Pe,De,Xe,Re){return Math.sqrt((Xe-Pe)*(Xe-Pe)+(Re-De)*(Re-De))}function ne(Pe,De,Xe,Re,Ae,de,tt,Ze){return function(et){var Qe,Ke,Je=(Qe=et)*Qe*Qe,st=3*(Ke=et)*Ke*(1-Ke),mt=function(Ke){return 3*Ke*(1-Ke)*(1-Ke)}(et),ut=function(Ke){return(1-Ke)*(1-Ke)*(1-Ke)}(et);return{x:tt*Je+Ae*st+Xe*mt+Pe*ut,y:Ze*Je+de*st+Re*mt+De*ut}}}function Z(Pe,De,Xe,Re,Ae,de,tt,Ze){return function(et){var Qe=1-et;return Math.atan2(3*Qe*Qe*(Re-De)+6*Qe*et*(de-Re)+3*et*et*(Ze-de),3*Qe*Qe*(Xe-Pe)+6*Qe*et*(Ae-Xe)+3*et*et*(tt-Ae))}}function te(Pe,De,Xe,Re,Ae,de){return function(tt){var Ze,st,et=(Ze=tt)*Ze,Qe=2*(st=tt)*(1-st),Je=function(st){return(1-st)*(1-st)}(tt);return{x:Ae*et+Xe*Qe+Pe*Je,y:de*et+Re*Qe+De*Je}}}function ae(Pe,De,Xe,Re,Ae,de){return function(tt){var Ze=1-tt;return Math.atan2(2*Ze*(Re-De)+2*tt*(de-Re),2*Ze*(Xe-Pe)+2*tt*(Ae-Xe))}}function fe(Pe,De,Xe){var Re,Ae,de={x:De,y:Xe},tt=0;for(Ae=1;Ae<=100;Ae+=1)Re=Pe(Ae/100),tt+=X(de.x,de.y,Re.x,Re.y),de=Re;return tt}function be(Pe){for(var De,Xe,Re,Ae,de=0,tt=Pe.length,Ze=0,et=0,Qe=0,Je=0,st=[],mt=0;mt<tt;mt++){switch(Re={x:Ze,y:et,command:(De=Pe[mt])[0]},De[0]){case"M":Re.length=0,Qe=Ze=De[1],Je=et=De[2];break;case"L":Re.length=X(Ze,et,De[1],De[2]),Ze=De[1],et=De[2];break;case"C":Xe=ne(Ze,et,De[1],De[2],De[3],De[4],De[5],De[6]),Ae=Z(Ze,et,De[1],De[2],De[3],De[4],De[5],De[6]),Re.iterator=Xe,Re.angleFinder=Ae,Re.length=fe(Xe,Ze,et),Ze=De[5],et=De[6];break;case"Q":Xe=te(Ze,et,De[1],De[2],De[3],De[4]),Ae=ae(Ze,et,De[1],De[2],De[3],De[4]),Re.iterator=Xe,Re.angleFinder=Ae,Re.length=fe(Xe,Ze,et),Ze=De[3],et=De[4];break;case"Z":case"z":Re.destX=Qe,Re.destY=Je,Re.length=X(Ze,et,Qe,Je),Ze=Qe,et=Je}de+=Re.length,st.push(Re)}return st.push({length:de,x:Ze,y:et}),st}ee.util.joinPath=function(Pe){return Pe.map(function(De){return De.join(" ")}).join(" ")},ee.util.parsePath=function(Pe){var De,Xe,Re,Ae,de,tt=[],Ze=[],et=ee.rePathCommand,Qe="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",Je="("+Qe+")"+ee.commaWsp,st="([01])"+ee.commaWsp+"?",mt=new RegExp(Je+"?"+Je+"?"+Je+st+st+Je+"?("+Qe+")","g");if(!Pe||!Pe.match)return tt;for(var ut,Ke=0,nt=(de=Pe.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;Ke<nt;Ke++){Ae=(De=de[Ke]).slice(1).trim(),Ze.length=0;var lt=De.charAt(0);if(ut=[lt],"a"===lt.toLowerCase())for(var xt;xt=mt.exec(Ae);)for(var dt=1;dt<xt.length;dt++)Ze.push(xt[dt]);else for(;Re=et.exec(Ae);)Ze.push(Re[0]);dt=0;for(var Dt=Ze.length;dt<Dt;dt++)Xe=parseFloat(Ze[dt]),isNaN(Xe)||ut.push(Xe);var Rt=F[lt.toLowerCase()],Nt=z[lt]||lt;if(ut.length-1>Rt)for(var Ot=1,Vt=ut.length;Ot<Vt;Ot+=Rt)tt.push([lt].concat(ut.slice(Ot,Ot+Rt))),lt=Nt;else tt.push(ut)}return tt},ee.util.makePathSimpler=function(Pe){var De,Xe,Re,Ae,de,tt,Ze=0,et=0,Qe=Pe.length,Je=0,st=0,mt=[];for(Xe=0;Xe<Qe;++Xe){switch(Re=!1,(De=Pe[Xe].slice(0))[0]){case"l":De[0]="L",De[1]+=Ze,De[2]+=et;case"L":Ze=De[1],et=De[2];break;case"h":De[1]+=Ze;case"H":De[0]="L",De[2]=et,Ze=De[1];break;case"v":De[1]+=et;case"V":De[0]="L",et=De[1],De[1]=Ze,De[2]=et;break;case"m":De[0]="M",De[1]+=Ze,De[2]+=et;case"M":Ze=De[1],et=De[2],Je=De[1],st=De[2];break;case"c":De[0]="C",De[1]+=Ze,De[2]+=et,De[3]+=Ze,De[4]+=et,De[5]+=Ze,De[6]+=et;case"C":de=De[3],tt=De[4],Ze=De[5],et=De[6];break;case"s":De[0]="S",De[1]+=Ze,De[2]+=et,De[3]+=Ze,De[4]+=et;case"S":"C"===Ae?(de=2*Ze-de,tt=2*et-tt):(de=Ze,tt=et),Ze=De[3],et=De[4],De[0]="C",De[5]=De[3],De[6]=De[4],De[3]=De[1],De[4]=De[2],De[1]=de,De[2]=tt,de=De[3],tt=De[4];break;case"q":De[0]="Q",De[1]+=Ze,De[2]+=et,De[3]+=Ze,De[4]+=et;case"Q":de=De[1],tt=De[2],Ze=De[3],et=De[4];break;case"t":De[0]="T",De[1]+=Ze,De[2]+=et;case"T":"Q"===Ae?(de=2*Ze-de,tt=2*et-tt):(de=Ze,tt=et),De[0]="Q",Ze=De[1],et=De[2],De[1]=de,De[2]=tt,De[3]=Ze,De[4]=et;break;case"a":De[0]="A",De[6]+=Ze,De[7]+=et;case"A":Re=!0,mt=mt.concat(L(Ze,et,De)),Ze=De[6],et=De[7];break;case"z":case"Z":Ze=Je,et=st}Re||mt.push(De),Ae=De[0]}return mt},ee.util.getSmoothPathFromPoints=function(Pe,De){var Xe,Re=[],Ae=new ee.Point(Pe[0].x,Pe[0].y),de=new ee.Point(Pe[1].x,Pe[1].y),tt=Pe.length,Ze=1,et=0,Qe=tt>2;for(Qe&&(Ze=Pe[2].x<de.x?-1:Pe[2].x===de.x?0:1,et=Pe[2].y<de.y?-1:Pe[2].y===de.y?0:1),Re.push(["M",Ae.x-Ze*(De=De||0),Ae.y-et*De]),Xe=1;Xe<tt;Xe++){if(!Ae.eq(de)){var Je=Ae.midPointFrom(de);Re.push(["Q",Ae.x,Ae.y,Je.x,Je.y])}Ae=Pe[Xe],Xe+1<Pe.length&&(de=Pe[Xe+1])}return Qe&&(Ze=Ae.x>Pe[Xe-2].x?1:Ae.x===Pe[Xe-2].x?0:-1,et=Ae.y>Pe[Xe-2].y?1:Ae.y===Pe[Xe-2].y?0:-1),Re.push(["L",Ae.x+Ze*De,Ae.y+et*De]),Re},ee.util.getPathSegmentsInfo=be,ee.util.getBoundsOfCurve=function(Pe,De,Xe,Re,Ae,de,tt,Ze){var et;if(ee.cachesBoundsOfCurve&&(et=V.call(arguments),ee.boundsOfCurveCache[et]))return ee.boundsOfCurveCache[et];var Qe,Je,st,mt,ut,Ke,nt,lt,xt=Math.sqrt,dt=Math.min,Dt=Math.max,Rt=Math.abs,Nt=[],Ot=[[],[]];Je=6*Pe-12*Xe+6*Ae,Qe=-3*Pe+9*Xe-9*Ae+3*tt,st=3*Xe-3*Pe;for(var Vt=0;Vt<2;++Vt)if(Vt>0&&(Je=6*De-12*Re+6*de,Qe=-3*De+9*Re-9*de+3*Ze,st=3*Re-3*De),Rt(Qe)<1e-12){if(Rt(Je)<1e-12)continue;0<(mt=-st/Je)&&mt<1&&Nt.push(mt)}else(nt=Je*Je-4*st*Qe)<0||(0<(ut=(-Je+(lt=xt(nt)))/(2*Qe))&&ut<1&&Nt.push(ut),0<(Ke=(-Je-lt)/(2*Qe))&&Ke<1&&Nt.push(Ke));for(var $t,dn,sn=Nt.length,bn=sn;sn--;)$t=(dn=1-(mt=Nt[sn]))*dn*dn*Pe+3*dn*dn*mt*Xe+3*dn*mt*mt*Ae+mt*mt*mt*tt,Ot[0][sn]=$t,Ot[1][sn]=dn*dn*dn*De+3*dn*dn*mt*Re+3*dn*mt*mt*de+mt*mt*mt*Ze;Ot[0][bn]=Pe,Ot[1][bn]=De,Ot[0][bn+1]=tt,Ot[1][bn+1]=Ze;var ct=[{x:dt.apply(null,Ot[0]),y:dt.apply(null,Ot[1])},{x:Dt.apply(null,Ot[0]),y:Dt.apply(null,Ot[1])}];return ee.cachesBoundsOfCurve&&(ee.boundsOfCurveCache[et]=ct),ct},ee.util.getPointOnPath=function(Pe,De,Xe){Xe||(Xe=be(Pe));for(var Re=0;De-Xe[Re].length>0&&Re<Xe.length-2;)De-=Xe[Re].length,Re++;var Ae,de=Xe[Re],tt=De/de.length,et=Pe[Re];switch(de.command){case"M":return{x:de.x,y:de.y,angle:0};case"Z":case"z":return(Ae=new ee.Point(de.x,de.y).lerp(new ee.Point(de.destX,de.destY),tt)).angle=Math.atan2(de.destY-de.y,de.destX-de.x),Ae;case"L":return(Ae=new ee.Point(de.x,de.y).lerp(new ee.Point(et[1],et[2]),tt)).angle=Math.atan2(et[2]-de.y,et[1]-de.x),Ae;case"C":case"Q":return function(Qe,Je){for(var st,mt,ut,Ke=0,nt=0,lt=Qe.iterator,xt={x:Qe.x,y:Qe.y},dt=.01,Dt=Qe.angleFinder;nt<Je&&dt>1e-4;)st=lt(Ke),ut=Ke,(mt=X(xt.x,xt.y,st.x,st.y))+nt>Je?(Ke-=dt,dt/=2):(xt=st,Ke+=dt,nt+=mt);return st.angle=Dt(ut),st}(de,De)}},ee.util.transformPath=function(Pe,De,Xe){return Xe&&(De=ee.util.multiplyTransformMatrices(De,[1,0,0,1,-Xe.x,-Xe.y])),Pe.map(function(Re){for(var Ae=Re.slice(0),de={},tt=1;tt<Re.length-1;tt+=2)de.x=Re[tt],de.y=Re[tt+1],de=ee.util.transformPoint(de,De),Ae[tt]=de.x,Ae[tt+1]=de.y;return Ae})}}(),function(){var V=Array.prototype.slice;function F(z,$,P){if(z&&0!==z.length){var L=z.length-1,X=$?z[L][$]:z[L];if($)for(;L--;)P(z[L][$],X)&&(X=z[L][$]);else for(;L--;)P(z[L],X)&&(X=z[L]);return X}}ee.util.array={fill:function(z,$){for(var P=z.length;P--;)z[P]=$;return z},invoke:function(z,$){for(var P=V.call(arguments,2),L=[],X=0,ne=z.length;X<ne;X++)L[X]=P.length?z[X][$].apply(z[X],P):z[X][$].call(z[X]);return L},min:function(z,$){return F(z,$,function(P,L){return P<L})},max:function(z,$){return F(z,$,function(P,L){return P>=L})}}}(),function(){function V(F,z,$){if($)if(!ee.isLikelyNode&&z instanceof Element)F=z;else if(z instanceof Array){F=[];for(var P=0,L=z.length;P<L;P++)F[P]=V({},z[P],$)}else if(z&&"object"==typeof z)for(var X in z)"canvas"===X||"group"===X?F[X]=null:z.hasOwnProperty(X)&&(F[X]=V({},z[X],$));else F=z;else for(var X in z)F[X]=z[X];return F}ee.util.object={extend:V,clone:function(F,z){return V({},F,z)}},ee.util.object.extend(ee.util,ee.Observable)}(),function(){function V(F,z){var $=F.charCodeAt(z);if(isNaN($))return"";if($<55296||$>57343)return F.charAt(z);if(55296<=$&&$<=56319){if(F.length<=z+1)throw"High surrogate without following low surrogate";var P=F.charCodeAt(z+1);if(56320>P||P>57343)throw"High surrogate without following low surrogate";return F.charAt(z)+F.charAt(z+1)}if(0===z)throw"Low surrogate without preceding high surrogate";var L=F.charCodeAt(z-1);if(55296>L||L>56319)throw"Low surrogate without preceding high surrogate";return!1}ee.util.string={camelize:function(F){return F.replace(/-+(.)?/g,function(z,$){return $?$.toUpperCase():""})},capitalize:function(F,z){return F.charAt(0).toUpperCase()+(z?F.slice(1):F.slice(1).toLowerCase())},escapeXml:function(F){return F.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(F){var z,$=0,P=[];for($=0;$<F.length;$++)!1!==(z=V(F,$))&&P.push(z);return P}}}(),function(){var V=Array.prototype.slice,F=function(){},z=function(){for(var X in{toString:1})if("toString"===X)return!1;return!0}(),$=function(X,ne,Z){for(var te in ne)X.prototype[te]=te in X.prototype&&"function"==typeof X.prototype[te]&&(ne[te]+"").indexOf("callSuper")>-1?function(ae){return function(){var fe=this.constructor.superclass;this.constructor.superclass=Z;var be=ne[ae].apply(this,arguments);if(this.constructor.superclass=fe,"initialize"!==ae)return be}}(te):ne[te],z&&(ne.toString!==Object.prototype.toString&&(X.prototype.toString=ne.toString),ne.valueOf!==Object.prototype.valueOf&&(X.prototype.valueOf=ne.valueOf))};function P(){}function L(X){for(var ne=null,Z=this;Z.constructor.superclass;){var te=Z.constructor.superclass.prototype[X];if(Z[X]!==te){ne=te;break}Z=Z.constructor.superclass.prototype}return ne?arguments.length>1?ne.apply(this,V.call(arguments,1)):ne.call(this):console.log("tried to callSuper "+X+", method not found in prototype chain",this)}ee.util.createClass=function(){var X=null,ne=V.call(arguments,0);function Z(){this.initialize.apply(this,arguments)}"function"==typeof ne[0]&&(X=ne.shift()),Z.superclass=X,Z.subclasses=[],X&&(P.prototype=X.prototype,Z.prototype=new P,X.subclasses.push(Z));for(var te=0,ae=ne.length;te<ae;te++)$(Z,ne[te],X);return Z.prototype.initialize||(Z.prototype.initialize=F),Z.prototype.constructor=Z,Z.prototype.callSuper=L,Z}}(),S=!!ee.document.createElement("div").attachEvent,I=["touchstart","touchmove","touchend"],ee.util.addListener=function(V,F,z,$){V&&V.addEventListener(F,z,!S&&$)},ee.util.removeListener=function(V,F,z,$){V&&V.removeEventListener(F,z,!S&&$)},ee.util.getPointer=function(V){var P,L,z=ee.util.getScrollLeftTop(V.target),$=(L=(P=V).changedTouches)&&L[0]?L[0]:P;return{x:$.clientX+z.left,y:$.clientY+z.top}},ee.util.isTouchEvent=function(V){return I.indexOf(V.type)>-1||"touch"===V.pointerType},O="string"==typeof(k=ee.document.createElement("div")).style.opacity,W=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,J=function(V){return V},O?J=function(V,F){return V.style.opacity=F,V}:"string"==typeof k.style.filter&&(J=function(V,F){var z=V.style;return V.currentStyle&&!V.currentStyle.hasLayout&&(z.zoom=1),W.test(z.filter)?z.filter=z.filter.replace(W,F=F>=.9999?"":"alpha(opacity="+100*F+")"):z.filter+=" alpha(opacity="+100*F+")",V}),ee.util.setStyle=function(V,F){var z=V.style;if(!z)return V;if("string"==typeof F)return V.style.cssText+=";"+F,F.indexOf("opacity")>-1?J(V,F.match(/opacity:\s*(\d?\.?\d*)/)[1]):V;for(var $ in F)"opacity"===$?J(V,F[$]):z["float"===$||"cssFloat"===$?void 0===z.styleFloat?"cssFloat":"styleFloat":$]=F[$];return V},function(){var V,F,z,$,P=Array.prototype.slice,L=function(Z){return P.call(Z,0)};try{V=L(ee.document.childNodes)instanceof Array}catch(Z){}function X(Z,te){var ae=ee.document.createElement(Z);for(var fe in te)"class"===fe?ae.className=te[fe]:"for"===fe?ae.htmlFor=te[fe]:ae.setAttribute(fe,te[fe]);return ae}function ne(Z){for(var te=0,ae=0,fe=ee.document.documentElement,be=ee.document.body||{scrollLeft:0,scrollTop:0};Z&&(Z.parentNode||Z.host)&&((Z=Z.parentNode||Z.host)===ee.document?(te=be.scrollLeft||fe.scrollLeft||0,ae=be.scrollTop||fe.scrollTop||0):(te+=Z.scrollLeft||0,ae+=Z.scrollTop||0),1!==Z.nodeType||"fixed"!==Z.style.position););return{left:te,top:ae}}V||(L=function(Z){for(var te=new Array(Z.length),ae=Z.length;ae--;)te[ae]=Z[ae];return te}),F=ee.document.defaultView&&ee.document.defaultView.getComputedStyle?function(Z,te){var ae=ee.document.defaultView.getComputedStyle(Z,null);return ae?ae[te]:void 0}:function(Z,te){var ae=Z.style[te];return!ae&&Z.currentStyle&&(ae=Z.currentStyle[te]),ae},$="userSelect"in(z=ee.document.documentElement.style)?"userSelect":"MozUserSelect"in z?"MozUserSelect":"WebkitUserSelect"in z?"WebkitUserSelect":"KhtmlUserSelect"in z?"KhtmlUserSelect":"",ee.util.makeElementUnselectable=function(Z){return void 0!==Z.onselectstart&&(Z.onselectstart=ee.util.falseFunction),$?Z.style[$]="none":"string"==typeof Z.unselectable&&(Z.unselectable="on"),Z},ee.util.makeElementSelectable=function(Z){return void 0!==Z.onselectstart&&(Z.onselectstart=null),$?Z.style[$]="":"string"==typeof Z.unselectable&&(Z.unselectable=""),Z},ee.util.setImageSmoothing=function(Z,te){Z.imageSmoothingEnabled=Z.imageSmoothingEnabled||Z.webkitImageSmoothingEnabled||Z.mozImageSmoothingEnabled||Z.msImageSmoothingEnabled||Z.oImageSmoothingEnabled,Z.imageSmoothingEnabled=te},ee.util.getById=function(Z){return"string"==typeof Z?ee.document.getElementById(Z):Z},ee.util.toArray=L,ee.util.addClass=function(Z,te){Z&&-1===(" "+Z.className+" ").indexOf(" "+te+" ")&&(Z.className+=(Z.className?" ":"")+te)},ee.util.makeElement=X,ee.util.wrapElement=function(Z,te,ae){return"string"==typeof te&&(te=X(te,ae)),Z.parentNode&&Z.parentNode.replaceChild(te,Z),te.appendChild(Z),te},ee.util.getScrollLeftTop=ne,ee.util.getElementOffset=function(Z){var te,ae,fe=Z&&Z.ownerDocument,be={left:0,top:0},Pe={left:0,top:0},De={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!fe)return Pe;for(var Xe in De)Pe[De[Xe]]+=parseInt(F(Z,Xe),10)||0;return te=fe.documentElement,void 0!==Z.getBoundingClientRect&&(be=Z.getBoundingClientRect()),ae=ne(Z),{left:be.left+ae.left-(te.clientLeft||0)+Pe.left,top:be.top+ae.top-(te.clientTop||0)+Pe.top}},ee.util.getNodeCanvas=function(Z){var te=ee.jsdomImplForWrapper(Z);return te._canvas||te._image},ee.util.cleanUpJsdomNode=function(Z){if(ee.isLikelyNode){var te=ee.jsdomImplForWrapper(Z);te&&(te._image=null,te._canvas=null,te._currentSrc=null,te._attributes=null,te._classList=null)}}}(),function(){function V(){}ee.util.request=function(F,z){z||(z={});var ne,Z,$=z.method?z.method.toUpperCase():"GET",P=z.onComplete||function(){},L=new ee.window.XMLHttpRequest,X=z.body||z.parameters;return L.onreadystatechange=function(){4===L.readyState&&(P(L),L.onreadystatechange=V)},"GET"===$&&(X=null,"string"==typeof z.parameters&&(Z=z.parameters,F=(ne=F)+(/\?/.test(ne)?"&":"?")+Z)),L.open($,F,!0),"POST"!==$&&"PUT"!==$||L.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),L.send(X),L}}(),ee.log=console.log,ee.warn=console.warn,function(){var V=ee.util.object.extend,F=ee.util.object.clone,z=[];function $(){return!1}function P(Z,te,ae,fe){return-ae*Math.cos(Z/fe*(Math.PI/2))+ae+te}ee.util.object.extend(z,{cancelAll:function(){var Z=this.splice(0);return Z.forEach(function(te){te.cancel()}),Z},cancelByCanvas:function(Z){if(!Z)return[];var te=this.filter(function(ae){return"object"==typeof ae.target&&ae.target.canvas===Z});return te.forEach(function(ae){ae.cancel()}),te},cancelByTarget:function(Z){var te=this.findAnimationsByTarget(Z);return te.forEach(function(ae){ae.cancel()}),te},findAnimationIndex:function(Z){return this.indexOf(this.findAnimation(Z))},findAnimation:function(Z){return this.find(function(te){return te.cancel===Z})},findAnimationsByTarget:function(Z){return Z?this.filter(function(te){return te.target===Z}):[]}});var L=ee.window.requestAnimationFrame||ee.window.webkitRequestAnimationFrame||ee.window.mozRequestAnimationFrame||ee.window.oRequestAnimationFrame||ee.window.msRequestAnimationFrame||function(Z){return ee.window.setTimeout(Z,1e3/60)},X=ee.window.cancelAnimationFrame||ee.window.clearTimeout;function ne(){return L.apply(ee.window,arguments)}ee.util.animate=function(Z){Z||(Z={});var te,ae=!1,fe=function(){var be=ee.runningAnimations.indexOf(te);return be>-1&&ee.runningAnimations.splice(be,1)[0]};return te=V(F(Z),{cancel:function(){return ae=!0,fe()},currentValue:"startValue"in Z?Z.startValue:0,completionRate:0,durationRate:0}),ee.runningAnimations.push(te),ne(function(be){var Pe,De=be||+new Date,Xe=Z.duration||500,Re=De+Xe,Ae=Z.onChange||$,de=Z.abort||$,tt=Z.onComplete||$,Ze=Z.easing||P,et="startValue"in Z&&Z.startValue.length>0,Qe="startValue"in Z?Z.startValue:0,Je="endValue"in Z?Z.endValue:100,st=Z.byValue||(et?Qe.map(function(mt,ut){return Je[ut]-Qe[ut]}):Je-Qe);Z.onStart&&Z.onStart(),function mt(ut){var Ke=(Pe=ut||+new Date)>Re?Xe:Pe-De,nt=Ke/Xe,lt=et?Qe.map(function(dt,Dt){return Ze(Ke,Qe[Dt],st[Dt],Xe)}):Ze(Ke,Qe,st,Xe),xt=Math.abs(et?(lt[0]-Qe[0])/st[0]:(lt-Qe)/st);if(te.currentValue=et?lt.slice():lt,te.completionRate=xt,te.durationRate=nt,!ae){if(!de(lt,xt,nt))return Pe>Re?(te.currentValue=et?Je.slice():Je,te.completionRate=1,te.durationRate=1,Ae(et?Je.slice():Je,1,1),tt(Je,1,1),void fe()):(Ae(lt,xt,nt),void ne(mt));fe()}}(De)}),te.cancel},ee.util.requestAnimFrame=ne,ee.util.cancelAnimFrame=function(){return X.apply(ee.window,arguments)},ee.runningAnimations=z}(),function(){function V(F,z,$){var P="rgba("+parseInt(F[0]+$*(z[0]-F[0]),10)+","+parseInt(F[1]+$*(z[1]-F[1]),10)+","+parseInt(F[2]+$*(z[2]-F[2]),10);return(P+=","+(F&&z?parseFloat(F[3]+$*(z[3]-F[3])):1))+")"}ee.util.animateColor=function(F,z,$,P){var L=new ee.Color(F).getSource(),X=new ee.Color(z).getSource(),ne=P.onComplete,Z=P.onChange;return ee.util.animate(ee.util.object.extend(P=P||{},{duration:$||500,startValue:L,endValue:X,byValue:X,easing:function(te,ae,fe,be){return V(ae,fe,P.colorEasing?P.colorEasing(te,be):1-Math.cos(te/be*(Math.PI/2)))},onComplete:function(te,ae,fe){if(ne)return ne(V(X,X,0),ae,fe)},onChange:function(te,ae,fe){if(Z){if(Array.isArray(te))return Z(V(te,te,0),ae,fe);Z(te,ae,fe)}}}))}}(),function(){function V(P,L,X,ne){return P<Math.abs(L)?(P=L,ne=X/4):ne=0===L&&0===P?X/(2*Math.PI)*Math.asin(1):X/(2*Math.PI)*Math.asin(L/P),{a:P,c:L,p:X,s:ne}}function F(P,L,X){return P.a*Math.pow(2,10*(L-=1))*Math.sin((L*X-P.s)*(2*Math.PI)/P.p)}function z(P,L,X,ne){return X-$(ne-P,0,X,ne)+L}function $(P,L,X,ne){return(P/=ne)<1/2.75?X*(7.5625*P*P)+L:P<2/2.75?X*(7.5625*(P-=1.5/2.75)*P+.75)+L:P<2.5/2.75?X*(7.5625*(P-=2.25/2.75)*P+.9375)+L:X*(7.5625*(P-=2.625/2.75)*P+.984375)+L}ee.util.ease={easeInQuad:function(P,L,X,ne){return X*(P/=ne)*P+L},easeOutQuad:function(P,L,X,ne){return-X*(P/=ne)*(P-2)+L},easeInOutQuad:function(P,L,X,ne){return(P/=ne/2)<1?X/2*P*P+L:-X/2*(--P*(P-2)-1)+L},easeInCubic:function(P,L,X,ne){return X*(P/=ne)*P*P+L},easeOutCubic:function(P,L,X,ne){return X*((P=P/ne-1)*P*P+1)+L},easeInOutCubic:function(P,L,X,ne){return(P/=ne/2)<1?X/2*P*P*P+L:X/2*((P-=2)*P*P+2)+L},easeInQuart:function(P,L,X,ne){return X*(P/=ne)*P*P*P+L},easeOutQuart:function(P,L,X,ne){return-X*((P=P/ne-1)*P*P*P-1)+L},easeInOutQuart:function(P,L,X,ne){return(P/=ne/2)<1?X/2*P*P*P*P+L:-X/2*((P-=2)*P*P*P-2)+L},easeInQuint:function(P,L,X,ne){return X*(P/=ne)*P*P*P*P+L},easeOutQuint:function(P,L,X,ne){return X*((P=P/ne-1)*P*P*P*P+1)+L},easeInOutQuint:function(P,L,X,ne){return(P/=ne/2)<1?X/2*P*P*P*P*P+L:X/2*((P-=2)*P*P*P*P+2)+L},easeInSine:function(P,L,X,ne){return-X*Math.cos(P/ne*(Math.PI/2))+X+L},easeOutSine:function(P,L,X,ne){return X*Math.sin(P/ne*(Math.PI/2))+L},easeInOutSine:function(P,L,X,ne){return-X/2*(Math.cos(Math.PI*P/ne)-1)+L},easeInExpo:function(P,L,X,ne){return 0===P?L:X*Math.pow(2,10*(P/ne-1))+L},easeOutExpo:function(P,L,X,ne){return P===ne?L+X:X*(1-Math.pow(2,-10*P/ne))+L},easeInOutExpo:function(P,L,X,ne){return 0===P?L:P===ne?L+X:(P/=ne/2)<1?X/2*Math.pow(2,10*(P-1))+L:X/2*(2-Math.pow(2,-10*--P))+L},easeInCirc:function(P,L,X,ne){return-X*(Math.sqrt(1-(P/=ne)*P)-1)+L},easeOutCirc:function(P,L,X,ne){return X*Math.sqrt(1-(P=P/ne-1)*P)+L},easeInOutCirc:function(P,L,X,ne){return(P/=ne/2)<1?-X/2*(Math.sqrt(1-P*P)-1)+L:X/2*(Math.sqrt(1-(P-=2)*P)+1)+L},easeInElastic:function(P,L,X,ne){var Z=0;return 0===P?L:1==(P/=ne)?L+X:(Z||(Z=.3*ne),-F(V(X,X,Z,1.70158),P,ne)+L)},easeOutElastic:function(P,L,X,ne){var Z=0;if(0===P)return L;if(1==(P/=ne))return L+X;Z||(Z=.3*ne);var te=V(X,X,Z,1.70158);return te.a*Math.pow(2,-10*P)*Math.sin((P*ne-te.s)*(2*Math.PI)/te.p)+te.c+L},easeInOutElastic:function(P,L,X,ne){var Z=0;if(0===P)return L;if(2==(P/=ne/2))return L+X;Z||(Z=ne*(.3*1.5));var te=V(X,X,Z,1.70158);return P<1?-.5*F(te,P,ne)+L:te.a*Math.pow(2,-10*(P-=1))*Math.sin((P*ne-te.s)*(2*Math.PI)/te.p)*.5+te.c+L},easeInBack:function(P,L,X,ne,Z){return void 0===Z&&(Z=1.70158),X*(P/=ne)*P*((Z+1)*P-Z)+L},easeOutBack:function(P,L,X,ne,Z){return void 0===Z&&(Z=1.70158),X*((P=P/ne-1)*P*((Z+1)*P+Z)+1)+L},easeInOutBack:function(P,L,X,ne,Z){return void 0===Z&&(Z=1.70158),(P/=ne/2)<1?X/2*(P*P*((1+(Z*=1.525))*P-Z))+L:X/2*((P-=2)*P*((1+(Z*=1.525))*P+Z)+2)+L},easeInBounce:z,easeOutBounce:$,easeInOutBounce:function(P,L,X,ne){return P<ne/2?.5*z(2*P,0,X,ne)+L:.5*$(2*P-ne,0,X,ne)+.5*X+L}}}(),function(V){var F=V.fabric||(V.fabric={}),z=F.util.object.extend,$=F.util.object.clone,P=F.util.toFixed,L=F.util.parseUnit,X=F.util.multiplyTransformMatrices,ne={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},Z={stroke:"strokeOpacity",fill:"fillOpacity"},te="font-size",ae="clip-path";function fe(Qe){return Qe in ne?ne[Qe]:Qe}function be(Qe,Je,st,mt){var ut,Ke=Array.isArray(Je);if("fill"!==Qe&&"stroke"!==Qe||"none"!==Je){if("strokeUniform"===Qe)return"non-scaling-stroke"===Je;if("strokeDashArray"===Qe)Je="none"===Je?null:Je.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===Qe)Je=st&&st.transformMatrix?X(st.transformMatrix,F.parseTransformAttribute(Je)):F.parseTransformAttribute(Je);else if("visible"===Qe)Je="none"!==Je&&"hidden"!==Je,st&&!1===st.visible&&(Je=!1);else if("opacity"===Qe)Je=parseFloat(Je),st&&void 0!==st.opacity&&(Je*=st.opacity);else if("textAnchor"===Qe)Je="start"===Je?"left":"end"===Je?"right":"center";else if("charSpacing"===Qe)ut=L(Je,mt)/mt*1e3;else if("paintFirst"===Qe){var nt=Je.indexOf("fill"),lt=Je.indexOf("stroke");Je="fill",(nt>-1&&lt>-1&&lt<nt||-1===nt&&lt>-1)&&(Je="stroke")}else{if("href"===Qe||"xlink:href"===Qe||"font"===Qe)return Je;if("imageSmoothing"===Qe)return"optimizeQuality"===Je;ut=Ke?Je.map(L):L(Je,mt)}}else Je="";return!Ke&&isNaN(ut)?Je:ut}function Pe(Qe){return new RegExp("^("+Qe.join("|")+")\\b","i")}function De(Qe,Je){var mt,ut,Ke,nt=[];for(ut=0,Ke=Je.length;ut<Ke;ut++)mt=Qe.getElementsByTagName(Je[ut]),nt=nt.concat(Array.prototype.slice.call(mt));return nt}function Xe(Qe,Je){var st,mt=!0;return(st=Re(Qe,Je.pop()))&&Je.length&&(mt=function(ut,Ke){for(var nt,lt=!0;ut.parentNode&&1===ut.parentNode.nodeType&&Ke.length;)lt&&(nt=Ke.pop()),lt=Re(ut=ut.parentNode,nt);return 0===Ke.length}(Qe,Je)),st&&mt&&0===Je.length}function Re(Qe,Je){var st,mt,ut=Qe.nodeName,Ke=Qe.getAttribute("class"),nt=Qe.getAttribute("id");if(st=new RegExp("^"+ut,"i"),Je=Je.replace(st,""),nt&&Je.length&&(st=new RegExp("#"+nt+"(?![a-zA-Z\\-]+)","i"),Je=Je.replace(st,"")),Ke&&Je.length)for(mt=(Ke=Ke.split(" ")).length;mt--;)st=new RegExp("\\."+Ke[mt]+"(?![a-zA-Z\\-]+)","i"),Je=Je.replace(st,"");return 0===Je.length}function Ae(Qe,Je){var st;if(Qe.getElementById&&(st=Qe.getElementById(Je)),st)return st;var mt,ut,Ke,nt=Qe.getElementsByTagName("*");for(ut=0,Ke=nt.length;ut<Ke;ut++)if(Je===(mt=nt[ut]).getAttribute("id"))return mt}F.svgValidTagNamesRegEx=Pe(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),F.svgViewBoxElementsRegEx=Pe(["symbol","image","marker","pattern","view","svg"]),F.svgInvalidAncestorsRegEx=Pe(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),F.svgValidParentsRegEx=Pe(["symbol","g","a","svg","clipPath","defs"]),F.cssRules={},F.gradientDefs={},F.clipPaths={},F.parseTransformAttribute=function(){function Qe(lt,xt,dt){lt[dt]=Math.tan(F.util.degreesToRadians(xt[0]))}var Je=F.iMatrix,st=F.reNum,mt=F.commaWsp,ut="(?:(?:(matrix)\\s*\\(\\s*("+st+")"+mt+"("+st+")"+mt+"("+st+")"+mt+"("+st+")"+mt+"("+st+")"+mt+"("+st+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+st+")(?:"+mt+"("+st+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+st+")(?:"+mt+"("+st+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+st+")(?:"+mt+"("+st+")"+mt+"("+st+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+st+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+st+")\\s*\\)))",Ke=new RegExp("^\\s*(?:(?:"+ut+"(?:"+mt+"*"+ut+")*)?)\\s*$"),nt=new RegExp(ut,"g");return function(lt){var xt=Je.concat(),dt=[];if(!lt||lt&&!Ke.test(lt))return xt;lt.replace(nt,function(Rt){var $t,on,Nt=new RegExp(ut).exec(Rt).filter(function($t){return!!$t}),Ot=Nt[1],Vt=Nt.slice(2).map(parseFloat);switch(Ot){case"translate":($t=xt)[4]=(on=Vt)[0],2===on.length&&($t[5]=on[1]);break;case"rotate":Vt[0]=F.util.degreesToRadians(Vt[0]),function($t,on){var dn=F.util.cos(on[0]),sn=F.util.sin(on[0]),bn=0,ct=0;3===on.length&&(bn=on[1],ct=on[2]),$t[0]=dn,$t[1]=sn,$t[2]=-sn,$t[3]=dn,$t[4]=bn-(dn*bn-sn*ct),$t[5]=ct-(sn*bn+dn*ct)}(xt,Vt);break;case"scale":!function($t,on){var sn=2===on.length?on[1]:on[0];$t[0]=on[0],$t[3]=sn}(xt,Vt);break;case"skewX":Qe(xt,Vt,2);break;case"skewY":Qe(xt,Vt,1);break;case"matrix":xt=Vt}dt.push(xt.concat()),xt=Je.concat()});for(var Dt=dt[0];dt.length>1;)dt.shift(),Dt=F.util.multiplyTransformMatrices(Dt,dt[0]);return Dt}}();var de=new RegExp("^\\s*("+F.reNum+"+)\\s*,?\\s*("+F.reNum+"+)\\s*,?\\s*("+F.reNum+"+)\\s*,?\\s*("+F.reNum+"+)\\s*$");function tt(Qe){if(!F.svgViewBoxElementsRegEx.test(Qe.nodeName))return{};var Je,st,mt,ut,Ke,nt,lt=Qe.getAttribute("viewBox"),xt=1,dt=1,Dt=Qe.getAttribute("width"),Rt=Qe.getAttribute("height"),Nt=Qe.getAttribute("x")||0,Ot=Qe.getAttribute("y")||0,Vt=Qe.getAttribute("preserveAspectRatio")||"",$t=!lt||!(lt=lt.match(de)),on=!Dt||!Rt||"100%"===Dt||"100%"===Rt,dn=$t&&on,sn={},bn="",ct=0,ht=0;if(sn.width=0,sn.height=0,sn.toBeParsed=dn,$t&&(Nt||Ot)&&Qe.parentNode&&"#document"!==Qe.parentNode.nodeName&&(bn=" translate("+L(Nt)+" "+L(Ot)+") ",Ke=(Qe.getAttribute("transform")||"")+bn,Qe.setAttribute("transform",Ke),Qe.removeAttribute("x"),Qe.removeAttribute("y")),dn)return sn;if($t)return sn.width=L(Dt),sn.height=L(Rt),sn;if(Je=-parseFloat(lt[1]),st=-parseFloat(lt[2]),mt=parseFloat(lt[3]),ut=parseFloat(lt[4]),sn.minX=Je,sn.minY=st,sn.viewBoxWidth=mt,sn.viewBoxHeight=ut,on?(sn.width=mt,sn.height=ut):(sn.width=L(Dt),sn.height=L(Rt),xt=sn.width/mt,dt=sn.height/ut),"none"!==(Vt=F.util.parsePreserveAspectRatioAttribute(Vt)).alignX&&("meet"===Vt.meetOrSlice&&(dt=xt=xt>dt?dt:xt),"slice"===Vt.meetOrSlice&&(dt=xt=xt>dt?xt:dt),ct=sn.width-mt*xt,ht=sn.height-ut*xt,"Mid"===Vt.alignX&&(ct/=2),"Mid"===Vt.alignY&&(ht/=2),"Min"===Vt.alignX&&(ct=0),"Min"===Vt.alignY&&(ht=0)),1===xt&&1===dt&&0===Je&&0===st&&0===Nt&&0===Ot)return sn;if((Nt||Ot)&&"#document"!==Qe.parentNode.nodeName&&(bn=" translate("+L(Nt)+" "+L(Ot)+") "),Ke=bn+" matrix("+xt+" 0 0 "+dt+" "+(Je*xt+ct)+" "+(st*dt+ht)+") ","svg"===Qe.nodeName){for(nt=Qe.ownerDocument.createElementNS(F.svgNS,"g");Qe.firstChild;)nt.appendChild(Qe.firstChild);Qe.appendChild(nt)}else(nt=Qe).removeAttribute("x"),nt.removeAttribute("y"),Ke=nt.getAttribute("transform")+Ke;return nt.setAttribute("transform",Ke),sn}function Ze(Qe,Je){var st="xlink:href",mt=Ae(Qe,Je.getAttribute(st).slice(1));if(mt&&mt.getAttribute(st)&&Ze(Qe,mt),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(Ke){mt&&!Je.hasAttribute(Ke)&&mt.hasAttribute(Ke)&&Je.setAttribute(Ke,mt.getAttribute(Ke))}),!Je.children.length)for(var ut=mt.cloneNode(!0);ut.firstChild;)Je.appendChild(ut.firstChild);Je.removeAttribute(st)}F.parseSVGDocument=function(Qe,Je,st,mt){if(Qe){!function(Nt){for(var Ot=De(Nt,["use","svg:use"]),Vt=0;Ot.length&&Vt<Ot.length;){var $t=Ot[Vt],on=$t.getAttribute("xlink:href")||$t.getAttribute("href");if(null===on)return;var dn,sn,bn,ct,ht=on.slice(1),Ft=$t.getAttribute("x")||0,Wt=$t.getAttribute("y")||0,rn=Ae(Nt,ht).cloneNode(!0),Yn=(rn.getAttribute("transform")||"")+" translate("+Ft+", "+Wt+")",ki=Ot.length,Hi=F.svgNS;if(tt(rn),/^svg$/i.test(rn.nodeName)){var Ji=rn.ownerDocument.createElementNS(Hi,"g");for(sn=0,ct=(bn=rn.attributes).length;sn<ct;sn++)dn=bn.item(sn),Ji.setAttributeNS(Hi,dn.nodeName,dn.nodeValue);for(;rn.firstChild;)Ji.appendChild(rn.firstChild);rn=Ji}for(sn=0,ct=(bn=$t.attributes).length;sn<ct;sn++)"x"!==(dn=bn.item(sn)).nodeName&&"y"!==dn.nodeName&&"xlink:href"!==dn.nodeName&&"href"!==dn.nodeName&&("transform"===dn.nodeName?Yn=dn.nodeValue+" "+Yn:rn.setAttribute(dn.nodeName,dn.nodeValue));rn.setAttribute("transform",Yn),rn.setAttribute("instantiated_by_use","1"),rn.removeAttribute("id"),$t.parentNode.replaceChild(rn,$t),Ot.length===ki&&Vt++}}(Qe);var ut,Ke,nt=F.Object.__uid++,lt=tt(Qe),xt=F.util.toArray(Qe.getElementsByTagName("*"));if(lt.crossOrigin=mt&&mt.crossOrigin,lt.svgUid=nt,0===xt.length&&F.isLikelyNode){var dt=[];for(ut=0,Ke=(xt=Qe.selectNodes('//*[name(.)!="svg"]')).length;ut<Ke;ut++)dt[ut]=xt[ut];xt=dt}var Dt=xt.filter(function(Nt){return tt(Nt),F.svgValidTagNamesRegEx.test(Nt.nodeName.replace("svg:",""))&&!function(Ot,Vt){for(;Ot&&(Ot=Ot.parentNode);)if(Ot.nodeName&&Vt.test(Ot.nodeName.replace("svg:",""))&&!Ot.getAttribute("instantiated_by_use"))return!0;return!1}(Nt,F.svgInvalidAncestorsRegEx)});if(!Dt||Dt&&!Dt.length)Je&&Je([],{});else{var Rt={};xt.filter(function(Nt){return"clipPath"===Nt.nodeName.replace("svg:","")}).forEach(function(Nt){var Ot=Nt.getAttribute("id");Rt[Ot]=F.util.toArray(Nt.getElementsByTagName("*")).filter(function(Vt){return F.svgValidTagNamesRegEx.test(Vt.nodeName.replace("svg:",""))})}),F.gradientDefs[nt]=F.getGradientDefs(Qe),F.cssRules[nt]=F.getCSSRules(Qe),F.clipPaths[nt]=Rt,F.parseElements(Dt,function(Nt,Ot){Je&&(Je(Nt,lt,Ot,xt),delete F.gradientDefs[nt],delete F.cssRules[nt],delete F.clipPaths[nt])},$(lt),st,mt)}}};var et=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+F.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+F.reNum+"))?\\s+(.*)");z(F,{parseFontDeclaration:function(Qe,Je){var st=Qe.match(et);if(st){var mt=st[1],ut=st[3],Ke=st[4],nt=st[5],lt=st[6];mt&&(Je.fontStyle=mt),ut&&(Je.fontWeight=isNaN(parseFloat(ut))?ut:parseFloat(ut)),Ke&&(Je.fontSize=L(Ke)),lt&&(Je.fontFamily=lt),nt&&(Je.lineHeight="normal"===nt?1:nt)}},getGradientDefs:function(Qe){var Je,st=De(Qe,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),mt=0,ut={};for(mt=st.length;mt--;)(Je=st[mt]).getAttribute("xlink:href")&&Ze(Qe,Je),ut[Je.getAttribute("id")]=Je;return ut},parseAttributes:function(Qe,Je,st){if(Qe){var mt,ut,Ke,nt={};void 0===st&&(st=Qe.getAttribute("svgUid")),Qe.parentNode&&F.svgValidParentsRegEx.test(Qe.parentNode.nodeName)&&(nt=F.parseAttributes(Qe.parentNode,Je,st));var lt=Je.reduce(function(Vt,$t){return(mt=Qe.getAttribute($t))&&(Vt[$t]=mt),Vt},{}),xt=z(function(Vt,$t){var on={};for(var dn in F.cssRules[$t])if(Xe(Vt,dn.split(" ")))for(var sn in F.cssRules[$t][dn])on[sn]=F.cssRules[$t][dn][sn];return on}(Qe,st),F.parseStyleAttribute(Qe));lt=z(lt,xt),xt[ae]&&Qe.setAttribute(ae,xt[ae]),ut=Ke=nt.fontSize||F.Text.DEFAULT_SVG_FONT_SIZE,lt[te]&&(lt[te]=ut=L(lt[te],Ke));var dt,Dt,Rt={};for(var Nt in lt)Dt=be(dt=fe(Nt),lt[Nt],nt,ut),Rt[dt]=Dt;Rt&&Rt.font&&F.parseFontDeclaration(Rt.font,Rt);var Ot=z(nt,Rt);return F.svgValidParentsRegEx.test(Qe.nodeName)?Ot:function(Vt){for(var $t in Z)if(void 0!==Vt[Z[$t]]&&""!==Vt[$t]){if(void 0===Vt[$t]){if(!F.Object.prototype[$t])continue;Vt[$t]=F.Object.prototype[$t]}if(0!==Vt[$t].indexOf("url(")){var on=new F.Color(Vt[$t]);Vt[$t]=on.setAlpha(P(on.getAlpha()*Vt[Z[$t]],2)).toRgba()}}return Vt}(Ot)}},parseElements:function(Qe,Je,st,mt,ut){new F.ElementsParser(Qe,Je,st,mt,ut).parse()},parseStyleAttribute:function(Qe){var ut,Ke,nt,Je={},st=Qe.getAttribute("style");return st&&("string"==typeof st?(ut=Je,st.replace(/;\s*$/,"").split(";").forEach(function(lt){var xt=lt.split(":");Ke=xt[0].trim().toLowerCase(),nt=xt[1].trim(),ut[Ke]=nt})):function(mt,ut){for(var lt in mt)void 0!==mt[lt]&&(ut[lt.toLowerCase()]=mt[lt])}(st,Je)),Je},parsePointsAttribute:function(Qe){if(!Qe)return null;var Je,st,mt=[];for(Je=0,st=(Qe=(Qe=Qe.replace(/,/g," ").trim()).split(/\s+/)).length;Je<st;Je+=2)mt.push({x:parseFloat(Qe[Je]),y:parseFloat(Qe[Je+1])});return mt},getCSSRules:function(Qe){var Je,st,mt=Qe.getElementsByTagName("style"),ut={};for(Je=0,st=mt.length;Je<st;Je++){var Ke=mt[Je].textContent;""!==(Ke=Ke.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&Ke.split("}").filter(function(nt){return nt.trim()}).forEach(function(nt){var lt=nt.split("{"),xt={},dt=lt[1].trim().split(";").filter(function(Ot){return Ot.trim()});for(Je=0,st=dt.length;Je<st;Je++){var Dt=dt[Je].split(":"),Rt=Dt[0].trim(),Nt=Dt[1].trim();xt[Rt]=Nt}(nt=lt[0].trim()).split(",").forEach(function(Ot){""!==(Ot=Ot.replace(/^svg/i,"").trim())&&(ut[Ot]?F.util.object.extend(ut[Ot],xt):ut[Ot]=F.util.object.clone(xt))})})}return ut},loadSVGFromURL:function(Qe,Je,st,mt){Qe=Qe.replace(/^\n\s*/,"").trim(),new F.util.request(Qe,{method:"get",onComplete:function(ut){var Ke=ut.responseXML;if(!Ke||!Ke.documentElement)return Je&&Je(null),!1;F.parseSVGDocument(Ke.documentElement,function(nt,lt,xt,dt){Je&&Je(nt,lt,xt,dt)},st,mt)}})},loadSVGFromString:function(Qe,Je,st,mt){var ut=(new F.window.DOMParser).parseFromString(Qe.trim(),"text/xml");F.parseSVGDocument(ut.documentElement,function(Ke,nt,lt,xt){Je(Ke,nt,lt,xt)},st,mt)}})}(l),ee.ElementsParser=function(V,F,z,$,P,L){this.elements=V,this.callback=F,this.options=z,this.reviver=$,this.svgUid=z&&z.svgUid||0,this.parsingOptions=P,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=L},(K=ee.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},K.createObjects=function(){var V=this;this.elements.forEach(function(F,z){F.setAttribute("svgUid",V.svgUid),V.createObject(F,z)})},K.findTag=function(V){return ee[ee.util.string.capitalize(V.tagName.replace("svg:",""))]},K.createObject=function(V,F){var z=this.findTag(V);if(z&&z.fromElement)try{z.fromElement(V,this.createCallback(F,V),this.options)}catch($){ee.log($)}else this.checkIfDone()},K.createCallback=function(V,F){var z=this;return function($){var P;z.resolveGradient($,F,"fill"),z.resolveGradient($,F,"stroke"),$ instanceof ee.Image&&$._originalElement&&(P=$.parsePreserveAspectRatioAttribute(F)),$._removeTransformMatrix(P),z.resolveClipPath($,F),z.reviver&&z.reviver(F,$),z.instances[V]=$,z.checkIfDone()}},K.extractPropertyDefinition=function(V,F,z){var $=V[F],P=this.regexUrl;if(P.test($)){P.lastIndex=0;var L=P.exec($)[1];return P.lastIndex=0,ee[z][this.svgUid][L]}},K.resolveGradient=function(V,F,z){var $=this.extractPropertyDefinition(V,z,"gradientDefs");if($){var P=F.getAttribute(z+"-opacity"),L=ee.Gradient.fromElement($,V,P,this.options);V.set(z,L)}},K.createClipPathCallback=function(V,F){return function(z){z._removeTransformMatrix(),z.fillRule=z.clipRule,F.push(z)}},K.resolveClipPath=function(V,F){var z,$,P,L,X=this.extractPropertyDefinition(V,"clipPath","clipPaths");if(X){P=[],$=ee.util.invertTransform(V.calcTransformMatrix());for(var ne=X[0].parentNode,Z=F;Z.parentNode&&Z.getAttribute("clip-path")!==V.clipPath;)Z=Z.parentNode;Z.parentNode.appendChild(ne);for(var te=0;te<X.length;te++)this.findTag(z=X[te]).fromElement(z,this.createClipPathCallback(V,P),this.options);X=1===P.length?P[0]:new ee.Group(P),L=ee.util.multiplyTransformMatrices($,X.calcTransformMatrix()),X.clipPath&&this.resolveClipPath(X,Z);var ae=ee.util.qrDecompose(L);X.flipX=!1,X.flipY=!1,X.set("scaleX",ae.scaleX),X.set("scaleY",ae.scaleY),X.angle=ae.angle,X.skewX=ae.skewX,X.skewY=0,X.setPositionByOrigin({x:ae.translateX,y:ae.translateY},"center","center"),V.clipPath=X}else delete V.clipPath},K.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(V){return null!=V}),this.callback(this.instances,this.elements))},function(V){var F=V.fabric||(V.fabric={});function z($,P){this.x=$,this.y=P}F.Point?F.warn("fabric.Point is already defined"):(F.Point=z,z.prototype={type:"point",constructor:z,add:function($){return new z(this.x+$.x,this.y+$.y)},addEquals:function($){return this.x+=$.x,this.y+=$.y,this},scalarAdd:function($){return new z(this.x+$,this.y+$)},scalarAddEquals:function($){return this.x+=$,this.y+=$,this},subtract:function($){return new z(this.x-$.x,this.y-$.y)},subtractEquals:function($){return this.x-=$.x,this.y-=$.y,this},scalarSubtract:function($){return new z(this.x-$,this.y-$)},scalarSubtractEquals:function($){return this.x-=$,this.y-=$,this},multiply:function($){return new z(this.x*$,this.y*$)},multiplyEquals:function($){return this.x*=$,this.y*=$,this},divide:function($){return new z(this.x/$,this.y/$)},divideEquals:function($){return this.x/=$,this.y/=$,this},eq:function($){return this.x===$.x&&this.y===$.y},lt:function($){return this.x<$.x&&this.y<$.y},lte:function($){return this.x<=$.x&&this.y<=$.y},gt:function($){return this.x>$.x&&this.y>$.y},gte:function($){return this.x>=$.x&&this.y>=$.y},lerp:function($,P){return void 0===P&&(P=.5),P=Math.max(Math.min(1,P),0),new z(this.x+($.x-this.x)*P,this.y+($.y-this.y)*P)},distanceFrom:function($){var P=this.x-$.x,L=this.y-$.y;return Math.sqrt(P*P+L*L)},midPointFrom:function($){return this.lerp($)},min:function($){return new z(Math.min(this.x,$.x),Math.min(this.y,$.y))},max:function($){return new z(Math.max(this.x,$.x),Math.max(this.y,$.y))},toString:function(){return this.x+","+this.y},setXY:function($,P){return this.x=$,this.y=P,this},setX:function($){return this.x=$,this},setY:function($){return this.y=$,this},setFromPoint:function($){return this.x=$.x,this.y=$.y,this},swap:function($){var P=this.x,L=this.y;this.x=$.x,this.y=$.y,$.x=P,$.y=L},clone:function(){return new z(this.x,this.y)}})}(l),function(V){var F=V.fabric||(V.fabric={});function z($){this.status=$,this.points=[]}F.Intersection?F.warn("fabric.Intersection is already defined"):(F.Intersection=z,F.Intersection.prototype={constructor:z,appendPoint:function($){return this.points.push($),this},appendPoints:function($){return this.points=this.points.concat($),this}},F.Intersection.intersectLineLine=function($,P,L,X){var ne,Z=(X.x-L.x)*($.y-L.y)-(X.y-L.y)*($.x-L.x),te=(P.x-$.x)*($.y-L.y)-(P.y-$.y)*($.x-L.x),ae=(X.y-L.y)*(P.x-$.x)-(X.x-L.x)*(P.y-$.y);if(0!==ae){var fe=Z/ae,be=te/ae;0<=fe&&fe<=1&&0<=be&&be<=1?(ne=new z("Intersection")).appendPoint(new F.Point($.x+fe*(P.x-$.x),$.y+fe*(P.y-$.y))):ne=new z}else ne=new z(0===Z||0===te?"Coincident":"Parallel");return ne},F.Intersection.intersectLinePolygon=function($,P,L){var Z,te,ae=new z,fe=L.length;for(te=0;te<fe;te++)Z=z.intersectLineLine($,P,L[te],L[(te+1)%fe]),ae.appendPoints(Z.points);return ae.points.length>0&&(ae.status="Intersection"),ae},F.Intersection.intersectPolygonPolygon=function($,P){var L,X=new z,ne=$.length;for(L=0;L<ne;L++){var ae=z.intersectLinePolygon($[L],$[(L+1)%ne],P);X.appendPoints(ae.points)}return X.points.length>0&&(X.status="Intersection"),X},F.Intersection.intersectPolygonRectangle=function($,P,L){var X=P.min(L),ne=P.max(L),Z=new F.Point(ne.x,X.y),te=new F.Point(X.x,ne.y),ae=z.intersectLinePolygon(X,Z,$),fe=z.intersectLinePolygon(Z,ne,$),be=z.intersectLinePolygon(ne,te,$),Pe=z.intersectLinePolygon(te,X,$),De=new z;return De.appendPoints(ae.points),De.appendPoints(fe.points),De.appendPoints(be.points),De.appendPoints(Pe.points),De.points.length>0&&(De.status="Intersection"),De})}(l),function(V){var F=V.fabric||(V.fabric={});function z(P){P?this._tryParsingColor(P):this.setSource([0,0,0,1])}function $(P,L,X){return X<0&&(X+=1),X>1&&(X-=1),X<1/6?P+6*(L-P)*X:X<.5?L:X<2/3?P+(L-P)*(2/3-X)*6:P}F.Color?F.warn("fabric.Color is already defined."):(F.Color=z,F.Color.prototype={_tryParsingColor:function(P){var L;P in z.colorNameMap&&(P=z.colorNameMap[P]),"transparent"===P&&(L=[255,255,255,0]),L||(L=z.sourceFromHex(P)),L||(L=z.sourceFromRgb(P)),L||(L=z.sourceFromHsl(P)),L||(L=[0,0,0,1]),L&&this.setSource(L)},_rgbToHsl:function(P,L,X){var ne,Z,te,ae=F.util.array.max([P/=255,L/=255,X/=255]),fe=F.util.array.min([P,L,X]);if(te=(ae+fe)/2,ae===fe)ne=Z=0;else{var be=ae-fe;switch(Z=te>.5?be/(2-ae-fe):be/(ae+fe),ae){case P:ne=(L-X)/be+(L<X?6:0);break;case L:ne=(X-P)/be+2;break;case X:ne=(P-L)/be+4}ne/=6}return[Math.round(360*ne),Math.round(100*Z),Math.round(100*te)]},getSource:function(){return this._source},setSource:function(P){this._source=P},toRgb:function(){var P=this.getSource();return"rgb("+P[0]+","+P[1]+","+P[2]+")"},toRgba:function(){var P=this.getSource();return"rgba("+P[0]+","+P[1]+","+P[2]+","+P[3]+")"},toHsl:function(){var P=this.getSource(),L=this._rgbToHsl(P[0],P[1],P[2]);return"hsl("+L[0]+","+L[1]+"%,"+L[2]+"%)"},toHsla:function(){var P=this.getSource(),L=this._rgbToHsl(P[0],P[1],P[2]);return"hsla("+L[0]+","+L[1]+"%,"+L[2]+"%,"+P[3]+")"},toHex:function(){var P,L,X,ne=this.getSource();return P=1===(P=ne[0].toString(16)).length?"0"+P:P,L=1===(L=ne[1].toString(16)).length?"0"+L:L,X=1===(X=ne[2].toString(16)).length?"0"+X:X,P.toUpperCase()+L.toUpperCase()+X.toUpperCase()},toHexa:function(){var P,L=this.getSource();return P=1===(P=(P=Math.round(255*L[3])).toString(16)).length?"0"+P:P,this.toHex()+P.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(P){var L=this.getSource();return L[3]=P,this.setSource(L),this},toGrayscale:function(){var P=this.getSource(),L=parseInt((.3*P[0]+.59*P[1]+.11*P[2]).toFixed(0),10);return this.setSource([L,L,L,P[3]]),this},toBlackWhite:function(P){var L=this.getSource(),X=(.3*L[0]+.59*L[1]+.11*L[2]).toFixed(0),ne=L[3];return P=P||127,X=Number(X)<Number(P)?0:255,this.setSource([X,X,X,ne]),this},overlayWith:function(P){P instanceof z||(P=new z(P));var L,X=[],ne=this.getAlpha(),Z=this.getSource(),te=P.getSource();for(L=0;L<3;L++)X.push(Math.round(.5*Z[L]+.5*te[L]));return X[3]=ne,this.setSource(X),this}},F.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,F.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,F.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,F.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},F.Color.fromRgb=function(P){return z.fromSource(z.sourceFromRgb(P))},F.Color.sourceFromRgb=function(P){var L=P.match(z.reRGBa);if(L){var X=parseInt(L[1],10)/(/%$/.test(L[1])?100:1)*(/%$/.test(L[1])?255:1),ne=parseInt(L[2],10)/(/%$/.test(L[2])?100:1)*(/%$/.test(L[2])?255:1),Z=parseInt(L[3],10)/(/%$/.test(L[3])?100:1)*(/%$/.test(L[3])?255:1);return[parseInt(X,10),parseInt(ne,10),parseInt(Z,10),L[4]?parseFloat(L[4]):1]}},F.Color.fromRgba=z.fromRgb,F.Color.fromHsl=function(P){return z.fromSource(z.sourceFromHsl(P))},F.Color.sourceFromHsl=function(P){var L=P.match(z.reHSLa);if(L){var X,ne,Z,te=(parseFloat(L[1])%360+360)%360/360,ae=parseFloat(L[2])/(/%$/.test(L[2])?100:1),fe=parseFloat(L[3])/(/%$/.test(L[3])?100:1);if(0===ae)X=ne=Z=fe;else{var be=fe<=.5?fe*(ae+1):fe+ae-fe*ae,Pe=2*fe-be;X=$(Pe,be,te+1/3),ne=$(Pe,be,te),Z=$(Pe,be,te-1/3)}return[Math.round(255*X),Math.round(255*ne),Math.round(255*Z),L[4]?parseFloat(L[4]):1]}},F.Color.fromHsla=z.fromHsl,F.Color.fromHex=function(P){return z.fromSource(z.sourceFromHex(P))},F.Color.sourceFromHex=function(P){if(P.match(z.reHex)){var L=P.slice(P.indexOf("#")+1),X=3===L.length||4===L.length,ne=8===L.length||4===L.length,Z=X?L.charAt(0)+L.charAt(0):L.substring(0,2),te=X?L.charAt(1)+L.charAt(1):L.substring(2,4),ae=X?L.charAt(2)+L.charAt(2):L.substring(4,6),fe=ne?X?L.charAt(3)+L.charAt(3):L.substring(6,8):"FF";return[parseInt(Z,16),parseInt(te,16),parseInt(ae,16),parseFloat((parseInt(fe,16)/255).toFixed(2))]}},F.Color.fromSource=function(P){var L=new z;return L.setSource(P),L})}(l),function(V){var F=V.fabric||(V.fabric={}),z=["e","se","s","sw","w","nw","n","ne","e"],$=["ns","nesw","ew","nwse"],P={},L="left",X="top",ne="right",Z="bottom",te="center",ae={top:Z,bottom:X,left:ne,right:L,center:te},fe=F.util.radiansToDegrees,be=Math.sign||function(Ke){return(Ke>0)-(Ke<0)||+Ke};function Pe(Ke,nt){var lt=Ke.angle+fe(Math.atan2(nt.y,nt.x))+360;return Math.round(lt%360/45)}function De(Ke,nt){var lt=nt.transform.target,xt=lt.canvas,dt=F.util.object.clone(nt);dt.target=lt,xt&&xt.fire("object:"+Ke,dt),lt.fire(Ke,nt)}function Xe(Ke,nt){var lt=nt.canvas,xt=Ke[lt.uniScaleKey];return lt.uniformScaling&&!xt||!lt.uniformScaling&&xt}function Re(Ke){return Ke.originX===te&&Ke.originY===te}function Ae(Ke,nt,lt){var xt=Ke.lockScalingX,dt=Ke.lockScalingY;return!((!xt||!dt)&&(nt||!xt&&!dt||!lt)&&(!xt||"x"!==nt)&&(!dt||"y"!==nt))}function de(Ke,nt,lt,xt){return{e:Ke,transform:nt,pointer:{x:lt,y:xt}}}function tt(Ke){return function(nt,lt,xt,dt){var Dt=lt.target,Rt=Dt.getCenterPoint(),Nt=Dt.translateToOriginPoint(Rt,lt.originX,lt.originY),Ot=Ke(nt,lt,xt,dt);return Dt.setPositionByOrigin(Nt,lt.originX,lt.originY),Ot}}function Ze(Ke,nt){return function(lt,xt,dt,Dt){var Rt=nt(lt,xt,dt,Dt);return Rt&&De(Ke,de(lt,xt,dt,Dt)),Rt}}function et(Ke,nt,lt,xt,dt){var Dt=Ke.target,Rt=Dt.controls[Ke.corner],Nt=Dt.canvas.getZoom(),Ot=Dt.padding/Nt,Vt=Dt.toLocalPoint(new F.Point(xt,dt),nt,lt);return Vt.x>=Ot&&(Vt.x-=Ot),Vt.x<=-Ot&&(Vt.x+=Ot),Vt.y>=Ot&&(Vt.y-=Ot),Vt.y<=Ot&&(Vt.y+=Ot),Vt.x-=Rt.offsetX,Vt.y-=Rt.offsetY,Vt}function Qe(Ke){return Ke.flipX!==Ke.flipY}function Je(Ke,nt,lt,xt,dt){if(0!==Ke[nt]){var Dt=dt/Ke._getTransformedDimensions()[xt]*Ke[lt];Ke.set(lt,Dt)}}function st(Ke,nt,lt,xt){var dt,Dt=nt.target,Rt=Dt._getTransformedDimensions(0,Dt.skewY),Nt=et(nt,nt.originX,nt.originY,lt,xt),Ot=Math.abs(2*Nt.x)-Rt.x,Vt=Dt.skewX;Ot<2?dt=0:(dt=fe(Math.atan2(Ot/Dt.scaleX,Rt.y/Dt.scaleY)),nt.originX===L&&nt.originY===Z&&(dt=-dt),nt.originX===ne&&nt.originY===X&&(dt=-dt),Qe(Dt)&&(dt=-dt));var $t=Vt!==dt;if($t){var on=Dt._getTransformedDimensions().y;Dt.set("skewX",dt),Je(Dt,"skewY","scaleY","y",on)}return $t}function mt(Ke,nt,lt,xt){var dt,Dt=nt.target,Rt=Dt._getTransformedDimensions(Dt.skewX,0),Nt=et(nt,nt.originX,nt.originY,lt,xt),Ot=Math.abs(2*Nt.y)-Rt.y,Vt=Dt.skewY;Ot<2?dt=0:(dt=fe(Math.atan2(Ot/Dt.scaleY,Rt.x/Dt.scaleX)),nt.originX===L&&nt.originY===Z&&(dt=-dt),nt.originX===ne&&nt.originY===X&&(dt=-dt),Qe(Dt)&&(dt=-dt));var $t=Vt!==dt;if($t){var on=Dt._getTransformedDimensions().x;Dt.set("skewY",dt),Je(Dt,"skewX","scaleX","x",on)}return $t}function ut(Ke,nt,lt,xt,dt){var Dt,Rt,Nt,Ot,Vt,$t,on=nt.target,dn=on.lockScalingX,sn=on.lockScalingY,bn=(dt=dt||{}).by,ct=Xe(Ke,on),ht=Ae(on,bn,ct),Ft=nt.gestureScale;if(ht)return!1;if(Ft)Rt=nt.scaleX*Ft,Nt=nt.scaleY*Ft;else{if(Dt=et(nt,nt.originX,nt.originY,lt,xt),Vt="y"!==bn?be(Dt.x):1,$t="x"!==bn?be(Dt.y):1,nt.signX||(nt.signX=Vt),nt.signY||(nt.signY=$t),on.lockScalingFlip&&(nt.signX!==Vt||nt.signY!==$t))return!1;if(Ot=on._getTransformedDimensions(),ct&&!bn){var Wt=Math.abs(Dt.x)+Math.abs(Dt.y),rn=nt.original,Yn=Wt/(Math.abs(Ot.x*rn.scaleX/on.scaleX)+Math.abs(Ot.y*rn.scaleY/on.scaleY));Rt=rn.scaleX*Yn,Nt=rn.scaleY*Yn}else Rt=Math.abs(Dt.x*on.scaleX/Ot.x),Nt=Math.abs(Dt.y*on.scaleY/Ot.y);Re(nt)&&(Rt*=2,Nt*=2),nt.signX!==Vt&&"y"!==bn&&(nt.originX=ae[nt.originX],Rt*=-1,nt.signX=Vt),nt.signY!==$t&&"x"!==bn&&(nt.originY=ae[nt.originY],Nt*=-1,nt.signY=$t)}var ki=on.scaleX,Hi=on.scaleY;return bn?("x"===bn&&on.set("scaleX",Rt),"y"===bn&&on.set("scaleY",Nt)):(!dn&&on.set("scaleX",Rt),!sn&&on.set("scaleY",Nt)),ki!==on.scaleX||Hi!==on.scaleY}P.scaleCursorStyleHandler=function(Ke,nt,lt){var xt=Xe(Ke,lt),dt="";if(0!==nt.x&&0===nt.y?dt="x":0===nt.x&&0!==nt.y&&(dt="y"),Ae(lt,dt,xt))return"not-allowed";var Dt=Pe(lt,nt);return z[Dt]+"-resize"},P.skewCursorStyleHandler=function(Ke,nt,lt){if(0!==nt.x&&lt.lockSkewingY||0!==nt.y&&lt.lockSkewingX)return"not-allowed";var dt=Pe(lt,nt)%4;return $[dt]+"-resize"},P.scaleSkewCursorStyleHandler=function(Ke,nt,lt){return Ke[lt.canvas.altActionKey]?P.skewCursorStyleHandler(Ke,nt,lt):P.scaleCursorStyleHandler(Ke,nt,lt)},P.rotationWithSnapping=Ze("rotating",tt(function(Ke,nt,lt,xt){var dt=nt,Dt=dt.target,Rt=Dt.translateToOriginPoint(Dt.getCenterPoint(),dt.originX,dt.originY);if(Dt.lockRotation)return!1;var Nt,Ot=Math.atan2(dt.ey-Rt.y,dt.ex-Rt.x),Vt=Math.atan2(xt-Rt.y,lt-Rt.x),$t=fe(Vt-Ot+dt.theta);if(Dt.snapAngle>0){var on=Dt.snapAngle,dn=Dt.snapThreshold||on,sn=Math.ceil($t/on)*on,bn=Math.floor($t/on)*on;Math.abs($t-bn)<dn?$t=bn:Math.abs($t-sn)<dn&&($t=sn)}return $t<0&&($t=360+$t),Nt=Dt.angle!==($t%=360),Dt.angle=$t,Nt})),P.scalingEqually=Ze("scaling",tt(function(Ke,nt,lt,xt){return ut(Ke,nt,lt,xt)})),P.scalingX=Ze("scaling",tt(function(Ke,nt,lt,xt){return ut(Ke,nt,lt,xt,{by:"x"})})),P.scalingY=Ze("scaling",tt(function(Ke,nt,lt,xt){return ut(Ke,nt,lt,xt,{by:"y"})})),P.scalingYOrSkewingX=function(Ke,nt,lt,xt){return Ke[nt.target.canvas.altActionKey]?P.skewHandlerX(Ke,nt,lt,xt):P.scalingY(Ke,nt,lt,xt)},P.scalingXOrSkewingY=function(Ke,nt,lt,xt){return Ke[nt.target.canvas.altActionKey]?P.skewHandlerY(Ke,nt,lt,xt):P.scalingX(Ke,nt,lt,xt)},P.changeWidth=Ze("resizing",tt(function(Ke,nt,lt,xt){var dt=nt.target,Dt=et(nt,nt.originX,nt.originY,lt,xt),Rt=dt.strokeWidth/(dt.strokeUniform?dt.scaleX:1),Nt=Re(nt)?2:1,Ot=dt.width,Vt=Math.abs(Dt.x*Nt/dt.scaleX)-Rt;return dt.set("width",Math.max(Vt,0)),Ot!==Vt})),P.skewHandlerX=function(Ke,nt,lt,xt){var dt,Dt=nt.target,Rt=Dt.skewX,Nt=nt.originY;return!Dt.lockSkewingX&&(0===Rt?dt=et(nt,te,te,lt,xt).x>0?L:ne:(Rt>0&&(dt=Nt===X?L:ne),Rt<0&&(dt=Nt===X?ne:L),Qe(Dt)&&(dt=dt===L?ne:L)),nt.originX=dt,Ze("skewing",tt(st))(Ke,nt,lt,xt))},P.skewHandlerY=function(Ke,nt,lt,xt){var dt,Dt=nt.target,Rt=Dt.skewY,Nt=nt.originX;return!Dt.lockSkewingY&&(0===Rt?dt=et(nt,te,te,lt,xt).y>0?X:Z:(Rt>0&&(dt=Nt===L?X:Z),Rt<0&&(dt=Nt===L?Z:X),Qe(Dt)&&(dt=dt===X?Z:X)),nt.originY=dt,Ze("skewing",tt(mt))(Ke,nt,lt,xt))},P.dragHandler=function(Ke,nt,lt,xt){var dt=nt.target,Dt=lt-nt.offsetX,Rt=xt-nt.offsetY,Nt=!dt.get("lockMovementX")&&dt.left!==Dt,Ot=!dt.get("lockMovementY")&&dt.top!==Rt;return Nt&&dt.set("left",Dt),Ot&&dt.set("top",Rt),(Nt||Ot)&&De("moving",de(Ke,nt,lt,xt)),Nt||Ot},P.scaleOrSkewActionName=function(Ke,nt,lt){var xt=Ke[lt.canvas.altActionKey];return 0===nt.x?xt?"skewX":"scaleY":0===nt.y?xt?"skewY":"scaleX":void 0},P.rotationStyleHandler=function(Ke,nt,lt){return lt.lockRotation?"not-allowed":nt.cursorStyle},P.fireEvent=De,P.wrapWithFixedAnchor=tt,P.wrapWithFireEvent=Ze,P.getLocalPoint=et,F.controlsUtils=P}(l),F=(V=l).fabric||(V.fabric={}),z=F.util.degreesToRadians,($=F.controlsUtils).renderCircleControl=function(P,L,X,ne,Z){ne=ne||{};var te,ae=this.sizeX||ne.cornerSize||Z.cornerSize,fe=this.sizeY||ne.cornerSize||Z.cornerSize,be=void 0!==ne.transparentCorners?ne.transparentCorners:Z.transparentCorners,Pe=be?"stroke":"fill",De=!be&&(ne.cornerStrokeColor||Z.cornerStrokeColor),Xe=L,Re=X;P.save(),P.fillStyle=ne.cornerColor||Z.cornerColor,P.strokeStyle=ne.cornerStrokeColor||Z.cornerStrokeColor,ae>fe?(te=ae,P.scale(1,fe/ae),Re=X*ae/fe):fe>ae?(te=fe,P.scale(ae/fe,1),Xe=L*fe/ae):te=ae,P.lineWidth=1,P.beginPath(),P.arc(Xe,Re,te/2,0,2*Math.PI,!1),P[Pe](),De&&P.stroke(),P.restore()},$.renderSquareControl=function(P,L,X,ne,Z){ne=ne||{};var te=this.sizeX||ne.cornerSize||Z.cornerSize,ae=this.sizeY||ne.cornerSize||Z.cornerSize,fe=void 0!==ne.transparentCorners?ne.transparentCorners:Z.transparentCorners,be=fe?"stroke":"fill",Pe=!fe&&(ne.cornerStrokeColor||Z.cornerStrokeColor),De=te/2,Xe=ae/2;P.save(),P.fillStyle=ne.cornerColor||Z.cornerColor,P.strokeStyle=ne.cornerStrokeColor||Z.cornerStrokeColor,P.lineWidth=1,P.translate(L,X),P.rotate(z(Z.angle)),P[be+"Rect"](-De,-Xe,te,ae),Pe&&P.strokeRect(-De,-Xe,te,ae),P.restore()},function(V){var F=V.fabric||(V.fabric={});F.Control=function(z){for(var $ in z)this[$]=z[$]},F.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(z,$){return $.cursorStyle},getActionName:function(z,$){return $.actionName},getVisibility:function(z,$){var P=z._controlsVisibility;return P&&void 0!==P[$]?P[$]:this.visible},setVisibility:function(z){this.visible=z},positionHandler:function(z,$){return F.util.transformPoint({x:this.x*z.x+this.offsetX,y:this.y*z.y+this.offsetY},$)},calcCornerCoords:function(z,$,P,L,X){var ne,Z,te,ae,fe=X?this.touchSizeX:this.sizeX,be=X?this.touchSizeY:this.sizeY;if(fe&&be&&fe!==be){var Pe=Math.atan2(be,fe),De=Math.sqrt(fe*fe+be*be)/2,Xe=Pe-F.util.degreesToRadians(z),Re=Math.PI/2-Pe-F.util.degreesToRadians(z);ne=De*F.util.cos(Xe),Z=De*F.util.sin(Xe),te=De*F.util.cos(Re),ae=De*F.util.sin(Re)}else De=.7071067812*(fe&&be?fe:$),Xe=F.util.degreesToRadians(45-z),ne=te=De*F.util.cos(Xe),Z=ae=De*F.util.sin(Xe);return{tl:{x:P-ae,y:L-te},tr:{x:P+ne,y:L-Z},bl:{x:P-ne,y:L+Z},br:{x:P+ae,y:L+te}}},render:function(z,$,P,L,X){"circle"===((L=L||{}).cornerStyle||X.cornerStyle)?F.controlsUtils.renderCircleControl.call(this,z,$,P,L,X):F.controlsUtils.renderSquareControl.call(this,z,$,P,L,X)}}}(l),function(){function V(z,$){var P,L,X,ne,Z=z.getAttribute("style"),te=z.getAttribute("offset")||0;if(te=(te=parseFloat(te)/(/%$/.test(te)?100:1))<0?0:te>1?1:te,Z){var ae=Z.split(/\s*;\s*/);for(""===ae[ae.length-1]&&ae.pop(),ne=ae.length;ne--;){var fe=ae[ne].split(/\s*:\s*/),be=fe[0].trim(),Pe=fe[1].trim();"stop-color"===be?P=Pe:"stop-opacity"===be&&(X=Pe)}}return P||(P=z.getAttribute("stop-color")||"rgb(0,0,0)"),X||(X=z.getAttribute("stop-opacity")),L=(P=new ee.Color(P)).getAlpha(),X=isNaN(parseFloat(X))?1:parseFloat(X),X*=L*$,{offset:te,color:P.toRgb(),opacity:X}}var F=ee.util.object.clone;ee.Gradient=ee.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(z){z||(z={}),z.coords||(z.coords={});var $,P=this;Object.keys(z).forEach(function(L){P[L]=z[L]}),this.id?this.id+="_"+ee.Object.__uid++:this.id=ee.Object.__uid++,$={x1:z.coords.x1||0,y1:z.coords.y1||0,x2:z.coords.x2||0,y2:z.coords.y2||0},"radial"===this.type&&($.r1=z.coords.r1||0,$.r2=z.coords.r2||0),this.coords=$,this.colorStops=z.colorStops.slice()},addColorStop:function(z){for(var $ in z){var P=new ee.Color(z[$]);this.colorStops.push({offset:parseFloat($),color:P.toRgb(),opacity:P.getAlpha()})}return this},toObject:function(z){var $={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return ee.util.populateWithProperties(this,$,z),$},toSVG:function(z,$){var P,L,X,ne,Z=F(this.coords,!0),te=($=$||{},F(this.colorStops,!0)),ae=Z.r1>Z.r2,fe=this.gradientTransform?this.gradientTransform.concat():ee.iMatrix.concat(),be=-this.offsetX,Pe=-this.offsetY,De=!!$.additionalTransform,Xe="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(te.sort(function(tt,Ze){return tt.offset-Ze.offset}),"objectBoundingBox"===Xe?(be/=z.width,Pe/=z.height):(be+=z.width/2,Pe+=z.height/2),"path"===z.type&&"percentage"!==this.gradientUnits&&(be-=z.pathOffset.x,Pe-=z.pathOffset.y),fe[4]-=be,fe[5]-=Pe,ne='id="SVGID_'+this.id+'" gradientUnits="'+Xe+'"',ne+=' gradientTransform="'+(De?$.additionalTransform+" ":"")+ee.util.matrixToSVG(fe)+'" ',"linear"===this.type?X=["<linearGradient ",ne,' x1="',Z.x1,'" y1="',Z.y1,'" x2="',Z.x2,'" y2="',Z.y2,'">\n']:"radial"===this.type&&(X=["<radialGradient ",ne,' cx="',ae?Z.x1:Z.x2,'" cy="',ae?Z.y1:Z.y2,'" r="',ae?Z.r1:Z.r2,'" fx="',ae?Z.x2:Z.x1,'" fy="',ae?Z.y2:Z.y1,'">\n']),"radial"===this.type){if(ae)for((te=te.concat()).reverse(),P=0,L=te.length;P<L;P++)te[P].offset=1-te[P].offset;var Re=Math.min(Z.r1,Z.r2);if(Re>0){var Ae=Re/Math.max(Z.r1,Z.r2);for(P=0,L=te.length;P<L;P++)te[P].offset+=Ae*(1-te[P].offset)}}for(P=0,L=te.length;P<L;P++){var de=te[P];X.push("<stop ",'offset="',100*de.offset+"%",'" style="stop-color:',de.color,void 0!==de.opacity?";stop-opacity: "+de.opacity:";",'"/>\n')}return X.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),X.join("")},toLive:function(z){var $,P,L,X=ee.util.object.clone(this.coords);if(this.type){for("linear"===this.type?$=z.createLinearGradient(X.x1,X.y1,X.x2,X.y2):"radial"===this.type&&($=z.createRadialGradient(X.x1,X.y1,X.r1,X.x2,X.y2,X.r2)),P=0,L=this.colorStops.length;P<L;P++){var ne=this.colorStops[P].color,Z=this.colorStops[P].opacity,te=this.colorStops[P].offset;void 0!==Z&&(ne=new ee.Color(ne).setAlpha(Z).toRgba()),$.addColorStop(te,ne)}return $}}}),ee.util.object.extend(ee.Gradient,{fromElement:function(z,$,P,L){var X=parseFloat(P)/(/%$/.test(P)?100:1);X=X<0?0:X>1?1:X,isNaN(X)&&(X=1);var ne,Z,te,ae,Ae,de,tt,Ze,et,Qe,fe=z.getElementsByTagName("stop"),be="userSpaceOnUse"===z.getAttribute("gradientUnits")?"pixels":"percentage",Pe=z.getAttribute("gradientTransform")||"",De=[],Xe=0,Re=0;for("linearGradient"===z.nodeName||"LINEARGRADIENT"===z.nodeName?(ne="linear",Z={x1:(Ae=z).getAttribute("x1")||0,y1:Ae.getAttribute("y1")||0,x2:Ae.getAttribute("x2")||"100%",y2:Ae.getAttribute("y2")||0}):(ne="radial",Z=function(Ae){return{x1:Ae.getAttribute("fx")||Ae.getAttribute("cx")||"50%",y1:Ae.getAttribute("fy")||Ae.getAttribute("cy")||"50%",r1:0,x2:Ae.getAttribute("cx")||"50%",y2:Ae.getAttribute("cy")||"50%",r2:Ae.getAttribute("r")||"50%"}}(z)),te=fe.length;te--;)De.push(V(fe[te],X));return ae=ee.parseTransformAttribute(Pe),de=Z,tt=L,Ze=be,Object.keys(de).forEach(function(Je){"Infinity"===(et=de[Je])?Qe=1:"-Infinity"===et?Qe=0:(Qe=parseFloat(de[Je],10),"string"==typeof et&&/^(\d+\.\d+)%|(\d+)%$/.test(et)&&(Qe*=.01,"pixels"===Ze&&("x1"!==Je&&"x2"!==Je&&"r2"!==Je||(Qe*=tt.viewBoxWidth||tt.width),"y1"!==Je&&"y2"!==Je||(Qe*=tt.viewBoxHeight||tt.height)))),de[Je]=Qe}),"pixels"===be&&(Xe=-$.left,Re=-$.top),new ee.Gradient({id:z.getAttribute("id"),type:ne,coords:Z,colorStops:De,gradientUnits:be,gradientTransform:ae,offsetX:Xe,offsetY:Re})}})}(),Q=ee.util.toFixed,ee.Pattern=ee.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(V,F){if(V||(V={}),this.id=ee.Object.__uid++,this.setOptions(V),!V.source||V.source&&"string"!=typeof V.source)F&&F(this);else{var z=this;this.source=ee.util.createImage(),ee.util.loadImage(V.source,function($,P){z.source=$,F&&F(z,P)},null,this.crossOrigin)}},toObject:function(V){var F,z,$=ee.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?F=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(F=this.source.toDataURL()),z={type:"pattern",source:F,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:Q(this.offsetX,$),offsetY:Q(this.offsetY,$),patternTransform:this.patternTransform?this.patternTransform.concat():null},ee.util.populateWithProperties(this,z,V),z},toSVG:function(V){var F="function"==typeof this.source?this.source():this.source,z=F.width/V.width,$=F.height/V.height,P=this.offsetX/V.width,L=this.offsetY/V.height,X="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||($=1,L&&($+=Math.abs(L))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(z=1,P&&(z+=Math.abs(P))),F.src?X=F.src:F.toDataURL&&(X=F.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+P+'" y="'+L+'" width="'+z+'" height="'+$+'">\n<image x="0" y="0" width="'+F.width+'" height="'+F.height+'" xlink:href="'+X+'"></image>\n</pattern>\n'},setOptions:function(V){for(var F in V)this[F]=V[F]},toLive:function(V){var F=this.source;return F&&(void 0===F.src||F.complete&&0!==F.naturalWidth&&0!==F.naturalHeight)?V.createPattern(F,this.repeat):""}}),function(V){var F=V.fabric||(V.fabric={}),z=F.util.toFixed;F.Shadow?F.warn("fabric.Shadow is already defined."):(F.Shadow=F.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function($){for(var P in"string"==typeof $&&($=this._parseShadow($)),$)this[P]=$[P];this.id=F.Object.__uid++},_parseShadow:function($){var P=$.trim(),L=F.Shadow.reOffsetsAndBlur.exec(P)||[];return{color:(P.replace(F.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(L[1],10)||0,offsetY:parseFloat(L[2],10)||0,blur:parseFloat(L[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function($){var P=40,L=40,X=F.Object.NUM_FRACTION_DIGITS,ne=F.util.rotateVector({x:this.offsetX,y:this.offsetY},F.util.degreesToRadians(-$.angle)),Z=new F.Color(this.color);return $.width&&$.height&&(P=100*z((Math.abs(ne.x)+this.blur)/$.width,X)+20,L=100*z((Math.abs(ne.y)+this.blur)/$.height,X)+20),$.flipX&&(ne.x*=-1),$.flipY&&(ne.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+L+'%" height="'+(100+2*L)+'%" x="-'+P+'%" width="'+(100+2*P)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+z(this.blur?this.blur/2:0,X)+'"></feGaussianBlur>\n\t<feOffset dx="'+z(ne.x,X)+'" dy="'+z(ne.y,X)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+Z.toRgb()+'" flood-opacity="'+Z.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var $={},P=F.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(L){this[L]!==P[L]&&($[L]=this[L])},this),$}}),F.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(l),function(){if(ee.StaticCanvas)ee.warn("fabric.StaticCanvas is already defined.");else{var V=ee.util.object.extend,F=ee.util.getElementOffset,z=ee.util.removeFromArray,$=ee.util.toFixed,P=ee.util.transformPoint,L=ee.util.invertTransform,X=ee.util.getNodeCanvas,ne=ee.util.createCanvasElement,Z=new Error("Could not initialize `canvas` element");ee.StaticCanvas=ee.util.createClass(ee.CommonMethods,{initialize:function(te,ae){ae||(ae={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(te,ae)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:ee.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(te,ae){var fe=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(te),this._initOptions(ae),this.interactive||this._initRetinaScaling(),ae.overlayImage&&this.setOverlayImage(ae.overlayImage,fe),ae.backgroundImage&&this.setBackgroundImage(ae.backgroundImage,fe),ae.backgroundColor&&this.setBackgroundColor(ae.backgroundColor,fe),ae.overlayColor&&this.setOverlayColor(ae.overlayColor,fe),this.calcOffset()},_isRetinaScaling:function(){return ee.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,ee.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var te=ee.devicePixelRatio;this.__initRetinaScaling(te,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(te,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(te,ae,fe){ae.setAttribute("width",this.width*te),ae.setAttribute("height",this.height*te),fe.scale(te,te)},calcOffset:function(){return this._offset=F(this.lowerCanvasEl),this},setOverlayImage:function(te,ae,fe){return this.__setBgOverlayImage("overlayImage",te,ae,fe)},setBackgroundImage:function(te,ae,fe){return this.__setBgOverlayImage("backgroundImage",te,ae,fe)},setOverlayColor:function(te,ae){return this.__setBgOverlayColor("overlayColor",te,ae)},setBackgroundColor:function(te,ae){return this.__setBgOverlayColor("backgroundColor",te,ae)},__setBgOverlayImage:function(te,ae,fe,be){return"string"==typeof ae?ee.util.loadImage(ae,function(Pe,De){if(Pe){var Xe=new ee.Image(Pe,be);this[te]=Xe,Xe.canvas=this}fe&&fe(Pe,De)},this,be&&be.crossOrigin):(be&&ae.setOptions(be),this[te]=ae,ae&&(ae.canvas=this),fe&&fe(ae,!1)),this},__setBgOverlayColor:function(te,ae,fe){return this[te]=ae,this._initGradient(ae,te),this._initPattern(ae,te,fe),this},_createCanvasElement:function(){var te=ne();if(!te||(te.style||(te.style={}),void 0===te.getContext))throw Z;return te},_initOptions:function(te){var ae=this.lowerCanvasEl;this._setOptions(te),this.width=this.width||parseInt(ae.width,10)||0,this.height=this.height||parseInt(ae.height,10)||0,this.lowerCanvasEl.style&&(ae.width=this.width,ae.height=this.height,ae.style.width=this.width+"px",ae.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(te){this.lowerCanvasEl=te&&te.getContext?te:ee.util.getById(te)||this._createCanvasElement(),ee.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(te,ae){return this.setDimensions({width:te},ae)},setHeight:function(te,ae){return this.setDimensions({height:te},ae)},setDimensions:function(te,ae){var fe;for(var be in ae=ae||{},te)fe=te[be],ae.cssOnly||(this._setBackstoreDimension(be,te[be]),fe+="px",this.hasLostContext=!0),ae.backstoreOnly||this._setCssDimension(be,fe);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),ae.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(te,ae){return this.lowerCanvasEl[te]=ae,this.upperCanvasEl&&(this.upperCanvasEl[te]=ae),this.cacheCanvasEl&&(this.cacheCanvasEl[te]=ae),this[te]=ae,this},_setCssDimension:function(te,ae){return this.lowerCanvasEl.style[te]=ae,this.upperCanvasEl&&(this.upperCanvasEl.style[te]=ae),this.wrapperEl&&(this.wrapperEl.style[te]=ae),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(te){var ae,fe,be,Pe=this._activeObject,De=this.backgroundImage,Xe=this.overlayImage;for(this.viewportTransform=te,fe=0,be=this._objects.length;fe<be;fe++)(ae=this._objects[fe]).group||ae.setCoords(!0);return Pe&&Pe.setCoords(),De&&De.setCoords(!0),Xe&&Xe.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(te,ae){var fe=te,be=this.viewportTransform.slice(0);te=P(te,L(this.viewportTransform)),be[0]=ae,be[3]=ae;var Pe=P(te,be);return be[4]+=fe.x-Pe.x,be[5]+=fe.y-Pe.y,this.setViewportTransform(be)},setZoom:function(te){return this.zoomToPoint(new ee.Point(0,0),te),this},absolutePan:function(te){var ae=this.viewportTransform.slice(0);return ae[4]=-te.x,ae[5]=-te.y,this.setViewportTransform(ae)},relativePan:function(te){return this.absolutePan(new ee.Point(-te.x-this.viewportTransform[4],-te.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(te){this.stateful&&te.setupState(),te._set("canvas",this),te.setCoords(),this.fire("object:added",{target:te}),te.fire("added")},_onObjectRemoved:function(te){this.fire("object:removed",{target:te}),te.fire("removed"),delete te.canvas},clearContext:function(te){return te.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=ee.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var te={},ae=this.width,fe=this.height,be=L(this.viewportTransform);return te.tl=P({x:0,y:0},be),te.br=P({x:ae,y:fe},be),te.tr=new ee.Point(te.br.x,te.tl.y),te.bl=new ee.Point(te.tl.x,te.br.y),this.vptCoords=te,te},cancelRequestedRender:function(){this.isRendering&&(ee.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(te,ae){var fe=this.viewportTransform,be=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(te),ee.util.setImageSmoothing(te,this.imageSmoothingEnabled),this.fire("before:render",{ctx:te}),this._renderBackground(te),te.save(),te.transform(fe[0],fe[1],fe[2],fe[3],fe[4],fe[5]),this._renderObjects(te,ae),te.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(te),be&&(be.canvas=this,be.shouldCache(),be._transformDone=!0,be.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(te)),this._renderOverlay(te),this.controlsAboveOverlay&&this.interactive&&this.drawControls(te),this.fire("after:render",{ctx:te})},drawClipPathOnCanvas:function(te){var ae=this.viewportTransform,fe=this.clipPath;te.save(),te.transform(ae[0],ae[1],ae[2],ae[3],ae[4],ae[5]),te.globalCompositeOperation="destination-in",fe.transform(te),te.scale(1/fe.zoomX,1/fe.zoomY),te.drawImage(fe._cacheCanvas,-fe.cacheTranslationX,-fe.cacheTranslationY),te.restore()},_renderObjects:function(te,ae){var fe,be;for(fe=0,be=ae.length;fe<be;++fe)ae[fe]&&ae[fe].render(te)},_renderBackgroundOrOverlay:function(te,ae){var fe=this[ae+"Color"],be=this[ae+"Image"],Pe=this.viewportTransform,De=this[ae+"Vpt"];if(fe||be){if(fe){te.save(),te.beginPath(),te.moveTo(0,0),te.lineTo(this.width,0),te.lineTo(this.width,this.height),te.lineTo(0,this.height),te.closePath(),te.fillStyle=fe.toLive?fe.toLive(te,this):fe,De&&te.transform(Pe[0],Pe[1],Pe[2],Pe[3],Pe[4],Pe[5]),te.transform(1,0,0,1,fe.offsetX||0,fe.offsetY||0);var Xe=fe.gradientTransform||fe.patternTransform;Xe&&te.transform(Xe[0],Xe[1],Xe[2],Xe[3],Xe[4],Xe[5]),te.fill(),te.restore()}be&&(te.save(),De&&te.transform(Pe[0],Pe[1],Pe[2],Pe[3],Pe[4],Pe[5]),be.render(te),te.restore())}},_renderBackground:function(te){this._renderBackgroundOrOverlay(te,"background")},_renderOverlay:function(te){this._renderBackgroundOrOverlay(te,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new ee.Point(this.width/2,this.height/2)},centerObjectH:function(te){return this._centerObject(te,new ee.Point(this.getCenterPoint().x,te.getCenterPoint().y))},centerObjectV:function(te){return this._centerObject(te,new ee.Point(te.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(te){var ae=this.getCenterPoint();return this._centerObject(te,ae)},viewportCenterObject:function(te){var ae=this.getVpCenter();return this._centerObject(te,ae)},viewportCenterObjectH:function(te){var ae=this.getVpCenter();return this._centerObject(te,new ee.Point(ae.x,te.getCenterPoint().y)),this},viewportCenterObjectV:function(te){var ae=this.getVpCenter();return this._centerObject(te,new ee.Point(te.getCenterPoint().x,ae.y))},getVpCenter:function(){var te=this.getCenterPoint(),ae=L(this.viewportTransform);return P(te,ae)},_centerObject:function(te,ae){return te.setPositionByOrigin(ae,"center","center"),te.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(te){return this.toDatalessObject(te)},toObject:function(te){return this._toObjectMethod("toObject",te)},toDatalessObject:function(te){return this._toObjectMethod("toDatalessObject",te)},_toObjectMethod:function(te,ae){var fe=this.clipPath,be={version:ee.version,objects:this._toObjects(te,ae)};return fe&&!fe.excludeFromExport&&(be.clipPath=this._toObject(this.clipPath,te,ae)),V(be,this.__serializeBgOverlay(te,ae)),ee.util.populateWithProperties(this,be,ae),be},_toObjects:function(te,ae){return this._objects.filter(function(fe){return!fe.excludeFromExport}).map(function(fe){return this._toObject(fe,te,ae)},this)},_toObject:function(te,ae,fe){var be;this.includeDefaultValues||(be=te.includeDefaultValues,te.includeDefaultValues=!1);var Pe=te[ae](fe);return this.includeDefaultValues||(te.includeDefaultValues=be),Pe},__serializeBgOverlay:function(te,ae){var fe={},be=this.backgroundImage,Pe=this.overlayImage,De=this.backgroundColor,Xe=this.overlayColor;return De&&De.toObject?De.excludeFromExport||(fe.background=De.toObject(ae)):De&&(fe.background=De),Xe&&Xe.toObject?Xe.excludeFromExport||(fe.overlay=Xe.toObject(ae)):Xe&&(fe.overlay=Xe),be&&!be.excludeFromExport&&(fe.backgroundImage=this._toObject(be,te,ae)),Pe&&!Pe.excludeFromExport&&(fe.overlayImage=this._toObject(Pe,te,ae)),fe},svgViewportTransformation:!0,toSVG:function(te,ae){te||(te={}),te.reviver=ae;var fe=[];return this._setSVGPreamble(fe,te),this._setSVGHeader(fe,te),this.clipPath&&fe.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(fe,"background"),this._setSVGBgOverlayImage(fe,"backgroundImage",ae),this._setSVGObjects(fe,ae),this.clipPath&&fe.push("</g>\n"),this._setSVGBgOverlayColor(fe,"overlay"),this._setSVGBgOverlayImage(fe,"overlayImage",ae),fe.push("</svg>"),fe.join("")},_setSVGPreamble:function(te,ae){ae.suppressPreamble||te.push('<?xml version="1.0" encoding="',ae.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(te,ae){var fe,be=ae.width||this.width,Pe=ae.height||this.height,De='viewBox="0 0 '+this.width+" "+this.height+'" ',Xe=ee.Object.NUM_FRACTION_DIGITS;ae.viewBox?De='viewBox="'+ae.viewBox.x+" "+ae.viewBox.y+" "+ae.viewBox.width+" "+ae.viewBox.height+'" ':this.svgViewportTransformation&&(De='viewBox="'+$(-(fe=this.viewportTransform)[4]/fe[0],Xe)+" "+$(-fe[5]/fe[3],Xe)+" "+$(this.width/fe[0],Xe)+" "+$(this.height/fe[3],Xe)+'" '),te.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',be,'" ','height="',Pe,'" ',De,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",ee.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(ae),"</defs>\n")},createSVGClipPathMarkup:function(te){var ae=this.clipPath;return ae?(ae.clipPathId="CLIPPATH_"+ee.Object.__uid++,'<clipPath id="'+ae.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(te.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var te=this;return["background","overlay"].map(function(ae){var fe=te[ae+"Color"];if(fe&&fe.toLive){var be=te[ae+"Vpt"],Pe=te.viewportTransform;return fe.toSVG({width:te.width/(be?Pe[0]:1),height:te.height/(be?Pe[3]:1)},{additionalTransform:be?ee.util.matrixToSVG(Pe):""})}}).join("")},createSVGFontFacesMarkup:function(){var te,ae,fe,be,Pe,De,Xe,Re,Ae="",de={},tt=ee.fontPaths,Ze=[];for(this._objects.forEach(function Qe(Je){Ze.push(Je),Je._objects&&Je._objects.forEach(Qe)}),Xe=0,Re=Ze.length;Xe<Re;Xe++)if(ae=(te=Ze[Xe]).fontFamily,-1!==te.type.indexOf("text")&&!de[ae]&&tt[ae]&&(de[ae]=!0,te.styles))for(Pe in fe=te.styles)for(De in be=fe[Pe])!de[ae=be[De].fontFamily]&&tt[ae]&&(de[ae]=!0);for(var et in de)Ae+=["\t\t@font-face {\n","\t\t\tfont-family: '",et,"';\n","\t\t\tsrc: url('",tt[et],"');\n","\t\t}\n"].join("");return Ae&&(Ae=['\t<style type="text/css">',"<![CDATA[\n",Ae,"]]>","</style>\n"].join("")),Ae},_setSVGObjects:function(te,ae){var fe,be,Pe,De=this._objects;for(be=0,Pe=De.length;be<Pe;be++)(fe=De[be]).excludeFromExport||this._setSVGObject(te,fe,ae)},_setSVGObject:function(te,ae,fe){te.push(ae.toSVG(fe))},_setSVGBgOverlayImage:function(te,ae,fe){this[ae]&&!this[ae].excludeFromExport&&this[ae].toSVG&&te.push(this[ae].toSVG(fe))},_setSVGBgOverlayColor:function(te,ae){var fe=this[ae+"Color"],Pe=this.width,De=this.height;if(fe)if(fe.toLive){var Xe=fe.repeat,Re=ee.util.invertTransform(this.viewportTransform),Ae=this[ae+"Vpt"]?ee.util.matrixToSVG(Re):"";te.push('<rect transform="'+Ae+" translate(",Pe/2,",",De/2,')"',' x="',fe.offsetX-Pe/2,'" y="',fe.offsetY-De/2,'" ','width="',"repeat-y"===Xe||"no-repeat"===Xe?fe.source.width:Pe,'" height="',"repeat-x"===Xe||"no-repeat"===Xe?fe.source.height:De,'" fill="url(#SVGID_'+fe.id+')"',"></rect>\n")}else te.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',fe,'"',"></rect>\n")},sendToBack:function(te){if(!te)return this;var ae,fe,be,Pe=this._activeObject;if(te===Pe&&"activeSelection"===te.type)for(ae=(be=Pe._objects).length;ae--;)z(this._objects,fe=be[ae]),this._objects.unshift(fe);else z(this._objects,te),this._objects.unshift(te);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(te){if(!te)return this;var ae,fe,be,Pe=this._activeObject;if(te===Pe&&"activeSelection"===te.type)for(be=Pe._objects,ae=0;ae<be.length;ae++)z(this._objects,fe=be[ae]),this._objects.push(fe);else z(this._objects,te),this._objects.push(te);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(te,ae){if(!te)return this;var fe,be,Pe,De,Xe,Re=this._activeObject,Ae=0;if(te===Re&&"activeSelection"===te.type)for(Xe=Re._objects,fe=0;fe<Xe.length;fe++)(Pe=this._objects.indexOf(be=Xe[fe]))>0+Ae&&(De=Pe-1,z(this._objects,be),this._objects.splice(De,0,be)),Ae++;else 0!==(Pe=this._objects.indexOf(te))&&(De=this._findNewLowerIndex(te,Pe,ae),z(this._objects,te),this._objects.splice(De,0,te));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(te,ae,fe){var be,Pe;if(fe){for(be=ae,Pe=ae-1;Pe>=0;--Pe)if(te.intersectsWithObject(this._objects[Pe])||te.isContainedWithinObject(this._objects[Pe])||this._objects[Pe].isContainedWithinObject(te)){be=Pe;break}}else be=ae-1;return be},bringForward:function(te,ae){if(!te)return this;var fe,be,Pe,De,Xe,Re=this._activeObject,Ae=0;if(te===Re&&"activeSelection"===te.type)for(fe=(Xe=Re._objects).length;fe--;)(Pe=this._objects.indexOf(be=Xe[fe]))<this._objects.length-1-Ae&&(De=Pe+1,z(this._objects,be),this._objects.splice(De,0,be)),Ae++;else(Pe=this._objects.indexOf(te))!==this._objects.length-1&&(De=this._findNewUpperIndex(te,Pe,ae),z(this._objects,te),this._objects.splice(De,0,te));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(te,ae,fe){var be,Pe,De;if(fe){for(be=ae,Pe=ae+1,De=this._objects.length;Pe<De;++Pe)if(te.intersectsWithObject(this._objects[Pe])||te.isContainedWithinObject(this._objects[Pe])||this._objects[Pe].isContainedWithinObject(te)){be=Pe;break}}else be=ae+1;return be},moveTo:function(te,ae){return z(this._objects,te),this._objects.splice(ae,0,te),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(ee.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(te){te.dispose&&te.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),ee.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),ee.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),V(ee.StaticCanvas.prototype,ee.Observable),V(ee.StaticCanvas.prototype,ee.Collection),V(ee.StaticCanvas.prototype,ee.DataURLExporter),V(ee.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(te){var ae=ne();if(!ae||!ae.getContext)return null;var fe=ae.getContext("2d");return fe&&"setLineDash"===te?void 0!==fe.setLineDash:null}}),ee.StaticCanvas.prototype.toJSON=ee.StaticCanvas.prototype.toObject,ee.isLikelyNode&&(ee.StaticCanvas.prototype.createPNGStream=function(){var te=X(this.lowerCanvasEl);return te&&te.createPNGStream()},ee.StaticCanvas.prototype.createJPEGStream=function(te){var ae=X(this.lowerCanvasEl);return ae&&ae.createJPEGStream(te)})}}(),ee.BaseBrush=ee.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(V){V.strokeStyle=this.color,V.lineWidth=this.width,V.lineCap=this.strokeLineCap,V.miterLimit=this.strokeMiterLimit,V.lineJoin=this.strokeLineJoin,V.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(V){var F=this.canvas.viewportTransform;V.save(),V.transform(F[0],F[1],F[2],F[3],F[4],F[5])},_setShadow:function(){if(this.shadow){var V=this.canvas,F=this.shadow,z=V.contextTop,$=V.getZoom();V&&V._isRetinaScaling()&&($*=ee.devicePixelRatio),z.shadowColor=F.color,z.shadowBlur=F.blur*$,z.shadowOffsetX=F.offsetX*$,z.shadowOffsetY=F.offsetY*$}},needsFullRender:function(){return new ee.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var V=this.canvas.contextTop;V.shadowColor="",V.shadowBlur=V.shadowOffsetX=V.shadowOffsetY=0},_isOutSideCanvas:function(V){return V.x<0||V.x>this.canvas.getWidth()||V.y<0||V.y>this.canvas.getHeight()}}),ee.PencilBrush=ee.util.createClass(ee.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(V){this.canvas=V,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(V,F,z){var $=F.midPointFrom(z);return V.quadraticCurveTo(F.x,F.y,$.x,$.y),$},onMouseDown:function(V,F){this.canvas._isMainEvent(F.e)&&(this.drawStraightLine=F.e[this.straightLineKey],this._prepareForDrawing(V),this._captureDrawingPath(V),this._render())},onMouseMove:function(V,F){if(this.canvas._isMainEvent(F.e)&&(this.drawStraightLine=F.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(V))&&this._captureDrawingPath(V)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var z=this._points,$=z.length,P=this.canvas.contextTop;this._saveAndTransform(P),this.oldEnd&&(P.beginPath(),P.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(P,z[$-2],z[$-1],!0),P.stroke(),P.restore()}},onMouseUp:function(V){return!this.canvas._isMainEvent(V.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(V){var F=new ee.Point(V.x,V.y);this._reset(),this._addPoint(F),this.canvas.contextTop.moveTo(F.x,F.y)},_addPoint:function(V){return!(this._points.length>1&&V.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(V),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(V){var F=new ee.Point(V.x,V.y);return this._addPoint(F)},_render:function(V){var F,z,$=this._points[0],P=this._points[1];if(this._saveAndTransform(V=V||this.canvas.contextTop),V.beginPath(),2===this._points.length&&$.x===P.x&&$.y===P.y){var L=this.width/1e3;$=new ee.Point($.x,$.y),P=new ee.Point(P.x,P.y),$.x-=L,P.x+=L}for(V.moveTo($.x,$.y),F=1,z=this._points.length;F<z;F++)this._drawSegment(V,$,P),$=this._points[F],P=this._points[F+1];V.lineTo($.x,$.y),V.stroke(),V.restore()},convertPointsToSVGPath:function(V){return ee.util.getSmoothPathFromPoints(V,this.width/1e3)},_isEmptySVGPath:function(V){return"M 0 0 Q 0 0 0 0 L 0 0"===ee.util.joinPath(V)},createPath:function(V){var F=new ee.Path(V,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,F.shadow=new ee.Shadow(this.shadow)),F},decimatePoints:function(V,F){if(V.length<=2)return V;var z,$=this.canvas.getZoom(),P=Math.pow(F/$,2),L=V.length-1,X=V[0],ne=[X];for(z=1;z<L-1;z++)Math.pow(X.x-V[z].x,2)+Math.pow(X.y-V[z].y,2)>=P&&ne.push(X=V[z]);return ne.push(V[L]),ne},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var V=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(V))this.canvas.requestRenderAll();else{var F=this.createPath(V);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:F}),this.canvas.add(F),this.canvas.requestRenderAll(),F.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:F})}}}),ee.CircleBrush=ee.util.createClass(ee.BaseBrush,{width:10,initialize:function(V){this.canvas=V,this.points=[]},drawDot:function(V){var F=this.addPoint(V),z=this.canvas.contextTop;this._saveAndTransform(z),this.dot(z,F),z.restore()},dot:function(V,F){V.fillStyle=F.fill,V.beginPath(),V.arc(F.x,F.y,F.radius,0,2*Math.PI,!1),V.closePath(),V.fill()},onMouseDown:function(V){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(V)},_render:function(){var V,F,z=this.canvas.contextTop,$=this.points;for(this._saveAndTransform(z),V=0,F=$.length;V<F;V++)this.dot(z,$[V]);z.restore()},onMouseMove:function(V){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(V)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(V),this._render()):this.drawDot(V))},onMouseUp:function(){var V,F,z=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var $=[];for(V=0,F=this.points.length;V<F;V++){var P=this.points[V],L=new ee.Circle({radius:P.radius,left:P.x,top:P.y,originX:"center",originY:"center",fill:P.fill});this.shadow&&(L.shadow=new ee.Shadow(this.shadow)),$.push(L)}var X=new ee.Group($);X.canvas=this.canvas,this.canvas.fire("before:path:created",{path:X}),this.canvas.add(X),this.canvas.fire("path:created",{path:X}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=z,this.canvas.requestRenderAll()},addPoint:function(V){var F=new ee.Point(V.x,V.y),z=ee.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,$=new ee.Color(this.color).setAlpha(ee.util.getRandomInt(0,100)/100).toRgba();return F.radius=z,F.fill=$,this.points.push(F),F}}),ee.SprayBrush=ee.util.createClass(ee.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(V){this.canvas=V,this.sprayChunks=[]},onMouseDown:function(V){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(V),this.render(this.sprayChunkPoints)},onMouseMove:function(V){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(V)||(this.addSprayChunk(V),this.render(this.sprayChunkPoints))},onMouseUp:function(){var V=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var F=[],z=0,$=this.sprayChunks.length;z<$;z++)for(var P=this.sprayChunks[z],L=0,X=P.length;L<X;L++){var ne=new ee.Rect({width:P[L].width,height:P[L].width,left:P[L].x+1,top:P[L].y+1,originX:"center",originY:"center",fill:this.color});F.push(ne)}this.optimizeOverlapping&&(F=this._getOptimizedRects(F));var Z=new ee.Group(F);this.shadow&&Z.set("shadow",new ee.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:Z}),this.canvas.add(Z),this.canvas.fire("path:created",{path:Z}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=V,this.canvas.requestRenderAll()},_getOptimizedRects:function(V){var F,z,$,P={};for(z=0,$=V.length;z<$;z++)P[F=V[z].left+""+V[z].top]||(P[F]=V[z]);var L=[];for(F in P)L.push(P[F]);return L},render:function(V){var F,z,$=this.canvas.contextTop;for($.fillStyle=this.color,this._saveAndTransform($),F=0,z=V.length;F<z;F++){var P=V[F];void 0!==P.opacity&&($.globalAlpha=P.opacity),$.fillRect(P.x,P.y,P.width,P.width)}$.restore()},_render:function(){var V,F,z=this.canvas.contextTop;for(z.fillStyle=this.color,this._saveAndTransform(z),V=0,F=this.sprayChunks.length;V<F;V++)this.render(this.sprayChunks[V]);z.restore()},addSprayChunk:function(V){this.sprayChunkPoints=[];var F,z,$,P,L=this.width/2;for(P=0;P<this.density;P++){F=ee.util.getRandomInt(V.x-L,V.x+L),z=ee.util.getRandomInt(V.y-L,V.y+L),$=this.dotWidthVariance?ee.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var X=new ee.Point(F,z);X.width=$,this.randomOpacity&&(X.opacity=ee.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(X)}this.sprayChunks.push(this.sprayChunkPoints)}}),ee.PatternBrush=ee.util.createClass(ee.PencilBrush,{getPatternSrc:function(){var V=ee.util.createCanvasElement(),F=V.getContext("2d");return V.width=V.height=25,F.fillStyle=this.color,F.beginPath(),F.arc(10,10,10,0,2*Math.PI,!1),F.closePath(),F.fill(),V},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(V){return V.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(V){this.callSuper("_setBrushStyles",V),V.strokeStyle=this.getPattern(V)},createPath:function(V){var F=this.callSuper("createPath",V),z=F._getLeftTopCoords().scalarAdd(F.strokeWidth/2);return F.stroke=new ee.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-z.x,offsetY:-z.y}),F}}),function(){var V=ee.util.getPointer,F=ee.util.degreesToRadians,z=ee.util.isTouchEvent;for(var $ in ee.Canvas=ee.util.createClass(ee.StaticCanvas,{initialize:function(P,L){L||(L={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(P,L),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=ee.PencilBrush&&new ee.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var P,L,X,ne=this.getActiveObjects();if(ne.length>0&&!this.preserveObjectStacking){L=[],X=[];for(var Z=0,te=this._objects.length;Z<te;Z++)-1===ne.indexOf(P=this._objects[Z])?L.push(P):X.push(P);ne.length>1&&(this._activeObject._objects=X),L.push.apply(L,X)}else L=this._objects;return L},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(P){P.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(P),this.contextTopDirty=!0),P.restore()},renderTop:function(){var P=this.contextTop;return this.clearContext(P),this.renderTopLayer(P),this.fire("after:render"),this},_normalizePointer:function(P,L){var X=P.calcTransformMatrix(),ne=ee.util.invertTransform(X),Z=this.restorePointerVpt(L);return ee.util.transformPoint(Z,ne)},isTargetTransparent:function(P,L,X){if(P.shouldCache()&&P._cacheCanvas&&P!==this._activeObject){var ne=this._normalizePointer(P,{x:L,y:X}),Z=Math.max(P.cacheTranslationX+ne.x*P.zoomX,0),te=Math.max(P.cacheTranslationY+ne.y*P.zoomY,0);return ee.util.isTransparent(P._cacheContext,Math.round(Z),Math.round(te),this.targetFindTolerance)}var ae=this.contextCache,fe=P.selectionBackgroundColor,be=this.viewportTransform;return P.selectionBackgroundColor="",this.clearContext(ae),ae.save(),ae.transform(be[0],be[1],be[2],be[3],be[4],be[5]),P.render(ae),ae.restore(),P.selectionBackgroundColor=fe,ee.util.isTransparent(ae,L,X,this.targetFindTolerance)},_isSelectionKeyPressed:function(P){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(L){return!0===P[L]}):P[this.selectionKey]},_shouldClearSelection:function(P,L){var X=this.getActiveObjects(),ne=this._activeObject;return!L||L&&ne&&X.length>1&&-1===X.indexOf(L)&&ne!==L&&!this._isSelectionKeyPressed(P)||L&&!L.evented||L&&!L.selectable&&ne&&ne!==L},_shouldCenterTransform:function(P,L,X){var ne;if(P)return"scale"===L||"scaleX"===L||"scaleY"===L||"resizing"===L?ne=this.centeredScaling||P.centeredScaling:"rotate"===L&&(ne=this.centeredRotation||P.centeredRotation),ne?!X:X},_getOriginFromCorner:function(P,L){var X={x:P.originX,y:P.originY};return"ml"===L||"tl"===L||"bl"===L?X.x="right":"mr"!==L&&"tr"!==L&&"br"!==L||(X.x="left"),"tl"===L||"mt"===L||"tr"===L?X.y="bottom":"bl"!==L&&"mb"!==L&&"br"!==L||(X.y="top"),X},_getActionFromCorner:function(P,L,X,ne){if(!L||!P)return"drag";var Z=ne.controls[L];return Z.getActionName(X,Z,ne)},_setupCurrentTransform:function(P,L,X){if(L){var ne=this.getPointer(P),Z=L.__corner,te=L.controls[Z],ae=X&&Z?te.getActionHandler(P,L,te):ee.controlsUtils.dragHandler,fe=this._getActionFromCorner(X,Z,P,L),be=this._getOriginFromCorner(L,Z),Pe=P[this.centeredKey],De={target:L,action:fe,actionHandler:ae,corner:Z,scaleX:L.scaleX,scaleY:L.scaleY,skewX:L.skewX,skewY:L.skewY,offsetX:ne.x-L.left,offsetY:ne.y-L.top,originX:be.x,originY:be.y,ex:ne.x,ey:ne.y,lastX:ne.x,lastY:ne.y,theta:F(L.angle),width:L.width*L.scaleX,shiftKey:P.shiftKey,altKey:Pe,original:ee.util.saveObjectTransform(L)};this._shouldCenterTransform(L,fe,Pe)&&(De.originX="center",De.originY="center"),De.original.originX=be.x,De.original.originY=be.y,this._currentTransform=De,this._beforeTransform(P)}},setCursor:function(P){this.upperCanvasEl.style.cursor=P},_drawSelection:function(P){var L=this._groupSelector,X=new ee.Point(L.ex,L.ey),ne=ee.util.transformPoint(X,this.viewportTransform),Z=new ee.Point(L.ex+L.left,L.ey+L.top),te=ee.util.transformPoint(Z,this.viewportTransform),ae=Math.min(ne.x,te.x),fe=Math.min(ne.y,te.y),be=Math.max(ne.x,te.x),Pe=Math.max(ne.y,te.y),De=this.selectionLineWidth/2;this.selectionColor&&(P.fillStyle=this.selectionColor,P.fillRect(ae,fe,be-ae,Pe-fe)),this.selectionLineWidth&&this.selectionBorderColor&&(P.lineWidth=this.selectionLineWidth,P.strokeStyle=this.selectionBorderColor,ae+=De,fe+=De,be-=De,Pe-=De,ee.Object.prototype._setLineDash.call(this,P,this.selectionDashArray),P.strokeRect(ae,fe,be-ae,Pe-fe))},findTarget:function(P,L){if(!this.skipTargetFind){var X,ne,Z=this.getPointer(P,!0),te=this._activeObject,ae=this.getActiveObjects(),fe=z(P),be=ae.length>1&&!L||1===ae.length;if(this.targets=[],be&&te._findTargetCorner(Z,fe)||ae.length>1&&!L&&te===this._searchPossibleTargets([te],Z))return te;if(1===ae.length&&te===this._searchPossibleTargets([te],Z)){if(!this.preserveObjectStacking)return te;X=te,ne=this.targets,this.targets=[]}var Pe=this._searchPossibleTargets(this._objects,Z);return P[this.altSelectionKey]&&Pe&&X&&Pe!==X&&(Pe=X,this.targets=ne),Pe}},_checkTarget:function(P,L,X){if(L&&L.visible&&L.evented&&L.containsPoint(P)&&(!this.perPixelTargetFind&&!L.perPixelTargetFind||L.isEditing||!this.isTargetTransparent(L,X.x,X.y)))return!0},_searchPossibleTargets:function(P,L){for(var X,ne,Z=P.length;Z--;){var te=P[Z],ae=te.group?this._normalizePointer(te.group,L):L;if(this._checkTarget(ae,te,L)){(X=P[Z]).subTargetCheck&&X instanceof ee.Group&&(ne=this._searchPossibleTargets(X._objects,L))&&this.targets.push(ne);break}}return X},restorePointerVpt:function(P){return ee.util.transformPoint(P,ee.util.invertTransform(this.viewportTransform))},getPointer:function(P,L){if(this._absolutePointer&&!L)return this._absolutePointer;if(this._pointer&&L)return this._pointer;var X,ne=V(P),Z=this.upperCanvasEl,te=Z.getBoundingClientRect(),ae=te.width||0,fe=te.height||0;ae&&fe||("top"in te&&"bottom"in te&&(fe=Math.abs(te.top-te.bottom)),"right"in te&&"left"in te&&(ae=Math.abs(te.right-te.left))),this.calcOffset(),ne.x=ne.x-this._offset.left,ne.y=ne.y-this._offset.top,L||(ne=this.restorePointerVpt(ne));var be=this.getRetinaScaling();return 1!==be&&(ne.x/=be,ne.y/=be),{x:ne.x*(X=0===ae||0===fe?{width:1,height:1}:{width:Z.width/ae,height:Z.height/fe}).width,y:ne.y*X.height}},_createUpperCanvas:function(){var P=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),L=this.lowerCanvasEl,X=this.upperCanvasEl;X?X.className="":(X=this._createCanvasElement(),this.upperCanvasEl=X),ee.util.addClass(X,"upper-canvas "+P),this.wrapperEl.appendChild(X),this._copyCanvasStyle(L,X),this._applyCanvasStyle(X),this.contextTop=X.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=ee.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),ee.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),ee.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(P){var L=this.width||P.width,X=this.height||P.height;ee.util.setStyle(P,{position:"absolute",width:L+"px",height:X+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),P.width=L,P.height=X,ee.util.makeElementUnselectable(P)},_copyCanvasStyle:function(P,L){L.style.cssText=P.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var P=this._activeObject;return P?"activeSelection"===P.type&&P._objects?P._objects.slice(0):[P]:[]},_onObjectRemoved:function(P){P===this._activeObject&&(this.fire("before:selection:cleared",{target:P}),this._discardActiveObject(),this.fire("selection:cleared",{target:P}),P.fire("deselected")),P===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",P)},_fireSelectionEvents:function(P,L){var X=!1,ne=this.getActiveObjects(),Z=[],te=[];P.forEach(function(ae){-1===ne.indexOf(ae)&&(X=!0,ae.fire("deselected",{e:L,target:ae}),te.push(ae))}),ne.forEach(function(ae){-1===P.indexOf(ae)&&(X=!0,ae.fire("selected",{e:L,target:ae}),Z.push(ae))}),P.length>0&&ne.length>0?X&&this.fire("selection:updated",{e:L,selected:Z,deselected:te}):ne.length>0?this.fire("selection:created",{e:L,selected:Z}):P.length>0&&this.fire("selection:cleared",{e:L,deselected:te})},setActiveObject:function(P,L){var X=this.getActiveObjects();return this._setActiveObject(P,L),this._fireSelectionEvents(X,L),this},_setActiveObject:function(P,L){return this._activeObject!==P&&!!this._discardActiveObject(L,P)&&!P.onSelect({e:L})&&(this._activeObject=P,!0)},_discardActiveObject:function(P,L){var X=this._activeObject;if(X){if(X.onDeselect({e:P,object:L}))return!1;this._activeObject=null}return!0},discardActiveObject:function(P){var L=this.getActiveObjects(),X=this.getActiveObject();return L.length&&this.fire("before:selection:cleared",{target:X,e:P}),this._discardActiveObject(P),this._fireSelectionEvents(L,P),this},dispose:function(){var P=this.wrapperEl;return this.removeListeners(),P.removeChild(this.upperCanvasEl),P.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(L){ee.util.cleanUpJsdomNode(this[L]),this[L]=void 0}.bind(this)),P.parentNode&&P.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,ee.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(P){var L=this._activeObject;L&&L._renderControls(P)},_toObject:function(P,L,X){var ne=this._realizeGroupTransformOnObject(P),Z=this.callSuper("_toObject",P,L,X);return this._unwindGroupTransformOnObject(P,ne),Z},_realizeGroupTransformOnObject:function(P){if(P.group&&"activeSelection"===P.group.type&&this._activeObject===P.group){var L={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(X){L[X]=P[X]}),ee.util.addTransformToObject(P,this._activeObject.calcOwnMatrix()),L}return null},_unwindGroupTransformOnObject:function(P,L){L&&P.set(L)},_setSVGObject:function(P,L,X){var ne=this._realizeGroupTransformOnObject(L);this.callSuper("_setSVGObject",P,L,X),this._unwindGroupTransformOnObject(L,ne)},setViewportTransform:function(P){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),ee.StaticCanvas.prototype.setViewportTransform.call(this,P)}}),ee.StaticCanvas)"prototype"!==$&&(ee.Canvas[$]=ee.StaticCanvas[$])}(),function(){var V=ee.util.addListener,F=ee.util.removeListener,z={passive:!1};function $(P,L){return P.button&&P.button===L-1}ee.util.object.extend(ee.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(V,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(P,L){var X=this.upperCanvasEl,ne=this._getEventPrefix();P(ee.window,"resize",this._onResize),P(X,ne+"down",this._onMouseDown),P(X,ne+"move",this._onMouseMove,z),P(X,ne+"out",this._onMouseOut),P(X,ne+"enter",this._onMouseEnter),P(X,"wheel",this._onMouseWheel),P(X,"contextmenu",this._onContextMenu),P(X,"dblclick",this._onDoubleClick),P(X,"dragover",this._onDragOver),P(X,"dragenter",this._onDragEnter),P(X,"dragleave",this._onDragLeave),P(X,"drop",this._onDrop),this.enablePointerEvents||P(X,"touchstart",this._onTouchStart,z),"undefined"!=typeof eventjs&&L in eventjs&&(eventjs[L](X,"gesture",this._onGesture),eventjs[L](X,"drag",this._onDrag),eventjs[L](X,"orientation",this._onOrientationChange),eventjs[L](X,"shake",this._onShake),eventjs[L](X,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(F,"remove");var P=this._getEventPrefix();F(ee.document,P+"up",this._onMouseUp),F(ee.document,"touchend",this._onTouchEnd,z),F(ee.document,P+"move",this._onMouseMove,z),F(ee.document,"touchmove",this._onMouseMove,z)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(P,L){this.__onTransformGesture&&this.__onTransformGesture(P,L)},_onDrag:function(P,L){this.__onDrag&&this.__onDrag(P,L)},_onMouseWheel:function(P){this.__onMouseWheel(P)},_onMouseOut:function(P){var L=this._hoveredTarget;this.fire("mouse:out",{target:L,e:P}),this._hoveredTarget=null,L&&L.fire("mouseout",{e:P});var X=this;this._hoveredTargets.forEach(function(ne){X.fire("mouse:out",{target:L,e:P}),ne&&L.fire("mouseout",{e:P})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(ne){ne.isEditing&&ne.hiddenTextarea.focus()})},_onMouseEnter:function(P){this._currentTransform||this.findTarget(P)||(this.fire("mouse:over",{target:null,e:P}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(P,L){this.__onOrientationChange&&this.__onOrientationChange(P,L)},_onShake:function(P,L){this.__onShake&&this.__onShake(P,L)},_onLongPress:function(P,L){this.__onLongPress&&this.__onLongPress(P,L)},_onDragOver:function(P){P.preventDefault();var L=this._simpleEventHandler("dragover",P);this._fireEnterLeaveEvents(L,P)},_onDrop:function(P){return this._simpleEventHandler("drop:before",P),this._simpleEventHandler("drop",P)},_onContextMenu:function(P){return this.stopContextMenu&&(P.stopPropagation(),P.preventDefault()),!1},_onDoubleClick:function(P){this._cacheTransformEventData(P),this._handleEvent(P,"dblclick"),this._resetTransformEventData(P)},getPointerId:function(P){var L=P.changedTouches;return L?L[0]&&L[0].identifier:this.enablePointerEvents?P.pointerId:-1},_isMainEvent:function(P){return!0===P.isPrimary||!1!==P.isPrimary&&("touchend"===P.type&&0===P.touches.length||!P.changedTouches||P.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(P){P.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(P)),this.__onMouseDown(P),this._resetTransformEventData();var L=this.upperCanvasEl,X=this._getEventPrefix();V(ee.document,"touchend",this._onTouchEnd,z),V(ee.document,"touchmove",this._onMouseMove,z),F(L,X+"down",this._onMouseDown)},_onMouseDown:function(P){this.__onMouseDown(P),this._resetTransformEventData();var L=this.upperCanvasEl,X=this._getEventPrefix();F(L,X+"move",this._onMouseMove,z),V(ee.document,X+"up",this._onMouseUp),V(ee.document,X+"move",this._onMouseMove,z)},_onTouchEnd:function(P){if(!(P.touches.length>0)){this.__onMouseUp(P),this._resetTransformEventData(),this.mainTouchId=null;var L=this._getEventPrefix();F(ee.document,"touchend",this._onTouchEnd,z),F(ee.document,"touchmove",this._onMouseMove,z);var X=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){V(X.upperCanvasEl,L+"down",X._onMouseDown),X._willAddMouseDown=0},400)}},_onMouseUp:function(P){this.__onMouseUp(P),this._resetTransformEventData();var L=this.upperCanvasEl,X=this._getEventPrefix();this._isMainEvent(P)&&(F(ee.document,X+"up",this._onMouseUp),F(ee.document,X+"move",this._onMouseMove,z),V(L,X+"move",this._onMouseMove,z))},_onMouseMove:function(P){!this.allowTouchScrolling&&P.preventDefault&&P.preventDefault(),this.__onMouseMove(P)},_onResize:function(){this.calcOffset()},_shouldRender:function(P){var L=this._activeObject;return!!(!!L!=!!P||L&&P&&L!==P)||!1},__onMouseUp:function(P){var L,X=this._currentTransform,ne=this._groupSelector,Z=!1,te=!ne||0===ne.left&&0===ne.top;if(this._cacheTransformEventData(P),L=this._target,this._handleEvent(P,"up:before"),$(P,3))this.fireRightClick&&this._handleEvent(P,"up",3,te);else{if($(P,2))return this.fireMiddleClick&&this._handleEvent(P,"up",2,te),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(P);else if(this._isMainEvent(P)){if(X&&(this._finalizeCurrentTransform(P),Z=X.actionPerformed),!te){var ae=L===this._activeObject;this._maybeGroupObjects(P),Z||(Z=this._shouldRender(L)||!ae&&L===this._activeObject)}var fe,be;if(L){if(fe=L._findTargetCorner(this.getPointer(P,!0),ee.util.isTouchEvent(P)),L.selectable&&L!==this._activeObject&&"up"===L.activeOn)this.setActiveObject(L,P),Z=!0;else{var Pe=L.controls[fe],De=Pe&&Pe.getMouseUpHandler(P,L,Pe);De&&De(P,X,(be=this.getPointer(P)).x,be.y)}L.isMoving=!1}if(X&&(X.target!==L||X.corner!==fe)){var Xe=X.target&&X.target.controls[X.corner],Re=Xe&&Xe.getMouseUpHandler(P,L,Pe);be=be||this.getPointer(P),Re&&Re(P,X,be.x,be.y)}this._setCursorFromEvent(P,L),this._handleEvent(P,"up",1,te),this._groupSelector=null,this._currentTransform=null,L&&(L.__corner=0),Z?this.requestRenderAll():te||this.renderTop()}}},_simpleEventHandler:function(P,L){var X=this.findTarget(L),ne=this.targets,Z={e:L,target:X,subTargets:ne};if(this.fire(P,Z),X&&X.fire(P,Z),!ne)return X;for(var te=0;te<ne.length;te++)ne[te].fire(P,Z);return X},_handleEvent:function(P,L,X,ne){var Z=this._target,te=this.targets||[],ae={e:P,target:Z,subTargets:te,button:X||1,isClick:ne||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===L&&(ae.currentTarget=this.findTarget(P),ae.currentSubTargets=this.targets),this.fire("mouse:"+L,ae),Z&&Z.fire("mouse"+L,ae);for(var fe=0;fe<te.length;fe++)te[fe].fire("mouse"+L,ae)},_finalizeCurrentTransform:function(P){var L=this._currentTransform,X=L.target,ne={e:P,target:X,transform:L,action:L.action};X._scaling&&(X._scaling=!1),X.setCoords(),(L.actionPerformed||this.stateful&&X.hasStateChanged())&&this._fire("modified",ne)},_onMouseDownInDrawingMode:function(P){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(P).requestRenderAll();var L=this.getPointer(P);this.freeDrawingBrush.onMouseDown(L,{e:P,pointer:L}),this._handleEvent(P,"down")},_onMouseMoveInDrawingMode:function(P){if(this._isCurrentlyDrawing){var L=this.getPointer(P);this.freeDrawingBrush.onMouseMove(L,{e:P,pointer:L})}this.setCursor(this.freeDrawingCursor),this._handleEvent(P,"move")},_onMouseUpInDrawingMode:function(P){var L=this.getPointer(P);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:P,pointer:L}),this._handleEvent(P,"up")},__onMouseDown:function(P){this._cacheTransformEventData(P),this._handleEvent(P,"down:before");var L=this._target;if($(P,3))this.fireRightClick&&this._handleEvent(P,"down",3);else if($(P,2))this.fireMiddleClick&&this._handleEvent(P,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(P);else if(this._isMainEvent(P)&&!this._currentTransform){var X=this._pointer;this._previousPointer=X;var ne=this._shouldRender(L),Z=this._shouldGroup(P,L);if(this._shouldClearSelection(P,L)?this.discardActiveObject(P):Z&&(this._handleGrouping(P,L),L=this._activeObject),!this.selection||L&&(L.selectable||L.isEditing||L===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),L){var te=L===this._activeObject;L.selectable&&"down"===L.activeOn&&this.setActiveObject(L,P);var ae=L._findTargetCorner(this.getPointer(P,!0),ee.util.isTouchEvent(P));if(L.__corner=ae,L===this._activeObject&&(ae||!Z)){this._setupCurrentTransform(P,L,te);var fe=L.controls[ae],be=(X=this.getPointer(P),fe&&fe.getMouseDownHandler(P,L,fe));be&&be(P,this._currentTransform,X.x,X.y)}}this._handleEvent(P,"down"),(ne||Z)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(P){this._resetTransformEventData(),this._pointer=this.getPointer(P,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(P)||null},_beforeTransform:function(P){var L=this._currentTransform;this.stateful&&L.target.saveState(),this.fire("before:transform",{e:P,transform:L})},__onMouseMove:function(P){var L,X;if(this._handleEvent(P,"move:before"),this._cacheTransformEventData(P),this.isDrawingMode)this._onMouseMoveInDrawingMode(P);else if(this._isMainEvent(P)){var ne=this._groupSelector;ne?(ne.left=(X=this._absolutePointer).x-ne.ex,ne.top=X.y-ne.ey,this.renderTop()):this._currentTransform?this._transformObject(P):(L=this.findTarget(P)||null,this._setCursorFromEvent(P,L),this._fireOverOutEvents(L,P)),this._handleEvent(P,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(P,L){var X=this._hoveredTarget,ne=this._hoveredTargets,Z=this.targets,te=Math.max(ne.length,Z.length);this.fireSyntheticInOutEvents(P,L,{oldTarget:X,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var ae=0;ae<te;ae++)this.fireSyntheticInOutEvents(Z[ae],L,{oldTarget:ne[ae],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=P,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(P,L){var X=this._draggedoverTarget,ne=this._hoveredTargets,Z=this.targets,te=Math.max(ne.length,Z.length);this.fireSyntheticInOutEvents(P,L,{oldTarget:X,evtOut:"dragleave",evtIn:"dragenter"});for(var ae=0;ae<te;ae++)this.fireSyntheticInOutEvents(Z[ae],L,{oldTarget:ne[ae],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=P},fireSyntheticInOutEvents:function(P,L,X){var ne,Z,te,ae=X.oldTarget,fe=ae!==P,be=X.canvasEvtIn,Pe=X.canvasEvtOut;fe&&(ne={e:L,target:P,previousTarget:ae},Z={e:L,target:ae,nextTarget:P}),te=P&&fe,ae&&fe&&(Pe&&this.fire(Pe,Z),ae.fire(X.evtOut,Z)),te&&(be&&this.fire(be,ne),P.fire(X.evtIn,ne))},__onMouseWheel:function(P){this._cacheTransformEventData(P),this._handleEvent(P,"wheel"),this._resetTransformEventData()},_transformObject:function(P){var L=this.getPointer(P),X=this._currentTransform;X.reset=!1,X.shiftKey=P.shiftKey,X.altKey=P[this.centeredKey],this._performTransformAction(P,X,L),X.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(P,L,X){var te=L.action,ae=!1,fe=L.actionHandler;fe&&(ae=fe(P,L,X.x,X.y)),"drag"===te&&ae&&(L.target.isMoving=!0,this.setCursor(L.target.moveCursor||this.moveCursor)),L.actionPerformed=L.actionPerformed||ae},_fire:ee.controlsUtils.fireEvent,_setCursorFromEvent:function(P,L){if(!L)return this.setCursor(this.defaultCursor),!1;var X=L.hoverCursor||this.hoverCursor,ne=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,Z=(!ne||!ne.contains(L))&&L._findTargetCorner(this.getPointer(P,!0));Z?this.setCursor(this.getCornerCursor(Z,L,P)):(L.subTargetCheck&&this.targets.concat().reverse().map(function(te){X=te.hoverCursor||X}),this.setCursor(X))},getCornerCursor:function(P,L,X){var ne=L.controls[P];return ne.cursorStyleHandler(X,ne,L)}})}(),ie=Math.min,oe=Math.max,ee.util.object.extend(ee.Canvas.prototype,{_shouldGroup:function(V,F){var z=this._activeObject;return z&&this._isSelectionKeyPressed(V)&&F&&F.selectable&&this.selection&&(z!==F||"activeSelection"===z.type)&&!F.onSelect({e:V})},_handleGrouping:function(V,F){var z=this._activeObject;z.__corner||(F!==z||(F=this.findTarget(V,!0))&&F.selectable)&&(z&&"activeSelection"===z.type?this._updateActiveSelection(F,V):this._createActiveSelection(F,V))},_updateActiveSelection:function(V,F){var z=this._activeObject,$=z._objects.slice(0);z.contains(V)?(z.removeWithUpdate(V),this._hoveredTarget=V,this._hoveredTargets=this.targets.concat(),1===z.size()&&this._setActiveObject(z.item(0),F)):(z.addWithUpdate(V),this._hoveredTarget=z,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents($,F)},_createActiveSelection:function(V,F){var z=this.getActiveObjects(),$=this._createGroup(V);this._hoveredTarget=$,this._setActiveObject($,F),this._fireSelectionEvents(z,F)},_createGroup:function(V){var F=this._objects,z=F.indexOf(this._activeObject)<F.indexOf(V)?[this._activeObject,V]:[V,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new ee.ActiveSelection(z,{canvas:this})},_groupSelectedObjects:function(V){var F,z=this._collectObjects(V);1===z.length?this.setActiveObject(z[0],V):z.length>1&&(F=new ee.ActiveSelection(z.reverse(),{canvas:this}),this.setActiveObject(F,V))},_collectObjects:function(V){for(var F,z=[],$=this._groupSelector.ex,P=this._groupSelector.ey,L=$+this._groupSelector.left,X=P+this._groupSelector.top,ne=new ee.Point(ie($,L),ie(P,X)),Z=new ee.Point(oe($,L),oe(P,X)),te=!this.selectionFullyContained,ae=$===L&&P===X,fe=this._objects.length;fe--&&!((F=this._objects[fe])&&F.selectable&&F.visible&&(te&&F.intersectsWithRect(ne,Z,!0)||F.isContainedWithinRect(ne,Z,!0)||te&&F.containsPoint(ne,null,!0)||te&&F.containsPoint(Z,null,!0))&&(z.push(F),ae)););return z.length>1&&(z=z.filter(function(be){return!be.onSelect({e:V})})),z},_maybeGroupObjects:function(V){this.selection&&this._groupSelector&&this._groupSelectedObjects(V),this.setCursor(this.defaultCursor),this._groupSelector=null}}),ee.util.object.extend(ee.StaticCanvas.prototype,{toDataURL:function(V){V||(V={});var F=V.format||"png",z=V.quality||1,$=(V.multiplier||1)*(V.enableRetinaScaling?this.getRetinaScaling():1),P=this.toCanvasElement($,V);return ee.util.toDataURL(P,F,z)},toCanvasElement:function(V,F){var z=((F=F||{}).width||this.width)*(V=V||1),$=(F.height||this.height)*V,P=this.getZoom(),L=this.width,X=this.height,ne=P*V,Z=this.viewportTransform,fe=this.interactive,be=[ne,0,0,ne,(Z[4]-(F.left||0))*V,(Z[5]-(F.top||0))*V],Pe=this.enableRetinaScaling,De=ee.util.createCanvasElement(),Xe=this.contextTop;return De.width=z,De.height=$,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=be,this.width=z,this.height=$,this.calcViewportBoundaries(),this.renderCanvas(De.getContext("2d"),this._objects),this.viewportTransform=Z,this.width=L,this.height=X,this.calcViewportBoundaries(),this.interactive=fe,this.enableRetinaScaling=Pe,this.contextTop=Xe,De}}),ee.util.object.extend(ee.StaticCanvas.prototype,{loadFromJSON:function(V,F,z){if(V){var $="string"==typeof V?JSON.parse(V):ee.util.object.clone(V),P=this,L=$.clipPath,X=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete $.clipPath,this._enlivenObjects($.objects,function(ne){P.clear(),P._setBgOverlay($,function(){L?P._enlivenObjects([L],function(Z){P.clipPath=Z[0],P.__setupCanvas.call(P,$,ne,X,F)}):P.__setupCanvas.call(P,$,ne,X,F)})},z),this}},__setupCanvas:function(V,F,z,$){var P=this;F.forEach(function(L,X){P.insertAt(L,X)}),this.renderOnAddRemove=z,delete V.objects,delete V.backgroundImage,delete V.overlayImage,delete V.background,delete V.overlay,this._setOptions(V),this.renderAll(),$&&$()},_setBgOverlay:function(V,F){var z={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(V.backgroundImage||V.overlayImage||V.background||V.overlay){var $=function(){z.backgroundImage&&z.overlayImage&&z.backgroundColor&&z.overlayColor&&F&&F()};this.__setBgOverlay("backgroundImage",V.backgroundImage,z,$),this.__setBgOverlay("overlayImage",V.overlayImage,z,$),this.__setBgOverlay("backgroundColor",V.background,z,$),this.__setBgOverlay("overlayColor",V.overlay,z,$)}else F&&F()},__setBgOverlay:function(V,F,z,$){var P=this;if(!F)return z[V]=!0,void($&&$());"backgroundImage"===V||"overlayImage"===V?ee.util.enlivenObjects([F],function(L){P[V]=L[0],z[V]=!0,$&&$()}):this["set"+ee.util.string.capitalize(V,!0)](F,function(){z[V]=!0,$&&$()})},_enlivenObjects:function(V,F,z){V&&0!==V.length?ee.util.enlivenObjects(V,function($){F&&F($)},null,z):F&&F([])},_toDataURL:function(V,F){this.clone(function(z){F(z.toDataURL(V))})},_toDataURLWithMultiplier:function(V,F,z){this.clone(function($){z($.toDataURLWithMultiplier(V,F))})},clone:function(V,F){var z=JSON.stringify(this.toJSON(F));this.cloneWithoutData(function($){$.loadFromJSON(z,function(){V&&V($)})})},cloneWithoutData:function(V){var F=ee.util.createCanvasElement();F.width=this.width,F.height=this.height;var z=new ee.Canvas(F);this.backgroundImage?(z.setBackgroundImage(this.backgroundImage.src,function(){z.renderAll(),V&&V(z)}),z.backgroundImageOpacity=this.backgroundImageOpacity,z.backgroundImageStretch=this.backgroundImageStretch):V&&V(z)}}),function(V){var F=V.fabric||(V.fabric={}),z=F.util.object.extend,$=F.util.object.clone,P=F.util.toFixed,L=F.util.string.capitalize,X=F.util.degreesToRadians;F.Object||(F.Object=F.util.createClass(F.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!F.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(Z){Z&&this.setOptions(Z)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=F.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(Z){var te=F.perfLimitSizeTotal,ae=Z.width,fe=Z.height,be=F.maxCacheSideLimit,Pe=F.minCacheSideLimit;if(ae<=be&&fe<=be&&ae*fe<=te)return ae<Pe&&(Z.width=Pe),fe<Pe&&(Z.height=Pe),Z;var Xe=F.util.limitDimsByArea(ae/fe,te),Re=F.util.capValue,Ae=Re(Pe,Xe.x,be),de=Re(Pe,Xe.y,be);return ae>Ae&&(Z.zoomX/=ae/Ae,Z.width=Ae,Z.capped=!0),fe>de&&(Z.zoomY/=fe/de,Z.height=de,Z.capped=!0),Z},_getCacheCanvasDimensions:function(){var Z=this.getTotalObjectScaling(),te=this._getTransformedDimensions(0,0),ae=te.x*Z.scaleX/this.scaleX,fe=te.y*Z.scaleY/this.scaleY;return{width:ae+2,height:fe+2,zoomX:Z.scaleX,zoomY:Z.scaleY,x:ae,y:fe}},_updateCacheCanvas:function(){var Z=this.canvas;if(this.noScaleCache&&Z&&Z._currentTransform){var ae=Z._currentTransform.action;if(this===Z._currentTransform.target&&ae.slice&&"scale"===ae.slice(0,5))return!1}var fe,be,Pe=this._cacheCanvas,De=this._limitCacheSize(this._getCacheCanvasDimensions()),Xe=F.minCacheSideLimit,Re=De.width,Ae=De.height,de=De.zoomX,tt=De.zoomY,Ze=Re!==this.cacheWidth||Ae!==this.cacheHeight,Qe=Ze||this.zoomX!==de||this.zoomY!==tt,Je=0,st=0,mt=!1;if(Ze){var ut=this._cacheCanvas.width,Ke=this._cacheCanvas.height,nt=Re>ut||Ae>Ke;mt=nt||(Re<.9*ut||Ae<.9*Ke)&&ut>Xe&&Ke>Xe,nt&&!De.capped&&(Re>Xe||Ae>Xe)&&(Je=.1*Re,st=.1*Ae)}return this instanceof F.Text&&this.path&&(Qe=!0,mt=!0,Je+=this.getHeightOfLine(0)*this.zoomX,st+=this.getHeightOfLine(0)*this.zoomY),!!Qe&&(mt?(Pe.width=Math.ceil(Re+Je),Pe.height=Math.ceil(Ae+st)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,Pe.width,Pe.height)),fe=De.x/2,be=De.y/2,this.cacheTranslationX=Math.round(Pe.width/2-fe)+fe,this.cacheTranslationY=Math.round(Pe.height/2-be)+be,this.cacheWidth=Re,this.cacheHeight=Ae,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(de,tt),this.zoomX=de,this.zoomY=tt,!0)},setOptions:function(Z){this._setOptions(Z),this._initGradient(Z.fill,"fill"),this._initGradient(Z.stroke,"stroke"),this._initPattern(Z.fill,"fill"),this._initPattern(Z.stroke,"stroke")},transform:function(Z){var ae=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&Z===this.canvas.contextTop));Z.transform(ae[0],ae[1],ae[2],ae[3],ae[4],ae[5])},toObject:function(Z){var te=F.Object.NUM_FRACTION_DIGITS,ae={type:this.type,version:F.version,originX:this.originX,originY:this.originY,left:P(this.left,te),top:P(this.top,te),width:P(this.width,te),height:P(this.height,te),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:P(this.strokeWidth,te),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:P(this.strokeMiterLimit,te),scaleX:P(this.scaleX,te),scaleY:P(this.scaleY,te),angle:P(this.angle,te),flipX:this.flipX,flipY:this.flipY,opacity:P(this.opacity,te),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:P(this.skewX,te),skewY:P(this.skewY,te)};return this.clipPath&&!this.clipPath.excludeFromExport&&(ae.clipPath=this.clipPath.toObject(Z),ae.clipPath.inverted=this.clipPath.inverted,ae.clipPath.absolutePositioned=this.clipPath.absolutePositioned),F.util.populateWithProperties(this,ae,Z),this.includeDefaultValues||(ae=this._removeDefaultValues(ae)),ae},toDatalessObject:function(Z){return this.toObject(Z)},_removeDefaultValues:function(Z){var te=F.util.getKlass(Z.type).prototype;return te.stateProperties.forEach(function(ae){"left"!==ae&&"top"!==ae&&(Z[ae]===te[ae]&&delete Z[ae],Array.isArray(Z[ae])&&Array.isArray(te[ae])&&0===Z[ae].length&&0===te[ae].length&&delete Z[ae])}),Z},toString:function(){return"#<fabric."+L(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var Z=F.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(Z.scaleX),scaleY:Math.abs(Z.scaleY)}},getTotalObjectScaling:function(){var Z=this.getObjectScaling(),te=Z.scaleX,ae=Z.scaleY;if(this.canvas){var fe=this.canvas.getZoom(),be=this.canvas.getRetinaScaling();te*=fe*be,ae*=fe*be}return{scaleX:te,scaleY:ae}},getObjectOpacity:function(){var Z=this.opacity;return this.group&&(Z*=this.group.getObjectOpacity()),Z},_set:function(Z,te){var fe=this[Z]!==te,be=!1;return("scaleX"===Z||"scaleY"===Z)&&(te=this._constrainScale(te)),"scaleX"===Z&&te<0?(this.flipX=!this.flipX,te*=-1):"scaleY"===Z&&te<0?(this.flipY=!this.flipY,te*=-1):"shadow"!==Z||!te||te instanceof F.Shadow?"dirty"===Z&&this.group&&this.group.set("dirty",te):te=new F.Shadow(te),this[Z]=te,fe&&(be=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(Z)>-1?(this.dirty=!0,be&&this.group.set("dirty",!0)):be&&this.stateProperties.indexOf(Z)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:F.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(Z){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(Z.save(),this._setupCompositeOperation(Z),this.drawSelectionBackground(Z),this.transform(Z),this._setOpacity(Z),this._setShadow(Z,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(Z)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(Z),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),Z.restore())},renderCache:function(Z){Z=Z||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,Z.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(Z,te){if(Z.save(),Z.globalCompositeOperation=te.inverted?"destination-out":"destination-in",te.absolutePositioned){var ae=F.util.invertTransform(this.calcTransformMatrix());Z.transform(ae[0],ae[1],ae[2],ae[3],ae[4],ae[5])}te.transform(Z),Z.scale(1/te.zoomX,1/te.zoomY),Z.drawImage(te._cacheCanvas,-te.cacheTranslationX,-te.cacheTranslationY),Z.restore()},drawObject:function(Z,te){var ae=this.fill,fe=this.stroke;te?(this.fill="black",this.stroke="",this._setClippingProperties(Z)):this._renderBackground(Z),this._render(Z),this._drawClipPath(Z,this.clipPath),this.fill=ae,this.stroke=fe},_drawClipPath:function(Z,te){te&&(te.canvas=this.canvas,te.shouldCache(),te._transformDone=!0,te.renderCache({forClipping:!0}),this.drawClipPathOnCache(Z,te))},drawCacheOnCanvas:function(Z){Z.scale(1/this.zoomX,1/this.zoomY),Z.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(Z){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!Z&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!Z){var te=this.cacheWidth/this.zoomX,ae=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-te/2,-ae/2,te,ae)}return!0}return!1},_renderBackground:function(Z){if(this.backgroundColor){var te=this._getNonTransformedDimensions();Z.fillStyle=this.backgroundColor,Z.fillRect(-te.x/2,-te.y/2,te.x,te.y),this._removeShadow(Z)}},_setOpacity:function(Z){this.group&&!this.group._transformDone?Z.globalAlpha=this.getObjectOpacity():Z.globalAlpha*=this.opacity},_setStrokeStyles:function(Z,te){var ae=te.stroke;ae&&(Z.lineWidth=te.strokeWidth,Z.lineCap=te.strokeLineCap,Z.lineDashOffset=te.strokeDashOffset,Z.lineJoin=te.strokeLineJoin,Z.miterLimit=te.strokeMiterLimit,ae.toLive?"percentage"===ae.gradientUnits||ae.gradientTransform||ae.patternTransform?this._applyPatternForTransformedGradient(Z,ae):(Z.strokeStyle=ae.toLive(Z,this),this._applyPatternGradientTransform(Z,ae)):Z.strokeStyle=te.stroke)},_setFillStyles:function(Z,te){var ae=te.fill;ae&&(ae.toLive?(Z.fillStyle=ae.toLive(Z,this),this._applyPatternGradientTransform(Z,te.fill)):Z.fillStyle=ae)},_setClippingProperties:function(Z){Z.globalAlpha=1,Z.strokeStyle="transparent",Z.fillStyle="#000000"},_setLineDash:function(Z,te){te&&0!==te.length&&(1&te.length&&te.push.apply(te,te),Z.setLineDash(te))},_renderControls:function(Z,te){var ae,fe,be,Pe=this.getViewportTransform(),De=this.calcTransformMatrix();fe=void 0!==(te=te||{}).hasBorders?te.hasBorders:this.hasBorders,be=void 0!==te.hasControls?te.hasControls:this.hasControls,De=F.util.multiplyTransformMatrices(Pe,De),ae=F.util.qrDecompose(De),Z.save(),Z.translate(ae.translateX,ae.translateY),Z.lineWidth=1*this.borderScaleFactor,this.group||(Z.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(ae.angle-=180),Z.rotate(X(this.group?ae.angle:this.angle)),te.forActiveSelection||this.group?fe&&this.drawBordersInGroup(Z,ae,te):fe&&this.drawBorders(Z,te),be&&this.drawControls(Z,te),Z.restore()},_setShadow:function(Z){if(this.shadow){var te,ae=this.shadow,fe=this.canvas,be=fe&&fe.viewportTransform[0]||1,Pe=fe&&fe.viewportTransform[3]||1;te=ae.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),fe&&fe._isRetinaScaling()&&(be*=F.devicePixelRatio,Pe*=F.devicePixelRatio),Z.shadowColor=ae.color,Z.shadowBlur=ae.blur*F.browserShadowBlurConstant*(be+Pe)*(te.scaleX+te.scaleY)/4,Z.shadowOffsetX=ae.offsetX*be*te.scaleX,Z.shadowOffsetY=ae.offsetY*Pe*te.scaleY}},_removeShadow:function(Z){this.shadow&&(Z.shadowColor="",Z.shadowBlur=Z.shadowOffsetX=Z.shadowOffsetY=0)},_applyPatternGradientTransform:function(Z,te){if(!te||!te.toLive)return{offsetX:0,offsetY:0};var ae=te.gradientTransform||te.patternTransform,fe=-this.width/2+te.offsetX||0,be=-this.height/2+te.offsetY||0;return"percentage"===te.gradientUnits?Z.transform(this.width,0,0,this.height,fe,be):Z.transform(1,0,0,1,fe,be),ae&&Z.transform(ae[0],ae[1],ae[2],ae[3],ae[4],ae[5]),{offsetX:fe,offsetY:be}},_renderPaintInOrder:function(Z){"stroke"===this.paintFirst?(this._renderStroke(Z),this._renderFill(Z)):(this._renderFill(Z),this._renderStroke(Z))},_render:function(){},_renderFill:function(Z){this.fill&&(Z.save(),this._setFillStyles(Z,this),"evenodd"===this.fillRule?Z.fill("evenodd"):Z.fill(),Z.restore())},_renderStroke:function(Z){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(Z),Z.save(),this.strokeUniform&&this.group){var te=this.getObjectScaling();Z.scale(1/te.scaleX,1/te.scaleY)}else this.strokeUniform&&Z.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(Z,this.strokeDashArray),this._setStrokeStyles(Z,this),Z.stroke(),Z.restore()}},_applyPatternForTransformedGradient:function(Z,te){var ae,fe=this._limitCacheSize(this._getCacheCanvasDimensions()),be=F.util.createCanvasElement(),Pe=this.canvas.getRetinaScaling(),De=fe.x/this.scaleX/Pe,Xe=fe.y/this.scaleY/Pe;be.width=De,be.height=Xe,(ae=be.getContext("2d")).beginPath(),ae.moveTo(0,0),ae.lineTo(De,0),ae.lineTo(De,Xe),ae.lineTo(0,Xe),ae.closePath(),ae.translate(De/2,Xe/2),ae.scale(fe.zoomX/this.scaleX/Pe,fe.zoomY/this.scaleY/Pe),this._applyPatternGradientTransform(ae,te),ae.fillStyle=te.toLive(Z),ae.fill(),Z.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),Z.scale(Pe*this.scaleX/fe.zoomX,Pe*this.scaleY/fe.zoomY),Z.strokeStyle=ae.createPattern(be,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var Z=F.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",Z.scaleX),this.set("scaleY",Z.scaleY),this.angle=Z.angle,this.skewX=Z.skewX,this.skewY=0}},_removeTransformMatrix:function(Z){var te=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),te=F.util.transformPoint(te,this.transformMatrix)),this.transformMatrix=null,Z&&(this.scaleX*=Z.scaleX,this.scaleY*=Z.scaleY,this.cropX=Z.cropX,this.cropY=Z.cropY,te.x+=Z.offsetLeft,te.y+=Z.offsetTop,this.width=Z.width,this.height=Z.height),this.setPositionByOrigin(te,"center","center")},clone:function(Z,te){var ae=this.toObject(te);this.constructor.fromObject?this.constructor.fromObject(ae,Z):F.Object._fromObject("Object",ae,Z)},cloneAsImage:function(Z,te){var ae=this.toCanvasElement(te);return Z&&Z(new F.Image(ae)),this},toCanvasElement:function(Z){Z||(Z={});var te=F.util,ae=te.saveObjectTransform(this),fe=this.group,be=this.shadow,Pe=Math.abs,De=(Z.multiplier||1)*(Z.enableRetinaScaling?F.devicePixelRatio:1);delete this.group,Z.withoutTransform&&te.resetObjectTransform(this),Z.withoutShadow&&(this.shadow=null);var Xe,Re,de,tt=F.util.createCanvasElement(),Ze=this.getBoundingRect(!0,!0),et=this.shadow,Qe={x:0,y:0};et&&(Re=et.blur,Xe=et.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),Qe.x=2*Math.round(Pe(et.offsetX)+Re)*Pe(Xe.scaleX),Qe.y=2*Math.round(Pe(et.offsetY)+Re)*Pe(Xe.scaleY)),de=Ze.height+Qe.y,tt.width=Math.ceil(Ze.width+Qe.x),tt.height=Math.ceil(de);var Je=new F.StaticCanvas(tt,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===Z.format&&(Je.backgroundColor="#fff"),this.setPositionByOrigin(new F.Point(Je.width/2,Je.height/2),"center","center");var st=this.canvas;Je.add(this);var mt=Je.toCanvasElement(De||1,Z);return this.shadow=be,this.set("canvas",st),fe&&(this.group=fe),this.set(ae).setCoords(),Je._objects=[],Je.dispose(),Je=null,mt},toDataURL:function(Z){return Z||(Z={}),F.util.toDataURL(this.toCanvasElement(Z),Z.format||"png",Z.quality||1)},isType:function(Z){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===Z},complexity:function(){return 1},toJSON:function(Z){return this.toObject(Z)},rotate:function(Z){var te=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return te&&this._setOriginToCenter(),this.set("angle",Z),te&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(Z,te){te=te||this.canvas.getPointer(Z);var ae=new F.Point(te.x,te.y),fe=this._getLeftTopCoords();return this.angle&&(ae=F.util.rotatePoint(ae,fe,X(-this.angle))),{x:ae.x-fe.x,y:ae.y-fe.y}},_setupCompositeOperation:function(Z){this.globalCompositeOperation&&(Z.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){F.runningAnimations&&F.runningAnimations.cancelByTarget(this)}}),F.util.createAccessors&&F.util.createAccessors(F.Object),z(F.Object.prototype,F.Observable),F.Object.NUM_FRACTION_DIGITS=2,F.Object.ENLIVEN_PROPS=["clipPath"],F.Object._fromObject=function(Z,te,ae,fe){var be=F[Z];te=$(te,!0),F.util.enlivenPatterns([te.fill,te.stroke],function(Pe){void 0!==Pe[0]&&(te.fill=Pe[0]),void 0!==Pe[1]&&(te.stroke=Pe[1]),F.util.enlivenObjectEnlivables(te,te,function(){var De=fe?new be(te[fe],te):new be(te);ae&&ae(De)})})},F.Object.__uid=0)}(l),le=ee.util.degreesToRadians,he={left:-.5,center:0,right:.5},_e={top:-.5,center:0,bottom:.5},ee.util.object.extend(ee.Object.prototype,{translateToGivenOrigin:function(V,F,z,$,P){var L,X,ne,Z=V.x,te=V.y;return"string"==typeof F?F=he[F]:F-=.5,"string"==typeof $?$=he[$]:$-=.5,"string"==typeof z?z=_e[z]:z-=.5,"string"==typeof P?P=_e[P]:P-=.5,X=P-z,((L=$-F)||X)&&(ne=this._getTransformedDimensions(),Z=V.x+L*ne.x,te=V.y+X*ne.y),new ee.Point(Z,te)},translateToCenterPoint:function(V,F,z){var $=this.translateToGivenOrigin(V,F,z,"center","center");return this.angle?ee.util.rotatePoint($,V,le(this.angle)):$},translateToOriginPoint:function(V,F,z){var $=this.translateToGivenOrigin(V,"center","center",F,z);return this.angle?ee.util.rotatePoint($,V,le(this.angle)):$},getCenterPoint:function(){var V=new ee.Point(this.left,this.top);return this.translateToCenterPoint(V,this.originX,this.originY)},getPointByOrigin:function(V,F){var z=this.getCenterPoint();return this.translateToOriginPoint(z,V,F)},toLocalPoint:function(V,F,z){var $,P,L=this.getCenterPoint();return $=void 0!==F&&void 0!==z?this.translateToGivenOrigin(L,"center","center",F,z):new ee.Point(this.left,this.top),P=new ee.Point(V.x,V.y),this.angle&&(P=ee.util.rotatePoint(P,L,-le(this.angle))),P.subtractEquals($)},setPositionByOrigin:function(V,F,z){var $=this.translateToCenterPoint(V,F,z),P=this.translateToOriginPoint($,this.originX,this.originY);this.set("left",P.x),this.set("top",P.y)},adjustPosition:function(V){var F,z,$=le(this.angle),P=this.getScaledWidth(),L=ee.util.cos($)*P,X=ee.util.sin($)*P;this.left+=L*((z="string"==typeof V?he[V]:V-.5)-(F="string"==typeof this.originX?he[this.originX]:this.originX-.5)),this.top+=X*(z-F),this.setCoords(),this.originX=V},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var V=this.getCenterPoint();this.originX="center",this.originY="center",this.left=V.x,this.top=V.y},_resetOrigin:function(){var V=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=V.x,this.top=V.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var V=ee.util,F=V.degreesToRadians,z=V.multiplyTransformMatrices,$=V.transformPoint;V.object.extend(ee.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(P,L){return L?P?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),P?this.aCoords:this.lineCoords)},getCoords:function(P,L){return X=this._getCoords(P,L),[new ee.Point(X.tl.x,X.tl.y),new ee.Point(X.tr.x,X.tr.y),new ee.Point(X.br.x,X.br.y),new ee.Point(X.bl.x,X.bl.y)];var X},intersectsWithRect:function(P,L,X,ne){var Z=this.getCoords(X,ne);return"Intersection"===ee.Intersection.intersectPolygonRectangle(Z,P,L).status},intersectsWithObject:function(P,L,X){return"Intersection"===ee.Intersection.intersectPolygonPolygon(this.getCoords(L,X),P.getCoords(L,X)).status||P.isContainedWithinObject(this,L,X)||this.isContainedWithinObject(P,L,X)},isContainedWithinObject:function(P,L,X){for(var ne=this.getCoords(L,X),te=0,ae=P._getImageLines(L?P.aCoords:P.lineCoords);te<4;te++)if(!P.containsPoint(ne[te],ae))return!1;return!0},isContainedWithinRect:function(P,L,X,ne){var Z=this.getBoundingRect(X,ne);return Z.left>=P.x&&Z.left+Z.width<=L.x&&Z.top>=P.y&&Z.top+Z.height<=L.y},containsPoint:function(P,L,X,ne){var Z=this._getCoords(X,ne),te=(L=L||this._getImageLines(Z),this._findCrossPoints(P,L));return 0!==te&&te%2==1},isOnScreen:function(P){if(!this.canvas)return!1;var L=this.canvas.vptCoords.tl,X=this.canvas.vptCoords.br;return!!this.getCoords(!0,P).some(function(ne){return ne.x<=X.x&&ne.x>=L.x&&ne.y<=X.y&&ne.y>=L.y})||!!this.intersectsWithRect(L,X,!0,P)||this._containsCenterOfCanvas(L,X,P)},_containsCenterOfCanvas:function(P,L,X){return!!this.containsPoint({x:(P.x+L.x)/2,y:(P.y+L.y)/2},null,!0,X)},isPartiallyOnScreen:function(P){if(!this.canvas)return!1;var L=this.canvas.vptCoords.tl,X=this.canvas.vptCoords.br;return!!this.intersectsWithRect(L,X,!0,P)||this.getCoords(!0,P).every(function(ne){return(ne.x>=X.x||ne.x<=L.x)&&(ne.y>=X.y||ne.y<=L.y)})&&this._containsCenterOfCanvas(L,X,P)},_getImageLines:function(P){return{topline:{o:P.tl,d:P.tr},rightline:{o:P.tr,d:P.br},bottomline:{o:P.br,d:P.bl},leftline:{o:P.bl,d:P.tl}}},_findCrossPoints:function(P,L){var X,ne,Z,te=0;for(var ae in L)if(!((Z=L[ae]).o.y<P.y&&Z.d.y<P.y||Z.o.y>=P.y&&Z.d.y>=P.y||(Z.o.x===Z.d.x&&Z.o.x>=P.x?ne=Z.o.x:(X=(Z.d.y-Z.o.y)/(Z.d.x-Z.o.x),ne=-(P.y-0*P.x-(Z.o.y-X*Z.o.x))/(0-X)),ne>=P.x&&(te+=1),2!==te)))break;return te},getBoundingRect:function(P,L){var X=this.getCoords(P,L);return V.makeBoundingBoxFromPoints(X)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(P){return Math.abs(P)<this.minScaleLimit?P<0?-this.minScaleLimit:this.minScaleLimit:0===P?1e-4:P},scale:function(P){return this._set("scaleX",P),this._set("scaleY",P),this.setCoords()},scaleToWidth:function(P,L){var X=this.getBoundingRect(L).width/this.getScaledWidth();return this.scale(P/this.width/X)},scaleToHeight:function(P,L){var X=this.getBoundingRect(L).height/this.getScaledHeight();return this.scale(P/this.height/X)},calcLineCoords:function(){var P=this.getViewportTransform(),L=this.padding,X=F(this.angle),ne=V.cos(X)*L,Z=V.sin(X)*L,te=ne+Z,ae=ne-Z,fe=this.calcACoords(),be={tl:$(fe.tl,P),tr:$(fe.tr,P),bl:$(fe.bl,P),br:$(fe.br,P)};return L&&(be.tl.x-=ae,be.tl.y-=te,be.tr.x+=te,be.tr.y-=ae,be.bl.x-=te,be.bl.y+=ae,be.br.x+=ae,be.br.y+=te),be},calcOCoords:function(){var P=this._calcRotateMatrix(),L=this._calcTranslateMatrix(),X=this.getViewportTransform(),ne=z(X,L),Z=z(ne,P),te=(Z=z(Z,[1/X[0],0,0,1/X[3],0,0]),this._calculateCurrentDimensions()),ae={};return this.forEachControl(function(fe,be,Pe){ae[be]=fe.positionHandler(te,Z,Pe)}),ae},calcACoords:function(){var P=this._calcRotateMatrix(),L=this._calcTranslateMatrix(),X=z(L,P),ne=this._getTransformedDimensions(),Z=ne.x/2,te=ne.y/2;return{tl:$({x:-Z,y:-te},X),tr:$({x:Z,y:-te},X),bl:$({x:-Z,y:te},X),br:$({x:Z,y:te},X)}},setCoords:function(P){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),P||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return V.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var P=this.getCenterPoint();return[1,0,0,1,P.x,P.y]},transformMatrixKey:function(P){var L="_",X="";return!P&&this.group&&(X=this.group.transformMatrixKey(P)+L),X+this.top+L+this.left+L+this.scaleX+L+this.scaleY+L+this.skewX+L+this.skewY+L+this.angle+L+this.originX+L+this.originY+L+this.width+L+this.height+L+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(P){var L=this.calcOwnMatrix();if(P||!this.group)return L;var X=this.transformMatrixKey(P),ne=this.matrixCache||(this.matrixCache={});return ne.key===X?ne.value:(this.group&&(L=z(this.group.calcTransformMatrix(!1),L)),ne.key=X,ne.value=L,L)},calcOwnMatrix:function(){var P=this.transformMatrixKey(!0),L=this.ownMatrixCache||(this.ownMatrixCache={});if(L.key===P)return L.value;var X=this._calcTranslateMatrix(),ne={angle:this.angle,translateX:X[4],translateY:X[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return L.key=P,L.value=V.composeMatrix(ne),L.value},_getNonTransformedDimensions:function(){var P=this.strokeWidth;return{x:this.width+P,y:this.height+P}},_getTransformedDimensions:function(P,L){void 0===P&&(P=this.skewX),void 0===L&&(L=this.skewY);var X,ne,Z,te=0===P&&0===L;if(this.strokeUniform?(ne=this.width,Z=this.height):(ne=(X=this._getNonTransformedDimensions()).x,Z=X.y),te)return this._finalizeDimensions(ne*this.scaleX,Z*this.scaleY);var ae=V.sizeAfterTransform(ne,Z,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:P,skewY:L});return this._finalizeDimensions(ae.x,ae.y)},_finalizeDimensions:function(P,L){return this.strokeUniform?{x:P+this.strokeWidth,y:L+this.strokeWidth}:{x:P,y:L}},_calculateCurrentDimensions:function(){var P=this.getViewportTransform(),L=this._getTransformedDimensions();return $(L,P,!0).scalarAdd(2*this.padding)}})}(),ee.util.object.extend(ee.Object.prototype,{sendToBack:function(){return this.group?ee.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?ee.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(V){return this.group?ee.StaticCanvas.prototype.sendBackwards.call(this.group,this,V):this.canvas&&this.canvas.sendBackwards(this,V),this},bringForward:function(V){return this.group?ee.StaticCanvas.prototype.bringForward.call(this.group,this,V):this.canvas&&this.canvas.bringForward(this,V),this},moveTo:function(V){return this.group&&"activeSelection"!==this.group.type?ee.StaticCanvas.prototype.moveTo.call(this.group,this,V):this.canvas&&this.canvas.moveTo(this,V),this}}),function(){function V(z,$){if($){if($.toLive)return z+": url(#SVGID_"+$.id+"); ";var P=new ee.Color($),L=z+": "+P.toRgb()+"; ",X=P.getAlpha();return 1!==X&&(L+=z+"-opacity: "+X.toString()+"; "),L}return z+": none; "}var F=ee.util.toFixed;ee.util.object.extend(ee.Object.prototype,{getSvgStyles:function(z){var $=this.fillRule?this.fillRule:"nonzero",P=this.strokeWidth?this.strokeWidth:"0",L=this.strokeDashArray?this.strokeDashArray.join(" "):"none",X=this.strokeDashOffset?this.strokeDashOffset:"0",ne=this.strokeLineCap?this.strokeLineCap:"butt",Z=this.strokeLineJoin?this.strokeLineJoin:"miter",te=this.strokeMiterLimit?this.strokeMiterLimit:"4",ae=void 0!==this.opacity?this.opacity:"1",fe=this.visible?"":" visibility: hidden;",be=z?"":this.getSvgFilter(),Pe=V("fill",this.fill);return[V("stroke",this.stroke),"stroke-width: ",P,"; ","stroke-dasharray: ",L,"; ","stroke-linecap: ",ne,"; ","stroke-dashoffset: ",X,"; ","stroke-linejoin: ",Z,"; ","stroke-miterlimit: ",te,"; ",Pe,"fill-rule: ",$,"; ","opacity: ",ae,";",be,fe].join("")},getSvgSpanStyles:function(z,$){var P="; ",L=z.fontFamily?"font-family: "+(-1===z.fontFamily.indexOf("'")&&-1===z.fontFamily.indexOf('"')?"'"+z.fontFamily+"'":z.fontFamily)+P:"",X=z.strokeWidth?"stroke-width: "+z.strokeWidth+P:"",ne=z.fontSize?"font-size: "+z.fontSize+"px"+P:"",Z=z.fontStyle?"font-style: "+z.fontStyle+P:"",te=z.fontWeight?"font-weight: "+z.fontWeight+P:"",ae=z.fill?V("fill",z.fill):"",fe=z.stroke?V("stroke",z.stroke):"",be=this.getSvgTextDecoration(z);return be&&(be="text-decoration: "+be+P),[fe,X,L,ne,Z,te,be,ae,z.deltaY?"baseline-shift: "+-z.deltaY+"; ":"",$?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(z){return["overline","underline","line-through"].filter(function($){return z[$.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(z,$){var P=z?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+ee.util.matrixToSVG(P)+($||"")+'" '},_setSVGBg:function(z){if(this.backgroundColor){var $=ee.Object.NUM_FRACTION_DIGITS;z.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',F(-this.width/2,$),'" y="',F(-this.height/2,$),'" width="',F(this.width,$),'" height="',F(this.height,$),'"></rect>\n')}},toSVG:function(z){return this._createBaseSVGMarkup(this._toSVG(z),{reviver:z})},toClipPathSVG:function(z){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(z),{reviver:z})},_createBaseClipPathSVGMarkup:function(z,$){var P=($=$||{}).reviver,X=[this.getSvgTransform(!0,$.additionalTransform||""),this.getSvgCommons()].join(""),ne=z.indexOf("COMMON_PARTS");return z[ne]=X,P?P(z.join("")):z.join("")},_createBaseSVGMarkup:function(z,$){var P,L,X=($=$||{}).noStyle,ne=$.reviver,Z=X?"":'style="'+this.getSvgStyles()+'" ',te=$.withShadow?'style="'+this.getSvgFilter()+'" ':"",ae=this.clipPath,fe=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",be=ae&&ae.absolutePositioned,Pe=this.stroke,De=this.fill,Xe=this.shadow,Re=[],Ae=z.indexOf("COMMON_PARTS"),de=$.additionalTransform;return ae&&(ae.clipPathId="CLIPPATH_"+ee.Object.__uid++,L='<clipPath id="'+ae.clipPathId+'" >\n'+ae.toClipPathSVG(ne)+"</clipPath>\n"),be&&Re.push("<g ",te,this.getSvgCommons()," >\n"),Re.push("<g ",this.getSvgTransform(!1),be?"":te+this.getSvgCommons()," >\n"),P=[Z,fe,X?"":this.addPaintOrder()," ",de?'transform="'+de+'" ':""].join(""),z[Ae]=P,De&&De.toLive&&Re.push(De.toSVG(this)),Pe&&Pe.toLive&&Re.push(Pe.toSVG(this)),Xe&&Re.push(Xe.toSVG(this)),ae&&Re.push(L),Re.push(z.join("")),Re.push("</g>\n"),be&&Re.push("</g>\n"),ne?ne(Re.join("")):Re.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var V=ee.util.object.extend,F="stateProperties";function z(P,L,X){var ne={};X.forEach(function(Z){ne[Z]=P[Z]}),V(P[L],ne,!0)}function $(P,L,X){if(P===L)return!0;if(Array.isArray(P)){if(!Array.isArray(L)||P.length!==L.length)return!1;for(var ne=0,Z=P.length;ne<Z;ne++)if(!$(P[ne],L[ne]))return!1;return!0}if(P&&"object"==typeof P){var te,ae=Object.keys(P);if(!L||"object"!=typeof L||!X&&ae.length!==Object.keys(L).length)return!1;for(ne=0,Z=ae.length;ne<Z;ne++)if("canvas"!==(te=ae[ne])&&"group"!==te&&!$(P[te],L[te]))return!1;return!0}}ee.util.object.extend(ee.Object.prototype,{hasStateChanged:function(P){var L="_"+(P=P||F);return Object.keys(this[L]).length<this[P].length||!$(this[L],this,!0)},saveState:function(P){var L=P&&P.propertySet||F,X="_"+L;return this[X]?(z(this,X,this[L]),P&&P.stateProperties&&z(this,X,P.stateProperties),this):this.setupState(P)},setupState:function(P){var L=(P=P||{}).propertySet||F;return P.propertySet=L,this["_"+L]={},this.saveState(P),this}})}(),function(){var V=ee.util.degreesToRadians;ee.util.object.extend(ee.Object.prototype,{_findTargetCorner:function(F,z){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var $,P,L,X=F.x,ne=F.y,Z=Object.keys(this.oCoords),te=Z.length-1;for(this.__corner=0;te>=0;te--)if(this.isControlVisible(L=Z[te])&&(P=this._getImageLines(z?this.oCoords[L].touchCorner:this.oCoords[L].corner),0!==($=this._findCrossPoints({x:X,y:ne},P))&&$%2==1))return this.__corner=L,L;return!1},forEachControl:function(F){for(var z in this.controls)F(this.controls[z],z,this)},_setCornerCoords:function(){var F=this.oCoords;for(var z in F){var $=this.controls[z];F[z].corner=$.calcCornerCoords(this.angle,this.cornerSize,F[z].x,F[z].y,!1),F[z].touchCorner=$.calcCornerCoords(this.angle,this.touchCornerSize,F[z].x,F[z].y,!0)}},drawSelectionBackground:function(F){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;F.save();var z=this.getCenterPoint(),$=this._calculateCurrentDimensions(),P=this.canvas.viewportTransform;return F.translate(z.x,z.y),F.scale(1/P[0],1/P[3]),F.rotate(V(this.angle)),F.fillStyle=this.selectionBackgroundColor,F.fillRect(-$.x/2,-$.y/2,$.x,$.y),F.restore(),this},drawBorders:function(F,z){z=z||{};var $=this._calculateCurrentDimensions(),P=this.borderScaleFactor,L=$.x+P,X=$.y+P,ne=void 0!==z.hasControls?z.hasControls:this.hasControls,Z=!1;return F.save(),F.strokeStyle=z.borderColor||this.borderColor,this._setLineDash(F,z.borderDashArray||this.borderDashArray),F.strokeRect(-L/2,-X/2,L,X),ne&&(F.beginPath(),this.forEachControl(function(te,ae,fe){te.withConnection&&te.getVisibility(fe,ae)&&(Z=!0,F.moveTo(te.x*L,te.y*X),F.lineTo(te.x*L+te.offsetX,te.y*X+te.offsetY))}),Z&&F.stroke()),F.restore(),this},drawBordersInGroup:function(F,z,$){$=$||{};var P=ee.util.sizeAfterTransform(this.width,this.height,z),L=this.strokeWidth,X=this.strokeUniform,ne=this.borderScaleFactor,Z=P.x+L*(X?this.canvas.getZoom():z.scaleX)+ne,te=P.y+L*(X?this.canvas.getZoom():z.scaleY)+ne;return F.save(),this._setLineDash(F,$.borderDashArray||this.borderDashArray),F.strokeStyle=$.borderColor||this.borderColor,F.strokeRect(-Z/2,-te/2,Z,te),F.restore(),this},drawControls:function(F,z){z=z||{},F.save();var $,P,L=this.canvas.getRetinaScaling();return F.setTransform(L,0,0,L,0,0),F.strokeStyle=F.fillStyle=z.cornerColor||this.cornerColor,this.transparentCorners||(F.strokeStyle=z.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(F,z.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&($=this.group.calcTransformMatrix()),this.forEachControl(function(X,ne,Z){P=Z.oCoords[ne],X.getVisibility(Z,ne)&&($&&(P=ee.util.transformPoint(P,$)),X.render(F,P.x,P.y,z,Z))}),F.restore(),this},isControlVisible:function(F){return this.controls[F]&&this.controls[F].getVisibility(this,F)},setControlVisible:function(F,z){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[F]=z,this},setControlsVisibility:function(F){for(var z in F||(F={}),F)this.setControlVisible(z,F[z]);return this},onDeselect:function(){},onSelect:function(){}})}(),ee.util.object.extend(ee.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(V,F){var z=function(){},$=(F=F||{}).onComplete||z,P=F.onChange||z,L=this;return ee.util.animate({target:this,startValue:V.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(X){V.set("left",X),L.requestRenderAll(),P()},onComplete:function(){V.setCoords(),$()}})},fxCenterObjectV:function(V,F){var z=function(){},$=(F=F||{}).onComplete||z,P=F.onChange||z,L=this;return ee.util.animate({target:this,startValue:V.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(X){V.set("top",X),L.requestRenderAll(),P()},onComplete:function(){V.setCoords(),$()}})},fxRemove:function(V,F){var z=function(){},$=(F=F||{}).onComplete||z,P=F.onChange||z,L=this;return ee.util.animate({target:this,startValue:V.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(X){V.set("opacity",X),L.requestRenderAll(),P()},onComplete:function(){L.remove(V),$()}})}}),ee.util.object.extend(ee.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var V,z=[],$=[];for(V in arguments[0])z.push(V);for(var P=0,L=z.length;P<L;P++)$.push(this._animate(V=z[P],arguments[0][V],arguments[1],P!==L-1));return $}return this._animate.apply(this,arguments)},_animate:function(V,F,z,$){var P,L=this;F=F.toString(),z=z?ee.util.object.clone(z):{},~V.indexOf(".")&&(P=V.split("."));var X=L.colorProperties.indexOf(V)>-1||P&&L.colorProperties.indexOf(P[1])>-1,ne=P?this.get(P[0])[P[1]]:this.get(V);"from"in z||(z.from=ne),X||(F=~F.indexOf("=")?ne+parseFloat(F.replace("=","")):parseFloat(F));var Z={target:this,startValue:z.from,endValue:F,byValue:z.by,easing:z.easing,duration:z.duration,abort:z.abort&&function(te,ae,fe){return z.abort.call(L,te,ae,fe)},onChange:function(te,ae,fe){P?L[P[0]][P[1]]=te:L.set(V,te),$||z.onChange&&z.onChange(te,ae,fe)},onComplete:function(te,ae,fe){$||(L.setCoords(),z.onComplete&&z.onComplete(te,ae,fe))}};return X?ee.util.animateColor(Z.startValue,Z.endValue,Z.duration,Z):ee.util.animate(Z)}}),function(V){var F=V.fabric||(V.fabric={}),z=F.util.object.extend,$=F.util.object.clone,P={x1:1,x2:1,y1:1,y2:1};function L(X,ne){var Z=X.origin,te=X.axis1,ae=X.axis2,fe=X.dimension,be=ne.nearest,Pe=ne.center,De=ne.farthest;return function(){switch(this.get(Z)){case be:return Math.min(this.get(te),this.get(ae));case Pe:return Math.min(this.get(te),this.get(ae))+.5*this.get(fe);case De:return Math.max(this.get(te),this.get(ae))}}}F.Line?F.warn("fabric.Line is already defined"):(F.Line=F.util.createClass(F.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:F.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(X,ne){X||(X=[0,0,0,0]),this.callSuper("initialize",ne),this.set("x1",X[0]),this.set("y1",X[1]),this.set("x2",X[2]),this.set("y2",X[3]),this._setWidthHeight(ne)},_setWidthHeight:function(X){X||(X={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in X?X.left:this._getLeftToOriginX(),this.top="top"in X?X.top:this._getTopToOriginY()},_set:function(X,ne){return this.callSuper("_set",X,ne),void 0!==P[X]&&this._setWidthHeight(),this},_getLeftToOriginX:L({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:L({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(X){X.beginPath();var ne=this.calcLinePoints();X.moveTo(ne.x1,ne.y1),X.lineTo(ne.x2,ne.y2),X.lineWidth=this.strokeWidth;var Z=X.strokeStyle;X.strokeStyle=this.stroke||X.fillStyle,this.stroke&&this._renderStroke(X),X.strokeStyle=Z},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(X){return z(this.callSuper("toObject",X),this.calcLinePoints())},_getNonTransformedDimensions:function(){var X=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(X.y-=this.strokeWidth),0===this.height&&(X.x-=this.strokeWidth)),X},calcLinePoints:function(){var X=this.x1<=this.x2?-1:1,ne=this.y1<=this.y2?-1:1;return{x1:X*this.width*.5,x2:X*this.width*-.5,y1:ne*this.height*.5,y2:ne*this.height*-.5}},_toSVG:function(){var X=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',X.x1,'" y1="',X.y1,'" x2="',X.x2,'" y2="',X.y2,'" />\n']}}),F.Line.ATTRIBUTE_NAMES=F.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),F.Line.fromElement=function(X,ne,Z){Z=Z||{};var te=F.parseAttributes(X,F.Line.ATTRIBUTE_NAMES);ne(new F.Line([te.x1||0,te.y1||0,te.x2||0,te.y2||0],z(te,Z)))},F.Line.fromObject=function(X,ne){var Z=$(X,!0);Z.points=[X.x1,X.y1,X.x2,X.y2],F.Object._fromObject("Line",Z,function(te){delete te.points,ne&&ne(te)},"points")})}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.util.degreesToRadians;F.Circle?F.warn("fabric.Circle is already defined."):(F.Circle=F.util.createClass(F.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:F.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function($,P){return this.callSuper("_set",$,P),"radius"===$&&this.setRadius(P),this},toObject:function($){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat($))},_toSVG:function(){var $,P=(this.endAngle-this.startAngle)%360;if(0===P)$=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var L=z(this.startAngle),X=z(this.endAngle),ne=this.radius;$=['<path d="M '+F.util.cos(L)*ne+" "+F.util.sin(L)*ne," A "+ne+" "+ne," 0 ",+(P>180?"1":"0")+" 1"," "+F.util.cos(X)*ne+" "+F.util.sin(X)*ne,'" ',"COMMON_PARTS"," />\n"]}return $},_render:function($){$.beginPath(),$.arc(0,0,this.radius,z(this.startAngle),z(this.endAngle),!1),this._renderPaintInOrder($)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function($){return this.radius=$,this.set("width",2*$).set("height",2*$)}}),F.Circle.ATTRIBUTE_NAMES=F.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),F.Circle.fromElement=function($,P){var L,X=F.parseAttributes($,F.Circle.ATTRIBUTE_NAMES);if(!("radius"in(L=X)&&L.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");X.left=(X.left||0)-X.radius,X.top=(X.top||0)-X.radius,P(new F.Circle(X))},F.Circle.fromObject=function($,P){F.Object._fromObject("Circle",$,P)})}(l),function(V){var F=V.fabric||(V.fabric={});F.Triangle?F.warn("fabric.Triangle is already defined"):(F.Triangle=F.util.createClass(F.Object,{type:"triangle",width:100,height:100,_render:function(z){var $=this.width/2,P=this.height/2;z.beginPath(),z.moveTo(-$,P),z.lineTo(0,-P),z.lineTo($,P),z.closePath(),this._renderPaintInOrder(z)},_toSVG:function(){var z=this.width/2,$=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-z+" "+$,"0 "+-$,z+" "+$].join(","),'" />']}}),F.Triangle.fromObject=function(z,$){return F.Object._fromObject("Triangle",z,$)})}(l),function(V){var F=V.fabric||(V.fabric={}),z=2*Math.PI;F.Ellipse?F.warn("fabric.Ellipse is already defined."):(F.Ellipse=F.util.createClass(F.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:F.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function($){this.callSuper("initialize",$),this.set("rx",$&&$.rx||0),this.set("ry",$&&$.ry||0)},_set:function($,P){switch(this.callSuper("_set",$,P),$){case"rx":this.rx=P,this.set("width",2*P);break;case"ry":this.ry=P,this.set("height",2*P)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function($){return this.callSuper("toObject",["rx","ry"].concat($))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function($){$.beginPath(),$.save(),$.transform(1,0,0,this.ry/this.rx,0,0),$.arc(0,0,this.rx,0,z,!1),$.restore(),this._renderPaintInOrder($)}}),F.Ellipse.ATTRIBUTE_NAMES=F.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),F.Ellipse.fromElement=function($,P){var L=F.parseAttributes($,F.Ellipse.ATTRIBUTE_NAMES);L.left=(L.left||0)-L.rx,L.top=(L.top||0)-L.ry,P(new F.Ellipse(L))},F.Ellipse.fromObject=function($,P){F.Object._fromObject("Ellipse",$,P)})}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.util.object.extend;F.Rect?F.warn("fabric.Rect is already defined"):(F.Rect=F.util.createClass(F.Object,{stateProperties:F.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:F.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function($){this.callSuper("initialize",$),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function($){var P=this.rx?Math.min(this.rx,this.width/2):0,L=this.ry?Math.min(this.ry,this.height/2):0,X=this.width,ne=this.height,Z=-this.width/2,te=-this.height/2,ae=0!==P||0!==L,fe=.4477152502;$.beginPath(),$.moveTo(Z+P,te),$.lineTo(Z+X-P,te),ae&&$.bezierCurveTo(Z+X-fe*P,te,Z+X,te+fe*L,Z+X,te+L),$.lineTo(Z+X,te+ne-L),ae&&$.bezierCurveTo(Z+X,te+ne-fe*L,Z+X-fe*P,te+ne,Z+X-P,te+ne),$.lineTo(Z+P,te+ne),ae&&$.bezierCurveTo(Z+fe*P,te+ne,Z,te+ne-fe*L,Z,te+ne-L),$.lineTo(Z,te+L),ae&&$.bezierCurveTo(Z,te+fe*L,Z+fe*P,te,Z+P,te),$.closePath(),this._renderPaintInOrder($)},toObject:function($){return this.callSuper("toObject",["rx","ry"].concat($))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),F.Rect.ATTRIBUTE_NAMES=F.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),F.Rect.fromElement=function($,P,L){if(!$)return P(null);L=L||{};var X=F.parseAttributes($,F.Rect.ATTRIBUTE_NAMES);X.left=X.left||0,X.top=X.top||0,X.height=X.height||0,X.width=X.width||0;var ne=new F.Rect(z(L?F.util.object.clone(L):{},X));ne.visible=ne.visible&&ne.width>0&&ne.height>0,P(ne)},F.Rect.fromObject=function($,P){return F.Object._fromObject("Rect",$,P)})}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.util.object.extend,$=F.util.array.min,P=F.util.array.max,L=F.util.toFixed,X=F.util.projectStrokeOnPoints;F.Polyline?F.warn("fabric.Polyline is already defined"):(F.Polyline=F.util.createClass(F.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:F.Object.prototype.cacheProperties.concat("points"),initialize:function(ne,Z){Z=Z||{},this.points=ne||[],this.callSuper("initialize",Z),this._setPositionDimensions(Z)},_projectStrokeOnPoints:function(){return X(this.points,this,!0)},_setPositionDimensions:function(ne){var Z,te=this._calcDimensions(ne),ae=this.exactBoundingBox?this.strokeWidth:0;this.width=te.width-ae,this.height=te.height-ae,ne.fromSVG||(Z=this.translateToGivenOrigin({x:te.left-this.strokeWidth/2+ae/2,y:te.top-this.strokeWidth/2+ae/2},"left","top",this.originX,this.originY)),void 0===ne.left&&(this.left=ne.fromSVG?te.left:Z.x),void 0===ne.top&&(this.top=ne.fromSVG?te.top:Z.y),this.pathOffset={x:te.left+this.width/2+ae/2,y:te.top+this.height/2+ae/2}},_calcDimensions:function(){var ne=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,Z=$(ne,"x")||0,te=$(ne,"y")||0;return{left:Z,top:te,width:(P(ne,"x")||0)-Z,height:(P(ne,"y")||0)-te}},toObject:function(ne){return z(this.callSuper("toObject",ne),{points:this.points.concat()})},_toSVG:function(){for(var ne=[],Z=this.pathOffset.x,te=this.pathOffset.y,ae=F.Object.NUM_FRACTION_DIGITS,fe=0,be=this.points.length;fe<be;fe++)ne.push(L(this.points[fe].x-Z,ae),",",L(this.points[fe].y-te,ae)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',ne.join(""),'" />\n']},commonRender:function(ne){var Z,te=this.points.length,ae=this.pathOffset.x,fe=this.pathOffset.y;if(!te||isNaN(this.points[te-1].y))return!1;ne.beginPath(),ne.moveTo(this.points[0].x-ae,this.points[0].y-fe);for(var be=0;be<te;be++)ne.lineTo((Z=this.points[be]).x-ae,Z.y-fe);return!0},_render:function(ne){this.commonRender(ne)&&this._renderPaintInOrder(ne)},complexity:function(){return this.get("points").length}}),F.Polyline.ATTRIBUTE_NAMES=F.SHARED_ATTRIBUTES.concat(),F.Polyline.fromElementGenerator=function(ne){return function(Z,te,ae){if(!Z)return te(null);ae||(ae={});var fe=F.parsePointsAttribute(Z.getAttribute("points")),be=F.parseAttributes(Z,F[ne].ATTRIBUTE_NAMES);be.fromSVG=!0,te(new F[ne](fe,z(be,ae)))}},F.Polyline.fromElement=F.Polyline.fromElementGenerator("Polyline"),F.Polyline.fromObject=function(ne,Z){return F.Object._fromObject("Polyline",ne,Z,"points")})}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.util.projectStrokeOnPoints;F.Polygon?F.warn("fabric.Polygon is already defined"):(F.Polygon=F.util.createClass(F.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return z(this.points,this)},_render:function($){this.commonRender($)&&($.closePath(),this._renderPaintInOrder($))}}),F.Polygon.ATTRIBUTE_NAMES=F.SHARED_ATTRIBUTES.concat(),F.Polygon.fromElement=F.Polyline.fromElementGenerator("Polygon"),F.Polygon.fromObject=function($,P){F.Object._fromObject("Polygon",$,P,"points")})}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.util.array.min,$=F.util.array.max,P=F.util.object.extend,L=F.util.object.clone,X=F.util.toFixed;F.Path?F.warn("fabric.Path is already defined"):(F.Path=F.util.createClass(F.Object,{type:"path",path:null,cacheProperties:F.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:F.Object.prototype.stateProperties.concat("path"),initialize:function(ne,Z){delete(Z=L(Z||{})).path,this.callSuper("initialize",Z),this._setPath(ne||[],Z)},_setPath:function(ne,Z){this.path=F.util.makePathSimpler(Array.isArray(ne)?ne:F.util.parsePath(ne)),F.Polyline.prototype._setPositionDimensions.call(this,Z||{})},_renderPathCommands:function(ne){var Z,te=0,ae=0,fe=0,be=0,Xe=-this.pathOffset.x,Re=-this.pathOffset.y;ne.beginPath();for(var Ae=0,de=this.path.length;Ae<de;++Ae)switch((Z=this.path[Ae])[0]){case"L":ne.lineTo((fe=Z[1])+Xe,(be=Z[2])+Re);break;case"M":te=fe=Z[1],ae=be=Z[2],ne.moveTo(fe+Xe,be+Re);break;case"C":ne.bezierCurveTo(Z[1]+Xe,Z[2]+Re,Z[3]+Xe,Z[4]+Re,(fe=Z[5])+Xe,(be=Z[6])+Re);break;case"Q":ne.quadraticCurveTo(Z[1]+Xe,Z[2]+Re,Z[3]+Xe,Z[4]+Re),fe=Z[3],be=Z[4];break;case"z":case"Z":fe=te,be=ae,ne.closePath()}},_render:function(ne){this._renderPathCommands(ne),this._renderPaintInOrder(ne)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(ne){return P(this.callSuper("toObject",ne),{path:this.path.map(function(Z){return Z.slice()})})},toDatalessObject:function(ne){var Z=this.toObject(["sourcePath"].concat(ne));return Z.sourcePath&&delete Z.path,Z},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',F.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var ne=F.Object.NUM_FRACTION_DIGITS;return" translate("+X(-this.pathOffset.x,ne)+", "+X(-this.pathOffset.y,ne)+")"},toClipPathSVG:function(ne){var Z=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:ne,additionalTransform:Z})},toSVG:function(ne){var Z=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:ne,additionalTransform:Z})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var ne,Z,te=[],ae=[],fe=0,be=0,Pe=0,De=0,Xe=0,Re=this.path.length;Xe<Re;++Xe){switch((ne=this.path[Xe])[0]){case"L":Pe=ne[1],De=ne[2],Z=[];break;case"M":fe=Pe=ne[1],be=De=ne[2],Z=[];break;case"C":Z=F.util.getBoundsOfCurve(Pe,De,ne[1],ne[2],ne[3],ne[4],ne[5],ne[6]),Pe=ne[5],De=ne[6];break;case"Q":Z=F.util.getBoundsOfCurve(Pe,De,ne[1],ne[2],ne[1],ne[2],ne[3],ne[4]),Pe=ne[3],De=ne[4];break;case"z":case"Z":Pe=fe,De=be}Z.forEach(function(tt){te.push(tt.x),ae.push(tt.y)}),te.push(Pe),ae.push(De)}var Ae=z(te)||0,de=z(ae)||0;return{left:Ae,top:de,width:($(te)||0)-Ae,height:($(ae)||0)-de}}}),F.Path.fromObject=function(ne,Z){"string"==typeof ne.sourcePath?F.loadSVGFromURL(ne.sourcePath,function(ae){var fe=ae[0];fe.setOptions(ne),Z&&Z(fe)}):F.Object._fromObject("Path",ne,Z,"path")},F.Path.ATTRIBUTE_NAMES=F.SHARED_ATTRIBUTES.concat(["d"]),F.Path.fromElement=function(ne,Z,te){var ae=F.parseAttributes(ne,F.Path.ATTRIBUTE_NAMES);ae.fromSVG=!0,Z(new F.Path(ae.d,P(ae,te)))})}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.util.array.min,$=F.util.array.max;F.Group||(F.Group=F.util.createClass(F.Object,F.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(P,L,X){L=L||{},this._objects=[],X&&this.callSuper("initialize",L),this._objects=P||[];for(var ne=this._objects.length;ne--;)this._objects[ne].group=this;if(X)this._updateObjectsACoords();else{var Z=L&&L.centerPoint;void 0!==L.originX&&(this.originX=L.originX),void 0!==L.originY&&(this.originY=L.originY),Z||this._calcBounds(),this._updateObjectsCoords(Z),delete L.centerPoint,this.callSuper("initialize",L)}this.setCoords()},_updateObjectsACoords:function(){for(var P=this._objects.length;P--;)this._objects[P].setCoords(!0)},_updateObjectsCoords:function(P){P=P||this.getCenterPoint();for(var L=this._objects.length;L--;)this._updateObjectCoords(this._objects[L],P)},_updateObjectCoords:function(P,L){P.set({left:P.left-L.x,top:P.top-L.y}),P.group=this,P.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(P){var L=!!this.group;return this._restoreObjectsState(),F.util.resetObjectTransform(this),P&&(L&&F.util.removeTransformFromObject(P,this.group.calcTransformMatrix()),this._objects.push(P),P.group=this,P._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,L?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(P){return this._restoreObjectsState(),F.util.resetObjectTransform(this),this.remove(P),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(P){this.dirty=!0,P.group=this,P._set("canvas",this.canvas)},_onObjectRemoved:function(P){this.dirty=!0,delete P.group},_set:function(P,L){var X=this._objects.length;if(this.useSetOnGroup)for(;X--;)this._objects[X].setOnGroup(P,L);if("canvas"===P)for(;X--;)this._objects[X]._set(P,L);F.Object.prototype._set.call(this,P,L)},toObject:function(P){var L=this.includeDefaultValues,X=this._objects.filter(function(Z){return!Z.excludeFromExport}).map(function(Z){var te=Z.includeDefaultValues;Z.includeDefaultValues=L;var ae=Z.toObject(P);return Z.includeDefaultValues=te,ae}),ne=F.Object.prototype.toObject.call(this,P);return ne.objects=X,ne},toDatalessObject:function(P){var L,X=this.sourcePath;if(X)L=X;else{var ne=this.includeDefaultValues;L=this._objects.map(function(te){var ae=te.includeDefaultValues;te.includeDefaultValues=ne;var fe=te.toDatalessObject(P);return te.includeDefaultValues=ae,fe})}var Z=F.Object.prototype.toDatalessObject.call(this,P);return Z.objects=L,Z},render:function(P){this._transformDone=!0,this.callSuper("render",P),this._transformDone=!1},shouldCache:function(){var P=F.Object.prototype.shouldCache.call(this);if(P)for(var L=0,X=this._objects.length;L<X;L++)if(this._objects[L].willDrawShadow())return this.ownCaching=!1,!1;return P},willDrawShadow:function(){if(F.Object.prototype.willDrawShadow.call(this))return!0;for(var P=0,L=this._objects.length;P<L;P++)if(this._objects[P].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(P){for(var L=0,X=this._objects.length;L<X;L++)this._objects[L].render(P);this._drawClipPath(P,this.clipPath)},isCacheDirty:function(P){if(this.callSuper("isCacheDirty",P))return!0;if(!this.statefullCache)return!1;for(var L=0,X=this._objects.length;L<X;L++)if(this._objects[L].isCacheDirty(!0)){if(this._cacheCanvas){var ne=this.cacheWidth/this.zoomX,Z=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-ne/2,-Z/2,ne,Z)}return!0}return!1},_restoreObjectsState:function(){var P=this.calcOwnMatrix();return this._objects.forEach(function(L){F.util.addTransformToObject(L,P),delete L.group,L.setCoords()}),this},destroy:function(){return this._objects.forEach(function(P){P.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(P){P.dispose&&P.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var P=this._objects,L=this.canvas;this._objects=[];var X=this.toObject();delete X.objects;var ne=new F.ActiveSelection([]);return ne.set(X),ne.type="activeSelection",L.remove(this),P.forEach(function(Z){Z.group=ne,Z.dirty=!0,L.add(Z)}),ne.canvas=L,ne._objects=P,L._activeObject=ne,ne.setCoords(),ne}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(P){P.setCoords(!0)}),this},_calcBounds:function(P){for(var L,X,ne,Z,te=[],ae=[],fe=["tr","br","bl","tl"],be=0,Pe=this._objects.length,De=fe.length;be<Pe;++be){for(ne=(L=this._objects[be]).calcACoords(),Z=0;Z<De;Z++)te.push(ne[X=fe[Z]].x),ae.push(ne[X].y);L.aCoords=ne}this._getBounds(te,ae,P)},_getBounds:function(P,L,X){var ne=new F.Point(z(P),z(L)),Z=new F.Point($(P),$(L)),te=ne.y||0,ae=ne.x||0,be=Z.y-ne.y||0;this.width=Z.x-ne.x||0,this.height=be,X||this.setPositionByOrigin({x:ae,y:te},"left","top")},_toSVG:function(P){for(var L=["<g ","COMMON_PARTS"," >\n"],X=0,ne=this._objects.length;X<ne;X++)L.push("\t\t",this._objects[X].toSVG(P));return L.push("</g>\n"),L},getSvgStyles:function(){var L=this.visible?"":" visibility: hidden;";return[void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),L].join("")},toClipPathSVG:function(P){for(var L=[],X=0,ne=this._objects.length;X<ne;X++)L.push("\t",this._objects[X].toClipPathSVG(P));return this._createBaseClipPathSVGMarkup(L,{reviver:P})}}),F.Group.fromObject=function(P,L){var X=P.objects,ne=F.util.object.clone(P,!0);delete ne.objects,"string"!=typeof X?F.util.enlivenObjects(X,function(Z){var te=F.util.object.clone(P,!0);delete te.objects,F.util.enlivenObjectEnlivables(P,te,function(){L&&L(new F.Group(Z,te,!0))})}):F.loadSVGFromURL(X,function(Z){var te=F.util.groupSVGElements(Z,P,X);te.set(ne),L&&L(te)})})}(l),function(V){var F=V.fabric||(V.fabric={});F.ActiveSelection||(F.ActiveSelection=F.util.createClass(F.Group,{type:"activeSelection",initialize:function(z,$){$=$||{},this._objects=z||[];for(var P=this._objects.length;P--;)this._objects[P].group=this;$.originX&&(this.originX=$.originX),$.originY&&(this.originY=$.originY),this._calcBounds(),this._updateObjectsCoords(),F.Object.prototype.initialize.call(this,$),this.setCoords()},toGroup:function(){var z=this._objects.concat();this._objects=[];var $=F.Object.prototype.toObject.call(this),P=new F.Group([]);if(delete $.type,P.set($),z.forEach(function(X){X.canvas.remove(X),X.group=P}),P._objects=z,!this.canvas)return P;var L=this.canvas;return L.add(P),L._activeObject=P,P.setCoords(),P},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(z,$,P){z.save(),z.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",z,$),void 0===(P=P||{}).hasControls&&(P.hasControls=!1),P.forActiveSelection=!0;for(var L=0,X=this._objects.length;L<X;L++)this._objects[L]._renderControls(z,P);z.restore()}}),F.ActiveSelection.fromObject=function(z,$){F.util.enlivenObjects(z.objects,function(P){delete z.objects,$&&$(new F.ActiveSelection(P,z,!0))})})}(l),function(V){var F=ee.util.object.extend;V.fabric||(V.fabric={}),V.fabric.Image?ee.warn("fabric.Image is already defined."):(ee.Image=ee.util.createClass(ee.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:ee.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:ee.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(z,$){$||($={}),this.filters=[],this.cacheKey="texture"+ee.Object.__uid++,this.callSuper("initialize",$),this._initElement(z,$)},getElement:function(){return this._element||{}},setElement:function(z,$){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=z,this._originalElement=z,this._initConfig($),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(z){var $=ee.filterBackend;$&&$.evictCachesForKey&&$.evictCachesForKey(z)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(z){ee.util.cleanUpJsdomNode(this[z]),this[z]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var z=this.getElement();return{width:z.naturalWidth||z.width,height:z.naturalHeight||z.height}},_stroke:function(z){if(this.stroke&&0!==this.strokeWidth){var $=this.width/2,P=this.height/2;z.beginPath(),z.moveTo(-$,-P),z.lineTo($,-P),z.lineTo($,P),z.lineTo(-$,P),z.lineTo(-$,-P),z.closePath()}},toObject:function(z){var $=[];this.filters.forEach(function(L){L&&$.push(L.toObject())});var P=F(this.callSuper("toObject",["cropX","cropY"].concat(z)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:$});return this.resizeFilter&&(P.resizeFilter=this.resizeFilter.toObject()),P},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var z,$=[],P=[],L=this._element,X=-this.width/2,ne=-this.height/2,Z="",te="";if(!L)return[];if(this.hasCrop()){var ae=ee.Object.__uid++;$.push('<clipPath id="imageCrop_'+ae+'">\n','\t<rect x="'+X+'" y="'+ne+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),Z=' clip-path="url(#imageCrop_'+ae+')" '}if(this.imageSmoothing||(te='" image-rendering="optimizeSpeed'),P.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',X-this.cropX,'" y="',ne-this.cropY,'" width="',L.width||L.naturalWidth,'" height="',L.height||L.height,te,'"',Z,"></image>\n"),this.stroke||this.strokeDashArray){var fe=this.fill;this.fill=null,z=["\t<rect ",'x="',X,'" y="',ne,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=fe}return"fill"!==this.paintFirst?$.concat(z,P):$.concat(P,z)},getSrc:function(z){var $=z?this._element:this._originalElement;return $?$.toDataURL?$.toDataURL():this.srcFromAttribute?$.getAttribute("src"):$.src:this.src||""},setSrc:function(z,$,P){return ee.util.loadImage(z,function(L,X){this.setElement(L,P),this._setWidthHeight(),$&&$(this,X)},this,P&&P.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var z=this.resizeFilter,$=this.minimumScaleTrigger,P=this.getTotalObjectScaling(),L=P.scaleX,X=P.scaleY,ne=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!z||L>$&&X>$)return this._element=ne,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=L,void(this._lastScaleY=X);ee.filterBackend||(ee.filterBackend=ee.initFilterBackend());var Z=ee.util.createCanvasElement(),te=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,ae=ne.width,fe=ne.height;Z.width=ae,Z.height=fe,this._element=Z,this._lastScaleX=z.scaleX=L,this._lastScaleY=z.scaleY=X,ee.filterBackend.applyFilters([z],ne,ae,fe,this._element,te),this._filterScalingX=Z.width/this._originalElement.width,this._filterScalingY=Z.height/this._originalElement.height},applyFilters:function(z){if(z=(z=z||this.filters||[]).filter(function(ne){return ne&&!ne.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===z.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var $=this._originalElement,P=$.naturalWidth||$.width,L=$.naturalHeight||$.height;if(this._element===this._originalElement){var X=ee.util.createCanvasElement();X.width=P,X.height=L,this._element=X,this._filteredEl=X}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,P,L),this._lastScaleX=1,this._lastScaleY=1;return ee.filterBackend||(ee.filterBackend=ee.initFilterBackend()),ee.filterBackend.applyFilters(z,this._originalElement,P,L,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(z){ee.util.setImageSmoothing(z,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(z),this._renderPaintInOrder(z)},drawCacheOnCanvas:function(z){ee.util.setImageSmoothing(z,this.imageSmoothing),ee.Object.prototype.drawCacheOnCanvas.call(this,z)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(z){var $=this._element;if($){var P=this._filterScalingX,L=this._filterScalingY,X=this.width,ne=this.height,Z=Math.min,te=Math.max,ae=te(this.cropX,0),fe=te(this.cropY,0),be=$.naturalWidth||$.width,Pe=$.naturalHeight||$.height,De=ae*P,Xe=fe*L,Re=Z(X*P,be-De),Ae=Z(ne*L,Pe-Xe),de=-X/2,tt=-ne/2,Ze=Z(X,be/P-ae),et=Z(ne,Pe/L-fe);$&&z.drawImage($,De,Xe,Re,Ae,de,tt,Ze,et)}},_needsResize:function(){var z=this.getTotalObjectScaling();return z.scaleX!==this._lastScaleX||z.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(z,$){this.setElement(ee.util.getById(z),$),ee.util.addClass(this.getElement(),ee.Image.CSS_CANVAS)},_initConfig:function(z){z||(z={}),this.setOptions(z),this._setWidthHeight(z)},_initFilters:function(z,$){z&&z.length?ee.util.enlivenObjects(z,function(P){$&&$(P)},"fabric.Image.filters"):$&&$()},_setWidthHeight:function(z){z||(z={});var $=this.getElement();this.width=z.width||$.naturalWidth||$.width||0,this.height=z.height||$.naturalHeight||$.height||0},parsePreserveAspectRatioAttribute:function(){var z,$=ee.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),P=this._element.width,L=this._element.height,X=1,ne=1,Z=0,te=0,ae=0,fe=0,be=this.width,Pe=this.height,De={width:be,height:Pe};return!$||"none"===$.alignX&&"none"===$.alignY?(X=be/P,ne=Pe/L):("meet"===$.meetOrSlice&&(z=(be-P*(X=ne=ee.util.findScaleToFit(this._element,De)))/2,"Min"===$.alignX&&(Z=-z),"Max"===$.alignX&&(Z=z),z=(Pe-L*ne)/2,"Min"===$.alignY&&(te=-z),"Max"===$.alignY&&(te=z)),"slice"===$.meetOrSlice&&(z=P-be/(X=ne=ee.util.findScaleToCover(this._element,De)),"Mid"===$.alignX&&(ae=z/2),"Max"===$.alignX&&(ae=z),z=L-Pe/ne,"Mid"===$.alignY&&(fe=z/2),"Max"===$.alignY&&(fe=z),P=be/X,L=Pe/ne)),{width:P,height:L,scaleX:X,scaleY:ne,offsetLeft:Z,offsetTop:te,cropX:ae,cropY:fe}}}),ee.Image.CSS_CANVAS="canvas-img",ee.Image.prototype.getSvgSrc=ee.Image.prototype.getSrc,ee.Image.fromObject=function(z,$){var P=ee.util.object.clone(z);ee.util.loadImage(P.src,function(L,X){X?$&&$(null,!0):ee.Image.prototype._initFilters.call(P,P.filters,function(ne){P.filters=ne||[],ee.Image.prototype._initFilters.call(P,[P.resizeFilter],function(Z){P.resizeFilter=Z[0],ee.util.enlivenObjectEnlivables(P,P,function(){var te=new ee.Image(L,P);$(te,!1)})})})},null,P.crossOrigin)},ee.Image.fromURL=function(z,$,P){ee.util.loadImage(z,function(L,X){$&&$(new ee.Image(L,P),X)},null,P&&P.crossOrigin)},ee.Image.ATTRIBUTE_NAMES=ee.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),ee.Image.fromElement=function(z,$,P){var L=ee.parseAttributes(z,ee.Image.ATTRIBUTE_NAMES);ee.Image.fromURL(L["xlink:href"],$,F(P?ee.util.object.clone(P):{},L))})}(l),ee.util.object.extend(ee.Object.prototype,{_getAngleValueForStraighten:function(){var V=this.angle%360;return V>0?90*Math.round((V-1)/90):90*Math.round(V/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(V){var F=function(){},z=(V=V||{}).onComplete||F,$=V.onChange||F,P=this;return ee.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(L){P.rotate(L),$()},onComplete:function(){P.setCoords(),z()}})}}),ee.util.object.extend(ee.StaticCanvas.prototype,{straightenObject:function(V){return V.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(V){return V.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function V(z,$){var P="precision "+$+" float;\nvoid main(){}",L=z.createShader(z.FRAGMENT_SHADER);return z.shaderSource(L,P),z.compileShader(L),!!z.getShaderParameter(L,z.COMPILE_STATUS)}function F(z){z&&z.tileSize&&(this.tileSize=z.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}ee.isWebglSupported=function(z){if(ee.isLikelyNode)return!1;z=z||ee.WebglFilterBackend.prototype.tileSize;var $=document.createElement("canvas"),P=$.getContext("webgl")||$.getContext("experimental-webgl"),L=!1;if(P){ee.maxTextureSize=P.getParameter(P.MAX_TEXTURE_SIZE),L=ee.maxTextureSize>=z;for(var X=["highp","mediump","lowp"],ne=0;ne<3;ne++)if(V(P,X[ne])){ee.webGlPrecision=X[ne];break}}return this.isSupported=L,L},ee.WebglFilterBackend=F,F.prototype={tileSize:2048,resources:{},setupGLContext:function(z,$){this.dispose(),this.createWebGLCanvas(z,$),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(z,$)},chooseFastestCopyGLTo2DMethod:function(z,$){var P,L=void 0!==window.performance;try{new ImageData(1,1),P=!0}catch(Pe){P=!1}var X="undefined"!=typeof ArrayBuffer,ne="undefined"!=typeof Uint8ClampedArray;if(L&&P&&X&&ne){var Z=ee.util.createCanvasElement(),te=new ArrayBuffer(z*$*4);if(ee.forceGLPutImageData)return this.imageBuffer=te,void(this.copyGLTo2D=Le);var ae,fe,be={imageBuffer:te,destinationWidth:z,destinationHeight:$,targetCanvas:Z};Z.width=z,Z.height=$,ae=window.performance.now(),xe.call(be,this.gl,be),fe=window.performance.now()-ae,ae=window.performance.now(),Le.call(be,this.gl,be),fe>window.performance.now()-ae?(this.imageBuffer=te,this.copyGLTo2D=Le):this.copyGLTo2D=xe}},createWebGLCanvas:function(z,$){var P=ee.util.createCanvasElement();P.width=z,P.height=$;var L={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},X=P.getContext("webgl",L);X||(X=P.getContext("experimental-webgl",L)),X&&(X.clearColor(0,0,0,0),this.canvas=P,this.gl=X)},applyFilters:function(z,$,P,L,X,ne){var Z,te=this.gl;ne&&(Z=this.getCachedTexture(ne,$));var be,Pe,Re,Ae,ae={originalWidth:$.width||$.originalWidth,originalHeight:$.height||$.originalHeight,sourceWidth:P,sourceHeight:L,destinationWidth:P,destinationHeight:L,context:te,sourceTexture:this.createTexture(te,P,L,!Z&&$),targetTexture:this.createTexture(te,P,L),originalTexture:Z||this.createTexture(te,P,L,!Z&&$),passes:z.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:X},fe=te.createFramebuffer();return te.bindFramebuffer(te.FRAMEBUFFER,fe),z.forEach(function(be){be&&be.applyTo(ae)}),Ae=(be=ae).destinationHeight,(Pe=be.targetCanvas).width===(Re=be.destinationWidth)&&Pe.height===Ae||(Pe.width=Re,Pe.height=Ae),this.copyGLTo2D(te,ae),te.bindTexture(te.TEXTURE_2D,null),te.deleteTexture(ae.sourceTexture),te.deleteTexture(ae.targetTexture),te.deleteFramebuffer(fe),X.getContext("2d").setTransform(1,0,0,1,0,0),ae},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(z,$,P,L){var X=z.createTexture();return z.bindTexture(z.TEXTURE_2D,X),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),L?z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,L):z.texImage2D(z.TEXTURE_2D,0,z.RGBA,$,P,0,z.RGBA,z.UNSIGNED_BYTE,null),X},getCachedTexture:function(z,$){if(this.textureCache[z])return this.textureCache[z];var P=this.createTexture(this.gl,$.width,$.height,$);return this.textureCache[z]=P,P},evictCachesForKey:function(z){this.textureCache[z]&&(this.gl.deleteTexture(this.textureCache[z]),delete this.textureCache[z])},copyGLTo2D:xe,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var z=this.gl,$={renderer:"",vendor:""};if(!z)return $;var P=z.getExtension("WEBGL_debug_renderer_info");if(P){var L=z.getParameter(P.UNMASKED_RENDERER_WEBGL),X=z.getParameter(P.UNMASKED_VENDOR_WEBGL);L&&($.renderer=L.toLowerCase()),X&&($.vendor=X.toLowerCase())}return this.gpuInfo=$,$}}}(),function(){var V=function(){};function F(){}ee.Canvas2dFilterBackend=F,F.prototype={evictCachesForKey:V,dispose:V,clearWebGLCaches:V,resources:{},applyFilters:function(z,$,P,L,X){var ne=X.getContext("2d");ne.drawImage($,0,0,P,L);var Z={sourceWidth:P,sourceHeight:L,imageData:ne.getImageData(0,0,P,L),originalEl:$,originalImageData:ne.getImageData(0,0,P,L),canvasEl:X,ctx:ne,filterBackend:this};return z.forEach(function(te){te.applyTo(Z)}),Z.imageData.width===P&&Z.imageData.height===L||(X.width=Z.imageData.width,X.height=Z.imageData.height),ne.putImageData(Z.imageData,0,0),Z}}}(),ee.Image=ee.Image||{},ee.Image.filters=ee.Image.filters||{},ee.Image.filters.BaseFilter=ee.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(V){V&&this.setOptions(V)},setOptions:function(V){for(var F in V)this[F]=V[F]},createProgram:function(V,F,z){F=F||this.fragmentSource,z=z||this.vertexSource,"highp"!==ee.webGlPrecision&&(F=F.replace(/precision highp float/g,"precision "+ee.webGlPrecision+" float"));var $=V.createShader(V.VERTEX_SHADER);if(V.shaderSource($,z),V.compileShader($),!V.getShaderParameter($,V.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+V.getShaderInfoLog($));var P=V.createShader(V.FRAGMENT_SHADER);if(V.shaderSource(P,F),V.compileShader(P),!V.getShaderParameter(P,V.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+V.getShaderInfoLog(P));var L=V.createProgram();if(V.attachShader(L,$),V.attachShader(L,P),V.linkProgram(L),!V.getProgramParameter(L,V.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+V.getProgramInfoLog(L));var X=this.getAttributeLocations(V,L),ne=this.getUniformLocations(V,L)||{};return ne.uStepW=V.getUniformLocation(L,"uStepW"),ne.uStepH=V.getUniformLocation(L,"uStepH"),{program:L,attributeLocations:X,uniformLocations:ne}},getAttributeLocations:function(V,F){return{aPosition:V.getAttribLocation(F,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(V,F,z){var $=F.aPosition,P=V.createBuffer();V.bindBuffer(V.ARRAY_BUFFER,P),V.enableVertexAttribArray($),V.vertexAttribPointer($,2,V.FLOAT,!1,0,0),V.bufferData(V.ARRAY_BUFFER,z,V.STATIC_DRAW)},_setupFrameBuffer:function(V){var F,z,$=V.context;V.passes>1?(z=V.destinationHeight,V.sourceWidth===(F=V.destinationWidth)&&V.sourceHeight===z||($.deleteTexture(V.targetTexture),V.targetTexture=V.filterBackend.createTexture($,F,z)),$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_2D,V.targetTexture,0)):($.bindFramebuffer($.FRAMEBUFFER,null),$.finish())},_swapTextures:function(V){V.passes--,V.pass++;var F=V.targetTexture;V.targetTexture=V.sourceTexture,V.sourceTexture=F},isNeutralState:function(){var V=this.mainParameter,F=ee.Image.filters[this.type].prototype;if(V){if(Array.isArray(F[V])){for(var z=F[V].length;z--;)if(this[V][z]!==F[V][z])return!1;return!0}return F[V]===this[V]}return!1},applyTo:function(V){V.webgl?(this._setupFrameBuffer(V),this.applyToWebGL(V),this._swapTextures(V)):this.applyTo2d(V)},retrieveShader:function(V){return V.programCache.hasOwnProperty(this.type)||(V.programCache[this.type]=this.createProgram(V.context)),V.programCache[this.type]},applyToWebGL:function(V){var F=V.context,z=this.retrieveShader(V);F.bindTexture(F.TEXTURE_2D,0===V.pass&&V.originalTexture?V.originalTexture:V.sourceTexture),F.useProgram(z.program),this.sendAttributeData(F,z.attributeLocations,V.aPosition),F.uniform1f(z.uniformLocations.uStepW,1/V.sourceWidth),F.uniform1f(z.uniformLocations.uStepH,1/V.sourceHeight),this.sendUniformData(F,z.uniformLocations),F.viewport(0,0,V.destinationWidth,V.destinationHeight),F.drawArrays(F.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(V,F,z){V.activeTexture(z),V.bindTexture(V.TEXTURE_2D,F),V.activeTexture(V.TEXTURE0)},unbindAdditionalTexture:function(V,F){V.activeTexture(F),V.bindTexture(V.TEXTURE_2D,null),V.activeTexture(V.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(V){this[this.mainParameter]=V},sendUniformData:function(){},createHelpLayer:function(V){if(!V.helpLayer){var F=document.createElement("canvas");F.width=V.sourceWidth,F.height=V.sourceHeight,V.helpLayer=F}},toObject:function(){var V={type:this.type},F=this.mainParameter;return F&&(V[F]=this[F]),V},toJSON:function(){return this.toObject()}}),ee.Image.filters.BaseFilter.fromObject=function(V,F){var z=new ee.Image.filters[V.type](V);return F&&F(z),z},function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.ColorMatrix=(0,F.util.createClass)(z.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(P){this.callSuper("initialize",P),this.matrix=this.matrix.slice(0)},applyTo2d:function(P){var L,X,ne,Z,te,ae=P.imageData.data,fe=ae.length,be=this.matrix,Pe=this.colorsOnly;for(te=0;te<fe;te+=4)L=ae[te],X=ae[te+1],ne=ae[te+2],Pe?(ae[te]=L*be[0]+X*be[1]+ne*be[2]+255*be[4],ae[te+1]=L*be[5]+X*be[6]+ne*be[7]+255*be[9],ae[te+2]=L*be[10]+X*be[11]+ne*be[12]+255*be[14]):(ae[te]=L*be[0]+X*be[1]+ne*be[2]+(Z=ae[te+3])*be[3]+255*be[4],ae[te+1]=L*be[5]+X*be[6]+ne*be[7]+Z*be[8]+255*be[9],ae[te+2]=L*be[10]+X*be[11]+ne*be[12]+Z*be[13]+255*be[14],ae[te+3]=L*be[15]+X*be[16]+ne*be[17]+Z*be[18]+255*be[19])},getUniformLocations:function(P,L){return{uColorMatrix:P.getUniformLocation(L,"uColorMatrix"),uConstants:P.getUniformLocation(L,"uConstants")}},sendUniformData:function(P,L){var X=this.matrix,Z=[X[4],X[9],X[14],X[19]];P.uniformMatrix4fv(L.uColorMatrix,!1,[X[0],X[1],X[2],X[3],X[5],X[6],X[7],X[8],X[10],X[11],X[12],X[13],X[15],X[16],X[17],X[18]]),P.uniform4fv(L.uConstants,Z)}}),F.Image.filters.ColorMatrix.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.Brightness=(0,F.util.createClass)(z.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(P){if(0!==this.brightness){var L,X=P.imageData.data,ne=X.length,Z=Math.round(255*this.brightness);for(L=0;L<ne;L+=4)X[L]=X[L]+Z,X[L+1]=X[L+1]+Z,X[L+2]=X[L+2]+Z}},getUniformLocations:function(P,L){return{uBrightness:P.getUniformLocation(L,"uBrightness")}},sendUniformData:function(P,L){P.uniform1f(L.uBrightness,this.brightness)}}),F.Image.filters.Brightness.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.util.object.extend,$=F.Image.filters;$.Convolute=(0,F.util.createClass)($.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(L){var X=Math.sqrt(this.matrix.length),ne=this.type+"_"+X+"_"+(this.opaque?1:0),Z=this.fragmentSource[ne];return L.programCache.hasOwnProperty(ne)||(L.programCache[ne]=this.createProgram(L.context,Z)),L.programCache[ne]},applyTo2d:function(L){var X,ne,Z,te,ae,fe,be,Pe,De,Xe,Re,Ae,de,tt=L.imageData,Ze=tt.data,et=this.matrix,Qe=Math.round(Math.sqrt(et.length)),Je=Math.floor(Qe/2),st=tt.width,mt=tt.height,ut=L.ctx.createImageData(st,mt),Ke=ut.data,nt=this.opaque?1:0;for(Re=0;Re<mt;Re++)for(Xe=0;Xe<st;Xe++){for(ae=4*(Re*st+Xe),X=0,ne=0,Z=0,te=0,de=0;de<Qe;de++)for(Ae=0;Ae<Qe;Ae++)fe=Xe+Ae-Je,(be=Re+de-Je)<0||be>=mt||fe<0||fe>=st||(X+=Ze[Pe=4*(be*st+fe)]*(De=et[de*Qe+Ae]),ne+=Ze[Pe+1]*De,Z+=Ze[Pe+2]*De,nt||(te+=Ze[Pe+3]*De));Ke[ae]=X,Ke[ae+1]=ne,Ke[ae+2]=Z,Ke[ae+3]=nt?Ze[ae+3]:te}L.imageData=ut},getUniformLocations:function(L,X){return{uMatrix:L.getUniformLocation(X,"uMatrix"),uOpaque:L.getUniformLocation(X,"uOpaque"),uHalfSize:L.getUniformLocation(X,"uHalfSize"),uSize:L.getUniformLocation(X,"uSize")}},sendUniformData:function(L,X){L.uniform1fv(X.uMatrix,this.matrix)},toObject:function(){return z(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),F.Image.filters.Convolute.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.Grayscale=(0,F.util.createClass)(z.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(P){var L,X,ne=P.imageData.data,Z=ne.length,te=this.mode;for(L=0;L<Z;L+=4)"average"===te?X=(ne[L]+ne[L+1]+ne[L+2])/3:"lightness"===te?X=(Math.min(ne[L],ne[L+1],ne[L+2])+Math.max(ne[L],ne[L+1],ne[L+2]))/2:"luminosity"===te&&(X=.21*ne[L]+.72*ne[L+1]+.07*ne[L+2]),ne[L]=X,ne[L+1]=X,ne[L+2]=X},retrieveShader:function(P){var L=this.type+"_"+this.mode;return P.programCache.hasOwnProperty(L)||(P.programCache[L]=this.createProgram(P.context,this.fragmentSource[this.mode])),P.programCache[L]},getUniformLocations:function(P,L){return{uMode:P.getUniformLocation(L,"uMode")}},sendUniformData:function(P,L){P.uniform1i(L.uMode,1)},isNeutralState:function(){return!1}}),F.Image.filters.Grayscale.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.Invert=(0,F.util.createClass)(z.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(P){var L,X=P.imageData.data,ne=X.length;for(L=0;L<ne;L+=4)X[L]=255-X[L],X[L+1]=255-X[L+1],X[L+2]=255-X[L+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(P,L){return{uInvert:P.getUniformLocation(L,"uInvert")}},sendUniformData:function(P,L){P.uniform1i(L.uInvert,this.invert)}}),F.Image.filters.Invert.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.util.object.extend,$=F.Image.filters;$.Noise=(0,F.util.createClass)($.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(L){if(0!==this.noise){var X,ne,te,Z=L.imageData.data,ae=this.noise;for(X=0,te=Z.length;X<te;X+=4)ne=(.5-Math.random())*ae,Z[X]+=ne,Z[X+1]+=ne,Z[X+2]+=ne}},getUniformLocations:function(L,X){return{uNoise:L.getUniformLocation(X,"uNoise"),uSeed:L.getUniformLocation(X,"uSeed")}},sendUniformData:function(L,X){L.uniform1f(X.uNoise,this.noise/255),L.uniform1f(X.uSeed,Math.random())},toObject:function(){return z(this.callSuper("toObject"),{noise:this.noise})}}),F.Image.filters.Noise.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.Pixelate=(0,F.util.createClass)(z.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(P){var L,X,ne,Z,te,ae,fe,be,Pe,De,Xe,Re=P.imageData,Ae=Re.data,de=Re.height,tt=Re.width;for(X=0;X<de;X+=this.blocksize)for(ne=0;ne<tt;ne+=this.blocksize)for(Z=Ae[L=4*X*tt+4*ne],te=Ae[L+1],ae=Ae[L+2],fe=Ae[L+3],De=Math.min(X+this.blocksize,de),Xe=Math.min(ne+this.blocksize,tt),be=X;be<De;be++)for(Pe=ne;Pe<Xe;Pe++)Ae[L=4*be*tt+4*Pe]=Z,Ae[L+1]=te,Ae[L+2]=ae,Ae[L+3]=fe},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(P,L){return{uBlocksize:P.getUniformLocation(L,"uBlocksize"),uStepW:P.getUniformLocation(L,"uStepW"),uStepH:P.getUniformLocation(L,"uStepH")}},sendUniformData:function(P,L){P.uniform1f(L.uBlocksize,this.blocksize)}}),F.Image.filters.Pixelate.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.util.object.extend,$=F.Image.filters;$.RemoveColor=(0,F.util.createClass)($.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(L){var X,ne,Z,te,ae=L.imageData.data,fe=255*this.distance,be=new F.Color(this.color).getSource(),Pe=[be[0]-fe,be[1]-fe,be[2]-fe],De=[be[0]+fe,be[1]+fe,be[2]+fe];for(X=0;X<ae.length;X+=4)Z=ae[X+1],te=ae[X+2],(ne=ae[X])>Pe[0]&&Z>Pe[1]&&te>Pe[2]&&ne<De[0]&&Z<De[1]&&te<De[2]&&(ae[X+3]=0)},getUniformLocations:function(L,X){return{uLow:L.getUniformLocation(X,"uLow"),uHigh:L.getUniformLocation(X,"uHigh")}},sendUniformData:function(L,X){var ne=new F.Color(this.color).getSource(),Z=parseFloat(this.distance),ae=[ne[0]/255+Z,ne[1]/255+Z,ne[2]/255+Z,1];L.uniform4fv(X.uLow,[0+ne[0]/255-Z,0+ne[1]/255-Z,0+ne[2]/255-Z,1]),L.uniform4fv(X.uHigh,ae)},toObject:function(){return z(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),F.Image.filters.RemoveColor.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters,$=F.util.createClass,P={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var L in P)z[L]=$(z.ColorMatrix,{type:L,matrix:P[L],mainParameter:!1,colorsOnly:!0}),F.Image.filters[L].fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric,z=F.Image.filters;z.BlendColor=(0,F.util.createClass)(z.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(P){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[P]+"}\n}"},retrieveShader:function(P){var L,X=this.type+"_"+this.mode;return P.programCache.hasOwnProperty(X)||(L=this.buildSource(this.mode),P.programCache[X]=this.createProgram(P.context,L)),P.programCache[X]},applyTo2d:function(P){var L,X,ne,Z,te,ae,fe,be=P.imageData.data,Pe=be.length,De=1-this.alpha;L=(fe=new F.Color(this.color).getSource())[0]*this.alpha,X=fe[1]*this.alpha,ne=fe[2]*this.alpha;for(var Xe=0;Xe<Pe;Xe+=4)switch(Z=be[Xe],te=be[Xe+1],ae=be[Xe+2],this.mode){case"multiply":be[Xe]=Z*L/255,be[Xe+1]=te*X/255,be[Xe+2]=ae*ne/255;break;case"screen":be[Xe]=255-(255-Z)*(255-L)/255,be[Xe+1]=255-(255-te)*(255-X)/255,be[Xe+2]=255-(255-ae)*(255-ne)/255;break;case"add":be[Xe]=Z+L,be[Xe+1]=te+X,be[Xe+2]=ae+ne;break;case"diff":case"difference":be[Xe]=Math.abs(Z-L),be[Xe+1]=Math.abs(te-X),be[Xe+2]=Math.abs(ae-ne);break;case"subtract":be[Xe]=Z-L,be[Xe+1]=te-X,be[Xe+2]=ae-ne;break;case"darken":be[Xe]=Math.min(Z,L),be[Xe+1]=Math.min(te,X),be[Xe+2]=Math.min(ae,ne);break;case"lighten":be[Xe]=Math.max(Z,L),be[Xe+1]=Math.max(te,X),be[Xe+2]=Math.max(ae,ne);break;case"overlay":be[Xe]=L<128?2*Z*L/255:255-2*(255-Z)*(255-L)/255,be[Xe+1]=X<128?2*te*X/255:255-2*(255-te)*(255-X)/255,be[Xe+2]=ne<128?2*ae*ne/255:255-2*(255-ae)*(255-ne)/255;break;case"exclusion":be[Xe]=L+Z-2*L*Z/255,be[Xe+1]=X+te-2*X*te/255,be[Xe+2]=ne+ae-2*ne*ae/255;break;case"tint":be[Xe]=L+Z*De,be[Xe+1]=X+te*De,be[Xe+2]=ne+ae*De}},getUniformLocations:function(P,L){return{uColor:P.getUniformLocation(L,"uColor")}},sendUniformData:function(P,L){var X=new F.Color(this.color).getSource();X[0]=this.alpha*X[0]/255,X[1]=this.alpha*X[1]/255,X[2]=this.alpha*X[2]/255,X[3]=this.alpha,P.uniform4fv(L.uColor,X)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),F.Image.filters.BlendColor.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric,z=F.Image.filters;z.BlendImage=(0,F.util.createClass)(z.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(P){var L=this.type+"_"+this.mode,X=this.fragmentSource[this.mode];return P.programCache.hasOwnProperty(L)||(P.programCache[L]=this.createProgram(P.context,X)),P.programCache[L]},applyToWebGL:function(P){var L=P.context,X=this.createTexture(P.filterBackend,this.image);this.bindAdditionalTexture(L,X,L.TEXTURE1),this.callSuper("applyToWebGL",P),this.unbindAdditionalTexture(L,L.TEXTURE1)},createTexture:function(P,L){return P.getCachedTexture(L.cacheKey,L._element)},calculateMatrix:function(){var P=this.image;return[1/P.scaleX,0,0,0,1/P.scaleY,0,-P.left/P._element.width,-P.top/P._element.height,1]},applyTo2d:function(P){var L,X,ne,Z,te,ae,fe,be,Pe,De,Xe,Re=P.imageData,Ae=P.filterBackend.resources,de=Re.data,tt=de.length,Ze=Re.width,et=Re.height,Qe=this.image;Ae.blendImage||(Ae.blendImage=F.util.createCanvasElement()),De=(Pe=Ae.blendImage).getContext("2d"),Pe.width!==Ze||Pe.height!==et?(Pe.width=Ze,Pe.height=et):De.clearRect(0,0,Ze,et),De.setTransform(Qe.scaleX,0,0,Qe.scaleY,Qe.left,Qe.top),De.drawImage(Qe._element,0,0,Ze,et),Xe=De.getImageData(0,0,Ze,et).data;for(var Je=0;Je<tt;Je+=4)switch(te=de[Je],ae=de[Je+1],fe=de[Je+2],be=de[Je+3],L=Xe[Je],X=Xe[Je+1],ne=Xe[Je+2],Z=Xe[Je+3],this.mode){case"multiply":de[Je]=te*L/255,de[Je+1]=ae*X/255,de[Je+2]=fe*ne/255,de[Je+3]=be*Z/255;break;case"mask":de[Je+3]=Z}},getUniformLocations:function(P,L){return{uTransformMatrix:P.getUniformLocation(L,"uTransformMatrix"),uImage:P.getUniformLocation(L,"uImage")}},sendUniformData:function(P,L){var X=this.calculateMatrix();P.uniform1i(L.uImage,1),P.uniformMatrix3fv(L.uTransformMatrix,!1,X)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),F.Image.filters.BlendImage.fromObject=function(P,L){F.Image.fromObject(P.image,function(X){var ne=F.util.object.clone(P);ne.image=X,L(new F.Image.filters.BlendImage(ne))})}}(l),function(V){var F=V.fabric||(V.fabric={}),z=Math.pow,$=Math.floor,P=Math.sqrt,L=Math.abs,X=Math.round,ne=Math.sin,Z=Math.ceil,te=F.Image.filters;te.Resize=(0,F.util.createClass)(te.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(fe,be){return{uDelta:fe.getUniformLocation(be,"uDelta"),uTaps:fe.getUniformLocation(be,"uTaps")}},sendUniformData:function(fe,be){fe.uniform2fv(be.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),fe.uniform1fv(be.uTaps,this.taps)},retrieveShader:function(fe){var be=this.getFilterWindow(),Pe=this.type+"_"+be;if(!fe.programCache.hasOwnProperty(Pe)){var De=this.generateShader(be);fe.programCache[Pe]=this.createProgram(fe.context,De)}return fe.programCache[Pe]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var fe=this.lanczosCreate(this.lanczosLobes),be=this.tempScale,Pe=this.getFilterWindow(),De=new Array(Pe),Xe=1;Xe<=Pe;Xe++)De[Xe-1]=fe(Xe*be);return De},generateShader:function(fe){for(var be=new Array(fe),Pe=this.fragmentSourceTOP,De=1;De<=fe;De++)be[De-1]=De+".0 * uDelta";return Pe+="uniform float uTaps["+fe+"];\n",Pe+="void main() {\n",Pe+="  vec4 color = texture2D(uTexture, vTexCoord);\n",Pe+="  float sum = 1.0;\n",be.forEach(function(Xe,Re){Pe+="  color += texture2D(uTexture, vTexCoord + "+Xe+") * uTaps["+Re+"];\n",Pe+="  color += texture2D(uTexture, vTexCoord - "+Xe+") * uTaps["+Re+"];\n",Pe+="  sum += 2.0 * uTaps["+Re+"];\n"}),Pe+="  gl_FragColor = color / sum;\n",Pe+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(fe){fe.webgl?(fe.passes++,this.width=fe.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=fe.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),fe.destinationWidth=this.dW,this._setupFrameBuffer(fe),this.applyToWebGL(fe),this._swapTextures(fe),fe.sourceWidth=fe.destinationWidth,this.height=fe.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),fe.destinationHeight=this.dH,this._setupFrameBuffer(fe),this.applyToWebGL(fe),this._swapTextures(fe),fe.sourceHeight=fe.destinationHeight):this.applyTo2d(fe)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(fe){return function(be){if(be>=fe||be<=-fe)return 0;if(be<1.1920929e-7&&be>-1.1920929e-7)return 1;var Pe=(be*=Math.PI)/fe;return ne(be)/be*ne(Pe)/Pe}},applyTo2d:function(fe){var be=fe.imageData,Pe=this.scaleX,De=this.scaleY;this.rcpScaleX=1/Pe,this.rcpScaleY=1/De;var Xe,Re=be.width,Ae=be.height,de=X(Re*Pe),tt=X(Ae*De);"sliceHack"===this.resizeType?Xe=this.sliceByTwo(fe,Re,Ae,de,tt):"hermite"===this.resizeType?Xe=this.hermiteFastResize(fe,Re,Ae,de,tt):"bilinear"===this.resizeType?Xe=this.bilinearFiltering(fe,Re,Ae,de,tt):"lanczos"===this.resizeType&&(Xe=this.lanczosResize(fe,Re,Ae,de,tt)),fe.imageData=Xe},sliceByTwo:function(fe,be,Pe,De,Xe){var Re,Ae,de=fe.imageData,Ze=!1,et=!1,Qe=.5*be,Je=.5*Pe,st=F.filterBackend.resources,mt=0,ut=0,Ke=be,nt=0;for(st.sliceByTwo||(st.sliceByTwo=document.createElement("canvas")),((Re=st.sliceByTwo).width<1.5*be||Re.height<Pe)&&(Re.width=1.5*be,Re.height=Pe),(Ae=Re.getContext("2d")).clearRect(0,0,1.5*be,Pe),Ae.putImageData(de,0,0),De=$(De),Xe=$(Xe);!Ze||!et;)be=Qe,Pe=Je,De<$(.5*Qe)?Qe=$(.5*Qe):(Qe=De,Ze=!0),Xe<$(.5*Je)?Je=$(.5*Je):(Je=Xe,et=!0),Ae.drawImage(Re,mt,ut,be,Pe,Ke,nt,Qe,Je),mt=Ke,ut=nt,nt+=Je;return Ae.getImageData(mt,ut,De,Xe)},lanczosResize:function(fe,be,Pe,De,Xe){var Re=fe.imageData.data,Ae=fe.ctx.createImageData(De,Xe),de=Ae.data,tt=this.lanczosCreate(this.lanczosLobes),Ze=this.rcpScaleX,et=this.rcpScaleY,Qe=2/this.rcpScaleX,Je=2/this.rcpScaleY,st=Z(Ze*this.lanczosLobes/2),mt=Z(et*this.lanczosLobes/2),ut={},Ke={},nt={};return function lt(xt){var dt,Dt,Rt,Nt,Ot,Vt,$t,on,dn,sn,bn;for(Ke.x=(xt+.5)*Ze,nt.x=$(Ke.x),dt=0;dt<Xe;dt++){for(Ke.y=(dt+.5)*et,nt.y=$(Ke.y),Ot=0,Vt=0,$t=0,on=0,dn=0,Dt=nt.x-st;Dt<=nt.x+st;Dt++)if(!(Dt<0||Dt>=be)){sn=$(1e3*L(Dt-Ke.x)),ut[sn]||(ut[sn]={});for(var ct=nt.y-mt;ct<=nt.y+mt;ct++)ct<0||ct>=Pe||(bn=$(1e3*L(ct-Ke.y)),ut[sn][bn]||(ut[sn][bn]=tt(P(z(sn*Qe,2)+z(bn*Je,2))/1e3)),(Rt=ut[sn][bn])>0&&(Ot+=Rt,Vt+=Rt*Re[Nt=4*(ct*be+Dt)],$t+=Rt*Re[Nt+1],on+=Rt*Re[Nt+2],dn+=Rt*Re[Nt+3]))}de[Nt=4*(dt*De+xt)]=Vt/Ot,de[Nt+1]=$t/Ot,de[Nt+2]=on/Ot,de[Nt+3]=dn/Ot}return++xt<De?lt(xt):Ae}(0)},bilinearFiltering:function(fe,be,Pe,De,Xe){var Re,Ae,de,tt,Ze,et,Qe,st,mt=0,ut=this.rcpScaleX,Ke=this.rcpScaleY,nt=4*(be-1),lt=fe.imageData.data,xt=fe.ctx.createImageData(De,Xe),dt=xt.data;for(de=0;de<Xe;de++)for(tt=0;tt<De;tt++)for(Ze=ut*tt-(Re=$(ut*tt)),et=Ke*de-(Ae=$(Ke*de)),st=4*(Ae*be+Re),Qe=0;Qe<4;Qe++)dt[mt++]=lt[st+Qe]*(1-Ze)*(1-et)+lt[st+4+Qe]*Ze*(1-et)+lt[st+nt+Qe]*et*(1-Ze)+lt[st+nt+4+Qe]*Ze*et;return xt},hermiteFastResize:function(fe,be,Pe,De,Xe){for(var Re=this.rcpScaleX,Ae=this.rcpScaleY,de=Z(Re/2),tt=Z(Ae/2),Ze=fe.imageData.data,et=fe.ctx.createImageData(De,Xe),Qe=et.data,Je=0;Je<Xe;Je++)for(var st=0;st<De;st++){for(var mt=4*(st+Je*De),ut=0,Ke=0,nt=0,lt=0,xt=0,dt=0,Dt=0,Rt=(Je+.5)*Ae,Nt=$(Je*Ae);Nt<(Je+1)*Ae;Nt++)for(var Ot=L(Rt-(Nt+.5))/tt,Vt=(st+.5)*Re,$t=Ot*Ot,on=$(st*Re);on<(st+1)*Re;on++){var dn=L(Vt-(on+.5))/de,sn=P($t+dn*dn);sn>1&&sn<-1||(ut=2*sn*sn*sn-3*sn*sn+1)>0&&(Dt+=ut*Ze[3+(dn=4*(on+Nt*be))],nt+=ut,Ze[dn+3]<255&&(ut=ut*Ze[dn+3]/250),lt+=ut*Ze[dn],xt+=ut*Ze[dn+1],dt+=ut*Ze[dn+2],Ke+=ut)}Qe[mt]=lt/Ke,Qe[mt+1]=xt/Ke,Qe[mt+2]=dt/Ke,Qe[mt+3]=Dt/nt}return et},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),F.Image.filters.Resize.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.Contrast=(0,F.util.createClass)(z.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(P){if(0!==this.contrast){var L,X=P.imageData.data,ne=X.length,Z=Math.floor(255*this.contrast),te=259*(Z+255)/(255*(259-Z));for(L=0;L<ne;L+=4)X[L]=te*(X[L]-128)+128,X[L+1]=te*(X[L+1]-128)+128,X[L+2]=te*(X[L+2]-128)+128}},getUniformLocations:function(P,L){return{uContrast:P.getUniformLocation(L,"uContrast")}},sendUniformData:function(P,L){P.uniform1f(L.uContrast,this.contrast)}}),F.Image.filters.Contrast.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.Saturation=(0,F.util.createClass)(z.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(P){if(0!==this.saturation){var L,X,ne=P.imageData.data,Z=ne.length,te=-this.saturation;for(L=0;L<Z;L+=4)X=Math.max(ne[L],ne[L+1],ne[L+2]),ne[L]+=X!==ne[L]?(X-ne[L])*te:0,ne[L+1]+=X!==ne[L+1]?(X-ne[L+1])*te:0,ne[L+2]+=X!==ne[L+2]?(X-ne[L+2])*te:0}},getUniformLocations:function(P,L){return{uSaturation:P.getUniformLocation(L,"uSaturation")}},sendUniformData:function(P,L){P.uniform1f(L.uSaturation,-this.saturation)}}),F.Image.filters.Saturation.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.Vibrance=(0,F.util.createClass)(z.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(P){if(0!==this.vibrance){var L,X,Z,te=P.imageData.data,ae=te.length,fe=-this.vibrance;for(L=0;L<ae;L+=4)X=Math.max(te[L],te[L+1],te[L+2]),Z=2*Math.abs(X-(te[L]+te[L+1]+te[L+2])/3)/255*fe,te[L]+=X!==te[L]?(X-te[L])*Z:0,te[L+1]+=X!==te[L+1]?(X-te[L+1])*Z:0,te[L+2]+=X!==te[L+2]?(X-te[L+2])*Z:0}},getUniformLocations:function(P,L){return{uVibrance:P.getUniformLocation(L,"uVibrance")}},sendUniformData:function(P,L){P.uniform1f(L.uVibrance,-this.vibrance)}}),F.Image.filters.Vibrance.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.Blur=(0,F.util.createClass)(z.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(P){P.webgl?(this.aspectRatio=P.sourceWidth/P.sourceHeight,P.passes++,this._setupFrameBuffer(P),this.horizontal=!0,this.applyToWebGL(P),this._swapTextures(P),this._setupFrameBuffer(P),this.horizontal=!1,this.applyToWebGL(P),this._swapTextures(P)):this.applyTo2d(P)},applyTo2d:function(P){P.imageData=this.simpleBlur(P)},simpleBlur:function(P){var L,X,ne=P.filterBackend.resources,Z=P.imageData.width,te=P.imageData.height;ne.blurLayer1||(ne.blurLayer1=F.util.createCanvasElement(),ne.blurLayer2=F.util.createCanvasElement()),X=ne.blurLayer2,(L=ne.blurLayer1).width===Z&&L.height===te||(X.width=L.width=Z,X.height=L.height=te);var ae,fe,be,Pe,De=L.getContext("2d"),Xe=X.getContext("2d"),Re=.06*this.blur*.5;for(De.putImageData(P.imageData,0,0),Xe.clearRect(0,0,Z,te),Pe=-15;Pe<=15;Pe++)be=Re*(fe=Pe/15)*Z+(ae=(Math.random()-.5)/4),Xe.globalAlpha=1-Math.abs(fe),Xe.drawImage(L,be,ae),De.drawImage(X,0,0),Xe.globalAlpha=1,Xe.clearRect(0,0,X.width,X.height);for(Pe=-15;Pe<=15;Pe++)be=Re*(fe=Pe/15)*te+(ae=(Math.random()-.5)/4),Xe.globalAlpha=1-Math.abs(fe),Xe.drawImage(L,ae,be),De.drawImage(X,0,0),Xe.globalAlpha=1,Xe.clearRect(0,0,X.width,X.height);P.ctx.drawImage(L,0,0);var Ae=P.ctx.getImageData(0,0,L.width,L.height);return De.globalAlpha=1,De.clearRect(0,0,L.width,L.height),Ae},getUniformLocations:function(P,L){return{delta:P.getUniformLocation(L,"uDelta")}},sendUniformData:function(P,L){var X=this.chooseRightDelta();P.uniform2fv(L.delta,X)},chooseRightDelta:function(){var P,L=1,X=[0,0];return this.horizontal?this.aspectRatio>1&&(L=1/this.aspectRatio):this.aspectRatio<1&&(L=this.aspectRatio),P=L*this.blur*.12,this.horizontal?X[0]=P:X[1]=P,X}}),z.Blur.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.Gamma=(0,F.util.createClass)(z.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(P){this.gamma=[1,1,1],z.BaseFilter.prototype.initialize.call(this,P)},applyTo2d:function(P){var L,X=P.imageData.data,ne=this.gamma,Z=X.length,te=1/ne[0],ae=1/ne[1],fe=1/ne[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),L=0,Z=256;L<Z;L++)this.rVals[L]=255*Math.pow(L/255,te),this.gVals[L]=255*Math.pow(L/255,ae),this.bVals[L]=255*Math.pow(L/255,fe);for(L=0,Z=X.length;L<Z;L+=4)X[L]=this.rVals[X[L]],X[L+1]=this.gVals[X[L+1]],X[L+2]=this.bVals[X[L+2]]},getUniformLocations:function(P,L){return{uGamma:P.getUniformLocation(L,"uGamma")}},sendUniformData:function(P,L){P.uniform3fv(L.uGamma,this.gamma)}}),F.Image.filters.Gamma.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.Composed=(0,F.util.createClass)(z.BaseFilter,{type:"Composed",subFilters:[],initialize:function(P){this.callSuper("initialize",P),this.subFilters=this.subFilters.slice(0)},applyTo:function(P){P.passes+=this.subFilters.length-1,this.subFilters.forEach(function(L){L.applyTo(P)})},toObject:function(){return F.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(P){return P.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(P){return!P.isNeutralState()})}}),F.Image.filters.Composed.fromObject=function(P,L){var X=(P.subFilters||[]).map(function(Z){return new F.Image.filters[Z.type](Z)}),ne=new F.Image.filters.Composed({subFilters:X});return L&&L(ne),ne}}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.Image.filters;z.HueRotation=(0,F.util.createClass)(z.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var P=this.rotation*Math.PI,L=F.util.cos(P),X=F.util.sin(P),ne=1/3,Z=Math.sqrt(ne)*X,te=1-L;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=L+te/3,this.matrix[1]=ne*te-Z,this.matrix[2]=ne*te+Z,this.matrix[5]=ne*te+Z,this.matrix[6]=L+ne*te,this.matrix[7]=ne*te-Z,this.matrix[10]=ne*te-Z,this.matrix[11]=ne*te+Z,this.matrix[12]=L+ne*te},isNeutralState:function(P){return this.calculateMatrix(),z.BaseFilter.prototype.isNeutralState.call(this,P)},applyTo:function(P){this.calculateMatrix(),z.BaseFilter.prototype.applyTo.call(this,P)}}),F.Image.filters.HueRotation.fromObject=F.Image.filters.BaseFilter.fromObject}(l),function(V){var F=V.fabric||(V.fabric={}),z=F.util.object.clone;if(F.Text)F.warn("fabric.Text is already defined");else{var $="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");F.Text=F.util.createClass(F.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:F.Object.prototype.stateProperties.concat($),cacheProperties:F.Object.prototype.cacheProperties.concat($),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(P,L){this.styles=L&&L.styles||{},this.text=P,this.__skipDimension=!0,this.callSuper("initialize",L),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var P=this.path;P&&(P.segmentsInfo=F.util.getPathSegmentsInfo(P.path))},getMeasuringContext:function(){return F._measuringContext||(F._measuringContext=this.canvas&&this.canvas.contextCache||F.util.createCanvasElement().getContext("2d")),F._measuringContext},_splitText:function(){var P=this._splitTextIntoLines(this.text);return this.textLines=P.lines,this._textLines=P.graphemeLines,this._unwrappedTextLines=P._unwrappedLines,this._text=P.graphemeText,P},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var P,L,ne,Z,te,ae,fe=0,be=this._textLines.length;fe<be;fe++)if(("justify"===this.textAlign||fe!==be-1&&!this.isEndOfWrapping(fe))&&(ne=0,Z=this._textLines[fe],(L=this.getLineWidth(fe))<this.width&&(ae=this.textLines[fe].match(this._reSpacesAndTabs)))){P=(this.width-L)/ae.length;for(var Pe=0,De=Z.length;Pe<=De;Pe++)te=this.__charBounds[fe][Pe],this._reSpaceAndTab.test(Z[Pe])?(te.width+=P,te.kernedWidth+=P,te.left+=ne,ne+=P):te.left+=ne}},isEndOfWrapping:function(P){return P===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var P=this.callSuper("_getCacheCanvasDimensions"),L=this.fontSize;return P.width+=L*P.zoomX,P.height+=L*P.zoomY,P},_render:function(P){var L=this.path;L&&!L.isNotVisible()&&L._render(P),this._setTextStyles(P),this._renderTextLinesBackground(P),this._renderTextDecoration(P,"underline"),this._renderText(P),this._renderTextDecoration(P,"overline"),this._renderTextDecoration(P,"linethrough")},_renderText:function(P){"stroke"===this.paintFirst?(this._renderTextStroke(P),this._renderTextFill(P)):(this._renderTextFill(P),this._renderTextStroke(P))},_setTextStyles:function(P,L,X){if(P.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":P.textBaseline="middle";break;case"ascender":P.textBaseline="top";break;case"descender":P.textBaseline="bottom"}P.font=this._getFontDeclaration(L,X)},calcTextWidth:function(){for(var P=this.getLineWidth(0),L=1,X=this._textLines.length;L<X;L++){var ne=this.getLineWidth(L);ne>P&&(P=ne)}return P},_renderTextLine:function(P,L,X,ne,Z,te){this._renderChars(P,L,X,ne,Z,te)},_renderTextLinesBackground:function(P){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var L,X,ne,Z,te,ae,fe,be=P.fillStyle,Pe=this._getLeftOffset(),De=this._getTopOffset(),Xe=0,Re=0,Ae=this.path,de=0,tt=this._textLines.length;de<tt;de++)if(L=this.getHeightOfLine(de),this.textBackgroundColor||this.styleHas("textBackgroundColor",de)){ne=this._textLines[de],X=this._getLineLeftOffset(de),Re=0,Xe=0,Z=this.getValueOfPropertyAt(de,0,"textBackgroundColor");for(var Ze=0,et=ne.length;Ze<et;Ze++)te=this.__charBounds[de][Ze],ae=this.getValueOfPropertyAt(de,Ze,"textBackgroundColor"),Ae?(P.save(),P.translate(te.renderLeft,te.renderTop),P.rotate(te.angle),P.fillStyle=ae,ae&&P.fillRect(-te.width/2,-L/this.lineHeight*(1-this._fontSizeFraction),te.width,L/this.lineHeight),P.restore()):ae!==Z?(fe=Pe+X+Xe,"rtl"===this.direction&&(fe=this.width-fe-Re),P.fillStyle=Z,Z&&P.fillRect(fe,De,Re,L/this.lineHeight),Xe=te.left,Re=te.width,Z=ae):Re+=te.kernedWidth;ae&&!Ae&&(fe=Pe+X+Xe,"rtl"===this.direction&&(fe=this.width-fe-Re),P.fillStyle=ae,P.fillRect(fe,De,Re,L/this.lineHeight)),De+=L}else De+=L;P.fillStyle=be,this._removeShadow(P)}},getFontCache:function(P){var L=P.fontFamily.toLowerCase();F.charWidthsCache[L]||(F.charWidthsCache[L]={});var X=F.charWidthsCache[L],ne=P.fontStyle.toLowerCase()+"_"+(P.fontWeight+"").toLowerCase();return X[ne]||(X[ne]={}),X[ne]},_measureChar:function(P,L,X,ne){var Z,te,ae,fe,be=this.getFontCache(L),Pe=X+P,De=this._getFontDeclaration(L)===this._getFontDeclaration(ne),Xe=L.fontSize/this.CACHE_FONT_SIZE;if(X&&void 0!==be[X]&&(ae=be[X]),void 0!==be[P]&&(fe=Z=be[P]),De&&void 0!==be[Pe]&&(fe=(te=be[Pe])-ae),void 0===Z||void 0===ae||void 0===te){var Re=this.getMeasuringContext();this._setTextStyles(Re,L,!0)}return void 0===Z&&(fe=Z=Re.measureText(P).width,be[P]=Z),void 0===ae&&De&&X&&(ae=Re.measureText(X).width,be[X]=ae),De&&void 0===te&&(te=Re.measureText(Pe).width,be[Pe]=te,fe=te-ae),{width:Z*Xe,kernedWidth:fe*Xe}},getHeightOfChar:function(P,L){return this.getValueOfPropertyAt(P,L,"fontSize")},measureLine:function(P){var L=this._measureLine(P);return 0!==this.charSpacing&&(L.width-=this._getWidthOfCharSpacing()),L.width<0&&(L.width=0),L},_measureLine:function(P){var L,X,ne,Z,te,ae,fe=0,be=this._textLines[P],Pe=new Array(be.length),De=0,Xe=this.path,Re="right"===this.pathSide;for(this.__charBounds[P]=Pe,L=0;L<be.length;L++)Z=this._getGraphemeBox(X=be[L],P,L,ne),Pe[L]=Z,fe+=Z.kernedWidth,ne=X;if(Pe[L]={left:Z?Z.left+Z.width:0,width:0,kernedWidth:0,height:this.fontSize},Xe){switch(ae=Xe.segmentsInfo[Xe.segmentsInfo.length-1].length,(te=F.util.getPointOnPath(Xe.path,0,Xe.segmentsInfo)).x+=Xe.pathOffset.x,te.y+=Xe.pathOffset.y,this.textAlign){case"left":De=Re?ae-fe:0;break;case"center":De=(ae-fe)/2;break;case"right":De=Re?0:ae-fe}for(De+=this.pathStartOffset*(Re?-1:1),L=Re?be.length-1:0;Re?L>=0:L<be.length;Re?L--:L++)De>ae?De%=ae:De<0&&(De+=ae),this._setGraphemeOnPath(De,Z=Pe[L],te),De+=Z.kernedWidth}return{width:fe,numOfSpaces:0}},_setGraphemeOnPath:function(P,L,X){var Z=this.path,te=F.util.getPointOnPath(Z.path,P+L.kernedWidth/2,Z.segmentsInfo);L.renderLeft=te.x-X.x,L.renderTop=te.y-X.y,L.angle=te.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(P,L,X,ne,Z){var te,ae=this.getCompleteStyleDeclaration(L,X),fe=ne?this.getCompleteStyleDeclaration(L,X-1):{},be=this._measureChar(P,ae,ne,fe),Pe=be.kernedWidth,De=be.width;0!==this.charSpacing&&(De+=te=this._getWidthOfCharSpacing(),Pe+=te);var Xe={width:De,left:0,height:ae.fontSize,kernedWidth:Pe,deltaY:ae.deltaY};if(X>0&&!Z){var Re=this.__charBounds[L][X-1];Xe.left=Re.left+Re.width+be.kernedWidth-be.width}return Xe},getHeightOfLine:function(P){if(this.__lineHeights[P])return this.__lineHeights[P];for(var L=this._textLines[P],X=this.getHeightOfChar(P,0),ne=1,Z=L.length;ne<Z;ne++)X=Math.max(this.getHeightOfChar(P,ne),X);return this.__lineHeights[P]=X*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var P,L=0,X=0,ne=this._textLines.length;X<ne;X++)P=this.getHeightOfLine(X),L+=X===ne-1?P/this.lineHeight:P;return L},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(P,L){P.save();for(var X=0,ne=this._getLeftOffset(),Z=this._getTopOffset(),te=0,ae=this._textLines.length;te<ae;te++){var fe=this.getHeightOfLine(te),be=fe/this.lineHeight,Pe=this._getLineLeftOffset(te);this._renderTextLine(L,P,this._textLines[te],ne+Pe,Z+X+be,te),X+=fe}P.restore()},_renderTextFill:function(P){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(P,"fillText")},_renderTextStroke:function(P){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(P),P.save(),this._setLineDash(P,this.strokeDashArray),P.beginPath(),this._renderTextCommon(P,"strokeText"),P.closePath(),P.restore())},_renderChars:function(P,L,X,ne,Z,te){var ae,fe,be,Pe,Xe=this.getHeightOfLine(te),Re=-1!==this.textAlign.indexOf("justify"),Ae="",de=0,tt=this.path,Ze=!Re&&0===this.charSpacing&&this.isEmptyStyles(te)&&!tt,et="ltr"===this.direction,Qe="ltr"===this.direction?1:-1,Je=L.canvas.getAttribute("dir");if(L.save(),Je!==this.direction&&(L.canvas.setAttribute("dir",et?"ltr":"rtl"),L.direction=et?"ltr":"rtl",L.textAlign=et?"left":"right"),Z-=Xe*this._fontSizeFraction/this.lineHeight,Ze)return this._renderChar(P,L,te,0,X.join(""),ne,Z,Xe),void L.restore();for(var st=0,mt=X.length-1;st<=mt;st++)Pe=st===mt||this.charSpacing||tt,Ae+=X[st],be=this.__charBounds[te][st],0===de?(ne+=Qe*(be.kernedWidth-be.width),de+=be.width):de+=be.kernedWidth,Re&&!Pe&&this._reSpaceAndTab.test(X[st])&&(Pe=!0),Pe||(ae=ae||this.getCompleteStyleDeclaration(te,st),fe=this.getCompleteStyleDeclaration(te,st+1),Pe=this._hasStyleChanged(ae,fe)),Pe&&(tt?(L.save(),L.translate(be.renderLeft,be.renderTop),L.rotate(be.angle),this._renderChar(P,L,te,st,Ae,-de/2,0,Xe),L.restore()):this._renderChar(P,L,te,st,Ae,ne,Z,Xe),Ae="",ae=fe,ne+=Qe*de,de=0);L.restore()},_applyPatternGradientTransformText:function(P){var L,X=F.util.createCanvasElement(),ne=this.width+this.strokeWidth,Z=this.height+this.strokeWidth;return X.width=ne,X.height=Z,(L=X.getContext("2d")).beginPath(),L.moveTo(0,0),L.lineTo(ne,0),L.lineTo(ne,Z),L.lineTo(0,Z),L.closePath(),L.translate(ne/2,Z/2),L.fillStyle=P.toLive(L),this._applyPatternGradientTransform(L,P),L.fill(),L.createPattern(X,"no-repeat")},handleFiller:function(P,L,X){var ne,Z;return X.toLive?"percentage"===X.gradientUnits||X.gradientTransform||X.patternTransform?(P.translate(ne=-this.width/2,Z=-this.height/2),P[L]=this._applyPatternGradientTransformText(X),{offsetX:ne,offsetY:Z}):(P[L]=X.toLive(P,this),this._applyPatternGradientTransform(P,X)):(P[L]=X,{offsetX:0,offsetY:0})},_setStrokeStyles:function(P,L){return P.lineWidth=L.strokeWidth,P.lineCap=this.strokeLineCap,P.lineDashOffset=this.strokeDashOffset,P.lineJoin=this.strokeLineJoin,P.miterLimit=this.strokeMiterLimit,this.handleFiller(P,"strokeStyle",L.stroke)},_setFillStyles:function(P,L){return this.handleFiller(P,"fillStyle",L.fill)},_renderChar:function(P,L,X,ne,Z,te,ae){var fe,be,Pe=this._getStyleDeclaration(X,ne),De=this.getCompleteStyleDeclaration(X,ne),Xe="fillText"===P&&De.fill,Re="strokeText"===P&&De.stroke&&De.strokeWidth;(Re||Xe)&&(L.save(),Xe&&(fe=this._setFillStyles(L,De)),Re&&(be=this._setStrokeStyles(L,De)),L.font=this._getFontDeclaration(De),Pe&&Pe.textBackgroundColor&&this._removeShadow(L),Pe&&Pe.deltaY&&(ae+=Pe.deltaY),Xe&&L.fillText(Z,te-fe.offsetX,ae-fe.offsetY),Re&&L.strokeText(Z,te-be.offsetX,ae-be.offsetY),L.restore())},setSuperscript:function(P,L){return this._setScript(P,L,this.superscript)},setSubscript:function(P,L){return this._setScript(P,L,this.subscript)},_setScript:function(P,L,X){var ne=this.get2DCursorLocation(P,!0),Z=this.getValueOfPropertyAt(ne.lineIndex,ne.charIndex,"fontSize"),te=this.getValueOfPropertyAt(ne.lineIndex,ne.charIndex,"deltaY");return this.setSelectionStyles({fontSize:Z*X.size,deltaY:te+Z*X.baseline},P,L),this},_hasStyleChanged:function(P,L){return P.fill!==L.fill||P.stroke!==L.stroke||P.strokeWidth!==L.strokeWidth||P.fontSize!==L.fontSize||P.fontFamily!==L.fontFamily||P.fontWeight!==L.fontWeight||P.fontStyle!==L.fontStyle||P.deltaY!==L.deltaY},_hasStyleChangedForSvg:function(P,L){return this._hasStyleChanged(P,L)||P.overline!==L.overline||P.underline!==L.underline||P.linethrough!==L.linethrough},_getLineLeftOffset:function(P){var L=this.getLineWidth(P),X=this.width-L,ne=this.textAlign,Z=this.direction,te=0,ae=this.isEndOfWrapping(P);return"justify"===ne||"justify-center"===ne&&!ae||"justify-right"===ne&&!ae||"justify-left"===ne&&!ae?0:("center"===ne&&(te=X/2),"right"===ne&&(te=X),"justify-center"===ne&&(te=X/2),"justify-right"===ne&&(te=X),"rtl"===Z&&(te-=X),te)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var P=this._forceClearCache;return P||(P=this.hasStateChanged("_dimensionAffectingProps")),P&&(this.dirty=!0,this._forceClearCache=!1),P},getLineWidth:function(P){if(void 0!==this.__lineWidths[P])return this.__lineWidths[P];var L=this.measureLine(P).width;return this.__lineWidths[P]=L,L},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(P,L,X){var ne=this._getStyleDeclaration(P,L);return ne&&void 0!==ne[X]?ne[X]:this[X]},_renderTextDecoration:function(P,L){if(this[L]||this.styleHas(L)){for(var X,ne,Z,te,ae,fe,be,Pe,De,Xe,Re,Ae,de,tt,Ze,et,Qe=this._getLeftOffset(),Je=this._getTopOffset(),st=this.path,mt=this._getWidthOfCharSpacing(),ut=this.offsets[L],Ke=0,nt=this._textLines.length;Ke<nt;Ke++)if(X=this.getHeightOfLine(Ke),this[L]||this.styleHas(L,Ke)){be=this._textLines[Ke],tt=X/this.lineHeight,te=this._getLineLeftOffset(Ke),Xe=0,Re=0,Pe=this.getValueOfPropertyAt(Ke,0,L),et=this.getValueOfPropertyAt(Ke,0,"fill"),De=Je+tt*(1-this._fontSizeFraction),ne=this.getHeightOfChar(Ke,0),ae=this.getValueOfPropertyAt(Ke,0,"deltaY");for(var lt=0,xt=be.length;lt<xt;lt++)if(Ae=this.__charBounds[Ke][lt],de=this.getValueOfPropertyAt(Ke,lt,L),Ze=this.getValueOfPropertyAt(Ke,lt,"fill"),Z=this.getHeightOfChar(Ke,lt),fe=this.getValueOfPropertyAt(Ke,lt,"deltaY"),st&&de&&Ze)P.save(),P.fillStyle=et,P.translate(Ae.renderLeft,Ae.renderTop),P.rotate(Ae.angle),P.fillRect(-Ae.kernedWidth/2,ut*Z+fe,Ae.kernedWidth,this.fontSize/15),P.restore();else if((de!==Pe||Ze!==et||Z!==ne||fe!==ae)&&Re>0){var dt=Qe+te+Xe;"rtl"===this.direction&&(dt=this.width-dt-Re),Pe&&et&&(P.fillStyle=et,P.fillRect(dt,De+ut*ne+ae,Re,this.fontSize/15)),Xe=Ae.left,Re=Ae.width,Pe=de,et=Ze,ne=Z,ae=fe}else Re+=Ae.kernedWidth;dt=Qe+te+Xe,"rtl"===this.direction&&(dt=this.width-dt-Re),P.fillStyle=Ze,de&&Ze&&P.fillRect(dt,De+ut*ne+ae,Re-mt,this.fontSize/15),Je+=X}else Je+=X;this._removeShadow(P)}},_getFontDeclaration:function(P,L){var X=P||this,ne=this.fontFamily,Z=F.Text.genericFonts.indexOf(ne.toLowerCase())>-1,te=void 0===ne||ne.indexOf("'")>-1||ne.indexOf(",")>-1||ne.indexOf('"')>-1||Z?X.fontFamily:'"'+X.fontFamily+'"';return[F.isLikelyNode?X.fontWeight:X.fontStyle,F.isLikelyNode?X.fontStyle:X.fontWeight,L?this.CACHE_FONT_SIZE+"px":X.fontSize+"px",te].join(" ")},render:function(P){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",P)))},_splitTextIntoLines:function(P){for(var L=P.split(this._reNewline),X=new Array(L.length),ne=["\n"],Z=[],te=0;te<L.length;te++)X[te]=F.util.string.graphemeSplit(L[te]),Z=Z.concat(X[te],ne);return Z.pop(),{_unwrappedLines:X,lines:L,graphemeText:Z,graphemeLines:X}},toObject:function(P){var L=$.concat(P),X=this.callSuper("toObject",L);return X.styles=z(this.styles,!0),X.path&&(X.path=this.path.toObject()),X},set:function(P,L){this.callSuper("set",P,L);var X=!1,ne=!1;if("object"==typeof P)for(var Z in P)"path"===Z&&this.setPathInfo(),X=X||-1!==this._dimensionAffectingProps.indexOf(Z),ne=ne||"path"===Z;else X=-1!==this._dimensionAffectingProps.indexOf(P),ne="path"===P;return ne&&this.setPathInfo(),X&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),F.Text.ATTRIBUTE_NAMES=F.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),F.Text.DEFAULT_SVG_FONT_SIZE=16,F.Text.fromElement=function(P,L,X){if(!P)return L(null);var ne=F.parseAttributes(P,F.Text.ATTRIBUTE_NAMES),Z=ne.textAnchor||"left";if((X=F.util.object.extend(X?z(X):{},ne)).top=X.top||0,X.left=X.left||0,ne.textDecoration){var te=ne.textDecoration;-1!==te.indexOf("underline")&&(X.underline=!0),-1!==te.indexOf("overline")&&(X.overline=!0),-1!==te.indexOf("line-through")&&(X.linethrough=!0),delete X.textDecoration}"dx"in ne&&(X.left+=ne.dx),"dy"in ne&&(X.top+=ne.dy),"fontSize"in X||(X.fontSize=F.Text.DEFAULT_SVG_FONT_SIZE);var ae="";"textContent"in P?ae=P.textContent:"firstChild"in P&&null!==P.firstChild&&"data"in P.firstChild&&null!==P.firstChild.data&&(ae=P.firstChild.data),ae=ae.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var fe=X.strokeWidth;X.strokeWidth=0;var be=new F.Text(ae,X),Pe=be.getScaledHeight()/be.height,De=((be.height+be.strokeWidth)*be.lineHeight-be.height)*Pe,Xe=be.getScaledHeight()+De,Re=0;"center"===Z&&(Re=be.getScaledWidth()/2),"right"===Z&&(Re=be.getScaledWidth()),be.set({left:be.left-Re,top:be.top-(Xe-be.fontSize*(.07+be._fontSizeFraction))/be.lineHeight,strokeWidth:void 0!==fe?fe:1}),L(be)},F.Text.fromObject=function(P,L){var X=z(P),ne=P.path;return delete X.path,F.Object._fromObject("Text",X,function(Z){ne?F.Object._fromObject("Path",ne,function(te){Z.set("path",te),L(Z)},"path"):L(Z)},"text")},F.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],F.util.createAccessors&&F.util.createAccessors(F.Text)}}(l),ee.util.object.extend(ee.Text.prototype,{isEmptyStyles:function(V){if(!this.styles||void 0!==V&&!this.styles[V])return!0;var F=void 0===V?this.styles:{line:this.styles[V]};for(var z in F)for(var $ in F[z])for(var P in F[z][$])return!1;return!0},styleHas:function(V,F){if(!this.styles||!V||""===V||void 0!==F&&!this.styles[F])return!1;var z=void 0===F?this.styles:{0:this.styles[F]};for(var $ in z)for(var P in z[$])if(void 0!==z[$][P][V])return!0;return!1},cleanStyle:function(V){if(!this.styles||!V||""===V)return!1;var F,z,$=this.styles,P=0,L=!0,X=0;for(var ne in $){for(var Z in F=0,$[ne]){var te;P++,(te=$[ne][Z]).hasOwnProperty(V)?(z?te[V]!==z&&(L=!1):z=te[V],te[V]===this[V]&&delete te[V]):L=!1,0!==Object.keys(te).length?F++:delete $[ne][Z]}0===F&&delete $[ne]}for(var ae=0;ae<this._textLines.length;ae++)X+=this._textLines[ae].length;L&&P===X&&(this[V]=z,this.removeStyle(V))},removeStyle:function(V){if(this.styles&&V&&""!==V){var F,z,$,P=this.styles;for(z in P){for($ in F=P[z])delete F[$][V],0===Object.keys(F[$]).length&&delete F[$];0===Object.keys(F).length&&delete P[z]}}},_extendStyles:function(V,F){var z=this.get2DCursorLocation(V);this._getLineStyle(z.lineIndex)||this._setLineStyle(z.lineIndex),this._getStyleDeclaration(z.lineIndex,z.charIndex)||this._setStyleDeclaration(z.lineIndex,z.charIndex,{}),ee.util.object.extend(this._getStyleDeclaration(z.lineIndex,z.charIndex),F)},get2DCursorLocation:function(V,F){void 0===V&&(V=this.selectionStart);for(var z=F?this._unwrappedTextLines:this._textLines,$=z.length,P=0;P<$;P++){if(V<=z[P].length)return{lineIndex:P,charIndex:V};V-=z[P].length+this.missingNewlineOffset(P)}return{lineIndex:P-1,charIndex:z[P-1].length<V?z[P-1].length:V}},getSelectionStyles:function(V,F,z){void 0===V&&(V=this.selectionStart||0),void 0===F&&(F=this.selectionEnd||V);for(var $=[],P=V;P<F;P++)$.push(this.getStyleAtPosition(P,z));return $},getStyleAtPosition:function(V,F){var z=this.get2DCursorLocation(V);return(F?this.getCompleteStyleDeclaration(z.lineIndex,z.charIndex):this._getStyleDeclaration(z.lineIndex,z.charIndex))||{}},setSelectionStyles:function(V,F,z){void 0===F&&(F=this.selectionStart||0),void 0===z&&(z=this.selectionEnd||F);for(var $=F;$<z;$++)this._extendStyles($,V);return this._forceClearCache=!0,this},_getStyleDeclaration:function(V,F){var z=this.styles&&this.styles[V];return z?z[F]:null},getCompleteStyleDeclaration:function(V,F){for(var z,$=this._getStyleDeclaration(V,F)||{},P={},L=0;L<this._styleProperties.length;L++)P[z=this._styleProperties[L]]=void 0===$[z]?this[z]:$[z];return P},_setStyleDeclaration:function(V,F,z){this.styles[V][F]=z},_deleteStyleDeclaration:function(V,F){delete this.styles[V][F]},_getLineStyle:function(V){return!!this.styles[V]},_setLineStyle:function(V){this.styles[V]={}},_deleteLineStyle:function(V){delete this.styles[V]}}),function(){function V(F){F.textDecoration&&(F.textDecoration.indexOf("underline")>-1&&(F.underline=!0),F.textDecoration.indexOf("line-through")>-1&&(F.linethrough=!0),F.textDecoration.indexOf("overline")>-1&&(F.overline=!0),delete F.textDecoration)}ee.IText=ee.util.createClass(ee.Text,ee.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(F,z){this.callSuper("initialize",F,z),this.initBehavior()},setSelectionStart:function(F){F=Math.max(F,0),this._updateAndFire("selectionStart",F)},setSelectionEnd:function(F){F=Math.min(F,this.text.length),this._updateAndFire("selectionEnd",F)},_updateAndFire:function(F,z){this[F]!==z&&(this._fireSelectionChanged(),this[F]=z),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(F){this.clearContextTop(),this.callSuper("render",F),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(F){this.callSuper("_render",F)},clearContextTop:function(F){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var z=this.canvas.contextTop,$=this.canvas.viewportTransform;z.save(),z.transform($[0],$[1],$[2],$[3],$[4],$[5]),this.transform(z),this._clearTextArea(z),F||z.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var F=this._getCursorBoundaries(),z=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(F,z):this.renderSelection(F,z),z.restore()}},_clearTextArea:function(F){var z=this.width+4,$=this.height+4;F.clearRect(-z/2,-$/2,z,$)},_getCursorBoundaries:function(F){void 0===F&&(F=this.selectionStart);var z=this._getLeftOffset(),$=this._getTopOffset(),P=this._getCursorBoundariesOffsets(F);return{left:z,top:$,leftOffset:P.left,topOffset:P.top}},_getCursorBoundariesOffsets:function(F){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var z,$,P,L,X=0,ne=0,Z=this.get2DCursorLocation(F);P=Z.charIndex,$=Z.lineIndex;for(var te=0;te<$;te++)X+=this.getHeightOfLine(te);z=this._getLineLeftOffset($);var ae=this.__charBounds[$][P];return ae&&(ne=ae.left),0!==this.charSpacing&&P===this._textLines[$].length&&(ne-=this._getWidthOfCharSpacing()),L={top:X,left:z+(ne>0?ne:0)},"rtl"===this.direction&&(L.left*=-1),this.cursorOffsetCache=L,this.cursorOffsetCache},renderCursor:function(F,z){var $=this.get2DCursorLocation(),P=$.lineIndex,L=$.charIndex>0?$.charIndex-1:0,X=this.getValueOfPropertyAt(P,L,"fontSize"),ne=this.scaleX*this.canvas.getZoom(),Z=this.cursorWidth/ne,te=F.topOffset,ae=this.getValueOfPropertyAt(P,L,"deltaY");te+=(1-this._fontSizeFraction)*this.getHeightOfLine(P)/this.lineHeight-X*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(F,z),z.fillStyle=this.cursorColor||this.getValueOfPropertyAt(P,L,"fill"),z.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,z.fillRect(F.left+F.leftOffset-Z/2,te+F.top+ae,Z,X)},renderSelection:function(F,z){for(var $=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,P=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,L=-1!==this.textAlign.indexOf("justify"),X=this.get2DCursorLocation($),ne=this.get2DCursorLocation(P),Z=X.lineIndex,te=ne.lineIndex,ae=X.charIndex<0?0:X.charIndex,fe=ne.charIndex<0?0:ne.charIndex,be=Z;be<=te;be++){var Pe,De=this._getLineLeftOffset(be)||0,Xe=this.getHeightOfLine(be),Re=0,Ae=0;if(be===Z&&(Re=this.__charBounds[Z][ae].left),be>=Z&&be<te)Ae=L&&!this.isEndOfWrapping(be)?this.width:this.getLineWidth(be)||5;else if(be===te)if(0===fe)Ae=this.__charBounds[te][fe].left;else{var de=this._getWidthOfCharSpacing();Ae=this.__charBounds[te][fe-1].left+this.__charBounds[te][fe-1].width-de}Pe=Xe,(this.lineHeight<1||be===te&&this.lineHeight>1)&&(Xe/=this.lineHeight);var tt=F.left+De+Re,Ze=Ae-Re,et=Xe,Qe=0;this.inCompositionMode?(z.fillStyle=this.compositionColor||"black",et=1,Qe=Xe):z.fillStyle=this.selectionColor,"rtl"===this.direction&&(tt=this.width-tt-Ze),z.fillRect(tt,F.top+F.topOffset+Qe,Ze,et),F.topOffset+=Pe}},getCurrentCharFontSize:function(){var F=this._getCurrentCharIndex();return this.getValueOfPropertyAt(F.l,F.c,"fontSize")},getCurrentCharColor:function(){var F=this._getCurrentCharIndex();return this.getValueOfPropertyAt(F.l,F.c,"fill")},_getCurrentCharIndex:function(){var F=this.get2DCursorLocation(this.selectionStart,!0);return{l:F.lineIndex,c:F.charIndex>0?F.charIndex-1:0}}}),ee.IText.fromObject=function(F,z){if(V(F),F.styles)for(var $ in F.styles)for(var P in F.styles[$])V(F.styles[$][P]);ee.Object._fromObject("IText",F,z,"text")}}(),Ve=ee.util.object.clone,ee.util.object.extend(ee.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var V=this;this.on("added",function(){var F=V.canvas;F&&(F._hasITextHandlers||(F._hasITextHandlers=!0,V._initCanvasHandlers(F)),F._iTextInstances=F._iTextInstances||[],F._iTextInstances.push(V))})},initRemovedHandler:function(){var V=this;this.on("removed",function(){var F=V.canvas;F&&(F._iTextInstances=F._iTextInstances||[],ee.util.removeFromArray(F._iTextInstances,V),0===F._iTextInstances.length&&(F._hasITextHandlers=!1,V._removeCanvasHandlers(F)))})},_initCanvasHandlers:function(V){V._mouseUpITextHandler=function(){V._iTextInstances&&V._iTextInstances.forEach(function(F){F.__isMousedown=!1})},V.on("mouse:up",V._mouseUpITextHandler)},_removeCanvasHandlers:function(V){V.off("mouse:up",V._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(V,F,z,$){var P;return P={isAborted:!1,abort:function(){this.isAborted=!0}},V.animate("_currentCursorOpacity",F,{duration:z,onComplete:function(){P.isAborted||V[$]()},onChange:function(){V.canvas&&V.selectionStart===V.selectionEnd&&V.renderCursorOrSelection()},abort:function(){return P.isAborted}}),P},_onTickComplete:function(){var V=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){V._currentTickCompleteState=V._animateCursor(V,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(V){var F=this,z=V?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){F._tick()},z)},abortCursorAnimation:function(){var V=this._currentTickState||this._currentTickCompleteState,F=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,V&&F&&F.clearContext(F.contextTop||F.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(V){var F=0,z=V-1;if(this._reSpace.test(this._text[z]))for(;this._reSpace.test(this._text[z]);)F++,z--;for(;/\S/.test(this._text[z])&&z>-1;)F++,z--;return V-F},findWordBoundaryRight:function(V){var F=0,z=V;if(this._reSpace.test(this._text[z]))for(;this._reSpace.test(this._text[z]);)F++,z++;for(;/\S/.test(this._text[z])&&z<this._text.length;)F++,z++;return V+F},findLineBoundaryLeft:function(V){for(var F=0,z=V-1;!/\n/.test(this._text[z])&&z>-1;)F++,z--;return V-F},findLineBoundaryRight:function(V){for(var F=0,z=V;!/\n/.test(this._text[z])&&z<this._text.length;)F++,z++;return V+F},searchWordBoundary:function(V,F){for(var z=this._text,$=this._reSpace.test(z[V])?V-1:V,P=z[$],L=ee.reNonWord;!L.test(P)&&$>0&&$<z.length;)P=z[$+=F];return L.test(P)&&($+=1===F?0:1),$},selectWord:function(V){var F=this.searchWordBoundary(V=V||this.selectionStart,-1),z=this.searchWordBoundary(V,1);this.selectionStart=F,this.selectionEnd=z,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(V){var F=this.findLineBoundaryLeft(V=V||this.selectionStart),z=this.findLineBoundaryRight(V);return this.selectionStart=F,this.selectionEnd=z,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(V){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(V),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(V){V._iTextInstances&&V._iTextInstances.forEach(function(F){F.selected=!1,F.isEditing&&F.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(V){if(this.__isMousedown&&this.isEditing){var F=this.getSelectionStartFromPointer(V.e),z=this.selectionStart,$=this.selectionEnd;(F===this.__selectionStartOnMouseDown&&z!==$||z!==F&&$!==F)&&(F>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=F):(this.selectionStart=F,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===z&&this.selectionEnd===$||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(V,F,z){var $=z.slice(0,V),P=ee.util.string.graphemeSplit($).length;if(V===F)return{selectionStart:P,selectionEnd:P};var L=z.slice(V,F);return{selectionStart:P,selectionEnd:P+ee.util.string.graphemeSplit(L).length}},fromGraphemeToStringSelection:function(V,F,z){var $=z.slice(0,V).join("").length;return V===F?{selectionStart:$,selectionEnd:$}:{selectionStart:$,selectionEnd:$+z.slice(V,F).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var V=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=V.selectionStart,this.hiddenTextarea.selectionEnd=V.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var V=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=V.selectionEnd,this.inCompositionMode||(this.selectionStart=V.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var V=this._calcTextareaPosition();this.hiddenTextarea.style.left=V.left,this.hiddenTextarea.style.top=V.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var V=this.inCompositionMode?this.compositionStart:this.selectionStart,F=this._getCursorBoundaries(V),z=this.get2DCursorLocation(V),L=this.getValueOfPropertyAt(z.lineIndex,z.charIndex,"fontSize")*this.lineHeight,X=F.leftOffset,ne=this.calcTransformMatrix(),Z={x:F.left+X,y:F.top+F.topOffset+L},te=this.canvas.getRetinaScaling(),ae=this.canvas.upperCanvasEl,fe=ae.width/te,be=ae.height/te,Pe=fe-L,De=be-L,Xe=ae.clientWidth/fe,Re=ae.clientHeight/be;return Z=ee.util.transformPoint(Z,ne),(Z=ee.util.transformPoint(Z,this.canvas.viewportTransform)).x*=Xe,Z.y*=Re,Z.x<0&&(Z.x=0),Z.x>Pe&&(Z.x=Pe),Z.y<0&&(Z.y=0),Z.y>De&&(Z.y=De),Z.x+=this.canvas._offset.left,Z.y+=this.canvas._offset.top,{left:Z.x+"px",top:Z.y+"px",fontSize:L+"px",charHeight:L}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var V=this._textBeforeEdit!==this.text,F=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,F&&(F.blur&&F.blur(),F.parentNode&&F.parentNode.removeChild(F)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),V&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),V&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var V in this.styles)this._textLines[V]||delete this.styles[V]},removeStyleFromTo:function(V,F){var z,$,P=this.get2DCursorLocation(V,!0),L=this.get2DCursorLocation(F,!0),X=P.lineIndex,ne=P.charIndex,Z=L.lineIndex,te=L.charIndex;if(X!==Z){if(this.styles[X])for(z=ne;z<this._unwrappedTextLines[X].length;z++)delete this.styles[X][z];if(this.styles[Z])for(z=te;z<this._unwrappedTextLines[Z].length;z++)($=this.styles[Z][z])&&(this.styles[X]||(this.styles[X]={}),this.styles[X][ne+z-te]=$);for(z=X+1;z<=Z;z++)delete this.styles[z];this.shiftLineStyles(Z,X-Z)}else if(this.styles[X]){$=this.styles[X];var ae,fe,be=te-ne;for(z=ne;z<te;z++)delete $[z];for(fe in this.styles[X])(ae=parseInt(fe,10))>=te&&($[ae-be]=$[fe],delete $[fe])}},shiftLineStyles:function(V,F){var z=Ve(this.styles);for(var $ in this.styles){var P=parseInt($,10);P>V&&(this.styles[P+F]=z[P],z[P-F]||delete this.styles[P])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(V,F,z,$){var P,L={},X=!1,ne=this._unwrappedTextLines[V].length===F;for(var Z in z||(z=1),this.shiftLineStyles(V,z),this.styles[V]&&(P=this.styles[V][0===F?F:F-1]),this.styles[V]){var te=parseInt(Z,10);te>=F&&(X=!0,L[te-F]=this.styles[V][Z],ne&&0===F||delete this.styles[V][Z])}var ae=!1;for(X&&!ne&&(this.styles[V+z]=L,ae=!0),ae&&z--;z>0;)$&&$[z-1]?this.styles[V+z]={0:Ve($[z-1])}:P?this.styles[V+z]={0:Ve(P)}:delete this.styles[V+z],z--;this._forceClearCache=!0},insertCharStyleObject:function(V,F,z,$){this.styles||(this.styles={});var P=this.styles[V],L=P?Ve(P):{};for(var X in z||(z=1),L){var ne=parseInt(X,10);ne>=F&&(P[ne+z]=L[ne],L[ne-z]||delete P[ne])}if(this._forceClearCache=!0,$)for(;z--;)Object.keys($[z]).length&&(this.styles[V]||(this.styles[V]={}),this.styles[V][F+z]=Ve($[z]));else if(P)for(var Z=P[F?F-1:1];Z&&z--;)this.styles[V][F+z]=Ve(Z)},insertNewStyleBlock:function(V,F,z){for(var $=this.get2DCursorLocation(F,!0),P=[0],L=0,X=0;X<V.length;X++)"\n"===V[X]?P[++L]=0:P[L]++;for(P[0]>0&&(this.insertCharStyleObject($.lineIndex,$.charIndex,P[0],z),z=z&&z.slice(P[0]+1)),L&&this.insertNewlineStyleObject($.lineIndex,$.charIndex+P[0],L),X=1;X<L;X++)P[X]>0?this.insertCharStyleObject($.lineIndex+X,0,P[X],z):z&&this.styles[$.lineIndex+X]&&z[0]&&(this.styles[$.lineIndex+X][0]=z[0]),z=z&&z.slice(P[X]+1);P[X]>0&&this.insertCharStyleObject($.lineIndex+X,0,P[X],z)},setSelectionStartEndWithShift:function(V,F,z){z<=V?(F===V?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=V),this.selectionStart=z):z>V&&z<F?"right"===this._selectionDirection?this.selectionEnd=z:this.selectionStart=z:(F===V?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=F),this.selectionEnd=z)},setSelectionInBoundaries:function(){var V=this.text.length;this.selectionStart>V?this.selectionStart=V:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>V?this.selectionEnd=V:this.selectionEnd<0&&(this.selectionEnd=0)}}),ee.util.object.extend(ee.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(V){if(this.canvas){this.__newClickTime=+new Date;var F=V.pointer;this.isTripleClick(F)&&(this.fire("tripleclick",V),this._stopEvent(V.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=F,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(V){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===V.x&&this.__lastPointer.y===V.y},_stopEvent:function(V){V.preventDefault&&V.preventDefault(),V.stopPropagation&&V.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(V){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(V.e))},tripleClickHandler:function(V){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(V.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(V){!this.canvas||!this.editable||V.e.button&&1!==V.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(V.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(V){!this.canvas||!this.editable||V.e.button&&1!==V.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(V){if(this.__isMousedown=!1,!(!this.editable||this.group||V.transform&&V.transform.actionPerformed||V.e.button&&1!==V.e.button)){if(this.canvas){var F=this.canvas._activeObject;if(F&&F!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(V.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(V){var F=this.getSelectionStartFromPointer(V);V.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,F):(this.selectionStart=F,this.selectionEnd=F),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(V){for(var F,z=this.getLocalPointer(V),$=0,P=0,L=0,X=0,ne=0,Z=0,te=this._textLines.length;Z<te&&L<=z.y;Z++)L+=this.getHeightOfLine(Z)*this.scaleY,ne=Z,Z>0&&(X+=this._textLines[Z-1].length+this.missingNewlineOffset(Z-1));P=this._getLineLeftOffset(ne)*this.scaleX,F=this._textLines[ne],"rtl"===this.direction&&(z.x=this.width*this.scaleX-z.x+P);for(var ae=0,fe=F.length;ae<fe&&($=P,(P+=this.__charBounds[ne][ae].kernedWidth*this.scaleX)<=z.x);ae++)X++;return this._getNewSelectionStartFromOffset(z,$,P,X,fe)},_getNewSelectionStartFromOffset:function(V,F,z,$,P){var X=z-V.x,ne=$+(X>V.x-F||X<0?0:1);return this.flipX&&(ne=P-ne),ne>this._text.length&&(ne=this._text.length),ne}}),ee.util.object.extend(ee.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=ee.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var V=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+V.top+"; left: "+V.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+V.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):ee.document.body.appendChild(this.hiddenTextarea),ee.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),ee.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),ee.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),ee.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),ee.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),ee.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),ee.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),ee.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),ee.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(ee.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(V){if(this.isEditing){var F="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(V.keyCode in F)this[F[V.keyCode]](V);else{if(!(V.keyCode in this.ctrlKeysMapDown)||!V.ctrlKey&&!V.metaKey)return;this[this.ctrlKeysMapDown[V.keyCode]](V)}V.stopImmediatePropagation(),V.preventDefault(),V.keyCode>=33&&V.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(V){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:V.keyCode in this.ctrlKeysMapUp&&(V.ctrlKey||V.metaKey)&&(this[this.ctrlKeysMapUp[V.keyCode]](V),V.stopImmediatePropagation(),V.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(V){var F=this.fromPaste;if(this.fromPaste=!1,V&&V.stopPropagation(),this.isEditing){var z,$,P,L,X,ne=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,Z=this._text.length,te=ne.length,ae=te-Z,fe=this.selectionStart,be=this.selectionEnd,Pe=fe!==be;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var De=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),Xe=fe>De.selectionStart;Pe?(z=this._text.slice(fe,be),ae+=be-fe):te<Z&&(z=Xe?this._text.slice(be+ae,be):this._text.slice(fe,fe-ae)),$=ne.slice(De.selectionEnd-ae,De.selectionEnd),z&&z.length&&($.length&&(P=this.getSelectionStyles(fe,fe+1,!1),P=$.map(function(){return P[0]})),Pe?(L=fe,X=be):Xe?(L=be-z.length,X=be):(L=be,X=be+z.length),this.removeStyleFromTo(L,X)),$.length&&(F&&$.join("")===ee.copiedText&&!ee.disableStyleCopyPaste&&(P=ee.copiedTextStyle),this.insertNewStyleBlock($,fe,P)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(V){this.compositionStart=V.target.selectionStart,this.compositionEnd=V.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(ee.copiedText=this.getSelectedText(),ee.copiedTextStyle=ee.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(V){return V&&V.clipboardData||ee.window.clipboardData},_getWidthBeforeCursor:function(V,F){var z,$=this._getLineLeftOffset(V);return F>0&&($+=(z=this.__charBounds[V][F-1]).left+z.width),$},getDownCursorOffset:function(V,F){var z=this._getSelectionForOffset(V,F),$=this.get2DCursorLocation(z),P=$.lineIndex;if(P===this._textLines.length-1||V.metaKey||34===V.keyCode)return this._text.length-z;var L=$.charIndex,X=this._getWidthBeforeCursor(P,L),ne=this._getIndexOnLine(P+1,X);return this._textLines[P].slice(L).length+ne+1+this.missingNewlineOffset(P)},_getSelectionForOffset:function(V,F){return V.shiftKey&&this.selectionStart!==this.selectionEnd&&F?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(V,F){var z=this._getSelectionForOffset(V,F),$=this.get2DCursorLocation(z),P=$.lineIndex;if(0===P||V.metaKey||33===V.keyCode)return-z;var L=$.charIndex,X=this._getWidthBeforeCursor(P,L),ne=this._getIndexOnLine(P-1,X),Z=this._textLines[P].slice(0,L),te=this.missingNewlineOffset(P-1);return-this._textLines[P-1].length+ne-Z.length+(1-te)},_getIndexOnLine:function(V,F){for(var z,$,P=this._textLines[V],L=this._getLineLeftOffset(V),X=0,ne=0,Z=P.length;ne<Z;ne++)if((L+=z=this.__charBounds[V][ne].width)>F){$=!0;var ae=L,fe=Math.abs(L-z-F);X=Math.abs(ae-F)<fe?ne:ne-1;break}return $||(X=P.length-1),X},moveCursorDown:function(V){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",V)},moveCursorUp:function(V){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",V)},_moveCursorUpOrDown:function(V,F){var z=this["get"+V+"CursorOffset"](F,"right"===this._selectionDirection);F.shiftKey?this.moveCursorWithShift(z):this.moveCursorWithoutShift(z),0!==z&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(V){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+V:this.selectionEnd+V),0!==V},moveCursorWithoutShift:function(V){return V<0?(this.selectionStart+=V,this.selectionEnd=this.selectionStart):(this.selectionEnd+=V,this.selectionStart=this.selectionEnd),0!==V},moveCursorLeft:function(V){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",V)},_move:function(V,F,z){var $;if(V.altKey)$=this["findWordBoundary"+z](this[F]);else{if(!V.metaKey&&35!==V.keyCode&&36!==V.keyCode)return this[F]+="Left"===z?-1:1,!0;$=this["findLineBoundary"+z](this[F])}if(void 0!==typeof $&&this[F]!==$)return this[F]=$,!0},_moveLeft:function(V,F){return this._move(V,F,"Left")},_moveRight:function(V,F){return this._move(V,F,"Right")},moveCursorLeftWithoutShift:function(V){var F=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(F=this._moveLeft(V,"selectionStart")),this.selectionEnd=this.selectionStart,F},moveCursorLeftWithShift:function(V){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(V,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(V,"selectionStart")):void 0},moveCursorRight:function(V){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",V)},_moveCursorLeftOrRight:function(V,F){var z="moveCursor"+V+"With";this._currentCursorOpacity=1,this[z+=F.shiftKey?"Shift":"outShift"](F)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(V){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(V,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(V,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(V){var F=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(F=this._moveRight(V,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,F},removeChars:function(V,F){void 0===F&&(F=V+1),this.removeStyleFromTo(V,F),this._text.splice(V,F-V),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(V,F,z,$){void 0===$&&($=z),$>z&&this.removeStyleFromTo(z,$);var P=ee.util.string.graphemeSplit(V);this.insertNewStyleBlock(P,z,F),this._text=[].concat(this._text.slice(0,z),P,this._text.slice($)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var V=ee.util.toFixed,F=/  +/g;ee.util.object.extend(ee.Text.prototype,{_toSVG:function(){var z=this._getSVGLeftTopOffsets(),$=this._getSVGTextAndBg(z.textTop,z.textLeft);return this._wrapSVGTextAndBg($)},toSVG:function(z){return this._createBaseSVGMarkup(this._toSVG(),{reviver:z,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(z){var $=this.getSvgTextDecoration(this);return[z.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",$?'text-decoration="'+$+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",z.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(z,$){var P,L=[],X=[],ne=z;this._setSVGBg(X);for(var Z=0,te=this._textLines.length;Z<te;Z++)P=this._getLineLeftOffset(Z),(this.textBackgroundColor||this.styleHas("textBackgroundColor",Z))&&this._setSVGTextLineBg(X,Z,$+P,ne),this._setSVGTextLineText(L,Z,$+P,ne),ne+=this.getHeightOfLine(Z);return{textSpans:L,textBgRects:X}},_createTextCharSpan:function(z,$,P,L){var X=z!==z.trim()||z.match(F),ne=this.getSvgSpanStyles($,X),Z=ne?'style="'+ne+'"':"",te=$.deltaY,ae="",fe=ee.Object.NUM_FRACTION_DIGITS;return te&&(ae=' dy="'+V(te,fe)+'" '),['<tspan x="',V(P,fe),'" y="',V(L,fe),'" ',ae,Z,">",ee.util.string.escapeXml(z),"</tspan>"].join("")},_setSVGTextLineText:function(z,$,P,L){var X,ne,Z,te,ae,fe=this.getHeightOfLine($),be=-1!==this.textAlign.indexOf("justify"),Pe="",De=0,Xe=this._textLines[$];L+=fe*(1-this._fontSizeFraction)/this.lineHeight;for(var Re=0,Ae=Xe.length-1;Re<=Ae;Re++)ae=Re===Ae||this.charSpacing,Pe+=Xe[Re],Z=this.__charBounds[$][Re],0===De?(P+=Z.kernedWidth-Z.width,De+=Z.width):De+=Z.kernedWidth,be&&!ae&&this._reSpaceAndTab.test(Xe[Re])&&(ae=!0),ae||(X=X||this.getCompleteStyleDeclaration($,Re),ne=this.getCompleteStyleDeclaration($,Re+1),ae=this._hasStyleChangedForSvg(X,ne)),ae&&(te=this._getStyleDeclaration($,Re)||{},z.push(this._createTextCharSpan(Pe,te,P,L)),Pe="",X=ne,P+=De,De=0)},_pushTextBgRect:function(z,$,P,L,X,ne){var Z=ee.Object.NUM_FRACTION_DIGITS;z.push("\t\t<rect ",this._getFillAttributes($),' x="',V(P,Z),'" y="',V(L,Z),'" width="',V(X,Z),'" height="',V(ne,Z),'"></rect>\n')},_setSVGTextLineBg:function(z,$,P,L){for(var X,ne,Z=this._textLines[$],te=this.getHeightOfLine($)/this.lineHeight,ae=0,fe=0,be=this.getValueOfPropertyAt($,0,"textBackgroundColor"),Pe=0,De=Z.length;Pe<De;Pe++)X=this.__charBounds[$][Pe],(ne=this.getValueOfPropertyAt($,Pe,"textBackgroundColor"))!==be?(be&&this._pushTextBgRect(z,be,P+fe,L,ae,te),fe=X.left,ae=X.width,be=ne):ae+=X.kernedWidth;ne&&this._pushTextBgRect(z,ne,P+fe,L,ae,te)},_getFillAttributes:function(z){var $=z&&"string"==typeof z?new ee.Color(z):"";return $&&$.getSource()&&1!==$.getAlpha()?'opacity="'+$.getAlpha()+'" fill="'+$.setAlpha(1).toRgb()+'"':'fill="'+z+'"'},_getSVGLineTopOffset:function(z){for(var $,P=0,L=0;L<z;L++)P+=this.getHeightOfLine(L);return $=this.getHeightOfLine(L),{lineTop:P,offset:(this._fontSizeMult-this._fontSizeFraction)*$/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(z){return ee.Object.prototype.getSvgStyles.call(this,z)+" white-space: pre;"}})}(),function(V){var F=V.fabric||(V.fabric={});F.Textbox=F.util.createClass(F.IText,F.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:F.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(z){for(var $=0,P=0,L=0,X={},ne=0;ne<z.graphemeLines.length;ne++)"\n"===z.graphemeText[L]&&ne>0?(P=0,L++,$++):!this.splitByGrapheme&&this._reSpaceAndTab.test(z.graphemeText[L])&&ne>0&&(P++,L++),X[ne]={line:$,offset:P},L+=z.graphemeLines[ne].length,P+=z.graphemeLines[ne].length;return X},styleHas:function(z,$){if(this._styleMap&&!this.isWrapping){var P=this._styleMap[$];P&&($=P.line)}return F.Text.prototype.styleHas.call(this,z,$)},isEmptyStyles:function(z){if(!this.styles)return!0;var $,P,L=0,X=!1,ne=this._styleMap[z],Z=this._styleMap[z+1];for(var te in ne&&(z=ne.line,L=ne.offset),Z&&(X=Z.line===z,$=Z.offset),P=void 0===z?this.styles:{line:this.styles[z]})for(var ae in P[te])if(ae>=L&&(!X||ae<$))for(var fe in P[te][ae])return!1;return!0},_getStyleDeclaration:function(z,$){if(this._styleMap&&!this.isWrapping){var P=this._styleMap[z];if(!P)return null;z=P.line,$=P.offset+$}return this.callSuper("_getStyleDeclaration",z,$)},_setStyleDeclaration:function(z,$,P){var L=this._styleMap[z];this.styles[z=L.line][$=L.offset+$]=P},_deleteStyleDeclaration:function(z,$){var P=this._styleMap[z];delete this.styles[z=P.line][$=P.offset+$]},_getLineStyle:function(z){return!!this.styles[this._styleMap[z].line]},_setLineStyle:function(z){this.styles[this._styleMap[z].line]={}},_wrapText:function(z,$){var P,L=[];for(this.isWrapping=!0,P=0;P<z.length;P++)L=L.concat(this._wrapLine(z[P],P,$));return this.isWrapping=!1,L},_measureWord:function(z,$,P){var L,X=0;P=P||0;for(var ne=0,Z=z.length;ne<Z;ne++)X+=this._getGraphemeBox(z[ne],$,ne+P,L,!0).kernedWidth,L=z[ne];return X},_wrapLine:function(z,$,P,L){var X=0,ne=this.splitByGrapheme,Z=[],te=[],ae=ne?F.util.string.graphemeSplit(z):z.split(this._wordJoiners),fe="",be=0,Pe=ne?"":" ",De=0,Xe=0,Re=0,Ae=!0,de=this._getWidthOfCharSpacing();L=L||0,0===ae.length&&ae.push([]),P-=L;for(var tt=0;tt<ae.length;tt++)fe=ne?ae[tt]:F.util.string.graphemeSplit(ae[tt]),De=this._measureWord(fe,$,be),be+=fe.length,(X+=Xe+De-de)>P&&!Ae?(Z.push(te),te=[],X=De,Ae=!0):X+=de,Ae||ne||te.push(Pe),te=te.concat(fe),Xe=ne?0:this._measureWord([Pe],$,be),be++,Ae=!1,De>Re&&(Re=De);return tt&&Z.push(te),Re+L>this.dynamicMinWidth&&(this.dynamicMinWidth=Re-de+L),Z},isEndOfWrapping:function(z){return!this._styleMap[z+1]||this._styleMap[z+1].line!==this._styleMap[z].line},missingNewlineOffset:function(z){return this.splitByGrapheme?this.isEndOfWrapping(z)?1:0:1},_splitTextIntoLines:function(z){for(var $=F.Text.prototype._splitTextIntoLines.call(this,z),P=this._wrapText($.lines,this.width),L=new Array(P.length),X=0;X<P.length;X++)L[X]=P[X].join("");return $.lines=L,$.graphemeLines=P,$},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var z={};for(var $ in this._styleMap)this._textLines[$]&&(z[this._styleMap[$].line]=1);for(var $ in this.styles)z[$]||delete this.styles[$]},toObject:function(z){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(z))}}),F.Textbox.fromObject=function(z,$){return F.Object._fromObject("Textbox",z,$,"text")}}(l),function(){var V=ee.controlsUtils,F=V.scaleSkewCursorStyleHandler,z=V.scaleCursorStyleHandler,$=V.scalingEqually,P=V.scalingYOrSkewingX,L=V.scalingXOrSkewingY,X=V.scaleOrSkewActionName,ne=ee.Object.prototype.controls;if(ne.ml=new ee.Control({x:-.5,y:0,cursorStyleHandler:F,actionHandler:L,getActionName:X}),ne.mr=new ee.Control({x:.5,y:0,cursorStyleHandler:F,actionHandler:L,getActionName:X}),ne.mb=new ee.Control({x:0,y:.5,cursorStyleHandler:F,actionHandler:P,getActionName:X}),ne.mt=new ee.Control({x:0,y:-.5,cursorStyleHandler:F,actionHandler:P,getActionName:X}),ne.tl=new ee.Control({x:-.5,y:-.5,cursorStyleHandler:z,actionHandler:$}),ne.tr=new ee.Control({x:.5,y:-.5,cursorStyleHandler:z,actionHandler:$}),ne.bl=new ee.Control({x:-.5,y:.5,cursorStyleHandler:z,actionHandler:$}),ne.br=new ee.Control({x:.5,y:.5,cursorStyleHandler:z,actionHandler:$}),ne.mtr=new ee.Control({x:0,y:-.5,actionHandler:V.rotationWithSnapping,cursorStyleHandler:V.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),ee.Textbox){var Z=ee.Textbox.prototype.controls={};Z.mtr=ne.mtr,Z.tr=ne.tr,Z.br=ne.br,Z.tl=ne.tl,Z.bl=ne.bl,Z.mt=ne.mt,Z.mb=ne.mb,Z.mr=new ee.Control({x:.5,y:0,actionHandler:V.changeWidth,cursorStyleHandler:F,actionName:"resizing"}),Z.ml=new ee.Control({x:-.5,y:0,actionHandler:V.changeWidth,cursorStyleHandler:F,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},Oq={};function iv(p){var l=Oq[p];if(void 0!==l)return l.exports;var u=Oq[p]={exports:{}};return gIe[p](u,u.exports,iv),u.exports}iv.d=(p,l)=>{for(var u in l)iv.o(l,u)&&!iv.o(p,u)&&Object.defineProperty(p,u,{enumerable:!0,get:l[u]})},iv.o=(p,l)=>Object.prototype.hasOwnProperty.call(p,l);var Fq={};(()=>{let p;iv.d(Fq,{R:()=>p}),p="undefined"!=typeof document&&"undefined"!=typeof window?iv(653).fabric:{version:"5.2.1"}})();var ka,Fc,gg,Lq,Vi=Fq.R;(function(p){p[p.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",p[p.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",p[p.DIMT_TEXT=4]="DIMT_TEXT",p[p.DIMT_ARC=8]="DIMT_ARC",p[p.DIMT_IMAGE=16]="DIMT_IMAGE",p[p.DIMT_POLYGON=32]="DIMT_POLYGON",p[p.DIMT_LINE=64]="DIMT_LINE",p[p.DIMT_GROUP=128]="DIMT_GROUP"})(ka||(ka={})),function(p){p[p.DIS_DEFAULT=1]="DIS_DEFAULT",p[p.DIS_SELECTED=2]="DIS_SELECTED"}(Fc||(Fc={})),function(p){p[p.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",p[p.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",p[p.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(gg||(gg={})),function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(Lq||(Lq={}));const ky=p=>"number"==typeof p&&!Number.isNaN(p),aM=p=>"string"==typeof p;var yI,Vb,My,lM,Rh,_I;(function(p){p[p.ARC=0]="ARC",p[p.IMAGE=1]="IMAGE",p[p.LINE=2]="LINE",p[p.POLYGON=3]="POLYGON",p[p.QUAD=4]="QUAD",p[p.RECT=5]="RECT",p[p.TEXT=6]="TEXT",p[p.GROUP=7]="GROUP"})(Rh||(Rh={})),function(p){p[p.DEFAULT=0]="DEFAULT",p[p.SELECTED=1]="SELECTED"}(_I||(_I={}));class ic{get mediaType(){return new Map([["rect",ka.DIMT_RECTANGLE],["quad",ka.DIMT_QUADRILATERAL],["text",ka.DIMT_TEXT],["arc",ka.DIMT_ARC],["image",ka.DIMT_IMAGE],["polygon",ka.DIMT_POLYGON],["line",ka.DIMT_LINE],["group",ka.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(Me(this,Vb,"f")){case Fc.DIS_DEFAULT:return"default";case Fc.DIS_SELECTED:return"selected"}}set drawingStyleId(l){this.styleId=l}get drawingStyleId(){return this.styleId}set coordinateBase(l){if(!["view","image"].includes(l))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===Me(this,My,"f")&&"view"===l?this.updateCoordinateBaseFromImageToView():"view"===Me(this,My,"f")&&"image"===l&&this.updateCoordinateBaseFromViewToImage()),Pn(this,My,l,"f")}get coordinateBase(){return Me(this,My,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(l,u){if(yI.add(this),Vb.set(this,void 0),My.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=u&&!ky(u))throw new TypeError("Invalid 'drawingStyleId'.");l&&this._setFabricObject(l),this.setState(Fc.DIS_DEFAULT),this.styleId=u}_setFabricObject(l){this._fabricObject=l,this._fabricObject.on("selected",()=>{this.setState(Fc.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(Fc.DIS_SELECTED):this.setState(Fc.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),l.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(l){Pn(this,Vb,l,"f")}getState(){return Me(this,Vb,"f")}_on(l,u){if(!u)return;const f=l.toLowerCase(),g=this.mapEvent_Callbacks.get(f);if(!g)throw new Error(`Event '${l}' does not exist.`);let m=g.get(u);m||(m=v=>{const _=v.e;if(!_)return void(u&&u.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const b={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let S,I,k,O;const j=_.target.getBoundingClientRect();S=j.left,I=j.top,k=S+window.scrollX,O=I+window.scrollY;const{width:W,height:J}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),K=this._drawingLayer.width,Q=this._drawingLayer.height,ie=W/J,oe=K/Q,le=this._drawingLayer._getObjectFit();let he,_e,Ve,ee,ke=1;if("contain"===le)ie<oe?(ke=W/K,he=S+this.get("x")*ke,_e=I+this.get("y")*ke+(J-Q*ke)/2,Ve=k+this.get("x")*ke,ee=O+this.get("y")*ke+(J-Q*ke)/2):(ke=J/Q,he=S+this.get("x")*ke+(W-K*ke)/2,_e=I+this.get("y")*ke,Ve=k+this.get("x")*ke+(W-K*ke)/2,ee=O+this.get("y")*ke);else if("cover"===le)if(ie<oe){ke=J/Q;let xe=this.get("x")*ke-(K*ke-W)/2;xe=Math.max(xe,0),xe=Math.min(xe,W),he=S+xe,_e=I+this.get("y")*ke,Ve=k+xe,ee=O+this.get("y")*ke}else{ke=W/K;let xe=this.get("y")*ke-(Q*ke-J)/2;xe=Math.max(xe,0),xe=Math.min(xe,J),he=S+this.get("x")*ke,_e=I+xe,Ve=k+this.get("x")*ke,ee=O+xe}b.itemClientX=Math.round(he),b.itemClientY=Math.round(_e),b.itemPageX=Math.round(Ve),b.itemPageY=Math.round(ee)}for(let S of Object.getOwnPropertyNames(b))Object.defineProperty(_,S,{value:b[S],writable:!0});u&&u.apply(this,[_])},g.set(u,m),this._fabricObject.on("dblclick"===f?"mousedblclick":f,m))}on(l,u){this._on(l,u)}_off(l,u){const f=l.toLowerCase(),g=this.mapEvent_Callbacks.get(f);if(!g)throw new Error(`Event '${l}' does not exist.`);let m=g.get(u);m&&(g.delete(u),this._fabricObject.off("dblclick"===f?"mousedblclick":f,m))}off(l,u){this._off(l,u)}_setEditable(l){const u=this._fabricObject;l?(u.selectable=!0,u.hasControls=!0,u.hoverCursor=null):(u.selectable=!1,u.hasControls=!1,u.hoverCursor="default")}hasNote(l){return this.mapNoteName_Content.has(l)}addNote(l,u){if(this.hasNote(l.name)&&!u)throw new Error("A note with the same name already exists, please use a different name.");const f=l.content?JSON.parse(JSON.stringify(l.content)):l.content;this.mapNoteName_Content.set(l.name,[f])}getNote(l){const u=this.mapNoteName_Content.get(l);return u?1===u.length?{name:l,content:u[0]?JSON.parse(JSON.stringify(u[0])):u[0]}:{name:l,content:JSON.parse(JSON.stringify(u))}:null}getNotes(){const l=[];for(let u of this.mapNoteName_Content){let f=1===u[1].length?u[1][0]:u[1];f=f&&JSON.parse(JSON.stringify(f)),l.push({name:u[0],content:f})}return l}updateNote(l,u,f){const g=this.mapNoteName_Content.get(l);if(!g)throw new Error("The note name does not exist.");f||(g.length=0),u=u&&JSON.parse(JSON.stringify(u)),g.push(u)}deleteNote(l){this.mapNoteName_Content.delete(l)}clearNotes(){this.mapNoteName_Content.clear()}set(l,u){if(!this.extendSet(l,u))if("x"===l){const f=this._fabricObject.group;f?(this._fabricObject.set("left",u-f.left-f.width/2),f.addWithUpdate()):this._fabricObject.set("left",u)}else if("y"===l){const f=this._fabricObject.group;f?(this._fabricObject.set("top",u-f.top-f.height/2),f.addWithUpdate()):this._fabricObject.set("top",u)}else"styleId"===l?this.styleId=u:this._fabricObject.set(l,u);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(l)&&this._fabricObject.setCoords()}get(l){let u=this.extendGet(l);if(void 0===u)if("x"===l){const f=this._fabricObject.group;u=f?this._fabricObject.get("left")+f.left+f.width/2:this._fabricObject.get("left")}else if("y"===l){const f=this._fabricObject.group;u=f?this._fabricObject.get("top")+f.top+f.height/2:this._fabricObject.get("top")}else u="scaledWidth"===l?this._fabricObject.getScaledWidth():"scaledHeight"===l?this._fabricObject.getScaledHeight():["type","mediaType"].includes(l)?this.mediaType:"state"===l?this.getState():"styleId"===l?this.styleId:"drawingLayerId"===l?this.drawingLayerId:this._fabricObject.get(l);return u}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(l){if("number"!=typeof l)throw new TypeError("Invalid value.");return l*Me(this,yI,"m",lM).call(this)}convertPropFromViewToImage(l){if("number"!=typeof l)throw new TypeError("Invalid value.");return l/Me(this,yI,"m",lM).call(this)}_setLineWidth(l){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(l));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",l)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(l){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(l));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",l)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}Vb=new WeakMap,My=new WeakMap,yI=new WeakSet,lM=function(){const p=this._drawingLayer;if(!p)return 1;const l=p.width,u=p.height,{width:f,height:g}=p.fabricCanvas.wrapperEl.getBoundingClientRect();if(f<=0||g<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const m=f/l,v=g/u,_=p._getObjectFit();let b=1;return"contain"===_?b=m<v?f/l:g/u:"cover"===_&&(b=m<v?g/u:f/l),b},ic.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],ic.mapItemType=new Map([[Rh.ARC,"arc"],[Rh.IMAGE,"image"],[Rh.LINE,"line"],[Rh.POLYGON,"polygon"],[Rh.QUAD,"quad"],[Rh.RECT,"rect"],[Rh.TEXT,"text"],[Rh.GROUP,"group"]]),ic.arrStyleSelectors=["default","selected"],ic.mapItemState=new Map([[_I.DEFAULT,"default"],[_I.SELECTED,"selected"]]);const Nq=p=>null!==p&&"object"==typeof p&&!Array.isArray(p),cM=p=>!!aM(p)&&""!==p,dM=p=>!(!Od(p)||!ds(p.left)||p.left<0||!ds(p.top)||p.top<0||!ds(p.right)||p.right<0||!ds(p.bottom)||p.bottom<0||p.left>=p.right||p.top>=p.bottom||!X4(p.isMeasuredInPercentage)),Wq=p=>!!Od(p)&&!!Y4(p.points)&&0!=p.points.length&&!p.points.some(l=>!Ay(l)),mIe=Ay,Uq=p=>!!Od(p)&&!!Y4(p.points)&&0!=p.points.length&&4==p.points.length&&!p.points.some(l=>!Ay(l)),Gf=p=>!(!Od(p)||!ds(p.x)||!ds(p.y)||!ds(p.width)||p.width<0||!ds(p.height)||p.height<0||"isMeasuredInPercentage"in p&&!X4(p.isMeasuredInPercentage)),Vq=p=>!(!Nq(p)||"id"in p&&!ky(p.id)||"lineWidth"in p&&!ky(p.lineWidth)||"fillStyle"in p&&!cM(p.fillStyle)||"strokeStyle"in p&&!cM(p.strokeStyle)||"paintMode"in p&&!["fill","stroke","strokeAndFill"].includes(p.paintMode)||"fontFamily"in p&&!cM(p.fontFamily)||"fontSize"in p&&!ky(p.fontSize));class CI{static convert(l,u,f){const g={x:0,y:0,width:u,height:f};if(!l)return g;if(Gf(l))l.isMeasuredInPercentage?(g.x=l.x/100*u,g.y=l.y/100*f,g.width=l.width/100*u,g.height=l.height/100*f):(g.x=l.x,g.y=l.y,g.width=l.width,g.height=l.height);else{if(!dM(l))throw TypeError("Invalid region.");l.isMeasuredInPercentage?(g.x=l.left/100*u,g.y=l.top/100*f,g.width=(l.right-l.left)/100*u,g.height=(l.bottom-l.top)/100*f):(g.x=l.left,g.y=l.top,g.width=l.right-l.left,g.height=l.bottom-l.top)}return g.x=Math.round(g.x),g.y=Math.round(g.y),g.width=Math.round(g.width),g.height=Math.round(g.height),g}}var rv,bI;class jq{constructor(){rv.set(this,new Map),bI.set(this,!1)}get disposed(){return Me(this,bI,"f")}on(l,u){l=l.toLowerCase();const f=Me(this,rv,"f").get(l);if(f){if(f.includes(u))return;f.push(u)}else Me(this,rv,"f").set(l,[u])}off(l,u){l=l.toLowerCase();const f=Me(this,rv,"f").get(l);if(!f)return;const g=f.indexOf(u);-1!==g&&f.splice(g,1)}offAll(l){l=l.toLowerCase();const u=Me(this,rv,"f").get(l);u&&(u.length=0)}fire(l,u=[],f={async:!1,copy:!0}){u||(u=[]),l=l.toLowerCase();const g=Me(this,rv,"f").get(l);if(g&&g.length){f=Object.assign({async:!1,copy:!0},f);for(let m of g){if(!m)continue;let v=[];if(f.copy)for(let b of u){try{b=JSON.parse(JSON.stringify(b))}catch(S){}v.push(b)}else v=u;let _=!1;if(f.async)setTimeout(()=>{this.disposed||g.includes(m)&&m.apply(f.target,v)},0);else try{_=m.apply(f.target,v)}catch(b){}if(!0===_)break}}}dispose(){Pn(this,bI,!0,"f")}}function vIe(p,l,u){return(u.x-p.x)*(l.y-p.y)==(l.x-p.x)*(u.y-p.y)&&Math.min(p.x,l.x)<=u.x&&u.x<=Math.max(p.x,l.x)&&Math.min(p.y,l.y)<=u.y&&u.y<=Math.max(p.y,l.y)}function hM(p){return Math.abs(p)<1e-6?0:p<0?-1:1}function xI(p,l,u,f){let g=p[0]*(u[1]-l[1])+l[0]*(p[1]-u[1])+u[0]*(l[1]-p[1]),m=p[0]*(f[1]-l[1])+l[0]*(p[1]-f[1])+f[0]*(l[1]-p[1]);return!((g^m)>=0&&0!==g&&0!==m||(g=u[0]*(p[1]-f[1])+f[0]*(u[1]-p[1])+p[0]*(f[1]-u[1]),m=u[0]*(l[1]-f[1])+f[0]*(u[1]-l[1])+l[0]*(f[1]-u[1]),(g^m)>=0&&0!==g&&0!==m))}rv=new WeakMap,bI=new WeakMap;const fM=function(){var p=Fe(function*(l){if("string"!=typeof l)throw new TypeError("Invalid url.");const u=yield fetch(l);if(!u.ok)throw Error("Network Error: "+u.statusText);const f=yield u.text();if(!f.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const g=document.createElement("div");g.insertAdjacentHTML("beforeend",f);for(let m=0;m<g.childElementCount;++m){let v=g.children[m];v instanceof HTMLStyleElement&&document.head.append(v)}return 1==g.childElementCount?g.children[0]:g});return function(u){return p.apply(this,arguments)}}();var mg,vg,_g;class Oy extends ic{constructor(l,u){if(super(null,u),mg.set(this,void 0),!Gf(l))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Vi.Rect({left:l.x,top:l.y,width:l.width,height:l.height})),Pn(this,mg,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="rect"}extendSet(l,u){return!1}extendGet(l){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(l){this.setRect(l)}getPosition(){return this.getRect()}updatePosition(){Me(this,mg,"f")&&this.setRect(Me(this,mg,"f"))}setRect(l){if(!Gf(l))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(l.x)),this.set("top",this.convertPropFromViewToImage(l.y)),this.set("width",this.convertPropFromViewToImage(l.width)),this.set("height",this.convertPropFromViewToImage(l.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",l.x),this.set("top",l.y),this.set("width",l.width),this.set("height",l.height)}this._drawingLayer.renderAll()}else Pn(this,mg,JSON.parse(JSON.stringify(l)),"f")}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return Me(this,mg,"f")?JSON.parse(JSON.stringify(Me(this,mg,"f"))):null}}function pM(p,l,u){return Vi.util.transformPoint({x:u.points[this.pointIndex].x-u.pathOffset.x,y:u.points[this.pointIndex].y-u.pathOffset.y},u.calcTransformMatrix())}function Hq(p){let l=new Vi.Point(p.strokeUniform?1/p.scaleX:1,p.strokeUniform?1/p.scaleY:1).multiply(p.strokeWidth);return new Vi.Point(p.width+l.x,p.height+l.y)}function gM(p,l,u,f){let g=l.target,m=g.controls[g.__corner],v=g.toLocalPoint(new Vi.Point(u,f),"center","center"),_=Hq(g),b=g._getTransformedDimensions(0,0);return g.points[m.pointIndex]={x:v.x*_.x/b.x+g.pathOffset.x,y:v.y*_.y/b.y+g.pathOffset.y},Vi.controlsUtils.fireEvent("scaling",{e:p,transform:l,pointer:{x:u,y:f}}),!0}function mM(p,l){return function(u,f,g,m){let v=f.target,_=Vi.util.transformPoint({x:v.points[p].x-v.pathOffset.x,y:v.points[p].y-v.pathOffset.y},v.calcTransformMatrix()),b=l(u,f,g,m);v._setPositionDimensions({});let S=Hq(v);return v.setPositionByOrigin(_,(v.points[p].x-v.pathOffset.x)/S.x+.5,(v.points[p].y-v.pathOffset.y)/S.y+.5),b}}mg=new WeakMap;class vM extends ic{constructor(l,u){if(super(null,u),vg.set(this,void 0),!Wq(l))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new Vi.Polygon(l.points,{objectCaching:!1}));const f=this._fabricObject;let g=f.points.length-1;f.controls=f.points.reduce(function(m,v,_){return m["p"+_]=new Vi.Control({positionHandler:pM,actionHandler:mM(_>0?_-1:g,gM),actionName:"modifyPolygon",pointIndex:_}),m},{}),Pn(this,vg,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="polygon"}extendSet(l,u){if("vertices"===l){const f=this._fabricObject;if(f.group){const m=f.group;f.points=u.map(v=>({x:v.x-m.left-m.width/2,y:v.y-m.top-m.height/2})),m.addWithUpdate()}else f.points=u;const g=f.points.length-1;return f.controls=f.points.reduce(function(m,v,_){return m["p"+_]=new Vi.Control({positionHandler:pM,actionHandler:mM(_>0?_-1:g,gM),actionName:"modifyPolygon",pointIndex:_}),m},{}),f._setPositionDimensions({}),!0}}extendGet(l){if("vertices"===l){const u=[],f=this._fabricObject;if(f.selectable&&!f.group)for(let g in f.oCoords)u.push({x:f.oCoords[g].x,y:f.oCoords[g].y});else for(let g of f.points){const _=Vi.util.transformPoint({x:g.x-f.pathOffset.x,y:g.y-f.pathOffset.y},f.calcTransformMatrix());u.push({x:_.x,y:_.y})}return u}}updateCoordinateBaseFromImageToView(){const l=this.get("vertices").map(u=>({x:this.convertPropFromViewToImage(u.x),y:this.convertPropFromViewToImage(u.y)}));this.set("vertices",l)}updateCoordinateBaseFromViewToImage(){const l=this.get("vertices").map(u=>({x:this.convertPropFromImageToView(u.x),y:this.convertPropFromImageToView(u.y)}));this.set("vertices",l)}setPosition(l){this.setPolygon(l)}getPosition(){return this.getPolygon()}updatePosition(){Me(this,vg,"f")&&this.setPolygon(Me(this,vg,"f"))}setPolygon(l){if(!Wq(l))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const u=l.points.map(f=>({x:this.convertPropFromViewToImage(f.x),y:this.convertPropFromViewToImage(f.y)}));this.set("vertices",u)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",l.points)}this._drawingLayer.renderAll()}else Pn(this,vg,JSON.parse(JSON.stringify(l)),"f")}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(l=>({x:this.convertPropFromImageToView(l.x),y:this.convertPropFromImageToView(l.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return Me(this,vg,"f")?JSON.parse(JSON.stringify(Me(this,vg,"f"))):null}}vg=new WeakMap;const Gq=p=>{let l=p.split("\n").map(f=>f.split("\t"));return(u=>{for(let f=0;;f++){let g=-1;for(let m=0;m<u.length;m++){let v=u[m][f];void 0!==v&&v.length>g&&(g=v.length)}if(-1===g)break;for(let m=0;m<u.length;m++){if(f>=u[m].length-1)continue;let v=" ".repeat(g+2-u[m][f].length);u[m][f]=u[m][f].concat(v)}}})(l),(u=>{let f="";for(let g=0;g<u.length;g++)f=f.concat(...u[g],g===u.length-1?"":"\n");return f})(l)};class yIe extends ic{constructor(l,u,f){if(super(null,f),_g.set(this,void 0),!aM(l))throw new TypeError("Invalid 'text'.");if(!Gf(u))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Vi.Textbox(Gq(l),{left:u.x,top:u.y,width:u.width})),this._text=l,Pn(this,_g,JSON.parse(JSON.stringify(u)),"f"),this._mediaType="text"}extendSet(l,u){if("text"===l)return this._text=u,this._fabricObject.set("text",Gq(u)),!0}extendGet(l){if("text"===l)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(l){this.setTextRect(l)}getPosition(){return this.getTextRect()}updatePosition(){Me(this,_g,"f")&&this.setTextRect(Me(this,_g,"f"))}setText(l){if(!aM(l))throw new TypeError("Invalid 'text'.");this.set("text",l)}getText(){return this.get("text")}setTextRect(l){if(!Gf(l))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(l.x)),this.set("top",this.convertPropFromViewToImage(l.y)),this.set("width",this.convertPropFromViewToImage(l.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",l.x),this.set("top",l.y),this.set("width",l.width)}this._drawingLayer.renderAll()}else Pn(this,_g,JSON.parse(JSON.stringify(l)),"f")}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return Me(this,_g,"f")?JSON.parse(JSON.stringify(Me(this,_g,"f"))):null}}var bg,xg,Fy,yM,Ly,jb,Ny,Lc,Hb,Gb,zb,zq,Yq,Xq,$q,wI,Vr,Yb,Xb,$b,Vs,SI,TI,II,wg,qb,Kb,_M,Nc,EI,qq,CM,bM,Jb,DI;_g=new WeakMap;class _Ie extends vM{constructor(l,u){if(super({points:null==l?void 0:l.points},u),bg.set(this,void 0),!Uq(l))throw new TypeError("Invalid 'quad'.");Pn(this,bg,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="quad"}setPosition(l){this.setQuad(l)}getPosition(){return this.getQuad()}updatePosition(){Me(this,bg,"f")&&this.setQuad(Me(this,bg,"f"))}setPolygon(){}getPolygon(){return null}setQuad(l){if(!Uq(l))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const u=l.points.map(f=>({x:this.convertPropFromViewToImage(f.x),y:this.convertPropFromViewToImage(f.y)}));this.set("vertices",u)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",l.points)}this._drawingLayer.renderAll()}else Pn(this,bg,JSON.parse(JSON.stringify(l)),"f")}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(l=>({x:this.convertPropFromImageToView(l.x),y:this.convertPropFromImageToView(l.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return Me(this,bg,"f")?JSON.parse(JSON.stringify(Me(this,bg,"f"))):null}}bg=new WeakMap;class CIe extends ic{constructor(l){super(new Vi.Group(l.map(u=>u._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(Fc.DIS_SELECTED);const u=this._fabricObject._objects;for(let f of u)setTimeout(()=>{f&&f.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(Fc.DIS_DEFAULT);const u=this._fabricObject._objects;for(let f of u)setTimeout(()=>{f&&f.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(l,u){return!1}extendGet(l){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(l=>l.getDrawingItem())}setChildDrawingItems(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,l,"add"):this._fabricObject.addWithUpdate(l._getFabricObject())}removeChildItem(l){l&&l.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,l,"remove"):this._fabricObject.removeWithUpdate(l._getFabricObject()))}}class ln{static createDrawingStyle(l){if(!Vq(l))throw new Error("Invalid style definition.");let u,f=ln.USER_START_STYLE_ID;for(;Me(ln,xg,"f",Fy).has(f);)f++;u=f;const g=JSON.parse(JSON.stringify(l));g.id=u;for(let m in Me(ln,xg,"f",yM))g.hasOwnProperty(m)||(g[m]=Me(ln,xg,"f",yM)[m]);return Me(ln,xg,"f",Fy).set(u,g),g.id}static _getDrawingStyle(l,u){if("number"!=typeof l)throw new Error("Invalid style id.");const f=Me(ln,xg,"f",Fy).get(l);return f?u?JSON.parse(JSON.stringify(f)):f:null}static getDrawingStyle(l){return this._getDrawingStyle(l,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(Me(ln,xg,"f",Fy).values())))}static _updateDrawingStyle(l,u){if(!Vq(u))throw new Error("Invalid style definition.");const f=Me(ln,xg,"f",Fy).get(l);if(f)for(let g in u)f.hasOwnProperty(g)&&(f[g]=u[g])}static updateDrawingStyle(l,u){this._updateDrawingStyle(l,u)}}xg=ln,ln.STYLE_BLUE_STROKE=1,ln.STYLE_GREEN_STROKE=2,ln.STYLE_ORANGE_STROKE=3,ln.STYLE_YELLOW_STROKE=4,ln.STYLE_BLUE_STROKE_FILL=5,ln.STYLE_GREEN_STROKE_FILL=6,ln.STYLE_ORANGE_STROKE_FILL=7,ln.STYLE_YELLOW_STROKE_FILL=8,ln.STYLE_BLUE_STROKE_TRANSPARENT=9,ln.STYLE_GREEN_STROKE_TRANSPARENT=10,ln.STYLE_ORANGE_STROKE_TRANSPARENT=11,ln.USER_START_STYLE_ID=1024,Fy={value:new Map([[ln.STYLE_BLUE_STROKE,{id:ln.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[ln.STYLE_GREEN_STROKE,{id:ln.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ln.STYLE_ORANGE_STROKE,{id:ln.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ln.STYLE_YELLOW_STROKE,{id:ln.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[ln.STYLE_BLUE_STROKE_FILL,{id:ln.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ln.STYLE_GREEN_STROKE_FILL,{id:ln.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ln.STYLE_ORANGE_STROKE_FILL,{id:ln.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ln.STYLE_YELLOW_STROKE_FILL,{id:ln.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ln.STYLE_BLUE_STROKE_TRANSPARENT,{id:ln.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ln.STYLE_GREEN_STROKE_TRANSPARENT,{id:ln.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ln.STYLE_ORANGE_STROKE_TRANSPARENT,{id:ln.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},yM={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},"undefined"!=typeof document&&"undefined"!=typeof window&&(Vi.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(Vi.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(p){p.dispose&&p.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),Vi.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},Vi.Object.prototype.transparentCorners=!1,Vi.Object.prototype.cornerSize=20,Vi.Object.prototype.touchCornerSize=100,Vi.Object.prototype.cornerColor="rgb(254,142,20)",Vi.Object.prototype.cornerStyle="circle",Vi.Object.prototype.strokeUniform=!0,Vi.Object.prototype.hasBorders=!1,Vi.Canvas.prototype.containerClass="",Vi.Canvas.prototype.getPointer=function(p,l){if(this._absolutePointer&&!l)return this._absolutePointer;if(this._pointer&&l)return this._pointer;var u,f=this.upperCanvasEl,g=Vi.util.getPointer(p,f),m=f.getBoundingClientRect(),v=m.width||0,_=m.height||0;v&&_||("top"in m&&"bottom"in m&&(_=Math.abs(m.top-m.bottom)),"right"in m&&"left"in m&&(v=Math.abs(m.right-m.left))),this.calcOffset(),g.x=g.x-this._offset.left,g.y=g.y-this._offset.top,l||(g=this.restorePointerVpt(g));var b=this.getRetinaScaling();if(1!==b&&(g.x/=b,g.y/=b),0!==v&&0!==_){var S=window.getComputedStyle(f).objectFit,I=f.width,k=f.height;u={width:I/v,height:k/_};var K=I/k,Q=v/_;return"contain"===S?K>Q?{x:g.x*u.width,y:(g.y-(_-v/K)/2)*u.width}:{x:(g.x-(v-_*K)/2)*u.height,y:g.y*u.height}:"cover"===S?K>Q?{x:(I-u.height*v)/2+g.x*u.height,y:g.y*u.height}:{x:g.x*u.width,y:(k-u.width*_)/2+g.y*u.width}:{x:g.x*u.width,y:g.y*u.height}}return{x:g.x*(u={width:1,height:1}).width,y:g.y*u.height}},Vi.Canvas.prototype._onTouchStart=function(p){var l=this.findTarget(p);!this.allowTouchScrolling&&p.cancelable&&p.preventDefault&&p.preventDefault(),l&&p.cancelable&&p.preventDefault&&p.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(p)),this.__onMouseDown(p),this._resetTransformEventData();var u=this.upperCanvasEl,f=this._getEventPrefix();Vi.util.addListener(Vi.document,"touchend",this._onTouchEnd,{passive:!1}),Vi.util.addListener(Vi.document,"touchmove",this._onMouseMove,{passive:!1}),Vi.util.removeListener(u,f+"down",this._onMouseDown)},Vi.Textbox.prototype._wrapLine=function(p,l,u,f){const g=p.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g);var v=0,_=this.splitByGrapheme||!(!g||!g.length),b=[],S=[],I=_?Vi.util.string.graphemeSplit(p):p.split(this._wordJoiners),k="",O=0,j=_?"":" ",W=0,J=0,K=0,Q=!0,ie=this._getWidthOfCharSpacing();f=f||0,0===I.length&&I.push([]),u-=f;for(var oe=0;oe<I.length;oe++)k=_?I[oe]:Vi.util.string.graphemeSplit(I[oe]),W=this._measureWord(k,l,O),O+=k.length,(v+=J+W-ie)>u&&!Q?(b.push(S),S=[],v=W,Q=!0):v+=ie,Q||_||S.push(j),S=S.concat(k),J=_?0:this._measureWord([j],l,O),O++,Q=!1,W>K&&(K=W);return oe&&b.push(S),K+f>this.dynamicMinWidth&&(this.dynamicMinWidth=K-ie+f),b});class po{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(l){this.fabricCanvas.selection=l,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(l,u,f){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,l.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=l.getFabricCanvas();else{let v=this.fabricCanvas=new Vi.Canvas(l,Object.assign(f,{allowTouchScrolling:!0,selection:!1}));v.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),v.lowerCanvasEl.className="",v.upperCanvasEl.className="",v.on("selection:created",function(_){const b=_.selected,S=[];for(let I of b){const k=I.getDrawingItem()._drawingLayer;k&&!S.includes(k)&&S.push(k)}for(let I of S){const k=[];for(let O of b){const j=O.getDrawingItem();j._drawingLayer===I&&k.push(j)}setTimeout(()=>{I.onSelectionChanged&&I.onSelectionChanged(k,[])},0)}}),v.on("before:selection:cleared",function(_){const b=this.getActiveObjects(),S=[];for(let I of b){const k=I.getDrawingItem()._drawingLayer;k&&!S.includes(k)&&S.push(k)}for(let I of S){const k=[];for(let O of b){const j=O.getDrawingItem();j._drawingLayer===I&&k.push(j)}setTimeout(()=>{const O=[];for(let j of k)I.hasDrawingItem(j)&&O.push(j);O.length>0&&I.onSelectionChanged&&I.onSelectionChanged([],O)},0)}}),v.on("selection:updated",function(_){const b=_.selected,S=_.deselected,I=[];for(let k of b){const O=k.getDrawingItem()._drawingLayer;O&&!I.includes(O)&&I.push(O)}for(let k of S){const O=k.getDrawingItem()._drawingLayer;O&&!I.includes(O)&&I.push(O)}for(let k of I){const O=[],j=[];for(let W of b){const J=W.getDrawingItem();J._drawingLayer===k&&O.push(J)}for(let W of S){const J=W.getDrawingItem();J._drawingLayer===k&&j.push(J)}setTimeout(()=>{k.onSelectionChanged&&k.onSelectionChanged(O,j)},0)}}),v.wrapperEl.style.position="absolute",l.getFabricCanvas=()=>this.fabricCanvas}let g,m;switch(this.id=u,u){case po.DDN_LAYER_ID:g=ln.getDrawingStyle(ln.STYLE_BLUE_STROKE),m=ln.getDrawingStyle(ln.STYLE_BLUE_STROKE_FILL);break;case po.DBR_LAYER_ID:g=ln.getDrawingStyle(ln.STYLE_ORANGE_STROKE),m=ln.getDrawingStyle(ln.STYLE_ORANGE_STROKE_FILL);break;case po.DLR_LAYER_ID:g=ln.getDrawingStyle(ln.STYLE_GREEN_STROKE),m=ln.getDrawingStyle(ln.STYLE_GREEN_STROKE_FILL);break;default:g=ln.getDrawingStyle(ln.STYLE_YELLOW_STROKE),m=ln.getDrawingStyle(ln.STYLE_YELLOW_STROKE_FILL)}for(let v of ic.arrMediaTypes)this.mapType_StateAndStyleId.set(v,{default:g.id,selected:m.id})}getId(){return this.id}setVisible(l){if(l){for(let u of this._arrFabricObject)u.visible=!0,u.hasControls=!0;this._visible=!0}else{for(let u of this._arrFabricObject)u.visible=!1,u.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(l){return l.styleId?ln.getDrawingStyle(l.styleId):ln.getDrawingStyle(l._mapState_StyleId.get(l.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(l,u,f,g){const m=this.getDrawingItems(v=>v._mediaType===l);for(let v of m)v.styleSelector===u&&this._changeItemStyle(v,f,!0);g||this.fabricCanvas.renderAll()}_changeItemStyle(l,u,f){if(!l||!u)return;const g=l._getFabricObject();"number"==typeof l.styleId&&(u=ln.getDrawingStyle(l.styleId)),g.strokeWidth=u.lineWidth,"fill"===u.paintMode?(g.fill=u.fillStyle,g.stroke=u.fillStyle):"stroke"===u.paintMode?(g.fill="transparent",g.stroke=u.strokeStyle):"strokeAndFill"===u.paintMode&&(g.fill=u.fillStyle,g.stroke=u.strokeStyle),g.fontFamily&&(g.fontFamily=u.fontFamily),g.fontSize&&(g.fontSize=u.fontSize),g.group||(g.dirty=!0),f||this.fabricCanvas.renderAll()}_updateGroupItem(l,u,f){if(!l||!u)return;const g=l.getChildDrawingItems();if("add"===f){if(g.includes(u))return;const m=u._getFabricObject();if(this.fabricCanvas.getObjects().includes(m)){if(!this._arrFabricObject.includes(m))throw new Error("Existed in other drawing layers.");u._zIndex=null}else{let v;if(u.styleId)v=ln.getDrawingStyle(u.styleId);else{const _=this.mapType_StateAndStyleId.get(u._mediaType);v=ln.getDrawingStyle(_[l.styleSelector]);const b=()=>{this._changeItemStyle(u,ln.getDrawingStyle(this.mapType_StateAndStyleId.get(u._mediaType).selected),!0)},S=()=>{this._changeItemStyle(u,ln.getDrawingStyle(this.mapType_StateAndStyleId.get(u._mediaType).default),!0)};u._on("selected",b),u._on("deselected",S),u._funcChangeStyleToSelected=b,u._funcChangeStyleToDefault=S}u._drawingLayer=this,u._drawingLayerId=this.id,this._changeItemStyle(u,v,!0)}l._fabricObject.addWithUpdate(u._getFabricObject())}else{if("remove"!==f||!g.includes(u))return;u._zIndex=null,u._drawingLayer=null,u._drawingLayerId=null,u._off("selected",u._funcChangeStyleToSelected),u._off("deselected",u._funcChangeStyleToDefault),u._funcChangeStyleToSelected=null,u._funcChangeStyleToDefault=null,l._fabricObject.removeWithUpdate(u._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(l,u){if(!(l instanceof ic))throw new TypeError("Invalid 'drawingItem'.");if(l._drawingLayer){if(l._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let f=l._getFabricObject();const g=this.fabricCanvas.getObjects();let m,v;if(g.includes(f)){if(this._arrFabricObject.includes(f))return;throw new Error("Existed in other drawing layers.")}if("group"===l._mediaType){m=l.getChildDrawingItems();for(let S of m)if(S._drawingLayer&&S._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(u&&"object"==typeof u&&!Array.isArray(u))for(let S in u)f.set(S,u[S]);if(m){for(let S of m){const I=this.mapType_StateAndStyleId.get(S._mediaType);for(let k of ic.arrStyleSelectors)S._mapState_StyleId.set(k,I[k]);if(S.styleId)v=ln.getDrawingStyle(S.styleId);else{v=ln.getDrawingStyle(I.default);const k=()=>{this._changeItemStyle(S,ln.getDrawingStyle(this.mapType_StateAndStyleId.get(S._mediaType).selected),!0)},O=()=>{this._changeItemStyle(S,ln.getDrawingStyle(this.mapType_StateAndStyleId.get(S._mediaType).default),!0)};S._on("selected",k),S._on("deselected",O),S._funcChangeStyleToSelected=k,S._funcChangeStyleToDefault=O}S._drawingLayer=this,S._drawingLayerId=this.id,this._changeItemStyle(S,v,!0)}f.dirty=!0,this.fabricCanvas.renderAll()}else{const S=this.mapType_StateAndStyleId.get(l._mediaType);for(let I of ic.arrStyleSelectors)l._mapState_StyleId.set(I,S[I]);if(l.styleId)v=ln.getDrawingStyle(l.styleId);else{v=ln.getDrawingStyle(S.default);const I=()=>{this._changeItemStyle(l,ln.getDrawingStyle(this.mapType_StateAndStyleId.get(l._mediaType).selected))},k=()=>{this._changeItemStyle(l,ln.getDrawingStyle(this.mapType_StateAndStyleId.get(l._mediaType).default))};l._on("selected",I),l._on("deselected",k),l._funcChangeStyleToSelected=I,l._funcChangeStyleToDefault=k}this._changeItemStyle(l,v)}l._zIndex=this.id,l._drawingLayer=this,l._drawingLayerId=this.id;const _=this._arrFabricObject.length;let b=g.length;if(_)b=g.indexOf(this._arrFabricObject[_-1])+1;else for(let S=0;S<g.length;S++)if(l._zIndex<g[S].getDrawingItem()._zIndex){b=S;break}this._arrDrwaingItem.push(l),this._arrFabricObject.push(f),f.visible=!!this._visible,this.fabricCanvas.insertAt(f,b,!1)}addDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)l._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");l._setEditable(!0)}this._addDrawingItem(l),l.updatePosition()}addDrawingItems(l){for(let u of l)this.addDrawingItem(u)}removeDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(l))return;if(l._zIndex=null,l._drawingLayer=null,l._drawingLayerId=null,"group"===l._mediaType){const f=l.getChildDrawingItems();for(let g of f)g._zIndex=null,g._drawingLayer=null,g._drawingLayerId=null,g._off("selected",g._funcChangeStyleToSelected),g._off("deselected",g._funcChangeStyleToDefault),g._funcChangeStyleToSelected=null,g._funcChangeStyleToDefault=null,g._mapState_StyleId.clear()}else l._off("selected",l._funcChangeStyleToSelected),l._off("deselected",l._funcChangeStyleToDefault),l._funcChangeStyleToSelected=null,l._funcChangeStyleToDefault=null,l._mapState_StyleId.clear();const u=l._getFabricObject();"selected"===l.styleSelector&&(u.group?u.group.removeWithUpdate(u):this.fabricCanvas._activeObject=null,l.setState(Fc.DIS_DEFAULT)),this.fabricCanvas.remove(u),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(l),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(u),1)}removeDrawingItems(l){for(let u of l)this.removeDrawingItem(u)}setDrawingItems(l){this.clearDrawingItems(),this.addDrawingItems(l)}getDrawingItems(l){return l&&"function"==typeof l?this._arrDrwaingItem.filter(l):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const l=this.fabricCanvas.getActiveObjects(),u=[];for(let f of l)this._arrFabricObject.includes(f)&&u.push(f.getDrawingItem());return u}hasDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(l)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(l,u,f){u?u.forEach(v=>v.toLowerCase()):u=ic.arrMediaTypes,f?f.forEach(v=>v.toLowerCase()):f=ic.arrStyleSelectors;const g=ln.getDrawingStyle(l);if(!g)throw new Error(`The 'drawingStyle' with id '${l}' doesn't exist.`);let m;for(let v of u)if(m=this.mapType_StateAndStyleId.get(v),m)for(let _ of f){this._changeMediaTypeCurStyleInStyleSelector(v,_,g,!0),m[_]=l;for(let b of this._arrDrwaingItem)b._mediaType===v&&b._mapState_StyleId.set(_,l)}this.fabricCanvas.renderAll()}setDefaultStyle(l,u,f){const g=[];f&ka.DIMT_RECTANGLE&&g.push("rect"),f&ka.DIMT_QUADRILATERAL&&g.push("quad"),f&ka.DIMT_TEXT&&g.push("text"),f&ka.DIMT_ARC&&g.push("arc"),f&ka.DIMT_IMAGE&&g.push("image"),f&ka.DIMT_POLYGON&&g.push("polygon"),f&ka.DIMT_LINE&&g.push("line");const m=[];u&Fc.DIS_DEFAULT&&m.push("default"),u&Fc.DIS_SELECTED&&m.push("selected"),this._setDefaultStyle(l,g.length?g:null,m.length?m:null)}setMode(l){if("viewer"===(l=l.toLowerCase())){for(let u of this._arrDrwaingItem)u._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==l)throw new RangeError("Invalid value.");for(let u of this._arrDrwaingItem)u._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(l,u){this.fabricCanvas.setDimensions(l,u)}_setObjectFit(l){if(l=l.toLowerCase(),!["contain","cover"].includes(l))throw new Error(`Unsupported value '${l}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=l,this.fabricCanvas.upperCanvasEl.style.objectFit=l}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let l of this._arrDrwaingItem){const u=this._getItemCurrentStyle(l);this._changeItemStyle(l,u,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}po.DDN_LAYER_ID=1,po.DBR_LAYER_ID=2,po.DLR_LAYER_ID=3,po.USER_DEFINED_LAYER_BASE_ID=100,po.TIP_LAYER_ID=999;class bIe{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(l,u){if(this.getDrawingLayer(u))throw new Error("Existed drawing layer id.");const f=new po(l,u,{enableRetinaScaling:!1});return f._manager=this,this._arrDrawingLayer.push(f),this._switchPointerEvent(),f}deleteDrawingLayer(l){const u=this.getDrawingLayer(l);if(!u)return;const f=this._arrDrawingLayer;u.dispose(),f.splice(f.indexOf(u),1),this._switchPointerEvent()}clearDrawingLayers(){for(let l of this._arrDrawingLayer)l.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(l){for(let u of this._arrDrawingLayer)if(u.getId()===l)return u;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const l=this._getFabricCanvas().getActiveObjects(),u=[];for(let f of l)u.push(f.getDrawingItem());return u}setDimensions(l,u){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(l,u)}setObjectFit(l){for(let u of this._arrDrawingLayer)u&&u._setObjectFit(l)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(l){this._arrDrawingLayer.length&&(this._getFabricCanvas().wrapperEl.style.display=l?"block":"none")}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let l of this._arrDrawingLayer)l.getMode()}}class xIe extends yIe{constructor(l,u,f,g,m){super(l,{x:u,y:f,width:g,height:0},m),Ly.set(this,void 0),jb.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var v=0,_=0,b=this._textLines.length;_<b;_++)v+=this.getHeightOfLine(_);return v+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(l){Pn(this,Ly,l,"f"),Me(this,jb,"f")&&clearTimeout(Me(this,jb,"f")),Me(this,Ly,"f")>=0&&Pn(this,jb,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},Me(this,Ly,"f")),"f")}getDuration(){return Me(this,Ly,"f")}}Ly=new WeakMap,jb=new WeakMap,Lc=new WeakMap,Hb=new WeakMap,Gb=new WeakMap,zb=new WeakMap,Ny=new WeakSet,zq=function(p,l,u,f,g,m){const v=new xIe(p,l,u,f,m);return v.coordinateBase=g,v},Yq=function(p,l){l.hasDrawingItem(p)||l.addDrawingItems([p])},Xq=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},$q=function(){if(!this._tip)return;const p=Me(this,Lc,"f");this._tip.coordinateBase=p.coordinateBase,this._tip.setTextRect({x:p.topLeftPoint.x,y:p.topLeftPoint.y,width:p.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class xM extends HTMLElement{constructor(){super(),wI.set(this,void 0);const l=document.createElement("template").content,u=document.createElement("div");u.setAttribute("class","wrapper"),l.appendChild(u),Pn(this,wI,u,"f");const f=document.createElement("slot");f.setAttribute("name","single-frame-input-container"),u.append(f);const g=document.createElement("slot");g.setAttribute("name","content"),u.append(g);const m=document.createElement("slot");m.setAttribute("name","drawing-layer"),u.append(m);const v=document.createElement("style");v.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',l.appendChild(v),this.attachShadow({mode:"open"}).appendChild(l.cloneNode(!0))}getWrapper(){return Me(this,wI,"f")}setElement(l,u){if(!(u instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");this.removeElement(l),u.setAttribute("slot",l),this.appendChild(u)}getElement(l){if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${l}"]`)}removeElement(l){var u;if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");null===(u=this.querySelectorAll(`[slot="${l}"]`))||void 0===u||u.forEach(f=>f.remove())}}wI=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",xM);class By extends HTMLElement{constructor(){super();const l=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(l.cloneNode(!0))}showScanLaser(){const l=this.shadowRoot.querySelector(".dce-scanlight");l&&(l.style.display="")}hideScanLaser(){const l=this.shadowRoot.querySelector(".dce-scanlight");l&&(l.style.display="none")}getElement(l){return this.shadowRoot.querySelector(l)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class Yo extends class wIe{constructor(){Ny.add(this),Lc.set(this,void 0),Hb.set(this,void 0),Gb.set(this,void 0),zb.set(this,!0),this._drawingLayerManager=new bIe}createDrawingLayerBaseCvs(l,u,f="contain"){if("number"!=typeof l||l<=1)throw new Error("Invalid 'width'.");if("number"!=typeof u||u<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(f))throw new Error("Unsupported 'objectFit'.");const g=document.createElement("canvas");return g.width==l&&g.height==u||(g.width=l,g.height=u),g.style.objectFit=f,g}_createDrawingLayer(l,u,f,g){if(!this._layerBaseCvs){let _;try{_=this.getContentDimensions()}catch(b){if("Invalid content dimensions."!==(b.message||b))throw b}u||(u=(null==_?void 0:_.width)||1280),f||(f=(null==_?void 0:_.height)||720),g||(g=(null==_?void 0:_.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(u,f,g)}const m=this._layerBaseCvs,v=this._drawingLayerManager.createDrawingLayer(m,l);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",m.parentElement),v}createDrawingLayer(){let l;for(let u=po.USER_DEFINED_LAYER_BASE_ID;;u++)if(!this._drawingLayerManager.getDrawingLayer(u)&&u!==po.TIP_LAYER_ID){l=u;break}return this._createDrawingLayer(l)}deleteDrawingLayer(l){var u;this._drawingLayerManager.deleteDrawingLayer(l),this._drawingLayerManager.getAllDrawingLayers().length||(null===(u=this._innerComponent)||void 0===u||u.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(l){if("number"!=typeof l)throw new TypeError("Invalid id.");if(l<po.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${l} is not defined by users.`);this.deleteDrawingLayer(l)}_clearDrawingLayers(){const l=this.getAllDrawingLayers();for(let u of l)this.deleteDrawingLayer(u.getId())}clearUserDefinedDrawingLayers(){const l=this.getAllDrawingLayers();for(let u of l){const f=u.getId();f<po.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(f)}}getDrawingLayer(l){return l==po.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(l)||([po.DDN_LAYER_ID,po.DBR_LAYER_ID,po.DLR_LAYER_ID].includes(l)?this._createDrawingLayer(l):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(l=>l.getId()>=0&&l.getId()!==po.TIP_LAYER_ID)}updateDrawingLayers(l){((u,f,g)=>{if(!(u<=1||f<=1)){if(!["contain","cover"].includes(g))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:u,height:f},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(g)}})(l.width,l.height,l.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(l){if(!(Nq(u=l)&&mIe(u.topLeftPoint)&&ky(u.width))||u.width<=0||!ky(u.duration)||"coordinateBase"in u&&!["view","image"].includes(u.coordinateBase))throw new Error("Invalid tip config.");var u;Pn(this,Lc,JSON.parse(JSON.stringify(l)),"f"),Me(this,Lc,"f").coordinateBase||(Me(this,Lc,"f").coordinateBase="view"),Pn(this,Gb,l.duration,"f"),Me(this,Ny,"m",$q).call(this)}getTipConfig(){return Me(this,Lc,"f")?Me(this,Lc,"f"):null}setTipVisible(l){if("boolean"!=typeof l)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",l),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Pn(this,zb,l,"f")}isTipVisible(){return Me(this,zb,"f")}updateTipMessage(l){if(!Me(this,Lc,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=ln.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(po.TIP_LAYER_ID)||this._createDrawingLayer(po.TIP_LAYER_ID)),this._tip?this._tip.set("text",l):this._tip=Me(this,Ny,"m",zq).call(this,l,Me(this,Lc,"f").topLeftPoint.x,Me(this,Lc,"f").topLeftPoint.y,Me(this,Lc,"f").width,Me(this,Lc,"f").coordinateBase,this._tipStyleId),Me(this,Ny,"m",Yq).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",Me(this,zb,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),Me(this,Hb,"f")&&clearTimeout(Me(this,Hb,"f")),Me(this,Gb,"f")>=0&&Pn(this,Hb,setTimeout(()=>{Me(this,Ny,"m",Xq).call(this)},Me(this,Gb,"f")),"f")}}{static get engineResourcePath(){return Yr.engineResourcePaths.dce}static set defaultUIElementURL(l){Yo._defaultUIElementURL=l}static get defaultUIElementURL(){var l;return null===(l=Yo._defaultUIElementURL)||void 0===l?void 0:l.replace("@engineResourcePath/",Yo.engineResourcePath)}static createInstance(l){return Fe(function*(){customElements.get(Yo.uiComponentName)||customElements.define(Yo.uiComponentName,By);const u=new Yo;return yield u.setUIElement(l||Yo.defaultUIElementURL),u})()}static _transformCoordinates(l,u,f,g,m,v,_){const S=_/m;l.x=Math.round(l.x/(v/g)+u),l.y=Math.round(l.y/S+f)}set _singleFrameMode(l){if(!["disabled","image","camera"].includes(l))throw new Error("Invalid value.");if(l!==Me(this,qb,"f")){if(Pn(this,qb,l,"f"),Me(this,Vr,"m",Nc).call(this))Pn(this,Vs,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!Me(this,Vs,"f")){const u=document.createElement("video");u.style.position="absolute",u.style.left="0",u.style.top="0",u.style.width="100%",u.style.height="100%",u.style.objectFit=this.getVideoFit(),u.setAttribute("autoplay","true"),u.setAttribute("playsinline","true"),u.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Ra.OS)&&u.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Pn(this,Vs,u,"f");const f=document.createElement("div");f.append(u),f.style.overflow="hidden",this._videoContainer=f,this._innerComponent.setElement("content",f)}Me(this,Vr,"m",Nc).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return Me(this,qb,"f")}get disposed(){return Me(this,_M,"f")}constructor(){var l;super(),l=this,Vr.add(this),Yb.set(this,void 0),Xb.set(this,void 0),$b.set(this,void 0),this.containerClassName="dce-video-container",Vs.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,SI.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,TI.set(this,!1),II.set(this,!1),wg.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{Me(this,Vr,"m",Jb).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&Me(this,Vr,"m",bM).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{Yo._onLog&&Yo._onLog("window resize event triggered."),Me(this,wg,"f").width===document.documentElement.clientWidth&&Me(this,wg,"f").height===document.documentElement.clientHeight||(Me(this,wg,"f").width=document.documentElement.clientWidth,Me(this,wg,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},qb.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!Me(this,Vr,"m",Nc).call(this))return;let u;if(this._singleFrameInputContainer)u=this._singleFrameInputContainer.firstElementChild;else{u=document.createElement("input"),u.setAttribute("type","file"),"camera"===this._singleFrameMode?(u.setAttribute("capture",""),u.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(u.removeAttribute("capture"),u.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),u.addEventListener("change",Fe(function*(){const g=u.files[0];u.value="";{const m=function(){var j=Fe(function*(W){let J=null,K=null;if("undefined"!=typeof createImageBitmap)try{if(J=yield createImageBitmap(W),J)return J}catch(ie){}var Q;return J||(K=yield(Q=W,new Promise((ie,oe)=>{let le=URL.createObjectURL(Q),he=new Image;he.src=le,he.onload=()=>{URL.revokeObjectURL(he.src),ie(he)},he.onerror=_e=>{oe(new Error("Can't convert blob to image : "+(_e instanceof Event?_e.type:_e)))}}))),K});return function(J){return j.apply(this,arguments)}}(),v=(j,W,J,K)=>{j.width==J&&j.height==K||(j.width=J,j.height=K);const Q=j.getContext("2d");Q.clearRect(0,0,j.width,j.height),Q.drawImage(W,0,0)},_=yield m(g),b=_ instanceof HTMLImageElement?_.naturalWidth:_.width,S=_ instanceof HTMLImageElement?_.naturalHeight:_.height;let I=l._cvsSingleFrameMode;const k=null==I?void 0:I.width,O=null==I?void 0:I.height;I||(I=document.createElement("canvas"),l._cvsSingleFrameMode=I),v(I,_,b,S),l._innerComponent.setElement("content",I),k===I.width&&O===I.height||l.eventHandler.fire("content:updated",null,{async:!1})}l._onSingleFrameAcquired&&setTimeout(()=>{l._onSingleFrameAcquired(l._cvsSingleFrameMode)},0)})),u.style.position="absolute",u.style.top="-9999px",u.style.backgroundColor="transparent",u.style.color="transparent";const f=document.createElement("div");f.append(u),this._innerComponent.setElement("single-frame-input-container",f),this._singleFrameInputContainer=f}null==u||u.click()},Kb.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(u,f)=>{var g,m,v,_;if(this.disposed||(this.clearAllInnerDrawingItems(),!u))return;const b=u.originalImageTag;if(!b)return;const S=u.items;if(!(null==S?void 0:S.length))return;const I=(null===(g=b.cropRegion)||void 0===g?void 0:g.left)||0,k=(null===(m=b.cropRegion)||void 0===m?void 0:m.top)||0,O=(null===(v=b.cropRegion)||void 0===v?void 0:v.right)?b.cropRegion.right-I:b.originalWidth,j=(null===(_=b.cropRegion)||void 0===_?void 0:_.bottom)?b.cropRegion.bottom-k:b.originalHeight,W=b.currentWidth,J=b.currentHeight,K=(oe,le,he,_e,Ve,ee,ke,xe,Le=[],V)=>{le.forEach(z=>Yo._transformCoordinates(z,he,_e,Ve,ee,ke,xe));const F=new _Ie({points:[{x:le[0].x,y:le[0].y},{x:le[1].x,y:le[1].y},{x:le[2].x,y:le[2].y},{x:le[3].x,y:le[3].y}]},V);for(let z of Le)F.addNote(z);oe.addDrawingItems([F]),Me(this,Kb,"f").push(F)};let Q,ie;for(let oe of S)switch(oe.type){case io.CRIT_ORIGINAL_IMAGE:break;case io.CRIT_BARCODE:Q=this.getDrawingLayer(po.DBR_LAYER_ID),ie=[{name:"format",content:oe.formatString},{name:"text",content:oe.text}],(null==f?void 0:f.isBarcodeVerifyOpen)?oe.verified?K(Q,oe.location.points,I,k,O,j,W,J,ie):K(Q,oe.location.points,I,k,O,j,W,J,ie,ln.STYLE_ORANGE_STROKE_TRANSPARENT):K(Q,oe.location.points,I,k,O,j,W,J,ie);break;case io.CRIT_TEXT_LINE:Q=this.getDrawingLayer(po.DLR_LAYER_ID),ie=[{name:"text",content:oe.text}],f.isLabelVerifyOpen?oe.verified?K(Q,oe.location.points,I,k,O,j,W,J,ie):K(Q,oe.location.points,I,k,O,j,W,J,ie,ln.STYLE_GREEN_STROKE_TRANSPARENT):K(Q,oe.location.points,I,k,O,j,W,J,ie);break;case io.CRIT_DETECTED_QUAD:Q=this.getDrawingLayer(po.DDN_LAYER_ID),(null==f?void 0:f.isDetectVerifyOpen)?oe.verified?K(Q,oe.location.points,I,k,O,j,W,J,[]):K(Q,oe.location.points,I,k,O,j,W,J,[],ln.STYLE_BLUE_STROKE_TRANSPARENT):K(Q,oe.location.points,I,k,O,j,W,J,[]);break;case io.CRIT_NORMALIZED_IMAGE:Q=this.getDrawingLayer(po.DDN_LAYER_ID),(null==f?void 0:f.isNormalizeVerifyOpen)?oe.verified?K(Q,oe.location.points,I,k,O,j,W,J,[]):K(Q,oe.location.points,I,k,O,j,W,J,[],ln.STYLE_BLUE_STROKE_TRANSPARENT):K(Q,oe.location.points,I,k,O,j,W,J,[]);break;case io.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},_M.set(this,!1),this.eventHandler=new jq,this.eventHandler.on("content:updated",()=>{Me(this,Yb,"f")&&clearTimeout(Me(this,Yb,"f")),Pn(this,Yb,setTimeout(()=>{if(this.disposed)return;let u;this._updateVideoContainer();try{u=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}this.updateDrawingLayers(u),this.updateConvertedRegion(u)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{Me(this,Xb,"f")&&clearTimeout(Me(this,Xb,"f")),Pn(this,Xb,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(l){l instanceof HTMLTemplateElement?(window._dce_default_template=l,this.UIElement=new By):this.UIElement=l,this._unbindUI(),this._bindUI()}setUIElement(l){var u=this;return Fe(function*(){let f;if(f="string"==typeof l?yield fM(l):l,f instanceof HTMLDivElement&&0==f.childElementCount){const g=yield fM(Yo.defaultUIElementURL);g instanceof HTMLTemplateElement?(window._dce_default_template=g,f.append(new By)):f.append(g),u._setUIElement(f)}else u._setUIElement(f)})()}getUIElement(){return this.UIElement}_bindUI(){var l;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let u,f=this.UIElement;if(f instanceof By?u=f.getElement(`.${this.containerClassName}`):f instanceof HTMLDivElement&&1===f.childElementCount&&f.firstElementChild instanceof By?(u=f.firstElementChild.getElement(`.${this.containerClassName}`),f=f.firstElementChild):u=f.classList.contains(this.containerClassName)?f:f.querySelector(`.${this.containerClassName}`),!u)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new xM,u.appendChild(this._innerComponent),!Me(this,Vr,"m",Nc).call(this)){const g=document.createElement("video");g.style.position="absolute",g.style.left="0",g.style.top="0",g.style.width="100%",g.style.height="100%",g.style.objectFit=this.getVideoFit(),g.setAttribute("autoplay","true"),g.setAttribute("playsinline","true"),g.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Ra.OS)&&g.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Pn(this,Vs,g,"f");const m=document.createElement("div");m.append(g),m.style.overflow="hidden",this._videoContainer=m,this._innerComponent.setElement("content",m)}if(f instanceof By?(this._selRsl=f.getElement(".dce-sel-resolution"),this._selMinLtr=f.getElement(".dlr-sel-minletter"),this._divScanArea=f.getElement(".dce-scanarea"),this._divScanLight=f.getElement(".dce-scanlight"),this._bgLoading=f.getElement(".dce-bg-loading"),this._bgCamera=f.getElement(".dce-bg-camera"),this._selCam=f.getElement(".dce-sel-camera"),this._optGotRsl=f.getElement(".dce-opt-gotResolution"),this._btnClose=f.getElement(".dce-btn-close"),this._optGotMinLtr=f.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=f.querySelector(".dce-sel-resolution"),this._selMinLtr=f.querySelector(".dlr-sel-minletter"),this._divScanArea=f.querySelector(".dce-scanarea"),this._divScanLight=f.querySelector(".dce-scanlight"),this._bgLoading=f.querySelector(".dce-bg-loading"),this._bgCamera=f.querySelector(".dce-bg-camera"),this._selCam=f.querySelector(".dce-sel-camera"),this._optGotRsl=f.querySelector(".dce-opt-gotResolution"),this._btnClose=f.querySelector(".dce-btn-close"),this._optGotMinLtr=f.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||Me(this,Vr,"m",Nc).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||Me(this,Vr,"m",Nc).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||Me(this,Vr,"m",Jb).call(this),Me(this,Vr,"m",Nc).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),Me(this,Vr,"m",Nc).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(m=>{var v;Yo._onLog&&Yo._onLog("resize observer triggered.");for(let _ of m)_.target===(null===(v=this._innerComponent)||void 0===v?void 0:v.getWrapper())&&this._videoResizeListener()}));const g=null===(l=this._innerComponent)||void 0===l?void 0:l.getWrapper();g&&this._resizeObserver.observe(g)}Me(this,wg,"f").width=document.documentElement.clientWidth,Me(this,wg,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var l,u,f,g;Me(this,Vr,"m",Nc).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),Me(this,Vr,"m",Jb).call(this),null===(l=this._drawingLayerManager)||void 0===l||l.clearDrawingLayers(),null===(u=this._innerComponent)||void 0===u||u.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(f=this._innerComponent)||void 0===f||f.remove(),this._innerComponent=null,Pn(this,Vs,null,"f"),null===(g=this._videoContainer)||void 0===g||g.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(l,u){if(!this._selCam)return;let f;this._selCam.textContent="";for(let g of u){const m=document.createElement("option");m.value=g.deviceId,m.innerText=g.label,this._selCam.append(m),g.deviceId&&l&&l.deviceId==g.deviceId&&(f=m)}this._selCam.value=f?f.value:""}_renderResolutionInfo(l){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",l.width),this._optGotRsl.setAttribute("data-height",l.height),this._optGotRsl.innerText="got "+l.width+"x"+l.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return Me(this,Vs,"f")}isVideoLoaded(){return!!Me(this,Vs,"f")&&4==Me(this,Vs,"f").readyState}setVideoFit(l){if(l=l.toLowerCase(),!["contain","cover"].includes(l))throw new Error(`Unsupported value '${l}'.`);if(this.videoFit=l,!Me(this,Vs,"f")||(Me(this,Vs,"f").style.objectFit=l,Me(this,Vr,"m",Nc).call(this)))return;let u;this._updateVideoContainer();try{u=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}Me(this,Vr,"m",DI).call(this,u,this.getConvertedRegion()),this.updateDrawingLayers(u)}getVideoFit(){return this.videoFit}getContentDimensions(){var l,u,f,g;let m,v,_;if(Me(this,Vr,"m",Nc).call(this)?(m=null===(f=this._cvsSingleFrameMode)||void 0===f?void 0:f.width,v=null===(g=this._cvsSingleFrameMode)||void 0===g?void 0:g.height,_="contain"):(m=null===(l=Me(this,Vs,"f"))||void 0===l?void 0:l.videoWidth,v=null===(u=Me(this,Vs,"f"))||void 0===u?void 0:u.videoHeight,_=this.getVideoFit()),!m||!v)throw new Error("Invalid content dimensions.");return{width:m,height:v,objectFit:_}}updateConvertedRegion(l){const u=CI.convert(this.scanRegion,l.width,l.height);Pn(this,SI,u,"f"),Me(this,$b,"f")&&clearTimeout(Me(this,$b,"f")),Pn(this,$b,setTimeout(()=>{let f;try{f=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}Me(this,Vr,"m",EI).call(this,f,u),Me(this,Vr,"m",DI).call(this,f,u)},0),"f")}getConvertedRegion(){return Me(this,SI,"f")}setScanRegion(l){if(null!=l&&!dM(l)&&!Gf(l))throw TypeError("Invalid 'region'.");let u;this.scanRegion=l?JSON.parse(JSON.stringify(l)):null;try{u=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}this.updateConvertedRegion(u)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(l){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const u=Me(this,Vs,"f").videoWidth,f=Me(this,Vs,"f").videoHeight,g=this.getVideoFit(),{width:m,height:v}=this._innerComponent.getBoundingClientRect();if(m<=0||v<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let _;const b={x:0,y:0,width:u,height:f,isMeasuredInPercentage:!1};if("cover"===g&&(m/v<u/f?(_=v/f,b.x=Math.floor((u-m/_)/2),b.y=0,b.width=Math.ceil(m/_),b.height=f):(_=m/u,b.x=0,b.y=Math.floor((f-v/_)/2),b.width=u,b.height=Math.ceil(v/_))),null==l?void 0:l.inPixels)return b;const S=b;return S.x=Math.ceil(S.x/f*100),S.y=Math.ceil(S.y/u*100),S.width=Math.floor(S.width/u*100),S.height=Math.floor(S.height/f*100),S.isMeasuredInPercentage=!0,b}setScanRegionMask(l,u,f,g){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||Me(this,Vr,"m",CM).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=ln.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=ln.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const m=this._drawingLayerOfMask.width,v=this._drawingLayerOfMask.height,_=new Oy({x:0,y:0,width:m,height:v},this._maskBackRectStyleId),b=new Oy({x:-m/2,y:-v/2+u,width:l,height:g}),S=new Oy({x:-m/2+l+f,y:-v/2+u,width:m-l-f<0?0:m-l-f,height:g}),I=new Oy({x:-m/2,y:-v/2,width:m,height:u}),k=new Oy({x:-m/2,y:-v/2+u+g,width:m,height:v-u-g<0?0:v-u-g});b.set("strokeWidth",0),S.set("strokeWidth",0),I.set("strokeWidth",0),k.set("strokeWidth",0);const O=new CIe([b,S,I,k])._getFabricObject();_.set("clipPath",O);const j=new Oy({x:l,y:u,width:f,height:g},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([_,j])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(l){Pn(this,TI,l,"f"),l?Me(this,Vr,"m",qq).call(this):Me(this,Vr,"m",CM).call(this)}setScanRegionMaskVisible(l){this._setScanRegionMaskVisible(l),this._userSetMaskVisible=l}isScanRegionMaskVisible(){return Me(this,TI,"f")}setScanRegionMaskStyle(l){if(!l)return;let u;l.fillStyle&&(this.regionMaskFillStyle=l.fillStyle),l.strokeStyle&&(this.regionMaskStrokeStyle=l.strokeStyle),l.lineWidth&&(this.regionMaskLineWidth=l.lineWidth),this._maskBackRectStyleId&&ln.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&ln.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{u=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}Me(this,Vr,"m",EI).call(this,u,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(l){Pn(this,II,l,"f"),l?Me(this,Vr,"m",bM).call(this):Me(this,Vr,"m",Jb).call(this)}setScanLaserVisible(l){this._setScanLaserVisible(l),this._userSetLaserVisible=l}isScanLaserVisible(){return Me(this,II,"f")}_updateVideoContainer(){if(!Me(this,Vs,"f")||Me(this,Vr,"m",Nc).call(this))return;let l=1;const u=Me(this,Vs,"f").style.transform.match(/scale\((.+)\)/);u&&(l=parseFloat(u[1]));const f=this._videoContainer;if("contain"===this.videoFit&&l>1){const g=Me(this,Vs,"f").videoWidth,m=Me(this,Vs,"f").videoHeight,{width:v,height:_}=this._innerComponent.getBoundingClientRect(),b=g/m;if(v/_<b){let S=v/b;f.style.left="0",f.style.top=(_-S)/2/_*100+"%",f.style.width="100%",f.style.height=S/_*100+"%"}else{let S=_*b;f.style.left=(v-S)/2/v*100+"%",f.style.top="0",f.style.width=S/v*100+"%",f.style.height="100%"}}else f.style.left="0",f.style.top="0",f.style.width="100%",f.style.height="100%"}updateLayers(){let l;this._updateVideoContainer();try{l=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}const u=this.getConvertedRegion();Me(this,Vr,"m",DI).call(this,l,u),this.updateDrawingLayers(l),Me(this,Vr,"m",EI).call(this,l,u)}clearAllInnerDrawingItems(){Me(this,Kb,"f").forEach(l=>l.remove()),Me(this,Kb,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let l in this)delete this[l];Object.defineProperty(this,"disposed",{value:!0})}}function ot(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function er(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}Yb=new WeakMap,Xb=new WeakMap,$b=new WeakMap,Vs=new WeakMap,SI=new WeakMap,TI=new WeakMap,II=new WeakMap,wg=new WeakMap,qb=new WeakMap,Kb=new WeakMap,_M=new WeakMap,Vr=new WeakSet,Nc=function(){return"disabled"!==this._singleFrameMode},EI=function(p,l){!l||0===l.x&&0===l.y&&l.width===p.width&&l.height===p.height?this.clearScanRegionMask():this.setScanRegionMask(l.x,l.y,l.width,l.height)},qq=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},CM=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},bM=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},Jb=function(){this._divScanLight&&(this._divScanLight.style.display="none")},DI=function(p,l){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:u,height:f,objectFit:g}=p;l||(l={x:0,y:0,width:u,height:f});const{width:m,height:v}=this._innerComponent.getBoundingClientRect();if(m<=0||v<=0)return;const _=m/v,b=u/f;let S,I,k,O,j=1;if("contain"===g)_<b?(j=m/u,S=0,I=(v-f*j)/2):(j=v/f,S=(m-u*j)/2,I=0),S+=l.x*j,I+=l.y*j,k=l.width*j,O=l.height*j;else if("cover"===g)if(_<b){j=v/f,S=l.x*j-(u*j-m)/2,S=Math.max(S,0),S=Math.min(S,m),I=l.y*j;let W=(l.x+l.width)*j-(u*j-m)/2;W=Math.max(W,0),W=Math.min(W,m),k=W-S,O=l.height*j}else{j=m/u,S=l.x*j,I=l.y*j-(f*j-v)/2,I=Math.max(I,0),I=Math.min(I,v);let W=(l.y+l.height)*j-(f*j-v)/2;W=Math.max(W,0),W=Math.min(W,v),k=l.width*j,O=W-I}else S=0,I=0,k=0,O=0;this._divScanArea.style.left=S+"px",this._divScanArea.style.top=I+"px",this._divScanArea.style.width=k+"px",this._divScanArea.style.height=O+"px"},Yo.uiComponentName="default-camera-view",Yo._defaultUIElementURL="@engineResourcePath/dce.ui.html","function"==typeof SuppressedError&&SuppressedError;const Kq="undefined"==typeof self;let Qb,Zb,AI,wM,sl;function kl(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function Ld(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}"undefined"!=typeof navigator&&(Qb=navigator,Zb=Qb.userAgent,AI=Qb.platform,wM=Qb.mediaDevices),function(){if(!Kq){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Qb.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:AI,search:"Win"},Mac:{str:AI},Linux:{str:AI}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let S=v.verStr||Zb,I=v.verSearch||m;if(I instanceof Array||(I=[I]),-1!=(v.str||Zb).indexOf(v.search||m)){u=m;for(let k of I){let O=S.indexOf(k);if(-1!=O){f=parseFloat(S.substring(O+k.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Zb).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=Zb.indexOf("Windows NT")&&(g="HarmonyOS"),sl={browser:u,version:f,OS:g}}Kq&&(sl={browser:"ssr",version:0,OS:"ssr"})}(),"function"==typeof SuppressedError&&SuppressedError;let Yf=class{static multiply(l,u){const f=[];for(let g=0;g<3;g++){const m=u.slice(3*g,3*g+3);for(let v=0;v<3;v++){const _=[l[v],l[v+3],l[v+6]].reduce((b,S,I)=>b+S*m[I],0);f.push(_)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(l,u,f){return wn.multiply(l,[1,0,0,0,1,0,u,f,1])}static rotate(l,u){var f=Math.cos(u),g=Math.sin(u);return wn.multiply(l,[f,-g,0,g,f,0,0,0,1])}static scale(l,u,f){return wn.multiply(l,[u,0,0,0,f,0,0,0,1])}};var tr,Xf,$f,PI,Wy,ex,tx,Uy,RI,ov,kI,SM,Mn,Ei,vr,MI,OI,Xr,Ou,qf,Vy,FI,kh,Kf,Bc,jy,Hy,nx,LI,Gy,sv,Jf,Qf,TM,js,IM,av,Jq,NI,BI,Qq,Nd,EM,DM,zy,ix,WI,Wc,Yy,AM,PM,Zq;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(tr||(tr={}));class li{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(Ld(li,Xf,!1,"f",$f),!1):(Ld(li,Xf,!0,"f",$f),!0)}get disposed(){return kl(this,RI,"f")}constructor(){PI.set(this,tr.RGBA),Wy.set(this,null),ex.set(this,null),tx.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Uy.set(this,null),RI.set(this,!1)}drawImage(l,u,f,g,m,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==kl(li,Xf,"f",$f)&&li.checkWebGLSupport(),(null==v?void 0:v.bUseWebGL)&&!kl(li,Xf,"f",$f))throw new Error("Your browser or machine may not support WebGL.");if(u instanceof HTMLVideoElement&&4!==u.readyState||u instanceof HTMLImageElement&&!u.complete)throw new Error("The source is not loaded.");let _;li._onLog&&(_=Date.now(),li._onLog("drawImage(), START: "+_));let b=0,S=0,I=f,k=g,O=0,j=0,W=f,J=g;m&&(m.sx&&(b=Math.round(m.sx)),m.sy&&(S=Math.round(m.sy)),m.sWidth&&(I=Math.round(m.sWidth)),m.sHeight&&(k=Math.round(m.sHeight)),m.dx&&(O=Math.round(m.dx)),m.dy&&(j=Math.round(m.dy)),m.dWidth&&(W=Math.round(m.dWidth)),m.dHeight&&(J=Math.round(m.dHeight)));let K,Q=tr.RGBA;if((null==v?void 0:v.pixelFormat)&&(Q=v.pixelFormat),(null==v?void 0:v.bufferContainer)&&(K=v.bufferContainer,K.length<4*W*J))throw new Error("Unexpected size of the 'bufferContainer'.");const ie=l;if(!kl(li,Xf,"f",$f)||!(this.useWebGLByDefault&&null==(null==v?void 0:v.bUseWebGL)||(null==v?void 0:v.bUseWebGL))){li._onLog&&li._onLog("drawImage() in context2d."),ie.ctx2d||(ie.ctx2d=ie.getContext("2d",{willReadFrequently:!0}));const oe=ie.ctx2d;if(!oe)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(ie.width<O+W||ie.height<j+J)&&(ie.width=O+W,ie.height=j+J),oe.drawImage(u,b,S,I,k,O,j,W,J),li._onLog&&li._onLog("drawImage() in context2d end. Costs: "+(Date.now()-_)),{context:oe,pixelFormat:tr.RGBA,bUseWebGL:!1}}li._onLog&&li._onLog("drawImage() in WebGL.");try{(ie.width<O+W||ie.height<j+J)&&(ie.width=O+W,ie.height=j+J,ie.ctxWebGL&&ie.ctxWebGL.viewport(0,0,O+W,j+J));const oe=ie.ctxWebGL||ie.getContext("webgl",{antialias:!1})||ie.getContext("experimental-webgl",{antialias:!1});if(!oe){li._onLog&&li._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const ee=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw ee.name="WebGLError",ee}if(!ie.ctxWebGL||Q!==kl(this,PI,"f")){ie.ctxWebGL=oe;const ee=P=>{const L=P.createBuffer();P.bindBuffer(P.ARRAY_BUFFER,L),P.bufferData(P.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),P.STATIC_DRAW);const X=P.createBuffer();return P.bindBuffer(P.ARRAY_BUFFER,X),P.bufferData(P.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),P.STATIC_DRAW),{positions:L,texCoords:X}},ke=P=>{const L=P.createTexture();return P.bindTexture(P.TEXTURE_2D,L),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),L},xe=(P,L)=>{const X=P.createProgram();if(L.forEach(ne=>P.attachShader(X,ne)),P.linkProgram(X),!P.getProgramParameter(X,P.LINK_STATUS)){const ne=new Error(`An error occured linking the program: ${P.getProgramInfoLog(X)}.`);throw ne.name="WebGLError",ne}return P.useProgram(X),X},Le=(P,L,X)=>{const ne=P.createShader(L);if(P.shaderSource(ne,X),P.compileShader(ne),!P.getShaderParameter(ne,P.COMPILE_STATUS)){const Z=new Error(`An error occured compiling the shader: ${P.getShaderInfoLog(ne)}.`);throw Z.name="WebGLError",Z}return ne},V="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let F="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(Q)&&(F=Q.slice(0,3));const z=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${F} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,$=xe(oe,[Le(oe,oe.VERTEX_SHADER,V),Le(oe,oe.FRAGMENT_SHADER,z)]);Ld(this,ex,{program:$,attribLocations:{vertexPosition:oe.getAttribLocation($,"a_position"),texPosition:oe.getAttribLocation($,"a_texCoord")},uniformLocations:{uSampler:oe.getUniformLocation($,"u_image"),uColorFactor:oe.getUniformLocation($,"uColorFactor"),uMatrix:oe.getUniformLocation($,"u_matrix"),uTextureMatrix:oe.getUniformLocation($,"u_textureMatrix")}},"f"),Ld(this,tx,ee(oe),"f"),Ld(this,Wy,ke(oe),"f"),Ld(this,PI,Q,"f")}const le=(ee,ke,xe)=>{ee.bindBuffer(ee.ARRAY_BUFFER,ke),ee.enableVertexAttribArray(xe),ee.vertexAttribPointer(xe,2,ee.FLOAT,!1,0,0)},_e=(ee,ke,xe,Le)=>{ee.clearColor(0,0,0,1),ee.clearDepth(1),ee.enable(ee.DEPTH_TEST),ee.depthFunc(ee.LEQUAL),ee.clear(ee.COLOR_BUFFER_BIT|ee.DEPTH_BUFFER_BIT),le(ee,xe.positions,ke.attribLocations.vertexPosition),le(ee,xe.texCoords,ke.attribLocations.texPosition),ee.activeTexture(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_2D,Le),ee.uniform1i(ke.uniformLocations.uSampler,0),ee.uniform1f(ke.uniformLocations.uColorFactor,[tr.GREY,tr.GREY32].includes(Q)?1:0);let V,F,z=Yf.translate(Yf.identity(),-1,-1);z=Yf.scale(z,2,2),z=Yf.scale(z,1/ee.canvas.width,1/ee.canvas.height),V=Yf.translate(z,O,j),V=Yf.scale(V,W,J),ee.uniformMatrix3fv(ke.uniformLocations.uMatrix,!1,V),F=Yf.translate(Yf.identity(),b/f,S/g),F=Yf.scale(F,I/f,k/g),ee.uniformMatrix3fv(ke.uniformLocations.uTextureMatrix,!1,F),ee.drawArrays(ee.TRIANGLES,0,6)};((ee,ke,xe)=>{const Le=ee.RGBA,V=ee.RGBA,F=ee.UNSIGNED_BYTE;ee.bindTexture(ee.TEXTURE_2D,ke),ee.texImage2D(ee.TEXTURE_2D,0,Le,V,F,xe)})(oe,kl(this,Wy,"f"),u),_e(oe,kl(this,ex,"f"),kl(this,tx,"f"),kl(this,Wy,"f"));const Ve=K||new Uint8Array(4*W*J);if(oe.readPixels(O,j,W,J,oe.RGBA,oe.UNSIGNED_BYTE,Ve),255!==Ve[3]){li._onLog&&li._onLog("Incorrect WebGL drawing .");const ee=new Error("WebGL error: incorrect drawing.");throw ee.name="WebGLError",ee}return li._onLog&&li._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-_)),{context:oe,pixelFormat:Q===tr.GREY?tr.GREY32:Q,bUseWebGL:!0}}catch(oe){if(this.forceLoseContext(),null==(null==v?void 0:v.bUseWebGL))return li._onLog&&li._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(l,u,f,g,m,Object.assign({},v,{bUseWebGL:!1}));throw oe.name="WebGLError",oe}}readCvsData(l,u,f){if(!(l instanceof CanvasRenderingContext2D||l instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let g,m=0,v=0,_=l.canvas.width,b=l.canvas.height;if(u&&(u.x&&(m=u.x),u.y&&(v=u.y),u.width&&(_=u.width),u.height&&(b=u.height)),(null==f?void 0:f.length)<4*_*b)throw new Error("Unexpected size of the 'bufferContainer'.");if(l instanceof WebGLRenderingContext){const S=l;f?(S.readPixels(m,v,_,b,S.RGBA,S.UNSIGNED_BYTE,f),g=new Uint8Array(f.buffer,0,4*_*b)):(g=new Uint8Array(4*_*b),S.readPixels(m,v,_,b,S.RGBA,S.UNSIGNED_BYTE,g))}else if(l instanceof CanvasRenderingContext2D){let S;S=l.getImageData(m,v,_,b),g=new Uint8Array(S.data.buffer),null==f||f.set(g)}return g}transformPixelFormat(l,u,f,g){let m,v;if(li._onLog&&(m=Date.now(),li._onLog("transformPixelFormat(), START: "+m)),u===f)return li._onLog&&li._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),g?new Uint8Array(l):l;const _=[tr.RGBA,tr.RBGA,tr.GRBA,tr.GBRA,tr.BRGA,tr.BGRA];if(_.includes(u))if(f===tr.GREY){v=new Uint8Array(l.length/4);for(let b=0;b<l.length;b+=4)v[b/4]=.21*l[b]+.71*l[b+1]+.07*l[b+2]}else if(f===tr.GREY32){v=g?new Uint8Array(l):l;for(let b=0;b<l.length;b+=4){const S=.21*l[b]+.71*l[b+1]+.07*l[b+2];v[b]=S,v[b+1]=S,v[b+2]=S}}else{if(!_.includes(f))throw new Error("Unable to transform.");if(g){v=new Uint8Array(l);const b=u.indexOf("r"),S=u.indexOf("g"),I=u.indexOf("b"),k=f.indexOf("r"),O=f.indexOf("g"),j=f.indexOf("b");for(let W=0;W<l.length;W+=4)v[W+k]=l[W+b],v[W+O]=l[W+S],v[W+j]=l[W+I]}else{v=l;const b=u.indexOf("r"),S=u.indexOf("g"),I=u.indexOf("b"),k=f.indexOf("r"),O=f.indexOf("g"),j=f.indexOf("b");for(let W=0;W<l.length;W+=4){let J=[l[W],l[W+1],l[W+2]];v[W+k]=J[b],v[W+O]=J[S],v[W+j]=J[I]}}}else if(u===tr.GREY){if(f!==tr.GREY32)throw new Error("Unable to transform.");v=new Uint8Array(4*l.length);for(let b=0;b<l.length;b++)v[4*b]=l[b],v[4*b+1]=l[b],v[4*b+2]=l[b],v[4*b+3]=255}else{if(u!==tr.GREY32)throw new Error("Unable to transform.");if(f!==tr.GREY)throw new Error("Unable to transform.");v=new Uint8Array(l.length/4);for(let b=0;b<l.length;b+=4)v[b/4]=l[b]}return li._onLog&&li._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),v}getImageData(l,u,f,g,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!u||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==kl(li,Xf,"f",$f)&&li.checkWebGLSupport(),(null==m?void 0:m.bUseWebGL)&&!kl(li,Xf,"f",$f))throw new Error("Your browser or machine may not support WebGL.");if(g.sx>u||g.sy>f||g.sx+g.sWidth>u||g.sy+g.sHeight>f)throw new Error("Invalid position.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let v;li._onLog&&(v=Date.now(),li._onLog("getImageData(), START: "+v));const _=Math.round(g.sx),b=Math.round(g.sy),S=Math.round(g.sWidth),I=Math.round(g.sHeight),k=Math.round(g.dWidth),O=Math.round(g.dHeight);let j=tr.RGBA;(null==m?void 0:m.pixelFormat)&&(j=m.pixelFormat);let W,J,K,Q=null;if((null==m?void 0:m.bufferContainer)&&(Q=m.bufferContainer),kl(li,Xf,"f",$f)&&(this.useWebGLByDefault&&null==(null==m?void 0:m.bUseWebGL)||(null==m?void 0:m.bUseWebGL))){li._onLog&&li._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),W=this._reusedWebGLCvs;try{if(Q)if(j===tr.GREY){if(K=new Uint8Array(4*k*O),J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:j,bUseWebGL:!0,bufferContainer:K}),K=this.transformPixelFormat(K,J.pixelFormat,j),Q){if(Q.length<K.length)throw new Error("Unexpected size of the 'bufferContainer'.");Q.set(K)}}else J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:j,bUseWebGL:!0,bufferContainer:Q}),K=new Uint8Array(Q.buffer,0,4*k*O),K=this.transformPixelFormat(K,J.pixelFormat,j);else j===tr.GREY?((!kl(this,Uy,"f")||kl(this,Uy,"f").length<4*k*O)&&Ld(this,Uy,new Uint8Array(4*k*O),"f"),K=new Uint8Array(kl(this,Uy,"f").buffer,0,4*k*O)):K=new Uint8Array(4*k*O),J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:j,bUseWebGL:!0,bufferContainer:K}),K=this.transformPixelFormat(K,J.pixelFormat,j)}catch(ie){if("WebGLError"===ie.name&&(this.forceLoseContext(),null==(null==m?void 0:m.bUseWebGL)))return li._onLog&&li._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},Object.assign({},m,{bUseWebGL:!1}));throw ie}}else if(li._onLog&&li._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),W=this._reusedCvs,J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:tr.RGBA,bUseWebGL:!1}),K=this.readCvsData(J.context,{width:k,height:O},null),K=this.transformPixelFormat(K,J.pixelFormat,j),Q){if(Q.length<K.length)throw new Error("Unexpected size of the 'bufferContainer'.");Q.set(K)}return li._onLog&&li._onLog("getImageData() end. Costs: "+(Date.now()-v)),{data:K,pixelFormat:j,width:k,height:O,bUseWebGL:J.bUseWebGL}}convertDataToCvs(l,u,f,g){if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof u||u<=0)throw new Error("Invalid 'width'.");if("number"!=typeof f||f<=0)throw new Error("Invalid 'height'.");const m=document.createElement("canvas");let v;if(m.width=u,m.height=f,g===tr.GREY){v=new Uint8ClampedArray(4*u*f);for(let b=0;b<v.length;b+=4)v[b]=l[b/4],v[b+1]=l[b/4],v[b+2]=l[b/4],v[b+3]=255}else v=new Uint8ClampedArray(l.buffer);const _=new ImageData(v,u,f);return m.getContext("2d").putImageData(_,0,0),m}forceLoseContext(){if(!this._reusedWebGLCvs)return;const l=this._reusedWebGLCvs.ctxWebGL;l&&!l.isContextLost()&&l.getExtension("WEBGL_lose_context")&&l.getExtension("WEBGL_lose_context").loseContext(),Ld(this,Wy,null,"f"),Ld(this,ex,null,"f"),Ld(this,tx,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Ld(this,RI,!0,"f")}}Xf=li,PI=new WeakMap,Wy=new WeakMap,ex=new WeakMap,tx=new WeakMap,Uy=new WeakMap,RI=new WeakMap,$f={value:void 0};class SIe{constructor(){ov.set(this,new Map),kI.set(this,!1)}get disposed(){return ot(this,kI,"f")}on(l,u){l=l.toLowerCase();const f=ot(this,ov,"f").get(l);if(f){if(f.includes(u))return;f.push(u)}else ot(this,ov,"f").set(l,[u])}off(l,u){l=l.toLowerCase();const f=ot(this,ov,"f").get(l);if(!f)return;const g=f.indexOf(u);-1!==g&&f.splice(g,1)}offAll(l){l=l.toLowerCase();const u=ot(this,ov,"f").get(l);u&&(u.length=0)}fire(l,u=[],f={async:!1,copy:!0}){var g=this;return Fe(function*(){u||(u=[]),l=l.toLowerCase();const m=ot(g,ov,"f").get(l);if(m&&m.length){f=Object.assign({async:!1,copy:!0},f);for(let v of m){if(!v)continue;let _=[];if(f.copy)for(let S of u){try{S=JSON.parse(JSON.stringify(S))}catch(I){}_.push(S)}else _=u;let b=!1;if(f.async)setTimeout(()=>{g.disposed||v.apply(f.target,_)},0);else try{b=v.apply(f.target,_)}catch(S){}if(!0===b)break}}})()}dispose(){er(this,kI,!0,"f")}}ov=new WeakMap,kI=new WeakMap;const rc=(p,l,u,f)=>{if(!u)return p;let g=l+Math.round((p-l)/u)*u;return f&&(g=Math.min(g,f)),g};class ti{static get version(){return"2.0.7"}static isStorageAvailable(l){let u;try{u=window[l];const f="__storage_test__";return u.setItem(f,f),u.removeItem(f),!0}catch(f){return f instanceof DOMException&&(22===f.code||1014===f.code||"QuotaExceededError"===f.name||"NS_ERROR_DOM_QUOTA_REACHED"===f.name)&&u&&0!==u.length}}static findBestRearCameraInIOS(l,u){if(!l||!l.length)return null;let f=!1;if((null==u?void 0:u.getMainCamera)&&(f=!0),f){const g=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],m=l.find(v=>g.includes(v.label.toLowerCase()));return null==m?void 0:m.deviceId}{const g=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],m=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],v=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],_=l.filter(I=>{const k=I.label.toLowerCase();return g.some(O=>k.includes(O))});if(!_.length)return null;const b=_.find(I=>{const k=I.label.toLowerCase();return m.some(O=>k.includes(O))});if(b)return b.deviceId;const S=_.find(I=>{const k=I.label.toLowerCase();return v.some(O=>k.includes(O))});return S?S.deviceId:_[0].deviceId}}static findBestRearCamera(l,u){if(!l||!l.length)return null;if(["iPhone","iPad","Mac"].includes(sl.OS))return ti.findBestRearCameraInIOS(l,{getMainCamera:null==u?void 0:u.getMainCameraInIOS});const f=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let g of l){const m=g.label.toLowerCase();if(m&&f.some(v=>m.includes(v))&&/\b0(\b)?/.test(m))return g.deviceId}return["Android","HarmonyOS"].includes(sl.OS)?l[l.length-1].deviceId:null}static findBestCamera(l,u,f){return l&&l.length?"environment"===u?this.findBestRearCamera(l,f):"user"===u?null:u?void 0:null:null}static playVideo(l,u,f){return Fe(function*(){if(!l)throw new Error("Invalid 'videoEl'.");if(!u)throw new Error("Invalid 'source'.");return new Promise(function(){var g=Fe(function*(m,v){let _;const b=()=>{l.removeEventListener("loadstart",O),l.removeEventListener("abort",j),l.removeEventListener("play",W),l.removeEventListener("error",J),l.removeEventListener("loadedmetadata",ie)};let S=!1;const I=()=>{S=!0,_&&clearTimeout(_),b(),m(l)},k=oe=>{_&&clearTimeout(_),b(),v(oe)},O=()=>{l.addEventListener("abort",j,{once:!0})},j=()=>{const oe=new Error("Video playing was interrupted.");oe.name="AbortError",k(oe)},W=()=>{I()},J=()=>{k(new Error(`Video error ${l.error.code}: ${l.error.message}.`))};let K;const Q=new Promise(oe=>{K=oe}),ie=()=>{K()};if(l.addEventListener("loadstart",O,{once:!0}),l.addEventListener("play",W,{once:!0}),l.addEventListener("error",J,{once:!0}),l.addEventListener("loadedmetadata",ie,{once:!0}),"string"==typeof u||u instanceof String?l.src=u:l.srcObject=u,l.autoplay&&(yield new Promise(oe=>{setTimeout(oe,1e3)})),!S){f&&(_=setTimeout(()=>{b(),v(new Error("Failed to play video. Timeout."))},f));try{l.src&&(yield l.load()),yield l.play(),I()}catch(oe){console.warn("1st play error: "+((null==oe?void 0:oe.message)||oe))}if(!S){yield Q;try{yield l.play(),I()}catch(oe){console.warn("2rd play error: "+((null==oe?void 0:oe.message)||oe)),k(oe)}}}});return function(m,v){return g.apply(this,arguments)}}())})()}static testCameraAccess(l){return Fe(function*(){var u,f;if(!(null===(f=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===f?void 0:f.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let g;try{g=l?yield navigator.mediaDevices.getUserMedia(l):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(m){return{ok:!1,errorName:m.name,errorMessage:m.message}}finally{null==g||g.getTracks().forEach(m=>{m.stop()})}return{ok:!0}})()}get state(){if(!ot(this,Bc,"f"))return"closed";if("pending"===ot(this,Bc,"f"))return"opening";if("fulfilled"===ot(this,Bc,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(l){l?ti.isStorageAvailable("localStorage")?er(this,Vy,!0,"f"):(er(this,Vy,!1,"f"),console.warn("Local storage is unavailable")):er(this,Vy,!1,"f")}get ifSaveLastUsedCamera(){return ot(this,Vy,"f")}get isVideoPlaying(){return!(!ot(this,Ei,"f")||ot(this,Ei,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(l){var u,f,g;if(!(l instanceof HTMLElement)&&null!=l)throw new TypeError("Invalid 'element'.");null===(u=ot(this,sv,"f"))||void 0===u||u.removeEventListener("click",ot(this,Gy,"f")),null===(f=ot(this,sv,"f"))||void 0===f||f.removeEventListener("touchend",ot(this,Gy,"f")),null===(g=ot(this,sv,"f"))||void 0===g||g.removeEventListener("touchmove",ot(this,LI,"f")),er(this,sv,l,"f"),l&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(sl.OS)?(l.addEventListener("touchend",ot(this,Gy,"f")),l.addEventListener("touchmove",ot(this,LI,"f"))):l.addEventListener("click",ot(this,Gy,"f")))}get tapFocusEventBoundEl(){return ot(this,sv,"f")}get disposed(){return ot(this,BI,"f")}constructor(l){var f,g,u=this;Mn.add(this),Ei.set(this,null),vr.set(this,void 0),MI.set(this,()=>{"opened"===this.state&&ot(this,js,"f").fire("resumed",null,{target:this,async:!1})}),OI.set(this,()=>{ot(this,js,"f").fire("paused",null,{target:this,async:!1})}),Xr.set(this,void 0),Ou.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],qf.set(this,void 0),Vy.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,FI.set(this,void 0),kh.set(this,!0),Kf.set(this,void 0),Bc.set(this,void 0),jy.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Hy.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(m,v)=>{let _,b;const S=window.getComputedStyle(ot(this,Ei,"f")).objectFit,I=this.getResolution(),k=ot(this,Ei,"f").getBoundingClientRect(),O=k.left,j=k.top,{width:W,height:J}=ot(this,Ei,"f").getBoundingClientRect();if(W<=0||J<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const K=W/J,Q=I.width/I.height;let ie=1;if("contain"===S)Q>K?(ie=W/I.width,_=(m-O)/ie,b=(v-j-(J-W/Q)/2)/ie):(ie=J/I.height,b=(v-j)/ie,_=(m-O-(W-J*Q)/2)/ie);else{if("cover"!==S)throw new Error("Unsupported object-fit.");Q>K?(ie=J/I.height,b=(v-j)/ie,_=(m-O+(J*Q-W)/2)/ie):(ie=W/I.width,_=(m-O)/ie,b=(v-j+(W/Q-J)/2)/ie)}return{x:_,y:b}},nx.set(this,!1),LI.set(this,()=>{er(this,nx,!0,"f")}),Gy.set(this,function(){var m=Fe(function*(v){var _;if(ot(u,nx,"f"))return void er(u,nx,!1,"f");if(!(ot(u,Hy,"f")&&u.isVideoPlaying&&ot(u,vr,"f")&&u._focusSupported))return;if(!u._focusParameters.fds&&(u._focusParameters.fds=null===(_=u.getCameraCapabilities())||void 0===_?void 0:_.focusDistance,!u._focusParameters.fds))return void(u._focusSupported=!1);if(null==u._focusParameters.kTimeout&&(u._focusParameters.kTimeout=(u._focusParameters.maxTimeout-u._focusParameters.minTimeout)/(1/u._focusParameters.fds.min-1/u._focusParameters.fds.max)),1==u._focusParameters.isDoingFocus)return;let b,S;if(u._focusParameters.taskBackToContinous&&(clearTimeout(u._focusParameters.taskBackToContinous),u._focusParameters.taskBackToContinous=null),v instanceof MouseEvent)b=v.clientX,S=v.clientY;else{if(!(v instanceof TouchEvent))throw new Error("Unknown event type.");if(!v.changedTouches.length)return;b=v.changedTouches[0].clientX,S=v.changedTouches[0].clientY}const I=u.getResolution(),k=2*Math.round(Math.min(I.width,I.height)/u._focusParameters.defaultFocusAreaSizeRatio/2);let O;try{O=u.calculateCoordInVideo(b,S)}catch(Q){}if(O.x<0||O.x>I.width||O.y<0||O.y>I.height)return;const j={x:O.x+"px",y:O.y+"px"},W=k+"px",J=W;let K;ti._onLog&&(K=Date.now());try{yield ot(u,Mn,"m",AM).call(u,j,W,J,u._focusParameters.tapFocusMinDistance,u._focusParameters.tapFocusMaxDistance)}catch(Q){if(ti._onLog)throw ti._onLog(Q),Q}ti._onLog&&ti._onLog(`Tap focus costs: ${Date.now()-K} ms`),u._focusParameters.taskBackToContinous=setTimeout(()=>{var Q;ti._onLog&&ti._onLog("Back to continuous focus."),null===(Q=ot(u,vr,"f"))||void 0===Q||Q.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},u._focusParameters.focusBackToContinousTime),ot(u,js,"f").fire("tapfocus",null,{target:u,async:!1})});return function(v){return m.apply(this,arguments)}}()),sv.set(this,null),Jf.set(this,1),Qf.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!ot(this,Ei,"f"))return;const m=ot(this,Jf,"f");if(m<1)throw new RangeError("Invalid scale value.");if(1===m)ot(this,Ei,"f").style.transform="";else{const v=window.getComputedStyle(ot(this,Ei,"f")).objectFit,_=ot(this,Ei,"f").videoWidth,b=ot(this,Ei,"f").videoHeight,{width:S,height:I}=ot(this,Ei,"f").getBoundingClientRect();if(S<=0||I<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const k=S/I,O=_/b;let j=1;"contain"===v?j=k<O?S/(_/m):I/(b/m):"cover"===v&&(j=O>k?I/(_/m):S/(b/m));const W=j*(1-1/m)*(_/2-ot(this,Qf,"f").x),J=j*(1-1/m)*(b/2-ot(this,Qf,"f").y);ot(this,Ei,"f").style.transform=`translate(${W}px, ${J}px) scale(${m})`}},TM.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const m=document.createElement("canvas");let v;if(m.width=this.width,m.height=this.height,this.pixelFormat===tr.GREY){v=new Uint8ClampedArray(this.width*this.height*4);for(let b=0;b<v.length;b+=4)v[b]=this.data[b/4],v[b+1]=this.data[b/4],v[b+2]=this.data[b/4],v[b+3]=255}else v=new Uint8ClampedArray(this.data.buffer);const _=new ImageData(v,this.width,this.height);return m.getContext("2d").putImageData(_,0,0),m}),js.set(this,void 0),IM.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],av.set(this,new Map),Jq.set(this,!1),NI.set(this,Fe(function*(){var m,v;if("visible"===document.visibilityState){if(ti._onLog&&ti._onLog("document visible. video paused: "+(null===(m=ot(u,Ei,"f"))||void 0===m?void 0:m.paused)),"opening"==u.state||"opened"==u.state){let _=!1;if(!u.isVideoPlaying){ti._onLog&&ti._onLog("document visible. Not auto resume. 1st resume start.");try{yield u.resume(),_=!0}catch(b){ti._onLog&&ti._onLog("document visible. 1st resume video failed, try open instead.")}_||(yield ot(u,Mn,"m",zy).call(u))}if(yield new Promise(b=>setTimeout(b,300)),!u.isVideoPlaying){ti._onLog&&ti._onLog("document visible. 1st open failed. 2rd resume start."),_=!1;try{yield u.resume(),_=!0}catch(b){ti._onLog&&ti._onLog("document visible. 2rd resume video failed, try open instead.")}_||(yield ot(u,Mn,"m",zy).call(u))}}}else"hidden"===document.visibilityState&&(ti._onLog&&ti._onLog("document hidden. video paused: "+(null===(v=ot(u,Ei,"f"))||void 0===v?void 0:v.paused)),"opening"==u.state||"opened"==u.state&&u.isVideoPlaying&&u.pause())})),BI.set(this,!1),(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia)||setTimeout(()=>{ti.onWarning&&ti.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),l instanceof HTMLVideoElement&&this.setVideoEl(l),er(this,js,new SIe,"f"),this.imageDataGetter=new li,document.addEventListener("visibilitychange",ot(this,NI,"f"))}setVideoEl(l){if(!(l&&l instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");l.addEventListener("play",ot(this,MI,"f")),l.addEventListener("pause",ot(this,OI,"f")),er(this,Ei,l,"f")}getVideoEl(){return ot(this,Ei,"f")}releaseVideoEl(){var l,u;null===(l=ot(this,Ei,"f"))||void 0===l||l.removeEventListener("play",ot(this,MI,"f")),null===(u=ot(this,Ei,"f"))||void 0===u||u.removeEventListener("pause",ot(this,OI,"f")),er(this,Ei,null,"f")}isVideoLoaded(){return!!ot(this,Ei,"f")&&4==ot(this,Ei,"f").readyState}open(){var l=this;return Fe(function*(){if(ot(l,Kf,"f")&&!ot(l,kh,"f")){if("pending"===ot(l,Bc,"f"))return ot(l,Kf,"f");if("fulfilled"===ot(l,Bc,"f"))return}ot(l,js,"f").fire("before:open",null,{target:l}),yield ot(l,Mn,"m",zy).call(l),ot(l,js,"f").fire("played",null,{target:l,async:!1}),ot(l,js,"f").fire("opened",null,{target:l,async:!1})})()}close(){var l=this;return Fe(function*(){if("closed"===l.state)return;ot(l,js,"f").fire("before:close",null,{target:l});const u=ot(l,Kf,"f");if(ot(l,Mn,"m",WI).call(l),u&&"pending"===ot(l,Bc,"f")){try{yield u}catch(f){}if(!1===ot(l,kh,"f")){const f=new Error("'close()' was interrupted.");throw f.name="AbortError",f}}er(l,Kf,null,"f"),er(l,Bc,null,"f"),ot(l,js,"f").fire("closed",null,{target:l,async:!1})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");ot(this,Ei,"f").pause()}resume(){var l=this;return Fe(function*(){if(!l.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==l.state)throw new Error("Camera or video is not open.");yield ot(l,Ei,"f").play()})()}setCamera(l){var u=this;return Fe(function*(){if("string"!=typeof l)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof ot(u,Xr,"f").video&&(ot(u,Xr,"f").video={}),delete ot(u,Xr,"f").video.facingMode,ot(u,Xr,"f").video.deviceId={exact:l},!("closed"===u.state||u.videoSrc||"opening"===u.state&&ot(u,kh,"f"))){ot(u,js,"f").fire("before:camera:change",[],{target:u,async:!1}),yield ot(u,Mn,"m",ix).call(u);try{u.resetSoftwareScale()}catch(f){}return ot(u,Ou,"f")}})()}switchToFrontCamera(l){var u=this;return Fe(function*(){if("object"!=typeof ot(u,Xr,"f").video&&(ot(u,Xr,"f").video={}),(null==l?void 0:l.resolution)&&(ot(u,Xr,"f").video.width={ideal:l.resolution.width},ot(u,Xr,"f").video.height={ideal:l.resolution.height}),delete ot(u,Xr,"f").video.deviceId,ot(u,Xr,"f").video.facingMode={exact:"user"},er(u,qf,null,"f"),!("closed"===u.state||u.videoSrc||"opening"===u.state&&ot(u,kh,"f"))){ot(u,js,"f").fire("before:camera:change",[],{target:u,async:!1}),ot(u,Mn,"m",ix).call(u);try{u.resetSoftwareScale()}catch(f){}return ot(u,Ou,"f")}})()}getCamera(){var l;if(ot(this,Ou,"f"))return ot(this,Ou,"f");{let u=(null===(l=ot(this,Xr,"f").video)||void 0===l?void 0:l.deviceId)||"";if(u){u=u.exact||u.ideal||u;for(let f of this._arrCameras)if(f.deviceId===u)return JSON.parse(JSON.stringify(f))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(l){var u=this;return Fe(function*(){var f,g;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;if(l){let b=yield navigator.mediaDevices.getUserMedia({video:!0});m=(yield navigator.mediaDevices.enumerateDevices()).filter(S=>"videoinput"===S.kind),b.getTracks().forEach(S=>{S.stop()})}else m=(yield navigator.mediaDevices.enumerateDevices()).filter(b=>"videoinput"===b.kind);const v=[],_=[];if(u._arrCameras)for(let b of u._arrCameras)b._checked&&_.push(b);for(let b=0;b<m.length;b++){let S,I=m[b];for(let k of _)if(I.deviceId==k.deviceId){S=k;break}S||(S={deviceId:I.deviceId,label:I.label?I.label:"camera "+b,_checked:!1}),S.deviceId&&v.push(S)}return u._arrCameras=v,ti._onLog&&ti._onLog(JSON.stringify(u._arrCameras)),v})()}getCameras(){var l=this;return Fe(function*(){var u,f;if(!(null===(f=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===f?void 0:f.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const g=(yield navigator.mediaDevices.enumerateDevices()).filter(m=>"videoinput"===m.kind);return l._getCameras(!(!g||!g.length||g[0].deviceId))})()}getAllCameras(){var l=this;return Fe(function*(){return l.getCameras()})()}setResolution(l,u,f){var g=this;return Fe(function*(){if("number"!=typeof l||l<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof u||u<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof ot(g,Xr,"f").video&&(ot(g,Xr,"f").video={}),f?(ot(g,Xr,"f").video.width={exact:l},ot(g,Xr,"f").video.height={exact:u}):(ot(g,Xr,"f").video.width={ideal:l},ot(g,Xr,"f").video.height={ideal:u}),"closed"===g.state||g.videoSrc||"opening"===g.state&&ot(g,kh,"f"))return null;ot(g,js,"f").fire("before:resolution:change",[],{target:g,async:!1}),yield ot(g,Mn,"m",ix).call(g);try{g.resetSoftwareScale()}catch(v){}const m=g.getResolution();return{width:m.width,height:m.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&ot(this,Ei,"f"))return{width:ot(this,Ei,"f").videoWidth,height:ot(this,Ei,"f").videoHeight};if(ot(this,vr,"f")){const l=ot(this,vr,"f").getSettings();return{width:l.width,height:l.height}}if(this.isVideoLoaded())return{width:ot(this,Ei,"f").videoWidth,height:ot(this,Ei,"f").videoHeight};{const l={width:0,height:0};let u=ot(this,Xr,"f").video.width||0,f=ot(this,Xr,"f").video.height||0;return u&&(l.width=u.exact||u.ideal||u),f&&(l.height=f.exact||f.ideal||f),l}}getResolutions(l){var u=this;return Fe(function*(){var f,g,m,v,_,b,S,I,k,O,j;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let W="";const J=(K,Q)=>{const ie=ot(u,av,"f").get(K);if(!ie||!ie.length)return!1;for(let oe of ie)if(oe.width===Q.width&&oe.height===Q.height)return!0;return!1};if(u._mediaStream){W=null===(j=ot(u,Ou,"f"))||void 0===j?void 0:j.deviceId;let K=ot(u,av,"f").get(W);if(K&&!l)return JSON.parse(JSON.stringify(K));K=[],ot(u,av,"f").set(W,K),er(u,jy,!0,"f");try{for(let Q of u.detectedResolutions){yield ot(u,vr,"f").applyConstraints({width:{ideal:Q.width},height:{ideal:Q.height}}),ot(u,Mn,"m",Nd).call(u);const ie=ot(u,vr,"f").getSettings(),oe={width:ie.width,height:ie.height};J(W,oe)||K.push({width:oe.width,height:oe.height})}}catch(Q){throw ot(u,Mn,"m",WI).call(u),er(u,jy,!1,"f"),Q}try{yield ot(u,Mn,"m",zy).call(u)}catch(Q){if("AbortError"===Q.name)return K;throw Q}finally{er(u,jy,!1,"f")}return K}{const K=function(){var oe=Fe(function*(le,he,_e){const Ve={video:{deviceId:{exact:le},width:{ideal:he},height:{ideal:_e}}};let ee=null;try{ee=yield navigator.mediaDevices.getUserMedia(Ve)}catch(Le){return null}if(!ee)return null;const ke=ee.getVideoTracks();let xe=null;try{const Le=ke[0].getSettings();xe={width:Le.width,height:Le.height}}catch(Le){const V=document.createElement("video");V.srcObject=ee,xe={width:V.videoWidth,height:V.videoHeight},V.srcObject=null}return ke.forEach(Le=>{Le.stop()}),xe});return function(he,_e,Ve){return oe.apply(this,arguments)}}();let Q=(null===(_=null===(v=null===(m=ot(u,Xr,"f"))||void 0===m?void 0:m.video)||void 0===v?void 0:v.deviceId)||void 0===_?void 0:_.exact)||(null===(I=null===(S=null===(b=ot(u,Xr,"f"))||void 0===b?void 0:b.video)||void 0===S?void 0:S.deviceId)||void 0===I?void 0:I.ideal)||(null===(O=null===(k=ot(u,Xr,"f"))||void 0===k?void 0:k.video)||void 0===O?void 0:O.deviceId);if(!Q)return[];let ie=ot(u,av,"f").get(Q);if(ie&&!l)return JSON.parse(JSON.stringify(ie));ie=[],ot(u,av,"f").set(Q,ie);for(let oe of u.detectedResolutions){const le=yield K(Q,oe.width,oe.height);le&&!J(Q,le)&&ie.push({width:le.width,height:le.height})}return ie}})()}setMediaStreamConstraints(l,u){var f=this;return Fe(function*(){if(null===(g=l)||"[object Object]"!==Object.prototype.toString.call(g))throw new TypeError("Invalid 'mediaStreamConstraints'.");var g;er(f,Xr,JSON.parse(JSON.stringify(l)),"f"),er(f,qf,null,"f"),u&&ot(f,Mn,"m",ix).call(f)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(ot(this,Xr,"f")))}resetMediaStreamConstraints(){er(this,Xr,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!ot(this,vr,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return ot(this,vr,"f").getCapabilities?ot(this,vr,"f").getCapabilities():{}}getCameraSettings(){if(!ot(this,vr,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return ot(this,vr,"f").getSettings()}turnOnTorch(){var l=this;return Fe(function*(){if(!ot(l,vr,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield ot(l,vr,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var l=this;return Fe(function*(){if(!ot(l,vr,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield ot(l,vr,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(l,u){var f=this;return Fe(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!ot(f,vr,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.colorTemperature;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=rc(l,m.min,m.step,m.max)),yield ot(f,vr,"f").applyConstraints({advanced:[{colorTemperature:l,whiteBalanceMode:"manual"}]}),l})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(l,u){var f=this;return Fe(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!ot(f,vr,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.exposureCompensation;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=rc(l,m.min,m.step,m.max)),yield ot(f,vr,"f").applyConstraints({advanced:[{exposureCompensation:l}]}),l})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(l,u){var f=this;return Fe(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!ot(f,vr,"f")||"opened"!==f.state)throw new Error("Camera is not open.");let m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.frameRate;if(!m)throw Error("Not supported.");u&&(l<m.min?l=m.min:l>m.max&&(l=m.max));const v=f.getResolution();return yield ot(f,vr,"f").applyConstraints({width:{ideal:Math.max(v.width,v.height)},frameRate:l}),l})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(l,u){var f=this;return Fe(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if(!ot(f,vr,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const g=f.getCameraCapabilities(),m=null==g?void 0:g.focusMode,v=null==g?void 0:g.focusDistance;if(!m)throw Error("Not supported.");if("string"!=typeof l.mode)throw TypeError("Invalid 'mode'.");const _=l.mode.toLowerCase();if(!m.includes(_))throw Error("Unsupported focus mode.");if("manual"===_){if(!v)throw Error("Manual focus unsupported.");if(l.hasOwnProperty("distance")){let b=l.distance;u&&(b<v.min?b=v.min:b>v.max&&(b=v.max),b=rc(b,v.min,v.step,v.max)),f._focusParameters.focusArea=null,yield ot(f,vr,"f").applyConstraints({advanced:[{focusMode:_,focusDistance:b}]})}else{if(!l.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const b=l.area.centerPoint;let S=l.area.width,I=l.area.height;if(!S||!I){const k=f.getResolution();S||(S=2*Math.round(Math.min(k.width,k.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),I||(I=2*Math.round(Math.min(k.width,k.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}f._focusParameters.focusArea={centerPoint:{x:b.x,y:b.y},width:S,height:I},yield ot(f,Mn,"m",AM).call(f,b,S,I)}}}else f._focusParameters.focusArea=null,yield ot(f,vr,"f").applyConstraints({advanced:[{focusMode:_}]})})()}getFocus(){const l=this.getCameraSettings(),u=l.focusMode;return u?"manual"===u?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:l.focusDistance}:{mode:u}:null}enableTapToFocus(){var l=this;return Fe(function*(){er(l,Hy,!0,"f")})()}disableTapToFocus(){er(this,Hy,!1,"f")}isTapToFocusEnabled(){return ot(this,Hy,"f")}setZoom(l){var u=this;return Fe(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if("number"!=typeof l.factor)throw new TypeError("Illegal type of 'factor'.");if(l.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==u.state)throw new Error("Video is not playing.");l.centerPoint?ot(u,Mn,"m",PM).call(u,l.centerPoint):u.resetScaleCenter();try{if(ot(u,Mn,"m",Zq).call(u,ot(u,Qf,"f"))){const f=yield u.setHardwareScale(l.factor,!0);let g=u.getHardwareScale();1==g&&1!=f&&(g=f),u.setSoftwareScale(l.factor>g?l.factor/g:1)}else yield u.setHardwareScale(1),u.setSoftwareScale(l.factor)}catch(f){const g=f.message||f;if("Not supported."!==g&&"Camera is not open."!==g)throw f;u.setSoftwareScale(l.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let l=1;try{l=this.getHardwareScale()}catch(u){if("Camera is not open."!==(u.message||u))throw u}return{factor:l*ot(this,Jf,"f")}}resetZoom(){var l=this;return Fe(function*(){yield l.setZoom({factor:1})})()}setHardwareScale(l,u){var f=this;return Fe(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if(!ot(f,vr,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.zoom;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=rc(l,m.min,m.step,m.max)),yield ot(f,vr,"f").applyConstraints({advanced:[{zoom:l}]}),l})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(l,u){if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");u&&ot(this,Mn,"m",PM).call(this,u),er(this,Jf,l,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return ot(this,Jf,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();er(this,Qf,{x:l.width/2,y:l.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(l){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||ot(this,jy,"f"))return null;const u=Date.now();ti._onLog&&ti._onLog("getFrameData() START: "+u);const f=ot(this,Ei,"f").videoWidth,g=ot(this,Ei,"f").videoHeight;let m={sx:0,sy:0,sWidth:f,sHeight:g,dWidth:f,dHeight:g};(null==l?void 0:l.position)&&(m=JSON.parse(JSON.stringify(l.position)));let v=tr.RGBA;(null==l?void 0:l.pixelFormat)&&(v=l.pixelFormat);let _=ot(this,Jf,"f");(null==l?void 0:l.scale)&&(_=l.scale);let b=ot(this,Qf,"f");if(null==l?void 0:l.scaleCenter){if("string"!=typeof l.scaleCenter.x||"string"!=typeof l.scaleCenter.y)throw new Error("Invalid scale center.");let O=0,j=0;if(l.scaleCenter.x.endsWith("px"))O=parseFloat(l.scaleCenter.x);else{if(!l.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");O=parseFloat(l.scaleCenter.x)/100*f}if(l.scaleCenter.y.endsWith("px"))j=parseFloat(l.scaleCenter.y);else{if(!l.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");j=parseFloat(l.scaleCenter.y)/100*g}if(isNaN(O)||isNaN(j))throw new Error("Invalid scale center.");b.x=Math.round(O),b.y=Math.round(j)}let S=null;if((null==l?void 0:l.bufferContainer)&&(S=l.bufferContainer),0==f||0==g)return null;1!==_&&(m.sWidth=Math.round(m.sWidth/_),m.sHeight=Math.round(m.sHeight/_),m.sx=Math.round((1-1/_)*b.x+m.sx/_),m.sy=Math.round((1-1/_)*b.y+m.sy/_));const I=this.imageDataGetter.getImageData(ot(this,Ei,"f"),f,g,m,{pixelFormat:v,bufferContainer:S});if(!I)return null;const k=Date.now();return ti._onLog&&ti._onLog("getFrameData() END: "+k),{data:I.data,width:I.width,height:I.height,pixelFormat:I.pixelFormat,timeSpent:k-u,timeStamp:k,toCanvas:ot(this,TM,"f")}}on(l,u){if(!ot(this,IM,"f").includes(l.toLowerCase()))throw new Error(`Event '${l}' does not exist.`);ot(this,js,"f").on(l,u)}off(l,u){ot(this,js,"f").off(l,u)}dispose(){var l=this;return Fe(function*(){l.tapFocusEventBoundEl=null,yield l.close(),l.releaseVideoEl(),ot(l,js,"f").dispose(),l.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",ot(l,NI,"f")),er(l,BI,!0,"f")})()}}var rx,UI,Xy,lv,VI,$y,eK,tK,nr,RM,kM,kn,Wn,ox,Zf,cv,jI,HI,GI,sx,uv,zI,ep,Uc,Mo,Ln,Mh,MM,$r,nK,iK,OM,FM;Ei=new WeakMap,vr=new WeakMap,MI=new WeakMap,OI=new WeakMap,Xr=new WeakMap,Ou=new WeakMap,qf=new WeakMap,Vy=new WeakMap,FI=new WeakMap,kh=new WeakMap,Kf=new WeakMap,Bc=new WeakMap,jy=new WeakMap,Hy=new WeakMap,nx=new WeakMap,LI=new WeakMap,Gy=new WeakMap,sv=new WeakMap,Jf=new WeakMap,Qf=new WeakMap,TM=new WeakMap,js=new WeakMap,IM=new WeakMap,av=new WeakMap,Jq=new WeakMap,NI=new WeakMap,BI=new WeakMap,Mn=new WeakSet,Qq=function(){var p=Fe(function*(){var l=this;const u=this.getMediaStreamConstraints();if("boolean"==typeof u.video&&(u.video={}),!u.video.deviceId)if(ot(this,qf,"f"))delete u.video.facingMode,u.video.deviceId={exact:ot(this,qf,"f")};else if(this.ifSaveLastUsedCamera&&ti.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete u.video.facingMode,u.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const f=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),g=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));f&&g&&(u.video.width=f,u.video.height=g)}else if(!this.ifSkipCameraInspection){const f=function(){var v=Fe(function*(_){let b=null;return"environment"===_&&["Android","HarmonyOS","iPhone","iPad"].includes(sl.OS)?(yield l._getCameras(!1),ot(l,Mn,"m",Nd).call(l),b=ti.findBestCamera(l._arrCameras,"environment",{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})):_||["Android","HarmonyOS","iPhone","iPad"].includes(sl.OS)||(yield l._getCameras(!1),ot(l,Mn,"m",Nd).call(l),b=ti.findBestCamera(l._arrCameras,null,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})),b});return function(b){return v.apply(this,arguments)}}();let g=u.video.facingMode;g instanceof Array&&g.length&&(g=g[0]),"object"==typeof g&&(g=g.exact||g.ideal);const m=yield f(g);m&&(delete u.video.facingMode,u.video.deviceId={exact:m})}return u});return function(){return p.apply(this,arguments)}}(),Nd=function(){if(ot(this,kh,"f")){const p=new Error("The operation was interrupted.");throw p.name="AbortError",p}},EM=function(){var p=Fe(function*(l){var f,g,u=this;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;try{ti._onLog&&ti._onLog("======try getUserMedia========");let v=[0,500,1e3,2e3],_=null;const b=function(){var S=Fe(function*(I){for(let k of v){k&&(yield new Promise(O=>setTimeout(O,k)),ot(u,Mn,"m",Nd).call(u));try{ti._onLog&&ti._onLog("ask "+JSON.stringify(I)),m=yield navigator.mediaDevices.getUserMedia(I),ot(u,Mn,"m",Nd).call(u);break}catch(O){if("NotFoundError"===O.name||"NotAllowedError"===O.name||"AbortError"===O.name||"OverconstrainedError"===O.name)throw O;_=O,ti._onLog&&ti._onLog(O.message||O)}}});return function(k){return S.apply(this,arguments)}}();if(yield b(l),m||"object"!=typeof l.video||(l.video.deviceId&&(delete l.video.deviceId,yield b(l)),!m&&l.video.facingMode&&(delete l.video.facingMode,yield b(l)),m||!l.video.width&&!l.video.height||(delete l.video.width,delete l.video.height,yield b(l))),!m)throw _;return m}catch(v){throw null==m||m.getTracks().forEach(_=>{_.stop()}),"NotFoundError"===v.name&&(DOMException?v=new DOMException("No camera available, please use a device with an accessible camera.",v.name):(v=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),v}});return function(u){return p.apply(this,arguments)}}(),DM=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(p=>{p.stop()}),this._mediaStream=null),er(this,vr,null,"f")},zy=function(){var p=Fe(function*(){var l=this;er(this,kh,!1,"f");const u=er(this,FI,Symbol(),"f");if(ot(this,Kf,"f")&&"pending"===ot(this,Bc,"f")){try{yield ot(this,Kf,"f")}catch(g){}ot(this,Mn,"m",Nd).call(this)}return u!==ot(this,FI,"f")?void 0:er(this,Kf,Fe(function*(){er(l,Bc,"pending","f");try{if(l.videoSrc){if(!ot(l,Ei,"f"))throw new Error("'videoEl' should be set.");yield ti.playVideo(ot(l,Ei,"f"),l.videoSrc,l.cameraOpenTimeout),ot(l,Mn,"m",Nd).call(l)}else{let g=yield ot(l,Mn,"m",Qq).call(l);ot(l,Mn,"m",DM).call(l);let m=yield ot(l,Mn,"m",EM).call(l,g);yield l._getCameras(!1),ot(l,Mn,"m",Nd).call(l);const v=()=>{const I=m.getVideoTracks();let k,O;if(I.length&&(k=I[0]),k){const j=k.getSettings();if(j)for(let W of l._arrCameras)if(j.deviceId===W.deviceId){W._checked=!0,W.label=k.label,O=W;break}}return O},_=ot(l,Xr,"f");if("object"==typeof _.video){let I=_.video.facingMode;if(I instanceof Array&&I.length&&(I=I[0]),"object"==typeof I&&(I=I.exact||I.ideal),!(ot(l,qf,"f")||l.ifSaveLastUsedCamera&&ti.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||l.ifSkipCameraInspection||_.video.deviceId)){const k=v(),O=ti.findBestCamera(l._arrCameras,I,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault});O&&O!=(null==k?void 0:k.deviceId)&&(m.getTracks().forEach(j=>{j.stop()}),g.video.deviceId={exact:O},m=yield ot(l,Mn,"m",EM).call(l,g),ot(l,Mn,"m",Nd).call(l))}}const b=v();(null==b?void 0:b.deviceId)&&(er(l,qf,b&&b.deviceId,"f"),l.ifSaveLastUsedCamera&&ti.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",ot(l,qf,"f")),"object"==typeof g.video&&g.video.width&&g.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(g.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(g.video.height))))),ot(l,Ei,"f")&&(yield ti.playVideo(ot(l,Ei,"f"),m,l.cameraOpenTimeout),ot(l,Mn,"m",Nd).call(l)),l._mediaStream=m;const S=m.getVideoTracks();(null==S?void 0:S.length)&&er(l,vr,S[0],"f"),er(l,Ou,b,"f")}}catch(g){throw ot(l,Mn,"m",WI).call(l),er(l,Bc,null,"f"),g}er(l,Bc,"fulfilled","f")})(),"f")});return function(){return p.apply(this,arguments)}}(),ix=function(){var p=Fe(function*(){var l;if("closed"===this.state||this.videoSrc)return;const u=null===(l=ot(this,Ou,"f"))||void 0===l?void 0:l.deviceId,f=this.getResolution();yield ot(this,Mn,"m",zy).call(this);const g=this.getResolution();u&&u!==ot(this,Ou,"f").deviceId&&ot(this,js,"f").fire("camera:changed",[ot(this,Ou,"f").deviceId,u],{target:this,async:!1}),f.width==g.width&&f.height==g.height||ot(this,js,"f").fire("resolution:changed",[{width:g.width,height:g.height},{width:f.width,height:f.height}],{target:this,async:!1}),ot(this,js,"f").fire("played",null,{target:this,async:!1})});return function(){return p.apply(this,arguments)}}(),WI=function(){ot(this,Mn,"m",DM).call(this),er(this,Ou,null,"f"),ot(this,Ei,"f")&&(ot(this,Ei,"f").srcObject=null,this.videoSrc&&(ot(this,Ei,"f").pause(),ot(this,Ei,"f").currentTime=0)),er(this,kh,!0,"f");try{this.resetSoftwareScale()}catch(p){}},Wc=function(){var p=Fe(function*(u,f){const g=K=>{if(!ot(this,vr,"f")||!this.isVideoPlaying||K.focusTaskId!=this._focusParameters.curFocusTaskId){ot(this,vr,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const Q=new Error(`Focus task ${K.focusTaskId} canceled.`);throw Q.name="DeprecatedTaskError",Q}1===this._focusParameters.isDoingFocus&&Date.now()-K.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let m;f=rc(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield ot(this,vr,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}),g(u),m=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/f),Math.abs(1/this._focusParameters.fds.max-1/f))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/f)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=f,yield new Promise(K=>{setTimeout(K,m)}),g(u);let v=u.focusL-u.focusW/2,_=u.focusT-u.focusH/2,b=u.focusW,S=u.focusH;const I=this.getResolution();if(v>=I.width||_>=I.height)throw new Error("Invalid area.");v+b>I.width&&(b=I.width-v),_+S>I.height&&(S=I.height-_),v=Math.round(v),_=Math.round(_),b=Math.round(b),S=Math.round(S);const k=4*I.width*I.height*this._focusParameters.defaultTempBufferContainerLenRatio,O=4*b*S;let j=this._focusParameters.tempBufferContainer;if(j){const K=j.length;k>K&&k>=O?j=new Uint8Array(k):O>K&&O>=k&&(j=new Uint8Array(O))}else j=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(k,O));if(!this.imageDataGetter.getImageData(ot(this,Ei,"f"),I.width,I.height,{sx:v,sy:_,sWidth:b,sHeight:S,dWidth:b,dHeight:S},{pixelFormat:tr.RGBA,bufferContainer:j}))return ot(this,Mn,"m",l).call(this,u,f);const W=j;let J=0;for(let K=0,Q=O-8;K<Q;++K){let ie=W[K]-W[K+8];++K;let oe=W[K]-W[K+8];++K;let le=W[K]-W[K+8];++K,J+=ie*ie+oe*oe+le*le}return-J});function l(u,f){return p.apply(this,arguments)}return l}(),Yy=function(){var p=Fe(function*(u,f,g,m,v,_,b){let S;if(f=rc(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),m=rc(m,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),_?_=rc(_,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(_=rc(Math.sqrt((f||this._focusParameters.fds.step)*(m||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),b=yield ot(this,Mn,"m",Wc).call(this,u,_)),b<=g&&b<=v?S=3:g<v&&g<b?S=1:v<g&&v<b&&(S=2),(m-f)/2<=this._focusParameters.fds.step)return 3===S||(1===S?yield ot(this,vr,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}):2===S&&(yield ot(this,vr,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:m}]}))),!0;if(1===S)return yield ot(this,Mn,"m",l).call(this,u,f,g,_,b);if(2===S)return yield ot(this,Mn,"m",l).call(this,u,_,b,m,v);if(3!==S)return g=yield ot(this,Mn,"m",Wc).call(this,u,f),v=yield ot(this,Mn,"m",Wc).call(this,u,m),yield ot(this,Mn,"m",l).call(this,u,f,g,m,v);let I=rc(Math.sqrt((f||this._focusParameters.fds.step)*(_||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),k=rc(Math.sqrt((m||this._focusParameters.fds.step)*(_||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/I)<=Math.abs(1/this._focusParameters.oldDistance-1/k)){let O=yield ot(this,Mn,"m",Wc).call(this,u,I);if(O<b)return yield ot(this,Mn,"m",l).call(this,u,f,g,_,b,I,O);if(O==b)return yield ot(this,Mn,"m",l).call(this,u,I,O,_,b);let j=yield ot(this,Mn,"m",Wc).call(this,u,k);if(O>b&&b<j)return yield ot(this,Mn,"m",l).call(this,u,I,O,k,j,_,b);if(b==j)return yield ot(this,Mn,"m",l).call(this,u,_,b,k,j);if(b>j)return yield ot(this,Mn,"m",l).call(this,u,_,b,m,v,k,j)}else{let O=yield ot(this,Mn,"m",Wc).call(this,u,k);if(b>O)return yield ot(this,Mn,"m",l).call(this,u,_,b,m,v,k,O);if(b==O)return yield ot(this,Mn,"m",l).call(this,u,_,b,k,O);let j=yield ot(this,Mn,"m",Wc).call(this,u,I);if(j>b&&b<O)return yield ot(this,Mn,"m",l).call(this,u,I,j,k,O,_,b);if(j==b)return yield ot(this,Mn,"m",l).call(this,u,I,j,_,b);if(j<b)return yield ot(this,Mn,"m",l).call(this,u,f,g,_,b,I,j)}return!1});function l(u,f,g,m,v,_,b){return p.apply(this,arguments)}return l}(),AM=function(){var p=Fe(function*(l,u,f,g,m){var _,v=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!l||"string"!=typeof l.x||"string"!=typeof l.y)throw new Error("Invalid 'centerPoint'.");if(!u||"string"!=typeof u)throw new Error("Invalid 'width'.");if(!f||"string"!=typeof f)throw new Error("Invalid 'height'.");const b=this.getResolution();let S=0,I=0;if(l.x.endsWith("px"))S=parseFloat(l.x);else{if(!l.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");S=parseFloat(l.x)/100*b.width}if(l.y.endsWith("px"))I=parseFloat(l.y);else{if(!l.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");I=parseFloat(l.y)/100*b.height}if(isNaN(S)||isNaN(I)||S<0||S>b.width||I<0||I>b.height)throw new Error("Invalid 'centerPoint'.");let k=0;if(u.endsWith("px"))k=parseFloat(u);else{if(!u.endsWith("%"))throw new Error("Invalid 'width'.");k=parseFloat(u)/100*b.width}if(isNaN(k)||k<0)throw new Error("Invalid 'width'.");let O=0;if(f.endsWith("px"))O=parseFloat(f);else{if(!f.endsWith("%"))throw new Error("Invalid 'height'.");O=parseFloat(f)/100*b.height}if(isNaN(O)||O<0)throw new Error("Invalid 'height'.");if(1!==ot(this,Jf,"f")){const J=ot(this,Jf,"f"),K=ot(this,Qf,"f");k/=J,O/=J,S=(1-1/J)*K.x+S/J,I=(1-1/J)*K.y+I/J}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(_=this.getCameraCapabilities())||void 0===_?void 0:_.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const j={focusL:S,focusT:I,focusW:k,focusH:O,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},W=function(){var J=Fe(function*(K,Q,ie){try{(null==Q||Q<v._focusParameters.fds.min)&&(Q=v._focusParameters.fds.min),(null==ie||ie>v._focusParameters.fds.max)&&(ie=v._focusParameters.fds.max),v._focusParameters.oldDistance=null;let oe=rc(Math.sqrt(ie*(Q||v._focusParameters.fds.step)),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),le=rc(Math.sqrt((Q||v._focusParameters.fds.step)*oe),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),he=rc(Math.sqrt(oe*ie),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),_e=yield ot(v,Mn,"m",Wc).call(v,K,he),Ve=yield ot(v,Mn,"m",Wc).call(v,K,le),ee=yield ot(v,Mn,"m",Wc).call(v,K,oe);if(Ve>ee&&ee<_e){const ke=yield ot(v,Mn,"m",Yy).call(v,K,le,Ve,he,_e,oe,ee);return v._focusParameters.isDoingFocus=0,ke}if(Ve<ee&&Ve<_e){let ke=yield ot(v,Mn,"m",Wc).call(v,K,Q);const xe=yield ot(v,Mn,"m",Yy).call(v,K,Q,ke,oe,ee,le,Ve);return v._focusParameters.isDoingFocus=0,xe}if(ee>_e&&Ve>_e){let ke=yield ot(v,Mn,"m",Wc).call(v,K,ie);const xe=yield ot(v,Mn,"m",Yy).call(v,K,oe,ee,ie,ke,he,_e);return v._focusParameters.isDoingFocus=0,xe}if(Ve==ee&&ee<_e){const ke=yield ot(v,Mn,"m",Yy).call(v,K,le,Ve,oe,ee);return v._focusParameters.isDoingFocus=0,ke}if(ee==_e&&Ve>ee){const ke=yield ot(v,Mn,"m",Yy).call(v,K,oe,ee,he,_e);return v._focusParameters.isDoingFocus=0,ke}return W(K,Q,ie)}catch(oe){if("DeprecatedTaskError"!==oe.name)throw oe}});return function(Q,ie,oe){return J.apply(this,arguments)}}();return W(j,g,m)});return function(u,f,g,m,v){return p.apply(this,arguments)}}(),PM=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");if(!p||"string"!=typeof p.x||"string"!=typeof p.y)throw new Error("Invalid 'center'.");const l=this.getResolution();let u=0,f=0;if(p.x.endsWith("px"))u=parseFloat(p.x);else{if(!p.x.endsWith("%"))throw new Error("Invalid scale center.");u=parseFloat(p.x)/100*l.width}if(p.y.endsWith("px"))f=parseFloat(p.y);else{if(!p.y.endsWith("%"))throw new Error("Invalid scale center.");f=parseFloat(p.y)/100*l.height}if(isNaN(u)||isNaN(f))throw new Error("Invalid scale center.");er(this,Qf,{x:u,y:f},"f")},Zq=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();return p&&p.x==l.width/2&&p.y==l.height/2},ti.browserInfo=sl,ti.onWarning=null===(SM=null==window?void 0:window.console)||void 0===SM?void 0:SM.warn;class tp{constructor(l){rx.add(this),UI.set(this,void 0),Xy.set(this,0),lv.set(this,void 0),VI.set(this,0),$y.set(this,!1),Pn(this,UI,l,"f")}startCharging(){Me(this,$y,"f")||(tp._onLog&&tp._onLog("start charging."),Me(this,rx,"m",tK).call(this),Pn(this,$y,!0,"f"))}stopCharging(){Me(this,lv,"f")&&clearTimeout(Me(this,lv,"f")),Me(this,$y,"f")&&(tp._onLog&&tp._onLog("stop charging."),Pn(this,Xy,Date.now()-Me(this,VI,"f"),"f"),Pn(this,$y,!1,"f"))}}UI=new WeakMap,Xy=new WeakMap,lv=new WeakMap,VI=new WeakMap,$y=new WeakMap,rx=new WeakSet,eK=function(){Yr.cfd(1),tp._onLog&&tp._onLog("charge 1.")},tK=function p(){0==Me(this,Xy,"f")&&Me(this,rx,"m",eK).call(this),Pn(this,VI,Date.now(),"f"),Me(this,lv,"f")&&clearTimeout(Me(this,lv,"f")),Pn(this,lv,setTimeout(()=>{Pn(this,Xy,0,"f"),Me(this,rx,"m",p).call(this)},Me(this,UI,"f")-Me(this,Xy,"f")),"f")};const rK=new Map([[Hn.IPF_GRAYSCALED,tr.GREY],[Hn.IPF_ABGR_8888,tr.RGBA],[Hn.IPF_ARGB_8888,tr.BGRA]]),oK=new Map([[tr.GREY,Hn.IPF_GRAYSCALED],[tr.RGBA,Hn.IPF_ABGR_8888],[tr.BGRA,Hn.IPF_ARGB_8888]]),LM="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class Ci extends Ru{static set _onLog(l){Pn(Ci,RM,l,"f",kM),ti._onLog=l,tp._onLog=l}static get _onLog(){return Me(Ci,RM,"f",kM)}static detectEnvironment(){return Fe(function*(){return yield Fe(function*(){return{wasm:hIe,worker:fIe,getUserMedia:Mq,camera:yield pIe(),browser:Ra.browser,version:Ra.version,OS:Ra.OS}})()})()}static testCameraAccess(){return Fe(function*(){const l=yield ti.testCameraAccess();return l.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===l.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===l.errorName||"NotFoundError"===l.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===l.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===l.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===l.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===l.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:l.errorMessage}})()}static createInstance(l){return Fe(function*(){var u,f;if(l&&!(l instanceof Yo))throw new TypeError("Invalid view.");if(null===(u=no.license)||void 0===u?void 0:u.LicenseManager){if(!(null===(f=no.license)||void 0===f?void 0:f.LicenseManager.bCallInitLicense))throw new Error("License is not set.");yield Yr.loadWasm(["license"]),yield no.license.dynamsoft()}const g=new Ci(l);return Ci.onWarning&&(location&&"file:"===location.protocol?setTimeout(()=>{Ci.onWarning&&Ci.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{Ci.onWarning&&Ci.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),g})()}get video(){return Me(this,kn,"f").getVideoEl()}set videoSrc(l){if(!Me(this,kn,"f"))throw new Error("Camera manager is null.");Me(this,Wn,"f")&&(Me(this,Wn,"f")._hideDefaultSelection=!0),Me(this,kn,"f").videoSrc=l}get videoSrc(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.videoSrc}set ifSaveLastUsedCamera(l){if(!Me(this,kn,"f"))throw new Error("Camera manager is null.");Me(this,kn,"f").ifSaveLastUsedCamera=l}get ifSaveLastUsedCamera(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.ifSaveLastUsedCamera}set ifSkipCameraInspection(l){if(!Me(this,kn,"f"))throw new Error("Camera manager is null.");Me(this,kn,"f").ifSkipCameraInspection=l}get ifSkipCameraInspection(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.ifSkipCameraInspection}set cameraOpenTimeout(l){if(!Me(this,kn,"f"))throw new Error("Camera manager is null.");Me(this,kn,"f").cameraOpenTimeout=l}get cameraOpenTimeout(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.cameraOpenTimeout}set singleFrameMode(l){if(!["disabled","image","camera"].includes(l))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Pn(this,jI,l,"f")}get singleFrameMode(){return Me(this,jI,"f")}get _isFetchingStarted(){return Me(this,ep,"f")}get disposed(){return Me(this,MM,"f")}constructor(l){var u;if(super(),u=this,nr.add(this),kn.set(this,void 0),Wn.set(this,void 0),ox.set(this,"closed"),Zf.set(this,void 0),cv.set(this,!1),jI.set(this,void 0),this._onCameraSelChange=Fe(function*(){u.isOpen()&&Me(u,Wn,"f")&&!Me(u,Wn,"f").disposed&&(yield u.selectCamera(Me(u,Wn,"f")._selCam.value))}),this._onResolutionSelChange=Fe(function*(){if(!u.isOpen()||!Me(u,Wn,"f")||Me(u,Wn,"f").disposed)return;let f,g;if(Me(u,Wn,"f")._selRsl&&-1!=Me(u,Wn,"f")._selRsl.selectedIndex){let m=Me(u,Wn,"f")._selRsl.options[Me(u,Wn,"f")._selRsl.selectedIndex];f=parseInt(m.getAttribute("data-width")),g=parseInt(m.getAttribute("data-height"))}yield u.setResolution({width:f,height:g})}),this._onCloseBtnClick=Fe(function*(){u.isOpen()&&Me(u,Wn,"f")&&!Me(u,Wn,"f").disposed&&u.close()}),HI.set(this,(f,g,m,v)=>{const _=Date.now(),b={sx:v.x,sy:v.y,sWidth:v.width,sHeight:v.height,dWidth:v.width,dHeight:v.height},S=Math.max(b.dWidth,b.dHeight);if(this.canvasSizeLimit&&S>this.canvasSizeLimit){const O=this.canvasSizeLimit/S;b.dWidth>b.dHeight?(b.dWidth=this.canvasSizeLimit,b.dHeight=Math.round(b.dHeight*O)):(b.dWidth=Math.round(b.dWidth*O),b.dHeight=this.canvasSizeLimit)}const I=Me(this,kn,"f").imageDataGetter.getImageData(f,g,m,b,{pixelFormat:rK.get(this.getPixelFormat())});let k=null;if(I){const O=Date.now();let j;j=I.pixelFormat===tr.GREY?I.width:4*I.width;let W=!0;0===b.sx&&0===b.sy&&b.sWidth===g&&b.sHeight===m&&(W=!1),k={bytes:I.data,width:I.width,height:I.height,stride:j,format:oK.get(I.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:hI.ITT_FILE_IMAGE,isCropped:W,cropRegion:{left:v.x,top:v.y,right:v.x+v.width,bottom:v.y+v.height,isMeasuredInPercentage:!1},originalWidth:g,originalHeight:m,currentWidth:I.width,currentHeight:I.height,timeSpent:O-_,timeStamp:O},toCanvas:Me(this,GI,"f"),isDCEFrame:!0}}return k}),this._onSingleFrameAcquired=f=>{let g;g=Me(this,Wn,"f")?Me(this,Wn,"f").getConvertedRegion():CI.convert(Me(this,uv,"f"),f.width,f.height),g||(g={x:0,y:0,width:f.width,height:f.height});const m=Me(this,HI,"f").call(this,f,f.width,f.height,g);Me(this,Zf,"f").fire("singleFrameAcquired",[m],{async:!1,copy:!1})},GI.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const f=document.createElement("canvas");let g;if(f.width=this.width,f.height=this.height,this.format===Hn.IPF_GRAYSCALED){g=new Uint8ClampedArray(this.width*this.height*4);for(let m=0;m<g.length;m+=4)g[m]=this.bytes[m/4],g[m+1]=this.bytes[m/4],g[m+2]=this.bytes[m/4],g[m+3]=255}else g=new Uint8ClampedArray(this.bytes.buffer);return f.getContext("2d").putImageData(new ImageData(g,this.width,this.height),0,0),f}),sx.set(this,void 0),uv.set(this,void 0),zI.set(this,Hn.IPF_ABGR_8888),ep.set(this,!1),this._imageId=-1,Uc.set(this,void 0),this.fetchInterval=0,Mo.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),Ln.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),Mh.set(this,void 0),MM.set(this,!1),this.isCameraEnhancer=!0,l&&!(l instanceof Yo))throw new TypeError("Invalid view.");Pn(this,Zf,new jq,"f"),Pn(this,kn,new ti,"f"),this._imageDataGetter=Me(this,kn,"f").imageDataGetter,Me(this,kn,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const f=Me(this,kn,"f").getSoftwareScale();if(f<1)throw new RangeError("Invalid scale value.");Me(this,Wn,"f")&&!Me(this,Wn,"f").disposed?(this.video.style.transform=1===f?"":`scale(${f})`,Me(this,Wn,"f")._updateVideoContainer()):this.video.style.transform=1===f?"":`scale(${f})`},["iPhone","iPad","Android","HarmonyOS"].includes(Ra.OS)?Me(this,kn,"f").setResolution(1280,720):Me(this,kn,"f").setResolution(1920,1080),this.singleFrameMode=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"disabled":"image",l&&this.setCameraView(l),this._on("before:camera:change",()=>{Me(this,Mh,"f").stopCharging();const f=Me(this,Wn,"f");f&&!f.disposed&&(f._startLoading(),f.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const f=Me(this,Wn,"f");f&&!f.disposed&&(f._startLoading(),f.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),l.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{Me(this,Mh,"f").stopCharging(),Me(this,Wn,"f")}),this._on("resumed",()=>{Me(this,Wn,"f")}),this._on("tapfocus",()=>{Me(this,Mo,"f").tapToFocus&&Me(this,Mh,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=function(){var f=Fe(function*(g,m){var v,_,b,S;if(Me(u,nr,"m",$r).call(u)||!u.isOpen()||u.isPaused())return;const I=g.intermediateResultUnits;Ci._onLog&&(Ci._onLog("intermediateResultUnits:"),Ci._onLog(I));let k=!1,O=!1;for(let j of I){if(j.unitType===Py.IRUT_DECODED_BARCODES&&j.decodedBarcodes.length){k=!0;break}j.unitType===Py.IRUT_LOCALIZED_BARCODES&&j.localizedBarcodes.length&&(O=!0)}if(Ci._onLog&&(Ci._onLog("hasLocalizedBarcodes:"),Ci._onLog(O)),Me(u,Mo,"f").autoZoom||Me(u,Mo,"f").enhancedFocus)if(k)Me(u,Ln,"f").autoZoomInFrameArray.length=0,Me(u,Ln,"f").autoZoomOutFrameCount=0,Me(u,Ln,"f").frameArrayInIdealZoom.length=0,Me(u,Ln,"f").autoFocusFrameArray.length=0;else{const j=function(){var J=Fe(function*(K){yield u.setZoom(K),Me(u,Mo,"f").autoZoom&&Me(u,Mh,"f").startCharging()});return function(Q){return J.apply(this,arguments)}}(),W=function(){var J=Fe(function*(K){yield u.setFocus(K),Me(u,Mo,"f").enhancedFocus&&Me(u,Mh,"f").startCharging()});return function(Q){return J.apply(this,arguments)}}();if(O){const J=I[0].originalImageTag,K=(null===(v=J.cropRegion)||void 0===v?void 0:v.left)||0,Q=(null===(_=J.cropRegion)||void 0===_?void 0:_.top)||0,ie=(null===(b=J.cropRegion)||void 0===b?void 0:b.right)?J.cropRegion.right-K:J.originalWidth,oe=(null===(S=J.cropRegion)||void 0===S?void 0:S.bottom)?J.cropRegion.bottom-Q:J.originalHeight,le=J.currentWidth,he=J.currentHeight;let _e;{let Ve,ee,ke,xe,Le;{const z=u.video.videoWidth*(1-Me(u,Ln,"f").autoZoomDetectionArea)/2,$=u.video.videoWidth*(1+Me(u,Ln,"f").autoZoomDetectionArea)/2,P=$,L=z,X=u.video.videoHeight*(1-Me(u,Ln,"f").autoZoomDetectionArea)/2,ne=X,Z=u.video.videoHeight*(1+Me(u,Ln,"f").autoZoomDetectionArea)/2;Le=[{x:z,y:X},{x:$,y:ne},{x:P,y:Z},{x:L,y:Z}]}Ci._onLog&&(Ci._onLog("detectionArea:"),Ci._onLog(Le));const V=[];{const z=($,P)=>{const L=(ne,Z)=>{if(!ne&&!Z)throw new Error("Invalid arguments.");return function(te,ae,fe){let be=!1;const Pe=te.length;if(Pe<=2)return!1;for(let De=0;De<Pe;De++){const Xe=te[De],Re=te[(De+1)%Pe];if(vIe(Xe,Re,{x:ae,y:fe}))return!0;hM(Xe.y-fe)>0!=hM(Re.y-fe)>0&&hM(ae-(fe-Xe.y)*(Xe.x-Re.x)/(Xe.y-Re.y)-Xe.x)<0&&(be=!be)}return be}(Z,ne.x,ne.y)},X=(ne,Z)=>!!(xI([ne[0],ne[1]],[ne[2],ne[3]],[Z[0].x,Z[0].y],[Z[1].x,Z[1].y])||xI([ne[0],ne[1]],[ne[2],ne[3]],[Z[1].x,Z[1].y],[Z[2].x,Z[2].y])||xI([ne[0],ne[1]],[ne[2],ne[3]],[Z[2].x,Z[2].y],[Z[3].x,Z[3].y])||xI([ne[0],ne[1]],[ne[2],ne[3]],[Z[3].x,Z[3].y],[Z[0].x,Z[0].y]));return!!(L({x:$[0].x,y:$[0].y},P)||L({x:$[1].x,y:$[1].y},P)||L({x:$[2].x,y:$[2].y},P)||L({x:$[3].x,y:$[3].y},P))||!!(L({x:P[0].x,y:P[0].y},$)||L({x:P[1].x,y:P[1].y},$)||L({x:P[2].x,y:P[2].y},$)||L({x:P[3].x,y:P[3].y},$))||!!(X([P[0].x,P[0].y,P[1].x,P[1].y],$)||X([P[1].x,P[1].y,P[2].x,P[2].y],$)||X([P[2].x,P[2].y,P[3].x,P[3].y],$)||X([P[3].x,P[3].y,P[0].x,P[0].y],$))};for(let $ of I)if($.unitType===Py.IRUT_LOCALIZED_BARCODES)for(let P of $.localizedBarcodes){if(!P)continue;const L=P.location.points;L.forEach(X=>{Yo._transformCoordinates(X,K,Q,ie,oe,le,he)}),z(Le,L)&&V.push(P)}if(Ci._debug&&Me(u,Wn,"f")){const $=u.__layer||(u.__layer=Me(u,Wn,"f")._createDrawingLayer(99));$.clearDrawingItems();const P=u.__styleId2||(u.__styleId2=ln.createDrawingStyle({strokeStyle:"red"}));for(let L of I)if(L.unitType===Py.IRUT_LOCALIZED_BARCODES)for(let X of L.localizedBarcodes){if(!X)continue;const Z=new vM({points:X.location.points},P);$.addDrawingItems([Z])}}}if(Ci._onLog&&(Ci._onLog("intersectedResults:"),Ci._onLog(V)),!V.length)return;let F;if(V.length){let z=V.filter($=>$.possibleFormats==LM.BF_QR_CODE||$.possibleFormats==LM.BF_DATAMATRIX);if(z.length||(z=V.filter($=>$.possibleFormats==LM.BF_ONED),z.length||(z=V)),z.length){const $=L=>{const X=L.location.points,ne=(X[0].x+X[1].x+X[2].x+X[3].x)/4,Z=(X[0].y+X[1].y+X[2].y+X[3].y)/4;return(ne-le/2)*(ne-le/2)+(Z-he/2)*(Z-he/2)};F=z[0];let P=$(F);if(1!=z.length)for(let L=1;L<z.length;L++){const X=$(z[L]);(z[L].confidence>1.1*F.confidence||z[L].confidence>.9*F.confidence&&X<P)&&(F=z[L],P=X)}}}if(Ci._onLog&&(Ci._onLog("highPriorityResult:"),Ci._onLog(F)),F){const z=F.location.points;Ve=Math.min(z[0].x,z[1].x,z[2].x,z[3].x),ee=Math.max(z[0].x,z[1].x,z[2].x,z[3].x),ke=Math.min(z[0].y,z[1].y,z[2].y,z[3].y),xe=Math.max(z[0].y,z[1].y,z[2].y,z[3].y),_e={points:[{x:Ve,y:ke},{x:ee,y:ke},{x:ee,y:xe},{x:Ve,y:xe}],result:F}}}if(Ci._onLog&&(Ci._onLog("boundingRect:"),Ci._onLog(_e)),!_e)return;if(Ci._debug&&Me(u,Wn,"f")&&(null==_e?void 0:_e.points)){const Ve=u.__layer||(u.__layer=Me(u,Wn,"f")._createDrawingLayer(99)),ee=u.__styleId1||(u.__styleId1=ln.createDrawingStyle({strokeStyle:"blue"})),ke=new vM({points:_e.points},ee);Ve.addDrawingItems([ke])}if(Me(u,Ln,"f").autoZoomOutFrameCount=0,Me(u,Mo,"f").autoZoom){const Ve=Me(u,Ln,"f").autoZoomIdealArea[1];let ee=(1-Me(u,Ln,"f").autoZoomTargetBorder)/2;const ke=_e.points[0].x/ie,xe=(ie-_e.points[2].x)/ie,Le=_e.points[0].y/oe,V=(oe-_e.points[2].y)/oe;if(ke>Ve&&xe>Ve&&Le>Ve&&V>Ve&&_e.result.moduleSize<Me(u,Ln,"f").autoZoomInIdealModuleSize){if(Me(u,Ln,"f").autoZoomInFrameArray.push(!0),Me(u,Ln,"f").autoZoomInFrameArray.splice(0,Me(u,Ln,"f").autoZoomInFrameArray.length-Me(u,Ln,"f").autoZoomInFrameLimit[0]),Me(u,Ln,"f").frameArrayInIdealZoom.length=0,Me(u,Mo,"f").enhancedFocus&&W({mode:"continuous"}).catch(()=>{}),Me(u,Ln,"f").autoZoomInFrameArray.filter(F=>!0===F).length>=Me(u,Ln,"f").autoZoomInFrameLimit[1]){Me(u,Ln,"f").autoZoomInFrameArray.length=0;const F=[(.5-ee)/(.5-ke),(.5-ee)/(.5-xe),(.5-ee)/(.5-Le),(.5-ee)/(.5-V)].filter(X=>X>0),z=Math.min(...F,Me(u,Ln,"f").autoZoomInIdealModuleSize/_e.result.moduleSize),$=u.getZoomSettings().factor;let P=Math.max(Math.pow($*z,1/Me(u,Ln,"f").autoZoomInMaxTimes),Me(u,Ln,"f").autoZoomInMinStep);P=Math.min(P,z);let L=$*P;L=Math.max(Me(u,Ln,"f").minValue,L),L=Math.min(Me(u,Ln,"f").maxValue,L);try{yield j({factor:L})}catch(X){console.warn(X.message||X)}u.clearBuffer()}}else if(Me(u,Ln,"f").autoZoomInFrameArray.length=0,Me(u,Ln,"f").frameArrayInIdealZoom.push(!0),Me(u,Ln,"f").frameArrayInIdealZoom.splice(0,Me(u,Ln,"f").frameArrayInIdealZoom.length-Me(u,Ln,"f").frameLimitInIdealZoom[0]),Me(u,Ln,"f").frameArrayInIdealZoom.filter(F=>!0===F).length>=Me(u,Ln,"f").frameLimitInIdealZoom[1]&&(Me(u,Ln,"f").frameArrayInIdealZoom.length=0,Me(u,Mo,"f").enhancedFocus)){const F=_e.points;try{yield W({mode:"manual",area:{centerPoint:{x:(F[0].x+F[2].x)/2+"px",y:(F[0].y+F[2].y)/2+"px"},width:F[2].x-F[0].x+"px",height:F[2].y-F[0].y+"px"}})}catch(z){console.warn(z.message||z)}u.clearBuffer()}}if(!Me(u,Mo,"f").autoZoom&&Me(u,Mo,"f").enhancedFocus&&(Me(u,Ln,"f").autoFocusFrameArray.push(!0),Me(u,Ln,"f").autoFocusFrameArray.splice(0,Me(u,Ln,"f").autoFocusFrameArray.length-Me(u,Ln,"f").autoFocusFrameLimit[0]),Me(u,Ln,"f").autoFocusFrameArray.filter(Ve=>!0===Ve).length>=Me(u,Ln,"f").autoFocusFrameLimit[1])){Me(u,Ln,"f").autoFocusFrameArray.length=0;try{const Ve=_e.points;yield W({mode:"manual",area:{centerPoint:{x:(Ve[0].x+Ve[2].x)/2+"px",y:(Ve[0].y+Ve[2].y)/2+"px"},width:Ve[2].x-Ve[0].x+"px",height:Ve[2].y-Ve[0].y+"px"}})}catch(Ve){console.warn(Ve.message||Ve)}u.clearBuffer()}}else{if(Me(u,Mo,"f").autoZoom){if(Me(u,Ln,"f").autoZoomInFrameArray.push(!1),Me(u,Ln,"f").autoZoomInFrameArray.splice(0,Me(u,Ln,"f").autoZoomInFrameArray.length-Me(u,Ln,"f").autoZoomInFrameLimit[0]),Me(u,Ln,"f").autoZoomOutFrameCount++,Me(u,Ln,"f").frameArrayInIdealZoom.push(!1),Me(u,Ln,"f").frameArrayInIdealZoom.splice(0,Me(u,Ln,"f").frameArrayInIdealZoom.length-Me(u,Ln,"f").frameLimitInIdealZoom[0]),Me(u,Ln,"f").autoZoomOutFrameCount>=Me(u,Ln,"f").autoZoomOutFrameLimit){Me(u,Ln,"f").autoZoomOutFrameCount=0;const J=u.getZoomSettings().factor;let K=J-Math.max((J-1)*Me(u,Ln,"f").autoZoomOutStepRate,Me(u,Ln,"f").autoZoomOutMinStep);K=Math.max(Me(u,Ln,"f").minValue,K),K=Math.min(Me(u,Ln,"f").maxValue,K);try{yield j({factor:K})}catch(Q){console.warn(Q.message||Q)}u.clearBuffer()}Me(u,Mo,"f").enhancedFocus&&W({mode:"continuous"}).catch(()=>{})}!Me(u,Mo,"f").autoZoom&&Me(u,Mo,"f").enhancedFocus&&(Me(u,Ln,"f").autoFocusFrameArray.length=0,W({mode:"continuous"}).catch(()=>{}))}}});return function(g,m){return f.apply(this,arguments)}}(),Pn(this,Mh,new tp(1e4),"f")}setCameraView(l){if(!(l instanceof Yo))throw new TypeError("Invalid view.");if(l.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),l._singleFrameMode=this.singleFrameMode,l._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(Me(this,Wn,"f")._hideDefaultSelection=!0),Me(this,nr,"m",$r).call(this)||Me(this,kn,"f").setVideoEl(l.getVideoElement()),Pn(this,Wn,l,"f"),this.addListenerToView()}getCameraView(){return Me(this,Wn,"f")}releaseCameraView(){Me(this,Wn,"f")&&(this.removeListenerFromView(),Me(this,Wn,"f").disposed||(Me(this,Wn,"f")._singleFrameMode="disabled",Me(this,Wn,"f")._onSingleFrameAcquired=null,Me(this,Wn,"f")._hideDefaultSelection=!1),Me(this,kn,"f").releaseVideoEl(),Pn(this,Wn,null,"f"))}addListenerToView(){if(!Me(this,Wn,"f"))return;if(Me(this,Wn,"f").disposed)throw new Error("'cameraView' has been disposed.");const l=Me(this,Wn,"f");Me(this,nr,"m",$r).call(this)||this.videoSrc||(l._innerComponent&&(Me(this,kn,"f").tapFocusEventBoundEl=l._innerComponent),l._selCam&&l._selCam.addEventListener("change",this._onCameraSelChange),l._selRsl&&l._selRsl.addEventListener("change",this._onResolutionSelChange)),l._btnClose&&l._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!Me(this,Wn,"f")||Me(this,Wn,"f").disposed)return;const l=Me(this,Wn,"f");Me(this,kn,"f").tapFocusEventBoundEl=null,l._selCam&&l._selCam.removeEventListener("change",this._onCameraSelChange),l._selRsl&&l._selRsl.removeEventListener("change",this._onResolutionSelChange),l._btnClose&&l._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return Me(this,nr,"m",$r).call(this)?Me(this,ox,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(Me(this,kn,"f").state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}open(){var l=this;return Fe(function*(){const u=Me(l,Wn,"f");if(null==u?void 0:u.disposed)throw new Error("'cameraView' has been disposed.");u&&(u._singleFrameMode=l.singleFrameMode,Me(l,nr,"m",$r).call(l)?u._clickIptSingleFrameMode():(Me(l,kn,"f").setVideoEl(u.getVideoElement()),u._startLoading()));let f={width:0,height:0,deviceId:""};if(!Me(l,nr,"m",$r).call(l)){try{yield Me(l,kn,"f").open()}catch(m){throw u&&u._stopLoading(),m}Me(l,cv,"f")&&l.turnOnTorch().catch(()=>{});const g=l.getResolution();f.width=g.width,f.height=g.height,f.deviceId=l.getSelectedCamera().deviceId}return Pn(l,ox,"open","f"),u&&(u._innerComponent.style.display="",Me(l,nr,"m",$r).call(l)||(u._stopLoading(),u._renderCamerasInfo(l.getSelectedCamera(),Me(l,kn,"f")._arrCameras),u._renderResolutionInfo({width:f.width,height:f.height}),u.eventHandler.fire("content:updated",null,{async:!1}),u.eventHandler.fire("videoEl:resized",null,{async:!1}))),Me(l,Zf,"f").fire("opened",null,{target:l,async:!1}),f})()}close(){const l=Me(this,Wn,"f");if(null==l?void 0:l.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),Me(this,nr,"m",$r).call(this)||Me(this,kn,"f").close(),Pn(this,ox,"closed","f"),Me(this,Mh,"f").stopCharging(),l&&(l._innerComponent.style.display="none",Me(this,nr,"m",$r).call(this)&&l._innerComponent.removeElement("content"),l._stopLoading()),Me(this,Zf,"f").fire("closed",null,{target:this,async:!1})}pause(){if(Me(this,nr,"m",$r).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");Me(this,kn,"f").pause()}isPaused(){var l;return!Me(this,nr,"m",$r).call(this)&&!0===(null===(l=this.video)||void 0===l?void 0:l.paused)}resume(){var l=this;return Fe(function*(){if(Me(l,nr,"m",$r).call(l))throw new Error("'resume()' is invalid in 'singleFrameMode'.");yield Me(l,kn,"f").resume()})()}selectCamera(l){var u=this;return Fe(function*(){if(!l)throw new Error("Invalid value.");let f;f="string"==typeof l?l:l.deviceId,yield Me(u,kn,"f").setCamera(f),Pn(u,cv,!1,"f");const g=u.getResolution(),m=Me(u,Wn,"f");return m&&!m.disposed&&(m._stopLoading(),m._renderCamerasInfo(u.getSelectedCamera(),Me(u,kn,"f")._arrCameras),m._renderResolutionInfo({width:g.width,height:g.height})),{width:g.width,height:g.height,deviceId:u.getSelectedCamera().deviceId}})()}getSelectedCamera(){return Me(this,kn,"f").getCamera()}getAllCameras(){var l=this;return Fe(function*(){return Me(l,kn,"f").getCameras()})()}setResolution(l){var u=this;return Fe(function*(){yield Me(u,kn,"f").setResolution(l.width,l.height),Me(u,cv,"f")&&u.turnOnTorch().catch(()=>{});const f=u.getResolution(),g=Me(u,Wn,"f");return g&&!g.disposed&&(g._stopLoading(),g._renderResolutionInfo({width:f.width,height:f.height})),{width:f.width,height:f.height,deviceId:u.getSelectedCamera().deviceId}})()}getResolution(){return Me(this,kn,"f").getResolution()}getAvailableResolutions(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.getResolutions()}_on(l,u){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(l.toLowerCase())?Me(this,Zf,"f").on(l,u):Me(this,kn,"f").on(l,u)}_off(l,u){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(l.toLowerCase())?Me(this,Zf,"f").off(l,u):Me(this,kn,"f").off(l,u)}on(l,u){const f=l.toLowerCase(),g=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(f);if(!g)throw new Error("Invalid event.");this._on(g,u)}off(l,u){const f=l.toLowerCase(),g=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(f);if(!g)throw new Error("Invalid event.");this._off(g,u)}getVideoSettings(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.getMediaStreamConstraints()}updateVideoSettings(l){var u=this;return Fe(function*(){var f;yield null===(f=Me(u,kn,"f"))||void 0===f?void 0:f.setMediaStreamConstraints(l,!0)})()}getCapabilities(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.getCameraCapabilities()}getCameraSettings(){return Me(this,kn,"f").getCameraSettings()}turnOnTorch(){var l=this;return Fe(function*(){var u;if(Me(l,nr,"m",$r).call(l))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");yield null===(u=Me(l,kn,"f"))||void 0===u?void 0:u.turnOnTorch(),Pn(l,cv,!0,"f")})()}turnOffTorch(){var l=this;return Fe(function*(){var u;if(Me(l,nr,"m",$r).call(l))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");yield null===(u=Me(l,kn,"f"))||void 0===u?void 0:u.turnOffTorch(),Pn(l,cv,!1,"f")})()}setColorTemperature(l){var u=this;return Fe(function*(){if(Me(u,nr,"m",$r).call(u))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");yield Me(u,kn,"f").setColorTemperature(l,!0)})()}getColorTemperature(){return Me(this,kn,"f").getColorTemperature()}setExposureCompensation(l){var u=this;return Fe(function*(){var f;if(Me(u,nr,"m",$r).call(u))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");yield null===(f=Me(u,kn,"f"))||void 0===f?void 0:f.setExposureCompensation(l,!0)})()}getExposureCompensation(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.getExposureCompensation()}_setZoom(l){var u=this;return Fe(function*(){var f;if(Me(u,nr,"m",$r).call(u))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");yield null===(f=Me(u,kn,"f"))||void 0===f?void 0:f.setZoom(l)})()}setZoom(l){var u=this;return Fe(function*(){yield u._setZoom(l)})()}getZoomSettings(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.getZoom()}resetZoom(){var l=this;return Fe(function*(){var u;if(Me(l,nr,"m",$r).call(l))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");yield null===(u=Me(l,kn,"f"))||void 0===u?void 0:u.resetZoom()})()}setFrameRate(l){var u=this;return Fe(function*(){var f;if(Me(u,nr,"m",$r).call(u))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");yield null===(f=Me(u,kn,"f"))||void 0===f?void 0:f.setFrameRate(l,!0)})()}getFrameRate(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.getFrameRate()}setFocus(l){var u=this;return Fe(function*(){var f;if(Me(u,nr,"m",$r).call(u))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");yield null===(f=Me(u,kn,"f"))||void 0===f?void 0:f.setFocus(l,!0)})()}getFocusSettings(){var l;return null===(l=Me(this,kn,"f"))||void 0===l?void 0:l.getFocus()}setAutoZoomRange(l){Me(this,Ln,"f").minValue=l.min,Me(this,Ln,"f").maxValue=l.max}getAutoZoomRange(){return{min:Me(this,Ln,"f").minValue,max:Me(this,Ln,"f").maxValue}}enableEnhancedFeatures(l){var u=this;return Fe(function*(){var f,g;if(!(null===(g=null===(f=no.license)||void 0===f?void 0:f.LicenseManager)||void 0===g?void 0:g.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(0!==Yr.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");l&gg.EF_ENHANCED_FOCUS&&(Me(u,Mo,"f").enhancedFocus=!0),l&gg.EF_AUTO_ZOOM&&(Me(u,Mo,"f").autoZoom=!0),l&gg.EF_TAP_TO_FOCUS&&(Me(u,Mo,"f").tapToFocus=!0,Me(u,kn,"f").enableTapToFocus())})()}disableEnhancedFeatures(l){l&gg.EF_ENHANCED_FOCUS&&(Me(this,Mo,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),l&gg.EF_AUTO_ZOOM&&(Me(this,Mo,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),l&gg.EF_TAP_TO_FOCUS&&(Me(this,Mo,"f").tapToFocus=!1,Me(this,kn,"f").disableTapToFocus()),Me(this,nr,"m",iK).call(this)&&Me(this,nr,"m",nK).call(this)||Me(this,Mh,"f").stopCharging()}_setScanRegion(l){if(null!=l&&!dM(l)&&!Gf(l))throw TypeError("Invalid 'region'.");Pn(this,uv,l?JSON.parse(JSON.stringify(l)):null,"f"),Me(this,Wn,"f")&&!Me(this,Wn,"f").disposed&&Me(this,Wn,"f").setScanRegion(l)}setScanRegion(l){this._setScanRegion(l),Me(this,Wn,"f")&&!Me(this,Wn,"f").disposed&&(null===l?Me(this,Wn,"f").setScanRegionMaskVisible(!1):Me(this,Wn,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(Me(this,uv,"f")))}setErrorListener(l){if(!l)throw new TypeError("Invalid 'listener'");Pn(this,sx,l,"f")}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!Me(this,kn,"f").isVideoLoaded()||Me(this,nr,"m",$r).call(this))}startFetching(){if(Me(this,nr,"m",$r).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");Me(this,ep,"f")||(Pn(this,ep,!0,"f"),Me(this,nr,"m",OM).call(this))}stopFetching(){Me(this,ep,"f")&&(Ci._onLog&&Ci._onLog("DCE: stop fetching loop: "+Date.now()),Me(this,Uc,"f")&&clearTimeout(Me(this,Uc,"f")),Pn(this,ep,!1,"f"))}fetchImage(){if(Me(this,nr,"m",$r).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const l=this.getResolution();if(!(null==l?void 0:l.width)||!(null==l?void 0:l.height))throw new Error("The video is not loaded.");let u;if(u=CI.convert(Me(this,uv,"f"),l.width,l.height),u||(u={x:0,y:0,width:l.width,height:l.height}),u.x>l.width||u.y>l.height)throw new Error("Invalid scan region.");u.x+u.width>l.width&&(u.width=l.width-u.x),u.y+u.height>l.height&&(u.height=l.height-u.y);const f={sx:u.x,sy:u.y,sWidth:u.width,sHeight:u.height,dWidth:u.width,dHeight:u.height},g=Math.max(f.dWidth,f.dHeight);if(this.canvasSizeLimit&&g>this.canvasSizeLimit){const b=this.canvasSizeLimit/g;f.dWidth>f.dHeight?(f.dWidth=this.canvasSizeLimit,f.dHeight=Math.round(f.dHeight*b)):(f.dWidth=Math.round(f.dWidth*b),f.dHeight=this.canvasSizeLimit)}const m=Me(this,kn,"f").getFrameData({position:f,pixelFormat:rK.get(this.getPixelFormat())});if(!m)return null;let v;v=m.pixelFormat===tr.GREY?m.width:4*m.width;let _=!0;return 0===f.sx&&0===f.sy&&f.sWidth===l.width&&f.sHeight===l.height&&(_=!1),{bytes:m.data,width:m.width,height:m.height,stride:v,format:oK.get(m.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:hI.ITT_VIDEO_FRAME,isCropped:_,cropRegion:{left:u.x,top:u.y,right:u.x+u.width,bottom:u.y+u.height,isMeasuredInPercentage:!1},originalWidth:l.width,originalHeight:l.height,currentWidth:m.width,currentHeight:m.height,timeSpent:m.timeSpent,timeStamp:m.timeStamp},toCanvas:Me(this,GI,"f"),isDCEFrame:!0}}setImageFetchInterval(l){this.fetchInterval=l,Me(this,ep,"f")&&(Me(this,Uc,"f")&&clearTimeout(Me(this,Uc,"f")),Pn(this,Uc,setTimeout(()=>{this.disposed||Me(this,nr,"m",OM).call(this)},l),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(l){Pn(this,zI,l,"f")}getPixelFormat(){return Me(this,zI,"f")}takePhoto(l){var u=this;if(!this.isOpen())throw new Error("Not open.");if(Me(this,nr,"m",$r).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const f=document.createElement("input");f.setAttribute("type","file"),f.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),f.setAttribute("capture",""),f.style.position="absolute",f.style.top="-9999px",f.style.backgroundColor="transparent",f.style.color="transparent",f.addEventListener("click",()=>{const g=this.isOpen();this.close(),window.addEventListener("focus",()=>{g&&this.open(),f.remove()},{once:!0})}),f.addEventListener("change",Fe(function*(){const g=f.files[0],m=yield(I=Fe(function*(k){let O=null,j=null;if("undefined"!=typeof createImageBitmap)try{if(O=yield createImageBitmap(k),O)return O}catch(J){}var W;return O||(j=yield(W=k,new Promise((J,K)=>{let Q=URL.createObjectURL(W),ie=new Image;ie.src=Q,ie.onload=()=>{URL.revokeObjectURL(ie.src),J(ie)},ie.onerror=oe=>{K(new Error("Can't convert blob to image : "+(oe instanceof Event?oe.type:oe)))}}))),j}),function(k){return I.apply(this,arguments)})(g),v=m instanceof HTMLImageElement?m.naturalWidth:m.width,_=m instanceof HTMLImageElement?m.naturalHeight:m.height;var I;let b=CI.convert(Me(u,uv,"f"),v,_);b||(b={x:0,y:0,width:v,height:_});const S=Me(u,HI,"f").call(u,m,v,_,b);l&&l(S)})),document.body.appendChild(f),f.click()}convertToPageCoordinates(l){const u=Me(this,nr,"m",FM).call(this,l);return{x:u.pageX,y:u.pageY}}convertToClientCoordinates(l){const u=Me(this,nr,"m",FM).call(this,l);return{x:u.clientX,y:u.clientY}}dispose(){this.close(),Me(this,kn,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let l in this)delete this[l];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}function Ml(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function Bd(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}RM=Ci,kn=new WeakMap,Wn=new WeakMap,ox=new WeakMap,Zf=new WeakMap,cv=new WeakMap,jI=new WeakMap,HI=new WeakMap,GI=new WeakMap,sx=new WeakMap,uv=new WeakMap,zI=new WeakMap,ep=new WeakMap,Uc=new WeakMap,Mo=new WeakMap,Ln=new WeakMap,Mh=new WeakMap,MM=new WeakMap,nr=new WeakSet,$r=function(){return"disabled"!==this.singleFrameMode},nK=function(){return!this.videoSrc&&"opened"===Me(this,kn,"f").state},iK=function(){for(let p in Me(this,Mo,"f"))if(1==Me(this,Mo,"f")[p])return!0;return!1},OM=function p(){if(this.disposed)return;if("open"!==this.getCameraState()||!Me(this,ep,"f"))return Me(this,Uc,"f")&&clearTimeout(Me(this,Uc,"f")),void Pn(this,Uc,setTimeout(()=>{this.disposed||Me(this,nr,"m",p).call(this)},this.fetchInterval),"f");const l=()=>{var u;let f;Ci._onLog&&Ci._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{f=this.fetchImage()}catch(g){const m=g.message||g;if("The video is not loaded."===m)return;if(null===(u=Me(this,sx,"f"))||void 0===u?void 0:u.onErrorReceived)return void setTimeout(()=>{var v;null===(v=Me(this,sx,"f"))||void 0===v||v.onErrorReceived(Q4.EC_IMAGE_READ_FAILED,m)},0);console.warn(g)}f?(this.addImageToBuffer(f),Ci._onLog&&Ci._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),Me(this,Zf,"f").fire("frameAddedToBuffer",null,{async:!1})):Ci._onLog&&Ci._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case ev.BOPM_BLOCK:break;case ev.BOPM_UPDATE:l()}else l();Me(this,Uc,"f")&&clearTimeout(Me(this,Uc,"f")),Pn(this,Uc,setTimeout(()=>{this.disposed||Me(this,nr,"m",p).call(this)},this.fetchInterval),"f")},FM=function(p){if(!Me(this,Wn,"f"))throw new Error("Camera view is not set.");if(Me(this,Wn,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!Me(this,nr,"m",$r).call(this)&&!Me(this,kn,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(Me(this,nr,"m",$r).call(this)&&!Me(this,Wn,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const l=Me(this,Wn,"f")._innerComponent.getBoundingClientRect(),u=l.left,f=l.top,g=u+window.scrollX,m=f+window.scrollY,{width:v,height:_}=Me(this,Wn,"f")._innerComponent.getBoundingClientRect();if(v<=0||_<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let b,S,I;if(Me(this,nr,"m",$r).call(this)){const ie=Me(this,Wn,"f")._innerComponent.getElement("content");b=ie.width,S=ie.height,I="contain"}else{const ie=this.getVideoEl();b=ie.videoWidth,S=ie.videoHeight,I=Me(this,Wn,"f").getVideoFit()}const k=v/_,O=b/S;let j,W,J,K,Q=1;if("contain"===I)k<O?(Q=v/b,j=u+p.x*Q,W=f+p.y*Q+(_-S*Q)/2,J=g+p.x*Q,K=m+p.y*Q+(_-S*Q)/2):(Q=_/S,j=u+p.x*Q+(v-b*Q)/2,W=f+p.y*Q,J=g+p.x*Q+(v-b*Q)/2,K=m+p.y*Q);else if("cover"===I)if(k<O){Q=_/S;let ie=p.x*Q-(b*Q-v)/2;ie=Math.max(ie,0),ie=Math.min(ie,v),j=u+ie,W=f+p.y*Q,J=g+ie,K=m+p.y*Q}else{Q=v/b;let ie=p.y*Q-(S*Q-_)/2;ie=Math.max(ie,0),ie=Math.min(ie,_),j=u+p.x*Q,W=f+ie,J=g+p.x*Q,K=m+ie}return{clientX:j,clientY:W,pageX:J,pageY:K}},Ci._debug=!1,kM={value:void 0},Ci.browserInfo=Ra,"function"==typeof SuppressedError&&SuppressedError;class Vc{static multiply(l,u){const f=[];for(let g=0;g<3;g++){const m=u.slice(3*g,3*g+3);for(let v=0;v<3;v++){const _=[l[v],l[v+3],l[v+6]].reduce((b,S,I)=>b+S*m[I],0);f.push(_)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(l,u,f){return Vc.multiply(l,[1,0,0,0,1,0,u,f,1])}static rotate(l,u){var f=Math.cos(u),g=Math.sin(u);return Vc.multiply(l,[f,-g,0,g,f,0,0,0,1])}static scale(l,u,f){return Vc.multiply(l,[u,0,0,0,f,0,0,0,1])}}var go,np,ip,YI,qy,ax,lx,Ky,XI,Fu,sK,WM,dx,hx;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(go||(go={}));class ci{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(Bd(ci,np,!1,"f",ip),!1):(Bd(ci,np,!0,"f",ip),!0)}get disposed(){return Ml(this,XI,"f")}constructor(){YI.set(this,go.RGBA),qy.set(this,null),ax.set(this,null),lx.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Ky.set(this,null),XI.set(this,!1)}drawImage(l,u,f,g,m,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Ml(ci,np,"f",ip)&&ci.checkWebGLSupport(),(null==v?void 0:v.bUseWebGL)&&!Ml(ci,np,"f",ip))throw new Error("Your browser or machine may not support WebGL.");if(u instanceof HTMLVideoElement&&4!==u.readyState||u instanceof HTMLImageElement&&!u.complete)throw new Error("The source is not loaded.");let _;ci._onLog&&(_=Date.now(),ci._onLog("drawImage(), START: "+_));let b=0,S=0,I=f,k=g,O=0,j=0,W=f,J=g;m&&(m.sx&&(b=Math.round(m.sx)),m.sy&&(S=Math.round(m.sy)),m.sWidth&&(I=Math.round(m.sWidth)),m.sHeight&&(k=Math.round(m.sHeight)),m.dx&&(O=Math.round(m.dx)),m.dy&&(j=Math.round(m.dy)),m.dWidth&&(W=Math.round(m.dWidth)),m.dHeight&&(J=Math.round(m.dHeight)));let K,Q=go.RGBA;if((null==v?void 0:v.pixelFormat)&&(Q=v.pixelFormat),(null==v?void 0:v.bufferContainer)&&(K=v.bufferContainer,K.length<4*W*J))throw new Error("Unexpected size of the 'bufferContainer'.");const ie=l;if(!Ml(ci,np,"f",ip)||!(this.useWebGLByDefault&&null==(null==v?void 0:v.bUseWebGL)||(null==v?void 0:v.bUseWebGL))){ci._onLog&&ci._onLog("drawImage() in context2d."),ie.ctx2d||(ie.ctx2d=ie.getContext("2d",{willReadFrequently:!0}));const oe=ie.ctx2d;if(!oe)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(ie.width<O+W||ie.height<j+J)&&(ie.width=O+W,ie.height=j+J),oe.drawImage(u,b,S,I,k,O,j,W,J),ci._onLog&&ci._onLog("drawImage() in context2d end. Costs: "+(Date.now()-_)),{context:oe,pixelFormat:go.RGBA,bUseWebGL:!1}}ci._onLog&&ci._onLog("drawImage() in WebGL.");try{(ie.width<O+W||ie.height<j+J)&&(ie.width=O+W,ie.height=j+J,ie.ctxWebGL&&ie.ctxWebGL.viewport(0,0,O+W,j+J));const oe=ie.ctxWebGL||ie.getContext("webgl",{antialias:!1})||ie.getContext("experimental-webgl",{antialias:!1});if(!oe){ci._onLog&&ci._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const ee=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw ee.name="WebGLError",ee}if(!ie.ctxWebGL||Q!==Ml(this,YI,"f")){ie.ctxWebGL=oe;const ee=P=>{const L=P.createBuffer();P.bindBuffer(P.ARRAY_BUFFER,L),P.bufferData(P.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),P.STATIC_DRAW);const X=P.createBuffer();return P.bindBuffer(P.ARRAY_BUFFER,X),P.bufferData(P.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),P.STATIC_DRAW),{positions:L,texCoords:X}},ke=P=>{const L=P.createTexture();return P.bindTexture(P.TEXTURE_2D,L),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),L},xe=(P,L)=>{const X=P.createProgram();if(L.forEach(ne=>P.attachShader(X,ne)),P.linkProgram(X),!P.getProgramParameter(X,P.LINK_STATUS)){const ne=new Error(`An error occured linking the program: ${P.getProgramInfoLog(X)}.`);throw ne.name="WebGLError",ne}return P.useProgram(X),X},Le=(P,L,X)=>{const ne=P.createShader(L);if(P.shaderSource(ne,X),P.compileShader(ne),!P.getShaderParameter(ne,P.COMPILE_STATUS)){const Z=new Error(`An error occured compiling the shader: ${P.getShaderInfoLog(ne)}.`);throw Z.name="WebGLError",Z}return ne},V="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let F="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(Q)&&(F=Q.slice(0,3));const z=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${F} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,$=xe(oe,[Le(oe,oe.VERTEX_SHADER,V),Le(oe,oe.FRAGMENT_SHADER,z)]);Bd(this,ax,{program:$,attribLocations:{vertexPosition:oe.getAttribLocation($,"a_position"),texPosition:oe.getAttribLocation($,"a_texCoord")},uniformLocations:{uSampler:oe.getUniformLocation($,"u_image"),uColorFactor:oe.getUniformLocation($,"uColorFactor"),uMatrix:oe.getUniformLocation($,"u_matrix"),uTextureMatrix:oe.getUniformLocation($,"u_textureMatrix")}},"f"),Bd(this,lx,ee(oe),"f"),Bd(this,qy,ke(oe),"f"),Bd(this,YI,Q,"f")}const le=(ee,ke,xe)=>{ee.bindBuffer(ee.ARRAY_BUFFER,ke),ee.enableVertexAttribArray(xe),ee.vertexAttribPointer(xe,2,ee.FLOAT,!1,0,0)},_e=(ee,ke,xe,Le)=>{ee.clearColor(0,0,0,1),ee.clearDepth(1),ee.enable(ee.DEPTH_TEST),ee.depthFunc(ee.LEQUAL),ee.clear(ee.COLOR_BUFFER_BIT|ee.DEPTH_BUFFER_BIT),le(ee,xe.positions,ke.attribLocations.vertexPosition),le(ee,xe.texCoords,ke.attribLocations.texPosition),ee.activeTexture(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_2D,Le),ee.uniform1i(ke.uniformLocations.uSampler,0),ee.uniform1f(ke.uniformLocations.uColorFactor,[go.GREY,go.GREY32].includes(Q)?1:0);let V,F,z=Vc.translate(Vc.identity(),-1,-1);z=Vc.scale(z,2,2),z=Vc.scale(z,1/ee.canvas.width,1/ee.canvas.height),V=Vc.translate(z,O,j),V=Vc.scale(V,W,J),ee.uniformMatrix3fv(ke.uniformLocations.uMatrix,!1,V),F=Vc.translate(Vc.identity(),b/f,S/g),F=Vc.scale(F,I/f,k/g),ee.uniformMatrix3fv(ke.uniformLocations.uTextureMatrix,!1,F),ee.drawArrays(ee.TRIANGLES,0,6)};((ee,ke,xe)=>{const Le=ee.RGBA,V=ee.RGBA,F=ee.UNSIGNED_BYTE;ee.bindTexture(ee.TEXTURE_2D,ke),ee.texImage2D(ee.TEXTURE_2D,0,Le,V,F,xe)})(oe,Ml(this,qy,"f"),u),_e(oe,Ml(this,ax,"f"),Ml(this,lx,"f"),Ml(this,qy,"f"));const Ve=K||new Uint8Array(4*W*J);if(oe.readPixels(O,j,W,J,oe.RGBA,oe.UNSIGNED_BYTE,Ve),255!==Ve[3]){ci._onLog&&ci._onLog("Incorrect WebGL drawing .");const ee=new Error("WebGL error: incorrect drawing.");throw ee.name="WebGLError",ee}return ci._onLog&&ci._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-_)),{context:oe,pixelFormat:Q===go.GREY?go.GREY32:Q,bUseWebGL:!0}}catch(oe){if(this.forceLoseContext(),null==(null==v?void 0:v.bUseWebGL))return ci._onLog&&ci._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(l,u,f,g,m,Object.assign({},v,{bUseWebGL:!1}));throw oe.name="WebGLError",oe}}readCvsData(l,u,f){if(!(l instanceof CanvasRenderingContext2D||l instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let g,m=0,v=0,_=l.canvas.width,b=l.canvas.height;if(u&&(u.x&&(m=u.x),u.y&&(v=u.y),u.width&&(_=u.width),u.height&&(b=u.height)),(null==f?void 0:f.length)<4*_*b)throw new Error("Unexpected size of the 'bufferContainer'.");if(l instanceof WebGLRenderingContext){const S=l;f?(S.readPixels(m,v,_,b,S.RGBA,S.UNSIGNED_BYTE,f),g=new Uint8Array(f.buffer,0,4*_*b)):(g=new Uint8Array(4*_*b),S.readPixels(m,v,_,b,S.RGBA,S.UNSIGNED_BYTE,g))}else if(l instanceof CanvasRenderingContext2D){let S;S=l.getImageData(m,v,_,b),g=new Uint8Array(S.data.buffer),null==f||f.set(g)}return g}transformPixelFormat(l,u,f,g){let m,v;if(ci._onLog&&(m=Date.now(),ci._onLog("transformPixelFormat(), START: "+m)),u===f)return ci._onLog&&ci._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),g?new Uint8Array(l):l;const _=[go.RGBA,go.RBGA,go.GRBA,go.GBRA,go.BRGA,go.BGRA];if(_.includes(u))if(f===go.GREY){v=new Uint8Array(l.length/4);for(let b=0;b<l.length;b+=4)v[b/4]=.21*l[b]+.71*l[b+1]+.07*l[b+2]}else if(f===go.GREY32){v=g?new Uint8Array(l):l;for(let b=0;b<l.length;b+=4){const S=.21*l[b]+.71*l[b+1]+.07*l[b+2];v[b]=S,v[b+1]=S,v[b+2]=S}}else{if(!_.includes(f))throw new Error("Unable to transform.");if(g){v=new Uint8Array(l);const b=u.indexOf("r"),S=u.indexOf("g"),I=u.indexOf("b"),k=f.indexOf("r"),O=f.indexOf("g"),j=f.indexOf("b");for(let W=0;W<l.length;W+=4)v[W+k]=l[W+b],v[W+O]=l[W+S],v[W+j]=l[W+I]}else{v=l;const b=u.indexOf("r"),S=u.indexOf("g"),I=u.indexOf("b"),k=f.indexOf("r"),O=f.indexOf("g"),j=f.indexOf("b");for(let W=0;W<l.length;W+=4){let J=[l[W],l[W+1],l[W+2]];v[W+k]=J[b],v[W+O]=J[S],v[W+j]=J[I]}}}else if(u===go.GREY){if(f!==go.GREY32)throw new Error("Unable to transform.");v=new Uint8Array(4*l.length);for(let b=0;b<l.length;b++)v[4*b]=l[b],v[4*b+1]=l[b],v[4*b+2]=l[b],v[4*b+3]=255}else{if(u!==go.GREY32)throw new Error("Unable to transform.");if(f!==go.GREY)throw new Error("Unable to transform.");v=new Uint8Array(l.length/4);for(let b=0;b<l.length;b+=4)v[b/4]=l[b]}return ci._onLog&&ci._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),v}getImageData(l,u,f,g,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!u||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Ml(ci,np,"f",ip)&&ci.checkWebGLSupport(),(null==m?void 0:m.bUseWebGL)&&!Ml(ci,np,"f",ip))throw new Error("Your browser or machine may not support WebGL.");if(g.sx>u||g.sy>f||g.sx+g.sWidth>u||g.sy+g.sHeight>f)throw new Error("Invalid position.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let v;ci._onLog&&(v=Date.now(),ci._onLog("getImageData(), START: "+v));const _=Math.round(g.sx),b=Math.round(g.sy),S=Math.round(g.sWidth),I=Math.round(g.sHeight),k=Math.round(g.dWidth),O=Math.round(g.dHeight);let j=go.RGBA;(null==m?void 0:m.pixelFormat)&&(j=m.pixelFormat);let W,J,K,Q=null;if((null==m?void 0:m.bufferContainer)&&(Q=m.bufferContainer),Ml(ci,np,"f",ip)&&(this.useWebGLByDefault&&null==(null==m?void 0:m.bUseWebGL)||(null==m?void 0:m.bUseWebGL))){ci._onLog&&ci._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),W=this._reusedWebGLCvs;try{if(Q)if(j===go.GREY){if(K=new Uint8Array(4*k*O),J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:j,bUseWebGL:!0,bufferContainer:K}),K=this.transformPixelFormat(K,J.pixelFormat,j),Q){if(Q.length<K.length)throw new Error("Unexpected size of the 'bufferContainer'.");Q.set(K)}}else J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:j,bUseWebGL:!0,bufferContainer:Q}),K=new Uint8Array(Q.buffer,0,4*k*O),K=this.transformPixelFormat(K,J.pixelFormat,j);else j===go.GREY?((!Ml(this,Ky,"f")||Ml(this,Ky,"f").length<4*k*O)&&Bd(this,Ky,new Uint8Array(4*k*O),"f"),K=new Uint8Array(Ml(this,Ky,"f").buffer,0,4*k*O)):K=new Uint8Array(4*k*O),J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:j,bUseWebGL:!0,bufferContainer:K}),K=this.transformPixelFormat(K,J.pixelFormat,j)}catch(ie){if("WebGLError"===ie.name&&(this.forceLoseContext(),null==(null==m?void 0:m.bUseWebGL)))return ci._onLog&&ci._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},Object.assign({},m,{bUseWebGL:!1}));throw ie}}else if(ci._onLog&&ci._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),W=this._reusedCvs,J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:go.RGBA,bUseWebGL:!1}),K=this.readCvsData(J.context,{width:k,height:O},null),K=this.transformPixelFormat(K,J.pixelFormat,j),Q){if(Q.length<K.length)throw new Error("Unexpected size of the 'bufferContainer'.");Q.set(K)}return ci._onLog&&ci._onLog("getImageData() end. Costs: "+(Date.now()-v)),{data:K,pixelFormat:j,width:k,height:O,bUseWebGL:J.bUseWebGL}}convertDataToCvs(l,u,f,g){if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof u||u<=0)throw new Error("Invalid 'width'.");if("number"!=typeof f||f<=0)throw new Error("Invalid 'height'.");const m=document.createElement("canvas");let v;if(m.width=u,m.height=f,g===go.GREY){v=new Uint8ClampedArray(4*u*f);for(let b=0;b<v.length;b+=4)v[b]=l[b/4],v[b+1]=l[b/4],v[b+2]=l[b/4],v[b+3]=255}else v=new Uint8ClampedArray(l.buffer);const _=new ImageData(v,u,f);return m.getContext("2d").putImageData(_,0,0),m}forceLoseContext(){if(!this._reusedWebGLCvs)return;const l=this._reusedWebGLCvs.ctxWebGL;l&&!l.isContextLost()&&l.getExtension("WEBGL_lose_context")&&l.getExtension("WEBGL_lose_context").loseContext(),Bd(this,qy,null,"f"),Bd(this,ax,null,"f"),Bd(this,lx,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Bd(this,XI,!0,"f")}}np=ci,YI=new WeakMap,qy=new WeakMap,ax=new WeakMap,lx=new WeakMap,Ky=new WeakMap,XI=new WeakMap,ip={value:void 0};class Qy{static beep(){if(!this.beepSoundSource)return;let l;if(Me(this,Fu,"f",dx).size&&(l=Me(this,Fu,"f",dx).values().next().value,this.beepSoundSource==l.src?(Me(this,Fu,"f",dx).delete(l),l.play()):l=null),!l)if(Me(this,Fu,"f",hx).size<64){l=new Audio(this.beepSoundSource);let u=null,f=()=>{l.removeEventListener("loadedmetadata",f),l.play(),u=setTimeout(()=>{Me(this,Fu,"f",hx).delete(l)},2e3*l.duration)};l.addEventListener("loadedmetadata",f),l.addEventListener("ended",()=>{null!=u&&(clearTimeout(u),u=null),l.pause(),l.currentTime=0,Me(this,Fu,"f",hx).delete(l),Me(this,Fu,"f",dx).add(l)})}else Me(this,Fu,"f",WM)||(Pn(this,Fu,!0,"f",WM),console.warn("The requested audio tracks exceed 64 and will not be played."));l&&Me(this,Fu,"f",hx).add(l)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(Qy.vibrateDuration)}}Fu=Qy,sK={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"},WM={value:!1},dx={value:new Set},hx={value:new Set},Qy.beepSoundSource=Me(Qy,Fu,"f",sK),Qy.vibrateDuration=300;const lK="undefined"==typeof self,UM=(()=>{if(!lK&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),cK=p=>{if(null==p&&(p="./"),!lK){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p};null==wn.dbr&&(wn.dbr=UM),Mu.dbr={js:!1,wasm:!0,deps:["license","dip"]},no.dbr={};"string"!=typeof wn.std&&Mc(wn.std.version,"1.2.0")<0&&(wn.std={version:"1.2.0",path:cK(UM+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});const jM="2.2.10";var uK,dK,hK,fK;(!wn.dip||"string"!=typeof wn.dip&&Mc(wn.dip.version,jM)<0)&&(wn.dip={version:jM,path:cK(UM+`../../dynamsoft-image-processing@${jM}/dist/`)}),"function"==typeof BigInt&&(BigInt(0),BigInt(0x10000000000000000),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552)),function(p){p[p.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",p[p.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",p[p.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(uK||(uK={})),function(p){p[p.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",p[p.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",p[p.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",p[p.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(dK||(dK={})),function(p){p[p.LM_AUTO=1]="LM_AUTO",p[p.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",p[p.LM_STATISTICS=4]="LM_STATISTICS",p[p.LM_LINES=8]="LM_LINES",p[p.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",p[p.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",p[p.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",p[p.LM_CENTRE=128]="LM_CENTRE",p[p.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",p[p.LM_REV=-2147483648]="LM_REV",p[p.LM_SKIP=0]="LM_SKIP"}(hK||(hK={})),function(p){p[p.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",p[p.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",p[p.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",p[p.DM_SMOOTHING=8]="DM_SMOOTHING",p[p.DM_MORPHING=16]="DM_MORPHING",p[p.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",p[p.DM_SHARPENING=64]="DM_SHARPENING",p[p.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",p[p.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",p[p.DM_REV=-2147483648]="DM_REV",p[p.DM_SKIP=0]="DM_SKIP"}(fK||(fK={}));const gK="undefined"==typeof self,HM=(()=>{if(!gK&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),mK=p=>{if(null==p&&(p="./"),!gK){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p};null==wn.utility&&(wn.utility=HM),Mu.utility={js:!0,wasm:!0};const GM="1.2.10";"string"!=typeof wn.std&&Mc(wn.std.version,GM)<0&&(wn.std={version:GM,path:mK(HM+`../../dynamsoft-capture-vision-std@${GM}/dist/`)});const zM="2.2.30";(!wn.dip||"string"!=typeof wn.dip&&Mc(wn.dip.version,zM)<0)&&(wn.dip={version:zM,path:mK(HM+`../../dynamsoft-image-processing@${zM}/dist/`)});let Sg="./";if(document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}Sg=p.substring(0,p.lastIndexOf("/")+1)}const dv=p=>{null==p&&(p="./");let l=document.createElement("a");return l.href=p,(p=l.href).endsWith("/")||(p+="/"),p};Yr.engineResourcePaths={std:dv(Sg+"../../dynamsoft-capture-vision-std@1.2.10/dist/"),dip:dv(Sg+"../../dynamsoft-image-processing@2.2.30/dist/"),core:dv(Sg+"../../dynamsoft-core@3.2.30/dist/"),license:dv(Sg+"../../dynamsoft-license@3.2.21/dist/"),cvr:dv(Sg+"../../dynamsoft-capture-vision-router@2.2.30/dist/"),dce:dv(Sg+"../../dynamsoft-camera-enhancer@4.0.3/dist/"),dbr:dv(Sg+"../../dynamsoft-barcode-reader@10.2.10/dist/")};const vK="undefined"==typeof self,$M=(()=>{if(!vK&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),yK=p=>{if(null==p&&(p="./"),!vK){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p},qM=p=>{const l=document.createElement("canvas");return l.width=p.width,l.height=p.height,l.getContext("2d",{willReadFrequently:!0}).putImageData(p,0,0),l},_K=function(){var p=Fe(function*(l,u){const f=qM(u);return new Promise((g,m)=>{f.toBlob(v=>g(v),l)})});return function(u,f){return p.apply(this,arguments)}}();null==wn.ddn&&(wn.ddn=$M),Mu.ddn={js:!0,wasm:!0,deps:["license","dip"]},no.ddn={handleNormalizedImageResultItem:function(p){let l=p,u=(f=>{let g,m=f.bytes;if(!(m&&m instanceof Uint8Array))throw Error("Parameter type error");if(Number(f.format)===Hn.IPF_BGR_888){const v=m.length/3;g=new Uint8ClampedArray(4*v);for(let _=0;_<v;++_)g[4*_]=m[3*_],g[4*_+1]=m[3*_+1],g[4*_+2]=m[3*_+2],g[4*_+3]=255}else if(Number(f.format)===Hn.IPF_RGB_888){const v=m.length/3;g=new Uint8ClampedArray(4*v);for(let _=0;_<v;++_)g[4*_]=m[3*_+2],g[4*_+1]=m[3*_+1],g[4*_+2]=m[3*_],g[4*_+3]=255}else if(Number(f.format)===Hn.IPF_GRAYSCALED){const v=m.length;g=new Uint8ClampedArray(4*v);for(let _=0;_<v;_++)g[4*_]=g[4*_+1]=g[4*_+2]=m[_],g[4*_+3]=255}else if(Number(f.format)===Hn.IPF_BINARY_8){const v=m.length,_=f.width,S=f.stride;g=new Uint8ClampedArray(_*f.height*4);for(let I=0;I<v;I++){let k=m[I],O=I%S,j=Math.floor(I/S);for(let W=0;W<8;W++){let J=O+W,K=4*(j*_+J);if(J>=_)break;g[K]=g[K+1]=g[K+2]=(128&k)/128*255,g[K+3]=255,k<<=1}}}else if(Number(f.format)===Hn.IPF_ABGR_8888){const v=m.length/4;g=new Uint8ClampedArray(m.length);for(let _=0;_<v;++_)g[4*_]=m[4*_],g[4*_+1]=m[4*_+1],g[4*_+2]=m[4*_+2],g[4*_+3]=m[4*_+3]}else if(Number(f.format)===Hn.IPF_ARGB_8888){const v=m.length/4;g=new Uint8ClampedArray(m.length);for(let _=0;_<v;++_)g[4*_]=m[4*_],g[4*_+1]=m[4*_+1],g[4*_+2]=m[4*_+2],g[4*_+3]=m[4*_+3]}return new ImageData(g,f.width,f.height)})(l.imageData);l.toCanvas=()=>qM(u),l.toImage=f=>((g,m)=>{const v=qM(m);let _=new Image,b=v.toDataURL(g);return _.src=b,_})(f,u),l.toBlob=f=>_K(f,u),l.saveToFile=function(){var f=Fe(function*(g,m){if(!g)return null;if("string"!=typeof g)throw new TypeError("FileName must be of type string.");return(v=Fe(function*(_,b,S){return yield new Promise(function(){var I=Fe(function*(k,O){try{const j=b.split(".");let W=j[j.length-1];const J=yield _K(`image/${W}`,_);j.length<=1&&(W="png");const K=new File([J],b,{type:`image/${W}`});if(S){const Q=URL.createObjectURL(K),ie=document.createElement("a");ie.href=Q,ie.download=b,ie.click()}return k(K)}catch(j){return O()}});return function(k,O){return I.apply(this,arguments)}}())}),function(_,b,S){return v.apply(this,arguments)})(u,g,m);var v});return function(g,m){return f.apply(this,arguments)}}()}};"string"!=typeof wn.std&&Mc(wn.std.version,"1.2.0")<0&&(wn.std={version:"1.2.0",path:yK($M+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});const JM="2.2.10";var Oh;(!wn.dip||"string"!=typeof wn.dip&&Mc(wn.dip.version,JM)<0)&&(wn.dip={version:JM,path:yK($M+`../../dynamsoft-image-processing@${JM}/dist/`)}),function(p){p[p.ICM_COLOUR=0]="ICM_COLOUR",p[p.ICM_GRAYSCALE=1]="ICM_GRAYSCALE",p[p.ICM_BINARY=2]="ICM_BINARY"}(Oh||(Oh={}));const CK="undefined"==typeof self,fx=(()=>{if(!CK&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),px=p=>{if(null==p&&(p="./"),!CK){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p};null==wn.dlr&&(wn.dlr=fx),null==wn.dlrData&&(wn.dlrData=px(fx+"../../dynamsoft-label-recognizer-data@1.0.11/dist/")),Mu.dlr={js:!0,wasm:!0,deps:["license","dip","dnn"]},Mu.dnn={wasm:!0};const QM="1.2.10";"string"!=typeof wn.std&&Mc(wn.std.version,QM)<0&&(wn.std={version:QM,path:px(fx+`../../dynamsoft-capture-vision-std@${QM}/dist/`)});const ZM="2.2.30";(!wn.dip||"string"!=typeof wn.dip&&Mc(wn.dip.version,ZM)<0)&&(wn.dip={version:ZM,path:px(fx+`../../dynamsoft-image-processing@${ZM}/dist/`)});const eO="1.0.20";(!wn.dnn||"string"!=typeof wn.dnn&&Mc(wn.dnn.version,eO)<0)&&(wn.dnn={version:eO,path:px(fx+`../../dynamsoft-capture-vision-dnn@${eO}/dist/`)});let bK=!1;class gx{static getVersion(){return`3.2.30(Worker: ${Rl.dlr&&Rl.dlr.worker||"Not Loaded"}, Wasm: ${Rl.dlr&&Rl.dlr.wasm||"Not Loaded"})`}static loadRecognitionData(l,u){return Fe(function*(){return yield Oc("dlr"),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var _=Fe(function*(b){if(b.success){const S=b.result;if(0!==S.exception){let I=new Error(S.description);return I.errorCode=S.exception,g(I)}return S.bModel||(bK=!0),f(S)}{let S=new Error(b.message);return S.stack=b.stack+"\n"+S.stack,g(S)}});return function(b){return _.apply(this,arguments)}}(),u&&!u.endsWith("/")&&(u+="/"),u||"ConfusableChars"!==l||(u=Yr.engineResourcePaths.dlr);let v=Yr.engineResourcePaths.dlrData;Yr.engineResourcePaths.rootDirectory&&(v.startsWith("http://")||v.startsWith("https://")||(v=Yr.engineResourcePaths.rootDirectory+"/"+v)),Yr.engineResourcePaths.dlrData=px(v),ai.postMessage({type:"dlr_loadData",id:m,body:{dataName:l,dataPath:u||Yr.engineResourcePaths.dlrData}})})})()}}var QI,ZI;function xK(p){delete p.moduleId;const l=JSON.parse(p.jsonString).ResultInfo,u=p.fullCodeString;p.getFieldValue=f=>"fullcodestring"===f.toLowerCase()?u:wK(l,f),p.getFieldMappingStatus=f=>SK(l,f),p.getFieldValidationStatus=f=>TK(l,f),delete p.fullCodeString}function wK(p,l){for(let u of p){if(u.FieldName===l)return u.Value;if(u.ChildFields&&u.ChildFields.length>0){let f;for(let g of u.ChildFields)f=wK(g,l);if(null!==f)return f}}return null}function SK(p,l){for(let u of p){if(u.FieldName===l)return u.MappingStatus?Number(QI[u.MappingStatus]):QI.MS_NONE;if(u.ChildFields&&u.ChildFields.length>0){let f;for(let g of u.ChildFields)f=SK(g,l);if(null!==f)return f}}return null}function TK(p,l){for(let u of p){if(u.FieldName===l&&u.ValidationStatus)return u.ValidationStatus?Number(ZI[u.ValidationStatus]):ZI.VS_NONE;if(u.ChildFields&&u.ChildFields.length>0){let f;for(let g of u.ChildFields)f=TK(g,l);if(null!==f)return f}}return null}function eE(p){if(p.disposed)throw new Error('"CodeParser" instance has been disposed')}no.dlr={filterVINResult:function(p){let l="";if(18===p.characterResults.length){let u=p.characterResults[9].location.points[0].x-p.characterResults[8].location.points[1].x;u<2&&(u=2);let f=p.characterResults[1].location.points[0].x-p.characterResults[0].location.points[1].x,g=p.characterResults[17].location.points[0].x-p.characterResults[16].location.points[1].x,m=2===u?3:u;f-u>=m&&g-u<m?p.characterResults.shift():g-u>=m&&f-u<m||p.characterResults[0].characterHConfidence>p.characterResults[17].characterHConfidence?p.characterResults.pop():p.characterResults.shift()}else if(19===p.characterResults.length){let u=p.characterResults[10].location.points[0].x-p.characterResults[9].location.points[1].x;u<2&&(u=2);let f,g,m,v=p.characterResults[1].location.points[0].x-p.characterResults[0].location.points[1].x,_=p.characterResults[18].location.points[0].x-p.characterResults[17].location.points[1].x,b=p.characterResults[2].location.points[0].x-p.characterResults[1].location.points[1].x,S=p.characterResults[17].location.points[0].x-p.characterResults[16].location.points[1].x,I=2===u?3:u;if("1"===p.characterResults[1].characterH||"1"===p.characterResults[2].characterH||"1"===p.characterResults[16].characterH||"1"===p.characterResults[17].characterH){for(let k=9;k<p.characterResults.length;k++)if("1"!==p.characterResults[k].characterH){m=p.characterResults[k].location.points[1].x-p.characterResults[k].location.points[0].x;break}"1"===p.characterResults[1].characterH&&(f=m-(p.characterResults[1].location.points[1].x-p.characterResults[1].location.points[0].x)+3),"1"===p.characterResults[2].characterH&&(f=m-(p.characterResults[2].location.points[1].x-p.characterResults[2].location.points[0].x)+3),"1"===p.characterResults[16].characterH&&(g=m-(p.characterResults[16].location.points[1].x-p.characterResults[16].location.points[0].x)+3),"1"===p.characterResults[17].characterH&&(g=m-(p.characterResults[17].location.points[1].x-p.characterResults[17].location.points[0].x)+3)}if(b-u>=(f||I)&&S-u<(g||I))p.characterResults.splice(0,2);else if(S-u>=(g||I)&&b-u<(f||I))p.characterResults.splice(17,2);else if(v>u&&_>u)p.characterResults.pop(),p.characterResults.shift();else{let k=p.characterResults[0].characterHConfidence+p.characterResults[1].characterHConfidence,O=p.characterResults[17].characterHConfidence+p.characterResults[18].characterHConfidence,j=p.characterResults[0].characterHConfidence+p.characterResults[18].characterHConfidence,W=Math.min(k,O,j);W===k?p.characterResults.splice(0,2):W===O?p.characterResults.splice(17,2):W===j&&(p.characterResults.pop(),p.characterResults.shift())}}for(let u of p.characterResults)l+=u.characterH;return l},loadRecognitionData:gx.loadRecognitionData,get bLoadConfusableCharsData(){return bK}},Ii[-1]=function(){var p=Fe(function*(l){gx.onDataLoadProgressChanged&&gx.onDataLoadProgressChanged(l.resourcesPath,l.tag,{loaded:l.loaded,total:l.total})});return function(l){return p.apply(this,arguments)}}(),function(p){p[p.MS_NONE=0]="MS_NONE",p[p.MS_SUCCEEDED=1]="MS_SUCCEEDED",p[p.MS_FAILED=2]="MS_FAILED"}(QI||(QI={})),function(p){p[p.VS_NONE=0]="VS_NONE",p[p.VS_SUCCEEDED=1]="VS_SUCCEEDED",p[p.VS_FAILED=2]="VS_FAILED"}(ZI||(ZI={}));const IK=p=>p&&"object"==typeof p&&"function"==typeof p.then;class AIe extends Promise{constructor(l){let u,f;super((g,m)=>{u=g,f=m}),this._s="pending",this.resolve=g=>{this.isPending&&(IK(g)?this.task=g:(this._s="fulfilled",u(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let f;this._task=l,IK(l)?f=l:"function"==typeof l&&(f=new Promise(l)),f&&Fe(function*(){try{const g=yield f;l===u._task&&u.resolve(g)}catch(g){l===u._task&&u.reject(g)}})()}get isEmpty(){return null==this._task}}class tE{constructor(){this._instanceID=void 0,this.bDestroyed=!1}static createInstance(){return Fe(function*(){if(!no.license)throw Error("Module `license` is not existed.");yield no.license.dynamsoft(),yield Oc("dcp");const l=new tE,u=new AIe;let f=fr();return Ii[f]=function(){var g=Fe(function*(m){if(m.success)l._instanceID=m.instanceID,u.resolve(l);else{const v=Error(m.message);m.stack&&(v.stack=m.stack),u.reject(v)}});return function(m){return g.apply(this,arguments)}}(),ai.postMessage({type:"dcp_createInstance",id:f}),u})()}dispose(){var l=this;return Fe(function*(){eE(l);let u=fr();l.bDestroyed=!0,Ii[u]=f=>{if(!f.success){let g=new Error(f.message);throw g.stack=f.stack+"\n"+g.stack,g}},ai.postMessage({type:"dcp_dispose",id:u,instanceID:l._instanceID})})()}get disposed(){return this.bDestroyed}initSettings(l){var u=this;return Fe(function*(){return eE(u),l&&["string","object"].includes(typeof l)?("string"==typeof l&&function eIe(p){return/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(p)}(l)&&(l=yield $4(l,"text")),"object"==typeof l&&(l=JSON.stringify(l)),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var v=Fe(function*(_){if(_.success){const b=JSON.parse(_.response);if(0!==b.exception){let S=new Error(b.description?b.description:"Init Settings Failed.");return S.errorCode=b.exception,g(S)}return f(b)}{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,g(b)}});return function(_){return v.apply(this,arguments)}}(),ai.postMessage({type:"dcp_initSettings",id:m,instanceID:u._instanceID,body:{settings:l}})})):console.error("Invalid settings.")})()}resetSettings(){var l=this;return Fe(function*(){return eE(l),yield new Promise((u,f)=>{let g=fr();Ii[g]=function(){var m=Fe(function*(v){if(v.success)return u();{let _=new Error(v.message);return _.stack=v.stack+"\n"+_.stack,f(_)}});return function(v){return m.apply(this,arguments)}}(),ai.postMessage({type:"dcp_resetSettings",id:g,instanceID:l._instanceID})})})()}parse(l,u=""){var f=this;return Fe(function*(){if(eE(f),!l||!(l instanceof Array||l instanceof Uint8Array||"string"==typeof l))throw new Error("`parse` must pass in an Array or Uint8Array or string");return yield new Promise((g,m)=>{let v=fr();l instanceof Array&&(l=Uint8Array.from(l)),"string"==typeof l&&(l=Uint8Array.from(function(_){let b=[];for(let S=0;S<_.length;++S)b.push(_.charCodeAt(S));return b}(l))),Ii[v]=function(){var _=Fe(function*(b){if(b.success){let S=JSON.parse(b.parseResponse);return S.exception?m(new Error(S.description)):(xK(S),g(S))}{let S=new Error(b.message);return S.stack=b.stack+"\n"+S.stack,m(S)}});return function(b){return _.apply(this,arguments)}}(),ai.postMessage({type:"dcp_parse",id:v,instanceID:f._instanceID,body:{source:l,taskSettingName:u}})})})()}}const EK="undefined"==typeof self,DK=(()=>{if(!EK&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})();null==wn.dcp&&(wn.dcp=DK),Mu.dcp={js:!0,wasm:!0,deps:["license"]},no.dcp={handleParsedResultItem:xK};"string"!=typeof wn.std&&Mc(wn.std.version,"1.2.0")<0&&(wn.std={version:"1.2.0",path:(p=>{if(null==p&&(p="./"),!EK){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p})(DK+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});class Lu{static getVersion(){return`2.2.10(Worker: ${Rl.dcp&&Rl.dcp.worker||"Not Loaded"}, Wasm: ${Rl.dcp&&Rl.dcp.wasm||"Not Loaded"})`}static loadSpec(l,u){return Fe(function*(){return yield Oc("dcp"),yield new Promise((f,g)=>{let m=fr();Ii[m]=function(){var _=Fe(function*(b){if(b.success)return f();{let S=new Error(b.message);return S.stack=b.stack+"\n"+S.stack,g(S)}});return function(b){return _.apply(this,arguments)}}(),u&&!u.endsWith("/")&&(u+="/"),ai.postMessage({type:"dcp_appendResourceBuffer",id:m,body:{specificationPath:u||Yr.engineResourcePaths.dcp+"specification/",specificationNames:l instanceof Array?l:[l]}})})})()}}function AK(p){const l={};let u=p.getFieldValue("documentCode");l["Document Type"]=JSON.parse(p.jsonString).CodeType;let f=p.getFieldValue("issuingState");l["Issuing State"]=f;let g=p.getFieldValue("primaryIdentifier");l.Surname=g;let m=p.getFieldValue("secondaryIdentifier");l["Given Name"]=m;let v=p.getFieldValue("P"===u?"passportNumber":"documentNumber");l["Passport Number"]=v;let _=p.getFieldValue("nationality");l.Nationality=_;let b=p.getFieldValue("sex");l.Gender=b;let S=p.getFieldValue("birthYear"),I=p.getFieldValue("birthMonth"),k=p.getFieldValue("birthDay");S=parseInt(S)>(new Date).getFullYear()%100?"19"+S:"20"+S,l["Date of Birth (YYYY-MM-DD)"]=S+"-"+I+"-"+k;let O=p.getFieldValue("expiryYear"),j=p.getFieldValue("expiryMonth"),W=p.getFieldValue("expiryDay");return O=parseInt(O)>=60?"19"+O:"20"+O,l["Date of Expiry (YYYY-MM-DD)"]=O+"-"+j+"-"+W,l}function jc(p){return`${window.location.protocol}//${window.location.host}${window.location.pathname}${p}`}function at(p,l,u){if("function"==typeof p?p===l:p.has(l))return arguments.length<3?l:u;throw new TypeError("Private element is not present on this object")}function PK(p,l){if(l.has(p))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Ye(p,l){return p.get(at(p,l))}function bi(p,l,u){PK(p,l),l.set(p,u)}function Bn(p,l,u){return p.set(at(p,l),u),u}function Fh(p,l,u){return u(at(p,l))}function al(p,l){PK(p,l),l.add(p)}function N(p,l,u){return(l="symbol"==typeof(g=function(m,v){if("object"!=typeof m||!m)return m;var _=m[Symbol.toPrimitive];if(void 0!==_){var b=_.call(m,"string");if("object"!=typeof b)return b;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(m)}(l))?g:g+"")in p?Object.defineProperty(p,l,{value:u,enumerable:!0,configurable:!0,writable:!0}):p[l]=u,p;var g}function fn(p,l,u,f){return new(u||(u=Promise))(function(g,m){function v(S){try{b(f.next(S))}catch(I){m(I)}}function _(S){try{b(f.throw(S))}catch(I){m(I)}}function b(S){var I;S.done?g(S.value):(I=S.value,I instanceof u?I:new u(function(k){k(I)})).then(v,_)}b((f=f.apply(p,l||[])).next())})}function Ne(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function Mt(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}var wr,Oo,wo,nO,rp,Nu,Hc,aa,RK,Wd,nE,mx,iE,Yt,rE,iO,oE,sE,rO,aE,lE,kK,hv,e_,_a,oO,sO,Bu,fv,cE,t_,uE,dE,n_,i_,r_,hE,oc,MK,OK,Ud,fE,Ma,o_,Lh,pv,FK,LK,Tg,pE,Ig,Vd,vx,gE,mE,vE,gv,NK,BK,aO,WK,lO,cO,hs,ll,yx,Es,s_,UK,_x,yE,Wu,a_,uO,dO,VK,jK,HK,GK,zK,hO,YK,XK,$K,Cx,qK,KK,Oa,fO,pO,Gc,l_,Fa,kr,_E,c_,bx,gO,mO,vO,CE,zc,op,xx,wx,Sx,bE,xE,JK,u_,wE,yO,_O,QK,ZK,eJ,SE,CO,bO,d_,tJ,Eg,Dg,TE,xO,mv,Tx,IE,nJ,Uu,vv,h_,yv,Ix,iJ,Ex,rJ,oJ,Ag,EE,sp,_v,Cv,sJ,aJ,lJ,cJ,uJ,an,f_,Pg,mo,vo,p_,ap,lp,wO,dJ,hJ,fJ;"function"==typeof SuppressedError&&SuppressedError,function(p){p.logInfo="logInfo",p.logDebug="logDebug",p.logAll="logAll",p.imgIO="imgIO",p.core="imgCore",p.imgProc="imgProc",p.pdfR="pdfReader",p.pdfW="pdfWriter",p.crypto="crypto",p.binaryBlobType="application/octet-stream",p.wasmExtension=".wasm"}(wr||(wr={})),function(p){p.core="ddv-core",p.reader="ddv-reader",p.detector="ddv-detector",p.loader="ddv-loader"}(Oo||(Oo={})),function(p){p.pending="pending",p.ready="ready",p.failed="failed",p.destroyed="destroyed",p.init="init"}(wo||(wo={})),function(p){p.PARAMETER_TYPE_ERROR="Parameter Type not Supported = ",p.TIMEOUT="Timeout no Response = ",p.FILE_STREAM_ERROR="File Stream Error = ",p.WASM_EXCEPTION_ERROR="An WASM exception occurred."}(nO||(nO={})),function(p){p[p.LONG_KEY=0]="LONG_KEY",p[p.DLS_KEY=1]="DLS_KEY"}(rp||(rp={})),function(p){p[p.wasmSucceed=0]="wasmSucceed",p[p.wasmBase=-4e3]="wasmBase",p[p.wasmException=-4001]="wasmException",p[p.wasmNoModule=-4002]="wasmNoModule",p[p.wasmJsBase=-4100]="wasmJsBase",p[p.wasmJsObjectNotInit=-4101]="wasmJsObjectNotInit",p[p.wasmJsObjectTerminated=-4102]="wasmJsObjectTerminated",p[p.wasmJsObjectInitFailed=-4103]="wasmJsObjectInitFailed",p[p.wasmJsNotLoaded=-4104]="wasmJsNotLoaded",p[p.wasmJsInvalidJson=-4105]="wasmJsInvalidJson",p[p.wasmJsWorkerRunException=-4106]="wasmJsWorkerRunException",p[p.wasmJsWorkerRunFailed=-4107]="wasmJsWorkerRunFailed",p[p.wasmJsReadFileFailed=-4108]="wasmJsReadFileFailed",p[p.wasmJsCoreTaskException=-4109]="wasmJsCoreTaskException",p[p.wasmJsProcTaskException=-4110]="wasmJsProcTaskException",p[p.wasmJsSavePdfFailed=-4111]="wasmJsSavePdfFailed",p[p.wasmJsSaveTiffFailed=-4112]="wasmJsSaveTiffFailed"}(Nu||(Nu={})),function(p){p[p.IT_DIB=-1]="IT_DIB",p[p.IT_RGBA=-2]="IT_RGBA",p[p.IT_BGRA=-3]="IT_BGRA",p[p.IT_BMP=0]="IT_BMP",p[p.IT_JPG=1]="IT_JPG",p[p.IT_PNG=3]="IT_PNG",p[p.IT_ALL=5]="IT_ALL"}(Hc||(Hc={})),function(p){p[p.RT_AUTO=-1]="RT_AUTO",p[p.RT_BINARY=1]="RT_BINARY",p[p.RT_BASE64=2]="RT_BASE64"}(aa||(aa={})),function(p){p[p.SF_DEF=0]="SF_DEF",p[p.SF_ENABLE=1]="SF_ENABLE",p[p.SF_DISABLE=2]="SF_DISABLE"}(RK||(RK={})),function(p){p.imgIOVer="2.0.0",p.coreVer="2.0.0",p.imgProcVer="2.0.0",p.pdfRVer="2.0.0",p.pdfWVer="2.0.0",p.cryptoVer="2.0.0"}(oc||(oc={}));class On{static setLogFunc(l,u,f){Mt(this,Wd,l,"f",nE),Mt(this,Wd,u,"f",mx),Mt(this,Wd,f,"f",iE)}static get level(){return Ne(this,Wd,"f",nE)}static get func(){return Ne(this,Wd,"f",mx)}static get context(){return Ne(this,Wd,"f",iE)}static logAll(l){this.log(wr.logAll,l)}static logD(l){this.log(wr.logDebug,l)}static log(l,u){Ne(this,Wd,"f",mx)&&Ne(this,Wd,"f",nE)===l&&Ne(this,Wd,"f",mx).call(this,u,Ne(this,Wd,"f",iE))}}Wd=On,nE={value:""},mx={value:void 0},iE={value:null};class vn{static unload(){Mt(this,Yt,"","f",rE),Mt(this,Yt,"","f",oE),Mt(this,Yt,null,"f",sE),Mt(this,Yt,{name:wr.imgIO,workerName:Oo.core,autoLoad:!1,ver:oc.imgIOVer,prefixName:vn.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:Ne(vn,Yt,"f",Bu)},"f",uE),Mt(this,Yt,{name:wr.crypto,workerName:Oo.core,autoLoad:!1,ver:oc.cryptoVer,prefixName:vn.CryptoPrefixName,dependencyModules:[wr.imgIO],fetchOptions:Ne(vn,Yt,"f",Bu)},"f",dE),Mt(this,Yt,{name:wr.pdfR,workerName:Oo.reader,autoLoad:!1,ver:oc.pdfRVer,prefixName:vn.PdfReaderPrefixName,dependencyModules:[wr.imgIO,wr.core],fetchOptions:Ne(vn,Yt,"f",Bu)},"f",n_),Mt(this,Yt,{name:wr.core,workerName:Oo.core,autoLoad:!1,ver:oc.coreVer,prefixName:vn.ImagecorePrefixName,dependencyModules:[wr.imgIO],fetchOptions:Ne(vn,Yt,"f",Bu)},"f",i_),Mt(this,Yt,{name:wr.imgProc,workerName:Oo.core,autoLoad:!1,ver:oc.imgProcVer,prefixName:vn.ImageProcPrefixName,dependencyModules:[wr.imgIO,wr.core],useSimd:vn.UseSimd},"f",r_),On.setLogFunc("",void 0,null)}static get UseSimd(){return Ne(this,Yt,"f",aE)}static set UseSimd(l){Mt(this,Yt,l,"f",aE)}static get License(){return Ne(this,Yt,"f",rE)}static set License(l){Mt(this,Yt,l,"f",rE)}static get LicMode(){return Ne(this,Yt,"f",iO)}static set LicMode(l){Mt(this,Yt,l,"f",iO),Ne(this,Yt,"m",kK).call(this)}static get UUID(){return Ne(this,Yt,"f",oE)}static set UUID(l){Mt(this,Yt,l,"f",oE)}static get NavInfo(){return Ne(this,Yt,"f",sE)}static set NavInfo(l){Mt(this,Yt,l,"f",sE)}static get Mobile(){return Ne(this,Yt,"f",rO)}static set Mobile(l){Mt(this,Yt,l,"f",rO)}static get DefHeapSize(){return Ne(this,Yt,"f",hv)}static set DefHeapSize(l){Mt(this,Yt,l,"f",hv)}static get MaxHeapSize(){return Ne(this,Yt,"f",e_)}static get HeapConfig(){return Ne(this,Yt,"m",oO).call(this),Object.assign({},Ne(this,Yt,"f",_a))}static getWorkerHeap(l){return void 0!==Ne(this,Yt,"f",_a)[l]?Ne(this,Yt,"f",_a)[l]:{maxHeapSize:Ne(this,Yt,"f",e_),initHeapSize:Ne(this,Yt,"f",hv)}}static UpdateHeapConfig(l,u,f){Ne(this,Yt,"m",oO).call(this),u&&void 0!==Ne(this,Yt,"f",_a)[l]&&(Ne(this,Yt,"f",_a)[l].maxHeapSize=u),f&&void 0!==Ne(this,Yt,"f",_a)[l]&&(Ne(this,Yt,"f",_a)[l].initHeapSize=f)}static get ImageIOWorkerJS(){return"ddv-imageio.worker.js?v="+oc.imgIOVer}static get PdfReaderWorkerJS(){return"dynamsoft.pdfReader_wasm-"+oc.pdfRVer+".js"}static get ImageIOPrefixName(){return"ddv-imageio"}static get ImagecorePrefixName(){return"ddv-imagecore"}static get ImageProcPrefixName(){return"ddv-imageproc"}static get PdfReaderPrefixName(){return"ddv-pdfreader"}static get CryptoPrefixName(){return"ddv-crypto"}static get ImageIOResource(){return Ne(this,Yt,"f",fv)}static set ImageIOResource(l){Mt(this,Yt,Ne(this,Yt,"m",sO).call(this,l),"f",fv),Ne(this,Yt,"m",t_).call(this,Ne(this,Yt,"f",fv),Ne(this,Yt,"f",uE)),Ne(this,Yt,"m",t_).call(this,Ne(this,Yt,"f",fv),Ne(this,Yt,"f",dE)),Ne(this,Yt,"m",t_).call(this,Ne(this,Yt,"f",fv),Ne(this,Yt,"f",i_)),Ne(this,Yt,"m",t_).call(this,Ne(this,Yt,"f",fv),Ne(this,Yt,"f",r_))}static get PdfReaderResource(){return Ne(this,Yt,"f",cE)}static set PdfReaderResource(l){l.useFastCompEdition=!1,Mt(this,Yt,Ne(this,Yt,"m",sO).call(this,l),"f",cE),Ne(this,Yt,"m",t_).call(this,Ne(this,Yt,"f",cE),Ne(this,Yt,"f",n_)),this.PdfReaderModule.singleInstance=!0}static get ImageIOModule(){return Ne(this,Yt,"f",uE)}static get CryptoModule(){return Ne(this,Yt,"f",dE)}static get PdfReaderModule(){return Ne(this,Yt,"f",n_)}static get ImagecoreModule(){return Ne(this,Yt,"f",i_)}static get ImageReadereModule(){const l=Object.assign({},Ne(this,Yt,"f",i_));return l.workerName=Oo.reader,l}static get ImageProcModule(){return Ne(this,Yt,"f",r_)}static get DetectorModule(){return Mt(this,Yt,Object.assign({},Ne(this,Yt,"f",r_)),"f",hE),Ne(this,Yt,"f",hE).workerName=Oo.detector,Ne(this,Yt,"f",hE)}static get PdfWriterModule(){const l=Object.assign({},Ne(this,Yt,"f",n_));return l.workerName=Oo.core,l}static setLogFunc(l,u,f){On.setLogFunc(l,u,f)}}Yt=vn,lE=function(p){this.LicMode==rp.DLS_KEY&&p.dependencyModules&&-1!=p.dependencyModules.indexOf(wr.imgIO)&&-1==p.dependencyModules.indexOf(wr.crypto)&&p.dependencyModules.push(wr.crypto)},kK=function(){Ne(this,Yt,"m",lE).call(this,Ne(this,Yt,"f",i_)),Ne(this,Yt,"m",lE).call(this,Ne(this,Yt,"f",r_)),Ne(this,Yt,"m",lE).call(this,Ne(this,Yt,"f",n_))},oO=function(){0===Object.keys(Ne(this,Yt,"f",_a)).length&&(Ne(this,Yt,"f",_a)[Oo.core]={},Ne(this,Yt,"f",_a)[Oo.core].maxHeapSize=Ne(this,Yt,"f",e_),Ne(this,Yt,"f",_a)[Oo.core].initHeapSize=Ne(this,Yt,"f",hv),Ne(this,Yt,"f",_a)[Oo.reader]={},Ne(this,Yt,"f",_a)[Oo.reader].maxHeapSize=Ne(this,Yt,"f",e_),Ne(this,Yt,"f",_a)[Oo.reader].initHeapSize=Ne(this,Yt,"f",hv),Ne(this,Yt,"f",_a)[Oo.detector]={},Ne(this,Yt,"f",_a)[Oo.detector].maxHeapSize=Ne(this,Yt,"f",e_),Ne(this,Yt,"f",_a)[Oo.detector].initHeapSize=Ne(this,Yt,"f",hv))},sO=function(p){var l,u,f;let g={crossScript:!1,resourceDir:p.resourceDir,workerScript:p.workerScript,useFastCompEdition:null!==(l=p.useFastCompEdition)&&void 0!==l&&l,useSimd:null!==(u=p.useSimd)&&void 0!==u?u:Ne(this,Yt,"f",aE),fetchOptions:null!==(f=p.fetchOptions)&&void 0!==f?f:Ne(this,Yt,"f",Bu)};return g.workerScript=p.resourceDir+p.workerScript,g.workerScript.startsWith("http://")||g.workerScript.startsWith("https://")?(g.resourceDir=p.resourceDir,g.workerScript.startsWith(location.origin)||(g.crossScript=!0)):p.resourceDir.startsWith("/")?null!=location.origin&&(g.resourceDir=location.origin+p.resourceDir):null!=location.href&&(g.resourceDir=location.href.substring(0,location.href.lastIndexOf("/")+1)+p.resourceDir),g.resourceDir.endsWith("/")||(g.resourceDir+="/"),p.useFastCompEdition&&(g.resourceDir+="fastcomp/",g.workerScript=g.resourceDir+p.workerScript),g},t_=function(p,l){l.resourceDir=p.resourceDir,l.crossScript=p.crossScript,l.useSimd=l.name===wr.imgProc&&p.useSimd,l.script=p.workerScript,l.fetchOptions=p.fetchOptions},rE={value:""},iO={value:rp.LONG_KEY},oE={value:""},sE={value:null},rO={value:!1},aE={value:!1},hv={value:32},e_={value:200},_a={value:Object.create(null)},fv={value:{resourceDir:"",workerScript:vn.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:Ne(vn,Yt,"f",Bu={value:{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}})}},cE={value:{resourceDir:"",workerScript:vn.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:Ne(vn,Yt,"f",Bu)}},uE={value:{name:wr.imgIO,workerName:Oo.core,autoLoad:!1,ver:oc.imgIOVer,prefixName:vn.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:Ne(vn,Yt,"f",Bu)}},dE={value:{name:wr.crypto,workerName:Oo.core,autoLoad:!1,ver:oc.cryptoVer,prefixName:vn.CryptoPrefixName,dependencyModules:[wr.imgIO],fetchOptions:Ne(vn,Yt,"f",Bu)}},n_={value:{name:wr.pdfR,workerName:Oo.reader,autoLoad:!1,ver:oc.pdfRVer,prefixName:vn.PdfReaderPrefixName,dependencyModules:[wr.imgIO,wr.core],fetchOptions:Ne(vn,Yt,"f",Bu)}},i_={value:{name:wr.core,workerName:Oo.core,autoLoad:!1,ver:oc.coreVer,prefixName:vn.ImagecorePrefixName,dependencyModules:[wr.imgIO],fetchOptions:Ne(vn,Yt,"f",Bu)}},r_={value:{name:wr.imgProc,workerName:Oo.core,autoLoad:!1,ver:oc.imgProcVer,prefixName:vn.ImageProcPrefixName,dependencyModules:[wr.imgIO,wr.core],useSimd:vn.UseSimd}},hE={value:void 0};class Rg{static read(l){return new Promise(function(u,f){let g=Object.prototype.toString.call(l);if("[object String]"===g){if(0===l.indexOf("blob:")||l.indexOf(".jpg")>0||l.indexOf(".jpeg")>0||l.indexOf(".png")>0||l.indexOf(".bmp")>0||l.indexOf(".dib")>0||l.indexOf(".pdf")>0||l.indexOf(".tiff")>0||l.indexOf(".tif")>0)return fetch(l,{mode:"cors"}).then(function(m){return m.arrayBuffer()}).then(function(m){return u(m)}).catch(function(m){return Promise.reject(m)});f("Error url: Can not read the file URL")}else if("[object Blob]"===g||"[object FileList]"===g||"[object File]"===g){let m=l;"[object FileList]"!==g&&"[object File]"!==g||(m=l[0]?l[0]:l),Ne(Rg,MK,"m",OK).call(Rg,m,u,f)}else"[object ArrayBuffer]"===g||"[object Uint8ClampedArray]"===g?u(l):f("Not support source type: "+g)})}}MK=Rg,OK=function(p,l,u){let f,g,m=0;try{f=new ArrayBuffer(p.size),g=new Uint8Array(f)}catch(v){u(v)}!function v(){const _=new FileReader;_.onload=function(I){var k;if(null===(k=null==I?void 0:I.target)||void 0===k?void 0:k.result){const O=I.target.result;g.set(new Uint8Array(O),m),m+=O.byteLength,m<p.size?v():l(f)}else u(I)},_.onerror=function(I){u(I)},_.onabort=function(I){u(I)};const b=Math.min(m+1048576,p.size),S=p.slice(m,b);_.readAsArrayBuffer(S)}()};class kIe{constructor(l,u,f,g,m,v){Ud.add(this),fE.set(this,void 0),Ma.set(this,void 0),o_.set(this,void 0),Lh.set(this,void 0),pv.set(this,void 0),FK.set(this,void 0),LK.set(this,void 0),Tg.set(this,void 0),pE.set(this,void 0),Ig.set(this,void 0),Vd.set(this,void 0),vx.set(this,void 0),gE.set(this,void 0),mE.set(this,0),vE.set(this,{}),gv.set(this,null),Mt(this,fE,l,"f"),Mt(this,pE,g,"f"),Mt(this,gE,f,"f"),Mt(this,o_,[],"f"),Mt(this,Lh,!1,"f"),Mt(this,pv,!1,"f"),Mt(this,mE,u,"f"),Mt(this,gv,Object.create(null),"f"),Ne(this,vE,"f").modulesInfo=[],Mt(this,Vd,Object.create(null),"f"),Mt(this,Tg,null,"f"),Mt(this,Ig,0,"f"),Mt(this,vx,0,"f"),Mt(this,Ma,Ne(this,Ud,"m",BK).call(this,Ne(this,fE,"f")),"f"),Ne(this,Ma,"f").on("message",Ne(this,Ud,"m",WK),this),Ne(this,Ma,"f").on("error",Ne(this,Ud,"m",aO),this),Ne(this,Ma,"f").on("exit",function(_,b,S){let I="Worker #terminated Unexpectedly\n";I+=" exitCode: `"+_+"`\n",I+=" signalCode: `"+b+"`\n",I+=" #script: `"+l+"`\n",Ne(S,Ud,"m",aO).call(S,new Error(I),S)},this)}get WorkerScript(){return Ne(this,pE,"f")}get id(){return Ne(this,mE,"f")}get Module(){return Ne(this,vE,"f")}get Instances(){return Ne(this,gv,"f")}get WorkerName(){return Ne(this,gE,"f")}execTask(l,u,f){f||((f={}).promise=new Promise(function(v,_){f.resolve=v,f.reject=_}));let g=Mt(this,vx,+Ne(this,vx,"f")+1,"f");Ne(this,Vd,"f")[g]={id:g,insId:u.insId,resolver:f,cost:u.cost},delete u.cost;let m={id:g,func:l,params:u};return On.logD("["+u.insId+"] "+l+" send"),Ne(this,pv,"f")?f.reject(new Error("Worker is #terminated")):Ne(this,Lh,"f")?f.reject(new Error("Worker is #terminating")):Ne(this,Ma,"f").wasmReady||Ne(this,Ma,"f").ready&&"loadWasm"===l?Ne(this,Ma,"f").send(m):Ne(this,o_,"f").push(m),f.promise}get memSize(){return Ne(this,Ig,"f")}get busy(){return this.howManyTasks>0}get howManyTasks(){return Object.keys(Ne(this,Vd,"f")).length}get alive(){return!Ne(this,Lh,"f")&&!Ne(this,pv,"f")}terminate(l,u){if(On.logD("["+this.id+"] worker terminate "+l),l&&Ne(this,Ud,"m",cO).call(this,"Worker has been #terminated"),"function"==typeof u&&Mt(this,Tg,u,"f"),this.busy)Mt(this,Lh,!0,"f");else{if(Ne(this,Ma,"f")){if("function"!=typeof Ne(this,Ma,"f").terminate)throw new Error("Failed to terminate worker");On.logD("["+this.id+"] will be terminated"),Ne(this,Ma,"f").terminate(),Mt(this,Ma,null,"f")}Mt(this,Lh,!1,"f"),Mt(this,pv,!0,"f"),Ne(this,Tg,"f")&&Ne(this,Tg,"f").call(this,this)}}hasInstance(l){if(l){const u=Ne(this,gv,"f")[l];if(u)return 0!=Object.keys(u).length}else{const u=Object.keys(Ne(this,gv,"f"));for(const f of u)if(0!=Object.keys(Ne(this,gv,"f")[f]).length)return!0}return!1}exceedMaxMemory(){const l=1024*vn.getWorkerHeap(this.WorkerName).maxHeapSize*1024;return!!(Ne(this,Ig,"f")&&Ne(this,Ig,"f")>l&&0!=l)&&(On.logD("[w-"+this.id+"] current memSize="+Ne(this,Ig,"f")+", max="+l),!0)}shouldBeFreed(){return!(!this.exceedMaxMemory()||this.hasInstance(void 0)||(On.logD("[w-"+this.id+"] try to terminate the worker"),this.terminate(),0))}}fE=new WeakMap,Ma=new WeakMap,o_=new WeakMap,Lh=new WeakMap,pv=new WeakMap,FK=new WeakMap,LK=new WeakMap,Tg=new WeakMap,pE=new WeakMap,Ig=new WeakMap,Vd=new WeakMap,vx=new WeakMap,gE=new WeakMap,mE=new WeakMap,vE=new WeakMap,gv=new WeakMap,Ud=new WeakSet,NK=function(p){let l=new Error(""),u=Object.keys(p);for(let f=0;f<u.length;f++)l[u[f]]=p[u[f]];return l},BK=function(p){if("function"!=typeof Worker&&"object"!=typeof Worker)throw new Error("Web Workers not supported");let l=new Worker(p,{name:this.WorkerName});return l.on=function(u,f,g){this.addEventListener(u,function(m){"exit"===u?f(m.data,"",g):f(m.data,g)})},l.send=function(u){if(null!=u&&null!=u.params&&null!=u.params.input){let f=Object.prototype.toString.call(u.params.input);if("[object Array]"===Object.prototype.toString.call(u.params.input)){if(f=Object.prototype.toString.call(u.params.input[0]),"[object ArrayBuffer]"===f||"[object Uint8ClampedArray]"===f||"[object Uint8Array]"===f)return void this.postMessage(u,[null!=u.params.input[0].buffer?u.params.input[0].buffer:u.params.input[0]])}else if("[object ArrayBuffer]"===f||"[object Uint8ClampedArray]"===f||"[object Uint8Array]"===f)return void this.postMessage(u,[null!=u.params.input.buffer?u.params.input.buffer:u.params.input])}this.postMessage(u)},l},aO=function(p,l){Mt(l,pv,!0,"f"),On.logD("[js]["+l.id+"] worker error "+JSON.stringify(p)),Ne(l,Lh,"f")&&Ne(l,Tg,"f")&&Ne(l,Tg,"f").call(l,l),Mt(l,Lh,!1,"f"),Ne(l,Ud,"m",cO).call(l)},WK=function(p,l){let u=p.id,f=Ne(l,Vd,"f")[u];if(p&&p.cost&&f&&f.cost){const g=f.cost;g.exec=p.cost;const m=Date.now();g.total=m-g.ctime,g.msgQueue=p.ctime-g.time;const v=m-p.time;delete g.time,delete g.ctime,p.cost=g,p.cost.receive=v,delete p.ctime,delete p.time}if(On.logD(p.log?p.log:p),"string"==typeof p&&"ready"===p)Ne(l,Ma,"f").ready=!0,setTimeout(()=>{Ne(l,Ud,"m",lO).call(l)},0);else if(!p.log){if("object"==typeof p){let g=p.result;"object"==typeof g?(null!=g.errorCode&&(g.code=g.errorCode,delete g.errorCode),null!=g.errorMessage&&(g.message=g.errorMessage,delete g.errorMessage)):"string"==typeof g&&(g=g.replace('"errorCode"','"code"'),g=g.replace("'errorCode'","'code'"),g=g.replace('"errorMessage"','"message"'),g=g.replace("'errorMessage'","'message'"),p.result=g),null!=p.memSize&&Mt(l,Ig,p.memSize,"f")}if(void 0!==f){const g=f.insId;delete Ne(l,Vd,"f")[u],On.logD("["+g+"] "+p.func+" received"),!0===Ne(l,Lh,"f")&&l.terminate(),"loadWasm"===p.func&&null!=p.result&&(Ne(l,Ma,"f").wasmReady=!0,setTimeout(()=>{Ne(l,Ud,"m",lO).call(l)},0)),p.error?f.resolver.reject(Ne(l,Ud,"m",NK).call(l,p.error)):p.result&&f.resolver.resolve(p.result)}}},lO=function(){this.alive&&(Ne(this,o_,"f").forEach(Ne(this,Ma,"f").send.bind(Ne(this,Ma,"f"))),Mt(this,o_,[],"f"))},cO=function(p){for(let l in Ne(this,Vd,"f"))void 0!==Ne(this,Vd,"f")[l]&&Ne(this,Vd,"f")[l].resolver.reject(new Error(p));Mt(this,Vd,Object.create(null),"f")};class yr{constructor(){hs.add(this),Es.set(this,[]),s_.set(this,4),UK.set(this,60),_x.set(this,!1),yE.set(this,0),a_.set(this,!1)}static get Instance(){return Ne(this,ll,"f",yx)||Mt(this,ll,new yr,"f",yx),Ne(this,ll,"f",yx)}get Terminated(){return Ne(this,_x,"f")}getModuleLoadedError(l){for(let u of Ne(yr,ll,"f",Wu))if(u.name==l)return u.error}getModuleStatus(l){for(let u of Ne(yr,ll,"f",Wu))if(u.name==l)return u.status;return""}addModules(l,u){let f=!1;if(Ne(yr,ll,"f",Wu).forEach(function(g,m,v){g.name==l.name&&(g.ver==l.ver?f=!0:v.splice(m,1))}),!f){let g=l;g.status=u||"",g.wasmModule=null,Ne(yr,ll,"f",Wu).push(g)}}loadModule(l,u){return fn(this,void 0,void 0,function*(){null==u&&(u=0!=Ne(this,hs,"m",hO).call(this,l).length),this.addModules(l);for(let v of l.dependencyModules)v===wr.imgIO?(this.addModules(vn.ImageIOModule,wo.pending),vn.LicMode===rp.DLS_KEY&&l.name!=wr.crypto&&this.addModules(vn.CryptoModule,wo.pending)):v===wr.core&&this.addModules(vn.ImagecoreModule,wo.pending);let f,g;for(let v of Ne(yr,ll,"f",Wu))if(v.name===l.name){if(v.status===wo.pending)return!1;if(v.wasmModule){if(u)return!0;f=v.wasmModule,g=v.wasmBinary;break}break}let m=null;if(f)m=l,m.wasmModule=f,m.wasmBinary=g,m.status=wo.pending;else if(m=l,""===m.status)m.status=wo.pending,m.wasmModule=null;else{if(m.status===wo.pending)return!1;u||(m.error={code:0,message:""},m.status=wo.pending)}return Ne(this,hs,"m",uO).call(this,m)})}get busy(){Ne(this,hs,"m",Cx).call(this);let l=Ne(this,Es,"f");for(let u of l)if(u.busy)return!0;return!1}getWorker(l,u){return fn(this,void 0,void 0,function*(){if(Ne(this,hs,"m",YK).call(this,l.name))return Ne(this,hs,"m",$K).call(this),{worker:null,workers:0};let f=Ne(this,hs,"m",hO).call(this,l,!0);return 0!=f.length?{worker:Ne(this,hs,"m",qK).call(this,f,u,l),workers:f.length}:(yield this.loadModule(l,!1),{worker:null,workers:0})})}removeInstanceInWorker(l,u,f,g){if(Ne(this,hs,"m",KK).call(this,u,l.name,f),g&&u&&u.shouldBeFreed()){let m=Ne(this,Es,"f").indexOf(u);-1!==m&&Ne(this,Es,"f").splice(m,1)}}terminate(l){Mt(yr,ll,null,"f",yx),On.logD("worker pool terminate "+l),Mt(this,_x,!0,"f");let u=[],f=Ne(this,Es,"f").slice();return Mt(this,Es,[],"f"),f.forEach(function(g){let m={};m.promise=new Promise(function(v,_){m.resolve=v,m.reject=_}),u.push(m.promise),g.terminate(l,function(v){m.resolve(v)})}),Promise.all(u)}static unload(){Mt(this,ll,new Array,"f",Wu)}terminateWorker(l){Ne(this,Es,"f").splice(0,Ne(this,Es,"f").length,...Ne(this,Es,"f").filter(u=>u.WorkerName!==l||(u.terminate(!0),!1)))}getMemoryUsed(){let l=Ne(this,Es,"f"),u=[],f=0;for(let g of l)g&&null!=g.memSize&&(u[f]={},u[f].size=g.memSize,u[f].limit=1024*vn.getWorkerHeap(g.WorkerName).maxHeapSize*1024,u[f].name=g.WorkerName,u[f].id=g.id,f+=1);return u}}ll=yr,Es=new WeakMap,s_=new WeakMap,UK=new WeakMap,_x=new WeakMap,yE=new WeakMap,a_=new WeakMap,hs=new WeakSet,uO=function(p){return fn(this,void 0,void 0,function*(){let l=this,u=yield Ne(this,hs,"m",GK).call(this,p);if(u){let f={id:0,func:"loadWasm",params:{insId:0,priority:0,module:{modulesInfo:[]},fetchOptions:p.fetchOptions}};if(f.params.resourceDir=p.resourceDir,f.params.initMemory=vn.getWorkerHeap(p.workerName).initHeapSize,f.params.module){for(let g of Ne(yr,ll,"f",Wu))for(let m of p.dependencyModules)m==g.name&&f.params.module.modulesInfo.push(g);f.params.module.modulesInfo.push(p)}yield Ne(this,hs,"m",VK).call(this,u,f),Mt(l,s_,Ne(l,hs,"m",HK).call(l),"f"),p.status===wo.pending&&(p.status="")}else p.status="",p.wasmModule=null})},dO=function(p,l,u,f){for(let g of Ne(yr,ll,"f",Wu))if(g.name===p){g.status=l,g.wasmModule=u.wasmModule,g.wasmBinary=u.wasmBinary,g.error=f;break}},VK=function(p,l,u){return fn(this,void 0,void 0,function*(){let f=this;try{const g=yield p.execTask(l.func,l.params);let m=!1;return void 0===g.code||g.modules?m=Ne(f,hs,"m",jK).call(f,g,p):On.logD(g),m}catch(g){return On.logD(g),!1}finally{u&&u()}})},jK=function(p,l){if(On.logD("handleWasmLoad:"),On.logD(p),Ne(this,_x,"f"))return l.terminate(),!1;if(("object"!=typeof p||null==p.modules)&&"object"==typeof p)return!1;let u=!1;for(const f of p.modules)p.code?(Ne(this,hs,"m",dO).call(this,f.name,wo.failed,null,{code:p.code,message:p.message}),l.Module.modulesInfo[f.name]=!1):(Ne(this,hs,"m",dO).call(this,f.name,wo.ready,f.wasmResource,void 0),l.Module.modulesInfo[f.name]=!0,u=!0);return u},HK=function(){let p=2;return"hardwareConcurrency"in self.navigator&&(p=self.navigator.hardwareConcurrency),Math.max(Math.min(Ne(this,s_,"f"),Math.max(Ne(this,s_,"f"),p/2)),1)},GK=function(p){return fn(this,void 0,void 0,function*(){Ne(this,hs,"m",Cx).call(this);let l=Ne(this,Es,"f");for(let u of l)if(u.WorkerName===p.workerName)return u.busy?null:u;return Ne(this,hs,"m",zK).call(this,p)})},zK=function(p){var l;return fn(this,void 0,void 0,function*(){let u=this,f=Ne(u,Es,"f");if(f.length<Ne(u,s_,"f")&&!Ne(u,a_,"f")){Mt(u,a_,!0,"f");let g=p.script;p.crossScript&&(g=yield class RIe{static fetchRetry(l,u,f,g){let m=u.retries,v=u.retryDelay;return new Promise(function(_,b){const S=function(I){return fetch(l,u).then(function(k){_(k)}).catch(function(k){var O;I<m?(O=I,f&&f(k,g),setTimeout(function(){S(++O)},v)):b(k)})};return S(0)})}}.fetchRetry(p.script,p.fetchOptions,On.func,u).then(v=>v.blob()).then(v=>URL.createObjectURL(v)).catch(v=>(On.logD("get new worker fetch failed: "),On.logD(v),Mt(u,a_,!1,"f"),null)));let m=new kIe(g,Mt(l=u,yE,+Ne(l,yE,"f")+1,"f"),p.workerName,p.script,On.func,On.context);return f.push(m),Mt(u,a_,!1,"f"),On.logAll(f),On.logD("[wl-"+Ne(u,Es,"f").length+"] got new worker w-"+m.id+"("+m.WorkerName+") succeed!"),m}return null})},hO=function(p,l){Ne(this,hs,"m",Cx).call(this);let u=Ne(this,Es,"f");On.logAll(u);let f=[];for(let g of u)if(g.Module.modulesInfo[p.name]){let m=!0;if(p.dependencyModules.forEach(v=>{g.Module.modulesInfo[v]||(m=!1)}),!m||l&&g.WorkerName!==p.workerName)continue;f.push(g)}return On.logAll("[wl-"+u.length+"] got workers for module "+p.name),On.logAll(f),f},YK=function(p){for(let l of Ne(yr,ll,"f",Wu))if(l.name===p&&l.status===wo.pending)return!0;return!1},XK=function(){return fn(this,void 0,void 0,function*(){this.terminate(!0);for(let p of Ne(yr,ll,"f",Wu))yield Ne(this,hs,"m",uO).call(this,p)})},$K=function(){Ne(this,hs,"m",Cx).call(this),0==Ne(this,Es,"f").length&&0!=Ne(yr,ll,"f",Wu).length&&(On.logD("no worker ready, reinit"),Ne(this,hs,"m",XK).call(this))},Cx=function(){Ne(this,Es,"f").splice(0,Ne(this,Es,"f").length,...Ne(this,Es,"f").filter(function(p){return p.alive}))},qK=function(p,l,u){On.logAll("[wl-"+Ne(this,Es,"f").length+"] getWorkerByIntanceId"),On.logAll(p);let f,g=9007199254740991;for(let m of p){if(u.singleInstance&&m.hasInstance(u.name))continue;const v=m.Instances[u.name];if(!v||null!=v[l]){f=m;break}{let _=m.howManyTasks;_<g&&(f=m,g=_)}}if(f){if(f.shouldBeFreed())return null;const m=f.Instances[u.name];if(m)m[l]="";else{const v=Object.create(null);v[l]="",f.Instances[u.name]=v}return On.logAll(p),On.logD("[wl-"+p.length+"]["+l+"] got worker w-"+f.id),f}return On.logAll("#getWorkerByIntanceId: no suitable worker"),null},KK=function(p,l,u){let f=Ne(this,Es,"f");On.logAll("removeInstanceInWorkerInner"),On.logAll(f);for(let g of f)if(g===p){const m=g.Instances[l];if(m){null!=m[u]?(delete m[u],On.logAll(f),On.logD("[w-"+g.id+"] removeInstanceInWorkerInner "+u+" in "+p.id+" succeed!")):On.logD("[w-"+g.id+"] not found instance "+u);break}}},yx={value:null},Wu={value:new Array};class Dx{constructor(l,u){var f,g,m,v;Oa.add(this),Gc.set(this,void 0),this._outputType=Hc.IT_JPG,this._inputType=Hc.IT_ALL,this._jpegQuality=80,l_.set(this,null!==(f=vn.License)&&void 0!==f?f:""),Fa.set(this,[]),kr.set(this,null),_E.set(this,0),c_.set(this,Mt(v=Dx,fO,+Ne(v,fO,"f",pO)+1,"f",pO)),bx.set(this,null),gO.set(this,JSON.parse(JSON.stringify(vn.NavInfo))),mO.set(this,vn.Mobile),vO.set(this,location.origin),CE.set(this,""),zc.set(this,wo.init),op.set(this,!1),xx.set(this,null!==(g=vn.LicMode)&&void 0!==g?g:rp.LONG_KEY),wx.set(this,null!==(m=vn.UUID)&&void 0!==m?m:""),Sx.set(this,0),bE.set(this,!1),xE.set(this,!1),this._handleBooleanResult=function(_,b){return!0},Mt(this,Gc,l,"f"),Mt(this,l_,null!=u?u:vn.License,"f")}_prepareModule(l){}get workerId(){return Ne(this,kr,"f")&&Ne(this,kr,"f").alive?Ne(this,kr,"f").id:0}get id(){return Ne(this,c_,"f")}hasTask(){return Ne(this,Fa,"f").length>0}_canTerminateWork(){return!1}_makeSureWorkerMemoryNotExceed(){return!(Ne(this,kr,"f")&&Ne(this,kr,"f").alive&&this._canTerminateWork()&&Ne(this,kr,"f").exceedMaxMemory()&&(On.logD(`[${this.id}] try to termiate worker [${Ne(this,kr,"f").id}]`),Ne(this,kr,"f").terminate(!0),Mt(this,kr,null,"f"),Mt(this,zc,wo.init,"f"),1))}_workerChanged(l){}_handleBasicResult(l,u){return delete l.code,delete l.message,l}_handleImageData(l,u){var f,g,m;if("object"==typeof l.imageData)if(null!=l.imageCount&&l.imageCount>1)for(let v=0;v<l.imageCount;v++)l.imageData[v]=Ne(f=u.context,Oa,"m",wE).call(f,l.imageData[v],l.blobType,u.params.returnBlob);else l.imageData=Ne(g=u.context,Oa,"m",wE).call(g,l.imageData,l.blobType,u.params.returnBlob);return"object"==typeof l.pdfData&&(l.pdfData=Ne(m=u.context,Oa,"m",wE).call(m,l.pdfData,l.blobType,u.params.returnBlob)),l}_handleResult(l,u){var f,g;let m=Ne(g=u.context,Oa,"m",yO).call(g,l);if(void 0===m.code||!m.code&&"Successful."===m.message)m=u.handleResult(m,u),setTimeout(()=>{var v;Ne(v=u.context,Oa,"m",u_).call(v)},0),(0,u.resolve)(m);else{let v={code:m.code,message:m.code===Nu.wasmException?nO.WASM_EXCEPTION_ERROR+"("+(null===(f=u.params)||void 0===f?void 0:f.moduleName)+":"+u.func+":"+m.message+")":m.message};u.context.terminated?u.resolve(v):u.reject(v)}}_execTask(l){let u=this,f=Ne(u,kr,"f");if(On.logAll(l),f)try{if(l.params.cost){const g=l.params.cost.time;l.params.cost.time=Date.now(),l.params.cost.taskQueue=l.params.cost.time-g}f.execTask(l.func,l.params).then(function(g){u._handleResult(Ne(u,Oa,"m",yO).call(u,g),l)}).catch(function(g){On.logD(g),setTimeout(()=>{Ne(u,Oa,"m",u_).call(u)},0);let m=g;"object"==typeof g&&null!=g.message&&(m=g.message);let v={code:Nu.wasmJsWorkerRunFailed,message:m};Ne(u,op,"f")?l.resolve(v):l.reject(v)})}catch(g){setTimeout(()=>{Ne(u,Oa,"m",u_).call(u)},0),On.logD(g);let m={code:Nu.wasmJsWorkerRunException,message:g.message,stack:g.stack};Ne(u,op,"f")?l.resolve(m):l.reject(m)}}_cancelAllTasks(l,u){for(let f of Ne(this,Fa,"f"))if(void 0!==f){let g={code:l,message:u};Ne(this,op,"f")?f.resolve(g):f.reject(g)}Mt(this,Fa,[],"f")}_createTask(l,u,f){let g={moduleName:Ne(this,Gc,"f").name,insId:Ne(this,c_,"f")},m={id:Mt(this,_E,+Ne(this,_E,"f")+1,"f"),func:l,params:g};return m.promise=new Promise(function(v,_){m.resolve=v,m.reject=_}),m.func=l,m.context=this,m.handleResult=void 0!==f&&f?f:this._handleBasicResult,m.params.input=void 0!==u&&u?u:"",m.params.returnType=aa.RT_AUTO,m.params.returnBlob=!0,m.params.logLevel=On.level,m.params.cost={},m.params.cost.ctime=Date.now(),m.params.cost.time=m.params.cost.ctime,m}_addTask(l,u){if(l.params.cost){const f=l.params.cost.time;l.params.cost.time=Date.now(),l.params.cost.create=l.params.cost.time-f}return Ne(this,zc,"f")===wo.destroyed?l.reject({code:Nu.wasmJsObjectNotInit,message:Ne(this,op,"f")?"object has been disposed":"object not init"}):Ne(this,zc,"f")===wo.failed?l.reject({code:Nu.wasmJsObjectInitFailed,message:Ne(this,CE,"f")}):(u?Ne(this,Fa,"f").unshift(l):Ne(this,Fa,"f").push(l),Ne(this,Oa,"m",u_).call(this)),l.promise}terminate(l){let u=this;Ne(u,bE,"f")?Mt(u,op,!0,"f"):(Mt(this,xE,!0,"f"),Ne(u,Oa,"m",QK).call(u).then(function(f){On.logD("["+u.id+"] "+Ne(u,Gc,"f").name+" destroy return: "),On.logD(f)}).catch(function(f){On.logD(Ne(u,Gc,"f").name+" destroy failed"),On.logD(f)}).finally(()=>{let f=yr.Instance;f&&f.removeInstanceInWorker(Ne(u,Gc,"f"),Ne(u,kr,"f"),Ne(u,c_,"f"),null==l||l),Mt(u,kr,null,"f"),Mt(u,op,!0,"f"),Mt(u,xE,!1,"f")})),Mt(u,zc,"","f")}_readFile(l){return Rg.read(l).catch(function(u){let f=u;return"object"!=typeof f&&(f={},f.code=Nu.wasmJsReadFileFailed,f.message=u),Promise.reject(f)})}updateLicense(l,u,f){return fn(this,void 0,void 0,function*(){Mt(this,l_,l,"f"),Mt(this,xx,null!=u?u:rp.LONG_KEY,"f"),Mt(this,wx,null!=f?f:"","f");let g=this,m=g._createTask("UpdateLicense");return m.params.input=[Ne(g,l_,"f"),Ne(g,xx,"f"),Ne(g,wx,"f")],g._addTask(m),m.promise})}}fO=Dx,Gc=new WeakMap,l_=new WeakMap,Fa=new WeakMap,kr=new WeakMap,_E=new WeakMap,c_=new WeakMap,bx=new WeakMap,gO=new WeakMap,mO=new WeakMap,vO=new WeakMap,CE=new WeakMap,zc=new WeakMap,op=new WeakMap,xx=new WeakMap,wx=new WeakMap,Sx=new WeakMap,bE=new WeakMap,xE=new WeakMap,Oa=new WeakSet,JK=function p(l){let u=null!=l?l:this;if(Ne(u,bx,"f")&&clearTimeout(Ne(u,bx,"f")),Ne(u,op,"f")&&On.logD(`[${u.id}"] has been termiated.(getWorker)`),Ne(u,kr,"f")&&Ne(u,kr,"f").alive)return Ne(u,kr,"f");let f=yr.Instance;f?f.getWorker(Ne(u,Gc,"f"),Ne(u,c_,"f")).then(g=>{if(Mt(u,kr,g.worker,"f"),Ne(u,kr,"f")&&Ne(u,kr,"f").alive)Ne(u,Sx,"f")!=Ne(u,kr,"f").id&&(0!==Ne(u,Sx,"f")&&u._workerChanged(Ne(u,kr,"f").id),Mt(u,Sx,Ne(u,kr,"f").id,"f")),Ne(u,Fa,"f").length>0&&setTimeout(()=>{Ne(u,Oa,"m",u_).call(u)},0);else{let m=f.getModuleLoadedError(Ne(u,Gc,"f").name);if(null==m?void 0:m.code)return u._cancelAllTasks(Nu.wasmJsNotLoaded,m.message),Ne(u,kr,"f");Ne(u,Fa,"f").length>0&&Mt(u,bx,setTimeout(Ne(u,Oa,"m",p),50,u),"f")}return Ne(u,kr,"f")}).catch(g=>Ne(u,kr,"f")):u._cancelAllTasks(Nu.wasmJsNotLoaded,"wasm env not loaded or unloaded")},u_=function(){if(On.logAll(Ne(this,Fa,"f")),Ne(this,zc,"f")!=wo.init)if(Ne(this,kr,"f")&&Ne(this,kr,"f").alive){if(Ne(this,Fa,"f").length>0){let p=Ne(this,Fa,"f")[0];Ne(this,zc,"f")!==wo.ready&&"init"!==p.func||(delete Ne(this,Fa,"f")[0],Ne(this,Fa,"f").splice(0,1),this._execTask(p))}}else{if(Ne(this,kr,"f")&&!Ne(this,kr,"f").alive&&Ne(this,Fa,"f").length>0&&"init"!=Ne(this,Fa,"f")[0].func)return Mt(this,kr,null,"f"),void Ne(this,Oa,"m",_O).call(this);Ne(this,Fa,"f").length>0&&Ne(this,Gc,"f").script&&Ne(this,Oa,"m",JK).call(this,this)}else Ne(this,Oa,"m",_O).call(this)},wE=function(p,l,u){if(u){let f;return f=null!=l?new Blob([p],{type:l}):new Blob([p]),f}return p},yO=function(p){try{return"string"==typeof p?JSON.parse(p):p}catch(l){return p}},_O=function(){let p=this;p._prepareModule(Ne(this,Gc,"f"));let l=this._createTask("init");l.params.key=Ne(this,l_,"f"),l.params.uuid=Ne(this,wx,"f"),l.params.licMode=Ne(this,xx,"f"),l.params.val={nv:Ne(this,gO,"f"),mb:Ne(this,mO,"f"),dm:Ne(this,vO,"f")},l.handleResult=function(u,f){return Mt(f.context,zc,wo.ready,"f"),u},Mt(this,zc,wo.pending,"f"),this._addTask(l,!0),l.promise.then(function(u){On.logD("["+p.id+"] "+Ne(p,Gc,"f").name+" init return: "),On.logD(u),Mt(p,bE,!1,"f")}).catch(function(u){Mt(p,zc,wo.failed,"f"),Mt(p,CE,u.message,"f"),On.logD(Ne(p,Gc,"f").name+" init failed"),On.logD(u),p._cancelAllTasks(Nu.wasmJsObjectInitFailed,u.message)})},QK=function(){if(Ne(this,zc,"f")==wo.pending||Ne(this,zc,"f")==wo.ready){let p=this._createTask("destroy",null,this._handleBooleanResult);return this._addTask(p),p.promise}return Promise.resolve(!0)},pO={value:0};class kg extends Dx{constructor(l,u){super(l,u)}_prepareModule(l){let u=yr.Instance;u.addModules(vn.ImageIOModule),vn.LicMode===rp.DLS_KEY&&u.addModules(vn.CryptoModule),Ne(kg,ZK,"m",eJ).call(kg,vn.ImageIOModule,l),u.addModules(l)}}ZK=kg,eJ=function(p,l){l.resourceDir=p.resourceDir,l.crossScript=p.crossScript,l.script=p.script,l.useSimd=p.useSimd,l.useSimd=l.name===wr.imgProc&&vn.UseSimd,l.fetchOptions=p.fetchOptions};class pJ extends kg{constructor(l){super(vn.ImagecoreModule,l),SE.add(this),CO.set(this,0)}getImageFormat(l){return fn(this,void 0,void 0,function*(){let u=this,f=u._createTask("GetImageFormat");const g=yield u._readFile(l);return f.params.input=g,u._addTask(f),f.promise})}readImageInfo(l){return fn(this,void 0,void 0,function*(){let u=this,f=u._createTask("ReadImageInfo");const g=yield u._readFile(l);return f.params.input=g,u._addTask(f),f.promise})}getMD5(l){return fn(this,void 0,void 0,function*(){let u=this,f=u._createTask("GetMD5");const g=yield u._readFile(l);return f.params.input=g,f.handleResult=function(m,v){return m.MD5},u._addTask(f),f.promise})}getLicenseInfo(){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("GetLicenseInfo"))})}getAesResult(l){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("GetAesResult",[l=null!=l?l:""]))})}saveImage(l,u,f,g,m){return fn(this,void 0,void 0,function*(){return(m=null!=m&&m)?Ne(this,SE,"m",bO).call(this,l,void 0,void 0,void 0,1,void 0,void 0,u,f,g):Ne(this,SE,"m",bO).call(this,l,void 0,void 0,void 0,void 0,void 0,void 0,u,f,g)})}readImage(l,u,f,g,m){return fn(this,void 0,void 0,function*(){u=null!=u?u:this._outputType,f=null!=f?f:this._jpegQuality,g=null!=g&&g,m=null!=m&&m;let v=this,_=v._createTask("ReadImage");const b=yield v._readFile(l);_.params.input=[b,u,f,m],_.params.returnType=g?aa.RT_BASE64:aa.RT_AUTO,_.params.returnBlob=!g,_.handleResult=v._handleImageData,v._addTask(_);const S=yield _.promise;if(S.srcBuffer){let I=Object.prototype.toString.call(l);"[object ArrayBuffer]"!=I&&"[object Uint8ClampedArray]"!=I&&delete S.srcBuffer}return S})}openTiff(l,u){return fn(this,void 0,void 0,function*(){let f=this,g=f._createTask("LoadTiff");u=null!=u&&u;const m=yield f._readFile(l);g.params.input=[m,u],f._addTask(g);const v=yield g.promise;if(v.srcBuffer){let _=Object.prototype.toString.call(l);"[object ArrayBuffer]"!=_&&"[object Uint8ClampedArray]"!=_&&delete v.srcBuffer}return v})}readTiff(l,u,f,g){l=null!=l?l:0,u=null!=u?u:this._outputType,f=null!=f&&f,g=null!=g&&g;let m=this._createTask("ReadTiffPage");return m.params.input=[l,u,g],m.params.returnType=f?aa.RT_BASE64:aa.RT_AUTO,m.params.returnBlob=!f,m.handleResult=this._handleImageData,this._addTask(m)}readTiffInfos(l){let u=this._createTask("GetTiffPageInfos");return u.params.input=[l],this._addTask(u)}closeTiff(){return this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))}createTiff(){return this._addTask(this._createTask("NewTiff",null,this._handleBooleanResult))}appendImage(l,u,f,g,m){return fn(this,void 0,void 0,function*(){u=null!=u?u:this._inputType,f=null!=f?f:Ne(this,CO,"f"),g=null!=g?g:this._jpegQuality,m=null!=m&&m;let v=this,_=v._createTask("AppendImageToTiff");const b=yield v._readFile(l);return _.params.input=[b,u,f,g,m],_.handleResult=v._handleBooleanResult,v._addTask(_),_.promise})}addTag(l,u,f){return this._addTask(this._createTask("AddTagToNextPage",[l,u,f=null!=f&&f],this._handleBooleanResult))}getTiff(l){let u=this._createTask("GetTiffStream");return u.handleResult=this._handleImageData,u.params.returnType=null!=l?l:aa.RT_AUTO,u.params.returnBlob=l!=aa.RT_AUTO,this._addTask(u)}getMemoryUsed(){return this._addTask(this._createTask("getMemoryUsed",null,function(l,u){return l.memoryUsed}))}getMultiPartFile(l,u){return this._addTask(this._createTask("ds_get_file",[l,u],function(f,g){return f}))}}CO=new WeakMap,SE=new WeakSet,bO=function(p,l,u,f,g,m,v,_,b,S){return fn(this,void 0,void 0,function*(){let I=this;l=null!=l?l:this._inputType,u=null!=u?u:0,f=null!=f?f:0,g=null!=g?g:24,m=null!=m?m:96,v=null!=v?v:96,_=null!=_?_:this._outputType,b=null!=b?b:this._jpegQuality,S=null!=S?S:aa.RT_AUTO;let k=I._createTask("SaveImage");const O=yield I._readFile(p);return k.params.input=[O,l,u,f,g,m,v,_,b],k.params.returnType=S,k.params.returnBlob=S!=aa.RT_BASE64,k.handleResult=I._handleImageData,I._addTask(k),k.promise})};class MIe extends kg{constructor(l){super(vn.ImageReadereModule,l),d_.add(this),tJ.set(this,0),Eg.set(this,!1),Dg.set(this,null),TE.set(this,void 0),xO.set(this,0),mv.set(this,void 0),Tx.set(this,void 0)}workerChanged(l){Mt(this,Eg,!1,"f"),l&&(On.logD("["+this.id+"] worker changed to "+l),Mt(this,xO,l,"f"))}setExternalWorkerChanged(l,u){Mt(this,mv,l,"f"),Mt(this,Tx,u,"f")}_workerChanged(l){this.workerChanged(l),Ne(this,mv,"f")&&Ne(this,mv,"f").call(this,Ne(this,Tx,"f"),this,l)}_canTerminateWork(){return!0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(Mt(this,Eg,!1,"f"),Ne(this,mv,"f")&&Ne(this,mv,"f").call(this,Ne(this,Tx,"f"),this))}getImageFormat(l){return fn(this,void 0,void 0,function*(){let u=this,f=u._createTask("GetImageFormat");const g=yield u._readFile(l.fileSource);return f.params.input=g,u._addTask(f),f.promise})}readImageInfo(l){return fn(this,void 0,void 0,function*(){let u=this,f=u._createTask("ReadImageInfo");const g=yield u._readFile(l.fileSource);return f.params.input=g,u._addTask(f),f.promise})}readImage(l,u,f,g,m){return fn(this,void 0,void 0,function*(){u=null!=u?u:this._outputType,f=null!=f?f:this._jpegQuality,g=null!=g&&g,m=null!=m&&m;let v=this,_=v._createTask("ReadImage");const b=yield v._readFile(l.fileSource);_.params.input=[b,u,f,m],_.params.returnType=g?aa.RT_BASE64:aa.RT_AUTO,_.params.returnBlob=!g,_.handleResult=v._handleImageData,v._addTask(_);const S=yield _.promise;if(S.srcBuffer){let I=Object.prototype.toString.call(l.fileSource);"[object ArrayBuffer]"!=I&&"[object Uint8ClampedArray]"!=I&&delete S.srcBuffer}return S})}openTiff(l,u){return fn(this,void 0,void 0,function*(){u=null!=u&&u;let f,g=this,m=g._createTask("LoadTiff");if(l!=Ne(this,Dg,"f")){const _=yield g._readFile(l);l instanceof Blob?Mt(g,Dg,l,"f"):Mt(g,Dg,new Blob([_]),"f")}f||(f=yield g._readFile(Ne(g,Dg,"f"))),m.params.input=[f,u],g._addTask(m);const v=yield m.promise;if(Mt(g,Eg,!0,"f"),v.srcBuffer){let _=Object.prototype.toString.call(l);"[object ArrayBuffer]"!=_&&"[object Uint8ClampedArray]"!=_&&delete v.srcBuffer}return Mt(g,TE,{pageCount:v.pageCount},"f"),v})}readTiffPage(l,u,f,g,m){return fn(this,void 0,void 0,function*(){yield Ne(this,d_,"m",IE).call(this,l.fileSource),u=null!=u?u:0,f=null!=f?f:this._outputType,g=null!=g&&g,m=null!=m&&m;let v=this._createTask("ReadTiffPage");return v.params.input=[u,f,m],v.params.returnType=g?aa.RT_BASE64:aa.RT_AUTO,v.params.returnBlob=!g,v.handleResult=this._handleImageData,this._addTask(v)})}getTiffInfo(l,u){return fn(this,void 0,void 0,function*(){return yield Ne(this,d_,"m",IE).call(this,l.fileSource),Ne(this,TE,"f")})}getTiffPageInfos(l,u){return fn(this,void 0,void 0,function*(){yield Ne(this,d_,"m",IE).call(this,l.fileSource);let f=this._createTask("GetTiffPageInfos");return f.params.input=[u],this._addTask(f)})}}tJ=new WeakMap,Eg=new WeakMap,Dg=new WeakMap,TE=new WeakMap,xO=new WeakMap,mv=new WeakMap,Tx=new WeakMap,d_=new WeakSet,IE=function(p){return fn(this,void 0,void 0,function*(){if(this.makeSureWorkerMemoryNotExceed(),Ne(this,Eg,"f")){if(Ne(this,Dg,"f")===p)return void On.logD("["+this.id+"] already opened in "+this.workerId);yield Ne(this,d_,"m",nJ).call(this)}On.logD("["+this.id+"] reopen in worker "+this.workerId),yield this.openTiff(p,!1)})},nJ=function(){if(Mt(this,Dg,null,"f"),Ne(this,Eg,"f"))return Mt(this,Eg,!1,"f"),this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))},function(p){p[p.render=1]="render",p[p.extractImageOnly=2]="extractImageOnly",p[p.auto=3]="auto",p[p.renderWithAnnot=4]="renderWithAnnot"}(uJ||(uJ={}));class Mg extends Dx{constructor(l){super(vn.PdfReaderModule,l),Uu.add(this),yv.set(this,void 0),Ix.set(this,void 0),Ex.set(this,0),rJ.set(this,200),oJ.set(this,3),Ag.set(this,!1),EE.set(this,void 0),sp.set(this,null),_v.set(this,""),this._outputType=Hc.IT_ALL}static get fonts(){return Ne(this,vv,"f",h_)}static addPdfFont(l,u){return fn(this,void 0,void 0,function*(){return Ne(this,vv,"m",iJ).call(this,l,u)})}static getPdfFonts(){return this.fonts?Object.keys(this.fonts):[]}static removeFont(){Mt(this,vv,Object.create(null),"f",h_)}workerChanged(l){Mt(this,Ag,!1,"f"),l&&(On.logD("["+this.id+"] worker changed to "+l),Mt(this,Ex,l,"f"))}setExternalWorkerChanged(l,u){Mt(this,yv,l,"f"),Mt(this,Ix,u,"f")}_workerChanged(l){this.workerChanged(l),Ne(this,yv,"f")&&Ne(this,yv,"f").call(this,Ne(this,Ix,"f"),this,l)}_canTerminateWork(){return!0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(Mt(this,Ag,!1,"f"),Ne(this,yv,"f")&&Ne(this,yv,"f").call(this,Ne(this,Ix,"f"),this))}getPdfInfo(l){return fn(this,void 0,void 0,function*(){return yield Ne(this,Uu,"m",Cv).call(this,l),Ne(this,EE,"f")})}readPage(l,u,f,g,m,v,_,b){return fn(this,void 0,void 0,function*(){return this.readPageEx(l,u,{convertMode:g,renderOptions:{resolution:f}},m,v,_,b)})}readPageEx(l,u,f,g,m,v,_){return fn(this,void 0,void 0,function*(){yield Ne(this,Uu,"m",Cv).call(this,l),u=null!=u?u:0,g=null!=g?g:this._outputType,v=null!=v&&v,m=null!=m&&m,_=null!=_&&_;let b=f?JSON.stringify(f):"{}",S=this._createTask("ReadPdfPageEx");return S.params.input=[u,b,g,m,_],S.params.returnType=v?aa.RT_BASE64:aa.RT_AUTO,S.params.returnBlob=!v,S.handleResult=this._handleImageData,this._addTask(S)})}readPageImageInfos(l,u,f,g){return fn(this,void 0,void 0,function*(){yield Ne(this,Uu,"m",Cv).call(this,l),g=null!=g?g:this._outputType;let m=f?JSON.stringify(f):"{}",v=this._createTask("ReadPageImageInfos");return v.params.input=[u,m,g],this._addTask(v)})}readPageAnnot(l,u){return fn(this,void 0,void 0,function*(){yield Ne(this,Uu,"m",Cv).call(this,l);let f=this._createTask("GetPageAnnot",[u=null!=u?u:0]);return this._addTask(f)})}findText(l,u,f,g){return fn(this,void 0,void 0,function*(){return yield Ne(this,Uu,"m",Cv).call(this,l),this._addTask(this._createTask("SearchText",[u,f,g=null!=g?g:0]))})}getPageInfos(l,u){return fn(this,void 0,void 0,function*(){return yield Ne(this,Uu,"m",Cv).call(this,l),this._addTask(this._createTask("GetPdfPageInfos",[u]))})}}vv=Mg,yv=new WeakMap,Ix=new WeakMap,Ex=new WeakMap,rJ=new WeakMap,oJ=new WeakMap,Ag=new WeakMap,EE=new WeakMap,sp=new WeakMap,_v=new WeakMap,Uu=new WeakSet,iJ=function(p,l){return fn(this,void 0,void 0,function*(){if("string"==typeof p&&0!==p.length||Promise.reject("The 'name' should be a valid string"),void 0===Ne(this,vv,"f",h_)[p])if(l instanceof Blob)Ne(this,vv,"f",h_)[p]=l;else{const u=yield Rg.read(l);Ne(this,vv,"f",h_)[p]=new Blob([u])}})},Cv=function(p){var l,u;return fn(this,void 0,void 0,function*(){if(this.makeSureWorkerMemoryNotExceed(),Ne(this,Ag,"f")){if(Ne(this,sp,"f")===p.fileSource)return void On.logD("["+this.id+"] already opened in "+this.workerId);yield Ne(this,Uu,"m",cJ).call(this)}On.logD("["+this.id+"] reopen in worker "+this.workerId),yield Ne(this,Uu,"m",lJ).call(this,null!==(l=p.fileSource)&&void 0!==l?l:Ne(this,sp,"f"),null!==(u=p.password)&&void 0!==u?u:Ne(this,_v,"f"))})},sJ=function(){return fn(this,void 0,void 0,function*(){if(0===Ne(this,Ex,"f")||Ne(this,Ex,"f")!==this.workerId){On.logD("["+this.id+"] load font in worker "+this.workerId);const p=Mg.fonts,l=Object.keys(p);for(let u of l){const f=p[u],g=yield Rg.read(f);g&&(yield Ne(this,Uu,"m",aJ).call(this,u,g))}}})},aJ=function(p,l){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("AddSystemFont",[p,l]))})},lJ=function(p,l){return fn(this,void 0,void 0,function*(){yield Ne(this,Uu,"m",sJ).call(this),l=null!=l?l:"";let u,f=this,g=f._createTask("LoadPdf");if(p!==Ne(f,sp,"f")||l!==Ne(f,_v,"f")){const m=yield f._readFile(p);p instanceof Blob?Mt(f,sp,p,"f"):Mt(f,sp,new Blob([m]),"f"),u=m,Mt(f,_v,l,"f")}else l=Ne(f,_v,"f");return u||(u=yield f._readFile(Ne(f,sp,"f"))),g.params.input=[u,l],g.handleResult=function(m,v){if(m.srcBuffer){let b=Object.prototype.toString.call(p);"[object ArrayBuffer]"!=b&&"[object Uint8ClampedArray]"!=b&&delete m.srcBuffer}let _=class OIe{static decode(l){const u={encodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decodeChars:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1]};function f(g){let m,v,_,b,S,I,k,O=[],j=g.length;for(m=0;m<j;m++)b=g.charCodeAt(m),b>>7&255?6==(b>>5&255)?(S=g.charCodeAt(++m),v=(31&b)<<6,_=63&S,k=v|_,O.push(String.fromCharCode(k))):14==(b>>4&255)&&(S=g.charCodeAt(++m),I=g.charCodeAt(++m),v=b<<4|S>>2&15,_=(3&S)<<6|63&I,k=(255&v)<<8|_,O.push(String.fromCharCode(k))):O.push(g.charAt(m));return O.join("")}return function(g){let m,v,_,b,S=[],I=0,k=g.length;for(;I<k;){do{m=u.decodeChars[255&g.charCodeAt(I++)]}while(I<k&&-1==m);if(-1==m)break;do{v=u.decodeChars[255&g.charCodeAt(I++)]}while(I<k&&-1==v);if(-1==v)break;S.push(String.fromCharCode(m<<2|(48&v)>>4));do{if(_=255&g.charCodeAt(I++),61==_)return f(S.join(""));_=u.decodeChars[_]}while(I<k&&-1==_);if(-1==_)break;S.push(String.fromCharCode((15&v)<<4|(60&_)>>2));do{if(b=255&g.charCodeAt(I++),61==b)return f(S.join(""));b=u.decodeChars[b]}while(I<k&&-1==b);if(-1==b)break;S.push(String.fromCharCode((3&_)<<6|b))}return f(S.join(""))}(l)}}.decode(m.infoBase64);try{let b;try{_.replace(new RegExp("\\\\","gi"),"\\\\"),b=JSON.parse(_)}catch(I){b=_}let S={PdfCount:m.pageCount,PdfInfo:b,isTextBased:m.isTextBased};return m.srcBuffer&&(S.srcBuffer=m.srcBuffer,delete m.srcBuffer),Mt(f,Ag,!0,"f"),Mt(f,EE,S,"f"),S}catch(b){v.reject({code:Nu.wasmJsInvalidJson,message:b.message,stack:b.stack})}},f._addTask(g)})},cJ=function(){return fn(this,void 0,void 0,function*(){if(Mt(this,sp,null,"f"),Mt(this,_v,"","f"),Ne(this,Ag,"f"))return Mt(this,Ag,!1,"f"),this._addTask(this._createTask("UnloadDocument",null,this._handleBooleanResult))})},h_={value:Object.create(null)};const SO=["readPdfPage","readTiffPage","readImage"];class gJ{constructor(l){this.items=[],l&&(this.items=l)}push(l){this.items.push(l)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}add(l){let u;-1!==SO.indexOf(l.api)&&this.push(l);for(let f of this.items)f.api===l.api&&f.params[0]===l.params[0]&&f.params[1]===l.params[1]&&(u=f);u?(u.resolves=[...u.resolves,...l.resolves],u.rejects=[...u.rejects,...l.rejects]):this.push(l)}remove(l){-1!==SO.indexOf(l.api)&&this.items.forEach((u,f)=>{u.api===l.api&&u.params[0]===l.params[0]&&u.params[1]===l.params[1]&&this.items.splice(f,1).forEach(g=>{null==g||g.resolves.forEach(m=>{m(null)})})})}}class oo{static unload(){if(Mt(this,an,[],"f",f_),Mt(this,an,new gJ,"f",Pg),Mt(this,an,!1,"f",p_),Mg.removeFont(),Ne(this,an,"f",mo)){On.logD("pdfReader destroy");const l=Ne(this,an,"f",mo);Mt(this,an,null,"f",mo),l.terminate()}if(Ne(this,an,"f",vo)){On.logD("imageReader destroy");const l=Ne(this,an,"f",vo);Mt(this,an,null,"f",vo),l.terminate()}}static updateLicense(l,u,f){return fn(this,void 0,void 0,function*(){let g=[];return Ne(this,an,"f",mo)&&g.push(Ne(this,an,"f",mo).updateLicense(l,u,f)),Ne(this,an,"f",vo)&&g.push(Ne(this,an,"f",vo).updateLicense(l,u,f)),Promise.all(g)})}static add(l){return fn(this,void 0,void 0,function*(){Ne(this,an,"f",f_).push(l),Ne(this,an,"f",mo)||(Mt(this,an,new Mg,"f",mo),Ne(this,an,"f",mo).setExternalWorkerChanged(Ne(oo,an,"m",wO),this),this.initPdfReaderFunctionMap()),Ne(this,an,"f",vo)||(Mt(this,an,new MIe,"f",vo),Ne(this,an,"f",vo).setExternalWorkerChanged(Ne(oo,an,"m",wO),this),this.initImageReaderFunctionMap())})}static addFont(l,u){return fn(this,void 0,void 0,function*(){Mg.addPdfFont(l,u)})}static getFonts(){return Mg.getPdfFonts()}static delete(l){const u=Ne(this,an,"f",f_).indexOf(l);if(u>=0&&(Ne(this,an,"f",f_).splice(u,1),0===Ne(this,an,"f",f_).length&&!Ne(this,an,"f",p_))){if(Ne(this,an,"f",mo)){On.logD("pdfReader destroy");const f=Ne(this,an,"f",mo);Mt(this,an,null,"f",mo),f.terminate()}if(Ne(this,an,"f",vo)){On.logD("imageReader destroy");const f=Ne(this,an,"f",vo);Mt(this,an,null,"f",vo),f.terminate()}}}static createTask(l,u){const f={api:l,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const m of u)f.params.push(m);const g=new Promise(function(m,v){f.resolves.push(m),f.rejects.push(v)});return f.promise.push(g),Ne(this,an,"m",dJ).call(this,f),g}static cancelTask(l,u){if(-1!==SO.indexOf(l)){const f={api:l,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const g of u)f.params.push(g);Ne(this,an,"f",Pg).remove(f)}}static initPdfReaderFunctionMap(){var l,u,f,g,m,v;Ne(this,an,"f",ap).findPdfText=null===(l=Ne(this,an,"f",mo))||void 0===l?void 0:l.findText,Ne(this,an,"f",ap).getPdfPageInfos=null===(u=Ne(this,an,"f",mo))||void 0===u?void 0:u.getPageInfos,Ne(this,an,"f",ap).getPdfInfo=null===(f=Ne(this,an,"f",mo))||void 0===f?void 0:f.getPdfInfo,Ne(this,an,"f",ap).readPdfPageAnnot=null===(g=Ne(this,an,"f",mo))||void 0===g?void 0:g.readPageAnnot,Ne(this,an,"f",ap).readPdfPage=null===(m=Ne(this,an,"f",mo))||void 0===m?void 0:m.readPageEx,Ne(this,an,"f",ap).readPdfPageImageInfos=null===(v=Ne(this,an,"f",mo))||void 0===v?void 0:v.readPageImageInfos}static initImageReaderFunctionMap(){var l,u,f,g,m,v;Ne(this,an,"f",lp).readImage=null===(l=Ne(this,an,"f",vo))||void 0===l?void 0:l.readImage,Ne(this,an,"f",lp).getImageFormat=null===(u=Ne(this,an,"f",vo))||void 0===u?void 0:u.getImageFormat,Ne(this,an,"f",lp).readImageInfo=null===(f=Ne(this,an,"f",vo))||void 0===f?void 0:f.readImageInfo,Ne(this,an,"f",lp).getTiffInfo=null===(g=Ne(this,an,"f",vo))||void 0===g?void 0:g.getTiffInfo,Ne(this,an,"f",lp).readTiffPage=null===(m=Ne(this,an,"f",vo))||void 0===m?void 0:m.readTiffPage,Ne(this,an,"f",lp).getTiffPageInfos=null===(v=Ne(this,an,"f",vo))||void 0===v?void 0:v.getTiffPageInfos}}an=oo,wO=function(p,l,u){let f=null!=p?p:this;Ne(f,an,"f",mo)&&Ne(f,an,"f",mo)!==l&&Ne(f,an,"f",mo).workerChanged(u),Ne(f,an,"f",vo)&&Ne(f,an,"f",vo)!==l&&Ne(f,an,"f",vo).workerChanged(u)},dJ=function(p){Ne(this,an,"f",Pg).add(p),Ne(this,an,"f",p_)||(Mt(this,an,!0,"f",p_),Ne(this,an,"m",fJ).call(this))},hJ=function(){try{Ne(this,an,"f",vo)&&Ne(this,an,"f",vo).makeSureWorkerMemoryNotExceed(),Ne(this,an,"f",mo)&&Ne(this,an,"f",mo).makeSureWorkerMemoryNotExceed()}catch(p){}},fJ=function(){return fn(this,void 0,void 0,function*(){do{if(Ne(this,an,"f",Pg).isEmpty()||!Ne(this,an,"f",mo)||!Ne(this,an,"f",vo))break;const p=Ne(this,an,"f",Pg).pop();if(p)try{let l,u=Ne(this,an,"f",ap)[p.api];u?(l=yield Ne(this,an,"f",ap)[p.api].apply(Ne(this,an,"f",mo),p.params),Ne(this,an,"f",mo).makeSureWorkerMemoryNotExceed()):(u=Ne(this,an,"f",lp)[p.api],u&&(l=yield Ne(this,an,"f",lp)[p.api].apply(Ne(this,an,"f",vo),p.params),Ne(this,an,"f",vo).makeSureWorkerMemoryNotExceed())),null==p||p.resolves.forEach(f=>{f(l)})}catch(l){On.logD(l),p.retry<1?(p.retry+=1,Ne(this,an,"m",hJ).call(this),Ne(this,an,"f",Pg).push(p)):null==p||p.rejects.forEach(u=>{u(l)})}}while(!Ne(this,an,"f",Pg).isEmpty());Mt(this,an,!1,"f",p_)})},f_={value:[]},Pg={value:new gJ},mo={value:void 0},vo={value:void 0},p_={value:!1},ap={value:Object.create(null)},lp={value:Object.create(null)};class FIe{constructor(){oo.add(this)}destroy(){oo.delete(this)}readImage(l,u,f,g,m){return fn(this,void 0,void 0,function*(){return oo.createTask("readImage",[l,u,f,g,m])})}getImageFormat(l){return fn(this,void 0,void 0,function*(){return oo.createTask("getImageFormat",[l])})}readImageInfo(l){return fn(this,void 0,void 0,function*(){return oo.createTask("readImageInfo",[l])})}cancelReadImage(l,u){return oo.cancelTask("readImage",[l,u])}getTiffInfo(l){return fn(this,void 0,void 0,function*(){return oo.createTask("getTiffInfo",[l,!1])})}readTiffPage(l,u,f,g,m){return fn(this,void 0,void 0,function*(){return oo.createTask("readTiffPage",[l,u,f,g,m])})}cancelReadTiffPage(l,u){return oo.cancelTask("readTiffPage",[l,u])}getTiffPageInfos(l,u){return fn(this,void 0,void 0,function*(){return oo.createTask("getTiffPageInfos",[l,u])})}}var Ol,sc,g_,cp,Ax,mJ,TO,vJ,yJ,_J,CJ,bJ,xJ,wJ,SJ,TJ,IJ,EJ,DJ,AJ;!function(p){p[p.NearestNeighbour=1]="NearestNeighbour",p[p.Bilinear=2]="Bilinear",p[p.Bicublic=3]="Bicublic",p[p.BestQuality=5]="BestQuality"}(g_||(g_={}));class LIe extends kg{constructor(l){super(vn.ImageProcModule,l),Ol.add(this)}initImage(l,u,f,g,m){return fn(this,void 0,void 0,function*(){u=null!=u&&u,f=null!=f?f:0,g=null!=g?g:0,m=null!=m&&m;let v=this,_=v._createTask("InitImageObject");if(_.params.input=[l,f,g],u||m)_.params.input.push(u?Hc.IT_RGBA:Hc.IT_BGRA),v._addTask(_);else{const S=yield v._readFile(l);_.params.input[0]=S,_.params.input.push(Hc.IT_ALL),v._addTask(_)}const b=yield _.promise;if(b.srcBuffer){let S=Object.prototype.toString.call(l);"[object ArrayBuffer]"!=S&&"[object Uint8ClampedArray]"!=S&&delete b.srcBuffer}return b})}restore(){return this._addTask(this._createTask("BackToOriginal",null,this._handleBooleanResult))}filter(l,u,f){var g,m,v,_,b,S,I,k,O,j;let W=this;u=null!=u?u:{},f=null!=f?f:{};let J=W._createTask("Filter");if(J.params.input=[],J.params.input.push(l),"toBW"===l)J.params.input.push(JSON.stringify(Ne(W,Ol,"m",sc).call(W,u)));else if("toGray"===l)J.params.input.push(JSON.stringify(Ne(W,Ol,"m",sc).call(W,u)));else if("removeShadow"===l)J.params.input.push(JSON.stringify(Ne(W,Ol,"m",sc).call(W,u)));else if("enhance"===l)J.params.input.push(JSON.stringify(Ne(W,Ol,"m",sc).call(W,u)));else if("invert"===l)J.params.input.push(JSON.stringify(Ne(W,Ol,"m",sc).call(W,u)));else if("brightnessAndContrast"===l){let ee=null!==(g=u.brightness)&&void 0!==g?g:0,ke=null!==(m=u.contrast)&&void 0!==m?m:0;J.params.input.push(ee),J.params.input.push(ke)}let K=null!==(v=f.returnType)&&void 0!==v?v:Hc.IT_JPG,Q=null!==(_=f.jpegQuality)&&void 0!==_?_:this._jpegQuality,ie=null!==(b=f.bRGBA)&&void 0!==b&&b,oe=null!==(S=f.bitDepth)&&void 0!==S?S:0,le=null!==(I=f.xdpi)&&void 0!==I?I:0,he=null!==(k=f.ydpi)&&void 0!==k?k:0,_e=null===(O=f.returnBlob)||void 0===O||O;K=ie&&null==K?Hc.IT_JPG:null!=K?K:Hc.IT_ALL;let Ve=null!==(j=f.is1BitTo8Bit)&&void 0!==j&&j;return J.params.input.push([K,oe,le,he,!1,Q,!1,Ve]),J.params.returnBlob=_e,J.handleResult=this._handleImageData,W._addTask(J),J.promise}rotate(l,u,f,g){return((l=null!=l?l:0)<0||l>360)&&(l%=360)<0&&(l+=360),this._addTask(this._createTask("RotateEx",[l,f=null!=f&&f,g=null!=g?g:g_.Bicublic,u=null!=u?u:"FFFFFF"],this._handleBooleanResult))}flip(l){l=null!=l?l:1;let u=this._createTask("");return u.handleResult=this._handleBooleanResult,1===l?u.func="Flip":-1===l&&(u.func="Mirror"),this._addTask(u),u.promise}erase(l,u,f,g,m){let v=this,_=v._createTask("Erase");return _.handleResult=this._handleBooleanResult,_.params.input=[l,u,f,g,JSON.stringify(Ne(v,Ol,"m",sc).call(v,m))],v._addTask(_),_.promise}crop(l,u,f,g){return this._addTask(this._createTask("Crop",[l,u,f,g],this._handleBooleanResult))}resize(l,u,f){return this._addTask(this._createTask("ChangeImageSize",[l,u,f=null!=f?f:g_.BestQuality],this._handleBooleanResult))}toGrayscaleLevel(l){(l=null!=l?l:1)<1&&(l=1),l>3&&(l=3);let u={};return 2===l?(u.clean=!0,u.sigma=3,u.scaleLimit=720,u.alpha=1.05):3===l&&(u.clean=!0,u.sigma=5,u.scaleLimit=1080,u.alpha=1.05),this.toGrayscale(u)}toGrayscale(l){return this._addTask(this._createTask("ConvertToGrayScale",JSON.stringify(Ne(this,Ol,"m",sc).call(this,l)),this._handleBooleanResult))}toBinaryLevel(l,u){(u=null!=u?u:1)<1&&(u=1),u>3&&(u=3);let f={};return null!=l&&(l?f.method="adaptiveThreshold":(f.method="threshold",2===u?(f.clean=!0,f.sigma=3,f.scaleLimit=720,f.alpha=1.05):3===u&&(f.clean=!0,f.sigma=5,f.scaleLimit=1080,f.alpha=1.05))),this.toBinary(f)}toBinary(l){return this._addTask(this._createTask("ConvertToBW",JSON.stringify(Ne(this,Ol,"m",sc).call(this,l)),this._handleBooleanResult))}invert(){return this._addTask(this._createTask("Invert",null,this._handleBooleanResult))}setImageWidth(l,u){return this._addTask(this._createTask("SetImageWidth",[l,JSON.stringify(Ne(this,Ol,"m",sc).call(this,u))],this._handleBooleanResult))}setImageHeight(l,u){return this._addTask(this._createTask("SetImageHeight",[l,JSON.stringify(Ne(this,Ol,"m",sc).call(this,u))],this._handleBooleanResult))}setDPI(l,u,f,g,m,v){return this._addTask(this._createTask("SetDPI",[l,u,f,g,m=null!=m&&m,v=null!=v?v:g_.Bilinear],this._handleBooleanResult))}getImage(l,u,f,g,m,v,_,b,S){l=null!=l?l:this._jpegQuality,u=null==u||u,g=null!=g?g:0,m=null!=m?m:0,v=null!=v?v:0,_=null==_||_,b=(f=null!=f&&f)&&null==b?Hc.IT_JPG:null!=b?b:Hc.IT_ALL,S=null!=S&&S;let I=this._createTask("GetCurrentImage");return I.params.input=[b,g,m,v,!1,l,u,S],I.params.returnBlob=_,I.handleResult=this._handleImageData,this._addTask(I)}getSkewAngle(l){return this._addTask(this._createTask("GetSkewAngle",[JSON.stringify(Ne(this,Ol,"m",sc).call(this,l))],function(u,f){return u.skewAngle}))}freeReservedData(){return this._addTask(this._createTask("FreeReservedData",null,this._handleBooleanResult))}detectDocument(l,u,f,g,m){return this._addTask(this._createTask("DocumentDetect",[l=null!=l?l:g_.Bilinear,(u=null!=u?u:75)/100,f=null!=f?f:100,(g=null!=g?g:0)/255,m=null!=m?m:"","1"]))}perspective(l,u,f,g,m,v,_,b){return this._addTask(this._createTask("Perspective",[l,u,f,g,m,v,_,b],this._handleBooleanResult))}changeBrightness(l,u){return l=null!=l?l:0,0!=(u=null!=u?u:1)&&1!=u&&(u=0),this._addTask(1===u?this._createTask("ChangeBrightnessAndContrast",[l,0],this._handleBooleanResult):this._createTask("ChangeBrightness",[Math.floor(l/1e3*255)],this._handleBooleanResult))}changeContrast(l,u){return l=null!=l?l:0,0!=(u=null!=u?u:1)&&1!=u&&(u=0),this._addTask(1===u?this._createTask("ChangeBrightnessAndContrast",[0,l],this._handleBooleanResult):this._createTask("ChangeContrast",[1+l/1e3],this._handleBooleanResult))}changeBrightnessAndContrast(l,u){return this._addTask(this._createTask("ChangeBrightnessAndContrast",[l=null!=l?l:0,u=null!=u?u:0],this._handleBooleanResult))}removeShadowLevel(l,u){u=null!=u?u:1.05,(l=null!=l?l:1)<1&&(l=1),l>3&&(l=3);let f={};return 1===l&&(f.sigma=3,f.scaleLimit=720,f.alpha=u),2===l?(f.sigma=5,f.scaleLimit=1080,f.alpha=u):3===l&&(f.sigma=10,f.scaleLimit=0,f.alpha=u),this.removeShadow(f)}removeShadow(l){return this._addTask(this._createTask("ShadowRemovel",[JSON.stringify(Ne(this,Ol,"m",sc).call(this,l))],this._handleBooleanResult))}enhanceAndSharpenImage(){return this._addTask(this._createTask("EnhanceAndSharpen",[""],this._handleBooleanResult))}brighten(){return this._addTask(this._createTask("Brighten",[""],this._handleBooleanResult))}getBlurryScore(){return this._addTask(this._createTask("GetBlurScore",[""],function(l,u){return l.blurryScore}))}drawQuadrangle(l,u,f,g,m,v,_,b,S){return this._addTask(this._createTask("DrawQuadrangle",[l,u,f,g,m,v,_,b,JSON.stringify(Ne(this,Ol,"m",sc).call(this,S))],this._handleBooleanResult))}getImageInfo(){return this._addTask(this._createTask("GetImageInfo",[]))}}Ol=new WeakSet,sc=function(p){let l={};if(null!=p&&"object"==typeof p)for(let u in p)l[u]=p[u];return l};class DE{constructor(){oo.add(this)}destroy(){oo.delete(this)}static addPdfFont(l,u){return fn(this,void 0,void 0,function*(){return oo.addFont(l,u)})}static getPdfFonts(){return oo.getFonts()}getPdfInfo(l){return fn(this,void 0,void 0,function*(){return oo.createTask("getPdfInfo",[l])})}readPage(l,u,f,g,m,v,_,b){return fn(this,void 0,void 0,function*(){return this.readPageEx(l,u,{convertMode:g,renderOptions:{resolution:f}},m,v,_,b)})}readPageEx(l,u,f,g,m,v,_){return fn(this,void 0,void 0,function*(){return oo.createTask("readPdfPage",[l,u,f,g,m,v,_])})}cancelReadPage(l,u){return oo.cancelTask("readPdfPage",[l,u])}readPageImageInfos(l,u,f,g,m,v,_){return fn(this,void 0,void 0,function*(){return oo.createTask("readPdfPageImageInfos",[l,u,f,g,m,v,_])})}readPageAnnot(l,u){return fn(this,void 0,void 0,function*(){return oo.createTask("readPdfPageAnnot",[l,u])})}findText(l,u,f,g){return fn(this,void 0,void 0,function*(){return oo.createTask("findPdfText",[l,u,f,g])})}getPageInfos(l,u){return fn(this,void 0,void 0,function*(){return oo.createTask("getPdfPageInfos",[l,u])})}}!function(p){p[p.auto=0]="auto",p[p.store=1]="store"}(vJ||(vJ={}));class NIe extends kg{constructor(l){super(vn.PdfWriterModule,l),cp.add(this)}initPdfSetting(l){return fn(this,void 0,void 0,function*(){let u=this,f=u._createTask("CreateDocument");return f.params.input=[JSON.stringify(Ne(u,cp,"m",TO).call(u,l))],f.handleResult=this._handleBooleanResult,u._addTask(f)})}appendPage(l,u){return fn(this,void 0,void 0,function*(){let f=this,g=f._createTask("InsertImagePage");u=null!=u&&u;const m=yield f._readFile(l);return g.params.input=[m,-1,u],g.handleResult=f._handleBooleanResult,f._addTask(g),g.promise})}insertPage(l,u,f){return fn(this,void 0,void 0,function*(){let g=this,m=g._createTask("InsertImagePage");f=null!=f&&f;const v=yield g._readFile(l);return m.params.input=[v,u,f],m.handleResult=g._handleBooleanResult,g._addTask(m),m.promise})}writePdf(l){return fn(this,void 0,void 0,function*(){let u=this._createTask("GetCurrentPdf");return u.params.returnType=null!=l?l:aa.RT_AUTO,u.params.returnBlob=l!=aa.RT_AUTO,u.handleResult=this._handleImageData,this._addTask(u)})}insertBlankPage(l,u,f){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("InsertBlankPage",[l=null!=l?l:0,u=null!=u?u:595,f=null!=f?f:842]))})}deletePage(l){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePdfPage",[l=null!=l?l:0],this._handleBooleanResult))})}pageSetRotation(l,u){return fn(this,void 0,void 0,function*(){l=null!=l?l:0,0!=(u=((u=null!=u?u:0)%360+360)%360)&&90!==u&&180!==u&&270!==u&&(u=0);let f=this._createTask("SetPageRotation");return f.params.input=[l,u],f.handleResult=this._handleBooleanResult,this._addTask(f)})}pageSetCropBox(l,u,f,g,m){return fn(this,void 0,void 0,function*(){l=null!=l?l:0,u=null!=u?u:0,f=null!=f?f:0,(g=null!=g?g:u)<u&&(g=u),(m=null!=m?m:f)<f&&(m=f);let v=this._createTask("SetPageCropBox");return v.params.input=[l,u,f,g,m],v.handleResult=this._handleBooleanResult,this._addTask(v)})}pageSetMediaBox(l,u,f,g,m){return fn(this,void 0,void 0,function*(){l=null!=l?l:0,u=null!=u?u:0,f=null!=f?f:0,(g=null!=g?g:u)<u&&(g=u),(m=null!=m?m:f)<f&&(m=f);let v=this._createTask("SetPageMediaBox");return v.params.input=[l,u,f,g,m],v.handleResult=this._handleBooleanResult,this._addTask(v)})}pageAddImage(l,u,f,g,m){return fn(this,void 0,void 0,function*(){let v=this,_=v._createTask("PageAddImage"),b=JSON.stringify(Ne(v,cp,"m",TO).call(v,f));const S=yield v._readFile(l);return _.params.input=[S,u,b,g,m],_.handleResult=v._handleBooleanResult,v._addTask(_),_.promise})}pageAddText(l,u){return fn(this,void 0,void 0,function*(){yield Ne(this,cp,"m",Ax).call(this);let f=JSON.stringify(u);return this._addTask(this._createTask("PageAddText",[l,f],this._handleBooleanResult))})}pageAddPath(l,u){return fn(this,void 0,void 0,function*(){let f=JSON.stringify(u);return this._addTask(this._createTask("PageAddPath",[l,f],this._handleBooleanResult))})}pageClearObjects(l){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("PageClearObjects",[l=null!=l?l:0],this._handleBooleanResult))})}pageSetAnnot(l,u){return fn(this,void 0,void 0,function*(){let f;return l=null!=l?l:0,Array.isArray(u)?(f="[",u.forEach((g,m)=>{m>0&&(f+=","),f+=JSON.stringify(g)}),f+="]"):f=JSON.stringify(u),yield Ne(this,cp,"m",Ax).call(this),this._addTask(this._createTask("SetPageAnnot",[l,f],this._handleBooleanResult))})}getFontFromTextObject(l){return l.fontName?l.fontName:""}getFontFromAnnot(l){let u=[];return l&&l.normalAppearance&&l.normalAppearance.objs&&l.normalAppearance.objs.forEach(g=>{if("text"===g.type){const v=this.getFontFromTextObject(g);v&&u.push(v)}}),u=[...new Set(u)],u}getFontFromAnnots(l){let u=[];return Array.isArray(l)?l.forEach(g=>{const m=this.getFontFromAnnot(g);u=u.concat(m)}):u=this.getFontFromAnnot(l),u=[...new Set(u)],u}pageAddAnnot(l,u){return fn(this,void 0,void 0,function*(){let f;return l=null!=l?l:0,Array.isArray(u)?(f="[",u.forEach((g,m)=>{m>0&&(f+=","),f+=JSON.stringify(g)}),f+="]"):f=JSON.stringify(u),yield Ne(this,cp,"m",Ax).call(this),this._addTask(this._createTask("PageAddAnnot",[l,f],this._handleBooleanResult))})}pageDeleteAnnot(l,u){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePageAnnot",[l=null!=l?l:0,u=null!=u?u:0],this._handleBooleanResult))})}pageDeleteAnnotByTypes(l,u){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePageAnnotByTypes",[l=null!=l?l:0,u=null!=u?u:""],this._handleBooleanResult))})}pageDeleteAnnotByNames(l,u){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePageAnnotByNames",[l=null!=l?l:0,u=null!=u?u:""],this._handleBooleanResult))})}mergePdf(l,u,f,g,m){return fn(this,void 0,void 0,function*(){g=null!=g?g:-1,f=null!=f?f:[],u=null!=u?u:"",m=null!=m&&m;let v=this,_=v._createTask("MergePdfPages");const b=yield v._readFile(l);return _.params.input=[b,g,u,f,m],_.handleResult=v._handleBooleanResult,v._addTask(_),_.promise})}pageFlatten(l,u){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("PageFlatten",[l=null!=l?l:0,u=null!=u?u:0],this._handleBooleanResult))})}GetFontInfo(l){return fn(this,void 0,void 0,function*(){const u=yield this._readFile(l);return this._addTask(this._createTask("GetFontInfo",[u]))})}IfFontsExist(l){return fn(this,void 0,void 0,function*(){let u=JSON.stringify(l);return yield Ne(this,cp,"m",Ax).call(this),this._addTask(this._createTask("IfFontsExist",[u]))})}}cp=new WeakSet,Ax=function(){return fn(this,void 0,void 0,function*(){On.logD("["+this.id+"] load font in worker "+this.workerId);const p=Mg.fonts,l=Object.keys(Mg.fonts);for(let u of l){const f=p[u],g=yield Rg.read(f);g&&(yield Ne(this,cp,"m",mJ).call(this,u,g))}})},mJ=function(p,l){return fn(this,void 0,void 0,function*(){return this._addTask(this._createTask("LoadFont",[l,p]))})},TO=function(p){let l={};if(null!=p&&"object"==typeof p)for(let u in p)l[u]=p[u];return l},function(p){p.Text="Text",p.Link="Link",p.FreeText="FreeText",p.Line="Line",p.Square="Square",p.Circle="Circle",p.Polygon="Polygon",p.PolyLine="PolyLine",p.Hignlight="Highlight",p.Underline="Underline",p.Squiggly="Squiggly",p.StrikeOut="StrikeOut",p.Stamp="Stamp",p.Caret="Caret",p.Ink="Ink",p.Popup="Popup"}(yJ||(yJ={})),function(p){p.None="none",p.Invisible="invisible",p.Hidden="hidden",p.Print="print",p.NoZoom="nozoom",p.NoRotate="norotate",p.NoView="noview",p.ReadOnly="readonly",p.Locked="locked",p.ToggleNoView="togglenoview",p.LockedContents="lockedcontents"}(_J||(_J={})),function(p){p.Solid="S",p.Dashed="D",p.Beveled="B",p.Insert="I",p.Underline="U"}(CJ||(CJ={})),function(p){p.NoEffect="S",p.Cloudy="C"}(bJ||(bJ={})),function(p){p.Comment="Comment",p.Key="Key",p.Note="Note",p.Help="Help",p.NewParagraph="NewParagraph",p.Paragraph="Paragraph",p.Insert="Insert"}(xJ||(xJ={})),function(p){p.Marked="Marked",p.Review="Review"}(wJ||(wJ={})),function(p){p.Accepted="Accepted",p.Rejected="Rejected",p.Cancelled="Cancelled",p.Completed="Completed",p.None="None"}(SJ||(SJ={})),function(p){p.None="None",p.Square="Square",p.Circle="Circle",p.Diamond="Diamond",p.OpenArrow="OpenArrow",p.ClosedArrow="ClosedArrow",p.Butt="Butt",p.ROpenArrow="ROpenArrow",p.RClosedArrow="RClosedArrow",p.Slash="Slash"}(TJ||(TJ={})),function(p){p[p.LeftJustified=0]="LeftJustified",p[p.Centered=1]="Centered",p[p.RightJustified=2]="RightJustified"}(IJ||(IJ={})),function(p){p.FreeText="FreeText",p.FreeTextCallout="FreeTextCallout",p.FreeTextTypeWriter="FreeTextTypeWriter"}(EJ||(EJ={})),function(p){p.LineArrow="LineArrow",p.LineDimension="LineDimension"}(DJ||(DJ={})),function(p){p.Approved="Approved",p.Experimental="Experimental",p.NotApproved="NotApproved",p.Asls="Asls",p.Expired="Expired",p.NotForPublicRelease="NotForPublicRelease",p.Confidential="Confidential",p.Final="Final",p.Sold="Sold",p.Departmental="Departmental",p.ForComment="ForComment",p.TopSecret="TopSecret",p.Draft="Draft",p.ForPublicRelease="ForPublicRelease"}(AJ||(AJ={}));const bv="undefined"==typeof self,xv=bv?{}:self;let Px,Rx,AE,IO,cl;"undefined"!=typeof navigator&&(Px=navigator,Rx=Px.userAgent,AE=Px.platform,IO=Px.mediaDevices),function(){if(!bv){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Px.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:AE,search:"Win"},Mac:{str:AE},Linux:{str:AE}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let S=v.verStr||Rx,I=v.verSearch||m;if(I instanceof Array||(I=[I]),-1!=(v.str||Rx).indexOf(v.search||m)){u=m;for(let k of I){let O=S.indexOf(k);if(-1!=O){f=parseFloat(S.substring(O+k.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Rx).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=Rx.indexOf("Windows NT")&&(g="HarmonyOS"),cl={browser:u,version:f,OS:g}}bv&&(cl={browser:"ssr",version:0,OS:"ssr"})}();const BIe="Chrome"===cl.browser&&cl.version>66||"Safari"===cl.browser&&cl.version>13||"OPR"===cl.browser&&cl.version>43||"Edge"===cl.browser&&cl.version>15,m_="\\s*([+-]?\\d+)\\s*",kx="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Nh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",PJ=/^#([0-9a-f]{3,8})$/,RJ=new RegExp(`^rgb\\(${m_},${m_},${m_}\\)$`),kJ=new RegExp(`^rgb\\(${Nh},${Nh},${Nh}\\)$`),MJ=new RegExp(`^rgba\\(${m_},${m_},${m_},${kx}\\)$`),OJ=new RegExp(`^rgba\\(${Nh},${Nh},${Nh},${kx}\\)$`),FJ=new RegExp(`^hsl\\(${kx},${Nh},${Nh}\\)$`),LJ=new RegExp(`^hsla\\(${kx},${Nh},${Nh},${kx}\\)$`),NJ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};let wv=class{constructor(p,l,u,f){N(this,"r",void 0),N(this,"g",void 0),N(this,"b",void 0),N(this,"opacity",void 0),this.r=p,this.g=l,this.b=u,this.opacity=f}};function BJ(p){return new wv(p>>16&255,p>>8&255,255&p,1)}function PE(p,l,u,f){return f<=0&&(p=NaN,l=NaN,u=NaN),new wv(p,l,u,f)}function WJ(p,l,u,f){return f<=0?(p=NaN,l=NaN,u=NaN):u<=0||u>=1?(p=NaN,l=NaN):l<=0&&(p=NaN),{h:p,s:l,l:u,opacity:f}}function EO(p,l,u){return p<60?(l+(u-l)*p)/60*255:p<180?255*u:p<240?(l+(u-l)*(240-p))/60*255:255*l}function UJ(p){const l=p.h<0?p.h%360+360:p.h%360,u=Number.isNaN(l)||Number.isNaN(p.s)?0:p.s,{l:f}=p,g=f+(f<.5?f:1-f)*u,m=2*f-g;return new wv(EO(l>=240?l-240:l+120,m,g),EO(l,m,g),EO(l<120?l+240:l-120,m,g),p.opacity)}const WIe=p=>{let l,u;if(p=`${p}`.trim().toLowerCase(),PJ.exec(p))switch(l=PJ.exec(p),u=l[1].length,l=parseInt(l[1],16),u){case 6:return BJ(l);case 3:return new wv(l>>8&15|l>>4&240,l>>4&15|240&l,(15&l)<<4|15&l,1);case 8:return PE(l>>24&255,l>>16&255,l>>8&255,(255&l)/255);case 4:return PE(l>>12&15|l>>8&240,l>>8&15|l>>4&240,l>>4&15|240&l,((15&l)<<4|15&l)/255);default:return null}return RJ.exec(p)?(l=RJ.exec(p),new wv(l[1],l[2],l[3],1)):kJ.exec(p)?(l=kJ.exec(p),new wv(255*l[1]/100,255*l[2]/100,255*l[3]/100,1)):MJ.exec(p)?(l=MJ.exec(p),PE(l[1],l[2],l[3],l[4])):OJ.exec(p)?(l=OJ.exec(p),PE(255*l[1]/100,255*l[2]/100,255*l[3]/100,l[4])):FJ.exec(p)?(l=FJ.exec(p),UJ(WJ(l[1],l[2]/100,l[3]/100,1))):LJ.exec(p)?(l=LJ.exec(p),UJ(WJ(l[1],l[2]/100,l[3]/100,l[4]))):NJ.hasOwnProperty(p)?BJ(NJ[p]):"transparent"===p?new wv(NaN,NaN,NaN,0):null},UIe=p=>p.replace(/[A-Z]/g,l=>`-${l.toLowerCase()}`),Mx=p=>Object.prototype.toString.call(p),Di=p=>Array.isArray?Array.isArray(p):"[object Array]"===Mx(p),Un=p=>null!==p&&"[object Object]"===Mx(p),hn=p=>{let l=null;return Di(p)&&(l||(l=[]),p.forEach(u=>{l.push(hn(u))})),Un(p)&&(l||(l={}),Object.keys(p).forEach(u=>{l[u]=hn(p[u])})),l||p},pt=p=>void 0===p,VJ=(p,l)=>{var u;p=null!==(u=p)&&void 0!==u?u:"yyyy-MM-dd hh:mm:ss";const f=pt(l)?new Date:new Date(l),g={"M+":(f.getMonth()+1).toString(),"d+":f.getDate().toString(),"h+":f.getHours().toString(),"m+":f.getMinutes().toString(),"s+":f.getSeconds().toString(),"q+":Math.floor((f.getMonth()+3)/3).toString(),S:f.getMilliseconds().toString()};return/(y+)/.test(p)&&(p=p.replace(RegExp.$1,`${f.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(g).forEach(m=>{new RegExp(`(${m})`).test(p)&&(p=p.replace(RegExp.$1,1===RegExp.$1.length?g[m]:`00${g[m]}`.substring(`${g[m]}`.length)))}),p},RE=p=>"[object ArrayBuffer]"===Mx(p),ul=p=>"[object Blob]"===Mx(p),Ds=p=>"[object Boolean]"===Mx(p),v_=p=>"function"==typeof p,ir=()=>"ontouchstart"in document.documentElement,Xt=p=>"number"==typeof p&&!Number.isNaN(p),xn=p=>"string"==typeof p,Sr=(p,l,u)=>Math.min(Math.max(p,l),u);let jJ=0;const Ai=()=>(jJ+=1,`${(new Date).getTime().toString(36)}${jJ.toString(36)}`),kE=p=>{const l=window.URL||window.webkitURL;let u="string";return xn(p)?u="string":ul(p)?(u="blob",p=l.createObjectURL(p)):(RE(p)||Di(p))&&(u="blob",p=l.createObjectURL(new Blob([p]))),{type:u,data:p}};function y_(p){return"object"==typeof HTMLElement?p instanceof HTMLElement:p&&"object"==typeof p&&1===p.nodeType&&"string"==typeof p.nodeName}let Bh=class ape{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";N(this,"prefix",void 0),N(this,"postfix",void 0),N(this,"isDestroyed",!1),N(this,"uid",Ai()),N(this,"cacheEvents",void 0),N(this,"events",void 0),N(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=l,this.postfix=u}static create(l,u){return new ape(l,u)}save(){this.isCached=!0}restore(){this.isCached=!1,this.cacheEvents.forEach(l=>{let{eventName:u,param:f}=l;this.emit(u,...f)}),this.cacheEvents.length=0}destroy(){if(!this.isDestroyed){for(const l in this.events)if(Object.prototype.hasOwnProperty.call(this.events,l)){const u=this.events[l];u&&u.slice().forEach(f=>{let{name:g,fn:m,context:v,once:_}=f;this.off(g,m,v,_)})}this.events={},this.isDestroyed=!0}}on(l,u,f){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{events:m}=this,v={name:l=this.format(l),uid:Ai(),context:f,once:g,fn:u};return m[l]||(m[l]=[]),m[l].indexOf(v)<0&&m[l].push(v),v}once(l,u,f){return this.on(l,u,f,!0)}emit(l){for(var u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];if(this.isCached)return this.cacheEvents.push({eventName:l,param:f}),!0;const{events:m}=this,v=m[l=this.format(l)];return!(!v||!v.length||(v.slice().forEach(_=>{let{fn:b,context:S}=_;b.call(S||null,...f)}),v.slice().forEach(_=>{let{fn:b,context:S,once:I}=_;I&&this.off(l,b,S,I)}),0))}off(l,u,f,g){const{events:m}=this,v=m[l=this.format(l)];if(!v)return!1;if(!arguments.length)return v.length=0,!0;for(let _=v.length-1;_>=0;_--){const b=v[_];u&&b.fn!==u||f&&b.context!==f||g&&b.once!==g||v.splice(_,1)}return!0}removeAllEventListeners(l){if(l){l=this.format(l);const u=this.cacheEvents.findIndex(f=>f.eventName===l);u>-1&&this.cacheEvents.splice(u,1),this.events[l]&&delete this.events[l]}else this.cacheEvents=[],this.events={}}getAllEvents(){return this.events}format(l){return`${this.prefix||""}${l}${this.postfix||""}`}};const DO="default";let Fo=class lpe{constructor(){N(this,"emitter",new Bh)}static create(){return new lpe}on(l){this.emitter.on(DO,l)}emit(){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];this.emitter.emit(DO,...u)}off(l){this.emitter.off(DO,l)}};function up(){return new Fo}let VIe=class CC{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;N(this,"x",void 0),N(this,"y",void 0),N(this,"z",void 0),this.x=l,this.y=u,this.z=f}static fromPoint(l){return new CC(l.x,l.y,l.z)}static fromTwoPoint(l,u){var f,g,m,v,_,b;return new CC((null!==(f=u.x)&&void 0!==f?f:0)-(null!==(g=l.x)&&void 0!==g?g:0),(null!==(m=u.y)&&void 0!==m?m:0)-(null!==(v=l.y)&&void 0!==v?v:0),(null!==(_=u.z)&&void 0!==_?_:0)-(null!==(b=l.z)&&void 0!==b?b:0))}static fromValue(l,u,f){return new CC(l,u,f)}setFromVector(l){var u;this.x=l.x,this.y=l.y,this.z=null!==(u=l.z)&&void 0!==u?u:0}clone(){return new CC(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(l){var u;return this.x*l.x+this.y*l.y+this.z*(null!==(u=l.z)&&void 0!==u?u:0)}projectionTo(l){const u=Math.hypot(l.x,l.y,l.z);return this.dot(l)/u}angle(l){const u=this.norm()*Math.hypot(l.x,l.y,l.z),f=u&&this.dot(l)/u;return Math.acos(Sr(f,-1,1))}equals(l){var u;return this.x===l.x&&this.y===l.y&&this.z===(null!==(u=l.z)&&void 0!==u?u:0)}distance(l){var u;return Math.hypot(this.x-l.x,this.y-l.y,this.z-(null!==(u=l.z)&&void 0!==u?u:0))}lerp(l){var u;let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:g,y:m,z:v}=this;return new CC(g+f*(l.x-g),m+f*(l.y-m),v+f*((null!==(u=l.z)&&void 0!==u?u:0)-v))}normalize(){const l=this,u=l.norm();return l.x/=u,l.y/=u,l.z/=u,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(l){const u=this;return{x:u.y*l.z-u.z*l.y,y:u.z*l.x-u.x*l.z,z:u.x*l.y-u.y*l.x}}add(l){return this.x+=l.x,this.y+=l.y,this.z+=l.z,this}multiply(l){return this.x*=l.x,this.y*=l.y,this.z*=l.z,this}};function ME(p,l){return VIe.fromTwoPoint(p,l)}let AO=class cpe{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;N(this,"x",void 0),N(this,"y",void 0),N(this,"z",void 0),this.x=l,this.y=u,this.z=f}static fromPoint(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new cpe(l.x,l.y,l.z)}matrixTransform(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:u,y:f,z:g}=this,{m11:m,m21:v,m31:_,m41:b,m12:S,m22:I,m32:k,m42:O,m13:j,m23:W,m33:J,m43:K,m14:Q,m24:ie,m34:oe,m44:le}=l,he=Q*u+ie*f+oe*g+le;return OE({x:(m*u+v*f+_*g+b)/he,y:(S*u+I*f+k*g+O)/he,z:(j*u+W*f+J*g+K)/he})}setFromPoint(l){return this.x=l.x||0,this.y=l.y||0,this.z=l.z||0,this}clone(){return OE(this)}equals(l){const{x:u=0,y:f=0,z:g=0}=l,m=this;return m.x===u&&m.y===f&&m.z===g}distanceTo(l){const{x:u=0,y:f=0,z:g=0}=l,m=this;return Math.hypot(m.x-u,m.y-f,m.z-g)}lerpTo(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:f=0,y:g=0,z:m=0}=l,v=this;return OE({x:v.x+u*(f-v.x),y:v.y+u*(g-v.y),z:v.z+u*(m-v.z)})}footPointInSegment(l,u){const f=ME(l,this),g=ME(l,u),m=g.norm(),v=OE(l);if(0===m)return v;const _=f.projectionTo(g)/m;return v.lerpTo(u,_)}perpendicularToSegment(l,u){const f=this.footPointInSegment(l,u);return this.distanceTo(f)}};function OE(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Xt(p)?new AO(p,l,u):new AO(p.x,p.y,p.z)}let HJ=class{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;N(this,"x",void 0),N(this,"y",void 0),N(this,"z",void 0),N(this,"w",void 0),this.x=p,this.y=l,this.z=u,this.w=f}negate(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1}normalize(){const p=this.norm();this.x/=p,this.y/=p,this.z/=p,this.w/=p}norm(){return Math.hypot(this.x,this.y,this.z,this.w)}};function Og(p,l){return((p.x-l.x)**2+(p.y-l.y)**2)**.5}class GJ{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;N(this,"x",0),N(this,"y",0),N(this,"left",0),N(this,"top",0),N(this,"right",0),N(this,"bottom",0),N(this,"width",0),N(this,"height",0),this.update(l,u,f,g)}update(l,u,f,g){this.x=l,this.y=u,this.left=l,this.top=u,this.right=l+f,this.bottom=u+g,this.width=f,this.height=g}toJSON(){}}const PO=new class{constructor(){N(this,"tasks",[])}createTimer(p,l){const u=Ai();return this.tasks.push({uid:u,callback:p,time:l}),this.executeTimer(u),u}executeTimer(p){const l=this.tasks.find(f=>f.uid===p);if(!l)return;const u=()=>{l.callback(),null!==l.timer&&(l.timer=setTimeout(u,l.time))};l.timer=setTimeout(u,l.time)}clearTimer(p){const l=this.tasks.findIndex(u=>u.uid===p);l>-1&&(clearTimeout(this.tasks[l].timer),this.tasks[l].timer=null,this.tasks.splice(l,1))}};function jIe(p,l,u,f){if(g=p,m=l,v=u,_=f,Math.min(g[0],m[0])<=Math.max(v[0],_[0])&&Math.min(v[0],_[0])<=Math.max(g[0],m[0])&&Math.min(g[1],m[1])<=Math.max(v[1],_[1])&&Math.min(v[1],_[1])<=Math.max(g[1],m[1])&&function(g,m,v,_){let b=g[0]*(v[1]-m[1])+m[0]*(g[1]-v[1])+v[0]*(m[1]-g[1]),S=g[0]*(_[1]-m[1])+m[0]*(g[1]-_[1])+_[0]*(m[1]-g[1]);return!((b^S)>=0&&0!==b&&0!==S||(b=v[0]*(g[1]-_[1])+_[0]*(v[1]-g[1])+g[0]*(_[1]-v[1]),S=v[0]*(m[1]-_[1])+_[0]*(v[1]-m[1])+m[0]*(_[1]-v[1]),(b^S)>=0&&0!==b&&0!==S))}(p,l,u,f)){let g=(f[0]-u[0])*(p[1]-l[1])-(l[0]-p[0])*(u[1]-f[1]),m=(p[1]-u[1])*(l[0]-p[0])*(f[0]-u[0])+u[0]*(f[1]-u[1])*(l[0]-p[0])-p[0]*(l[1]-p[1])*(f[0]-u[0]);if(0===g||0===m){const _=zJ(p,l),b=zJ(u,f),S=_[0],I=_[1],k=b[0],O=b[1];if(I[0]===k[0]&&I[1]===k[1])return I;if(S[0]===O[0]&&S[1]===O[1])return S;if(Fg(I,b)&&Fg(k,_))return[k,I];if(Fg(S,b)&&Fg(O,_))return[S,O];if(Fg(S,b)&&Fg(I,b))return[S,I];if(Fg(k,b)&&Fg(O,b))return[k,O]}const v=m/g;return g=(p[0]-l[0])*(f[1]-u[1])-(l[1]-p[1])*(u[0]-f[0]),m=l[1]*(p[0]-l[0])*(f[1]-u[1])+(f[0]-l[0])*(f[1]-u[1])*(p[1]-l[1])-f[1]*(u[0]-f[0])*(l[1]-p[1]),[v,m/g]}var g,m,v,_;return!1}function zJ(p,l){return p[0]===l[0]?p[1]<l[1]?[p,l]:[l,p]:p[0]<l[0]?[p,l]:[l,p]}function Fg(p,l){return l[0][0]===l[1][0]?p[1]>=l[0][1]&&p[1]<=l[1][1]:p[0]>=l[0][0]&&p[0]<=l[1][0]}function FE(p){const l=[];let u=null;const f=p.slice(0,8).concat(p[0],p[1]);for(let g=0;g<4;g++){const m=f[2*(g+1)+1]-f[2*g+1],v=f[2*(g+1)]-f[2*g];u=0===m&&0===v?0:m/v,l.push(u)}return l}function LE(p){const[l,u,f,g,m,v,_,b]=p,S=(_-l)*(g-u)-(b-u)*(f-l),I=(l-f)*(v-g)-(u-g)*(m-f),k=(f-m)*(b-v)-(g-v)*(_-m),O=(m-_)*(u-b)-(v-b)*(l-_);if(S*I*k*O<0)return!1;const j=p.slice().concat(p.slice(0,2)),W=FE(p);if(W.length)for(let J=0;J<2;J++)if(W[J]!==W[J+2]&&jIe(j.slice(2*J,2*(J+1)),j.slice(2*(J+1),2*(J+2)),j.slice(2*(J+2),2*(J+3)),j.slice(2*(J+3),2*(J+4))))return!1;return S*I*k*O>0}function Lg(p,l){return((p.x-l.x)**2+(p.y-l.y)**2)**.5}function HIe(p){const{type:l,value:u}=p;return"hex"===l?`#${u}`:"literal"===l?u:"rgb"===l?`rgb(${u.join(",")})`:`rgba(${u.join(",")})`}const GIe=function(){const p_linearGradient=/^(linear\-gradient)/i,p_repeatingLinearGradient=/^(repeating\-linear\-gradient)/i,p_radialGradient=/^(radial\-gradient)/i,p_repeatingRadialGradient=/^(repeating\-radial\-gradient)/i,p_conicGradient=/^(conic\-gradient)/i,p_sideOrCorner=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,p_extentKeywords=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,p_positionKeywords=/^(left|center|right|top|bottom)/i,p_pixelValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,p_percentageValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,p_emValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,p_angleValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,p_startCall=/^\(/,p_endCall=/^\)/,p_comma=/^,/,p_hexColor=/^\#([0-9a-fA-F]+)/,p_literalColor=/^([a-zA-Z]+)/,p_rgbColor=/^rgb/i,p_rgbaColor=/^rgba/i,p_number=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/;let l="";function u(le){throw new Error(`${l}: ${le}`)}function f(){return g("linear-gradient",p_linearGradient,v)||g("repeating-linear-gradient",p_repeatingLinearGradient,v)||g("radial-gradient",p_radialGradient,_)||g("repeating-radial-gradient",p_repeatingRadialGradient,_)||g("conic-gradient",p_conicGradient,_)}function g(le,he,_e){return m(he,Ve=>{const ee=_e();return ee&&(ie(p_comma)||u("Missing comma before color stops")),{type:le,orientation:ee,colorStops:O(j)}})}function m(le,he){const _e=ie(le);if(_e){ie(p_startCall)||u("Missing (");const Ve=he(_e);return ie(p_endCall)||u("Missing )"),Ve}}function v(){return Q("directional",p_sideOrCorner,1)||Q("angular",p_angleValue,1)}function _(){let le,he,_e=b();return _e&&(le=[],le.push(_e),he=l,ie(p_comma)&&(_e=b(),_e?le.push(_e):l=he)),le}function b(){let le=function(){const he=Q("shape",/^(circle)/i,0);return he&&(he.style=K()||S()),he}()||function(){const he=Q("shape",/^(ellipse)/i,0);return he&&(he.style=J()||S()),he}();if(le)le.at=I();else{const he=S();if(he){le=he;const _e=I();_e&&(le.at=_e)}else{const _e=k();_e&&(le={type:"default-radial",at:_e})}}return le}function S(){return Q("extent-keyword",p_extentKeywords,1)}function I(){if(Q("position",/^at/,0)){const le=k();return le||u("Missing positioning value"),le}}function k(){const le={x:J(),y:J()};if(le.x||le.y)return{type:"position",value:le}}function O(le){let he=le();const _e=[];if(he)for(_e.push(he);ie(p_comma);)he=le(),he?_e.push(he):u("One extra comma");return _e}function j(){const le=Q("hex",p_hexColor,1)||m(p_rgbaColor,()=>({type:"rgba",value:O(W)}))||m(p_rgbColor,()=>({type:"rgb",value:O(W)}))||Q("literal",p_literalColor,0);return le||u("Expected color definition"),le.length=J(),le}function W(){return ie(p_number)[1]}function J(){return Q("%",p_percentageValue,1)||Q("position-keyword",p_positionKeywords,1)||K()}function K(){return Q("px",p_pixelValue,1)||Q("em",p_emValue,1)}function Q(le,he,_e){const Ve=ie(he);if(Ve)return{type:le,value:Ve[_e]}}function ie(le){const he=/^[\n\r\t\s]+/.exec(l);he&&oe(he[0].length);const _e=le.exec(l);return _e&&oe(_e[0].length),_e}function oe(le){l=l.substring(le)}return function(le){return l=le,function(){const he=O(f);return l.length>0&&u("Invalid input not EOF"),he}()}}(),YJ=(p,l,u)=>{try{void 0===l?u.appendChild(p):u.insertBefore(p,l)}catch(f){}},Ox=()=>{const p=window;if(p){if(p.devicePixelRatio)return p.devicePixelRatio;if(p.screen.deviceXDPI&&p.screen.logicalXDPI)return p.screen.deviceXDPI/p.screen.logicalXDPI}return 1};function Fx(p){let l="0px",u="",f="solid";if(!pt(p)&&""!==p){const g=document.createElement("div");g.style.border=p;const{borderWidth:m,borderColor:v,borderStyle:_}=g.style;"initial"!==m&&""!==m&&(l=m),"initial"!==v&&""!==v&&(u=v),"initial"!==_&&""!==_&&(f=_)}return{borderWidth:l,borderColor:u,borderStyle:f}}const __=p=>{const{pointerType:l}=p;return"touch"===l||"pen"===l||void 0===l},XJ=function(p,l){const u=p.indexOf(l);return!(u<0||(p.splice(u,1),0))},$J=function(p,l,u){if(Xt(u)){let f=[],g=[];if(l.includes(u)){const S=l.length;if(S>1){const I=l.indexOf(u);0===I?g=l.slice(1):I===S-1?f=l.slice(0,-1):(f=l.slice(0,I),g=l.slice(I+1))}}else f=l;const m=p[u],v=f.map(S=>p[S]),_=g.map(S=>p[S]);v.forEach(S=>{const I=p.indexOf(S);I>-1&&p.splice(I,1)}),_.forEach(S=>{const I=p.indexOf(S);I>-1&&p.splice(I,1)});const b=p.indexOf(m);p.splice(b+1,0,..._),p.splice(b,0,...v)}else l.map(f=>p[f]).forEach(f=>{const g=p.indexOf(f);p.splice(g,1),p.push(f)});return!0},qJ=function(p,l,u){if(l===u)return!0;const f=p[l];return p[l]=p[u],p[u]=f,!0},KJ=function(p,l){const u=l.length;return!(p.length!==u||!u||(l.every((f,g)=>f===g)||l.map(f=>p[f]).forEach((f,g)=>{p[g]=f}),0))};function dl(p){return null==p}const NE=(p,l)=>p in l,JJ=(p,l)=>{const u=[];for(;p;){const f=p.match(l);if(!f)break;u.push(f),p=p.substring(f.index+f[0].length)}return u};function yo(p,l){return Object.keys(p).forEach(u=>{pt(l[u])?l[u]=p[u]:Un(p[u])?yo(p[u],l[u]):l[u]=p[u]}),l}class RO{static read(l){return new Promise((u,f)=>{const g=Object.prototype.toString.call(l);if("[object String]"===g){if(0===l.indexOf("blob:")||l.indexOf(".jpg")>0||l.indexOf(".jpeg")>0||l.indexOf(".png")>0||l.indexOf(".bmp")>0||l.indexOf(".dib")>0||l.indexOf(".pdf")>0||l.indexOf(".tiff")>0||l.indexOf(".tif")>0)return fetch(l,{mode:"cors"}).then(m=>m.arrayBuffer()).then(m=>u(m)).catch(m=>Promise.reject(m));f("Error url: Can not read the file URL")}else if("[object Blob]"===g||"[object FileList]"===g||"[object File]"===g){let m=l;"[object FileList]"!==g&&"[object File]"!==g||(m=l[0]?l[0]:l),zIe.call(RO,m,u,f)}else"[object ArrayBuffer]"===g||"[object Uint8ClampedArray]"===g?u(l):f(`Not support source type: ${g}`)})}}function zIe(p,l,u){let f,g,m=0;try{f=new ArrayBuffer(p.size),g=new Uint8Array(f)}catch(v){u(v)}!function v(){const _=new FileReader;_.onload=function(I){var k;if(null!=I&&null!==(k=I.target)&&void 0!==k&&k.result){const O=I.target.result;g.set(new Uint8Array(O),m),m+=O.byteLength,m<p.size?v():l(f)}else u(I)},_.onerror=function(I){u(I)},_.onabort=function(I){u(I)};const b=Math.min(m+1048576,p.size),S=p.slice(m,b);_.readAsArrayBuffer(S)}()}function BE(p){return kO.apply(this,arguments)}function kO(){return kO=Fe(function*(p){let l;if(p instanceof ArrayBuffer)p.byteLength>12&&(l=new Uint8Array(p.slice(0,12)));else if(p instanceof Blob&&p.size>12){const u=p.slice(0,12),f=yield RO.read(u);l=new Uint8Array(f)}if(l){if(37===(u=l)[0]&&80===u[1]&&68===u[2]&&70===u[3])return"application/pdf";if(function(u){return 137===u[0]&&80===u[1]&&78===u[2]&&71===u[3]}(l))return"image/png";if(function(u){return 255===u[0]&&216===u[1]}(l))return"image/jpeg";if(function(u){return 66===u[0]&&77===u[1]}(l))return"image/bmp";if(function(u){return 73===u[0]&&73===u[1]&&42===u[2]&&0===u[3]||77===u[0]&&77===u[1]&&0===u[2]&&42===u[3]}(l))return"image/tiff";if(function(u){return 0===u[0]&&0===u[1]&&0===u[2]&&12===u[3]&&106===u[4]&&80===u[5]&&32===u[6]&&32===u[7]||255===u[0]&&79===u[1]&&255===u[2]&&81===u[3]}(l))return"image/jp2";if(function(u){return 82===u[0]&&73===u[1]&&70===u[2]&&70===u[3]&&87===u[8]&&69===u[9]&&66===u[10]&&80===u[11]}(l))return null;if(p instanceof Blob&&("application/pdf"===p.type||"image/bmp"===p.type||"image/jp2"===p.type||"image/jpeg"===p.type||"image/png"===p.type||"image/tiff"===p.type||"image/rgba"===p.type))return p.type}var u;return p instanceof Blob&&"application/ddv-blank-image"===p.type?p.type:null}),kO.apply(this,arguments)}function Kn(p,l,u){return l===u?p:Xt(p)?p/l*u:Di(p)?p.map(f=>Di(f)?[f[0]/l*u,f[1]/l*u]:f/l*u):(p=qe({},p),Object.keys(p).forEach(f=>{p[f]=p[f]/l*u}),p)}function MO(p,l){return p.every((u,f)=>{let[g,m]=u;const[v,_]=l[f];return g===v&&m===_})}function Wh(p,l){return Number.parseFloat(p.toFixed(l))}class QJ{constructor(){N(this,"disposed",!1),N(this,"toDispose",new Set)}get isDisposed(){return this.disposed}add(l){if(!l)return l;if(l===this)throw new Error("Cannot register a disposable on itself!");return this.disposed||this.toDispose.add(l),l}delete(l){if(l){if(l===this)throw new Error("Cannot dispose a disposable on itself!");this.toDispose.delete(l),l.dispose()}}dispose(){this.disposed||(this.disposed=!0,this.clear())}clear(){try{for(const l of this.toDispose)if(l)try{l.dispose()}catch(u){throw new Error("can not dispose an object")}}finally{this.toDispose.clear()}}}class rr{constructor(){N(this,"store",new QJ)}dispose(){this.store.dispose()}register(l){if(l===this)throw new Error("Cannot register a disposable on itself!");return this.store.add(l)}}class WE{static create(l){return new WE(l)}constructor(l){N(this,"isDisposed",!1),N(this,"listeners",void 0),N(this,"options",void 0),this.options=l,this.listeners=[]}dispose(){this.isDisposed||(this.isDisposed=!0,this.listeners&&(this.listeners=null))}on(l,u,f){var g,m,v,_;if(this.isDisposed)return{dispose:()=>{}};const b={uid:Ai(),callback:l,context:u};this.listeners.length?this.listeners.push(b):(null!==(g=this.options)&&void 0!==g&&null!==(m=g.beforeAddFirstListener)&&void 0!==m&&m.call(g,this),this.listeners.push(b),null===(v=this.options)||void 0===v||null===(_=v.afterAddFirstListener)||void 0===_||_.call(v,this));const S={dispose:()=>{this.remove(b)}};return f instanceof QJ?f.add(S):Array.isArray(f)?f.push(S):f instanceof rr&&f.register(S),S}remove(l){var u,f,g,m;if(null!==(u=this.options)&&void 0!==u&&null!==(f=u.beforeRemoveListener)&&void 0!==f&&f.call(u,this),!this.listeners)return;if(1===this.listeners.length)return this.listeners=[],void(null===(g=this.options)||void 0===g||null===(m=g.afterRemoveLastListener)||void 0===m||m.call(g,this));const v=this.listeners.indexOf(l);if(v<0)throw new Error("Attempted to dispose unknown listener.");this.listeners.splice(v,1)}off(l){if(this.isDisposed||!this.listeners)return;const u=this.listeners.findIndex(f=>f.callback===l);u>-1&&this.listeners.splice(u,1)}emit(l){this.listeners&&this.listeners.length&&this.listeners.slice().forEach(u=>{try{u.context?u.callback.call(u.context,l):u.callback(l)}catch(f){}})}}function Xo(p,l,u){return{on:(f,g)=>{const m=new WE({beforeAddFirstListener:()=>{p.addEventListener(l,f,g)},afterRemoveLastListener:()=>{p.removeEventListener(l,f)}});u.register(m.on(()=>{})),u.register(m)}}}function Et(p){const l=p.register(new WE);return{on:(u,f)=>l.on(u,p,f),emit:u=>{l.emit(u)}}}var OO,C_;!function(p){p.core="ddv-core",p.reader="ddv-reader",p.detector="ddv-detector",p.loader="ddv-loader"}(C_||(C_={}));class gn{static get isApple(){return at(gn,this,eQ)._}static get version(){return vn.CryptoModule.ver}static enableDebugOutput(l,u){l?vn.setLogFunc("logDebug",g=>{var m,v,_;let b=hn(g);b.srcBuffer&&(b.srcBuffer=at(gn,this,Lx).call(this,b.srcBuffer)),null!==(m=b.result)&&void 0!==m&&m.srcBuffer&&(b.result.srcBuffer=at(gn,this,Lx).call(this,b.result.srcBuffer)),null!==(v=b.result)&&void 0!==v&&v.imageData&&(b.result.imageData=at(gn,this,Lx).call(this,b.result.imageData)),null!==(_=b.result)&&void 0!==_&&_.pdfData&&(b.result.pdfData=at(gn,this,Lx).call(this,b.result.pdfData)),b.imageData&&(b.imageData=at(gn,this,Lx).call(this,b.imageData)),u&&(xn(b)&&(b=`[${Date.now()}]${b}`),u(b))}):vn.setLogFunc("",void 0)}static getMemoryUsed(){return yr.Instance.getMemoryUsed()}static get heapConfig(){return vn.HeapConfig}static updateHeapConfig(l,u,f){vn.UpdateHeapConfig(l,u,f),at(gn,this,b_)._[l]||(at(gn,this,b_)._[l]={}),u&&(at(gn,this,b_)._[l].maxHeapSize=u),f&&(at(gn,this,b_)._[l].initHeapSize=f)}static getLicenseInfo(l,u,f){var g=this;return Fe(function*(){g.Init(l,u,f),u&&(yield yr.Instance.loadModule(vn.CryptoModule)),yield yr.Instance.loadModule(vn.ImageIOModule),yield oo.updateLicense(at(gn,g,Nx)._,at(gn,g,FO)._,at(gn,g,UE)._);const m=new pJ(at(gn,g,Nx)._);try{return yield m.getLicenseInfo()}finally{m.terminate()}})()}static Init(l,u,f){var g;Nx._=at(gn,this,null!=l?l:at(gn,this,Nx)._),void 0!==u&&(FO._=at(gn,this,u?1:0)),UE._=at(gn,this,null!=f?f:at(gn,this,UE)._);const m={bMac:"Mac"===cl.OS,biPhone:"iPhone"===cl.OS,biPad:"iPad"===cl.OS};eQ._=at(gn,this,m.bMac||m.biPhone||m.biPad),vn.NavInfo=m,vn.License=at(gn,this,Nx)._,vn.UUID=at(gn,this,UE)._,vn.LicMode=at(gn,this,FO)._,at(gn,this,ZJ).call(this),vn.UpdateHeapConfig(C_.detector,null!==(g=at(gn,this,YIe).call(this,C_.detector))&&void 0!==g?g:100)}static isResourceDirValid(){var l=arguments,u=this;return Fe(function*(){let f=l.length>0&&void 0!==l[0]?l[0]:3,g=l.length>1&&void 0!==l[1]?l[1]:1e3;at(gn,u,ZJ).call(u);let m=0;for(;m<f;){try{const v=vn.PdfReaderModule;if(at(gn,u,tQ)._===v.script)return!0;const _=qe({},v.fetchOptions);if(_.method="HEAD",(yield fetch(v.script,_)).ok)return tQ._=at(gn,u,v.script),!0}catch(v){}yield new Promise(v=>setTimeout(v,g)),m+=1}return!1})()}static loadPdfReader(l,u,f){var g=this;return Fe(function*(){return g.Init(l,u,f),at(gn,g,Fl)._||(yield yr.Instance.loadModule(vn.ImageProcModule),Fl._=at(gn,g,yr.Instance.loadModule(vn.PdfReaderModule)),yield at(gn,g,Fl)._),at(gn,g,Fl)._})()}static loadMain(l,u,f){var g=this;return Fe(function*(){return g.Init(l,u,f),at(gn,g,Vu)._||(Vu._=at(gn,g,yr.Instance.loadModule(vn.ImagecoreModule)),yield at(gn,g,Vu)._,yr.Instance.loadModule(vn.ImageProcModule)),at(gn,g,Vu)._})()}static load(l,u,f){var g=this;return Fe(function*(){yr.Instance.terminate(!0),g.Init(l,u,f),yield g.loadMain(l,u,f)})()}static preloadModule(l){var u=this;return Fe(function*(){let f;const g=qe({},vn.PdfReaderModule),m=qe({},vn.ImageProcModule);switch(l){case"core":if(at(gn,u,Vu)._){f=at(gn,u,Vu)._;break}Vu._=at(gn,u,yr.Instance.loadModule(vn.ImagecoreModule)),f=at(gn,u,Vu)._,yield at(gn,u,Vu)._;break;case"pdf":case"proc":if(at(gn,u,Fl)._){f=at(gn,u,Fl)._;break}m.workerName=C_.loader,Fl._=at(gn,u,yr.Instance.loadModule(m)),f=at(gn,u,Fl)._,yield at(gn,u,Fl)._,g.workerName=C_.loader,Fl._=at(gn,u,yr.Instance.loadModule(g)),f=at(gn,u,Fl)._,yield at(gn,u,Fl)._,yr.Instance.terminateWorker(g.workerName)}return f})()}static unloadMainWorker(){Vu._=at(gn,this,void 0),yr.Instance.terminateWorker(vn.ImageIOModule.workerName)}static unloadPdfReaderWorker(){Fl._=at(gn,this,void 0),yr.Instance.terminateWorker(vn.PdfReaderModule.workerName)}static unloadDocumentDetectorWorker(){yr.Instance.terminateWorker(vn.DetectorModule.workerName)}static unloadWorker(){var l=this;return Fe(function*(){Vu._=at(gn,l,void 0),Fl._=at(gn,l,void 0),yield yr.Instance.terminate(!0)})()}static unload(){var l=this;return Fe(function*(){yr.unload(),vn.unload(),oo.unload(),Vu._=at(gn,l,void 0),Fl._=at(gn,l,void 0);try{yield yr.Instance.terminate(!0)}catch(u){}})()}static getUseSimd(){if(this.enableSimd){var l;const u=navigator;if(null!==(l=u.userAgentData)&&void 0!==l&&l.brands)for(const{brand:f,version:g}of u.userAgentData.brands)if(f&&("Chromium"===f||"Google Chrome"===f)&&g&&parseInt(g,10)>=94)return!0}return!1}static getPdfFonts(){return DE.getPdfFonts()}static getPdfInfo(l,u){return Fe(function*(){let f;try{f=new DE;const g=yield f.getPdfInfo({fileSource:l,password:u});return f.destroy(),g}catch(g){return null}finally{f&&f.destroy()}})()}}function Lx(p){return p instanceof ArrayBuffer?{type:"ArrayBuffer",length:p.byteLength}:p instanceof Uint8ClampedArray?{type:"Uint8ClampedArray",length:p.byteLength}:{type:Object.prototype.toString.call(p)}}function YIe(p){return void 0!==at(OO,this,b_)._[p]?at(OO,this,b_)._[p].maxHeapSize:null}function ZJ(){vn.UseSimd=!!this.enableSimd&&this.getUseSimd();const p={resourceDir:this.resourceDir,workerScript:"",useFastCompEdition:!1,useSimd:vn.UseSimd,fetchOptions:this.fetchOptions};p.workerScript=vn.ImageIOWorkerJS,vn.ImageIOResource=p;const l=qe({},p);l.workerScript=vn.ImageIOWorkerJS,vn.PdfReaderResource=l}OO=gn,N(gn,"resourceDir","");var Nx={_:""},FO={_:rp.LONG_KEY},UE={_:""};N(gn,"fetchOptions",{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}),N(gn,"enableSimd",!0);var Tr,La,VE,Fl={_:void 0},Vu={_:void 0},eQ={_:!1},tQ={_:void 0},b_={_:Object.create(null)};class Ng{constructor(){N(this,"processor",void 0),this.processor=new LIe}initImage(l){var u=this;return Fe(function*(){return u.processor.initImage(l.source,l.isRGBA,l.width,l.height,l.isBGRA)})()}getImage(l){var u=this;return Fe(function*(){return yield u.processor.getImage(l.jpegQuality,l.ifDeleteObject,l.isRGBA,l.bitDepth,l.xDpi,l.yDpi,l.returnBlob,l.returnType,gn.isApple)})()}getImageInfo(){var l=this;return Fe(function*(){return yield l.processor.getImageInfo()})()}freeReservedData(){var l=this;return Fe(function*(){l.processor.freeReservedData()})()}toBinaryLevel(l,u){var f=this;return Fe(function*(){return f.processor.toBinaryLevel(l,u)})()}toGrayscale(l){var u=this;return Fe(function*(){return u.processor.toGrayscale(l)})()}removeShadowLevel(l,u){var f=this;return Fe(function*(){return f.processor.removeShadowLevel(l,u)})()}brighten(){var l=this;return Fe(function*(){return l.processor.brighten()})()}invert(){var l=this;return Fe(function*(){return l.processor.invert()})()}changeBrightnessAndContrast(l,u){var f=this;return Fe(function*(){return f.processor.changeBrightnessAndContrast(l,u)})()}perspective(l){var u=this;return Fe(function*(){return u.processor.perspective(l[0][0],l[0][1],l[1][0],l[1][1],l[2][0],l[2][1],l[3][0],l[3][1])})()}getSkewAngle(l){var u=this;return Fe(function*(){return u.processor.getSkewAngle(l)})()}rotate(l){var u=this;return Fe(function*(){return u.processor.rotate(l.angle,l.fillColor,l.keepSize,l.mode)})()}flip(){var l=this;return Fe(function*(){return l.processor.flip()})()}resize(l,u,f){var g=this;return Fe(function*(){return g.processor.resize(l,u,f)})()}resizeWidth(l,u){var f=this;return Fe(function*(){return f.processor.setImageWidth(l,u)})()}resizeHeight(l,u){var f=this;return Fe(function*(){return f.processor.setImageHeight(l,u)})()}crop(l){var u=this;return Fe(function*(){return u.processor.crop(l.left,l.top,l.left+l.width,l.top+l.height)})()}erase(l,u){var f=this;return Fe(function*(){return f.processor.erase(l.left,l.top,l.left+l.width,l.top+l.height,u)})()}setDpi(l){var u=this;return Fe(function*(){return u.processor.setDPI(l.rawResolutionX,l.rawResolutionY,l.resolutionX,l.resolutionY,l.resample,l.mode)})()}drawQuadrangle(l){var u=this;return Fe(function*(){return u.processor.drawQuadrangle(l.location[0][0],l.location[0][1],l.location[1][0],l.location[1][1],l.location[2][0],l.location[2][1],l.location[3][0],l.location[3][1],l)})()}filter(l,u,f){var g=this;return Fe(function*(){return g.processor.filter(l,u,f)})()}setImageWidth(l,u){var f=this;return Fe(function*(){return f.processor.setImageWidth(l,u)})()}setImageHeight(l,u){var f=this;return Fe(function*(){return f.processor.setImageHeight(l,u)})()}terminate(l){return this.processor.terminate(l)}}class Sv{constructor(){N(this,"reader",void 0),this.reader=new FIe}readImage(l){var u=this;return Fe(function*(){return yield u.reader.readImage(l.source,l.outputType,l.jpegQuality,l.returnBase64,gn.isApple)})()}readImageInfo(l){var u=this;return Fe(function*(){return yield u.reader.readImageInfo(l)})()}cancelReadImage(l,u){this.reader.cancelReadImage(l,u)}readTiffPage(l){var u=this;return Fe(function*(){return yield u.reader.readTiffPage(l.source,l.index,l.outputType,l.returnBase64,gn.isApple)})()}readTiffPageInfo(l,u){var f=this;return Fe(function*(){const{imageInfos:g}=yield f.reader.getTiffPageInfos(l,u);return g})()}getTiffPageCount(l){var u=this;return Fe(function*(){return(yield u.reader.getTiffInfo(l)).pageCount})()}cancelReadTiffPage(l,u){this.reader.cancelReadTiffPage(l,u)}destroy(){var l;null===(l=this.reader)||void 0===l||l.destroy(),this.reader=void 0}}(function(p){p[p.RGBA=1]="RGBA",p[p.BGRA=2]="BGRA",p[p.JPEG=3]="JPEG",p[p.PNG=4]="PNG"})(Tr||(Tr={})),function(p){p[p.IT_DIB=-1]="IT_DIB",p[p.IT_RGBA=-2]="IT_RGBA",p[p.IT_BGRA=-3]="IT_BGRA",p[p.IT_BMP=0]="IT_BMP",p[p.IT_JPG=1]="IT_JPG",p[p.IT_PNG=3]="IT_PNG",p[p.IT_ALL=5]="IT_ALL"}(La||(La={})),function(p){p[p.RT_AUTO=-1]="RT_AUTO",p[p.RT_BINARY=1]="RT_BINARY",p[p.RT_BASE64=2]="RT_BASE64"}(VE||(VE={}));class nQ{constructor(){N(this,"writer",void 0),this.writer=new pJ}terminate(){var l;null===(l=this.writer)||void 0===l||l.terminate(),this.writer=void 0}createTiff(){return this.writer.createTiff()}addTiffTag(l,u,f){return this.writer.addTag(l,u,f)}appendImage(l,u){var f=this;return Fe(function*(){var g;return u=null!==(g=u)&&void 0!==g?g:{},yield f.writer.appendImage(l,u.inputType,u.tiffFormat,u.jpegQuality,u.is1Bit)})()}getTiff(){var l=this;return Fe(function*(){return(yield l.writer.getTiff(VE.RT_BINARY)).imageData})()}saveImage(l,u){var f=this;return Fe(function*(){var g;return u=null!==(g=u)&&void 0!==g?g:{},(yield f.writer.saveImage(l,u.outputType,u.jpegQuality,u.returnType)).imageData})()}}class jE{constructor(){N(this,"reader",void 0),this.reader=new DE}initFonts(l){var u;const f=null==l||null===(u=l.renderOptions)||void 0===u?void 0:u.fonts;if(f)for(const g of f)g.name&&g.data&&jE.addPdfFont(g.name,g.data)}static addPdfFont(l,u){DE.addPdfFont(l,u)}readPageImageInfos(l){var u=this;return Fe(function*(){yield u.initFonts(l.readOptions);const{imageInfos:f}=yield u.reader.readPageImageInfos(l.source,l.indices,l.readOptions,l.outputType,l.isInfoOnly,l.returnBase64,gn.isApple);return f})()}readPage(l){var u=this;return Fe(function*(){return yield u.initFonts(l.readOptions),yield u.reader.readPageEx(l.source,l.index,l.readOptions,l.outputType,l.isInfoOnly,l.returnBase64,gn.isApple)})()}cancelReadPage(l,u){this.reader.cancelReadPage(l,u)}getPdfPageCount(l,u){var f=this;return Fe(function*(){return yield f.initFonts(u),(yield f.reader.getPdfInfo(l)).PdfCount})()}readAnnotations(l,u){var f=this;return Fe(function*(){const{annot:{annots:g}}=yield f.reader.readPageAnnot(l,u);return g})()}destroy(){this.reader.destroy(),this.reader=null}}class iQ{constructor(){N(this,"writer",void 0),this.writer=new NIe}terminate(){var l;null===(l=this.writer)||void 0===l||l.terminate(),this.writer=null}initPdfSetting(l){var u=this;return Fe(function*(){return u.writer.initPdfSetting(l)})()}insertBlankPage(l,u,f){var g=this;return Fe(function*(){return g.writer.insertBlankPage(l,u,f)})()}appendPage(l,u){var f=this;return Fe(function*(){return f.writer.appendPage(l,u)})()}addImageToPages(l,u,f,g,m){var v=this;return Fe(function*(){return v.writer.pageAddImage(l,u,f,g,m)})()}mergeRawPdfPages(l,u,f){var g=this;return Fe(function*(){return g.writer.mergePdf(l,u,f)})()}setPageRotation(l,u){var f=this;return Fe(function*(){return f.writer.pageSetRotation(l,u)})()}clearPageObjects(l){var u=this;return Fe(function*(){return u.writer.pageClearObjects(l)})()}setPageCropBox(l,u,f,g,m){var v=this;return Fe(function*(){return v.writer.pageSetCropBox(l,u,f,g,m)})()}setPageMediaBox(l,u,f,g,m){var v=this;return Fe(function*(){return v.writer.pageSetMediaBox(l,u,f,g,m)})()}setPageAnnotations(l,u){var f=this;return Fe(function*(){return f.writer.pageSetAnnot(l,u)})()}addAnnotationsToPage(l,u){var f=this;return Fe(function*(){return f.writer.pageAddAnnot(l,u)})()}deletePageAnnotationsByTypes(l,u){var f=this;return Fe(function*(){return f.writer.pageDeleteAnnotByTypes(l,u)})()}deletePageAnnotations(l){var u=this;return Fe(function*(){return u.writer.pageDeleteAnnot(l)})()}flattenPage(l,u){var f=this;return Fe(function*(){return f.writer.pageFlatten(l,u)})()}getPdf(l){var u=this;return Fe(function*(){return(yield u.writer.writePdf(l)).pdfData})()}getFontInfo(l){var u=this;return Fe(function*(){return yield u.writer.GetFontInfo(l)})()}ifFontsExist(l){var u=this;return Fe(function*(){return(yield u.writer.IfFontsExist(l)).fontsExist})()}}class rQ{constructor(l){N(this,"items",[]),l&&(this.items=l)}push(l){this.items.push(l)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}remove(l){"filter"===l.api&&this.items.forEach((u,f)=>{u.api===l.api&&u.params[0]===l.params[0]&&u.params[1]===l.params[1]&&u.params[2]===l.params[2]&&this.items.splice(f,1).forEach(g=>{null==g||g.resolve(null)})})}}const Bx={[Tr.BGRA]:La.IT_BGRA,[Tr.RGBA]:La.IT_RGBA,[Tr.PNG]:La.IT_PNG,[Tr.JPEG]:La.IT_JPG},XIe={[La.IT_BGRA]:Tr.BGRA,[La.IT_RGBA]:Tr.RGBA,[La.IT_PNG]:Tr.PNG,[La.IT_JPG]:Tr.JPEG},Vn={displayResolution:96,dataResolution:72,pdfResolution:72,enableResolution:!0,autoReleaseImg:ir(),autoReleaseBlob:!0};class oQ{constructor(){N(this,"db",void 0),this.db=new Map}has(l){throw new Error("Method not implemented.")}save(l){throw new Error("Method not implemented.")}getSaverConstructor(l){return this.db.get(l)}setSaverConstructor(l,u){this.db.set(l,u)}deleteSaverConstructor(l){this.db.delete(l)}clear(){this.db.clear()}}const LO=new oQ,$Ie=new oQ,qIe=new class{constructor(p,l){N(this,"saverConstructorRepo",void 0),N(this,"customSaverConstructorRepo",void 0),this.saverConstructorRepo=p,this.customSaverConstructorRepo=l}execute(p){let l=this.customSaverConstructorRepo.getSaverConstructor(p);return l||(l=this.saverConstructorRepo.getSaverConstructor(p)),new l}}(LO,$Ie),KIe=new class{constructor(p){N(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=p}execute(p){let{mime:l,saverConstructor:u}=p;this.saverConstructorRepo.setSaverConstructor(l,u)}}(LO),JIe=new class{constructor(p){N(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=p}execute(p){this.saverConstructorRepo.deleteSaverConstructor(p)}}(LO);var dp,hp,Lo,Uh;(function(p){p.TIFF_AUTO="tiff/auto",p.TIFF_FAX3="tiff/fax3",p.TIFF_FAX4="tiff/fax4",p.TIFF_LZW="tiff/lzw",p.TIFF_JPEG="tiff/jpeg"})(dp||(dp={})),function(p){p.PDF_AUTO="pdf/auto",p.PDF_FAX4="pdf/fax4",p.PDF_LZW="pdf/lzw",p.PDF_JPEG="pdf/jpeg",p.PDF_JP2000="pdf/jp2000",p.PDF_JBIG2="pdf/jbig2"}(hp||(hp={})),function(p){p.PAGE_DEFAULT="page/default",p.PAGE_A4="page/a4",p.PAGE_A4_REVERSE="page/a4reverse",p.PAGE_A3="page/a3",p.PAGE_A3_REVERSE="page/a3reverse",p.PAGE_LETTER="page/letter",p.PAGE_LETTER_REVERSE="page/letterreverse",p.PAGE_LEGAL="page/legal",p.PAGE_LEGAL_REVERSE="page/legalreverse"}(Lo||(Lo={})),function(p){p.PRINT="print",p.MODIFY_CONTENTS="modify_contents",p.COPY_CONTENTS="copy_contents",p.EXTRACT_CONTENTS="extract_contents",p.MODIFY_ANNOTATIONS="modify_annotations",p.FILL_IN="fill_in",p.ASSEMBLY="assembly",p.DEGRADED_PRINT="degraded_print"}(Uh||(Uh={}));const NO=new Map([[Lo.PAGE_DEFAULT,0],[Lo.PAGE_A4,2],[Lo.PAGE_A4_REVERSE,3],[Lo.PAGE_A3,4],[Lo.PAGE_A3_REVERSE,5],[Lo.PAGE_LETTER,6],[Lo.PAGE_LETTER_REVERSE,7],[Lo.PAGE_LEGAL,8],[Lo.PAGE_LEGAL_REVERSE,9]]),BO=new Map([[hp.PDF_AUTO,0],[hp.PDF_FAX4,2],[hp.PDF_LZW,3],[hp.PDF_JPEG,5],[hp.PDF_JP2000,6],[hp.PDF_JBIG2,7]]),HE=new Map([[dp.TIFF_AUTO,0],[dp.TIFF_FAX3,1],[dp.TIFF_FAX4,2],[dp.TIFF_LZW,3],[dp.TIFF_JPEG,5]]);var $o=new WeakMap,Vh=new WeakMap,Bg=new WeakMap;class QIe{constructor(){bi(this,$o,void 0),bi(this,Vh,void 0),bi(this,Bg,void 0),Bn($o,this,new iQ),Bn(Vh,this,new Map)}destroy(){var l;null===(l=Ye($o,this))||void 0===l||l.terminate(),Bn($o,this,void 0)}convertPageSize(l,u){let f=0,g=0,m=0,v=0,_=0,b=0,S=0,I=0;const{pdfResolution:k,displayResolution:O}=Vn;switch(l){case Lo.PAGE_A4:m=210/25.4*k,v=297/25.4*k,S=m,b=v;break;case Lo.PAGE_A4_REVERSE:m=297/25.4*k,v=210/25.4*k,S=m,b=v;break;case Lo.PAGE_A3:m=297/25.4*k,v=420/25.4*k,S=m,b=v;break;case Lo.PAGE_A3_REVERSE:m=420/25.4*k,v=297/25.4*k,S=m,b=v;break;case Lo.PAGE_LETTER:m=8.5*k,v=11*k,S=m,b=v;break;case Lo.PAGE_LETTER_REVERSE:m=11*k,v=8.5*k,S=m,b=v;break;case Lo.PAGE_LEGAL:m=8.5*k,v=14*k,S=m,b=v;break;case Lo.PAGE_LEGAL_REVERSE:m=14*k,v=8.5*k,S=m,b=v;break;default:f=u.mediaBox.left/O*k,g=u.mediaBox.top/O*k,m=u.mediaBox.width/O*k,v=u.mediaBox.height/O*k,_=u.cropBox.left/O*k,b=2*g+v-u.cropBox.top/O*k,S=_+u.cropBox.width/O*k,I=b-u.cropBox.height/O*k}return{left:f,top:g,width:m,height:v,cropLeft:_,cropTop:b,cropRight:S,cropBottom:I}}convertPdfSettings(l){const u={};return u.author=null==l?void 0:l.author,u.compression=null!=l&&l.compression?BO.get(l.compression):void 0,u.creationDate=null==l?void 0:l.creationDate,u.creator=null==l?void 0:l.creator,u.keyWords=null==l?void 0:l.keyWords,u.modifiedDate=null==l?void 0:l.modifiedDate,u.pageType=null!=l&&l.pageType?NO.get(l.pageType):void 0,u.producer=null==l?void 0:l.producer,u.quality=null==l?void 0:l.quality,u.subject=null==l?void 0:l.subject,u.title=null==l?void 0:l.title,u.version=null==l?void 0:l.version,null!=l&&l.password&&(u.encryptOptions={},u.encryptOptions.enabled=!0,u.encryptOptions.userPassword=l.password),u}init(l){var u=this;return Fe(function*(){Bn(Bg,u,l||{});const f=u.convertPdfSettings(l);yield Ye($o,u).initPdfSetting(f)})()}appendImagePage(l,u){var f=this;return Fe(function*(){const{mediaBox:g}=u,m=f.convertPageSize(Ye(Bg,f).pageType,u);let v=yield Ye($o,f).insertBlankPage(-1,m.left+m.width,m.top+m.height);const{pageIndex:_}=v;yield Ye($o,f).setPageMediaBox(_,m.left,m.top,m.left+m.width,m.top+m.height),u.rotation&&(yield Ye($o,f).setPageRotation(_,u.rotation));const{displayResolution:b,pdfResolution:S}=Vn;let I=m.width,k=m.height,O=0,j=0;if(Ye(Bg,f).pageType&&Ye(Bg,f).pageType!==Lo.PAGE_DEFAULT){const Q={width:g.width/b*S,height:g.height/b*S},ie=m.width/Q.width,oe=m.height/Q.height;if(ie<oe){const le=Q.height*ie;j=(m.height-le)/2,I=m.width,k=le}else{const le=Q.width*oe;O=(m.width-le)/2,I=le,k=m.height}Ye(Vh,f).set(_,[I/Q.width,0,0,k/Q.height,O,j])}O+=m.left,j+=m.top;let W=u.width,J=u.height,K=l;if(Ye(Bg,f).imageScaleFactor){let Q=Math.floor(u.width*Ye(Bg,f).imageScaleFactor+.5),ie=Math.floor(u.height*Ye(Bg,f).imageScaleFactor+.5);if(Q<1&&(Q=1),ie<1&&(ie=1),Q!==W&&ie!==J){const oe=new Ng;yield oe.initImage({source:l}),yield oe.resize(Q,ie),K=(yield oe.getImage({})).imageData,W=Q,J=ie,yield oe.freeReservedData()}}return v=yield Ye($o,f).addImageToPages(K,[_],{type:"image",imageWidth:I,imageHeight:k,position:[O,j]},W,J),yield Ye($o,f).setPageCropBox(_,m.cropLeft,m.cropBottom,m.cropRight,m.cropTop),v})()}appendRawPdfPages(l,u,f){var g=this;return Fe(function*(){yield Ye($o,g).mergeRawPdfPages(l,u,f)})()}changePageImage(l,u,f){var g=this;return Fe(function*(){const m=g.convertPageSize(Lo.PAGE_DEFAULT,f);return yield Ye($o,g).clearPageObjects(l),yield Ye($o,g).addImageToPages(u,[l],{type:"image",imageWidth:m.width,imageHeight:m.height,position:[m.left,m.top]},f.width,f.height)})()}setPageInfo(l){var u=this;return Fe(function*(){for(const[f,g]of l){const m=u.convertPageSize(Lo.PAGE_DEFAULT,g),{rotation:v}=g;yield Ye($o,u).setPageCropBox(f,m.cropLeft,m.cropBottom,m.cropRight,m.cropTop),yield Ye($o,u).setPageRotation(f,(v%360+360)%360)}})()}setPageRotation(l){var u=this;return Fe(function*(){for(const[f,g]of l){const m=(g%360+360)%360;yield Ye($o,u).setPageRotation(f,m)}})()}getPdf(l){var u=this;return Fe(function*(){return Ye($o,u).getPdf(l)})()}updateAnnotPoint(l,u){return[l[0]*u[0]+l[1]*u[2]+u[4],l[0]*u[1]+l[1]*u[3]+u[5]]}fixAnnotationPosition(l,u){Ye(Vh,this).has(l)&&u.forEach(f=>{const g=this.updateAnnotPoint([f.rect[0],f.rect[1]],Ye(Vh,this).get(l)),m=this.updateAnnotPoint([f.rect[2],f.rect[3]],Ye(Vh,this).get(l));f.rect=[g[0],g[1],m[0],m[1]],"Highlight"!==f.type&&"StrikeOut"!==f.type&&"Underline"!==f.type&&"Squiggly"!==f.type||f.quadPoints.forEach(v=>{const _=this.updateAnnotPoint([v[0],v[1]],Ye(Vh,this).get(l)),b=this.updateAnnotPoint([v[2],v[3]],Ye(Vh,this).get(l)),S=this.updateAnnotPoint([v[4],v[5]],Ye(Vh,this).get(l)),I=this.updateAnnotPoint([v[6],v[7]],Ye(Vh,this).get(l));v=[_[0],_[1],b[0],b[1],S[0],S[1],I[0],I[1]]})})}removePageAnnotations(l){var u=this;return Fe(function*(){yield Ye($o,u).deletePageAnnotationsByTypes(l,"")})()}setPageAnnotations(l,u,f){var g=this;return Fe(function*(){let m;return u&&u.length>0&&g.fixAnnotationPosition(l,u),f?u&&u.length>0&&(m=yield Ye($o,g).addAnnotationsToPage(l,u)):m=yield Ye($o,g).setPageAnnotations(l,u),m})()}flattenPage(l){var u=this;return Fe(function*(){return yield Ye($o,u).flattenPage(l)})()}getFontInfo(l){var u=this;return Fe(function*(){return yield Ye($o,u).getFontInfo(l)})()}ifFontsExist(l){var u=this;return Fe(function*(){return yield Ye($o,u).ifFontsExist(l)})()}}class sQ{constructor(){N(this,"imageWriter",void 0),this.imageWriter=new nQ}destroy(){var l;null===(l=this.imageWriter)||void 0===l||l.terminate(),this.imageWriter=void 0}save(l){var u=arguments,f=this;return Fe(function*(){let g=u.length>1&&void 0!==u[1]?u[1]:{};return yield f.imageWriter.saveImage(l,{outputType:g.outputType,jpegQuality:g.jpegQuality,returnType:g.returnType})})()}}class ZIe{constructor(){N(this,"imageWriter",void 0),N(this,"tiffCompression",void 0),N(this,"tiffQuality",void 0),this.imageWriter=new nQ,this.tiffCompression=HE.get(dp.TIFF_AUTO)}destroy(){var l;null===(l=this.imageWriter)||void 0===l||l.terminate(),this.imageWriter=void 0}init(l){var u=this;return Fe(function*(){if(yield u.imageWriter.createTiff(),l&&(u.tiffQuality=l.quality,l.compression&&(u.tiffCompression=HE.get(l.compression)),l.customTag))for(let f=0;f<l.customTag.length;f++)yield u.imageWriter.addTiffTag(l.customTag[f].id,l.customTag[f].content,l.customTag[f].contentIsBase64)})()}appendPage(l){var u=this;return Fe(function*(){yield u.imageWriter.appendImage(l,{inputType:void 0,tiffFormat:u.tiffCompression,jpegQuality:u.tiffQuality})})()}getTiff(){var l=this;return Fe(function*(){return l.imageWriter.getTiff()})()}}class x_{constructor(l){N(this,"uid",void 0),this.uid=l||Ai()}equals(l){return null!=l&&void 0!==l&&(this===l||!!(l instanceof x_)&&this.uid===l.uid)}}class eEe extends x_{}let Ll=class{constructor(p){N(this,"type",void 0),N(this,"uid",void 0),this.type=p,this.uid=Ai()}};class Wx{constructor(l){N(this,"bubbles",!0),N(this,"cancelBubble",!0),N(this,"cancelable",!1),N(this,"composed",!1),N(this,"currentTarget",void 0),N(this,"defaultPrevented",!1),N(this,"eventPhase",Wx.prototype.NONE),N(this,"isTrusted",void 0),N(this,"returnValue",void 0),N(this,"srcElement",void 0),N(this,"target",void 0),N(this,"timeStamp",void 0),N(this,"type",void 0),N(this,"detail",void 0),N(this,"view",void 0),N(this,"which",void 0),N(this,"path",void 0),N(this,"immediatePropagationStopped",!1),N(this,"propagationStopped",!1),N(this,"nativeEvent",void 0),N(this,"originalEvent",void 0),N(this,"eventService",void 0),N(this,"NONE",0),N(this,"CAPTURING_PHASE",1),N(this,"AT_TARGET",2),N(this,"BUBBLING_PHASE",3),this.eventService=l}initUIEvent(l,u,f,g,m){}composedPath(){const{path:l,eventService:u,target:f}=this;return!u||l&&l[this.path.length-1]===f||(this.path=f?u.getPropagationPath(f):[]),this.path}bindEvents(l,u,f){}preventDefault(){const{nativeEvent:l}=this;l instanceof Event&&l.cancelable&&l.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.immediatePropagationStopped=!0}stopPropagation(){this.propagationStopped=!0}}function Ux(p,l){l.isTrusted=p.isTrusted,l.srcElement=p.srcElement,l.timeStamp=performance.now(),l.type=p.type,l.detail=p.detail,l.view=p.view,l.which=p.which}class Wg extends Wx{constructor(l,u){super(null),this.type=l,this.detail=u}}class aQ{constructor(){N(this,"pubsub",Bh.create())}addEventListener(l,u,f){let g,m=Ds(f)&&f;Un(f)&&(m=f.capture,g=f.once),l=m?`${l}:capture`:l,u=v_(u)?u:u.handleEvent,this.pubsub.on(l,u,this,g)}dispatchEvent(l){const u=this.ownerDocument||this.document;var f;return u&&(l.eventService=(null===(f=u.defaultView)||void 0===f?void 0:f.eventService)||null,l.defaultPrevented=!1,l.path=[],l.target=this,Ca(l)),!l.defaultPrevented}removeEventListener(l,u,f){let g=Ds(f)&&f;Un(f)&&(g=f.capture),l=g?`${l}:capture`:l,u=v_(u)?u:u.handleEvent,this.pubsub.off(l,u)}removeAllEventListeners(){this.pubsub.removeAllEventListeners()}getAllEvents(){return this.pubsub.getAllEvents()}}function Yc(p,l){const u=p.currentTarget.getAllEvents()[l]||[];for(let f=0,g=u.length;f<g;f++){if(p.immediatePropagationStopped)return;const{context:m,fn:v}=u[f];v.call(m,p)}}function Ca(p,l){var u;if(l=null!==(u=l)&&void 0!==u?u:p.type,p.propagationStopped=!1,p.immediatePropagationStopped=!1,!p.target)return;const f=p.composedPath(),g=f.length;p.eventPhase=p.CAPTURING_PHASE;for(let m=0;m<g-1;m++)if(p.currentTarget=f[m],Yc(p,`${l}:capture`),WO(p))return;if(p.eventPhase=p.AT_TARGET,p.currentTarget=p.target,Yc(p,l),!WO(p)){p.eventPhase=p.BUBBLING_PHASE;for(let m=g-2;m>=0;m--)if(p.currentTarget=f[m],Yc(p,l),WO(p))return}}function WO(p){return p.propagationStopped||p.immediatePropagationStopped}const w_=p=>p/180*Math.PI,GE=p=>p/Math.PI*180;class Ug{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;N(this,"x",void 0),N(this,"y",void 0),N(this,"z",void 0),N(this,"w",void 0),this.x=l,this.y=u,this.z=f,this.w=g}static fromQuat(l){return(new Ug).setFromQuat(l)}static fromEuler(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;l=w_(l)/2,u=w_(u)/2,f=w_(f)/2;const g=Math.sin(l),m=Math.cos(l),v=Math.sin(u),_=Math.cos(u),b=Math.sin(f),S=Math.cos(f),I=new Ug;return I.setFromQuat({x:g*_*S-m*v*b,y:m*v*S+g*_*b,z:m*_*b-g*v*S,w:m*_*S+g*v*b}),I}clone(){const l=new Ug;return l.setFromQuat(this),l}setFromQuat(l){var u,f,g,m;const v=this;return v.x=null!==(u=l.x)&&void 0!==u?u:0,v.y=null!==(f=l.y)&&void 0!==f?f:0,v.z=null!==(g=l.z)&&void 0!==g?g:0,v.w=null!==(m=l.w)&&void 0!==m?m:1,this}toEuler(){const{x:l,y:u,z:f,w:g}=this,m=.4990234375,v=this.w*this.y-this.x*this.z;if(v<-m||v>m){const _=Math.sign(v);return{z:-2*_*Math.atan2(this.x,this.w),y:_*(Math.PI/2),x:0}}return{x:GE(Math.atan2(2*(u*f+g*l),g*g-l*l-u*u+f*f)),y:GE(Math.asin(-2*(l*f-g*u))),z:GE(Math.atan2(2*(l*u+g*f),g*g+l*l-u*u-f*f))}}invert(){const{x:l,y:u,z:f,w:g}=this,m=l*l+u*u+f*f+g*g,v=m?1/m:0;return this.x=-l*v,this.y=-u*v,this.z=-f*v,this.w=g*v,this}multiply(l){const{x:u,y:f,z:g,w:m}=this,{x:v,y:_,z:b,w:S}=l;return this.x=u*S+m*v+f*b-g*_,this.y=f*S+m*_+g*v-u*b,this.z=g*S+m*b+u*_-f*v,this.w=m*S-u*v-f*_-g*b,this}normalize(){const{x:l,y:u,z:f,w:g}=this,m=l*l+u*u+f*f+g*g;return this.x/=m,this.y/=m,this.z/=m,this.w/=m,this}}function zE(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Xt(p)?new Ug(p,l,u,f):Ug.fromQuat(p)}function YE(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ug.fromEuler(p,l,u)}class Gs{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;N(this,"x",void 0),N(this,"y",void 0),N(this,"z",void 0),this.x=l,this.y=u,this.z=f}static fromPoint(l){return new Gs(l.x,l.y,l.z)}static fromTwoPoint(l,u){var f,g,m,v,_,b;return new Gs((null!==(f=u.x)&&void 0!==f?f:0)-(null!==(g=l.x)&&void 0!==g?g:0),(null!==(m=u.y)&&void 0!==m?m:0)-(null!==(v=l.y)&&void 0!==v?v:0),(null!==(_=u.z)&&void 0!==_?_:0)-(null!==(b=l.z)&&void 0!==b?b:0))}static fromValue(l,u,f){return new Gs(l,u,f)}setFromVector(l){var u;this.x=l.x,this.y=l.y,this.z=null!==(u=l.z)&&void 0!==u?u:0}clone(){return new Gs(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(l){var u;return this.x*l.x+this.y*l.y+this.z*(null!==(u=l.z)&&void 0!==u?u:0)}projectionTo(l){const u=Math.hypot(l.x,l.y,l.z);return this.dot(l)/u}angle(l){const u=this.norm()*Math.hypot(l.x,l.y,l.z),f=u&&this.dot(l)/u;return Math.acos(Sr(f,-1,1))}equals(l){var u;return this.x===l.x&&this.y===l.y&&this.z===(null!==(u=l.z)&&void 0!==u?u:0)}distance(l){var u;return Math.hypot(this.x-l.x,this.y-l.y,this.z-(null!==(u=l.z)&&void 0!==u?u:0))}lerp(l){var u;let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:g,y:m,z:v}=this;return new Gs(g+f*(l.x-g),m+f*(l.y-m),v+f*((null!==(u=l.z)&&void 0!==u?u:0)-v))}normalize(){const l=this,u=l.norm();return l.x/=u,l.y/=u,l.z/=u,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(l){const u=this;return{x:u.y*l.z-u.z*l.y,y:u.z*l.x-u.x*l.z,z:u.x*l.y-u.y*l.x}}add(l){return this.x+=l.x,this.y+=l.y,this.z+=l.z,this}multiply(l){return this.x*=l.x,this.y*=l.y,this.z*=l.z,this}}function Nr(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Xt(p)?Gs.fromValue(p,l,u):Gs.fromPoint(p)}function lQ(p,l){return Gs.fromTwoPoint(p,l)}class Ar{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;N(this,"x",void 0),N(this,"y",void 0),N(this,"z",void 0),this.x=l,this.y=u,this.z=f}static fromPoint(l){return new Ar(l.x,l.y,l.z)}matrixTransform(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:u,y:f,z:g}=this,{m11:m,m21:v,m31:_,m41:b,m12:S,m22:I,m32:k,m42:O,m13:j,m23:W,m33:J,m43:K,m14:Q,m24:ie,m34:oe,m44:le}=l,he=Q*u+ie*f+oe*g+le;return Vx({x:(m*u+v*f+_*g+b)/he,y:(S*u+I*f+k*g+O)/he,z:(j*u+W*f+J*g+K)/he})}setFromPoint(l){return this.x=l.x||0,this.y=l.y||0,this.z=l.z||0,this}clone(){return Vx(this)}equals(l){const{x:u=0,y:f=0,z:g=0}=l,m=this;return m.x===u&&m.y===f&&m.z===g}distanceTo(l){const{x:u=0,y:f=0,z:g=0}=l,m=this;return Math.hypot(m.x-u,m.y-f,m.z-g)}lerpTo(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:f=0,y:g=0,z:m=0}=l,v=this;return Vx({x:v.x+u*(f-v.x),y:v.y+u*(g-v.y),z:v.z+u*(m-v.z)})}footPointInSegment(l,u){const f=lQ(l,this),g=lQ(l,u),m=g.norm(),v=Vx(l);if(0===m)return v;const _=f.projectionTo(g)/m;return v.lerpTo(u,_)}perpendicularToSegment(l,u){const f=this.footPointInSegment(l,u);return this.distanceTo(f)}}function Vx(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Xt(p)?new Ar(p,l,u):new Ar(p.x,p.y,p.z)}const cQ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class so{constructor(l){if(N(this,"a",1),N(this,"b",0),N(this,"c",0),N(this,"d",1),N(this,"e",0),N(this,"f",0),N(this,"m11",1),N(this,"m12",0),N(this,"m13",0),N(this,"m14",0),N(this,"m21",0),N(this,"m22",1),N(this,"m23",0),N(this,"m24",0),N(this,"m31",0),N(this,"m32",0),N(this,"m33",1),N(this,"m34",0),N(this,"m41",0),N(this,"m42",0),N(this,"m43",0),N(this,"m44",1),N(this,"is2D",void 0),l||(l=cQ),!xn(l)){if(!Di(l))throw new Error("Matrix4 error.");jO(l,this)}}static fromQuat(l){const{x:u,y:f,z:g,w:m}=l,v=new so;return v.m11=1-2*(f*f+g*g),v.m12=2*(u*f+g*m),v.m13=2*(u*g-f*m),v.m21=2*(u*f-g*m),v.m22=1-2*(u*u+g*g),v.m23=2*(f*g+u*m),v.m31=2*(u*g+f*m),v.m32=2*(f*g-u*m),v.m33=1-2*(u*u+f*f),v.setFromMatrix(v),v}static fromMatrix(l){const u=new so;return u.setFromMatrix(l),u.is2D=!!l.is2D,u}static fromFloat32Array(l){const u=new so;return jO(l,u),u}static fromFloat64Array(l){const u=new so;return jO(l,u),u}get isIdentity(){const l=this.toArray();for(let u=0;u<16;u++)if(l[u]!==cQ[u])return!1;return!0}translate(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.clone().translateSelf(l,u,f)}scale(l,u,f,g,m,v){var _,b,S,I,k;return null!==(_=l)&&void 0!==_||(l=1),null!==(b=u)&&void 0!==b||(u=1),null!==(S=g)&&void 0!==S||(g=0),null!==(I=m)&&void 0!==I||(m=0),null!==(k=v)&&void 0!==k||(v=0),pt(u)&&(u=l),this.clone().scaleSelf(l,u,f,g,m,v)}scale3d(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().scale3dSelf(l,u,f,g)}rotate(l,u,f){var g;return null!==(g=l)&&void 0!==g||(l=0),this.clone().rotateSelf(l,u,f)}rotateFromVector(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.clone().rotateFromVectorSelf(l,u)}rotateAxisAngle(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().rotateAxisAngleSelf(l,u,f,g)}skewX(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewXSelf(l)}skewY(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewYSelf(l)}multiply(l){return this.clone().multiplySelf(l)}flipX(){return this.clone().multiplySelf(new so([-1,0,0,1,0,0]))}flipY(){return this.clone().multiplySelf(new so([1,0,0,-1,0,0]))}inverse(){return this.clone().invertSelf()}transformPoint(l){return Vx(l).matrixTransform(this)}toFloat32Array(){const l=this.toArray();return new Float32Array(l)}toFloat64Array(){const l=this.toArray();return new Float64Array(l)}toJSON(){}multiplySelf(){const l=dQ(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return this.setFromMatrix(l),this}preMultiplySelf(){const l=dQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this);return this.setFromMatrix(l),this}translateSelf(){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const u=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{m11:1,m21:0,m31:0,m41:f,m12:0,m22:1,m32:0,m42:g,m13:0,m23:0,m33:1,m43:m,m14:0,m24:0,m34:0,m44:1}}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l);return this.multiplySelf(u),l&&(this.is2D=!1),this}scaleSelf(l,u,f,g,m,v){var _,b,S,I,k;null!==(_=l)&&void 0!==_||(l=1),null!==(b=u)&&void 0!==b||(u=1),null!==(S=g)&&void 0!==S||(g=0),null!==(I=m)&&void 0!==I||(m=0),null!==(k=v)&&void 0!==k||(v=0),(g||m||v)&&this.translateSelf(g,m,v),pt(u)&&(u=l);const O=function(){let j=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return{m11:j,m21:0,m31:0,m41:0,m12:0,m22:W,m32:0,m42:0,m13:0,m23:0,m33:J,m43:0,m14:0,m24:0,m34:0,m44:1}}(l,u,f);return this.multiplySelf(O),this.translateSelf(-g,-m,-v),1!==f&&(this.is2D=!1),this}scale3dSelf(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.scaleSelf(l,l,l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}rotateSelf(l,u,f){var g,m,v;null!==(g=l)&&void 0!==g||(l=0),pt(u)&&pt(f)&&(f=l,l=0,u=0),null!==(m=u)&&void 0!==m||(u=0),null!==(v=f)&&void 0!==v||(f=0),0===l&&0===u||(this.is2D=!1);const _=jx(f,[0,0,1]),b=jx(u,[0,1,0]),S=jx(l,[1,0,0]);return this.multiplySelf(_),this.multiplySelf(b),this.multiplySelf(S),this}rotateFromVectorSelf(){const l=Nr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),u=Nr(1,0),f=jx(l.angle(u),[0,0,1]);return this.multiplySelf(f),this}rotateAxisAngleSelf(){const l=jx(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0]);return this.multiplySelf(l),this}skewXSelf(){const l=hQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,0);return this.multiplySelf(l),this}skewYSelf(){const l=hQ(0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0);return this.multiplySelf(l),this}invertSelf(){const l=function(u){if(u[0].length!==u.length)throw new Error;const f=VO(u),g=function(m){if(m[0].length!==m.length)throw new Error("Not square matrix.");const v=m.length,_=new Array(v).fill(0).map(b=>new Array(v).fill(0));for(let b=0;b<v;b++)for(let S=0;S<v;S++)_[b][S]=uQ(m,b,S);return function(b){const S=new Array(b.length).fill(0).map(I=>new Array(b[0].length).fill(0));for(let I=0;I<S.length;I++)for(let k=0;k<S[0].length;k++)S[I][k]=b[k][I];return S}(_)}(u);for(let m=0;m<g.length;m++)for(let v=0;v<g.length;v++)g[m][v]/=f;return g}(this.toTwoDimensionalArray());return this.setFromTwoDimensionalArray(l),this}setMatrixValue(l){return new so}setFromMatrix(l){const u=this;u.m11=l.m11,u.m12=l.m12,u.m13=l.m13,u.m14=l.m14,u.m21=l.m21,u.m22=l.m22,u.m23=l.m23,u.m24=l.m24,u.m31=l.m31,u.m32=l.m32,u.m33=l.m33,u.m34=l.m34,u.m41=l.m41,u.m42=l.m42,u.m43=l.m43,u.m44=l.m44,u.a=l.m11,u.b=l.m12,u.c=l.m21,u.d=l.m22,u.e=l.m41,u.f=l.m42,!1===l.is2D&&(u.is2D=!1)}setFromTwoDimensionalArray(l){const[[u,f,g,m],[v,_,b,S],[I,k,O,j],[W,J,K,Q]]=l;this.setFromMatrix({m11:u,m21:f,m31:g,m41:m,m12:v,m22:_,m32:b,m42:S,m13:I,m23:k,m33:O,m43:j,m14:W,m24:J,m34:K,m44:Q})}clone(){return so.fromMatrix(this)}determinant(){return VO(this.toTwoDimensionalArray())}toTwoDimensionalArray(){const l=this;return[[l.m11,l.m21,l.m31,l.m41],[l.m12,l.m22,l.m32,l.m42],[l.m13,l.m23,l.m33,l.m43],[l.m14,l.m24,l.m34,l.m44]]}toArray(){const l=this;return[l.m11,l.m12,l.m13,l.m14,l.m21,l.m22,l.m23,l.m24,l.m31,l.m32,l.m33,l.m34,l.m41,l.m42,l.m43,l.m44]}decompose(){if(0===this.m44)return{};let l=function(k){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Xt(k)?new HJ(k,O,j,W):new HJ(k.x,k.y,k.z,k.w)}(0,0,0,1);const u=zE(0,0,0,1),f=Nr(0,0,0),g=Nr(0,0,0),m=Nr(0,0,0),v=this;v.normalize();const _=v.clone();if(_.m14=0,_.m24=0,_.m34=0,_.m44=1,0===_.determinant())return!1;if(0!==v.m14||0!==v.m24||0!==v.m34){const k={x:v.m14,y:v.m24,z:v.m34,w:v.m44};l=_.invertSelf().transposeSelf().multiplyVector(k)}else l.x=0,l.y=0,l.z=0,l.w=1;m.x=v.m41,m.y=v.m42,m.z=v.m43;const b=[Nr(v.m11,v.m12,v.m13),Nr(v.m21,v.m22,v.m23),Nr(v.m31,v.m32,v.m33)];f.x=b[0].norm(),b[0].normalize(),g.x=b[0].dot(b[1]),b[1]=Nr(UO(b[1],b[0],1,-g.x)),f.y=b[1].norm(),b[1].normalize(),g.x/=f.y,g.y=b[0].dot(b[2]),b[2]=Nr(UO(b[2],b[0],1,-g.y)),g.z=b[1].dot(b[2]),b[2]=Nr(UO(b[2],b[1],1,-g.z)),f.z=b[2].norm(),b[2].normalize(),g.y/=f.z,g.z/=f.z;const S=b[1].cross(b[2]);let I;if(b[0].dot(S)<0&&(f.negate(),b[0].negate(),b[1].negate(),b[2].negate()),u.x=.5*Math.max(1+b[0].x-b[1].y-b[2].z,0)**.5,u.y=.5*Math.max(1-b[0].x+b[1].y-b[2].z,0)**.5,u.z=.5*Math.max(1-b[0].x-b[1].y+b[2].z,0)**.5,u.w=.5*Math.max(1+b[0].x+b[1].y+b[2].z,0)**.5,b[2].y>b[1].z&&(u.x*=-1),b[0].z>b[2].x&&(u.y*=-1),b[1].x>b[0].y&&(u.z*=-1),u.x<.001&&u.x>=0&&u.y<.001&&u.y>=0){const k=Math.atan2(b[0].y,b[0].x);I={x:0,y:0,z:Number(GE(k).toFixed(3))}}else I=u.toEuler();return{rotation:I,scale:f,translation:m,skew:g,quaternion:u,perspective:l}}multiplyVector(l){const u=this,{x:f,y:g,z:m,w:v}=l;return{x:u.m11*f+u.m21*g+u.m31*m+u.m41*v,y:u.m12*f+u.m22*g+u.m32*m+u.m42*v,z:u.m13*f+u.m23*g+u.m33*m+u.m43*v,w:u.m14*f+u.m24*g+u.m34*m+u.m44*v}}transpose(){const l=this.clone();return l.transposeSelf(),l}transposeSelf(){const{m11:l,m21:u,m31:f,m41:g,m12:m,m22:v,m32:_,m42:b,m13:S,m23:I,m33:k,m43:O,m14:j,m24:W,m34:J,m44:K}=this;return this.setFromMatrix({m11:l,m21:m,m31:S,m41:j,m12:u,m22:v,m32:I,m42:W,m13:f,m23:_,m33:k,m43:J,m14:g,m24:b,m34:O,m44:K}),this}normalize(){const l=this,u=l.m44;l.m11/=u,l.m12/=u,l.m13/=u,l.m14/=u,l.m21/=u,l.m22/=u,l.m23/=u,l.m24/=u,l.m31/=u,l.m32/=u,l.m33/=u,l.m34/=u,l.m41/=u,l.m42/=u,l.m43/=u,l.m44/=u}getTranslation(){return Nr(this.m41,this.m42,this.m43)}getRotation(){const l=this,u=.5*(l.m11+l.m22+l.m33+1)**.5;return zE(.25*(l.m23-l.m32)/u,.25*(l.m31-l.m13)/u,.25*(l.m12-l.m21)/u,u)}getScaling(){const l=this;return Nr(Math.hypot(l.m11,l.m12,l.m13),Math.hypot(l.m21,l.m22,l.m23),Math.hypot(l.m31,l.m32,l.m33))}toEuler(){const l=this.getRotation().toEuler();return Nr(l.x,l.y,l.z)}}function UO(p,l,u,f){return{x:u*p.x+f*l.x,y:u*p.y+f*l.y,z:u*p.z+f*l.z}}function VO(p){if(p.length!==p[0].length)throw new Error;const l=p.length;let u=0;if(l>3)for(let f=0;f<l;f++)u+=p[0][f]*uQ(p,0,f);else 3===l?u=p[0][0]*p[1][1]*p[2][2]+p[0][1]*p[1][2]*p[2][0]+p[0][2]*p[1][0]*p[2][1]-p[0][2]*p[1][1]*p[2][0]-p[0][1]*p[1][0]*p[2][2]-p[0][0]*p[1][2]*p[2][1]:2===l?u=p[0][0]*p[1][1]-p[0][1]*p[1][0]:1===l&&([[u]]=p);return u}function uQ(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const f=p.length,g=new Array(f-1).fill(0).map(m=>new Array(f-1).fill(0));for(let m=0;m<f-1;m++)for(let v=0;v<f-1;v++)g[m][v]=p[m<l?m:m+1][v<u?v:v+1];return(-1)**(l+u)*VO(g)}function jO(p,l){const[u,f,g,m,v,_,b,S,I,k,O,j,W,J,K,Q]=p;if(6===p.length)l.m11=u,l.m12=f,l.m21=g,l.m22=m,l.m41=v,l.m42=_,l.m13=0,l.m14=0,l.m23=0,l.m24=0,l.m31=0,l.m32=0,l.m34=0,l.m33=1,l.m44=1,l.is2D=!0;else{if(16!==p.length)throw new Error;l.m11=u,l.m12=f,l.m13=g,l.m14=m,l.m21=v,l.m22=_,l.m23=b,l.m24=S,l.m31=I,l.m32=k,l.m33=O,l.m34=j,l.m41=W,l.m42=J,l.m43=K,l.m44=Q,l.is2D=!1}}function dQ(p,l){const u={},{m11:f,m21:g,m31:m,m41:v,m12:_,m22:b,m32:S,m42:I,m13:k,m23:O,m33:j,m43:W,m14:J,m24:K,m34:Q,m44:ie}=p,{m11:oe,m21:le,m31:he,m41:_e,m12:Ve,m22:ee,m32:ke,m42:xe,m13:Le,m23:V,m33:F,m43:z,m14:$,m24:P,m34:L,m44:X}=l;return u.m11=f*oe+g*Ve+m*Le+v*$,u.m21=f*le+g*ee+m*V+v*P,u.m31=f*he+g*ke+m*F+v*L,u.m41=f*_e+g*xe+m*z+v*X,u.m12=_*oe+b*Ve+S*Le+I*$,u.m22=_*le+b*ee+S*V+I*P,u.m32=_*he+b*ke+S*F+I*L,u.m42=_*_e+b*xe+S*z+I*X,u.m13=k*oe+O*Ve+j*Le+W*$,u.m23=k*le+O*ee+j*V+W*P,u.m33=k*he+O*ke+j*F+W*L,u.m43=k*_e+O*xe+j*z+W*X,u.m14=J*oe+K*Ve+Q*Le+ie*$,u.m24=J*le+K*ee+Q*V+ie*P,u.m34=J*he+K*ke+Q*F+ie*L,u.m44=J*_e+K*xe+Q*z+ie*X,u}function jx(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1];p=w_(p);const u=Math.sin(p/2)*Math.cos(p/2),f=Math.sin(p/2)**2,[g,m,v]=l;return{m11:1-2*(m**2+v**2)*f,m21:2*(g*m*f-v*u),m31:2*(g*v*f+m*u),m41:0,m12:2*(g*m*f+v*u),m22:1-2*(g**2+m**2)*f,m32:2*(m*v*f-g*u),m42:0,m13:2*(g*v*f-m*u),m23:2*(m*v*f+g*u),m33:1-2*(g**2+m**2)*f,m43:0,m14:0,m24:0,m34:0,m44:1}}function hQ(p,l){const u=new so;return p&&(u.m21=Math.tan(w_(p))),l&&(u.m12=Math.tan(w_(l))),u}class fQ{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;N(this,"x",void 0),N(this,"y",void 0),N(this,"z",void 0),N(this,"w",void 0),this.x=l,this.y=u,this.z=f,this.w=g}negate(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1}normalize(){const l=this.norm();this.x/=l,this.y/=l,this.z/=l,this.w/=l}norm(){return Math.hypot(this.x,this.y,this.z,this.w)}}function XE(p,l,u){const f=p.x-l.x,g=p.y-l.y;let m=(u.x-p.x)*f+(u.y-p.y)*g;return m/=f*f+g*g,new Ar(p.x+m*f,p.y+m*g)}function HO(p,l,u,f){let g=p[0]*(u[1]-l[1])+l[0]*(p[1]-u[1])+u[0]*(l[1]-p[1]),m=p[0]*(f[1]-l[1])+l[0]*(p[1]-f[1])+f[0]*(l[1]-p[1]);return!((g^m)>=0&&0!==g&&0!==m||(g=u[0]*(p[1]-f[1])+f[0]*(u[1]-p[1])+p[0]*(f[1]-u[1]),m=u[0]*(l[1]-f[1])+f[0]*(u[1]-l[1])+l[0]*(f[1]-u[1]),(g^m)>=0&&0!==g&&0!==m))}const $i=new class{recursiveUpdateHierarchy(p){const{transform:l,childNodes:u}=p;l.frozen||(l.frozen=!0,(l.localDirty||l.worldDirty)&&this.updateHierarchy(p),u.forEach(f=>{this.recursiveUpdateHierarchy(f)}))}querySelector(p,l){return p.startsWith("#")?l.find(u=>u.id===p.substring(1)):null}querySelectorAll(p,l){return[]}append(p,l,u){p.parentNode&&this.remove(p),p.parentNode=l;const{childNodes:f,sortable:g}=l;void 0!==u?f.splice(u,0,p):f.push(p),g&&(g.dirty=!0);const{transform:m}=p;m&&this.dirtyWorld(p,m),m.frozen&&this.unfreezeParentToRoot(p)}remove(p){const{parentNode:l}=p;let u=!0;if(!l)return u=!1,u;const{sortable:f}=l;f&&(f.dirty=!0);const{childNodes:g}=l,m=g.indexOf(p);m>-1?(u=!0,g.splice(m,1)):u=!1;const{transform:v}=p;return v&&this.dirtyWorld(p,v),p.parentNode=null,u}isChildExist(p){const{parentNode:l}=p;if(!l)return!1;const{childNodes:u}=l;return!(u.indexOf(p)<0)}setOrigin(p,l){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Xt(l)&&(l=Gs.fromValue(l,u));const{transform:f}=p;f.origin.equals(l)||(f.origin.setFromVector(l),this.dirtyLocal(p,f))}getOrigin(p){return p.transform.origin}setPosition(p,l){const{transform:u}=p,f=Gs.fromValue(l.x,l.y,l.z||0),g=this.getPosition(p);if(f.equals(g))return;let m=this.getWorldTransform(p);const v=this.getPosition(p),_=f.x-v.x,b=f.y-v.y,S=f.z-v.z;if(u.position=f,p.hasParentTransform()){m=(new so).translateSelf(_,b,S).multiply(m);const{worldTransform:I}=p.parentNode.transform,k=this.getWorldTransform(p);k.m41=f.x,k.m42=f.y,k.m43=f.z;const O=I.inverse().multiply(m),j=this.getOrigin(p),W=O.getScaling(),J=this.createScaleMatrix(W.x,W.y,W.z),K=so.fromMatrix(J).inverse(),Q=O.translate(j.x,j.y,j.z).multiply(K),ie=Q.getRotation(),oe=so.fromQuat(ie).inverse(),le=Q.multiply(oe).getTranslation();le.x-=j.x,le.y-=j.y,le.z-=j.z,u.localPosition.setFromVector(le)}else u.localPosition=f;this.dirtyLocal(p,u)}setLocalPosition(p,l){const{transform:u}=p,f=Gs.fromValue(l.x,l.y,l.z||0);f.equals(u.localPosition)||(u.localPosition=f,this.dirtyLocal(p,u))}getPosition(p){const l=this.getWorldTransform(p),{transform:u}=p,f=l.getTranslation();return u.position.setFromVector(f),p.transform.position}getLocalPosition(p){return p.transform.localPosition}translate(p,l){if(l.equals(new Gs))return;const u=this.getPosition(p),f=this.getWorldTransform(p),g=f.getScaling(),m=this.createScaleMatrix(g.x,g.y,g.z),v=f.multiply(so.fromMatrix(m).inverse()).getRotation(),_=so.fromQuat(v).transformPoint(l);180===p.getAngle()&&(_.x=-_.x,_.y=-_.y),u.add(_),this.setPosition(p,u)}translateLocal(p,l){const{transform:u}=p;if(l.equals(new Gs))return;l.multiply(u.localScale);const f=so.fromQuat(u.localRotation).transformPoint(l);u.localPosition.add(f),this.dirtyLocal(p,u)}scaleLocal(p,l){const{transform:u}=p;u.localScale.multiply(l),this.dirtyLocal(p,u)}setLocalScale(p,l){const{transform:u}=p,f=Gs.fromValue(l.x,l.y,l.z||u.localScale.z);f.equals(u.localScale)||(u.localScale=f,this.dirtyLocal(p,u))}getScale(p){const{transform:l}=p,u=this.getWorldTransform(p).getScaling();return l.scale.setFromVector(u),l.scale}getLocalScale(p){return p.transform.localScale}getRotation(p){const{transform:l}=p,u=this.getWorldTransform(p),f=u.getScaling(),g=this.createScaleMatrix(f.x,f.y,f.z),m=u.multiply(so.fromMatrix(g).inverse()).getRotation();return l.rotation.setFromQuat(m),l.rotation}getLocalRotation(p){return p.transform.localRotation}rotate(p,l){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{transform:g}=p;if(Xt(l)&&(l=Nr(l,u,f)),p.hasParentTransform()){const m=YE(l.x,l.y,l.z),v=this.getRotation(p),_=this.getRotation(p.parentNode).clone().invert().multiply(m).multiply(v).normalize();g.localRotation.setFromQuat(_),this.dirtyLocal(p,g)}else this.rotateLocal(p,l)}rotateLocal(p,l){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Xt(l)&&(l=Nr(l,u,f));const{transform:g}=p,m=YE(l.x,l.y,l.z);g.localRotation.multiply(m),this.dirtyLocal(p,g)}setAngle(p,l){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Xt(l)&&(l=Nr(l,u,f));const{transform:g}=p;if(p.hasParentTransform()){const m=YE(l.x,l.y,l.z);g.localRotation.setFromQuat(m);const v=this.getRotation(p.parentNode);v.invert(),g.localRotation.setFromQuat(v.multiply(g.localRotation)),this.dirtyLocal(p,g)}else this.setLocalAngle(p,l)}setLocalAngle(p,l){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Xt(l)&&(l=Nr(l,u,f));const{transform:g}=p,m=YE(l.x,l.y,l.z);g.localRotation.setFromQuat(m),this.dirtyLocal(p,g)}setRotation(p,l){const{transform:u}=p;if(p.hasParentTransform()){let f=this.getRotation(p.parentNode);f=f.clone().invert().multiply(l).normalize(),u.localRotation.setFromQuat(f),this.dirtyLocal(p,u)}else this.setLocalRotation(p,l)}setLocalRotation(p,l){const{transform:u}=p;u.localRotation.setFromQuat(l),this.dirtyLocal(p,u)}getAngle(p){const l=this.getWorldTransform(p);return Ug.fromQuat(l.decompose().quaternion).toEuler()}getLocalAngle(p){return this.getLocalRotation(p).toEuler()}setLocalTransform(p,l){const u=this.getOrigin(p),{rotation:g,scale:m}=l.decompose(),v=this.createScaleMatrix(m.x,m.y,m.z),_=so.fromMatrix(v).inverse(),b=l.translate(u.x,u.y,u.z).multiply(_).getTranslation();b.x-=u.x,b.y-=u.y,b.z-=u.z,this.setLocalPosition(p,b),this.setLocalAngle(p,g.x,g.y,g.z),this.setLocalScale(p,m)}createScaleMatrix(){return{m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m41:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m42:0,m13:0,m23:0,m33:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m43:0,m14:0,m24:0,m34:0,m44:1}}resetLocalTransform(p){this.setLocalScale(p,new Gs(1,1,1)),this.setLocalPosition(p,new Gs(0,0,0)),this.setLocalAngle(p,0)}getWorldTransform(p){const{transform:l}=p;if(!l.worldDirty&&!l.localDirty)return l.worldTransform;const{parentNode:u}=p;return u&&u.transform&&this.getWorldTransform(u),this.updateHierarchy(p),l.worldTransform}getLocalTransform(p){const{transform:l}=p;return l.localDirty&&l.updateLocalTransform(),l.localTransform}getBounds(p,l){const{renderable:u,childNodes:f}=p;if(l&&!u.renderBoundsDirty&&u)return u.renderBounds;if(!l&&!u.boundsDirty&&u.bounds)return u.bounds;let g=this.getTransformedGeometryBounds(p,l);f.forEach(v=>{const _=this.getBounds(v,l);_&&(g?g.addBounds(_):g=Nl.fromBounds(_))});const{clipPath:m}=p.style;if(m){const v=this.getTransformedGeometryBounds(m,!0);let _=null;v&&(_=Nl.create(),_.setFromTransformedBounds(this.getWorldTransform(p),v)),g?_&&(g=_.intersection(g)):g=_}return l?(u.renderBoundsDirty=!1,g&&(u.renderBounds=g)):(u.boundsDirty=!1,g&&(u.bounds=g)),g||Nl.create()}getLocalBounds(p){const{parentNode:l}=p;if(l){let u=new so;l.transform&&(u=this.getWorldTransform(l).inverse());const f=this.getBounds(p);if(!Nl.isEmpty(f)){const g=Nl.create();return g.setFromTransformedBounds(u,f),g}}return this.getBounds(p)}getGeometryBounds(p,l){const{geometry:u}=p;return(l?u.renderBounds:u.contentBounds)||Nl.create()}getBoundingClientRect(p){var l;let u;const f=this.getGeometryBounds(p);Nl.isEmpty(f)||(u=Nl.create(),u.setFromTransformedBounds(this.getWorldTransform(p),f));const g=null===(l=p.ownerDocument)||void 0===l?void 0:l.defaultView.getContextService().getBoundingClientRect();return u?{x:u.minX+((null==g?void 0:g.left)||0),y:u.minY+((null==g?void 0:g.top)||0),width:u.maxX-u.minX,height:u.maxY-u.minY}:{x:(null==g?void 0:g.left)||0,y:(null==g?void 0:g.top)||0,width:0,height:0}}updateHierarchy(p){const{transform:l}=p;if(l.localDirty&&l.updateLocalTransform(),l.worldDirty){var u;let f=null==p||null===(u=p.parentNode)||void 0===u?void 0:u.transform;p.parentNode&&f||(f=new pQ),l.updateWorldTransform(f)}}getTransformedGeometryBounds(p){const u=this.getGeometryBounds(p,arguments.length>1&&void 0!==arguments[1]&&arguments[1]);if(!Nl.isEmpty(u)){const f=Nl.create();return this.getWorldTransform(p),f.setFromTransformedBounds(this.getWorldTransform(p),u),f}return null}dirtyLocal(p,l){l.localDirty||(l.localDirty=!0,l.worldDirty||this.dirtyWorld(p,l))}dirtyWorld(p,l){l.worldDirty||this.unfreezeParentToRoot(p),this.recursiveDirtyWorld(p,l),function(u){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=u;for(;g;){const{renderable:v}=g;v&&(v.boundsDirty=!0,v.renderBoundsDirty=!0),g=g.parentNode}const m=new Wg("bounds-changed",{affectChildren:f});u.dispatchEvent(m)}(p,!0)}recursiveDirtyWorld(p,l){if(l.worldDirty)return;l.worldDirty=!0,l.frozen=!1,p.childNodes.forEach(g=>{const{transform:m}=g;m.worldDirty||this.recursiveDirtyWorld(g,m)});const{renderable:u}=p;u&&(u.boundsDirty=!0,u.renderBoundsDirty=!0);const f=new Dv("DOMAttrModified",p,null,null,"modelMatrix",Dv.MODIFICATION,null,null);p.dispatchEvent(f)}unfreezeParentToRoot(p){let l=p;for(;l;){const{transform:u}=l;u&&(u.frozen=!1),l=l.parentNode}}};class tEe{constructor(){N(this,"contentBounds",void 0),N(this,"renderBounds",void 0)}}class nEe{constructor(){N(this,"boundsDirty",!0),N(this,"bounds",void 0),N(this,"renderBoundsDirty",!0),N(this,"renderBounds",void 0)}isRenderable(){return this.boundsDirty||this.renderBoundsDirty}toRenderable(){this.boundsDirty=!0,this.renderBoundsDirty=!0}}class iEe{constructor(){N(this,"renderOrder",0),N(this,"lastSortedIndex",void 0),N(this,"sorted",void 0),N(this,"dirty",!1)}}let pQ=class{constructor(){N(this,"frozen",!0),N(this,"worldDirty",!1),N(this,"localDirty",!1),N(this,"localRotation",zE(0,0,0,1)),N(this,"rotation",zE(0,0,0,1)),N(this,"localScale",Nr(1,1,1)),N(this,"scale",Nr(1,1,1)),N(this,"localPosition",Nr(0,0,0)),N(this,"position",Nr(0,0,0)),N(this,"localSkew",Nr(0,0,0)),N(this,"skew",Nr(0,0,0)),N(this,"origin",Nr(0,0,0)),N(this,"worldTransform",new so),N(this,"localTransform",new so)}updateLocalTransform(){const{origin:p,localScale:l,localPosition:u,localRotation:f,localSkew:g}=this,m=new so;m.translateSelf(p.x,p.y,p.z);const v=function(b){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Xt(b)?new fQ(b,S,I,k):new fQ(b.x,b.y,b.z,b.w)}(0,0,0,1),_=this.compose(v,u,f,g,l);m.multiplySelf(_),m.translateSelf(-p.x,-p.y,-p.z),this.localTransform.setFromMatrix(m),this.localDirty=!1}updateWorldTransform(p){const l=p.worldTransform.clone();l.multiplySelf(this.localTransform),this.worldTransform.setFromMatrix(l),this.worldDirty=!1}compose(p,l,u,f,g){const m=new so;m.m14=p.x,m.m24=p.y,m.m34=p.z,m.m44=p.w,m.translateSelf(l.x,l.y,l.z);const v=so.fromQuat(u);m.multiplySelf(v);const _=new so;return f.z&&(_.m32=f.z,m.multiplySelf(_)),f.y&&(_.m32=0,_.m31=f.y,m.multiplySelf(_)),f.x&&(_.m31=0,_.m21=f.x,m.multiplySelf(_)),m.scaleSelf(g.x,g.y,g.z),m}};function GO(p,l){if(Number.isNaN(l))return{unit:"px",value:0};if(dl(l))return{unit:"px",value:0};if(Xt(l))return{unit:"px",value:l};if(l=l.trim().toLowerCase(),Number.isFinite(Number(l))&&"px".search(p)>=0)return{unit:"px",value:Number(l)};const u=[];l=l.replace(p,g=>(u.push(g),`U${g}`));const f=`U(${p.source})`;return u.map(g=>({unit:g,value:Number(l.replace(new RegExp(`U${g}`,"g"),"").replace(new RegExp(f,"g"),"*0"))}))[0]}const ni=p=>GO(/px|pt/g,p),Tv=p=>GO(/px|%|em/g,p),Hx=p=>GO(/deg|rad|grad|turn/g,p);class $E{constructor(l,u,f){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];N(this,"r",void 0),N(this,"g",void 0),N(this,"b",void 0),N(this,"alpha",void 0),N(this,"isNone",void 0),N(this,"formatted",""),this.r=l,this.g=u,this.b=f,this.alpha=g,this.isNone=m,this.formatted=`rgba(${l}, ${u}, ${f}, ${g})`}clone(){return new $E(this.r,this.g,this.b,this.alpha)}}class S_{constructor(l,u){N(this,"type",void 0),N(this,"value",void 0),this.type=l,this.value=u}clone(){return new S_(this.type,this.value)}}const rEe={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},oEe=p=>{let l;return l="angular"===p.type?Number(p.value):rEe[p.value]||0,{value:l,unit:"deg"}},sEe=p=>{if(p.includes("linear")||p.includes("radial"))return GIe(p).map(l=>{let{type:u,orientation:f,colorStops:g}=l;!function(v){var _;const{length:b}=v;var S;v[b-1].length=null!==(_=v[b-1].length)&&void 0!==_?_:{type:"%",value:"100"},b>1&&(v[0].length=null!==(S=v[0].length)&&void 0!==S?S:{type:"%",value:"0"});let I=0,k=Number(v[0].length.value);for(let j=1;j<b;j++){var O;const W=null===(O=v[j].length)||void 0===O?void 0:O.value;if(!dl(W)&&!dl(k)){for(let J=1;J<j-I;J++)v[I+J].length={type:"%",value:`${k+(Number(W)-k)*J/(j-I)}`};I=j,k=Number(W)}}}(g);const m=g.map(v=>({offset:{value:v.length.value,unit:"%"},color:HIe(v)}));if("linear-gradient"===u)return new S_(1,{angle:f?oEe(f):{value:0,unit:"deg"},steps:m});if("radial-gradient"===u){f||(f=[{type:"shape",value:"circle"}]);const v=f[0];if("shape"===(null==v?void 0:v.type)&&"circle"===(null==v?void 0:v.value)){const{cx:_,cy:b}=(I=>{let k=50,O=50,j="%",W="%";if("position"===(null==I?void 0:I.type)){const{x:J,y:K}=I.value;"position-keyword"===(null==J?void 0:J.type)&&("left"===J.value?k=0:"center"===J.value?k=50:"right"===J.value?k=100:"top"===J.value?O=0:"bottom"===J.value&&(O=100)),"position-keyword"===(null==K?void 0:K.type)&&("left"===K.value?k=0:"center"===K.value?O=50:"right"===K.value?k=100:"top"===K.value?O=0:"bottom"===K.value&&(O=100)),"px"!==(null==J?void 0:J.type)&&"%"!==(null==J?void 0:J.type)&&"em"!==(null==J?void 0:J.type)||(j=null==J?void 0:J.type,k=Number(J.value)),"px"!==(null==K?void 0:K.type)&&"%"!==(null==K?void 0:K.type)&&"em"!==(null==K?void 0:K.type)||(W=null==K?void 0:K.type,O=Number(K.value))}return{cx:{value:k,unit:j},cy:{value:O,unit:W}}})(null==v?void 0:v.at);let S;if(null!=v&&v.style){const{type:I,value:k}=v.style;S="extent-keyword"===I?k:{value:k,unit:u}}return new S_(2,{cx:_,cy:b,size:S,steps:m})}}})};function qE(p){const l=p.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),u=parseFloat(l[3]||"1"),f=Math.floor(u*parseInt(l[0],10)+255*(1-u)),g=Math.floor(u*parseInt(l[1],10)+255*(1-u)),m=Math.floor(u*parseInt(l[2],10)+255*(1-u));return`#${`0${f.toString(16)}`.slice(-2)}${`0${g.toString(16)}`.slice(-2)}${`0${m.toString(16)}`.slice(-2)}`}function aEe(p){return/^hsla?\(.+\)$/i.test(p)}function jd(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(dl(p))return null;if("currentColor"===p&&(p="black"),"transparent"===p)return new $E(0,0,0,0);const l=sEe(p);if(l)return l;if(aEe){const g=document.createElement("div");g.style.color=p,p=g.style.color}const u=WIe(p),f=[0,0,0,0];return null!==u&&(f[0]=parseInt(u.r,10)||0,f[1]=parseInt(u.g,10)||0,f[2]=parseInt(u.b,10)||0,f[3]=parseFloat(u.opacity)),new $E(...f)}function lEe(p){let l=null;Di(p)&&(l=p),xn(p)&&(l=p.split(" "));for(let f=0;f<3;f++)l[f]=l[f]?ni(l[f]).value:0;const u=jd(l[3]);return l[3]=u?u.formatted:"black",l.slice(0,4)}function cEe(p){const l=[];return xn(p)?p.split(" ").forEach(u=>{const f=ni(u);f&&l.push(f.value)}):l.push(...p),1===l.length?[l[0],l[0]]:l}const uEe=p=>{let l=p;if(xn(p)){const u=Tv(p);"%"===u.unit&&(l=u.value/100),"px"===u.unit&&(l=u.value)}return l>1&&(l=1),l},Xc={visibility:"visible",x:0,y:0,zIndex:0,anchor:[0,0],lineDash:[0,0],opacity:1,fillOpacity:1,borderOpacity:1,miterLimit:10,lineDashOffset:0,lineJoin:"miter",lineCap:"butt",borderColor:"black",renderBlendMode:"normal"},gQ={color:"rgb(0,0,0)",fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",fontSize:20};function dEe(p){const l=[];return p.forEach(u=>{l.push(Ht(qe(qe({},gQ),u),{fontSize:ni(u.fontSize||gQ.fontSize)}))}),l}function hEe(p,l,u,f){const{x:g=0,y:m=0}=u.parsedStyle,{x:v,y:_}=u.getLocalPosition();u.boundsDirty=!0,"x"===f&&g===v||"y"===f&&m===_||u.setLocalPosition(g,m)}function fEe(p,l,u){if(!(u instanceof t2||u instanceof JO||u instanceof AQ)||p===l)return;u.pathDirty=!0,u.boundsDirty=!0,u.getPath();const{x:f,y:g}=u.getBoundingRect();u.updatePosition(f,g),u.updateOrigin()}function pEe(p,l,u){u instanceof Yx&&p!==l&&(u.pathDirty=!0,u.boundsDirty=!0,u.setTextFont(),u.calculateTextPosition(),u.calculateLineWarp(),u.calculateCharPosition(),u.updateOrigin())}function gEe(p,l,u){!(u instanceof ps)||u instanceof ZO||u instanceof Ev||p!==l&&(u.pathDirty=!0,u.boundsDirty=!0,u.getPath(),u.updateOrigin())}function mEe(p,l,u){(u instanceof EQ||u instanceof Vg||u instanceof DQ)&&p!==l&&(u.pathDirty=!0,u.boundsDirty=!0,u.getPath())}function vEe(p,l,u){if(!(u instanceof QO||u instanceof JO)||p===l)return;u.pathDirty=!0,u.boundsDirty=!0,u.getPath();const{x:f,y:g}=u.getBoundingRect();u.updatePosition(f,g),u.updateOrigin()}function yEe(p,l,u){p!==l&&(u.pathDirty=!0,u.boundsDirty=!0,u.getPath())}function _Ee(p,l,u){u instanceof n2&&p!==l&&(u.pathDirty=!0,u.boundsDirty=!0,u.getPath())}function CEe(p,l,u,f){u instanceof OQ&&p!==l&&(u.setLimitWidth(u.parsedStyle.width.value),u.pathDirty=!0,u.boundsDirty=!0,("freeTextWriter"!==u.textType||"freeTextWriter"===u.textType&&["width","textContents"].includes(f))&&u.calculateContentLines(),u.getPath(),null!=u&&u.isEditMode||u.updateOrigin())}function KE(p,l,u,f,g){const m=g||[],v=p[l],_=p[u];let b=0,S=1;for(let O=l+1;O<u;O++){const W=(((I=XE(v,_,p[O])).x-(k=p[O]).x)**2+(I.y-k.y)**2)**.5;W>b&&(b=W,S=O)}var I,k;return b>=f?(KE(p,l,S,f,m),KE(p,S,u,f,m)):(!m.length&&v&&m.push(v),m.push(_)),m}function bEe(p,l,u,f,g,m){const v=function(b,S,I,k,O,j){const W=function(ke,xe,Le){const V=Math.cos(ke),F=Math.sin(ke);return function(z,$){return{x:V*(z-xe)+F*($-Le),y:-F*(z-xe)+V*($-Le)}}}(Math.atan2(j-S,O-b),(b+O)/2,(S+j)/2),J=W(b,S),K=W(I,k),Q=W(O,j),ie=Math.abs(J.x),[oe,le]=[K.y/2,0].sort((ke,xe)=>ke-xe);let Ve,ee;return[Ve,ee]=K.x>=J.x&&K.x<=Q.y?[J.x,Q.x]:K.x>0?[J.x,.5*(K.x+ie*ie/K.x)]:[.5*(K.x+ie*ie/K.x),Q.x],function(ke,xe,Le){const V=W(ke,xe);return!(V.x<Ve-Le||V.x>ee+Le||V.y<oe-Le||V.y>le+Le)}}(p,l,u,f,g,m),{getDistance:_}=function(b,S,I,k,O,j){const W=[I-b,k-S],J=[b-2*I+O,S-2*k+j],K=[2*W[0],2*W[1]],Q=1/Iv(J,J),ie=Q*Iv(W,J),oe=ie*ie,le=Iv(W,W),_e=0===Iv(J,J)?function(Ve){return 0===le?0:JE(-Iv(W,Ve)/2/le,0,1)}:function(Ve){const ee=Q*(2*le+Iv(Ve,J))/3,ke=Q*Iv(Ve,W),xe=ee-oe,Le=ie*(2*oe-3*ee)+ke;let V=Le*Le+xe*xe*xe*4;if(V>=0){V=Math.sqrt(V);const L=(V-Le)/2,X=(-V-Le)/2;return JE(Math.sign(L)*Math.abs(L)**(1/3)+Math.sign(X)*Math.abs(X)**(1/3)-ie,0,1)}const F=Math.sqrt(-xe),z=Math.acos(Le/(xe*F*2))/3,$=Math.cos(z),P=1.7320508075688772*Math.sin(z);return[JE(($+$)*F-ie,0,1),JE((-P-$)*F-ie,0,1)]};return{getDistance(Ve,ee){const ke=[b-Ve,S-ee],xe=_e(ke);if("number"==typeof xe)return Math.sqrt(zO((K[0]+J[0]*xe)*xe+ke[0],(K[1]+J[1]*xe)*xe+ke[1]));const[Le,V]=xe;return Math.sqrt(Math.min(zO(ke[0]+(K[0]+J[0]*Le)*Le,ke[1]+(K[1]+J[1]*Le)*Le),zO(ke[0]+(K[0]+J[0]*V)*V,ke[1]+(K[1]+J[1]*V)*V)))}}}(p,l,u,f,g,m);return{isHit:function(b,S){return!!v(I=b[0],k=b[1],O=S)&&_(I,k)<=O;var I,k,O}}}function JE(p,l,u){return Math.min(Math.max(p,l),u)}function Iv(p,l){return p[0]*l[0]+p[1]*l[1]}function zO(p,l){return p*p+l*l}function mQ(p,l,u,f,g){const{PI:m,cos:v,sin:_,min:b,max:S,tan:I}=Math;g-f>2*m&&(g=f+2*m);let k=S(m/12,(g-f)/12);const O=[];for(O.push({x:p+u*v(f),y:l+u*_(f)});f<g;){const j=p+u*v(f),W=l+u*_(f),J=b(g,f+k);k=b(g-f,k);const K=p+u*v(J),Q=l+u*_(J),ie=u*I(k/3);O.push({x:j-(W-l)/u*ie,y:W+(j-p)/u*ie},{x:K+(Q-l)/u*ie,y:Q-(K-p)/u*ie},{x:K,y:Q}),f+=k}return O}function vQ(p,l,u,f){const g=p-u,m=p+u,v=l-f,_=l+f,b=.551915024494,S=b*u,I=b*f,k=[];return k.push({x:m,y:l}),k.push({x:m,y:l+I},{x:p+S,y:_},{x:p,y:_}),k.push({x:p-S,y:_},{x:g,y:l+I},{x:g,y:l}),k.push({x:g,y:l-I},{x:p-S,y:v},{x:p,y:v}),k.push({x:p+S,y:v},{x:m,y:l-I},{x:m,y:l}),k}function zs(p,l){return{type:p,data:l}}function YO(p){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const u=p.length;if(u<=1)return[];const f=[],[g]=p;f.push(zs("moveTo",[g]));for(let m=0;m+3<u;m+=3)f.push(zs("bezierCurveTo",[p[m+1],p[m+2],p[m+3]]));return l&&p.length>2&&f.push(zs("lineTo",[g])),f}function Gx(p,l){return Math.sqrt((p.x-l.x)*(p.x-l.x)+(p.y-l.y)*(p.y-l.y))}function XO(p,l){const u=p.length;if(u<=1)return[];if(2===u)return[{index:0,ops:[zs("moveTo",[p[0]])]},{index:1,ops:[zs("lineTo",[p[1]])]}];let f=u-l;u<=l&&(f=0);const g=[];let m=[],v={index:f,ops:[]};if(g.push(v),u<=l){const J=zs("moveTo",[p[0]]);v.ops.push(J),m=[...p]}else m=p.slice(-l);const _=function(J,K,Q){const ie=[];for(let oe=1;oe<J.length-1;oe++){const le=180*TEe(RQ(J[oe-1],J[oe]),RQ(J[oe],J[oe+1]))/Math.PI;le>=45&&le<=135&&ie.push(oe)}return ie}(m),b=[];for(let J=0;J<m.length;J++)if(_.includes(J)){const K=p[J-1],Q=p[J+1],ie=Gx(p[J],K),oe=Gx(p[J],Q);let le,he;ie>6&&(le=QE(K,p[J],.2),b.push({val:le})),b.push({index:J+f,val:m[J]}),oe>6&&(he=QE(Q,p[J],.2),b.push({val:he}))}else b.push({index:J+f,val:m[J]});for(let J=0;J<b.length;J++){var S,I,k,O,j,W;const K=b[J],Q=b[J].val,ie=null!==(S=null===(I=b[J-1])||void 0===I?void 0:I.val)&&void 0!==S?S:Q,oe=null!==(k=null===(O=b[J+1])||void 0===O?void 0:O.val)&&void 0!==k?k:Q,le=xEe(ie,Q,oe,null!==(j=null===(W=b[J+2])||void 0===W?void 0:W.val)&&void 0!==j?j:oe);void 0!==K.index&&(K.index!==f&&(v={index:void 0,ops:[]},g.push(v)),v.index=K.index),v.ops.push(le)}return g}function xEe(p,l,u,f){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;const m=Gx(l,u);let v={x:l.x+(u.x-p.x)/g,y:l.y+(u.y-p.y)/g},_={x:u.x-(f.x-l.x)/g,y:u.y-(f.y-l.y)/g};const b=Gx(v,l),S=Gx(_,u);return b>m&&(v=QE(v,l,m)),S>m&&(_=QE(_,u,m)),zs("bezierCurveTo",[v,_,u])}function wEe(p,l,u){const f=(p.x+l.x)/2,g=(p.y+l.y)/2,m=(l.x+u.x)/2,v=(l.y+u.y)/2;return zs("bezierCurveTo",[{x:f+2*(l.x-f)/3,y:g+2*(l.y-g)/3},{x:m+2*(l.x-m)/3,y:v+2*(l.y-v)/3},l])}function T_(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const u=[];let[f]=p;u.push(zs("moveTo",[f]));for(let g=1;g<p.length;g++)f=p[g],u.push(zs("lineTo",[f]));return l&&p.length>2&&([f]=p,u.push(zs("lineTo",[f]))),u}function I_(p,l){const{data:u,type:f}=l,[g,m,v]=u;switch(f){case"moveTo":p.moveTo(g.x,g.y);break;case"lineTo":p.lineTo(g.x,g.y);break;case"bezierCurveTo":p.bezierCurveTo(g.x,g.y,m.x,m.y,v.x,v.y);break;case"quadraticCurveTo":p.quadraticCurveTo(g.x,g.y,m.x,m.y)}}function fp(p){let{x:l,y:u}=p[0],f=l,g=u;for(let m=1;m<p.length;m++){const{x:v,y:_}=p[m];l=Math.min(l,v),f=Math.max(f,v),u=Math.min(u,_),g=Math.max(g,_)}return{left:l,top:u,right:f,bottom:g,width:f-l,height:g-u}}function QE(p,l,u){const f=l.x-p.x,g=l.y-p.y,m=Math.abs(f)/Math.abs(g);let v=Math.sqrt(u*u/(m*m+1)),_=v*m;return 0===f&&(_=0,v=Math.sqrt(u)),0===g&&(v=0,_=Math.sqrt(u)),{x:l.x-(f>=0?_:-_),y:l.y-(g>=0?v:-v)}}function yQ(p){if(p.length<1)return[];const l=[];let u=[];for(let f=0;f<p.length;f++){const g=p[f];0===g.step?(f>0&&l.push({step:u,close:p[f-1].close}),u=[],u.push(zs("moveTo",[{x:g.x,y:g.y}]))):1===g.step?u.push(zs("lineTo",[{x:g.x,y:g.y}])):2===g.step&&f+2<p.length&&2===p[f+1].step&&2===p[f+2].step&&(u.push(zs("bezierCurveTo",[g,p[f+1],p[f+2]])),f+=2)}return l.push({step:u,close:p[p.length-1].close}),l}function $O(p){return 180*p/Math.PI}function qO(p){return p<0?p%360+360:p%360}function ZE(p,l,u,f){return p/(u*u)+l/(f*f)}function zx(p,l,u,f){let g=0,m=0,v=0,_=0;const b=[p,l],S=fp(b),I=function(k,O,j,W){let J=W/2,K=W/2;const Q=O.y-k.y,ie=O.x-k.x;if(0===Q||0===ie)return[ie,Q];const le=Math.atan(-1/((O.y-k.y)/(O.x-k.x)));return"square"===j?(J=Math.sqrt(2)*W/2,K=Math.sqrt(2)*W/2):"round"===j?(J=W/2,K=W/2):(J=Math.abs(Math.cos(le)*W)/2,K=Math.abs(Math.sin(le)*W)/2),[J,K]}(b[0],b[1],f,u||0);return 0===I[1]?(g=S.left,m=S.top-u/2,v=S.width,_=S.height+u,"square"!==f&&"round"!==f||(g-=u/2,v+=u)):0===I[0]?(g=S.left-u/2,m=S.top,v=S.width+u,_=S.height,"square"!==f&&"round"!==f||(m-=u/2,_+=u)):(g=S.left-I[0],m=S.top-I[1],v=S.width+2*I[0],_=S.height+2*I[1]),{x:g,y:m,width:v,height:_}}function KO(p){return Math.abs(p)<1e-6?0:p<0?-1:1}function e2(p,l,u,f){const{x:g,y:m}=p,{x:v,y:_}=l,{x:b,y:S}=f,I=Math.min(g,v),k=Math.max(g,v),O=Math.min(m,_),j=Math.max(m,_),W=u/2;return b>=I-W&&b<=k+W&&S>=O-W&&S<=j+W&&function(J,K,Q,ie,oe,le){const he=[Q-J,ie-K];if(new Gs(he[0],he[1]).equals({x:0,y:0}))return Math.sqrt((oe-J)*(oe-J)+(le-K)*(le-K));const _e=[-he[1],he[0]],Ve=new Gs(_e[0],_e[1]);Ve.normalize();const ee=[oe-J,le-K],ke=new Gs(ee[0],ee[1]);return Math.abs(ke.dot(Ve))}(g,m,v,_,b,S)<=u/2}function _Q(p,l,u,f,g){const m=p.length;if(m<2)return!1;for(let v=0;v<m-1;v++)if(e2(p[v],p[v+1],l,{x:u,y:f}))return!0;return!(!g||!e2(p[0],p[m-1],l,{x:u,y:f}))}function E_(p,l,u,f,g,m){return g>=p&&g<=p+u&&m>=l&&m<=l+f}function CQ(p,l,u,f,g,m){const v=m;let _=f.x,b=f.y,S=g.x,I=g.y;0===l&&(_=g.x,b=g.y,S=f.x,I=f.y);let k=Math.PI/2;const O=S-_>=0?1:-1,j=I-b>=0?1:-1;_!==S&&(k=Math.atan(Math.abs(I-b)/Math.abs(S-_)));const W=Math.cos(k),J=Math.sin(k),K=u?1:-1,Q={x:S+7.8*K*v*W*O-4.5*v*J*O,y:I+7.8*K*v*J*j+4.5*v*W*j,step:0,close:!1},ie={x:S,y:I,step:1,close:!1};u&&(ie.x=S+v*K*W*O,ie.y=I+v*K*J*j),p.push(Q,ie,{x:S+7.8*K*v*W*O+4.5*v*J*O,y:I+7.8*K*v*J*j-4.5*v*W*j,step:1,close:!1})}function bQ(p,l,u,f,g,m){const v=m;let _=f.x,b=f.y,S=g.x,I=g.y;0===l&&(_=g.x,b=g.y,S=f.x,I=f.y);let k=Math.PI/2;const O=S-_>=0?1:-1,j=I-b>=0?1:-1;_!==S&&(k=Math.atan(Math.abs(I-b)/Math.abs(S-_)));const W=Math.cos(k),J=Math.sin(k),K=u?1:-1,Q={x:S+7.8*K*v*W*O-4.5*v*J*O,y:I+7.8*K*v*J*j+4.5*v*W*j,step:0,close:!1},ie={x:S,y:I,step:1,close:!1};u&&(ie.x=S+v*K*W*O,ie.y=I+v*K*J*j),p.push(Q,ie,{x:S+7.8*K*v*W*O+4.5*v*J*O,y:I+7.8*K*v*J*j-4.5*v*W*j,step:1,close:!0})}function xQ(p,l,u,f,g){const m=g;let v=u.x,_=u.y,b=f.x,S=f.y;0===l&&(v=f.x,_=f.y,b=u.x,S=u.y);let I=Math.PI/2;const k=b-v>=0?1:-1,O=S-_>=0?1:-1;v!==b&&(I=Math.atan(Math.abs(S-_)/Math.abs(b-v)));const j=Math.cos(I),W=Math.sin(I);p.push({x:b-3*m*W*k,y:S+3*m*j*O,step:0,close:!1},{x:b+3*m*W*k,y:S-3*m*j*O,step:1,close:!1})}function wQ(p,l,u,f,g){const m=g;let v=u.x,_=u.y,b=f.x,S=f.y;0===l&&(v=f.x,_=f.y,b=u.x,S=u.y);let I=Math.PI/2;const k=b-v>=0?1:-1,O=S-_>=0?1:-1,j=S>=_&&b>=v||S<=_&&b<=v?-1:1;v!==b&&(I=Math.atan(Math.abs(S-_)/Math.abs(b-v)));const W=Math.cos(I),J=Math.sin(I),K=4.5*Math.sqrt(3)*m;p.push({x:b+4.5*m*W*k-K*J*k*j,y:S+4.5*m*J*O+K*W*O*j,step:0,close:!1},{x:b-4.5*m*W*k+K*J*k*j,y:S-4.5*m*J*O-K*W*O*j,step:1,close:!1})}function SQ(p,l,u,f,g){const m=g;let{x:v,y:_}=f;0===l&&(v=u.x,_=u.y),p.push({x:v-3*m,y:_-3*m,step:0,close:!1},{x:v+3*m,y:_-3*m,step:1,close:!1},{x:v+3*m,y:_+3*m,step:1,close:!1},{x:v-3*m,y:_+3*m,step:1,close:!0})}function TQ(p,l,u,f,g){const m=g;let{x:v,y:_}=f;0===l&&(v=u.x,_=u.y),p.push({x:v-3*m,y:_,step:0,close:!1},{x:v,y:_-3*m,step:1,close:!1},{x:v+3*m,y:_,step:1,close:!1},{x:v,y:_+3*m,step:1,close:!0})}function IQ(p,l,u,f,g){const m=g;let{x:v,y:_}=f;0===l&&(v=u.x,_=u.y);const b=3*m-0*m,S=vQ(v,_,b,b);S.forEach((I,k)=>{p.push({x:I.x,y:I.y,step:0===k?0:2,close:k===S.length-1})})}class SEe{constructor(l){N(this,"lineAlign",void 0),N(this,"owner",void 0),this.owner=l,this.reset()}reset(){this.lineAlign=.5}get x(){return this.owner.getAttribute("x")}set x(l){this.owner.setAttribute("x",l)}get y(){return this.owner.getAttribute("y")}set y(l){this.owner.setAttribute("y",l)}get r(){return this.owner.getAttribute("r")}set r(l){this.owner.setAttribute("r",l)}get width(){return this.owner.getAttribute("width")}set width(l){this.owner.setAttribute("width",l)}get height(){return this.owner.getAttribute("height")}set height(l){this.owner.setAttribute("height",l)}get points(){return this.owner.getAttribute("points")}set points(l){this.owner.setAttribute("points",l)}get origin(){return this.owner.getAttribute("origin")}set origin(l){this.owner.setAttribute("origin",l)}get anchor(){return this.owner.getAttribute("anchor")}set anchor(l){this.owner.setAttribute("anchor",l)}get visibility(){return this.owner.getAttribute("visibility")}set visibility(l){this.owner.setAttribute("visibility",l)}get zIndex(){return this.owner.getAttribute("zIndex")}set zIndex(l){this.owner.setAttribute("zIndex",l)}get borderWidth(){return this.owner.getAttribute("borderWidth")}set borderWidth(l){this.owner.setAttribute("borderWidth",l)}get borderColor(){return this.owner.getAttribute("borderColor")}set borderColor(l){this.owner.setAttribute("borderColor",l)}get opacity(){return this.owner.getAttribute("opacity")}set opacity(l){this.owner.setAttribute("opacity",l)}get fillOpacity(){return this.owner.getAttribute("fillOpacity")}set fillOpacity(l){this.owner.setAttribute("fillOpacity",l)}get borderOpacity(){return this.owner.getAttribute("borderOpacity")}set borderOpacity(l){this.owner.setAttribute("borderOpacity",l)}get background(){return this.owner.getAttribute("background")}set background(l){this.owner.setAttribute("background",l)}get clipPath(){return this.owner.getAttribute("clipPath")}set clipPath(l){this.owner.setAttribute("clipPath",l)}get cursor(){return this.owner.getAttribute("cursor")}set cursor(l){this.owner.setAttribute("cursor",l)}get hitArea(){return this.owner.getAttribute("hitArea")}set hitArea(l){this.owner.setAttribute("hitArea",l)}get pointerEvents(){return this.owner.getAttribute("pointerEvents")}set pointerEvents(l){this.owner.setAttribute("pointerEvents",l)}get miterLimit(){return this.owner.getAttribute("miterLimit")}set miterLimit(l){this.owner.setAttribute("miterLimit",l)}get roundedRadius(){return this.owner.getAttribute("roundedRadius")}set roundedRadius(l){this.owner.setAttribute("roundedRadius",l)}get lineCap(){return this.owner.getAttribute("lineCap")}set lineCap(l){this.owner.setAttribute("lineCap",l)}get lineJoin(){return this.owner.getAttribute("lineJoin")}set lineJoin(l){this.owner.setAttribute("lineJoin",l)}get lineDash(){return this.owner.getAttribute("lineDash")}set lineDash(l){this.owner.setAttribute("lineDash",l)}get lineDashOffset(){return this.owner.getAttribute("lineDashOffset")}set lineDashOffset(l){this.owner.setAttribute("lineDashOffset",l)}get shadow(){return this.owner.getAttribute("shadow")}set shadow(l){this.owner.setAttribute("shadow",l)}get shadowOffsetX(){return this.owner.getAttribute("shadowOffsetX")}set shadowOffsetX(l){this.owner.setAttribute("shadowOffsetX",l)}get shadowOffsetY(){return this.owner.getAttribute("shadowOffsetY")}set shadowOffsetY(l){this.owner.setAttribute("shadowOffsetY",l)}get shadowBlur(){return this.owner.getAttribute("shadowBlur")}set shadowBlur(l){this.owner.setAttribute("shadowBlur",l)}get shadowColor(){return this.owner.getAttribute("shadowColor")}set shadowColor(l){this.owner.setAttribute("shadowColor",l)}get startAngle(){return this.owner.getAttribute("startAngle")}set startAngle(l){this.owner.setAttribute("startAngle",l)}get endAngle(){return this.owner.getAttribute("endAngle")}set endAngle(l){this.owner.setAttribute("endAngle",l)}get rx(){return this.owner.getAttribute("rx")}set rx(l){this.owner.setAttribute("rx",l)}get ry(){return this.owner.getAttribute("ry")}set ry(l){this.owner.setAttribute("ry",l)}get img(){return this.owner.getAttribute("img")}set img(l){this.owner.setAttribute("img",l)}get src(){return this.owner.getAttribute("src")}set src(l){this.owner.setAttribute("src",l)}get text(){return this.owner.getAttribute("text")}set text(l){this.owner.setAttribute("text",l)}get wordWarp(){return this.owner.getAttribute("wordWarp")}set wordWarp(l){this.owner.setAttribute("wordWarp",l)}get wordBreak(){return this.owner.getAttribute("wordBreak")}set wordBreak(l){this.owner.setAttribute("wordBreak",l)}get textMaxWidth(){return this.owner.getAttribute("textMaxWidth")}set textMaxWidth(l){this.owner.setAttribute("textMaxWidth",l)}get letterSpacing(){return this.owner.getAttribute("letterSpacing")}set letterSpacing(l){this.owner.setAttribute("letterSpacing",l)}get textBaseLine(){return this.owner.getAttribute("textBaseLine")}set textBaseLine(l){this.owner.setAttribute("textBaseLine",l)}get textTransform(){return this.owner.getAttribute("textTransform")}set textTransform(l){this.owner.setAttribute("textTransform",l)}get color(){return this.owner.getAttribute("color")}set color(l){this.owner.setAttribute("color",l)}get fontStyle(){return this.owner.getAttribute("fontStyle")}set fontStyle(l){this.owner.setAttribute("fontStyle",l)}get fontVariant(){return this.owner.getAttribute("fontVariant")}set fontVariant(l){this.owner.setAttribute("fontVariant",l)}get fontWeight(){return this.owner.getAttribute("fontWeight")}set fontWeight(l){this.owner.setAttribute("fontWeight",l)}get fontSize(){return this.owner.getAttribute("fontSize")}set fontSize(l){this.owner.setAttribute("fontSize",l)}get lineHeight(){return this.owner.getAttribute("lineHeight")}set lineHeight(l){this.owner.setAttribute("lineHeight",l)}get fontFamily(){return this.owner.getAttribute("fontFamily")}set fontFamily(l){this.owner.setAttribute("fontFamily",l)}get startPoint(){return this.owner.getAttribute("startPoint")}set startPoint(l){this.owner.setAttribute("startPoint",l)}get endPoint(){return this.owner.getAttribute("endPoint")}set endPoint(l){this.owner.setAttribute("endPoint",l)}get lineEnding(){return this.owner.getAttribute("lineEnding")}set lineEnding(l){this.owner.setAttribute("lineEnding",l)}get segments(){return this.owner.getAttribute("segments")}set segments(l){this.owner.setAttribute("segments",l)}get stampPoints(){return this.owner.getAttribute("stampPoints")}set stampPoints(l){this.owner.setAttribute("stampPoints",l)}get imageData(){return this.owner.getAttribute("imageData")}set imageData(l){this.owner.setAttribute("imageData",l)}get iconName(){return this.owner.getAttribute("iconName")}set iconName(l){this.owner.setAttribute("iconName",l)}get textContents(){return this.owner.getAttribute("textContents")}set textContents(l){this.owner.setAttribute("textContents",function(u){const f=[];return u.forEach(g=>{g.content.length&&f.push(g)}),f}(l))}get textAlign(){return this.owner.getAttribute("textAlign")}set textAlign(l){this.owner.setAttribute("textAlign",l)}get renderBlendMode(){return this.owner.getAttribute("renderBlendMode")}set renderBlendMode(l){this.owner.setAttribute("renderBlendMode",l)}}const ju=new class{constructor(){N(this,"parsers",void 0),N(this,"updaters",void 0),this.parsers=new Map,this.updaters=new Map,this.initParser(),this.initUpdater()}getStyleParser(p){return this.parsers.get(p)}getStyleUpdaters(p){return this.updaters.get(p)}initParser(){this.bindHandler(["borderWidth","letterSpacing","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","textMaxWidth","roundedRadius"],ni,void 0),this.bindHandler(["startAngle","endAngle"],Hx,void 0),this.bindHandler(["r","rx","ry","width","height","fontSize"],ni,void 0),this.bindHandler(["borderColor","background","shadowColor","color"],jd,void 0),this.bindHandler(["opacity","fillOpacity","borderOpacity"],uEe,void 0),this.bindHandler(["lineDash"],cEe,void 0),this.bindHandler(["shadow"],lEe,void 0),this.bindHandler(["textContents"],dEe,void 0)}initUpdater(){this.bindHandler(["borderWidth"],void 0,yEe),this.bindHandler(["x","y"],void 0,hEe),this.bindHandler(["width","height"],void 0,gEe),this.bindHandler(["r","rx","ry","startAngle","endAngle"],void 0,mEe),this.bindHandler(["points","segments"],void 0,fEe),this.bindHandler(["startPoint","endPoint","lineEnding"],void 0,vEe),this.bindHandler(["text","textTransform","textBaseLine","x","y","width","wordWarp","lineHeight","fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,pEe),this.bindHandler(["stampPoints"],void 0,_Ee),this.bindHandler(["width","height","textContents","textAlign","borderWidth"],void 0,CEe)}bindHandler(p,l,u){for(let f=0;f<p.length;f++)if(l&&this.parsers.set(p[f],l),u){const g=this.updaters.get(p[f])||[];g.push(u),this.updaters.set(p[f],g)}}};class fs extends aQ{constructor(l){super(),N(this,"attributes",{}),N(this,"id",void 0),N(this,"pageUid",void 0),N(this,"index",void 0),N(this,"name",void 0),N(this,"renderable",new nEe),N(this,"sortable",new iEe),N(this,"geometry",new tEe),N(this,"transform",new pQ),N(this,"parsedStyle",{}),N(this,"style",void 0),N(this,"isDestroyed",!1),N(this,"childNodes",[]),N(this,"nodeName",""),N(this,"nodeType",0),N(this,"nodeValue",null),N(this,"ownerDocument",null),N(this,"parentNode",null),N(this,"isConnected",!1),N(this,"textContent",void 0),N(this,"shapeType",void 0),N(this,"config",void 0),N(this,"path",void 0),N(this,"steps",void 0),N(this,"pathDirty",!0),N(this,"boundsDirty",!0),N(this,"bounds",void 0),N(this,"strokePath",void 0),N(this,"strokeSteps",void 0),N(this,"externalMatrices",[]),N(this,"clippable",!1),N(this,"imageData",null),this.config=l,this.id=l.id||l.uid||"",this.name=l.name||"",this.index=l.index,this.nodeName=l.type||"container",this.pageUid=l.pageUid||"",(l.className||l.class)&&(this.className=l.className||l.class),this.style=new SEe(this),this.initAttributes(l)}static isNode(l){return!!l.childNodes}set className(l){this.setAttribute("class",l)}get className(){return this.getAttribute("class")||""}get classList(){return this.className.split(" ").filter(l=>""!==l)}get tagName(){return this.nodeName}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}get firstChild(){return this.childNodes.length>0?this.childNodes[0]:null}get lastChild(){const{childNodes:l}=this;return l.length>0?l[l.length-1]:null}get nextSibling(){const{parentNode:l}=this;if(l){const u=l.childNodes.indexOf(this);return l.childNodes[u+1]}return null}get parentElement(){return this.parentNode}get previousSibling(){const{parentNode:l}=this;if(l){const u=l.childNodes.indexOf(this);return l.childNodes[u-1]}return null}getAttribute(l){const u=this.attributes[l];return null==u?null:u}getElementsByName(l){return $i.querySelectorAll(`[name="${l}"]`,this)}getElementsByClassName(l){return $i.querySelectorAll(`.${l}`,this)}getElementsByTagName(l){return $i.querySelectorAll(l,this)}hasAttribute(l){return Object.keys(this.attributes).indexOf(l)>-1}removeAttribute(l){this.setAttribute(l,null),delete this.attributes[l]}appendChild(l,u){$i.append(l,this,u);const f=new Wg("child-inserted",{child:l});this.dispatchEvent(f);const g=new Dv("DOMNodeInserted",this,"","","",0,"","");return l.dispatchEvent(g),l}cloneNode(l){return null}insertBefore(l,u){if(u){const f=this.childNodes.indexOf(u);this.appendChild(l,f-1)}else this.appendChild(l);return l}removeChild(l){const u=new Dv("removed",this,"","","",0,"","");l.dispatchEvent(u);const f=new Wg("child-removed",{child:l});return this.dispatchEvent(f),$i.remove(l),l}isChildExist(l){return $i.isChildExist(l)}replaceChild(l,u){const f=this.childNodes.indexOf(u);return this.removeChild(u),this.appendChild(l,f),u}destroy(){const l=new Wg("destroy",{});this.dispatchEvent(l),this.remove(),this.removeAllEventListeners(),this.isDestroyed=!0}after(){const{parentNode:l}=this;if(l){const m=l.childNodes.indexOf(this);for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];f.forEach((v,_)=>{null==l||l.appendChild(v,m+_+1)})}}before(){const{parentNode:l}=this;if(l){const m=l.childNodes.indexOf(this);for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];f.forEach((v,_)=>{null==l||l.appendChild(v,m+_)})}}remove(){this.parentNode&&this.parentNode.removeChild(this)}replaceWith(){this.after(...arguments),this.remove()}append(){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];u.forEach(g=>{this.appendChild(g)})}prepend(){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];u.forEach((g,m)=>{this.appendChild(g,m)})}querySelector(l){return $i.querySelector(l,this)}querySelectorAll(l){return $i.querySelectorAll(l,this)}find(l){let u=null;return this.recursiveCall(f=>!(f!==this||!l(f)||(u=f,0))),u}findAll(l){const u=[];return this.recursiveCall(f=>{f===this&&l(f)&&u.push(f)}),u}contains(l){let u=l;for(;u&&this!==u;)u=u.parentNode;return!!u}getRootNode(l){return this.parentNode?this.parentNode.getRootNode(l):this}hasChildNodes(){return this.childNodes.length>0}isEqualNode(l){return this===l}isSameNode(l){return this.isEqualNode(l)}normalize(){throw new Error("Method to be implemented")}recursiveCall(l){l(this)||this.childNodes.forEach(u=>{u.recursiveCall(l)})}hasParentTransform(){return!(!this.parentNode||!this.parentNode.transform)}getGeometryBounds(){return $i.getGeometryBounds(this)}getRenderBounds(){return $i.getBounds(this,!0)}getBounds(){return $i.getBounds(this)}getLocalBounds(){return $i.getLocalBounds(this)}getBoundingClientRect(){return $i.getBoundingClientRect(this)}get isVisible(){return"visible"===this.parsedStyle.visibility}get isInteractive(){return"none"!==this.parsedStyle.pointerEvents}get width(){return this.parsedStyle.width.value*Math.abs(this.getScale().x)}get height(){return this.parsedStyle.height.value*Math.abs(this.getScale().y)}initAttributes(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const u in l)if(NE(u,l)){if("style"===u)continue;this.attributes[u]=l[u]}for(const u in l.style)NE(u,l.style)&&(this.parseStyleProperty(u,l.style[u]),this.attributes[u]=l.style[u]);this.renderable.toRenderable()}setAttribute(l,u){if(pt(u))return;const g=this.attributes[l];(u!==this.attributes[l]||"x"===l||"y"===l)&&(this.attributes[l]=u,Object.keys(this.config).includes(l)||(this.parseStyleProperty(l,u),this.updateStyleProperty(l,g,u)))}parseStyleProperty(l,u){const f=ju.getStyleParser(l);this.parsedStyle[l]=f?f(u,this,l):u}updateStyleProperty(l,u,f){const g=ju.getStyleUpdaters(l);g&&g.forEach(m=>{m(u,f,this,l)})}toFront(){const{parentNode:l}=this;if(l){const u=Math.max(...l.children.map(f=>f.style.zIndex));this.style.zIndex=u+1}return this}toBack(){const{parentNode:l}=this;if(l){const u=Math.min(...l.children.map(f=>f.style.zIndex));this.style.zIndex=u-1}return this}setOrigin(l){return $i.setOrigin(this,l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}getOrigin(){return $i.getOrigin(this)}setPosition(l){return $i.setPosition(this,l),this}setLocalPosition(l){const u=Nr(l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return $i.setLocalPosition(this,u),this}getPosition(){return $i.getPosition(this)}getLocalPosition(){return $i.getLocalPosition(this)}translate(l){const u=Nr(l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return $i.translate(this,u),this}translateLocal(l){const u=Nr(l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return $i.translateLocal(this,u),this}scale(l,u,f){return this.scaleLocal(l,u,f)}scaleLocal(l,u,f){return Xt(l)&&(l=Nr(l,u=u||l,f=f||l)),$i.scaleLocal(this,l),this}setLocalScale(l,u,f){return Xt(l)&&(l=Nr(l,u=u||l,f=f||l)),$i.setLocalScale(this,l),this}getScale(){return $i.getScale(this)}getLocalScale(){return $i.getLocalScale(this)}rotate(l,u,f){return pt(u)&&pt(f)?$i.rotate(this,0,0,l):$i.rotate(this,l,u,f),this}rotateLocal(l,u,f){return pt(u)&&pt(f)?$i.rotateLocal(this,0,0,l):$i.rotateLocal(this,l,u,f),this}setAngle(l){return $i.setAngle(this,0,0,l),this}setLocalAngle(l){return 180===Math.abs(l%360)&&(l-=.001),$i.setLocalAngle(this,0,0,l),this}getAngle(){return $i.getAngle(this).z}getLocalAngle(){return $i.getLocalAngle(this).z}getLocalTransform(){return $i.getLocalTransform(this)}getWorldTransform(){return $i.getWorldTransform(this)}setLocalTransform(l){return $i.setLocalTransform(this,l),this}resetLocalTransform(){$i.resetLocalTransform(this)}getPath(){}getBoundingRect(){return{x:0,y:0,width:0,height:0}}isPointInPath(l){return!1}updateStyle(l){Object.keys(l).forEach(u=>{NE(u,l)&&(this.style[u]=l[u])})}updatePosition(l,u){this.style.x=l||0,this.style.y=u||0}updateOrigin(){const{width:l,height:u}=this.getBoundingRect();this.setOrigin(l/2,u/2)}getBoundingRectObject(){const{x:l,y:u,width:f,height:g}=this.getBoundingRect();return new ps({style:{x:l,y:u,width:f,height:g,borderWidth:1,background:"transparent"}})}}class EQ extends fs{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:l}=m,u=Jl(m,["style"]);super(qe({type:"arc",style:qe(Ht(qe({},Xc),{r:0,startAngle:0,endAngle:1.5*Math.PI}),l)},u)),N(this,"shapeType","arc");const{x:f,y:g}=this.parsedStyle;this.setLocalPosition(f,g),this.updateOrigin()}normAngle(){const{startAngle:l,endAngle:u}=this.style;let f=Hx(l).value,g=Hx(u).value;if(f>g){const m=f;f=g,g=m}if(Math.abs(g-f)>=2*Math.PI-1e-5&&(f=0,g=2*Math.PI),f<-2*Math.PI||g<-2*Math.PI){const m=Math.max(Math.floor(f/(-2*Math.PI)),Math.floor(g/(-2*Math.PI)));f+=2*Math.PI*m,g+=2*Math.PI*m}if(f>2*Math.PI||g>2*Math.PI){const m=Math.max(Math.floor(f/(2*Math.PI)),Math.floor(g/(2*Math.PI)));f-=2*Math.PI*m,g-=2*Math.PI*m}this.parsedStyle.startAngle=Hx(f),this.parsedStyle.endAngle=Hx(g)}updateOrigin(){const{width:l,height:u,x:f,y:g}=this.getBoundingRect();this.setOrigin(f-this.style.x+l/2,g-this.style.y+u/2)}getPath(){if(!this.pathDirty)return this.path;this.normAngle();const{r:l,borderWidth:u,startAngle:f,endAngle:g}=this.parsedStyle;return this.path=mQ(0,0,l.value-.5*((null==u?void 0:u.value)||0),f.value,g.value),this.steps=YO(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:l,y:u,r:f,startAngle:g,endAngle:m}=this.parsedStyle,_=f.value,b=g.value,S=m.value;if(g===m)return{x:l-_-0,y:u-_-0,width:2*_+0,height:2*_+0};const{sin:I,cos:k,PI:O}=Math,j=[l+_*k(b),l+_*k(S)],W=[u+_*I(b),u+_*I(S)];return b<0&&S>0&&j.push(l+_),(b<.5*O&&S>.5*O||b<-1.5*O&&S>-1.5*O)&&W.push(u+_),(b<O&&S>O||b<-O&&S>-O)&&j.push(l-_),(b<1.5*O&&S>1.5*O||b<-.5*O&&S>-.5*O)&&W.push(u-_),j.sort((J,K)=>J-K),W.sort((J,K)=>J-K),this.boundsDirty=!1,this.bounds={x:j[0]-0,y:W[0]-0,width:j[j.length-1]-j[0]+0,height:W[W.length-1]-W[0]+0},this.bounds}isPointInPath(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(l,u))return!1;const{x:f,y:g,r:m,startAngle:v,endAngle:_,background:b,borderWidth:S}=this.parsedStyle,I=qO($O(v.value)),k=qO($O(_.value)),O=qO($O(v.value+_.value)/2),j=xn(this.style.background)&&""!==this.style.background,W=S&&S.value,K=(S.value+(j?0:u)||0)/2,Q=m.value-K,ie=new Ar(f+Q*Math.cos(I*Math.PI/180),g+Q*Math.sin(I*Math.PI/180)),oe=new Ar(f+Q*Math.cos(k*Math.PI/180),g+Q*Math.sin(k*Math.PI/180)),le=new Ar(f+Q*Math.cos(O*Math.PI/180),g+Q*Math.sin(O*Math.PI/180)),he=new Ar(l.x,l.y),_e=he.distanceTo({x:f,y:g}),Ve=HO([ie.x,ie.y],[le.x,le.y],[he.x,he.y],[f,g]),ee=HO([oe.x,oe.y],[le.x,le.y],[he.x,he.y],[f,g]),ke=HO([ie.x,ie.y],[oe.x,oe.y],[he.x,he.y],[f,g]);if(_e>Q+K)return!1;const xe=e2(ie,oe,2*K,l);if(k-I<180&&k-I>0||k-I<-180){if(b&&ke||xe||!b&&W&&_e>=Q-K&&_e<=Q+K&&ke)return!0}else if(180===Math.abs(k-I)){if(b&&(Ve||ee||function(Le,V,F,z){const{x:$,y:P}=Le,{x:L,y:X}=V,{x:ne,y:Z}=F,{x:te,y:ae}=z;return!(((te-$)*(X-P)-(ae-P)*(L-$))*((ne-$)*(X-P)-(Z-P)*(L-$))<=0||((te-ne)*(X-Z)-(ae-Z)*(L-ne))*(($-ne)*(X-Z)-(P-Z)*(L-ne))<=0||((te-$)*(Z-P)-(ae-P)*(ne-$))*((L-$)*(Z-P)-(X-P)*(ne-$))<=0)}(ie,le,oe,l))||!b&&W&&_e>=Q-K&&_e<=Q+K&&(Ve||ee))return!0}else if(b&&(Ve||ee||!ke)||!b&&W&&_e>=Q-K&&_e<=Q+K&&(Ve||ee))return!0;return!!xe}}class Vg extends fs{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:l}=m,u=Jl(m,["style"]);super(qe({type:"circle",style:qe(Ht(qe({},Xc),{r:0,anchor:[.5,.5]}),l)},u)),N(this,"shapeType","circle");const{x:f,y:g}=this.parsedStyle;this.setLocalPosition(f,g),this.updateOrigin()}updateOrigin(){this.setOrigin(0,0)}getPath(){if(!this.pathDirty)return this.path;const{r:l,borderWidth:u}=this.parsedStyle;let f=.5*((null==u?void 0:u.value)||0);return l.value===f&&(f=0),this.path=mQ(0,0,l.value-f,0,2*Math.PI),this.steps=YO(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:l,y:u,r:f}=this.parsedStyle,g=f.value;return this.boundsDirty=!1,this.bounds={x:l-g-0,y:u-g-0,width:2*g+0,height:2*g+0},this.bounds}isPointInPath(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(l,u))return!1;const{x:f,y:g,r:m,background:v,borderWidth:_}=this.parsedStyle,b=xn(this.style.background)&&""!==this.style.background,S=_&&_.value,k=(_.value+(b?0:u)||0)/2,O=m.value-k,j=new Ar(l.x,l.y).distanceTo({x:f,y:g});return v&&S?j<=O+k:v?j<=O:!!S&&j>=O-k&&j<=O+k}}let DQ=class extends fs{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Jl(g,["style"]);super(qe({type:"ellipse",style:qe(Ht(qe({},Xc),{rx:"",ry:"",borderWidth:0,anchor:[.5,.5]}),p)},l)),N(this,"shapeType","ellipse");const{x:u,y:f}=this.parsedStyle;this.setLocalPosition(u,f),this.updateOrigin()}updateOrigin(){this.setOrigin(0,0)}getPath(){if(!this.pathDirty)return this.path;const{rx:p,ry:l,borderWidth:u}=this.parsedStyle,f=.5*u.value;return this.path=vQ(0,0,p.value-f,l.value-f),this.steps=YO(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:l,rx:u,ry:f}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:p-u.value-0,y:l-f.value-0,width:2*u.value+0,height:2*f.value+0},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,l))return!1;const{x:u,y:f,rx:g,ry:m,borderWidth:v}=this.parsedStyle,_=xn(this.style.background)&&""!==this.style.background,b=v&&v.value,S=_?0:l,I=(v.value||0)/2,k=g.value-I,O=m.value-I,j=(p.x-u)*(p.x-u),W=(p.y-f)*(p.y-f);return _&&b?ZE(j,W,k+I,O+I)<=1:_?ZE(j,W,k,O)<=1:!!b&&ZE(j,W,k-I-S/2,O-I-S/2)>=1&&ZE(j,W,k+I+S/2,O+I+S/2)<=1}},Ev=class extends fs{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Jl(g,["style"]);super(qe({type:"image",style:qe(Ht(qe({},Xc),{width:0,height:0,img:""}),p)},l)),N(this,"shapeType","image"),N(this,"meteData",void 0),this.meteData=(null==l?void 0:l.metadata)||null;const{x:u,y:f}=this.parsedStyle;this.setLocalPosition(u,f),this.updateOrigin()}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:l,width:u,height:f}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:p,y:l,width:u.value,height:f.value},this.bounds}isPointInPath(p){return this.getBoundingRectObject().isPointInPath(p)}},AQ=class extends fs{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=u,l=Jl(u,["style"]);super(qe({type:"ink",style:qe(Ht(qe({},Xc),{segments:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4}),p)},l)),N(this,"shapeType","ink"),N(this,"inkPaths",[]),N(this,"inkSteps",[]),N(this,"inkRenderPaths",[]),N(this,"inkOriginalRenderPath",void 0),N(this,"inkRenderSteps",[]),N(this,"initialRect",void 0),N(this,"useDouglasPeucker",!0),N(this,"douglasPeuckerPoints",[]),N(this,"partDirty",!1),N(this,"optimizedOpSteps",[]),N(this,"positionDirty",!1),this.getPath(),this.initialRect=this.getBoundingRect(),this.updatePosition(this.initialRect.x,this.initialRect.y),this.setOrigin(this.initialRect.width,this.initialRect.height)}addSegment(){const{segments:p}=this.style;p[p.length-1].length&&this.style.segments.push([])}addPoint(p){const l=[...this.style.segments],u=this.style.segments.length,f=l[u-1],g=f[f.length-1];if((null==g?void 0:g.x)!==p.x||(null==g?void 0:g.y)!==p.y){this.partDirty=!0;const m=this.getBoundingRect(),v=this.parsedStyle.borderWidth.value/2;(p.x<m.x+v||p.y<m.y+v)&&(this.positionDirty=!0),l[u-1].push(p),this.style.segments=l;const _=this.getBoundingRect();(p.x<_.x||p.y<_.y||p.x>_.x+_.width||p.y>_.y+_.height)&&(this.boundsDirty=!0)}}getPath(){if(!this.pathDirty&&!this.partDirty)return this.path;const{segments:p}=this.parsedStyle;if(this.partDirty){const l=p.length;if(l>1)for(let g=0;g<l-1;g++){const m=p[g];if(!this.optimizedOpSteps[g]){let v=[...m];1===v.length?v=this.offsetPoints(m[0],.1):(v=KE(v,0,v.length-1,1),v.length<=3&&v.push(qe({},v[v.length-1])));const _=XO(v,v.length).map(b=>b.ops).flat(2);this.optimizedOpSteps[g]=_}if(this.positionDirty||!this.inkRenderSteps[g]){const v=this.getRenderStep(this.optimizedOpSteps[g]);this.inkRenderSteps[g]=v}}let u=p[l-1];1===u.length?u=this.offsetPoints(u[0],.1):u.length<=3&&u.push(u[u.length-1]),u=this.getRenderPath(u);const f=function(g){const m=g.length;if(m<=1)return[];if(2===m)return[zs("moveTo",[g[0]]),zs("lineTo",[g[1]])];const v=[zs("moveTo",[g[0]])];for(let _=0;_<m-1;_++)v.push(wEe(g[_-1]||g[_],g[_],g[_+1]||g[_]));return v}(u);this.inkRenderSteps[l-1]=f}else this.pathDirty&&(this.reset(),p.forEach((l,u)=>{if(0===l.length)return;let f=[...l];1===l.length?f=this.offsetPoints(l[0],.1):(f=KE(f,0,f.length-1,1),f.length<=3&&f.push(qe({},f[f.length-1]))),this.inkPaths[u]=f;const g=XO(f,f.length);this.inkSteps[u]=g.map(_=>_.ops).flat(2);const m=this.getRenderPath(f),v=XO(m,m.length).map(_=>_.ops).flat(2);this.inkRenderSteps[u]=v}));return this.pathDirty=!1,this.partDirty=!1,this.positionDirty=!1,this.path}offsetPoints(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;const{x:u,y:f}=p;return[{x:u-l,y:f-l},{x:u+l,y:f-l},{x:u+l,y:f+l},{x:u-l,y:f+l}]}getRenderStep(p){return p.map(l=>Ht(qe({},l),{data:this.getRenderPath(l.data)}))}getInkOriginalRenderPath(){if(!this.pathDirty&&this.inkOriginalRenderPath)return;const{segments:p}=this.parsedStyle,l=[];for(let u=0;u<p.length;u++){const f=this.getRenderPath(p[u]);l.push(f)}this.inkOriginalRenderPath=l}getRenderPath(p){const{x:l,y:u}=this.getBoundingRect(),f=[];return p.forEach(g=>{!g||Number.isNaN(g.x)||Number.isNaN(g.y)||f.push({x:g.x-l,y:g.y-u})}),f}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p}=this.parsedStyle,l=[],u=[];this.parsedStyle.segments.forEach(b=>{b.forEach(S=>{S&&(l.push(S.x),u.push(S.y))})});const{min:f,max:g}=PQ(l),{min:m,max:v}=PQ(u),_=p.value/2;return this.boundsDirty=!1,this.bounds={x:f-_,y:m-_,width:g-f+2*_,height:v-m+2*_},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,l))return!1;const{borderWidth:u}=this.parsedStyle;for(let f=0;f<this.inkSteps.length;f++){const g=this.inkSteps[f];for(let m=1;m<g.length;m+=2){const v=g[m-1].data[0],_=g[m].data[0],b=g[m].data[1];if(bEe(v.x,v.y,_.x,_.y,b.x,b.y).isHit([p.x,p.y],u.value+l))return!0}}return!1}reset(){this.inkPaths=[],this.inkSteps=[],this.inkRenderPaths=[],this.inkRenderSteps=[]}};function PQ(p){if(0===p.length)return{min:void 0,max:void 0};let l=p[0],u=p[0];for(let f=1;f<p.length;f++)p[f]<l&&(l=p[f]),p[f]>u&&(u=p[f]);return{min:l,max:u}}function RQ(p,l){return{x:l.x-p.x,y:l.y-p.y}}function kQ(p){return Math.sqrt(p.x*p.x+p.y*p.y)}function TEe(p,l){const u=(m=p).x*(v=l).x+m.y*v.y,f=kQ(p),g=kQ(l);var m,v;return Math.acos(u/(f*g))}let t2=class extends fs{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=v,l=Jl(v,["style"]);super(qe({type:"polygon",style:qe(Ht(qe({},Xc),{points:[{x:0,y:0},{x:10,y:10}],miterLimit:4,borderWidth:2}),p)},l)),N(this,"shapeType","polygon"),N(this,"renderPath",void 0),0===this.parsedStyle.points.length&&(this.style.points=[{x:0,y:0},{x:10,y:10}]);const{x:u,y:f,width:g,height:m}=this.getBoundingRect();this.updatePosition(u,f),this.setOrigin(g/2,m/2)}addPoint(p){const l=[...this.style.points];l.push(p),this.style.points=l}updatePoints(){const{renderPath:p}=this,l=this.getLocalPosition(),u=[];p.forEach(f=>{u.push({x:f.x+l.x,y:f.y+l.y})}),this.style.points=u}getPath(){if(!this.pathDirty)return this.path;const{x:p,y:l}=this.getBoundingRect();return this.path=this.parsedStyle.points,this.renderPath=this.parsedStyle.points.map(u=>({x:u.x-p,y:u.y-l})),this.steps=T_(this.renderPath,!0),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p,points:l,lineCap:u}=this.parsedStyle;if(2===l.length)return this.boundsDirty=!1,this.bounds=zx(l[0],l[1],p.value,u),this.bounds;const f=fp(l),g=p.value/2||0;return this.boundsDirty=!1,this.bounds={x:f.left-g,y:f.top-g,width:f.width+2*g,height:f.height+2*g},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,l))return!1;const{borderWidth:u,points:f}=this.parsedStyle,g=xn(this.style.background)&&""!==this.style.background;let v=!1;return u&&u.value&&(v=_Q(f,u.value+(g?0:l),p.x,p.y,!0)),!v&&g&&(v=function(_,b,S){let I=!1;const k=_.length;if(k<=2)return!1;for(let J=0;J<k;J++){const K=_[J],Q=_[(J+1)%k];if(((W={x:b,y:S}).x-(O=K).x)*((j=Q).y-O.y)==(j.x-O.x)*(W.y-O.y)&&Math.min(O.x,j.x)<=W.x&&W.x<=Math.max(O.x,j.x)&&Math.min(O.y,j.y)<=W.y&&W.y<=Math.max(O.y,j.y))return!0;KO(K.y-S)>0!=KO(Q.y-S)>0&&KO(b-(S-K.y)*(K.x-Q.x)/(K.y-Q.y)-K.x)<0&&(I=!I)}var O,j,W;return I}(f,p.x,p.y)),v}},JO=class extends fs{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Jl(g,["style"]);super(qe({type:"polyline",style:qe(Ht(qe({},Xc),{points:[{x:0,y:0},{x:0,y:0}],lineEnding:null,borderWidth:2,miterLimit:4}),p)},l)),N(this,"shapeType","polyline"),N(this,"renderPath",void 0),this.getPath();const{x:u,y:f}=this.getBoundingRect();this.updatePosition(u,f),this.updateOrigin()}initPath(){const{points:p,lineEnding:l}=this.parsedStyle,u=[];if(p.forEach((f,g)=>{u.push(0===g?{x:f.x,y:f.y,step:0,close:!1}:{x:f.x,y:f.y,step:1,close:!1})}),l&&u.length>1)for(let f=0;f<l.length;f++)switch(l[f]){case"OpenArrow":this.addOpenArrow(u,f,!1);break;case"ROpenArrow":this.addOpenArrow(u,f,!0);break;case"ClosedArrow":this.addCloseArrow(u,f,!1);break;case"RClosedArrow":this.addCloseArrow(u,f,!0);break;case"Butt":this.addButt(u,f);break;case"Slash":this.addSlash(u,f);break;case"Square":this.addSquare(u,f);break;case"Diamond":this.addDiamond(u,f);break;case"Circle":this.addCircle(u,f)}return u}getRenderPath(p){const{x:l,y:u}=this.getBoundingRect(),f=[];return p.forEach(g=>{!g||Number.isNaN(g.x)||Number.isNaN(g.y)||f.push({x:g.x-l,y:g.y-u,step:g.step,close:g.close})}),f}addPoint(p){const l=[...this.style.points];l.push(p),this.style.points=l}updatePoints(){const{length:p}=this.parsedStyle.points,l=this.getLocalPosition(),u=[];this.renderPath.slice(0,p).forEach(f=>{u.push({x:f.x+l.x,y:f.y+l.y})}),this.style.points=u}updatePoint(){const p=this.getLocalPosition(),l=this.parsedStyle.points.length,u=[];for(let f=0;f<l;f++)u.push({x:this.renderPath[f].x+p.x,y:this.renderPath[f].y+p.y});this.updateStyle({points:u})}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=yQ(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p,lineCap:l}=this.parsedStyle;if(2===this.path.length)return this.boundsDirty=!1,this.bounds=zx(this.path[0],this.path[1],p.value,l),this.bounds;const u=fp(this.path),f=p.value/2;return this.boundsDirty=!1,this.bounds={x:u.left-f,y:u.top-f,width:u.width+2*f,height:u.height+2*f},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,l))return!1;const{borderWidth:u,points:f}=this.parsedStyle;return _Q(f,u.value+l,p.x,p.y,!1)}isLineArrow(){const{lineEnding:p}=this.parsedStyle;return!!p&&("None"!==p[0]||"None"!==p[1])}addOpenArrow(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:f,borderWidth:g}=this.parsedStyle,{length:m}=f;let v=f[m-2],_=f[m-1];0===l&&(v=qe({},f[0]),_=qe({},f[1])),CQ(p,l,u,v,_,g.value)}addCloseArrow(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:f,borderWidth:g}=this.parsedStyle,{length:m}=f;let v=f[m-2],_=f[m-1];0===l&&(v=qe({},f[0]),_=qe({},f[1])),bQ(p,l,u,v,_,g.value)}addCircle(p,l){const{points:u,borderWidth:f}=this.parsedStyle,{length:g}=u;IQ(p,l,u[0],u[g-1],f.value)}addDiamond(p,l){const{points:u,borderWidth:f}=this.parsedStyle,{length:g}=u;TQ(p,l,u[0],u[g-1],f.value)}addSquare(p,l){const{points:u,borderWidth:f}=this.parsedStyle,{length:g}=u;SQ(p,l,u[0],u[g-1],f.value)}addSlash(p,l){const{points:u,borderWidth:f}=this.parsedStyle,{length:g}=u;let m=u[g-2],v=u[g-1];0===l&&(m=qe({},u[0]),v=qe({},u[1])),wQ(p,l,m,v,f.value)}addButt(p,l){const{points:u,borderWidth:f}=this.parsedStyle,{length:g}=u;let m=u[g-2],v=u[g-1];0===l&&(m=qe({},u[0]),v=qe({},u[1])),xQ(p,l,m,v,f.value)}},ps=class extends fs{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Jl(g,["style"]);super(qe({type:"rect",style:qe(Ht(qe({},Xc),{width:0,height:0}),p)},l)),N(this,"shapeType","rect");const{x:u,y:f}=this.parsedStyle;this.setLocalPosition(u,f),this.updateOrigin()}getPath(){if(!this.pathDirty)return this.path;const{width:p,height:l,borderWidth:u}=this.parsedStyle,f=(null==u?void 0:u.value)||0,v=p.value-2*f,_=l.value-2*f;return this.path=[{x:f,y:f},{x:f+v,y:f},{x:f+v,y:f+_},{x:f,y:f+_}],this.steps=T_(this.path),this.pathDirty=!1,this.path}getStrokePath(){const{width:p,height:l,borderWidth:u}=this.parsedStyle,f=.5*((null==u?void 0:u.value)||0),v=p.value-2*f,_=l.value-2*f;this.strokePath=[{x:f,y:f},{x:f+v,y:f},{x:f+v,y:f+_},{x:f,y:f+_}],this.strokeSteps=T_(this.strokePath)}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:l,width:u,height:f}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:p,y:l,width:u.value,height:f.value},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:u,y:f,borderWidth:g,width:m,height:v}=this.parsedStyle,_=xn(this.style.background)&&""!==this.style.background,b=g&&g.value,S=l/2;return _?E_(u,f,m.value,v.value,p.x,p.y):!!b&&(j=v.value+l,E_(I=u-S,k=f-S,O=m.value+l,W=g.value+l,J=p.x,K=p.y)||E_(I,k,W,j,J,K)||E_(I,k+j-W,O,W,J,K)||E_(I+O-W,k,W,j,J,K));var I,k,O,j,W,J,K}},Yx=class extends fs{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Jl(g,["style"]);super(qe({type:"text",style:qe(Ht(qe({},Xc),{text:"",width:300,wordWarp:!0,wordBreak:!0,textAlign:"left",textBaseLine:"top",textTransform:"none",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontFamily:"Microsoft YaHei",color:"white",fontSize:12,lineHeight:1,letterSpacing:0}),p)},l)),N(this,"shapeType","text"),N(this,"font",void 0),N(this,"lines",[]),N(this,"chars",[]),N(this,"underlines",[]),N(this,"strikeouts",[]),N(this,"textX",void 0),N(this,"textY",void 0),N(this,"rowWidth",void 0),N(this,"realWidth",void 0),N(this,"totalHeight",void 0),this.setTextFont(),this.calculateTextPosition(),this.calculateLineWarp(),this.calculateCharPosition();const{x:u,y:f}=this.parsedStyle;this.setLocalPosition(u,f),this.updateOrigin()}setTextFont(){const{fontStyle:p,fontVariant:l,fontWeight:u,fontFamily:f,fontSize:g}=this.parsedStyle;this.font=`${p} ${l} ${u} ${g.value}${g.unit} ${f}`}updateOrigin(){if(!this.chars[0])return;const{width:p,height:l}=this.getBoundingRect(),u=this.chars[0].height/10||0,f=this.chars[0].height/2||0;let g=0;switch(this.parsedStyle.textBaseLine){case"top":g=l/2-u;break;case"hanging":g=l/2;break;case"middle":g=f*(this.lines.length-1)-u;break;case"ideographic":g=1.5*-u+f*(this.lines.length-2);break;case"bottom":g=f*(this.lines.length-2)-u;break;default:g=u+f*(this.lines.length-2)}this.setOrigin(p/2-u,g)}calculateTextPosition(){const{x:p,y:l,width:u,letterSpacing:f,borderWidth:g}=this.parsedStyle,m=((null==g?void 0:g.value)||0)/2;this.textX=p+m+f.value,this.textY=l+m+f.value,this.rowWidth=u.value-2*m-2*f.value}calculateLineWarp(){this.totalHeight=0,this.realWidth=0;const{textX:p,rowWidth:l,parsedStyle:u}=this,{lineHeight:f,wordWarp:g,fontSize:m,borderWidth:v}=u,_=document.createElement("canvas").getContext("2d");_.font=this.font;const b=Math.max(m.value,f),S=this.transformText(this.parsedStyle.text);S.length||(this.lines=[],this.totalHeight=0);let I=0;if(S.length){const k=[];let{textY:O}=this,j="";for(let W=0;W<S.length;W++){const J=S.charAt(W);if("\n"!==J&&"\r"!==J){if(j+=J,_.measureText(j).width>=l&&g){if(j=j.substring(0,j.length-1),""===j){j=J;continue}I+=j.length;const K=_.measureText(j).width;K>this.realWidth&&(this.realWidth=_.measureText(j).width),k.push({text:j,x:p,y:O,lineWidth:K,length:j.length,sum:I}),j=J,O+=b,this.totalHeight+=b}}else{const K=_.measureText(j).width;K>this.realWidth&&(this.realWidth=_.measureText(j).width),j+=J,I+=j.length,k.push({text:j,x:p,y:O,lineWidth:K,length:j.length,sum:I}),j="",O+=b,this.totalHeight+=b}}if(""!==j){I+=j.length;const W=_.measureText(j).width;W>this.realWidth&&(this.realWidth=_.measureText(j).width),k.push({text:j,x:p,y:O,lineWidth:W,length:j.length,sum:I})}this.totalHeight+=b,this.lines=k}1===this.lines.length&&(this.realWidth=_.measureText(this.lines[0].text).width),v&&v.value&&(this.realWidth+=v.value)}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:l,textBaseLine:u,fontSize:f,lineHeight:g}=this.parsedStyle,m=f.value>g?f.value:g,v=MQ(u,l,m),_=m/10;return this.boundsDirty=!1,this.bounds={x:p-_,y:v-_,width:this.realWidth+2*_,height:this.totalHeight},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getBoundingRectObject().isPointInPath(p,l)}calculateCharPosition(){this.chars=[];const{lines:p}=this,{fontSize:l,textBaseLine:u}=this.parsedStyle,f=document.createElement("canvas").getContext("2d"),g=l.value;f.font=this.font;let m=0;p.forEach((v,_)=>{let b=v.x;for(let S=0;S<v.text.length;S++){const I=v.text.charAt(S);let{width:k}=f.measureText(I);"\n"!==I&&"\r"!==I||(k=.1),this.chars.push({char:I,index:m+S+1,charIndex:S+1,lineIndex:_,x:b,y:MQ(u,v.y,g),width:k,height:g}),b+=f.measureText(I).width,S===v.text.length-1&&(m+=v.text.length)}})}getCharByPosition(p,l){const u={x:p,y:l};for(let f=0;f<this.chars.length;f++)if(this.getCharBoundingRect(f).isPointInPath(u))return this.chars[f];return null}getCharBoundingRect(p){const{x:l,y:u,width:f,height:g}=this.chars[p];return new ps({style:{x:l,y:u-g/10,width:f,height:g,borderWidth:1,background:"transparent"}})}transformText(p){const{textTransform:l}=this.parsedStyle;switch(l){case"capitalize":p=p[0].toUpperCase()+p.substring(1);break;case"uppercase":p.toLowerCase();break;case"lowercase":p.toUpperCase()}return p}getRelativeYAxis(p){const{height:l}=this.chars[0];return p-this.getTextBaseLineOffset(l)}getTextBaseLineOffset(p){const{textBaseLine:l}=this.parsedStyle,u=p/10;let f;switch(l){case"top":f=u;break;case"hanging":f=0;break;case"middle":f=p/2+u;break;case"ideographic":f=p+1*u;break;case"bottom":f=p+.5*u;break;default:f=p-1.5*u}return f}};function MQ(p,l,u){let f;const g=u/10;switch(p){case"top":f=l-.5*g;break;case"hanging":f=l+.5*g;break;case"middle":f=l-u/2-.5*g;break;case"ideographic":f=l-u-.5*g;break;case"bottom":f=l-u;break;default:f=l+2*g-u}return f}class n2 extends fs{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:l}=f,u=Jl(f,["style"]);super(qe({type:"stampPath",style:qe(Ht(qe({},Xc),{stampPoints:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4}),l)},u)),N(this,"shapeType","stampPath"),N(this,"renderPath",void 0),this.getPath()}getRenderPath(l){const{x:u,y:f}=this.getBoundingRect(),g=[];return l.forEach(m=>{!m||Number.isNaN(m.x)||Number.isNaN(m.y)||g.push({x:m.x-u,y:m.y-f,step:m.step})}),g}getPath(){return this.pathDirty?(this.path=this.parsedStyle.stampPoints,this.renderPath=this.getRenderPath(this.path),this.steps=function(l){if(l.length<1)return[];const u=[];for(let f=0;f<l.length;f++){const g=l[f];0===g.step?u.push(zs("lineTo",[g])):1===g.step?f+2<l.length&&1===l[f+1].step&&1===l[f+2].step&&(u.push(zs("bezierCurveTo",[g,l[f+1],l[f+2]])),f+=2):2===g.step&&u.push(zs("moveTo",[g]))}return u}(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:l,stampPoints:u,lineCap:f}=this.parsedStyle;if(2===u.length)return this.boundsDirty=!1,this.bounds=zx(u[0],u[1],l.value,f),this.bounds;const g=fp(u),m=l.value/2;return this.boundsDirty=!1,this.bounds={x:g.left-m,y:g.top-m,width:g.width+2*m,height:g.height+2*m},this.bounds}}let QO=class extends fs{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Jl(g,["style"]);super(qe({type:"line",style:qe(Ht(qe({},Xc),{startPoint:{x:0,y:0},endPoint:{x:0,y:0},lineEnding:["None","None"],borderWidth:2}),p)},l)),N(this,"shapeType","line"),N(this,"renderPath",void 0),this.getPath();const{x:u,y:f}=this.getBoundingRect();this.updatePosition(u,f),this.updateOrigin()}initPath(){const{startPoint:p,endPoint:l,lineEnding:u}=this.parsedStyle,f=[Ht(qe({},p),{step:0,close:!1}),Ht(qe({},l),{step:1,close:!1})];if(u)for(let g=0;g<u.length;g++)switch(u[g]){case"OpenArrow":this.addOpenArrow(f,g,!1);break;case"ROpenArrow":this.addOpenArrow(f,g,!0);break;case"ClosedArrow":this.addCloseArrow(f,g,!1);break;case"RClosedArrow":this.addCloseArrow(f,g,!0);break;case"Butt":this.addButt(f,g);break;case"Slash":this.addSlash(f,g);break;case"Square":this.addSquare(f,g);break;case"Diamond":this.addDiamond(f,g);break;case"Circle":this.addCircle(f,g)}return f}getRenderPath(p){const{x:l,y:u}=this.getBoundingRect(),f=[];return p.forEach(g=>{!g||Number.isNaN(g.x)||Number.isNaN(g.y)||f.push({x:g.x-l,y:g.y-u,step:g.step,close:g.close})}),f}updatePoints(){const p=this.getLocalPosition();this.updateStyle({startPoint:{x:this.renderPath[0].x+p.x,y:this.renderPath[0].y+p.y},endPoint:{x:this.renderPath[1].x+p.x,y:this.renderPath[1].y+p.y}})}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=yQ(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p,lineCap:l}=this.parsedStyle,u=fp(this.path);if(2===this.path.length)return this.boundsDirty=!1,this.bounds=zx(this.path[0],this.path[1],p.value,l),this.bounds;const f=p.value/2||0;return this.boundsDirty=!1,this.bounds={x:u.left-f,y:u.top-f,width:u.width+2*f,height:u.height+2*f},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,l))return!1;const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;return e2(u,f,g.value+l,p)}isLineArrow(){const{lineEnding:p}=this.parsedStyle;return!!p&&("None"!==p[0]||"None"!==p[1])}addCircle(p,l){const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;IQ(p,l,u,f,g.value)}addDiamond(p,l){const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;TQ(p,l,u,f,g.value)}addSquare(p,l){const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;SQ(p,l,u,f,g.value)}addSlash(p,l){const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;wQ(p,l,u,f,g.value)}addButt(p,l){const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;xQ(p,l,u,f,g.value)}addOpenArrow(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:f,endPoint:g,borderWidth:m}=this.parsedStyle;CQ(p,l,u,f,g,m.value)}addCloseArrow(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:f,endPoint:g,borderWidth:m}=this.parsedStyle;bQ(p,l,u,f,g,m.value)}},IEe=class extends ps{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=u,l=Jl(u,["style"]);super(qe({type:"stamp",style:Ht(qe({},p),{background:"transparent",borderColor:"transparent"})},l)),N(this,"shapeType","stamp"),N(this,"stampConfig",[]),N(this,"stampItemShapes",[]),N(this,"renderType","stamp"),N(this,"initialWidth",0),N(this,"initialHeight",0),this.stampConfig=p.stampConfig||[]}initStamp(){this.stampConfig&&(this.renderType="stamp",this.initStampItem(),this.initStampStyle())}initStampItem(){if(!Di(this.stampConfig))return;this.stampItemShapes=[];const{stampConfig:p,stampItemShapes:l}=this,{renderBlendMode:u}=this.parsedStyle;for(let f=0;f<p.length;f++){let g;"path"===p[f].type&&(g=new n2({style:qe({opacity:this.style.opacity,renderBlendMode:u},p[f])})),"text"===p[f].type&&(g=new Yx({style:qe({opacity:this.style.opacity,renderBlendMode:u},p[f])})),"image"===p[f].type&&(g=new Ev({style:qe({opacity:this.style.opacity,renderBlendMode:u},p[f])})),g&&l.push(g)}}initStampStyle(){if(!Di(this.stampConfig))return;const p=[],l=[],{stampItemShapes:u}=this;for(let f=0;f<u.length;f++){const g=u[f];if(!(g instanceof Yx)){const m=g.getBoundingRect();p.push(m.x,m.x+m.width),l.push(m.y,m.y+m.height)}this.appendChild(g)}this.initialWidth=Math.max(...p)-Math.min(...p),this.initialHeight=Math.max(...l)-Math.min(...l),this.updateStyle({x:Math.min(...p),y:Math.min(...l),width:this.initialWidth,height:this.initialHeight});for(let f=0;f<u.length;f++){const g=u[f].getBoundingRect();u[f].setLocalPosition(g.x-this.style.x,g.y-this.style.y)}this.updateOrigin()}isPointInPath(p,l){return super.isPointInPath(p,0)}};class ZO extends fs{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:l}=m,u=Jl(m,["style"]);super(qe({type:"roundedRect",style:qe(Ht(qe({},Xc),{roundedRadius:0,width:0,height:0}),l)},u)),N(this,"shapeType","roundedRect");const{x:f,y:g}=this.parsedStyle;this.setLocalPosition(f,g),this.updateOrigin()}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:l,y:u,width:f,height:g}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:l,y:u,width:f.value,height:g.value},this.bounds}isPointInPath(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:f,y:g,width:m,height:v,borderWidth:_}=this.parsedStyle,b=(_.value+u||0)/2;return E_(f-b,g-b,m.value+2*b,v.value+2*b,l.x,l.y)}getCenterPosition(){const{width:l,height:u}=this.parsedStyle,f=new Vg({style:{x:l.value/2,y:u.value/2}});this.appendChild(f);const{x:g,y:m}=f.getPosition();return f.destroy(),{x:g,y:m}}}class OQ extends fs{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:l}=m,u=Jl(m,["style"]);super(qe({type:"freeText",style:qe(Ht(qe({},Xc),{width:0,height:0,textAlign:"left"}),l)},u)),N(this,"shapeType","freeText"),N(this,"lines",void 0),N(this,"textType","textBox"),N(this,"renderClipPath",void 0),N(this,"renderClipStep",void 0),N(this,"totalTextHeight",0),N(this,"limitWidth",1),N(this,"textMaxWidth",0),N(this,"borderOffset",0),N(this,"padding",1),this.textType=l.freeTextType||"textBox",this.setLimitWidth(this.parsedStyle.width.value),this.calculateContentLines();const{x:f,y:g}=this.parsedStyle;this.setLocalPosition(f,g),this.updateOrigin()}getLimitTextWithoutSpace(l,u){const{textContents:f}=this.parsedStyle,g=hn(l),v=g.segmentation[g.segmentation.length-1],_=Hu(" ",f[v.freeContentIndex]),b=v.text.split(" ").length-1;let S;for(let I=0;I<b&&(S=I+1,!(g.width-S*_<u));I++);for(let I=0;I<S;I++)g.word=g.word.slice(0,-1),g.width-=_,v.text=v.text.slice(0,-1),v.width-=_;return g}splitWordSegment(l,u){const f=l,g=[],m=[];let v=u;const _=f.segmentation.length;for(let S=0;S<_;S++){const I=f.segmentation[S];if(!(I.width<v)){if(I.width===v){g.push(qe({},I)),m.push(...f.segmentation.slice(_-S-1));break}{const k=this.parsedStyle.textContents[I.freeContentIndex],O=EEe(I.text,v,k);2===O.length?(g.push({text:O[0],width:Hu(O[0],k),freeContentIndex:I.freeContentIndex}),m.push({text:O[1],width:Hu(O[1],k),freeContentIndex:I.freeContentIndex})):m.push(qe({},I));const j=_-S-1;j>0&&m.push(...f.segmentation.slice(-j));break}}g.push(qe({},I)),v-=I.width}const b=S=>{let I="",k=0;return S.forEach(O=>{I+=O.text,k+=O.width}),{word:I,width:k,segmentation:S}};return 0===g.length?[b(m)]:[b(g),b(m)]}getWordSegmentation(){const{textContents:l}=this.parsedStyle;let u="";const f=[0];l.forEach(b=>{u+=b.content,f.push(u.length)});const g=u.match(/\S+\s*/g)||[],m=[];let v=0;const _=function(b){const I=b.match(/^(?:\r\n|\r|\n)*/);if(I){const k=I[0];let O=0;for(const j of k)"\n"!==j&&"\r"!==j||(O+=1);return k.includes("\r\n")&&(O-=1),Array.from({length:O},()=>"\n")}return[]}(u);if(_.length&&g.unshift(..._)," "===u[0]){const b=u.match(/^ +/)[0];g[0]=g[0]?b+g[0]:b}for(let b=0;b<g.length;b++){const S=g[b].split(/(\r\n|[\r\n])/).filter(I=>""!==I);S.length>2&&(g[b]=S[0]+S[1],g.splice(b+1,0,...S.slice(2)))}return g.forEach(b=>{const S=v+b.length-1,I=[...f.filter(k=>k>v&&k<=S)];if(0===I.length){const k=f.filter(j=>j<=v).length,O=Hu(b,l[k-1]);m.push({word:b,segmentation:[{text:b,width:O,freeContentIndex:k-1}],width:O})}else{const k=[];let O=0;I.forEach((j,W)=>{const J=j-(I[W-1]||v),K=I[W-1]-v||0,Q=b.substring(K,K+J),ie=Hu(Q,l[f.indexOf(j)-1]);if(k.push({text:Q,width:ie,freeContentIndex:f.indexOf(j)-1}),O+=ie,W===I.length-1){const oe=Hu(b.substring(K+J),l[f.indexOf(j)]);k.push({text:b.substring(K+J),freeContentIndex:f.indexOf(j),width:oe}),O+=oe}}),m.push({word:b,width:O,segmentation:k})}v+=b.length}),m}organizeLine(){if(0===this.lines.length)return;const{y:l}=this.parsedStyle;let u=l+this.borderOffset+this.padding,f=0,g=0;this.lines.forEach((m,v)=>{g=0,f=Math.max(m.width,f);let _=0,b="";if(0===m.width&&""===m.words[0].text){const S=Hu(" ",m.words[0].style);m.width=S,m.words[0].wordWidth=S,m.words[0].text=" "}if(m.words.forEach(S=>{b+=S.text,_=Math.max(_,S.wordHeight),S.widthWithoutLf=Xx(S.text)?Hu(S.text,S.style,!0):S.wordWidth,g+=S.widthWithoutLf}),"textBox"===this.textType&&"justify"===this.style.textAlign&&v!==this.lines.length-1){const S=[],I=/\b\w/g;let k,O=0;for(;null!==(k=I.exec(b));)S.push(k.index);if(S.length>1){const j=(this.limitWidth-g)/(S.length-1),W=J=>{for(let K=0;K<S.length;K++)if(S[K]>J)return K;return S.length};m.words.forEach((J,K)=>{K>0&&(J.x+=j*(W(O)-1)),O+=J.text.length}),g=this.limitWidth,m.width=this.limitWidth}}m.widthWithoutLF=g,m.height=_,m.y=.8*_+u,u+=_,v>0&&(m.y+=.2*this.lines[v-1].height,u+=.2*this.lines[v-1].height)}),this.textMaxWidth=f}getTextAlignOffset(l){if("freeTextWriter"===this.textType)return 0;const{limitWidth:u}=this,{textAlign:f}=this.parsedStyle,g=l?l.widthWithoutLF:0;let m=0;return"center"===f?m=(u-g)/2:"right"===f&&(m=u-g),m}getPath(){var l;if(!this.pathDirty)return this.path;const{width:u,height:f}=this.getBoundingRect(),g=.5*((null===(l=this.parsedStyle.borderWidth)||void 0===l?void 0:l.value)||0),m=g,v=g,_=u-2*g,b=f-2*g;if(this.path=[{x:m,y:v},{x:m+_,y:v},{x:m+_,y:v+b},{x:m,y:v+b}],this.borderOffset){const S=this.borderOffset/2;this.renderClipPath=[{x:m+S,y:v+S},{x:m+_-S,y:v+S},{x:m+_-S,y:v+b-S},{x:m+S,y:v+b-S}],this.renderClipStep=T_(this.renderClipPath)}return this.steps=T_(this.path),this.pathDirty=!1,this.path}setLimitWidth(l){const{borderWidth:u,borderColor:f}=this.parsedStyle;"textBox"===this.textType&&u.value&&!f.isNone&&(this.borderOffset=u.value,this.padding=u.value),this.limitWidth=l-2*this.borderOffset-2*this.padding}calculateContentLines(){const{textContents:l,x:u}=this.parsedStyle;if(null==l||!l.length||this.limitWidth<=0)return this.lines=[],void this.calculateTotalHeight();const f=this.getWordSegmentation(),g=[],m=u+this.borderOffset+this.padding;let v=m,_=0,b=[];const S=function(O){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;O.segmentation.forEach((W,J)=>{const K=l[W.freeContentIndex];b.push({text:W.text,originText:j.segmentation[J].text,freeContentIndex:W.freeContentIndex,x:v,wordWidth:W.width,wordHeight:K.fontSize.value,style:K}),v+=W.width,_+=W.width})},I=()=>{0!==b.length&&(g.push({words:b,width:_,x:m}),v=m,_=0,b=[])},k=(O,j)=>{if(O.width<=j)S(O),Xx(O.word)&&I();else{const W=this.getLimitTextWithoutSpace(O,j);if(W.width<=j)S(W,O);else{const J=this.splitWordSegment(O,j);if(2===J.length){const K=J[1].word;"\r"!==K&&"\n"!==K&&"\r\n"!==K?(S(J[0]),I(),k(J[1],j)):(S(O),I())}else{const K=Hu(O.word[0],l[O.segmentation[0].freeContentIndex]),Q=this.splitWordSegment(O,K+.1);S(Q[0]),I(),k(Q[1],j)}}}};f.forEach(O=>{const j=this.limitWidth-_;if(O.width<=j)S(O),Xx(O.word)&&I();else{const W=this.getLimitTextWithoutSpace(O,j);W.width>j?O.width>this.limitWidth?(I(),k(O,this.limitWidth)):(I(),S(O),Xx(O.word)&&I()):(S(W,O),I())}}),I(),this.lines=g,this.organizeLine(),this.calculateTotalHeight()}calculateTotalHeight(){const{y:l,height:u}=this.parsedStyle,f=this.lines.length;if(f){const g=this.lines[f-1];let m=g.y+.2*g.height+-l+2*this.borderOffset;Xx(g.words[0].text)&&(m+=1.2*g.height),this.totalTextHeight=m>u.value?m:u.value}else this.totalTextHeight=u.value}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:l,y:u,height:f}=this.parsedStyle;let g=f.value,m=this.limitWidth+2*this.borderOffset+2*this.padding;return"freeTextWriter"===this.textType?(m=this.textMaxWidth+2*this.borderOffset+2*this.padding,g=this.totalTextHeight):m=this.parsedStyle.width.value,this.boundsDirty=!1,this.bounds={x:l,y:u,width:m,height:g},this.bounds}isPointInPath(l){return this.getBoundingRectObject().isPointInPath(l)}}function Hu(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{fontSize:f,fontStyle:g,fontFamily:m,fontWeight:v}=l,_=document.createElement("canvas").getContext("2d"),b=""===(null==m?void 0:m.trim())?"sans-serif":m;_.font=null!=m&&m.includes(" ")?`${g} ${v} ${f.value}${f.unit} '${b}'`:`${g} ${v} ${f.value}${f.unit} ${b}`;let S=0;for(let I=0;I<p.length;I++){const k=p.charAt(I);u&&DEe(k)||(S+=_.measureText(k).width)}return S}function EEe(p,l,u){let f=0;for(let g=0;g<p.length;g++)if(Hu(p.substring(0,g+1),u)>l){f=g;break}return 0===f?[p]:[p.substring(0,f),p.substring(f)]}function DEe(p){return/^[\r\n]+$/.test(p)}function Xx(p){return p.endsWith("\n")||p.endsWith("\r")||p.endsWith("\r\n")}const i2=1/0;class Nl{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i2,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i2,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;N(this,"minX",void 0),N(this,"maxX",void 0),N(this,"minY",void 0),N(this,"maxY",void 0),N(this,"rect",void 0),N(this,"updateId",void 0),this.minX=l,this.maxX=u,this.minY=f,this.maxY=g,this.rect=null,this.updateId=-1}static isEmpty(l){return l.minX===l.maxX&&l.minY===l.maxY}static fromBounds(l){return(new Nl).setFromBounds(l)}static create(){return new Nl}setFromBounds(l){return this.minX=l.minX,this.minY=l.minY,this.maxX=l.maxX,this.maxY=l.maxY,this}clear(){return this.minX=i2,this.maxX=-1/0,this.minY=i2,this.maxY=-1/0,this}getRect(l){const{minX:u,minY:f,maxX:g,maxY:m}=this;if(u>g||f>m)return new GJ(0,0,0,0);const v=l||new GJ;return v.update(u,f,g-u,m-f),v}addPoint(l){return this.addBounds({minX:l.x,maxX:l.x,minY:l.y,maxY:l.y})}addBounds(l){const u=e5(this,l);return this.setFromBounds(u)}addBoundsMask(l,u){const f=FQ(l,u);if(f.minX<=f.maxX&&f.minY<=f.maxY){const g=e5(f,this);this.setFromBounds(g)}return this}intersection(l){if(!((u=this).minX<=(f=l).maxX&&u.maxX>=f.minX&&u.minY<=f.maxY&&u.maxY>=f.minY))return null;var u,f;const g=FQ(this,l);return Nl.fromBounds(g)}union(l){const u=e5(this,l);return Nl.fromBounds(u)}addBoundsArea(l,u){const{x:f,y:g,width:m,height:v}=u;return this.addBoundsMask(l,{minX:f,minY:g,maxX:f+m,maxY:g+v})}addFrame(l,u){return this.setFromTransformedBounds(l.worldTransform,u)}setFromTransformedBounds(l,u){for(let f=0;f<2;f++){const g=l.transformPoint({x:f?u.maxX:u.minX,y:f?u.maxY:u.minY});this.addPoint(g)}return this}addQuad(l){for(let u=0;u<4;u++)this.addPoint({x:l[2*u],y:l[2*u+1]})}}function FQ(p,l){return{minX:p.minX>l.minX?p.minX:l.minX,minY:p.minY>l.minY?p.minY:l.minY,maxX:p.maxX<l.maxX?p.maxX:l.maxX,maxY:p.maxY<l.maxY?p.maxY:l.maxY}}function e5(p,l){return{minX:p.minX<l.minX?p.minX:l.minX,minY:p.minY<l.minY?p.minY:l.minY,maxX:p.maxX>l.maxX?p.maxX:l.maxX,maxY:p.maxY>l.maxY?p.maxY:l.maxY}}class AEe extends fs{constructor(){super({}),N(this,"name","Document"),N(this,"defaultView",void 0),N(this,"documentElement",void 0),N(this,"timeLine",void 0),this.nodeName="document",this.documentElement=new fs({name:"Root",id:"root",style:{visibility:"visible"}}),this.documentElement.ownerDocument=this,this.documentElement.parentNode=this,this.childNodes=[this.documentElement]}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}createElement(l,u){return new(this.defaultView.customElements.get(l))(u)}getElementById(l){return null}getElementsByName(l){return this.documentElement.getElementsByTagName(l)}getElementsByTagName(l){return this.documentElement.getElementsByTagName(l)}getElementsByClassName(l){return this.documentElement.getElementsByClassName(l)}append(){return this.documentElement.append(...arguments)}prepend(){return this.documentElement.prepend(...arguments)}querySelector(l){return this.documentElement.querySelector(l)}querySelectorAll(l){return this.documentElement.querySelectorAll(l)}find(l){return this.documentElement.find(l)}findAll(l){return this.documentElement.findAll(l)}appendChild(l){return this.documentElement.appendChild(l)}cloneNode(l){return this.documentElement.cloneNode(l)}insertBefore(l,u){return this.documentElement.insertBefore(l,u)}removeChild(l){return this.documentElement.removeChild(l)}replaceChild(l,u){return this.documentElement.replaceChild(l,u)}destroy(){}}class LQ extends Wx{constructor(){super(...arguments),N(this,"altKey",void 0),N(this,"button",void 0),N(this,"buttons",void 0),N(this,"ctrlKey",void 0),N(this,"metaKey",void 0),N(this,"shiftKey",void 0),N(this,"relatedTarget",void 0),N(this,"client",new Ar),N(this,"movement",new Ar),N(this,"offset",new Ar),N(this,"page",new Ar),N(this,"screen",new Ar),N(this,"global",new Ar),N(this,"canvas",new Ar)}initEvent(l,u,f){throw new Error("Method not implemented.")}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.client.x}get y(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.x}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}getModifierState(l){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(l)}initMouseEvent(l,u,f,g,m,v,_,b,S,I,k,O,j,W,J){throw this.initUIEvent(l,f,f,g,m),new Error("initMouseEvent() DOM API is deprecated.")}}function t5(p,l){l.altKey=p.altKey,l.button=p.button,l.buttons=p.buttons,l.ctrlKey=p.ctrlKey,l.metaKey=p.metaKey,l.shiftKey=p.shiftKey,l.relatedTarget=null,l.client.setFromPoint(p.client),l.movement.setFromPoint(p.movement),l.offset.setFromPoint(p.offset),l.page.setFromPoint(p.page),l.screen.setFromPoint(p.screen),l.global.setFromPoint(p.global),l.canvas.setFromPoint(p.canvas)}class n5 extends LQ{constructor(){super(...arguments),N(this,"deltaMode",void 0),N(this,"deltaX",void 0),N(this,"deltaY",void 0),N(this,"deltaZ",void 0),N(this,"DOM_DELTA_PIXEL",0),N(this,"DOM_DELTA_LINE",1),N(this,"DOM_DELTA_PAGE",2)}}function NQ(p,l){l.deltaMode=p.deltaMode,l.deltaX=p.deltaX,l.deltaY=p.deltaY,l.deltaZ=p.deltaZ}class jg extends LQ{constructor(l){super(l),N(this,"height",0),N(this,"isPrimary",void 0),N(this,"pointerId",void 0),N(this,"pointerType",void 0),N(this,"pressure",void 0),N(this,"tangentialPressure",void 0),N(this,"tiltX",void 0),N(this,"tiltY",void 0),N(this,"twist",void 0),N(this,"width",0),N(this,"getCoalescedEvents",void 0),N(this,"getPredictedEvents",void 0),this.isPrimary=!1,this.height=0,this.width=0}}function i5(p,l){l.isPrimary=p.isPrimary,l.width=p.width,l.height=p.height,l.tiltX=p.tiltX,l.tiltY=p.tiltY,l.pointerType=p.pointerType,l.pointerId=p.pointerId,l.pressure=p.pressure,l.twist=p.twist,l.tangentialPressure=p.tangentialPressure}class PEe{constructor(l,u){N(this,"root",void 0),N(this,"cursor","default"),N(this,"events",void 0),N(this,"trackingData",void 0),N(this,"contextService",void 0),this.root=l,this.contextService=u,this.events={},this.trackingData={},this.on("pointerdown",this.onPointerdown.bind(this)),this.on("pointermove",this.onPointermove.bind(this)),this.on("pointerout",this.onPointerout.bind(this)),this.on("pointerleave",this.onPointerout.bind(this)),this.on("pointerover",this.onPointerover.bind(this)),this.on("pointerup",this.onPointerup.bind(this)),this.on("wheel",this.onWheel.bind(this))}clientToCanvas(l){const u=this.contextService.getBoundingClientRect();return new Ar(l.x-(u.x||0),l.y-(u.y||0))}canvasToClient(l){const u=this.root.defaultView.contextService.getBoundingClientRect();return new Ar(l.x+(u.x||0),l.y+(u.y||0))}getPropagationPath(l){const u=[l];for(;fs.isNode(l)&&l!==this.root;)u.push(l=l.parentNode);return u.reverse()}getHitTarget(l,u){const{root:f}=this,{isInteractive:g}=f,m=BQ(f,g,new Ar(l,u));return m?m[0]:null}on(l,u){this.events[l]||(this.events[l]=[]),this.events[l].push({fn:u,order:0}),this.events[l].sort((f,g)=>f.order-g.order)}emit(l){if(!this.root)return;const u=this.events[l.type]||[];for(let f=0;f<u.length;f++)u[f].fn(l)}onPointerdown(l){if(!(l instanceof jg))return;const u=this.generatePointerEvent(l);let f;Ca(u,"pointerdown"),"touch"===u.pointerType?f="touchstart":D_(u)&&(f=2===u.button?"rightdown":"mousedown"),Ca(u,f),this.getTrackingData(l.pointerId).pressTargetsByButton[l.button]=u.composedPath()}onPointermove(l){if(!(l instanceof jg))return;const u=this.generatePointerEvent(l),f=D_(u),g=this.getTrackingData(l.pointerId),m=r5(g.overTargets);if(m&&m!==u.target){const b=this.generatePointerEvent(l,"mousemove"===l.type?"mouseout":"pointerout",m);Ca(b,"pointerout"),f&&Ca(b,"mouseout");const S=u.composedPath();if(!S.includes(m)){const I=this.generatePointerEvent(l,"pointerleave",m);for(I.eventPhase=I.AT_TARGET;I.target&&!S.includes(I.target);)I.currentTarget=I.target,Yc(I,I.type),f&&Yc(I,"mouseleave"),I.target=I.target.parentNode}}if(m!==u.target){const b=this.clonePointerEvent(u,"mousemove"===l.type?"mouseover":"pointerover");Ca(b,"pointerover"),f&&Ca(b,"mouseover");let S=fs.isNode(m)&&(null==m?void 0:m.parentNode);for(;S&&S!==(fs.isNode(this.root)&&this.root.parentNode)&&S!==u.target;)S=S.parentNode;if(!S||S===this.root.parentNode){const I=this.clonePointerEvent(u,"pointerenter");for(I.eventPhase=I.AT_TARGET;I.target&&I.target!==m&&I.target!==this.root.parentNode;)I.currentTarget=I.target,Yc(I,I.type),f&&Yc(I,"mouseenter"),I.target=I.target.parentNode}}var v;Ca(u,"pointermove"),"touch"===u.pointerType&&Ca(u,"touchmove"),f&&(Ca(u,"mousemove"),this.cursor=null===(v=u.target)||void 0===v?void 0:v.cursor),g.overTargets=u.composedPath()}onPointerup(l){if(!(l instanceof jg))return;const u=performance.now(),f=this.generatePointerEvent(l);Ca(f,"pointerup");const{pointerType:g}=f;let m;"touch"===g?m="touchend":D_(f)&&(m=2===f.button?"rightup":"mouseup"),Ca(f,m);const v=this.getTrackingData(l.pointerId),_=r5(v.pressTargetsByButton[l.button]);let b=_;const S=f.composedPath();if(_&&!S.includes(_)){let I=_;for(;I&&!S.includes(I);)f.currentTarget=I,Yc(f,"pointerupoutside"),"touch"===g?m="touchendoutside":D_(f)&&(m=2===f.button?"rightupoutside":"mouseupoutside"),Yc(f,m),I=I.parentNode;delete v.pressTargetsByButton[l.button],b=I}if(b){const I=this.clonePointerEvent(f,"click");I.target=b,I.path=null,v.clicksByButton[l.button]||(v.clicksByButton[l.button]={clickCount:0,target:I.target,timeStamp:u});const k=v.clicksByButton[l.button];k.target===I.target&&u-k.timeStamp<200?k.clickCount+=1:k.clickCount=1,k.target=I.target,k.timeStamp=u,I.detail=k.clickCount,m="mouse"===g?"click":"touch"===g?"tap":"pointertap",Ca(I,m)}}onPointerout(l){if(!(l instanceof jg))return;const u=this.getTrackingData(l.pointerId);if(u.overTargets){const f=D_(l),g=r5(u.overTargets),m=this.generatePointerEvent(l,"pointerout",g);Ca(m),f&&Ca(m,"mouseout");const v=this.generatePointerEvent(l,"pointerleave",g);for(v.eventPhase=v.AT_TARGET;v.target&&v.target!==this.root.parentNode;)v.currentTarget=v.target,Yc(v,v.type),f&&Yc(v,"mouseleave"),v.target=v.target.parentNode;u.overTargets=null}this.cursor=null}onPointerover(l){if(!(l instanceof jg))return;const u=this.getTrackingData(l.pointerId),f=this.generatePointerEvent(l),g=D_(l);var m;Ca(f,"pointerover"),g&&Ca(f,"mouseover"),"mouse"===f.pointerType&&(this.cursor=null===(m=f.target)||void 0===m?void 0:m.cursor);const v=this.clonePointerEvent(f,"pointerenter");for(v.eventPhase=v.AT_TARGET;v.target&&v.target!==this.root.parentNode;)v.currentTarget=f.target,Yc(v,v.type),g&&Yc(v,"mouseenter"),v.target=v.target.parentNode;u.overTargets=f.composedPath()}onWheel(l){l instanceof n5&&Ca(this.generateWheelEvent(l))}generatePointerEvent(l,u,f){const g=new jg(this);return i5(l,g),t5(l,g),Ux(l,g),g.nativeEvent=l.nativeEvent,g.originalEvent=l,g.target=null!=f?f:this.getHitTarget(g.globalX,g.globalY),g.type=null!=u?u:g.type,g}generateWheelEvent(l){const u=new n5(this);return NQ(l,u),t5(l,u),Ux(l,u),u.nativeEvent=l.nativeEvent,u.originalEvent=l,u.target=this.getHitTarget(u.globalX,u.globalY),u}clonePointerEvent(l,u){const f=new jg(this);return i5(l,f),t5(l,f),Ux(l,f),f.nativeEvent=l.nativeEvent,f.originalEvent=l,f.target=l.target,f.path=l.composedPath().slice(),f}getTrackingData(l){return this.trackingData[l]||(this.trackingData[l]={pressTargetsByButton:{},clicksByButton:{},overTargets:null}),this.trackingData[l]}}function D_(p){const{pointerType:l}=p;return"mouse"===l||"pen"===l}function r5(p){if(!p)return null;let l=p[0]||null;for(let u=1,f=p.length;u<f&&p[u].parentNode===l;u++)l=p[u];return l}function BQ(p,l,u){if(!p||"visible"!==p.style.visibility)return null;const{hitArea:f}=p.style;if(f){const{x:m,y:v}=p.transform.worldTransform.transformPoint(u);if(!f.contains(m,v))return null}const{clipPath:g}=p.style;if(g&&!g.containPoint(u))return null;if(p.isChildrenInteractive&&p.children){const{children:m}=p;for(let v=m.length-1;v>=0;v--){const _=m[v],b=BQ(_,l||_.isInteractive,u);if(b)return(b.length>0||p.isInteractive)&&b.push(p),b}}return l&&p.containPoint(u)?p.isInteractive?[p]:[]:null}N(class{constructor(){N(this,"canvasConfig",void 0),N(this,"contextService",void 0),N(this,"renderingContext",void 0),N(this,"eventService",void 0),N(this,"rootPointerEvent",new jg(null)),N(this,"rootWheelEvent",new n5(null)),N(this,"autoPreventDefault",!0)}init(p){const{renderingService:l,renderingContext:u,contextService:f,canvasConfig:g}=p;this.eventService=new PEe(u.root.parentNode,f),p.eventService=this.eventService,this.renderingContext=u,this.contextService=f,this.canvasConfig=g,l.hooks.wheel.on(this.onWheel),l.hooks.pointerdown.on(this.onPointerdown),l.hooks.pointermove.on(this.onPointermove),l.hooks.pointerup.on(this.onPointerup),l.hooks.pointerout.on(this.onPointermove),l.hooks.pointerover.on(this.onPointermove)}destroy(){}onWheel(p){const l=this.normalizeWheelEvent(p);this.eventService.emit(l)}onPointerdown(p){if(this.isTouchEvent(p))return;const l=this.normalizeToPointerEvent(p);this.autoPreventDefault&&l.isNormalized&&(p.cancelable||!("cancelable"in p))&&p.preventDefault();const u=this.bootstrapEvent(l,this.rootPointerEvent);this.eventService.emit(u),this.setCursor(this.eventService.cursor)}onPointermove(p){if(this.isTouchEvent(p))return;const l=this.normalizeToPointerEvent(p),u=this.bootstrapEvent(l,this.rootPointerEvent);this.eventService.emit(u),this.setCursor(this.eventService.cursor)}onPointerup(p){if(this.isTouchEvent(p))return;const l=this.contextService.getDomElement(),u=p.target===l?"":"outside",f=this.normalizeToPointerEvent(p),g=this.bootstrapEvent(f,this.rootPointerEvent);g.type+=u,this.eventService.emit(g),this.setCursor(this.eventService.cursor)}setCursor(p){this.contextService.setCursor(p||this.canvasConfig.cursor||"default")}normalizeWheelEvent(p){const l=this.rootWheelEvent;l.nativeEvent=p,this.transferMouseData(p,l),NQ(p,l);const u=new Ar(p.clientX,p.clientY),{x:f,y:g}=this.eventService.clientToCanvas(u);return l.canvas.x=f,l.canvas.y=g,l.offset.setFromPoint(l.canvas),l.global.setFromPoint(l.canvas),Ux(p,l),l}normalizeToPointerEvent(p){const l=this.renderingContext.root.ownerDocument.defaultView;if(l.supportTouchEvent&&p instanceof TouchEvent){const u=p;u.isNormalized=!0,u.pointerType="touch"}else if(!MouseEvent||p instanceof MouseEvent&&(!l.supportPointerEvent||!(p instanceof PointerEvent))){const u=p;u.isPrimary=!0,u.width=1,u.height=1,u.tiltX=0,u.tiltY=0,u.pointerType="mouse",u.pointerId=1,u.pressure=.5,u.twist=0,u.tangentialPressure=0,u.isNormalized=!0}return p}bootstrapEvent(p,l){l.originalEvent=null,l.nativeEvent=p,i5(p,l),this.transferMouseData(p,l);const{x:u,y:f}=this.eventService.clientToCanvas(new Ar(p.clientX,p.clientY));return l.canvas.x=u,l.canvas.y=f,l.offset.setFromPoint(l.canvas),l.global.setFromPoint(l.canvas),Ux(p,l),"pointerleave"===l.type&&(l.type="pointerout"),l.type.startsWith("mouse")&&l.type.replace("mouse","pointer"),l}transferMouseData(p,l){l.altKey=p.altKey,l.button=p.button,l.buttons=p.buttons,l.ctrlKey=p.ctrlKey,l.metaKey=p.metaKey,l.shiftKey=p.shiftKey,l.relatedTarget=null,l.client.x=p.clientX,l.client.y=p.clientY,l.movement.x=p.movementX,l.movement.y=p.movementY,l.page.x=p.pageX,l.page.y=p.pageY,l.screen.x=p.screenX,l.screen.y=p.screenY}isTouchEvent(p){return this.renderingContext.root.ownerDocument.defaultView.supportTouchEvent&&"touch"===p.pointerType}},"moduleName","Event");class Dv extends Wx{constructor(l,u,f,g,m,v,_,b){super(null),N(this,"relatedNode",void 0),N(this,"prevValue",void 0),N(this,"newValue",void 0),N(this,"attrName",void 0),N(this,"attrChange",void 0),N(this,"prevParsedValue",void 0),N(this,"newParsedValue",void 0),this.type=l,this.relatedNode=u,this.prevValue=f,this.newValue=g,this.attrName=m,this.attrChange=v,this.prevParsedValue=_,this.newParsedValue=b}}N(Dv,"ADDITION",2),N(Dv,"MODIFICATION",1),N(Dv,"REMOVAL",3);class kEe{constructor(l){N(this,"hooks",{init:Fo.create(),beginFrame:Fo.create(),beforeRender:Fo.create(),render:Fo.create(),afterRender:Fo.create(),putImageData:Fo.create(),endFrame:Fo.create(),destroy:Fo.create(),pointerdown:Fo.create(),pointerup:Fo.create(),pointermove:Fo.create(),pointerout:Fo.create(),pointerover:Fo.create(),pointerCancel:Fo.create(),wheel:Fo.create()}),N(this,"isInited",!1),N(this,"zIndexCounter",0),N(this,"renderingContext",void 0),this.renderingContext=l}init(){this.hooks.init.emit(),this.isInited=!0}destroy(){this.isInited=!1,this.hooks.destroy.emit()}render(){const{root:l}=this.renderingContext;this.zIndexCounter=0,$i.recursiveUpdateHierarchy(l),this.isInited&&(this.renderDisplayObject(l),this.renderingContext.dirty&&(this.hooks.endFrame.emit(),this.renderingContext.dirty=!1),this.renderingContext.renderCondition.clear())}renderDisplayObject(l){if(!l.isVisible)return;const{sortable:u}=l;if(u.renderOrder=this.zIndexCounter,this.zIndexCounter+=1,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.emit()),l.imageData)return void this.hooks.putImageData.emit(l);this.hooks.beforeRender.emit(l),this.hooks.render.emit(l),this.hooks.afterRender.emit(l);let f=!1;u.dirty&&(u.sorted=l.childNodes.slice().sort(MEe),u.dirty=!1,f=!0);const g=u.sorted||l.childNodes;g.length>1&&g.sort((m,v)=>m.style.zIndex-v.style.zIndex),g.forEach(m=>{this.renderDisplayObject(m)}),g.sort((m,v)=>m.index-v.index),f&&l.recursiveCall(m=>{const v=new Wg("renderOrderChanged",{renderOrder:m.sortable.renderOrder});m.dispatchEvent(v)})}dirty(){this.renderingContext.renderCondition.add(0)}}function MEe(p,l){const u=Number(p.style.zIndex),f=Number(l.style.zIndex);if(u===f&&p.parentNode){const{childNodes:g=[]}=p.parentNode;return g.indexOf(p)-g.indexOf(l)}return u-f}class WQ extends aQ{constructor(l){super(),N(this,"document",void 0),N(this,"customElements",void 0),N(this,"devicePixelRatio",void 0),N(this,"eventService",void 0),N(this,"renderingService",void 0),N(this,"renderingContext",void 0),N(this,"canvasConfig",void 0),N(this,"renderer",void 0),N(this,"supportTouchEvent",void 0),N(this,"supportPointerEvent",void 0),N(this,"contextService",void 0);const{renderer:u,dpr:f,width:g,height:m,canvas:v,supportPointerEvent:_,supportTouchEvent:b}=l;this.supportPointerEvent=null!=_?_:!!globalThis.PointerEvent,this.supportTouchEvent=null!=b?b:"touchstart"in window;let S=g,I=m,k=f;v&&(k=f||window.devicePixelRatio||1,S=g||v.width/k,I=m||v.height/k),this.canvasConfig=Ht(qe({},l),{width:S,height:I,dpr:k}),this.canvasConfig=l,this.renderer=u,this.document=new AEe,this.document.defaultView=this,this.initRenderingContext(),this.renderingService=new kEe(this.renderingContext),this.initRenderer(u)}initRenderingContext(){this.renderingContext={root:this.document.documentElement,force:!1,dirty:!1,renderCondition:new Set},this.document.documentElement.addEventListener("child-inserted",l=>{this.mountChildren(l.detail.child)}),this.document.documentElement.addEventListener("child-removed",l=>{this.unmountChildren(l.detail.child)})}initRenderer(l){this.renderingService.init(),l.initPlugins(this),this.contextService.init(),l.getAnnotationConfig().autoRendering&&this.render(),this.document.documentElement.recursiveCall(u=>{const{renderable:f}=u;f&&(f.boundsDirty=!0,f.renderBoundsDirty=!0)}),this.mountChildren(this.document.documentElement)}render(){const l=new Wg("beforeRender",{});this.dispatchEvent(l),this.contextService.clearCanvas(),this.renderingService.render()}setDPR(l){this.canvasConfig.dpr=l,this.contextService.setDPR(l)}resize(l,u){this.canvasConfig.width=l,this.canvasConfig.height=u,this.contextService.resize(l,u)}getContextService(){return this.contextService}getEventService(){return this.eventService}appendChild(l,u){return this.document.documentElement.appendChild(l,u)}insertBefore(l,u){return this.document.documentElement.insertBefore(l,u)}removeChild(l){return this.document.documentElement.removeChild(l)}getBoundingClientRect(){return this.contextService.getBoundingClientRect()}mountChildren(l){l.recursiveCall(u=>{if(!u.isConnected){u.isConnected=!0,u.ownerDocument=this.document;const f=new Wg("DOMNodeInsertedIntoDocument",{});u.dispatchEvent(f)}})}unmountChildren(l){const u=[];l.recursiveCall(f=>{f.isConnected&&u.push(f)}),u.reverse().forEach(f=>{f.isConnected=!1;const g=new Wg("DOMNodeRemovedFromDocument",{});f.dispatchEvent(g),f!==this.document.documentElement&&(f.ownerDocument=null)})}}class Na extends class OEe{}{constructor(){super(...arguments),N(this,"close",!0),N(this,"shape",void 0),N(this,"ctx",void 0)}render(l,u){const{background:f,borderColor:g,visibility:m}=l.parsedStyle;if("hidden"===m)return;const v=!dl(f)&&!f.isNone,_=!dl(g)&&!g.isNone;this.renderPath(l,u),v&&this.renderFill(l,u),this.renderStrokePath(l,u),_&&this.renderStroke(l,u)}renderPath(l,u){l.getPath(),u.beginPath(),l.steps.forEach(f=>{I_(u,f)}),this.close&&l.steps.length>2&&u.closePath()}renderStrokePath(l,u){v_(null==l?void 0:l.getStrokePath)&&(l.getStrokePath(),0!==l.strokePath.length&&(u.beginPath(),l.strokeSteps.forEach(f=>{I_(u,f)}),this.close&&l.strokeSteps.length>2&&u.closePath()))}renderFill(l,u){const{parsedStyle:f}=l,{background:g,opacity:m,fillOpacity:v,renderBlendMode:_}=f;if(u.save(),u.globalAlpha=m*v,"normal"!==_&&(u.globalCompositeOperation=_),Array.isArray(g)){this.setShapeGradientOrigin(l,u);for(let b=0;b<g.length;b++)0===b&&this.setShadow(l,u),u.fillStyle=this.getColor(l,g[b],u),u.fill()}else this.setShadow(l,u),u.fillStyle=g.formatted,u.fill();u.restore()}renderStroke(l,u){const{parsedStyle:f}=l,{borderWidth:g,borderColor:m,opacity:v,lineCap:_,lineJoin:b,miterLimit:S,lineDash:I,lineDashOffset:k,borderOpacity:O,renderBlendMode:j}=f;g&&g.value>0&&(u.save(),dl(g)||(u.lineWidth=g.value),"normal"!==j&&(u.globalCompositeOperation=j),u.miterLimit=S,u.globalAlpha=v*O,u.lineCap=_,u.lineJoin=b,u.setLineDash(I),u.lineDashOffset=k.value,Array.isArray(m)?(this.setShapeGradientOrigin(l,u),m.forEach(W=>{u.strokeStyle=this.getColor(l,W,u),u.stroke()})):(u.strokeStyle=m.formatted,u.stroke()),u.restore())}setShadow(l,u){const{shadow:f,shadowOffsetX:g,shadowOffsetY:m,shadowBlur:v,shadowColor:_}=l.parsedStyle;(f||_)&&(u.shadowOffsetX=(null==g?void 0:g.value)||f[0],u.shadowOffsetY=(null==m?void 0:m.value)||f[1],u.shadowBlur=(null==v?void 0:v.value)||f[2],u.shadowColor=(null==_?void 0:_.formatted)||f[3])}getColor(l,u,f){let g;if(1===u.type||2===u.type){const m=l.getBoundingRect(),{width:v,height:_}=m,b=v,S=_;g=function(I,k){const{type:O,steps:j,width:W,height:J,angle:K,cx:Q,cy:ie,size:oe}=I;let le=null;if(1===O){const{x1:he,y1:_e,x2:Ve,y2:ee}=function(ke,xe,Le){const V=Le*Math.PI/180,F=0+ke/2,z=0+xe/2,$=Math.abs(ke*Math.cos(V))+Math.abs(xe*Math.sin(V));return{x1:F-Math.cos(V)*$/2,y1:z-Math.sin(V)*$/2,x2:F+Math.cos(V)*$/2,y2:z+Math.sin(V)*$/2}}(W,J,K.value);le=k.createLinearGradient(he,_e,Ve,ee)}else if(2===O){const{x:he,y:_e,r:Ve}=function(ee,ke,xe,Le,V){let F=xe.value,z=Le.value;"%"===xe.unit&&(F=xe.value/100*ee),"%"===Le.unit&&(z=Le.value/100*ke);let $=Math.max(Lg({x:0,y:0},{x:F,y:z}),Lg({x:0,y:ke},{x:F,y:z}),Lg({x:ee,y:ke},{x:F,y:z}),Lg({x:ee,y:0},{x:F,y:z}));return V&&(Un(V)?$=V.value:xn(V)&&("closest-side"===V?$=Math.min(F,ee-F,z,ke-z):"farthest-side"===V?$=Math.max(F,ee-F,z,ke-z):"closest-corner"===V&&($=Math.min(Lg({x:0,y:0},{x:F,y:z}),Lg({x:0,y:ke},{x:F,y:z}),Lg({x:ee,y:ke},{x:F,y:z}),Lg({x:ee,y:0},{x:F,y:z}))))),{x:F,y:z,r:$}}(W,J,Q,ie,oe);le=k.createRadialGradient(he,_e,0,he,_e,Ve)}return le&&j.forEach(he=>{let{offset:_e,color:Ve}=he;var ee;"%"===_e.unit&&(null===(ee=le)||void 0===ee||ee.addColorStop(_e.value/100,Ve.toString()))}),le}(Ht(qe({type:u.type},u.value),{width:b,height:S}),f)}return g}setShapeGradientOrigin(l,u){const{type:f}=l.config;switch(f){case"circle":case"arc":{const{r:g}=l.parsedStyle;u.translate(0-g.value,0-g.value);break}case"ellipse":{const{rx:g,ry:m}=l.parsedStyle;u.translate(0-g.value,0-m.value);break}default:u.translate(0,0)}}}class FEe extends Na{constructor(){super(),this.close=!1}}class LEe extends Na{}class NEe extends Na{}class UQ extends Na{render(l,u){const{width:f,height:g,img:m,opacity:v,visibility:_}=l.parsedStyle;"hidden"!==_&&(xn(m)||m&&(u.save(),u.globalAlpha=v,m instanceof ImageData?u.putImageData(m,0,0):(u.imageSmoothingEnabled=!0,u.imageSmoothingQuality&&(u.imageSmoothingQuality="high"),u.drawImage(m,0,0,f.value,g.value)),u.restore()))}}class VQ extends Na{constructor(){super(...arguments),N(this,"close",!1)}render(l,u){const{visibility:f}=l.parsedStyle;"hidden"!==f&&(this.renderPath(l,u),this.renderStroke(l,u))}renderPath(l,u){l.getPath(),u.beginPath(),l.inkRenderSteps.forEach(f=>{f.forEach(g=>{I_(u,g)})})}}class BEe extends Na{}class jQ extends Na{render(l,u){const{background:f,borderColor:g,visibility:m}=l.parsedStyle;if("hidden"===m)return;const v=!dl(f)&&!f.isNone,_=!dl(g)&&!g.isNone;l.getPath();const b=l.steps.length;for(let S=0;S<b;S++){const I=l.steps[S];u.beginPath(),I.step.forEach(k=>{I_(u,k)}),I.close&&(u.closePath(),v&&this.renderFill(l,u)),_&&this.renderStroke(l,u)}}}class WEe extends Na{}class HQ extends Na{render(l,u){l&&this.renderText(l,u)}renderText(l,u){var f;const{parsedStyle:g,lines:m}=l,{color:v,borderWidth:_,borderColor:b,textBaseLine:S,opacity:I,textAlign:k,lineDash:O,fillOpacity:j,borderOpacity:W,letterSpacing:J}=g;l.setTextFont(),u.save(),v&&Array.isArray(v)?v.forEach(Q=>{u.fillStyle=this.getColor(l,Q,u)}):u.fillStyle=v.formatted,b&&Array.isArray(b)?b.forEach(Q=>{u.strokeStyle=this.getColor(l,Q,u)}):u.strokeStyle=b.formatted,this.setShadow(l,u),u.font=l.font,u.globalAlpha=I,u.lineWidth=null==_?void 0:_.value,u.textAlign=k,u.textBaseline=S,u.letterSpacing=`${J.value}px`,u.setLineDash(O),u.beginPath();const K=(null===(f=m[0])||void 0===f?void 0:f.y)||0;m.forEach(Q=>{let{text:ie}=Q;const oe=Q.y-K;ie=l.transformText(ie),v&&this.fillText(u,ie,0,oe,j),_&&_.value&&_.value>0&&this.strokeText(u,ie,0,oe,W)}),u.closePath(),u.restore()}fillText(l,u,f,g,m,v){let _;const b=!dl(m)&&1!==m;b&&(_=l.globalAlpha,l.globalAlpha=m*m),l.fillText(u,f,g,v),b&&(l.globalAlpha=_)}strokeText(l,u,f,g,m,v){let _;const b=!dl(m)&&1!==m;b&&(_=l.globalAlpha,l.globalAlpha=m),l.strokeText(u,f,g,v),b&&(l.globalAlpha=_)}}class UEe extends Na{constructor(){super(...arguments),N(this,"close",!0)}}class GQ extends Na{render(l,u){const{background:f,borderColor:g,visibility:m}=l.parsedStyle;if("hidden"===m)return;const v=!dl(f)&&!f.isNone,_=!dl(g)&&!g.isNone;l.getPath();const b=l.steps.length;for(let S=0;S<b;S++){const I=l.steps[S];u.beginPath(),I.step.forEach(k=>{I_(u,k)}),I.close&&(u.closePath(),v&&this.renderFill(l,u)),_&&this.renderStroke(l,u)}}}class VEe extends Na{render(l,u){const{width:f,height:g,roundedRadius:m,background:v,borderWidth:_,visibility:b}=l.parsedStyle;if("hidden"!==b){for(let S=0;S<4;S++){u.beginPath();const I=m.value;if(0===I)u.rect(0,0,f.value,g.value);else{const{PI:k}=Math;u.arc(I,I,I,k,3*k/2),u.arc(f.value-I,I,I,3*k/2,2*k),u.arc(f.value-I,g.value-I,I,0,k/2),u.arc(I,g.value-I,I,k/2,k)}}u.closePath(),v&&this.renderFill(l,u),_.value>0&&this.renderStroke(l,u)}}}class zQ extends Na{render(l,u){l&&"hidden"!==l.parsedStyle.visibility&&(this.renderBox(l,u),u.save(),l.renderClipStep&&(u.beginPath(),l.renderClipStep.forEach(f=>{I_(u,f)}),u.closePath(),u.clip()),this.renderText(l,u),u.restore())}renderBox(l,u){const{background:f,borderColor:g}=l.parsedStyle,m="textBox"===l.textType&&!dl(f)&&!f.isNone,v="textBox"===l.textType&&!dl(g)&&!g.isNone;this.renderPath(l,u),m&&this.renderFill(l,u),v&&this.renderStroke(l,u)}renderText(l,u){const{parsedStyle:f,lines:g}=l,{opacity:m,y:v,x:_}=f;u.globalAlpha=m,g.forEach(b=>{const S=b.height/30,I=l.getTextAlignOffset(b);b.words.forEach(k=>{const{color:O,fontFamily:j,fontSize:W,fontStyle:J,fontWeight:K,lineThrough:Q,underline:ie}=k.style;u.fillStyle=O;const oe=""===j.trim()?"sans-serif":j;u.font=j.includes(" ")?`${J} ${K} ${W.value}${W.unit} '${oe}'`:`${J} ${K} ${W.value}${W.unit} ${oe}`;let le=k.x-_+I;for(let he=0;he<k.text.length;he++){const _e=k.text.charAt(he);u.fillText(_e,le,b.y-v),le+=u.measureText(_e).width}ie&&u.fillRect(k.x-_+I,b.y-v+S,k.widthWithoutLf,S),Q&&u.fillRect(k.x-_+I,b.y-k.wordHeight/3-v,k.widthWithoutLf,W.value/30)})})}}class jEe{constructor(l){N(this,"canvasConfig",void 0),N(this,"container",void 0),N(this,"canvas",void 0),N(this,"dpr",void 0),N(this,"context",void 0),N(this,"shapeRenderers",{}),this.canvasConfig=l}init(){const{container:l,canvas:u,dpr:f,willReadFrequently:g}=this.canvasConfig;if(u){this.canvas=u;const{parentElement:m}=u;l&&m!==l&&l.appendChild(u),this.container=m,this.canvasConfig.container=m}else if(l&&(this.container=l,xn(l)&&(this.container=document.getElementById(l)),this.container)){const m=document.createElement("canvas");this.container.appendChild(m),this.canvas=m}this.context=this.canvas.getContext("2d",{willReadFrequently:g}),this.dpr=f||Ox(),this.resize(this.canvasConfig.width,this.canvasConfig.height)}registerShapeRenderer(l,u){this.shapeRenderers[l]||(this.shapeRenderers[l]=u)}getShapeRenderer(l){return this.shapeRenderers[l]}destroy(){const{canvas:l,container:u}=this;u&&null!=l&&l.parentNode&&u.removeChild(l)}resize(l,u){const{canvas:f,dpr:g}=this;f&&(f.width=l*g,f.height=u*g,this.context.scale(g,g))}getDPR(){return this.dpr}setDPR(l){this.canvasConfig.dpr=l,this.dpr=l}getContext(){return this.context}getDomElement(){return this.canvas}getCanvas(){return this.canvas}setCursor(l){var u;null!=this&&null!==(u=this.container)&&void 0!==u&&u.style&&(this.container.style.cursor=l)}getBoundingClientRect(){var l;return null===(l=this.canvas)||void 0===l?void 0:l.getBoundingClientRect()}clearCanvas(){this.canvas&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.scale(this.dpr,this.dpr))}}class YQ{constructor(){N(this,"restoreStack",[])}init(l){const{hooks:u}=l.renderingService;u.endFrame.on(()=>{const{contextService:f}=l,g=f.getContext();this.restoreStack.forEach(()=>{g.restore()}),this.restoreStack=[]}),u.render.on(f=>{this.renderDisplayObject(f,l)}),u.putImageData.on(f=>{if(f.imageData){const{x:g,y:m}=f.getPosition(),v=l.contextService.getContext(),_=l.contextService.getDPR();v.putImageData(f.imageData,Math.floor(g*_+.5),Math.floor(m*_+.5))}})}renderDisplayObject(l,u){if(!l.isVisible)return;const{contextService:f}=u,g=f.getContext();let m=this.restoreStack[this.restoreStack.length-1];for(;m&&l.parentNode!==m;)g.restore(),this.restoreStack.pop(),m=this.restoreStack[this.restoreStack.length-1];g.save(),this.applyTransform(g,l);const{clipPath:v}=l.style;v&&(g.save(),this.applyTransform(g,v),g.restore(),g.clip()),this.useAnchor(g,l);const _=f.getShapeRenderer(l.shapeType);_&&(_.render(l,g),l.clippable&&g.clip()),this.restoreStack.push(l)}applyTransform(l,u){u.externalMatrices.length&&u.externalMatrices.slice().reverse().forEach(I=>{const{a:k,b:O,c:j,d:W,e:J,f:K}=I;l.transform(k,O,j,W,J,K)});const f=u.getLocalTransform(),{a:g,b:m,c:v,d:_,e:b,f:S}=f;l.transform(g,m,v,_,b,S)}applyAttributes(l,u,f){}useAnchor(l,u){const{anchor:f}=u.parsedStyle||{};if(!f||0===f[0]&&0===f[1])return;const g=u.getGeometryBounds().getRect();l.translate(-(f&&f[0]||0)*g.width,-(f&&f[1]||0)*g.height)}destroy(){}}N(YQ,"moduleName",void 0);class HEe{init(l){const u=new jEe(l.canvasConfig);l.contextService=u,[{name:"arc",renderer:new FEe},{name:"circle",renderer:new LEe},{name:"ellipse",renderer:new NEe},{name:"line",renderer:new GQ},{name:"image",renderer:new UQ},{name:"ink",renderer:new VQ},{name:"polygon",renderer:new BEe},{name:"polyline",renderer:new jQ},{name:"rect",renderer:new WEe},{name:"stampPath",renderer:new UEe},{name:"text",renderer:new HQ},{name:"roundedRect",renderer:new VEe},{name:"freeText",renderer:new zQ}].forEach(f=>{let{name:g,renderer:m}=f;u.registerShapeRenderer(g,m)})}destroy(){}}class XQ extends class REe{constructor(l){N(this,"contextService",void 0),N(this,"renderingPlugins",[]),N(this,"config",{autoRendering:!0}),Object.assign(this.config,l)}use(l){this.renderingPlugins.includes(l)||this.renderingPlugins.push(l)}initPlugins(l){this.renderingPlugins.forEach(u=>{u.init(l)})}destroyPlugins(){this.renderingPlugins.forEach(l=>{l.destroy()})}getPlugins(){return this.renderingPlugins}getAnnotationConfig(){return this.config}}{constructor(l){super(l),this.use(new HEe),this.use(new YQ)}}function $Q(p,l,u){const v=(l.x-p.x)*(u.y-p.y)-(l.y-p.y)*(u.x-p.x),_=Og(p,l),b=Og(p,u);let S=(_**2+b**2-Og(l,u)**2)/(2*_*b);S<-1&&(S=-1),S>1&&(S=1);let I=180*Math.acos(S)/Math.PI;return I=Math.round(100*I)/100,v<0?-I:I}function o5(p,l,u){const f=ME(l,p);return ME(l,u).angle(f)>Math.PI/2?-1:1}function Gu(p,l){return(l=p.getWorldTransform().inverse().transformPoint(l)).x+=p.parsedStyle.x,l.y+=p.parsedStyle.y,l}function $x(p){if(!p)return!1;const{shapeType:l}=p;return"annotationRect"===l||"annotationFreeText"===l&&"textBox"===p.textType||"annotationStamp"===l&&"image"===p.renderType}function Hg(p){return!!p&&("annotationPolyline"===p.shapeType||"annotationPolygon"===p.shapeType||"annotationLine"===p.shapeType)}function qx(p){return!!p&&("annotationFreeText"===p.shapeType||"annotationTextBox"===p.shapeType)}function Hd(p,l){const u=window.TouchEvent&&l instanceof TouchEvent?l.targetTouches[0]:l,f=p.getBoundingClientRect();return{offsetX:u.pageX-window.scrollX-f.left,offsetY:u.pageY-window.scrollY-f.top}}function qQ(p){let l,u;if(p.controls){const{width:f,height:g}=p.controls.getLength();l=f,u=g}else{const{x:f,y:g}=p.getScale(),{width:m,height:v}=p.getBoundingRect();l=m*f,u=v*g}return{width:l,height:u}}function A_(p){return/^[\r\n]+$/.test(p)}function KQ(p,l,u){return p.slice(0,l)+p.slice(u+1)}function s5(p,l){const{textContents:u}=p.style,f=[];return u.forEach(g=>{f.push(qe(qe({},g),l))}),f}function a5(p,l){const{textContents:u}=p.style,{textSelection:f}=p.textEditEventHandler;if(!f.length)return u;const[g,m]=f,v=g.freeContentIndex,_=m.freeContentIndex,b=u.slice(0,v),S=u.slice(v,_+1),I=u.slice(_+1),k=[];if(g.freeContentIndex===m.freeContentIndex){const{content:O}=S[0],j=O.slice(0,g.indexInFreeContent),W=O.slice(g.indexInFreeContent,m.indexInFreeContent+1),J=O.slice(m.indexInFreeContent+1);j&&k.push(Ht(qe({},S[0]),{content:j})),W&&k.push(Ht(qe(qe({},S[0]),l),{content:W})),J&&k.push(Ht(qe({},S[0]),{content:J}))}else for(let O=0;O<S.length;O++){const j=S[O];0===O?(k.push(Ht(qe({},j),{content:j.content.slice(0,g.indexInFreeContent)})),k.push(Ht(qe(qe({},j),l),{content:j.content.slice(g.indexInFreeContent)}))):O===S.length-1?(k.push(Ht(qe(qe({},j),l),{content:j.content.slice(0,m.indexInFreeContent+1)})),k.push(Ht(qe({},j),{content:j.content.slice(m.indexInFreeContent+1)}))):k.push(qe(qe({},j),l))}return[...b,...k,...I]}function JQ(p){if(!p)return!1;let l=p,u="visible"===l.parsedStyle.visibility;for(;l;)l.parsedStyle.visibility&&"hidden"===l.parsedStyle.visibility&&(u=!1),l=l.parentNode;return u}var Pi;!function(p){p.REJECTED="SBRejected",p.ACCEPTED="SHAccepted",p.INITIAL_HERE="SHInitialHere",p.SIGN_HERE="SHSignHere",p.WITNESS="SHWitness",p.APPROVED="SBApproved",p.NOT_APPROVED="SBNotApproved",p.DRAFT="SBDraft",p.FINAL="SBFinal",p.COMPLETED="SBCompleted",p.CONFIDENTIAL="SBConfidential",p.VOID="SBVoid"}(Pi||(Pi={}));const Av={border:"1px solid #59626A",background:"transparent",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},QQ={content:"Insert text here...",fontSize:32,color:"red",lineThrough:!1,underline:!1,fontFamily:"Times New Roman",fontStyle:"normal",fontWeight:"normal"},qi={opacity:1,background:"",borderColor:"red",borderWidth:4,lineDash:[0,0],lineEnding:["None","None"],stampIcon:Pi.DRAFT,imageData:null,textAlign:"left",textContent:qe({},QQ)},GEe={enableControl:!0,useDefaultControls:!0,enableEdit:!0,enableMove:!0,enableRotate:!0},zEe={showOnTopWhenSelected:!1,enableContinuousDrawing:!1,inkCreateDelay:3e3,controlsStyle:Av,defaultStyleConfig:{},eraserStyle:{background:"rgba(0,0,0)",borderColor:"rgba(0,0,0)",opacity:.3,borderWidth:8},selectionStyle:{background:"transparent",borderWidth:2,borderColor:"#59626A",lineDash:[5,5]}};class $c{constructor(l){N(this,"shape",void 0),N(this,"startTime",void 0),N(this,"startPoint",void 0),N(this,"lastPoint",void 0),N(this,"limitPosition",void 0),N(this,"limitAngle",void 0),N(this,"unLimitPosition",void 0),N(this,"unLimitScale",void 0),N(this,"unLimitStyle",void 0),N(this,"limitArea",void 0),this.shape=l}setLimitArea(l){this.limitArea=l}updateShapeByLimitArea(){const{shapeType:l}=this.shape,{left:u,right:f,top:g,bottom:m}=this.isOutOfLimitArea(1,1),v=u||f||g||m,_=$x(this.shape)||"annotationEllipse"===l;v?(_?this.shape.updateStyle(this.unLimitStyle||{}):this.shape.setLocalScale(this.unLimitScale||this.shape.getLocalScale()),this.shape.setLocalPosition(this.unLimitPosition||this.shape.getLocalPosition())):(_&&(this.unLimitStyle={width:this.shape.style.width,height:this.shape.style.height,rx:this.shape.style.rx,ry:this.shape.style.ry}),this.unLimitPosition=this.shape.getLocalPosition().clone(),this.unLimitScale=this.shape.getLocalScale().clone())}getShapeOriginPosition(){const{x:l,y:u,width:f,height:g}=this.shape.getBoundingRect(),m=new Vg({style:{x:l-this.shape.style.x+f/2,y:u-this.shape.style.y+g/2}});this.shape.appendChild(m);const{x:v,y:_}=m.getPosition();return m.destroy(),{x:v,y:_}}getShapeVertexPosition(){const{x:l,y:u,width:f,height:g}=this.shape.getBoundingRect(),m=[];for(let v=0;v<4;v++){let _=l-this.shape.style.x,b=u-this.shape.style.y;switch(v){case 1:_+=f;break;case 2:_+=f,b+=g;break;case 3:b+=g}const S=new Vg({style:{x:_,y:b}});this.shape.appendChild(S);const{x:I,y:k}=S.getPosition();m.push({x:I,y:k}),S.destroy()}return m}isOutOfLimitArea(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.limitArea)return{left:!1,right:!1,top:!1,bottom:!1};const{x:f,y:g,width:m,height:v}=this.limitArea;let _=!1,b=!1,S=!1,I=!1;const k=this.getShapeVertexPosition();for(let O=0;O<4;O++){const{x:j,y:W}=k[O];_=j<f-l||_,b=j>f+m+l||b,S=W<g-u||S,I=W>g+v+u||I}return{left:_,right:b,top:S,bottom:I}}getLimitPosition(){if(!this.limitArea)return null;const l=this.getShapeVertexPosition(),{x:u,y:f}=l[0],{x:g,y:m,width:v,height:_}=this.limitArea,b=l[1].x-u,S=l[2].x-u,I=l[3].x-u,k=l[1].y-f,O=l[2].y-f,j=l[3].y-f;let W=g-Math.min(b,S,I),J=g+v-Math.max(b,S,I),K=m-Math.min(k,O,j),Q=m+_-Math.max(k,O,j);if(b>=0&&S>=0&&I>=0?W=g:b<=0&&S<=0&&I<=0&&(J=g+v),k>=0&&O>=0&&j>=0?K=m:k<=0&&O<=0&&j<=0&&(Q=m+_),(ie=this.shape)&&("annotationEllipse"===ie.shapeType||"annotationCircle"===ie.shapeType)){const{x:oe,y:le}=this.getShapeOriginPosition(),he=oe-u,_e=le-f;W+=he,J+=he,K+=_e,Q+=_e}var ie;return{minPosX:W,maxPosX:J,minPosY:K,maxPosY:Q}}getLimitRotateAngle(){if(!this.limitArea)return[];const l=function(m,v){const _=m,[b,S,I,k]=_,{x:O,y:j,width:W,height:J}=v,K=O+W,Q=j+J,ie=(b.x+S.x+I.x+k.x)/4,oe=(b.y+S.y+I.y+k.y)/4,le=Math.sqrt((ie-b.x)**2+(oe-b.y)**2),he=ie-le,_e=ie+le,Ve=oe-le,ee=oe+le;if(he>O&&Ve>j&&_e<K&&ee<Q)return[];const ke=F=>{const z=le*le-(F-ie)**2;return[{x:F,y:oe-Math.sqrt(z)},{x:F,y:oe+Math.sqrt(z)}]},xe=F=>{const z=le*le-(F-oe)**2;return[{x:ie-Math.sqrt(z),y:F},{x:ie+Math.sqrt(z),y:F}]},Le=(F,z)=>{const $=[];return F.forEach(P=>{m.forEach(L=>{let X=$Q({x:ie,y:oe},L,P);0===X&&(X=ie>L.x?oe>L.y?-0:0:oe>L.y?0:-0,"top"!==z&&"bottom"!==z||(X=-X)),$.push(X)})}),$},V=[];if(he<O){const F=ke(O);V.push(...Le(F,"left"))}if(Ve<j){const F=xe(j);V.push(...Le(F,"top"))}if(_e>K){const F=ke(K);V.push(...Le(F,"right"))}if(ee>Q){const F=xe(Q);V.push(...Le(F,"bottom"))}return V}(this.getShapeVertexPosition(),this.limitArea);if(0===l.length)return[];let u=0;if(l.forEach(m=>{0===m&&u++}),u>=2)return[0,0];const{maxNegative:f,minPositive:g}=function(m){let v=-1/0,_=1/0;for(let b=0;b<m.length;b++)m[b]<0&&m[b]>v||Object.is(m[b],-0)?v=m[b]:(m[b]>0&&m[b]<_||Object.is(m[b],0))&&(_=m[b]);return v===-1/0&&(v=0),_===1/0&&(_=0),{maxNegative:v,minPositive:_}}(l);return[f,g]}moveShape(l){const{shape:u,startPoint:f}=this,{lastWorldPosition:g,controlsFlags:m}=u.context;if(!m.enableMove||new Ar(l.x,l.y).distanceTo(f)<0)return;let b=g.x+(l.x-f.x),S=g.y+(l.y-f.y);const{left:I,right:k,top:O,bottom:j}=this.isOutOfLimitArea(1,1);if(this.limitPosition&&!(I||k||O||j)){const{minPosX:J,maxPosX:K,minPosY:Q,maxPosY:ie}=this.limitPosition;b<J&&(b=J),b>K&&(b=K),S<Q&&(S=Q),S>ie&&(S=ie)}this.shape.setPosition({x:b,y:S})}moveVertex(l){const{shape:u}=this,{context:f,shapeType:g}=u,{hitControlPoint:m,lastLocalScale:v,lastControlsWidth:_,lastControlsHeight:b,keepAspectRatio:S,lastHitControlPoint:I,lastShareAxisYPoint:k,lastShareAxisXPoint:O,lastLocalTransform:j}=f,W=XE(I,O,l).distanceTo(O)||1;if(o5(I,O,l)<0)return;let J=W-_,K=W/_;const Q=XE(I,k,l).distanceTo(k)||1;if(o5(I,k,l)<0)return;let ie=Q-b,oe=Q/b;S&&(K>=oe?(oe=K,ie=oe*b-b):(K=oe,J=K*_-_));const{left:le,right:he,top:_e,bottom:Ve}=this.isOutOfLimitArea(1,1),ee=le||he||_e||Ve,ke="annotationEllipse"===g;$x(u)?this.moveRectVertex(m,J,ie):ke?this.moveEllipseVertex(m,J,ie):(m<2&&(ie=-ie),0!==m&&3!==m||(J=-J),u.setLocalTransform(j),u.translate(J/2,ie/2),u.setLocalScale(K*v.x,oe*v.y,1)),ee||0===u.getAngle()||this.updateShapeByLimitArea(),u.context.updateControls()}moveEllipseVertex(l,u,f){const{shape:g}=this,{x:m,y:v}=g.getScale(),{lastShapeWidth:_,lastShapeHeight:b,lastLocalTransform:S}=this.shape.context,I=(_+u/Math.abs(m))/2,k=(b+f/Math.abs(v))/2;g.style.rx=I<1?1:I,g.style.ry=k<1?1:k,l<2&&(f=-f),0!==l&&3!==l||(u=-u),this.shape.setLocalTransform(S),this.shape.translate(u/2,f/2)}moveRectVertex(l,u,f){const{shape:g}=this,{x:m,y:v}=g.getScale(),{lastShapeWidth:_,lastShapeHeight:b,lastLocalTransform:S,lastWorldPosition:I}=this.shape.context,k=l,O=_+u/Math.abs(m),j=b+f/Math.abs(v);if(g.style.width=O<1?1:O,g.style.height=j<1?1:j,2===k)g.setPosition({x:I.x,y:I.y});else switch(g.setLocalTransform(S),k){case 1:g.translate(0,-f);break;case 3:g.translate(-u,0);break;default:g.translate(-u,-f)}}moveMidpoints(l){const{shape:u}=this,{context:f,shapeType:g}=u,{lastLocalScale:m,lastControlsWidth:v,lastControlsHeight:_,lastLocalTransform:b,lastHitControlPoint:S,lastShareAxisPoint:I,hitControlPoint:k}=f,O=k-4,j=XE(S,I,l).distanceTo(I);if(o5(S,I,l)<0)return;const W="annotationEllipse"===g,J=j/v*m.x,K=j/_*m.y,Q=(1===O?1:-1)*(j-v),ie=(2===O?1:-1)*(j-_),{left:oe,right:le,top:he,bottom:_e}=this.isOutOfLimitArea(1,1),Ve=oe||le||he||_e;$x(u)?this.moveRectMidPoint(O,Q,ie):W?this.moveEllipseMidPoint(O,Q,ie):O%2?(this.shape.setLocalTransform(b),this.shape.translate(Q/2,0),this.shape.setLocalScale(J,m.y,1)):(this.shape.setLocalTransform(b),this.shape.translate(0,ie/2),this.shape.setLocalScale(m.x,K,1)),Ve||0===u.getAngle()||this.updateShapeByLimitArea(),this.shape.context.updateControls()}moveRectMidPoint(l,u,f){const{shape:g}=this,{x:m,y:v}=g.getScale(),{lastShapeHeight:_,lastWorldPosition:b,lastLocalTransform:S,lastShapeWidth:I}=g.context;if(l%2){const k=(1===l?u:-u)/Math.abs(m)+I;g.style.width=k<1?1:k,1===l?this.shape.setPosition({x:b.x,y:b.y}):(this.shape.setLocalTransform(S),this.shape.translate(u,0))}else{const k=(2===l?f:-f)/Math.abs(v)+_;g.style.height=k<1?1:k,2===l?this.shape.setPosition({x:b.x,y:b.y}):(this.shape.setLocalTransform(S),this.shape.translate(0,f))}}moveEllipseMidPoint(l,u,f){const{shape:g}=this,{x:m,y:v}=g.getScale(),{lastShapeHeight:_,lastLocalTransform:b,lastShapeWidth:S}=g.context;if(l%2){const I=(1===l?u:-u)/Math.abs(m)+S;g.style.rx=I<2?1:I/2,this.shape.setLocalTransform(b),this.shape.translate(u/2,0)}else{const I=(2===l?f:-f)/Math.abs(v)+_;g.style.ry=I<2?1:I/2,this.shape.setLocalTransform(b),this.shape.translate(0,f/2)}}moveRotationPoint(l){const{startPoint:u,shape:f}=this,{lastOriginWorldPosition:g,lastLocalTransform:m}=f.context,v=$Q(g,u,l);this.shape.setLocalTransform(m),this.shape.rotateLocal(v)}isHit(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{shape:f}=this,{context:g,parsedStyle:m}=f;if("hidden"===m.visibility||!g.controlsFlags.enableControl)return-1;if(g.isGrouped)return g.unHitShape(),-1;let{controls:v}=f,_=!0;v||(_=!1,g.initControls(),g.renderControls(),v=f.controls);let b=v.checkHitArea(l.x,l.y);return Hg(f)&&!f.context.controlsFlags.useDefaultControls&&(8===b?b=-1:b>0&&(b=9),-1!==f.pointEventsHandler.isHitPoint(l)&&(b=0)),b<0?(u&&(g.unHitShape(),_||f.context.destroyControls()),-1):b}startHandler(l){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=this.isHit(l);if(-1===f&&!u)return;-1===f&&u&&(f=9);const{shape:g}=this,{context:m,controls:v}=g;if(m.isStart=!0,this.lastPoint=qe({},l),this.startPoint=qe({},l),this.startTime=(new Date).getTime(),Hg(g)&&(g.pointEventsHandler.enableEditMode(),g.pointEventsHandler.editStartHandler(l)),qx(g)&&g.textEditEventHandler.editStartHandler(l),this.limitPosition=this.getLimitPosition(),m.controlsFlags.useDefaultControls){m.hitShape(),m.hitControlPoint=f;const{ctrlWidth:_,ctrlHeight:b}=m.parsedControlsStyle,S=_/2,I=b/2;if(f<4){const k=v.controlPoints.slice(0,4),O=k[f].getPosition().x+S,j=k[f].getPosition().y+I;m.lastHitControlPoint=qe({},l),m.lastHitControlPointCenter={x:O,y:j},m.lastShareAxisYPoint={x:k[3-f].getPosition().x+S+l.x-O,y:k[3-f].getPosition().y+I+l.y-j},m.lastShareAxisXPoint={x:k[f%2?f-1:f+1].getPosition().x+S+l.x-O,y:k[f%2?f-1:f+1].getPosition().y+I+l.y-j}}else if(f<8){const k=v.controlPoints.slice(4,8),O=k[f-4].getPosition().x+S,j=k[f-4].getPosition().y+I;m.lastHitControlPoint=qe({},l),m.lastHitControlPointCenter={x:O,y:j},m.lastShareAxisPoint={x:k[(f-2)%4].getPosition().x+S+l.x-O,y:k[(f-2)%4].getPosition().y+I+l.y-j}}}else m.isHit=!0,m.hitControlPoint=9,m.lastWorldPosition=g.getPosition(),m.lastControlsWorldPosition=g.controls.getPosition()}moveHandler(l,u){const{shape:f,lastPoint:g}=this,{context:m,controls:v}=f,{isHit:_,isStart:b,hitControlPoint:S}=m,I=Hg(f),k=qx(f);_&&b&&v&&(g.x=l.x,g.y=l.y,I&&-1!==f.pointEventsHandler.hitIndex?f.pointEventsHandler.editMoveHandler(l):k&&f.textEditEventHandler.editMode?f.textEditEventHandler.editMoveHandler(l):S<4?(m.keepAspectRatio=u,this.moveVertex(l)):S<8?this.moveMidpoints(l):S<9?this.moveRotationPoint(l):(this.moveShape(l),I&&f.pointEventsHandler.updateLineControls()))}endHandler(l){const{shape:u,startPoint:f,lastPoint:g}=this,{context:m}=u,{isStart:v,isHit:_}=u.context;if(!v||!_)return;const k=(new Date).getTime()-this.startTime<=200&&((g.x-f.x)**2+(g.y-f.y)**2)**.5<2,O=Hg(u),j=qx(u);if(O&&u.pointEventsHandler.editEndHandler(),j&&u.textEditEventHandler.editEndHandler(),!m.isActive&&k&&(m.isActive=!0),l){if(j&&u.textEditEventHandler.editMode)return void(m.hitControlPoint=-1);const W=[];if(8===m.hitControlPoint)W.push("rotated");else{const{lastControlsWorldPosition:K,lastControlsWidth:Q,lastControlsHeight:ie,lastWorldPosition:oe}=m,{width:le,height:he}=u.controls.getLength(),_e=u.controls.getPosition(),Ve=u.getPosition(),ee=u instanceof Pv?K:oe,ke=u instanceof Pv?_e:Ve;ke.x.toFixed(1)===ee.x.toFixed(1)&&ke.y.toFixed(1)===ee.y.toFixed(1)||W.push("moved");const xe=O&&-1!==u.pointEventsHandler.hitIndex,Le=!(!Q||!ie||le.toFixed(3)===Q.toFixed(3)&&he.toFixed(3)===ie.toFixed(3));u instanceof pp||!xe&&!Le||W.push("resized")}const J=[...new Set(W)];J.length&&l.emitModifyAnnotation(J,[u])}m.isHit=!1,m.keepAspectRatio=!1}}class YEe extends fs{constructor(l,u){super({type:"annotationGroup",style:{visibility:"visible"}}),N(this,"shapeType","annotationControls"),N(this,"container",void 0),N(this,"borders",void 0),N(this,"rotationPoint",void 0),N(this,"controlPoints",void 0),N(this,"rotationBorder",void 0),N(this,"rotationPointOffset",30),N(this,"vertexes",[]),N(this,"midpoints",[]),this.container=l;for(const f in u)NE(f,u)&&(this[f]=u[f]);this.updateControlPoints(this.vertexes),this.initBorders(),this.initControls()}get isVisible(){return"hidden"!==this.parsedStyle.visibility&&JQ(null==this?void 0:this.container)}initBorders(){const{borderColor:l,borderWidth:u,lineDash:f,background:g}=this.container.context.parsedControlsStyle,{width:m}=this.container.getBoundingRect(),v=u/2;this.borders=new t2({style:{points:this.vertexes,borderWidth:u,background:g,borderColor:l,lineDash:f}}),this.borders.setLocalPosition(-v,-v),this.rotationBorder=new t2({style:{points:[this.midpoints[0],this.rotationPoint],borderWidth:u,borderColor:l,lineDash:f}});const _=Math.abs(this.midpoints[0].y-this.rotationPoint.y);this.rotationBorder.setLocalPosition(m/2-v,-_),this.appendChild(this.borders),this.appendChild(this.rotationBorder)}initControls(){const{vertexes:l,midpoints:u,rotationPoint:f}=this,{ctrlBorderColor:g,ctrlBorderWidth:m,ctrlLineDash:v,ctrlBackground:_,ctrlWidth:b,ctrlHeight:S,ctrlBorderRadius:I}=this.container.context.parsedControlsStyle,{x:k,y:O}=this.container.getBoundingRect(),j=[...l,...u,f],W={background:_,borderColor:g,borderWidth:m,lineDash:v,width:b,height:S,roundedRadius:I};j.forEach(J=>{const K=new ZO({style:qe({x:J.x,y:J.y},W)});K.setLocalPosition(J.x-ni(b).value/2-k,J.y-ni(S).value/2-O),this.controlPoints||(this.controlPoints=[]),this.controlPoints.push(K),this.appendChild(K)})}calculateMidpoints(l){const u=[];for(let f=0,g=l.length;f<g;f++){const m=new Ar((l[f].x+l[(f+1)%g].x)/2,(l[f].y+l[(f+1)%g].y)/2);u.push(m)}return u}calculateRotationPoint(l){const u=l[0].distanceTo(l[2]);return l[2].lerpTo(l[0],this.rotationPointOffset/u+1)}update(l){const{midpoints:u,rotationPoint:f,container:g}=this,{ctrlWidth:m,ctrlHeight:v,borderWidth:_}=this.container.context.parsedControlsStyle,b=[...l,...u,f],{x:S,y:I,width:k,height:O}=g.getBoundingRect(),j=_/2;this.controlPoints.forEach((K,Q)=>{const{x:ie,y:oe}=b[Q];K.updateStyle({x:ie,y:oe}),K.setLocalPosition(ie-m/2-S,oe-v/2-I)}),this.borders.updateStyle({points:l}),this.borders.setLocalPosition(k<0?k:-j,O<0?O:-j);const W=Math.min(u[0].x,f.x),J=Math.min(u[0].y,f.y);this.rotationBorder.updateStyle({points:[u[0],f]}),this.rotationBorder.setLocalPosition(W-S-j,J-I)}updateOrigin(){this.setOrigin(this.controlPoints[4].parsedStyle.x-this.controlPoints[0].parsedStyle.x,this.controlPoints[7].parsedStyle.y-this.controlPoints[0].parsedStyle.y)}updateControlPoints(l){this.vertexes=l,this.midpoints=this.calculateMidpoints(this.vertexes),this.rotationPoint=this.calculateRotationPoint(this.midpoints)}getLength(){return{width:this.midpoints[1].x-this.midpoints[3].x,height:this.midpoints[2].y-this.midpoints[0].y}}setVisible(l){this.style.visibility=l}setBoxVisible(l){this.borders.style.visibility=l}setRotationPointVisible(l){this.rotationBorder.style.visibility=l,this.controlPoints[8].style.visibility=l}setControlPointVisible(l){this.controlPoints.forEach((u,f)=>{f<8&&(u.style.visibility=l)})}checkHitArea(l,u){const f=this.getWorldTransform().inverse().transformPoint({x:l,y:u}),{x:g,y:m}=this.controlPoints[0].parsedStyle,v={x:f.x+g,y:f.y+m},{ctrlWidth:_,ctrlHeight:b}=this.container.context.parsedControlsStyle;f.x+=g+_/2,f.y+=m+b/2;const S=ir()?10:0;let I=-1;for(let k=0;k<this.controlPoints.length;k++){const O=this.controlPoints[k];if("visible"===O.style.visibility&&O.isPointInPath({x:f.x,y:f.y},S)){I=k;break}}return I>-1?I:this.borders.isPointInPath(v)?9:-1}destroy(){this.parentNode&&(this.parentNode.removeChild(this),this.container.controls=null)}}class qc{constructor(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};N(this,"shape",void 0),N(this,"referencePoint",void 0),N(this,"controlsStyle",void 0),N(this,"controlsFlags",void 0),N(this,"parsedControlsStyle",void 0),N(this,"keepAspectRatio",!1),N(this,"isInGroup",!1),N(this,"isGrouped",!1),N(this,"isActive",!1),N(this,"isStart",!1),N(this,"isHit",!1),N(this,"hitControlPoint",-1),N(this,"lastHitControlPoint",void 0),N(this,"lastHitControlPointCenter",void 0),N(this,"lastLocalTransform",void 0),N(this,"lastWorldPosition",void 0),N(this,"lastLocalScale",void 0),N(this,"lastOriginWorldPosition",void 0),N(this,"lastControlsWorldPosition",void 0),N(this,"lastControlsWidth",void 0),N(this,"lastControlsHeight",void 0),N(this,"lastShareAxisPoint",void 0),N(this,"lastShareAxisXPoint",void 0),N(this,"lastShareAxisYPoint",void 0),N(this,"lastShapeWidth",void 0),N(this,"lastShapeHeight",void 0),this.shape=l,this.controlsStyle=qe(qe({},Av),u),this.controlsFlags=qe({},GEe),this.parseControlsStyle()}initReferenceBox(){if(this.referencePoint)return void this.updateReferenceBox();const{x:l,y:u}=this.shape.getBoundingRect(),m=new Vg({style:{x:l-this.shape.style.x,y:u-this.shape.style.y,r:0}});this.shape.appendChild(m),this.referencePoint=m}updateReferenceBox(){if(!this.referencePoint)return;const{x:l,y:u}=this.shape.getBoundingRect();this.referencePoint.updateStyle({x:l-this.shape.style.x,y:u-this.shape.style.y})}getControlVertexes(){const{shape:l}=this,{x:u,y:f,width:g,height:m}=l.getBoundingRect();return[new Ar(u,f),new Ar(u+g,f),new Ar(u+g,f+m),new Ar(u,f+m)]}getScaledControlVertexes(){const{shape:l}=this,{x:u,y:f}=l.getScale(),{x:g,y:m,width:v,height:_}=l.getBoundingRect(),b=v*Math.abs(u)||1,S=_*Math.abs(f)||1;return[new Ar(g,m),new Ar(g+b,m),new Ar(g+b,m+S),new Ar(g,m+S)]}showControls(){this.initReferenceBox();const{shape:l,referencePoint:u}=this,{x:f,y:g}=u.getPosition(),m=l.getAngle(),v=f,_=g;l.controls.setAngle(m),l.controls.setPosition({x:v,y:_})}parseControlsStyle(){if(!this.controlsStyle)return;this.parsedControlsStyle={};const{background:l,border:u,ctrlWidth:f,ctrlHeight:g,ctrlBackground:m,ctrlBorderRadius:v,ctrlBorder:_}=this.controlsStyle,b=u||Av.border,{borderColor:S,borderStyle:I,borderWidth:k}=Fx(b),O=ni(k).value,j=_||Av.ctrlBorder,{borderColor:W,borderStyle:J,borderWidth:K}=Fx(j),Q=ni(K).value,ie=ni(f).value,oe=Tv(v);this.parsedControlsStyle={background:l||Av.background,ctrlBackground:m||Av.ctrlBackground,ctrlBorderRadius:"%"===oe.unit?oe.value/100*ie:v||Av.ctrlBorderRadius,borderColor:S,borderWidth:O,lineDash:"solid"===I?[0,0]:[2*O,O],ctrlWidth:ie,ctrlHeight:ni(g).value,ctrlBorderColor:W,ctrlBorderWidth:Q,ctrlLineDash:"solid"===J?[0,0]:[2*Q,Q]}}updateControlsFlags(l){const{enableEdit:u,enableRotate:f,enableControl:g,isVisible:m}=l;this.shape.controls&&(Ds(u)&&this.shape.controls.setControlPointVisible(u?"visible":"hidden"),Ds(f)&&this.shape.controls.setRotationPointVisible(f?"visible":"hidden"),Ds(g)&&!g&&this.destroyControls()),Ds(m)&&(this.shape.style.visibility=m?"visible":"hidden"),this.controlsFlags=qe(qe({},this.controlsFlags),l)}hitShape(){const{shape:l}=this,{shapeType:u,controls:f}=l;this.isHit=!0,this.lastWorldPosition=l.getPosition().clone(),this.lastLocalTransform=l.getLocalTransform().clone(),this.lastLocalScale=l.getLocalScale(),this.lastControlsWorldPosition=f.getPosition().clone(),this.lastControlsWidth=f.getLength().width,this.lastControlsHeight=f.getLength().height;const g=l.getBoundingRect(),m=new Vg({style:{x:g.x-l.style.x+g.width/2,y:g.y-l.style.y+g.height/2,r:0}});l.appendChild(m),this.lastOriginWorldPosition=m.getPosition(),m.destroy(),"annotationEllipse"===u&&(this.lastShapeWidth=2*l.parsedStyle.rx.value,this.lastShapeHeight=2*l.parsedStyle.ry.value),$x(this.shape)&&(this.lastShapeWidth=l.parsedStyle.width.value,this.lastShapeHeight=l.parsedStyle.height.value)}unHitShape(){const{context:l}=this.shape;l.isStart=!1,l.isHit=!1,l.isActive=!1,l.hitControlPoint=-1,qx(this.shape)&&this.shape.textEditEventHandler.disableEditMode(),Hg(this.shape)&&this.shape.pointEventsHandler.disableEditMode()}initControls(){const{shape:l}=this,u=this.getControlVertexes(),f=new YEe(l,{vertexes:u});l.controls=f,l.getRootNode().appendChild(f),this.updateControlsFlags(this.controlsFlags)}updateControls(){var l,u,f,g;const{shape:m}=this,v=this.getScaledControlVertexes();JSON.stringify(v)!==JSON.stringify(null===(l=m.controls)||void 0===l?void 0:l.vertexes)&&(null===(u=m.controls)||void 0===u||u.updateControlPoints(v),null===(f=m.controls)||void 0===f||f.update(v),null===(g=m.controls)||void 0===g||g.updateOrigin())}renderControls(){const{shape:l,isStart:u,isActive:f,controlsFlags:g,isInGroup:m}=this,{useDefaultControls:v}=g,{controls:_}=l;let b="hidden";_&&(v&&(u||f||m)&&(b="visible"),_&&_.setVisible(b),this.updateControls(),this.showControls())}destroyControls(){var l,u;null===(l=this.referencePoint)||void 0===l||l.destroy(),this.referencePoint=null,null===(u=this.shape.controls)||void 0===u||u.destroy(),this.shape.controls=null}getTransform(){const{parentNode:l}=this.shape,u=l instanceof pp&&this.shape.context.isGrouped;u&&l.delete(this.shape,!1);const f=qe({},this.shape.getLocalPosition()),g=this.shape.getLocalAngle(),m=qe({},this.shape.getLocalScale());return u&&l.add(this.shape),{angle:g,scale:m,position:f}}setTransform(l){if(l){const{scale:u,angle:f,position:g}=l;g&&this.shape.setLocalPosition(g),pt(f)||this.shape.setLocalAngle(f),pt(u)||this.shape.setLocalScale(u)}}getCommonStyleConfig(){const{lineCap:l,lineJoin:u,lineDash:f,background:g,opacity:v,miterLimit:b,borderColor:S,borderWidth:I}=this.shape.attributes;return{lineCap:l,lineJoin:u,lineDash:f,background:g,opacity:v,borderColor:S,borderWidth:I,miterLimit:b}}getRealTimeBoundingBox(){this.shape.boundsDirty=!0;const{x:l,y:u,width:f,height:g}=this.shape.getBoundingRect(),m=[],{useDefaultControls:v,enableRotate:_}=this.shape.context.controlsFlags,b=v&&_?5:4;for(let S=0;S<b;S++){let I=l-this.shape.style.x,k=u-this.shape.style.y;1!==S&&2!==S||(I+=f),2!==S&&3!==S||(k+=g),4===S&&(I+=f/2,k-=30/this.shape.getScale().y);const O=new Vg({style:{x:I,y:k,r:0}});this.shape.appendChild(O);const{x:j,y:W}=O.getPosition();m.push({x:j,y:W}),O.destroy()}return fp(m)}}class ZQ extends EQ{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(qe({type:"annotationArc"},l)),N(this,"shapeType","annotationArc"),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new qc(this,u),this.eventHandler=new $c(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}getAnnotationConfig(){const l=this.context.getTransform(),{position:u}=l,{r:f,startAngle:g,endAngle:m}=this.attributes;return{type:"annotationArc",style:qe({x:u.x,y:u.y,r:f,startAngle:g,endAngle:m},this.context.getCommonStyleConfig()),transform:l}}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}}class eZ extends Vg{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(qe({type:"annotationCircle"},l)),N(this,"shapeType","annotationCircle"),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new qc(this,u),this.eventHandler=new $c(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const l=this.context.getTransform(),{position:u}=l,{r:f}=this.attributes;return{type:"annotationCircle",style:qe({x:u.x,y:u.y,r:f},this.context.getCommonStyleConfig()),transform:l}}}class Pv extends DQ{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(qe({type:"annotationEllipse"},l)),N(this,"shapeType","annotationEllipse"),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new qc(this,u),this.eventHandler=new $c(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const l=this.context.getTransform(),{rx:u,ry:f}=this.parsedStyle,{position:g}=l;return{type:"annotationEllipse",style:qe({x:g.x-u.value,y:g.y-f.value,width:2*u.value,height:2*f.value},this.context.getCommonStyleConfig()),transform:l}}}class XEe extends Ev{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(qe({type:"annotationImage"},l)),N(this,"shapeType","annotationImage"),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new qc(this,u),this.eventHandler=new $c(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const{x:l,y:u,img:f,opacity:g,visibility:m,width:v,height:_}=this.attributes;return{type:"annotationImage",style:{x:l,y:u,width:v,height:_,img:f,opacity:g,visibility:m},meteData:this.meteData,transform:this.context.getTransform()}}}class Gd extends AQ{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(qe({type:"annotationInk"},l)),N(this,"shapeType","annotationInk"),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new qc(this,u),this.eventHandler=new $c(this),this.context.setTransform(l),this.update()}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}setUseDouglasPeucker(l){l?(this.boundsDirty=!0,this.pathDirty=!0,this.useDouglasPeucker=!0):this.useDouglasPeucker=!1}getAnnotationConfig(){let l=this.attributes.segments;const u=this.context.getTransform(),f=this.getBoundingRect(),{position:g}=u;return(g.x!==f.x||g.y!==f.y)&&(l=[],this.attributes.segments.forEach(m=>{const v=[];m.forEach(_=>{v.push({x:_.x-f.x+g.x,y:_.y-f.y+g.y,z:0})}),l.push(v)}),this.context.isGrouped||(this.style.segments=l)),{type:"annotationInk",style:qe({segments:l},this.context.getCommonStyleConfig()),transform:u}}}class r2 extends ps{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(qe({type:"annotationRect"},l)),N(this,"shapeType","annotationRect"),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new qc(this,u),this.eventHandler=new $c(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const l=this.context.getTransform(),{width:u,height:f}=this.attributes,{position:g}=l;return{type:"annotationRect",id:this.id,style:qe({x:g.x,y:g.y,width:u,height:f},this.context.getCommonStyleConfig()),transform:l}}getPath(){if(!this.pathDirty)return this.path;const{width:l,height:u,borderWidth:f}=this.parsedStyle,g=.5*((null==f?void 0:f.value)||0),_=l.value-2*g,b=u.value-2*g;return this.path=[{x:g,y:g},{x:g+_,y:g},{x:g+_,y:g+b},{x:g,y:g+b}],this.steps=T_(this.path),this.pathDirty=!1,this.path}getStrokePath(){return this.strokePath=[],[]}}class $Ee extends Yx{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(qe({type:"annotationText"},l)),N(this,"shapeType","annotationText"),N(this,"controls",void 0),N(this,"eventHandler",void 0),N(this,"context",void 0),N(this,"editMode",!1),N(this,"textCursor",void 0),N(this,"textArea",void 0),N(this,"startSelectText",!1),N(this,"selectRectArray",[]),N(this,"inputChinese",!1),N(this,"curIndex",0),N(this,"startIndex",0),N(this,"endIndex",0),N(this,"lastEndIndex",0),N(this,"renderHooks",void 0),this.init(l.transform,l.selectableStyle),u&&(this.renderHooks=u)}init(l,u){this.context=new qc(this,u),this.eventHandler=new $c(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const{x:l,y:u,color:f,text:g,wordWarp:m,textBaseLine:v,fontStyle:_,fontVariant:b,fontWeight:S,fontFamily:I,fontSize:k,lineHeight:O,textAlign:j}=this.attributes;return{type:"annotationText",style:qe({x:l,y:u,color:f,text:g,wordWarp:m,textBaseLine:v,fontStyle:_,fontVariant:b,fontWeight:S,fontFamily:I,fontSize:k,lineHeight:O,textAlign:j},this.context.getCommonStyleConfig()),transform:this.context.getTransform()}}startEditor(l,u){const f=Gu(this,{x:l,y:u});if(l=f.x,u=f.y,this.textArea&&(document.body.removeChild(this.textArea),this.textArea=void 0),!this.getCharByPosition(l,u))return void this.closeEditor();const g=this.getCharByPosition(l,u),m=.9*g.height;let v=0,_=0;if(l<g.x+g.width/2?(this.curIndex=g.index-1,v=g.x-this.chars[0].x):(this.curIndex=g.index,v=g.x-this.chars[0].x+g.width),_=g.y-this.chars[0].y,!this.textCursor){const S=new QO({style:{startPoint:{x:0,y:0},endPoint:{x:0,y:m},borderWidth:this.parsedStyle.fontSize.value/50,borderColor:"black"}});this.appendChild(S),this.textCursor=S}this.textCursor.setLocalPosition(v,this.getRelativeYAxis(_)),this.openTextarea(l,u)}closeEditor(){this.textCursor&&this.removeChild(this.textCursor),this.textArea&&(this.textArea.removeEventListener("input",l=>this.textareaInput(l)),this.textArea.removeEventListener("compositionstart",l=>this.textareaCompositionstart(l)),this.textArea.removeEventListener("compositionend",l=>this.textareaCompositionend(l)),this.textArea.removeEventListener("keydown",l=>this.textareaKeydown(l)),document.body.removeChild(this.textArea)),this.clearTextSelection(),this.textCursor=void 0,this.textArea=void 0,this.curIndex=0,this.editMode=!1}textStartHandler(){0!==this.selectRectArray.length&&this.clearTextSelection(),this.editMode&&(this.startSelectText=!0,this.startIndex=this.curIndex,this.endIndex=this.curIndex)}textMoveHandler(l){if(!this.editMode||!this.startSelectText)return;const{x:u,y:f}=Gu(this,l),g=this.getCharByPosition(u,f);if(this.endIndex=u<g.x+g.width/2?g.index-1:g.index,!g){const{lines:m,chars:v,parsedStyle:_}=this,{textBaseLine:b}=_,{height:S}=v[0],I=S/10;let k=0,O=f;switch(b){case"alphabetic":O=f+S-1.5*I;break;case"middle":O=f+S/2+I;break;case"ideographic":O=f+S+I;break;case"bottom":O=f+S+.5*I}for(let J=m.length;J>0;J--)if(O>m[J-1].y){k=J-1;break}const j=m[k].sum-m[k].length,W=m[k].sum-1;this.endIndex=j;for(let J=W;J>=j;J--)if(u>this.chars[J].x+this.chars[J].width/2){this.endIndex=J+1;break}}this.endIndex!==this.lastEndIndex&&(this.lastEndIndex=this.endIndex,this.endIndex!==this.startIndex?(this.textCursor&&(this.removeChild(this.textCursor),this.textCursor=void 0),this.createTextSelectionArea(this.startIndex,this.endIndex)):this.clearTextSelection())}textEndHandler(){if(this.editMode){if(this.startSelectText=!1,this.startIndex!==this.endIndex&&this.textArea){var l;const{startIndex:u,endIndex:f}=this,g=Math.min(u,f),m=Math.max(u,f);null===(l=this.textArea)||void 0===l||l.setSelectionRange(g,m)}this.startIndex=0,this.endIndex=0}}openTextarea(l,u){if(!this.context.isActive)return;const f=document.createElement("input");f.type="text",f.setAttribute("style","position:fixed; opacity:0; width:1; height:1; top:80%; left:80%; z-index:-999; word-break:break-all"),f.value=this.parsedStyle.text,document.body.appendChild(f);const g=this.curIndex;this.textArea=f,f.setSelectionRange(g,g),f.addEventListener("input",m=>this.textareaInput(m),!1),f.addEventListener("compositionstart",m=>this.textareaCompositionstart(m),!1),f.addEventListener("compositionend",m=>this.textareaCompositionend(m),!1),f.addEventListener("keydown",m=>this.textareaKeydown(m),!1),f.focus()}moveTextCursor(l,u){if(!this.textCursor)return;if(0===this.chars.length)return void this.destroy();const f=l+u-1;let g,m;f<-1||f===this.chars.length||(-1===f?(g=0,m=0):(g=this.chars[f].x-this.chars[0].x+this.chars[f].width,m=this.chars[f].y-this.chars[0].y),this.curIndex+=u,this.textCursor.setLocalPosition(g,this.getRelativeYAxis(m)))}updateTextCursor(l){if(!this.textCursor||l<0||l>this.chars.length)return;let u,f;0===l?(u=0,f=0):(u=this.chars[l-1].x-this.chars[0].x+this.chars[l-1].width,f=this.chars[l-1].y-this.chars[0].y),this.curIndex=l,this.textCursor.setLocalPosition(u,this.getRelativeYAxis(f)),setTimeout(()=>{this.textArea.setSelectionRange(this.curIndex,this.curIndex)},0)}createTextSelectionArea(l,u){this.clearTextSelection();const f=Math.min(l,u),g=Math.max(l,u),m=[[]];let v=this.chars[f].lineIndex;for(let b=f;b<g;b++)v!==this.chars[b].lineIndex&&(m.push([]),v=this.chars[b].lineIndex),m[m.length-1].push(this.chars[b]);const _=this.chars[0].height;for(let b=0;b<m.length;b++){const I=m[b][0],k=m[b][m[b].length-1],O=I.x-this.lines[I.lineIndex].x,W=k.x-this.lines[k.lineIndex].x-O+k.width,J=new ps({style:{x:O,y:this.getRelativeYAxis(I.y-this.chars[0].y)-2,height:_,width:W,background:"rgba(85,160,255,0.6)",borderColor:"transparent"}});this.selectRectArray.push(J),this.renderSelectedRect()}}renderSelectedRect(){if(0!==this.selectRectArray.length)for(let l=0;l<this.selectRectArray.length;l++)this.appendChild(this.selectRectArray[l])}clearTextSelection(){if(0!==this.selectRectArray.length){for(let l=0;l<this.selectRectArray.length;l++)this.selectRectArray[l].destroy();this.selectRectArray=[]}}textareaInput(l){var u;if(this.inputChinese)return;const{length:f}=this.parsedStyle.text;this.style.text=this.textArea.value,""===this.textArea.value?(this.style.text=" ",this.textArea.value=" ",this.updateTextCursor(0)):this.moveTextCursor(this.curIndex,this.textArea.value.length-f),this.updateOrigin(),null===(u=this.renderHooks)||void 0===u||u.emit()}textareaCompositionstart(l){this.inputChinese=!0}textareaCompositionend(l){var u;const f=this.textArea.value.length-this.style.text.length;this.inputChinese=!1,this.style.text=this.textArea.value,this.moveTextCursor(this.curIndex,f),this.updateOrigin(),null===(u=this.renderHooks)||void 0===u||u.emit()}textareaKeydown(l){var u;if("ArrowLeft"===l.key&&this.moveTextCursor(this.curIndex,-1),"ArrowRight"===l.key&&this.moveTextCursor(this.curIndex,1),"ArrowUp"===l.key){if(0===this.curIndex)return;if(0===this.chars[this.curIndex-1].lineIndex)this.updateTextCursor(0);else{const{charIndex:f,lineIndex:g}=this.chars[this.curIndex-1];this.curIndex=f>this.lines[g-1].length?this.lines[g-1].sum:g-1==0?f:this.lines[g-2].sum+f,this.updateTextCursor(this.curIndex)}}if("ArrowDown"===l.key){if(this.curIndex===this.chars.length)return;if(0===this.curIndex)return void this.updateTextCursor(this.lines[0].length+1);if(this.chars[this.curIndex-1].lineIndex===this.lines.length-1)this.updateTextCursor(this.chars.length);else{const{charIndex:f,lineIndex:g}=this.chars[this.curIndex-1];this.curIndex=f>this.lines[g+1].length?this.lines[g+1].sum:this.lines[g].sum+f,this.updateTextCursor(this.curIndex)}}if("Backspace"===l.key){if(0===this.selectRectArray.length)return;this.clearTextSelection()}null===(u=this.renderHooks)||void 0===u||u.emit()}}class qEe{constructor(l){N(this,"shape",void 0),N(this,"textCursor",void 0),N(this,"textCursorInitCache",void 0),N(this,"inputComposition",!1),N(this,"startChar",void 0),N(this,"startDirection",void 0),N(this,"startPoint",void 0),N(this,"textRects",[]),N(this,"virtualChar",void 0),N(this,"isStart",!1),N(this,"canvas",void 0),N(this,"textClipboard",[]),N(this,"lineChars",void 0),N(this,"flatChars",void 0),N(this,"editMode",void 0),N(this,"textarea",void 0),N(this,"textSelection",[]),this.shape=l,this.calculateCharPosition()}getLineIndexByMoved(l){const{lines:u}=this.shape;let f=0;for(let g=0;g<u.length;g++){const{y:m,height:v}=u[g];l.y>m-.8*v&&(f=g)}return f}getLineIndexByPosition(l){const{lines:u,limitWidth:f}=this.shape;for(let g=0;g<u.length;g++){const m=u[g],{x:v,y:_,height:b}=m;if(new ps({style:{x:v,y:_-.8*b,width:f,height:b*(g===u.length-1?1:1.2),borderWidth:1,background:"transparent"}}).isPointInPath(l))return g}return-1}getCharByPosition(l,u){if(-1===u)return null;const{lineChars:f}=this,g=f[u];for(let m=0;m<g.length;m++){const v=g[m],{x:_,y:b,charWidth:S,charHeight:I}=v;if(new ps({style:{x:_,y:b-.8*I,width:S,height:I*(v.lineIndex===f.length-1?1:1.2),borderWidth:1,background:"transparent"}}).isPointInPath(l))return v}return null}getCharAndDirection(l){const u=this.getLineIndexByPosition(l);let f,g=1;if(-1===u)return f=this.flatChars[this.flatChars.length-1],g=1,{char:f,direction:g};const m="textBox"===this.shape.textType;if(f=this.getCharByPosition(l,u),f){const{x:v,charWidth:_}=f;g=l.x<v+_/2?0:1}else{const v=this.lineChars[u];f=v[v.length-1],g=1,m&&l.x<v[0].x&&(f=v[0],g=0)}return"\r"!==f.text&&"\n"!==f.text&&"\r\n"!==f.text||(g=0),0===g&&0!==f.indexInLine&&(f=this.lineChars[f.lineIndex][f.indexInLine-1],g=1),{char:f,direction:g}}createCursor(l,u,f,g){if(!this.textCursor){const m=document.createElement("div");return m.className="ddv-annotation-cursor",m.style.left=l-.5+"px",m.style.top=`${u}px`,m.style.transform=`rotate(${f}deg)`,m.style.width="1px",m.style.height=`${g}px`,this.canvas.parentNode.appendChild(m),void(this.textCursor=m)}this.textCursor.style.left=l-.5+"px",this.textCursor.style.top=`${u}px`,this.textCursor.style.height=`${g}px`,this.textCursor.style.transform=`rotate(${f}deg)`,this.textCursor.style.animation="none",this.textCursor.style.animation=""}showTextCursor(l,u){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const g=(k,O)=>{const{x:j,y:W,charWidth:J,charHeight:K,lineIndex:Q}=k;return new ps({style:{x:(O?j+J:j)-this.shape.style.x,y:W-.8*K-this.shape.style.y,borderWidth:"1px",height:K*(Q>=this.lineChars.length-1?1:1.2)}})},m=k=>{this.shape.appendChild(k);const O=this.shape.getScale().y,j=k.getAngle();k.setAngle(0);const{x:W,y:J}=k.getPosition();k.destroy(),this.createCursor(W,J,j,k.parsedStyle.height.value*O)};if(!this.editMode)return void(this.textCursor&&this.hideTextCursor());const{flatChars:v,shape:_}=this;if(!v.length&&this.virtualChar){const{fontSize:k}=this.shape.freeTextContentStyle,O=ni(k).value;if(O!==this.virtualChar.charHeight){const{borderOffset:j,padding:W}=this.shape,{y:J}=this.shape.style;this.virtualChar.charHeight=O,this.virtualChar.y=J+j+W+.8*O}return m(g(this.virtualChar,1)),void(this.textCursorInitCache={char:{totalIndex:0},isBack:1})}let b=v[l];if(pt(l)&&(b=v[0],u=0),!v[l])return;"justify"===_.style.textAlign&&"textBox"===_.textType&&" "===b.text&&u&&v[b.totalIndex+1]&&(b=v[b.totalIndex+1],u=0);const S=v[b.totalIndex+1];let I;A_(b.text)&&u&&S&&(b=S,u=0),I=A_(b.text)&&u&&!S?g(this.virtualChar,1):g(b,u),m(I),this.startChar=b,this.startDirection=u,this.textCursorInitCache={char:b,isBack:u},f&&this.shape.hooks.selectTextChars.emit({startChar:b,endChar:b,isBack:!!u,needUpdate:!1})}moveTextCursor(l){const{textSelection:u}=this;let f,g;if(2===u.length){const[S,I]=u;switch(l){case"up":case"left":f=S.totalIndex,g=0;break;default:f=I.totalIndex,g=1}return this.hideTextSelection(),this.shape.hooks.reRenderText.emit(),void this.showTextCursor(f,g)}const m=this.flatChars,v=m.length,{startChar:_,startDirection:b}=this;if(_){if("left"===l){const S=b?_.totalIndex-1:_.totalIndex-2;f=S>=0?S:0,g=S>=0?1:0}else if("right"===l){const S=b?_.totalIndex+1:_.totalIndex;f=S>v-1?v-1:S,g=1}else{const{x:S,charWidth:I,lineIndex:k}=_;if(0===k&&"up"===l)f=0,g=0;else if(k===this.lineChars.length-1&&"down"===l)f=m.length-1,g=1;else{const O=b?S+I:S,j="up"===l?this.lineChars[k-1]:this.lineChars[k+1];f=j[0].totalIndex,g=0,j.forEach(W=>{O>W.x+I/2&&(f=W.totalIndex,g=1)})}}this.showTextCursor(f,g)}}hideTextCursor(){this.textCursor&&(this.textCursor.remove(),this.textCursor=null)}showTextSelection(l,u){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=[],{lines:m,parsedStyle:v,textType:_}=this.shape;if(this.hideTextSelection(),this.textSelection=[l,u],!l||!u)return;const b=["right","justify"].includes(v.textAlign)&&"textBox"===_;if(l.y===u.y){const k=A_(l.text),O=A_(u.text);if(k&&O)return;g.push({x:l.x,y:l.y,lineIndex:l.lineIndex,width:l.x===u.x?l.charWidth:O?u.x-l.x:u.x-l.x+u.charWidth,height:m[l.lineIndex].height})}else{const k=this.shape.getTextAlignOffset(m[l.lineIndex]),{x:O,height:j}=m[l.lineIndex];if(g.push({x:l.x,y:l.y,lineIndex:l.lineIndex,width:O+(b?m[l.lineIndex].widthWithoutLF:m[l.lineIndex].width)+k-l.x,height:j}),u.lineIndex-l.lineIndex>1)for(let le=l.lineIndex+1;le<u.lineIndex;le++){const{x:he,y:_e,height:Ve}=m[le],ee=b?m[le].widthWithoutLF:m[le].width,ke=this.shape.getTextAlignOffset(m[le]);g.push({x:he+ke,y:_e,width:ee,height:Ve,lineIndex:le})}const J=this.shape.getTextAlignOffset(m[u.lineIndex]),{x:K,y:Q,height:ie}=m[u.lineIndex],oe=b&&A_(u.text)?0:u.charWidth;g.push({x:K+J,y:Q,width:u.x+oe-K-J,height:ie,lineIndex:u.lineIndex})}const{x:S,y:I}=this.shape.style;this.hideTextCursor(),g.forEach(k=>{const j=new ps({style:{x:k.x-S,y:k.y-I-.8*k.height,width:k.width,height:k.height*(k.lineIndex===this.lineChars.length-1?1:1.2),background:"rgba(0, 123, 255, 0.5)"}});this.shape.appendChild(j),this.textRects.push(j)}),this.shape.hooks.selectTextChars.emit({startChar:l,endChar:u,isBack:!0,needUpdate:f})}hideTextSelection(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.textRects.forEach(u=>{u.destroy()}),this.textSelection=[],this.textRects=[],l){const{char:u,isBack:f}=this.textCursorInitCache;this.showTextCursor(u.totalIndex,f)}}addText(l,u,f){if(!f||""===f)return;if(!l){const j=Ht(qe({},this.shape.freeTextContentStyle),{content:f});return this.shape.context.updateControlsFlags({useDefaultControls:!1}),this.shape.updateStyle({textContents:[j]}),this.shape.hooks.textContentUpdated.emit(),void this.showTextCursor(f.length-1,1)}const g=hn(this.shape.style.textContents),{freeContentIndex:m,indexInFreeContent:v}=l,_=g[m],{content:b}=_,S=tZ(this.shape.freeTextContentStyle,_),I=()=>Ht(qe({},this.shape.freeTextContentStyle),{content:f});if(u&&v===b.length-1)S?_.content+=f:g.splice(m+1,0,I());else if(u||v)if(S){const j=0===u?v:v+1;_.content=b.slice(0,j)+f+b.slice(j)}else{const j=[],W=b.slice(0,u?v+1:v),J=b.slice(u?v+1:v);W&&j.push(Ht(qe({},_),{content:W})),j.push(I()),J&&j.push(Ht(qe({},_),{content:J})),g.splice(m,1,...j)}else m?tZ(this.shape.freeTextContentStyle,g[m-1])?g[m-1].content+=f:g.splice(m,0,I()):S?_.content=f+_.content:g.unshift(I());this.shape.updateStyle({textContents:[...g]}),this.shape.hooks.textContentUpdated.emit();const{char:k,isBack:O}=this.textCursorInitCache;this.showTextCursor(O?k.totalIndex+f.length:k.totalIndex+f.length-1,1)}deleteText(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const u=hn(this.shape.style.textContents);if(!u.length)return;let f=0;if(2===this.textSelection.length){const[g,m]=this.textSelection;if(g.freeContentIndex===m.freeContentIndex){const v=u[g.freeContentIndex];v.content=KQ(v.content,g.indexInFreeContent,m.indexInFreeContent)}else{const v=u[g.freeContentIndex],_=u[m.freeContentIndex];v.content=v.content.substring(0,g.indexInFreeContent),_.content=_.content.substring(m.indexInFreeContent+1);for(let b=g.freeContentIndex+1;b<m.freeContentIndex;b++)u[b].content=""}f=g.totalIndex-1}else{const{startChar:g,startDirection:m}=this;if(!g)return;const v=m?g:this.flatChars[g.totalIndex-1];if(!v)return;const{freeContentIndex:_,indexInFreeContent:b}=v,S=u[_];if(!S.color)return;S.content=KQ(S.content,b,b),f=v.totalIndex-1}this.shape.updateStyle({textContents:[...u]}),l&&this.shape.hooks.textContentUpdated.emit(),this.hideTextSelection(),this.showTextCursor(f,1,!1),this.shape.hooks.reRenderText.emit()}copyText(){if(!this.textSelection.length)return;this.textClipboard=[];const{textContents:l}=this.shape.style,[u,f]=this.textSelection,g=[],m=u.freeContentIndex,v=f.freeContentIndex;if(m===v){const _=l[m],b=_.content.slice(u.indexInFreeContent,f.indexInFreeContent+1);g.push(Ht(qe({},_),{content:b}))}else for(let _=m;_<=v;_++){const b=qe({},l[_]),S=b.content;_===m?b.content=S.slice(u.indexInFreeContent):_===v&&(b.content=S.slice(0,f.indexInFreeContent+1)),g.push(qe({},b))}this.textClipboard=[...g],function(_){let b="";_.forEach(S=>{b+=S.content});try{navigator.clipboard.writeText(b)}catch(S){}}(g)}pasteText(){this.textSelection.length&&this.deleteText(!1);const{isBack:l,char:u}=this.textCursorInitCache,{textContents:f}=this.shape.style,g=l?u:this.flatChars[u.totalIndex-1];let m=0,v=(null==g?void 0:g.totalIndex)||-1;if(this.textClipboard.forEach(_=>{m+=_.content.length}),g)if(this.flatChars.length){const _=f[u.freeContentIndex];if(_.content.length===g.indexInFreeContent+1)f.splice(u.freeContentIndex+1,0,...hn(this.textClipboard)),this.shape.updateStyle({textContents:[...f]});else{const{content:b}=_,{indexInFreeContent:S}=g,I=[Ht(qe({},_),{content:b.slice(0,S+1)}),...hn(this.textClipboard),Ht(qe({},_),{content:b.slice(S+1)})];f.splice(u.freeContentIndex,1,...I),this.shape.updateStyle({textContents:[...f]})}}else this.shape.updateStyle({textContents:hn(this.textClipboard)}),v=-1;else f.unshift(...hn(this.textClipboard)),this.shape.updateStyle({textContents:f});this.showTextCursor(v+m,1),this.shape.hooks.textContentUpdated.emit()}selectAllText(){this.flatChars.length&&(this.showTextSelection(this.flatChars[0],this.flatChars[this.flatChars.length-1]),this.shape.hooks.reRenderText.emit())}updateTextSelection(){if(!this.textSelection.length)return;const[l,u]=this.textSelection;this.showTextSelection(this.flatChars[l.totalIndex],this.flatChars[u.totalIndex],!0),this.shape.hooks.reRenderText.emit()}calculateCharPosition(){const{lines:l}=this.shape,u=[];let f=0,g=0,m=0,v=0;l.forEach((S,I)=>{const k=S.height,O=[],j=this.shape.getTextAlignOffset(S),W=(J,K,Q,ie,oe)=>{O.push({text:J,x:K,y:Q,charWidth:ie,charHeight:k,freeContentIndex:oe,lineIndex:I,indexInLine:g,indexInFreeContent:f,totalIndex:v})};g=0,S.words.forEach(J=>{const{wordWidth:K,freeContentIndex:Q,x:ie,text:oe}=J;if(Q!==m&&(f=0,m=Q),1===J.text.length)W(oe,ie+j,S.y,K,Q),v+=1,g+=1,f+=1;else{let le=J.x+j;for(let he=0;he<oe.length;he++){const _e=oe.charAt(he),Ve=Hu(_e,J.style);W(_e,le,S.y,Ve,Q),le+=Ve,v+=1,f+=1,g+=1}J.text.length!==J.originText.length&&(f+=J.originText.length-J.text.length)}}),u.push(O)});const _=this.shape.getTextAlignOffset();if(this.flatChars=u.flat(),this.lineChars=u,this.virtualChar=null,!l.length){const{x:S,y:I,textAlign:k}=this.shape.parsedStyle,{borderOffset:O,padding:j}=this.shape,{fontSize:W}=this.shape.freeTextContentStyle,J=ni(W).value;return void(this.virtualChar={x:"right"===k?S+j+_:S+O+j+_,y:I+O+j+.8*J,charWidth:1,charHeight:J,lineIndex:0})}const b=this.flatChars[this.flatChars.length-1];A_(b.text)&&(this.virtualChar={x:this.shape.lines[0].x+_,y:b.y+1.2*this.shape.lines[b.lineIndex].height,charWidth:1,charHeight:b.charHeight,lineIndex:b.lineIndex+1})}updateCursor(){if(!this.textCursor||!this.textCursorInitCache)return;const{char:l,isBack:u}=this.textCursorInitCache;this.showTextCursor(l.totalIndex,u)}enableEditMode(l,u){"freeTextWriter"===this.shape.textType&&(this.shape.pathDirty=!0,this.shape.boundsDirty=!0,this.shape.calculateContentLines(),this.shape.hooks.reRenderText.emit()),this.calculateCharPosition(),this.editMode=!0,this.canvas=u;let f=!1;if("textBox"===this.shape.textType){const{totalTextHeight:g}=this.shape,{height:m}=this.shape.parsedStyle;g!==m.value&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0)}if(this.flatChars.length){const g=Gu(this.shape,l),m=this.getCharAndDirection(g),{char:v,direction:_}=m;this.startChar=v,this.startDirection=_,this.showTextCursor(v.totalIndex,_)}else this.showTextCursor(void 0,void 0),"freeTextWriter"===this.shape.textType&&(f=!0);this.shape.context.updateControlsFlags({useDefaultControls:f,enableMove:!1}),this.shape.hooks.enableTextEditMode.emit(),this.openTextarea(l)}disableEditMode(){if(this.editMode){if(this.textClipboard=[],this.editMode=!1,this.hideTextCursor(),this.hideTextSelection(),this.shape.lastIsBack=null,this.shape.lastSelectedEndChar=null,this.shape.context.updateControlsFlags({useDefaultControls:!0,enableMove:!0}),this.textarea&&this.textarea.blur(),"textBox"===this.shape.textType){const{totalTextHeight:l}=this.shape,{height:u}=this.shape.parsedStyle;l!==u.value&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0,this.shape.updateOrigin(),this.shape.hooks.reRenderText.emit())}this.shape.hooks.disableTextEditMode.emit()}}editStartHandler(l){if(!this.editMode)return;if(!this.flatChars.length)return void this.showTextCursor(void 0,void 0);const u=Gu(this.shape,l),f=this.getCharAndDirection(u);this.hideTextSelection();const{char:g,direction:m}=f;this.showTextCursor(g.totalIndex,m),this.isStart=!0,this.startChar=g,this.startDirection=m,this.startPoint=u,this.shape.hooks.reRenderText.emit()}editMoveHandler(l){if(!this.editMode||!this.isStart)return;const{lineChars:u}=this,f=Gu(this.shape,l),g=this.getLineIndexByMoved(f);let{startChar:m,startDirection:v}=this,_=null;const b=u[g],S=g===this.startChar.lineIndex?f.x>this.startPoint.x:f.y>this.startPoint.y,{lineIndex:I,indexInLine:k}=this.startChar;if(!this.startDirection&&!S){if(0===m.totalIndex)return void this.hideTextSelection(!0);const K=m.lineIndex===u.length-1;if(K&&f.y<this.startPoint.y)m=this.flatChars[m.totalIndex-1],v=1;else if(K)return void this.hideTextSelection(!0)}if(S&&v&&(m=u[I][k+1],v=0,!m))return void this.hideTextSelection(!0);if(S&&f.x<b[0].x+b[0].charWidth/2&&m.lineIndex!==g){const K=u[g-1];return _=K[K.length-1],void this.showTextSelection(m,_)}if(S)b.forEach((K,Q)=>{const{x:ie,charWidth:oe}=K;f.x>ie+oe/2&&(_=b[Q])});else for(let K=b.length-1;K>=0;K--){const{x:Q,charWidth:ie}=b[K];Q+ie/2>f.x&&(_=b[K])}if(!_)return void this.hideTextSelection(!0);const{lineIndex:O,indexInLine:j}=m,{lineIndex:W,indexInLine:J}=_;S&&O===W&&j===J+1||!S&&O===W&&j===J-1?this.hideTextSelection(!0):S?this.showTextSelection(m,_):this.showTextSelection(_,m)}editEndHandler(){this.isStart=!1}editClickHandler(l,u){this.editMode&&(this.canvas=u,this.openTextarea(l))}openTextarea(l){if(this.editMode){if(!this.textarea){const u=document.createElement("textarea");u.className="ddv-annotation-textarea",this.canvas.parentNode.appendChild(u),this.textarea=u,u.addEventListener("input",f=>{this.inputComposition||this.textareaInput(f)},!1),u.addEventListener("compositionstart",f=>this.textareaCompositionstart(f),!1),u.addEventListener("compositionend",f=>{this.inputComposition=!1,this.textareaInput(f)},!1),u.addEventListener("keydown",f=>this.textareaKeydown(f),!1)}if(l){const{x:u,y:f}=l;this.textarea.style.left=`${u}px`,this.textarea.style.top=`${f}px`}this.textarea.value="",this.textarea.focus()}}destroyTextarea(){this.textarea&&(this.textarea.remove(),this.textarea=null)}textareaInput(l){const u=this.textarea.value;if(2===this.textSelection.length&&this.deleteText(!1),this.flatChars.length){const{char:f,isBack:g}=this.textCursorInitCache;this.addText(f,g,u)}else this.addText(void 0,void 0,u);this.textarea.value=""}textareaCompositionstart(l){this.inputComposition=!0}textareaKeydown(l){if(this.inputComposition||"Backspace"!==l.key||8!==l.keyCode)switch(l.ctrlKey&&"C"===l.key.toLocaleUpperCase()&&this.copyText(),l.ctrlKey&&"X"===l.key.toLocaleUpperCase()&&(this.copyText(),this.textSelection.length&&this.deleteText()),l.ctrlKey&&"V"===l.key.toLocaleUpperCase()&&this.textClipboard.length&&(l.preventDefault(),this.pasteText()),l.ctrlKey&&"Z"===l.key.toLocaleUpperCase()&&l.stopPropagation(),l.ctrlKey&&"A"===l.key.toLocaleUpperCase()&&this.selectAllText(),l.key){case"ArrowLeft":this.moveTextCursor("left");break;case"ArrowRight":this.moveTextCursor("right");break;case"ArrowUp":this.moveTextCursor("up");break;case"ArrowDown":this.moveTextCursor("down")}else this.deleteText()}}function tZ(p,l){return p.color===l.color&&p.fontFamily===l.fontFamily&&p.fontSize===l.fontSize&&p.fontStyle===l.fontStyle&&p.fontWeight===l.fontWeight&&p.lineThrough===l.lineThrough&&p.underline===l.underline}class or extends OQ{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:QQ,g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super({type:"annotationFreeText",id:l.id,style:qe({freeTextType:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"textBox"},l.style)}),N(this,"lastSelectedEndChar",void 0),N(this,"lastIsBack",void 0),N(this,"shapeType","annotationFreeText"),N(this,"textEditEventHandler",void 0),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),N(this,"freeTextContentStyle",void 0),N(this,"inputModeTimer",void 0),N(this,"hooks",{reRenderText:up(),selectTextChars:up(),textContentUpdated:up(),enableTextEditMode:up(),disableTextEditMode:up()}),this.freeTextContentStyle=f,this.init(l.transform,l.selectableStyle,g),"freeTextWriter"===this.textType&&this.context.updateControlsFlags({enableEdit:!1,enableRotate:!1}),this.hooks.selectTextChars.on(m=>{const v=m.endChar;if(this.isSameChar(v,this.lastSelectedEndChar)&&m.isBack===this.lastIsBack&&!m.needUpdate)return;let _=v.freeContentIndex;v.indexInFreeContent||!v.freeContentIndex||m.isBack||(_-=1);const b=this.style.textContents[_];this.lastSelectedEndChar=v,this.lastIsBack=m.isBack,this.freeTextContentStyle=Ht(qe({},b),{content:this.freeTextContentStyle.content})})}get isEditMode(){var l;return null===(l=this.textEditEventHandler)||void 0===l?void 0:l.editMode}get hasSelectedChars(){var l;return(null===(l=this.textEditEventHandler)||void 0===l?void 0:l.textSelection.length)>0}init(l,u,f){if("freeTextWriter"===this.textType&&f&&super.updateOrigin(),this.context=new qc(this,u),this.textEditEventHandler=new qEe(this),this.eventHandler=new $c(this),this.context.setTransform(l),"freeTextWriter"===this.textType&&f){const{x:g,y:m}=this.getPosition();this.updateOrigin(),this.setPosition({x:g,y:m})}}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.textEditEventHandler.disableEditMode(),this.textEditEventHandler.destroyTextarea(),this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}updateOrigin(){"freeTextWriter"===this.textType?this.setOrigin(0,0):super.updateOrigin()}getAnnotationConfig(){const l="textBox"===this.textType?"annotationTextBox":"annotationFreeText",u=this.context.getTransform(),{position:f}=u,{width:g,height:m,textContents:v}=this.attributes,_={type:l,style:Ht(qe({x:f.x,y:f.y,textContents:hn(v),textAlign:this.style.textAlign},this.context.getCommonStyleConfig()),{width:g}),transform:u};return"textBox"===this.textType&&(_.style.height=m),_}calculateTotalHeight(){var l,u;const f=ni((null===(l=this.freeTextContentStyle)||void 0===l?void 0:l.fontSize)||16);if(null!==(u=this.lines)&&void 0!==u&&u.length)super.calculateTotalHeight();else if("freeTextWriter"===this.textType)this.totalTextHeight=f.value+2*this.borderOffset;else{const{height:g}=this.parsedStyle;this.totalTextHeight=g.value>f.value+2*this.borderOffset?g.value:f.value+2*this.borderOffset+2*this.padding}}getBoundingRect(){var l;if(!this.boundsDirty)return this.bounds;const{x:u,y:f}=this.parsedStyle;if("freeTextWriter"===this.textType&&(null===(l=this.lines)||void 0===l||!l.length)){var g;const m=ni((null===(g=this.freeTextContentStyle)||void 0===g?void 0:g.fontSize)||16);return this.boundsDirty=!1,this.bounds={x:u,y:f,width:Hu("  ",Ht(qe({},this.freeTextContentStyle),{fontSize:m})),height:m.value+2*this.padding},this.bounds}return super.getBoundingRect(),"textBox"===this.textType&&this.isEditMode&&(this.bounds.height=this.totalTextHeight),this.bounds}updateFreeTextContentStyle(l){this.freeTextContentStyle=l,this.textEditEventHandler.updateCursor();const{flatChars:u}=this.textEditEventHandler;this.isEditMode&&!u.length&&(this.pathDirty=!0,this.boundsDirty=!0,this.calculateTotalHeight(),this.hooks.reRenderText.emit(),this.hooks.enableTextEditMode.emit())}focusTexture(){const l=ir();this.isEditMode&&this.textEditEventHandler.textarea&&(l||this.textEditEventHandler.textarea.focus())}updateCursor(){this.textEditEventHandler.updateCursor()}isSameChar(l,u){return!(!l||!u)&&l.charHeight===u.charHeight&&l.charWidth===u.charWidth&&l.freeContentIndex===u.freeContentIndex&&l.indexInFreeContent===u.indexInFreeContent&&l.indexInLine===u.indexInLine&&l.text===u.text&&l.totalIndex===u.totalIndex}}class pp extends ps{constructor(l){super({id:l,type:"annotationGroup",style:{visibility:"hidden",background:"transparent",borderColor:"transparent"}}),N(this,"shapeType","annotationGroup"),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),N(this,"parent",void 0),N(this,"parentPosition",void 0),N(this,"shapes",[]),N(this,"clickedShape",null),N(this,"state",!1),N(this,"groupMode",0),this.context=new qc(this),this.eventHandler=new $c(this),this.eventHandler.isHit=this.isHit.bind(this),this.context.updateControlsFlags(this.groupMode?{enableEdit:!1}:{useDefaultControls:!1})}isHit(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{context:f,parsedStyle:g}=this;let{controls:m}=this;if(!this.state||"hidden"===g.visibility||!f.controlsFlags.enableControl)return this.clickedShape=null,-1;m||(f.initControls(),f.renderControls(),m=this.controls);let v=-1;if(this.groupMode)v=m.checkHitArea(l.x,l.y);else for(let _=0;_<this.shapes.length;_++)if(this.shapes[_].controls||(this.shapes[_].context.initControls(),this.shapes[_].context.renderControls()),this.shapes[_].controls.checkHitArea(l.x,l.y)>=0){this.clickedShape=this.shapes[_],v=9;break}return v<0&&u?(this.clickedShape=null,f.unHitShape(),this.context.destroyControls(),-1):v}init(){this.style.visibility="visible",this.parent.appendChild(this),this.shapes.forEach(l=>{l instanceof or&&l.isEditMode&&l.textEditEventHandler.disableEditMode(),this.appendChild(l),l.context.isGrouped=!0}),this.update(),this.context.initControls()}add(l){if(!this.parent){const u=l.parentNode;this.parent=u,this.parentPosition=u.getPosition()}if("hidden"!==l.parsedStyle.visibility&&-1===this.shapes.indexOf(l)){if(l.context.isInGroup=!0,this.shapes.push(l),this.state){const u=[];this.shapes.forEach(f=>{u.push(f.getWorldTransform().clone())}),l instanceof or&&l.isEditMode&&l.textEditEventHandler.disableEditMode(),l.context.isGrouped=!0,this.appendChild(l),this.groupMode||this.showAllControls(l),this.shapes.forEach((f,g)=>{const m=this.getWorldTransform().inverse().multiply(u[g]);f.setLocalTransform(m)}),this.update()}this.shapes.length>=2&&!1===this.state&&(this.state=!0,this.init())}}update(){const l=[],u=[],f=[];for(let I=0;I<this.shapes.length;I++){const k=this.shapes[I];let{controls:O}=k;O||(k.context.initControls(),O=k.controls),k.context.renderControls(),this.groupMode&&k.context.unHitShape();const j=O.controlPoints.slice(0,4);for(let W=0;W<4;W++){const{x:J,y:K}=j[W].getCenterPosition();l.push(J),u.push(K)}f.push(this.shapes[I].getWorldTransform().clone())}const g=Math.max(...l),m=Math.min(...l),v=Math.max(...u),_=Math.min(...u);this.updateStyle({x:0,y:0,width:g-m,height:v-_}),this.setAngle(180===this.parent.getAngle()?179.99:0),this.setLocalScale(1,1,1);const{x:b,y:S}=this.getScale();this.scale(1/Math.abs(b),1/Math.abs(S)),this.setPosition({x:m,y:_}),this.updateOrigin(),this.context.updateControls(),this.shapes.forEach((I,k)=>{const O=this.getWorldTransform().inverse().multiply(f[k]);I.setLocalTransform(O)})}delete(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.parent||-1===this.shapes.indexOf(l))return;const f=l.getWorldTransform().clone();this.parent.appendChild(l);const g=this.parent.getWorldTransform().inverse().multiply(f);l.setLocalTransform(g),l.context.isInGroup=!1,l.context.isGrouped=!1,l.context.isActive=!1,l.context.destroyControls(),"freeTextWriter"!==(null==l?void 0:l.textType)&&l.context.updateControlsFlags({enableRotate:!0}),Hg(l)&&l.pointEventsHandler.disableEditMode(),this.shapes.splice(this.shapes.indexOf(l),1),u&&this.update(),0===this.shapes.length&&this.clear()}clear(){const{length:l}=this.shapes;for(let u=l-1;u>=0;u--)this.delete(this.shapes[u],!1);this.context.destroyControls(),this.reset()}reset(){this.parent&&this.parent.removeChild(this),this.updateStyle({x:0,y:0,width:0,height:0}),this.resetLocalTransform(),this.shapes=[],this.parent=null,this.state=!1,this.style.visibility="hidden"}destroy(){const{length:l}=this.shapes;for(let u=l-1;u>=0;u--)this.shapes[u].destroy();this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.shapes=[],this.state=!1,this.parent=null,this.style.visibility="hidden",this.updateStyle({x:0,y:0,width:0,height:0})}showAllControls(l){if(!this.state||this.groupMode)return;const u=f=>{Hg(f)&&f.pointEventsHandler.enableEditMode(),f.controls||f.context.initControls(),f.context.updateControlsFlags({enableRotate:!1}),f.context.isActive=!0,f.context.renderControls()};l?u(l):this.shapes.forEach(f=>{u(f)})}getAnnotationConfig(){return{type:"annotationGroup"}}}class KEe extends ps{constructor(l){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),N(this,"shapeType","annotationLineControls"),N(this,"container",void 0),this.container=l}get isVisible(){return"hidden"!==this.parsedStyle.visibility&&JQ(null==this?void 0:this.container)}}class l5{constructor(l){N(this,"shape",void 0),N(this,"editMode",void 0),N(this,"hitIndex",-1),N(this,"hitPointPos",void 0),N(this,"startPoint",void 0),N(this,"controlsBox",void 0),N(this,"controlsPoints",[]),this.shape=l}getLineShapePoints(){const{shape:l}=this,{shapeType:u}=l;if("annotationLine"===u){const{startPoint:g,endPoint:m}=l.style;return[g,m]}const{points:f}=this.shape.parsedStyle;return f.slice(0,f.length)}initLineControls(){const{shape:l}=this;l.updatePoints();const{x:u,y:f}=this.shape.getScale(),{ctrlBorderColor:g,ctrlBorderWidth:m,ctrlLineDash:v,borderColor:_,borderWidth:b,lineDash:S,ctrlBorderRadius:I,ctrlWidth:k,ctrlHeight:O,background:j,ctrlBackground:W}=l.context.parsedControlsStyle,J={background:W,borderColor:g,borderWidth:m,lineDash:v},K=this.shape.getBoundingRect(),Q=this.getLineShapePoints();this.controlsBox=new KEe(this.shape,{style:{width:K.width*u,height:K.height*f,borderColor:_,borderWidth:b,background:j,lineDash:S}}),Q.forEach(ie=>{const oe=new ZO({style:qe({width:k,height:O,roundedRadius:I},J)}),le=(ie.x-K.x)*u-ni(k).value/2,he=(ie.y-K.y)*f-ni(O).value/2;oe.setLocalPosition(le,he),this.controlsPoints.push(oe),this.controlsBox.appendChild(oe)}),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.getRootNode().appendChild(this.controlsBox)}isHitPoint(l){if(!this.editMode)return-1;for(let u=0;u<this.controlsPoints.length;u++){const f=Gu(this.controlsPoints[u],l);if(this.controlsPoints[u].isPointInPath(f))return u}return-1}updateLineControls(){if(!this.controlsBox||0===this.controlsPoints.length||!this.editMode)return;const{ctrlWidth:l,ctrlHeight:u}=this.shape.context.parsedControlsStyle,{x:f,y:g}=this.shape.getScale(),m=this.shape.getBoundingRect(),v=this.getLineShapePoints();this.controlsPoints.length!==v.length&&(this.destroyLineControls(),this.initLineControls()),v.forEach((_,b)=>{this.controlsPoints[b].setLocalPosition((_.x-m.x)*f-l/2,(_.y-m.y)*g-u/2)}),this.controlsBox.updateStyle({width:m.width*f,height:m.height*g}),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.controls&&(this.shape.context.lastControlsWidth=this.shape.controls.getLength().width,this.shape.context.lastControlsHeight=this.shape.controls.getLength().height)}destroyLineControls(){var l;null===(l=this.controlsBox)||void 0===l||l.destroy(),this.controlsPoints.forEach(u=>{u.destroy(),u=null}),this.controlsBox=null,this.controlsPoints=[]}enableEditMode(){if(this.shape.path||this.shape.getPath(),this.shape.path.length>this.shape.pointerLimitCount||this.controlsPoints.length>0)return;const{shape:l}=this;this.editMode||this.initLineControls(),this.editMode=!0,l.context.isHit=!0,l.controls&&(l.context.lastControlsWidth=l.controls.getLength().width,l.context.lastControlsHeight=l.controls.getLength().height)}disableEditMode(){this.destroyLineControls(),this.editMode=!1}editStartHandler(l){if(!this.editMode)return;this.hitIndex=-1;const u=this.isHitPoint(l);-1!==u&&(this.hitIndex=u,this.hitPointPos=qe({},this.shape.path[this.hitIndex])),this.startPoint=l,this.shape.context.lastLocalTransform=this.shape.getLocalTransform()}editMoveHandler(l){if(!this.editMode||-1===this.hitIndex)return;const{shape:u}=this,f="annotationLine"===u.shapeType,g=f?[...u.path]:[...u.parsedStyle.points],m=Gu(u,l);g[this.hitIndex]=m,f?u.updateStyle({startPoint:{x:g[0].x,y:g[0].y},endPoint:{x:g[1].x,y:g[1].y}}):u.style.points=g,this.updateLineControls()}editEndHandler(){this.editMode&&this.shape.updatePoints()}}class Kx extends t2{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(qe({type:"annotationPolygon"},l)),N(this,"shapeType","annotationPolygon"),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),N(this,"pointEventsHandler",void 0),N(this,"pointerLimitCount",200),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new qc(this,u),this.pointEventsHandler=new l5(this),this.eventHandler=new $c(this),this.context.setTransform(l),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const l=this.context.getTransform(),u=this.getBoundingRect(),{position:f}=l;let m=this.attributes.points;return(f.x!==u.x||f.y!==u.y)&&(m=[],this.attributes.points.forEach(v=>{m.push({x:v.x-u.x+f.x,y:v.y-u.y+f.y})})),{type:"annotationPolygon",style:qe({points:m},this.context.getCommonStyleConfig()),transform:l}}}class Jx extends JO{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(qe({type:"annotationPolyline"},l)),N(this,"shapeType","annotationPolyline"),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),N(this,"pointEventsHandler",void 0),N(this,"pointerLimitCount",200),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new qc(this,u),this.pointEventsHandler=new l5(this),this.eventHandler=new $c(this),this.context.setTransform(l),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const l=this.context.getTransform(),u=this.getBoundingRect(),{position:f}=l;let m=this.attributes.points;return(f.x!==u.x||f.y!==u.y)&&(m=[],this.attributes.points.forEach(v=>{m.push({x:v.x-u.x+f.x,y:v.y-u.y+f.y})})),{type:"annotationPolyline",style:qe({points:m,lineEnding:this.attributes.lineEnding},this.context.getCommonStyleConfig()),transform:l}}}class Qx extends QO{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(qe({type:"annotationLine"},l)),N(this,"shapeType","annotationLine"),N(this,"eventHandler",void 0),N(this,"controls",void 0),N(this,"context",void 0),N(this,"pointEventsHandler",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new qc(this,u),this.pointEventsHandler=new l5(this),this.eventHandler=new $c(this),this.context.setTransform(l),this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const l=this.context.getTransform(),u=this.getBoundingRect(),{startPoint:f,endPoint:g,lineEnding:m}=this.attributes,{position:v}=l,_=v.x!==u.x||v.y!==u.y;return{type:"annotationLine",style:qe({startPoint:_?{x:f.x-u.x+v.x,y:f.y-u.y+v.y}:f,endPoint:_?{x:g.x-u.x+v.x,y:g.y-u.y+v.y}:g,lineEnding:m},this.context.getCommonStyleConfig()),transform:l}}}const JEe=[{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #a9d776, #40691b)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"round",miterLimit:4}],QEe=[{type:"path",stampPoints:[{x:424.45703125,y:294.07291666666663,step:2},{x:424.45703125,y:298.47265625,step:1},{x:420.83984375,y:302.07291666666663,step:1},{x:416.4192708333333,y:302.07291666666663,step:1},{x:222.49481201171875,y:302.07291666666663,step:0},{x:218.07421875,y:302.07291666666663,step:1},{x:214.45703125,y:298.47265625,step:1},{x:214.45703125,y:294.07291666666663,step:1},{x:214.45703125,y:252.07291666666666,step:0},{x:214.45703125,y:247.67313639322916,step:1},{x:218.07421875,y:244.07291666666666,step:1},{x:222.49481201171875,y:244.07291666666666,step:1},{x:416.4192708333333,y:244.07291666666666,step:0},{x:420.83984375,y:244.07291666666666,step:1},{x:424.45703125,y:247.67313639322916,step:1},{x:424.45703125,y:252.07291666666666,step:1},{x:424.45703125,y:294.07291666666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:424.0677083333333,y:293.9374593098958,step:2},{x:424.0677083333333,y:298.3358968098958,step:1},{x:420.45048014322913,y:301.9374593098958,step:1},{x:416.02994791666663,y:301.9374593098958,step:1},{x:222.10614013671875,y:301.9374593098958,step:0},{x:217.685546875,y:301.9374593098958,step:1},{x:214.06837972005206,y:298.3358968098958,step:1},{x:214.06837972005206,y:293.9374593098958,step:1},{x:214.06837972005206,y:251.93684895833331,step:0},{x:214.06837972005206,y:247.53715006510416,step:1},{x:217.685546875,y:243.93684895833331,step:1},{x:222.10614013671875,y:243.93684895833331,step:1},{x:416.02994791666663,y:243.93684895833331,step:0},{x:420.45048014322913,y:243.93684895833331,step:1},{x:424.0677083333333,y:247.53715006510416,step:1},{x:424.0677083333333,y:251.93684895833331,step:1},{x:424.0677083333333,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(41,66,18,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:234.81705729166666,y:280.5859375,step:2},{x:231.83074951171875,y:287.9374593098958,step:0},{x:226.009765625,y:287.9374593098958,step:0},{x:238.44596354166666,y:259.6288655598958,step:0},{x:245.4388224283854,y:259.6288655598958,step:0},{x:248.38736979166666,y:287.9374593098958,step:0},{x:242.67903645833331,y:287.9374593098958,step:0},{x:242.150390625,y:280.5859375,step:0},{x:234.81705729166666,y:280.5859375,step:0},{x:241.9238077799479,y:275.9661458333333,step:2},{x:241.43166097005206,y:269.8769124348958,step:0},{x:241.318359375,y:268.3229573567708,step:1},{x:241.205078125,y:266.0553792317708,step:1},{x:241.0917765299479,y:264.33268229166663,step:1},{x:240.978515625,y:264.33268229166663,step:0},{x:240.33528645833331,y:266.0553792317708,step:1},{x:239.6171671549479,y:268.2389729817708,step:1},{x:238.93684895833331,y:269.8769124348958,step:1},{x:236.44270833333331,y:275.9661458333333,step:0},{x:241.9238077799479,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:255.87109375,y:260.1335042317708,step:2},{x:257.5345052083333,y:259.67057291666663,step:1},{x:260.06705729166663,y:259.41861979166663,step:1},{x:262.52410888671875,y:259.41861979166663,step:1},{x:264.83009847005206,y:259.41861979166663,step:1},{x:267.43815104166663,y:259.8391927083333,step:1},{x:269.2903645833333,y:261.30924479166663,step:1},{x:271.02931722005206,y:262.56901041666663,step:1},{x:272.0501302083333,y:264.58463541666663,step:1},{x:272.0501302083333,y:267.314453125,step:1},{x:272.0501302083333,y:270.884765625,step:1},{x:270.5755208333333,y:273.6145833333333,step:1},{x:268.61002604166663,y:275.2942708333333,step:1},{x:266.5305989583333,y:277.1015625,step:1},{x:263.544921875,y:277.94010416666663,step:1},{x:260.4446818033854,y:277.94010416666663,step:1},{x:259.5384318033854,y:277.94010416666663,step:1},{x:258.78190104166663,y:277.81510416666663,step:1},{x:258.21486409505206,y:277.7734375,step:1},{x:256.4759114583333,y:287.9374593098958,step:0},{x:251.146484375,y:287.9374593098958,step:0},{x:255.87109375,y:260.1335042317708,step:0},{x:259.0462239583333,y:272.8170979817708,step:2},{x:259.61328125,y:272.9427083333333,step:1},{x:260.2181193033854,y:273.0266927083333,step:1},{x:261.1634318033854,y:273.0266927083333,step:1},{x:264.4140625,y:273.0266927083333,step:1},{x:266.56901041666663,y:270.6751302083333,step:1},{x:266.56901041666663,y:267.861328125,step:1},{x:266.56901041666663,y:265.130859375,step:1},{x:264.7923177083333,y:264.24869791666663,step:1},{x:262.712890625,y:264.24869791666663,step:1},{x:261.6927083333333,y:264.24869791666663,step:1},{x:260.9368489583333,y:264.33268229166663,step:1},{x:260.48307291666663,y:264.4167073567708,step:1},{x:259.0462239583333,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:277.19010416666663,y:260.1335042317708,step:2},{x:278.85353597005206,y:259.67057291666663,step:1},{x:281.3860677083333,y:259.41861979166663,step:1},{x:283.84246826171875,y:259.41861979166663,step:1},{x:286.14845784505206,y:259.41861979166663,step:1},{x:288.75651041666663,y:259.8391927083333,step:1},{x:290.6087239583333,y:261.30924479166663,step:1},{x:292.34765625,y:262.56901041666663,step:1},{x:293.3685099283854,y:264.58463541666663,step:1},{x:293.3685099283854,y:267.314453125,step:1},{x:293.3685099283854,y:270.884765625,step:1},{x:291.8938802083333,y:273.6145833333333,step:1},{x:289.92836507161456,y:275.2942708333333,step:1},{x:287.84962972005206,y:277.1015625,step:1},{x:284.86328125,y:277.94010416666663,step:1},{x:281.763671875,y:277.94010416666663,step:1},{x:280.8567708333333,y:277.94010416666663,step:1},{x:280.10028076171875,y:277.81510416666663,step:1},{x:279.533203125,y:277.7734375,step:1},{x:277.794921875,y:287.9374593098958,step:0},{x:272.4648234049479,y:287.9374593098958,step:0},{x:277.19010416666663,y:260.1335042317708,step:0},{x:280.36525472005206,y:272.8170979817708,step:2},{x:280.93229166666663,y:272.9427083333333,step:1},{x:281.537109375,y:273.0266927083333,step:1},{x:282.482421875,y:273.0266927083333,step:1},{x:285.732421875,y:273.0266927083333,step:1},{x:287.88736979166663,y:270.6751302083333,step:1},{x:287.88736979166663,y:267.861328125,step:1},{x:287.88736979166663,y:265.130859375,step:1},{x:286.1106974283854,y:264.24869791666663,step:1},{x:284.03192138671875,y:264.24869791666663,step:1},{x:283.0110677083333,y:264.24869791666663,step:1},{x:282.2552286783854,y:264.33268229166663,step:1},{x:281.80145263671875,y:264.4167073567708,step:1},{x:280.36525472005206,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:298.583984375,y:260.1335042317708,step:2},{x:300.2845052083333,y:259.67057291666663,step:1},{x:302.8548380533854,y:259.41861979166663,step:1},{x:305.3880208333333,y:259.41861979166663,step:1},{x:307.80731201171875,y:259.41861979166663,step:1},{x:310.3020833333333,y:259.79752604166663,step:1},{x:312.078125,y:261.056640625,step:1},{x:313.7415364583333,y:262.1491292317708,step:1},{x:314.9134318033854,y:263.91276041666663,step:1},{x:314.9134318033854,y:266.5592854817708,step:1},{x:314.9134318033854,y:270.7591145833333,step:1},{x:312.41861979166663,y:273.4049072265625,step:1},{x:309.1302083333333,y:274.58072916666663,step:1},{x:309.1302083333333,y:274.70703125,step:0},{x:310.642578125,y:275.46354166666663,step:1},{x:311.322265625,y:277.3098958333333,step:1},{x:311.54949951171875,y:279.8723958333333,step:1},{x:311.88930257161456,y:283.06510416666663,step:1},{x:312.078125,y:286.76041666666663,step:1},{x:312.53190104166663,y:287.9374593098958,step:1},{x:306.93752034505206,y:287.9374593098958,step:0},{x:306.7109375,y:287.18094889322913,step:1},{x:306.4466145833333,y:284.74479166666663,step:1},{x:306.21940104166663,y:281.2591145833333,step:1},{x:305.955078125,y:277.81510416666663,step:1},{x:304.89650472005206,y:276.765625,step:1},{x:302.7415364583333,y:276.765625,step:1},{x:301.07877604166663,y:276.765625,step:0},{x:299.1888020833333,y:287.9374593098958,step:0},{x:293.82096354166663,y:287.9374593098958,step:0},{x:298.583984375,y:260.1335042317708,step:0},{x:301.9101359049479,y:272.22855631510413,step:2},{x:304.1399739583333,y:272.22855631510413,step:0},{x:307.08917236328125,y:272.22855631510413,step:1},{x:309.24346923828125,y:270.25455729166663,step:1},{x:309.24346923828125,y:267.48246256510413,step:1},{x:309.24346923828125,y:265.1731770833333,step:1},{x:307.5423380533854,y:264.16471354166663,step:1},{x:305.35026041666663,y:264.16471354166663,step:1},{x:304.330078125,y:264.16471354166663,step:1},{x:303.6868693033854,y:264.24869791666663,step:1},{x:303.2337239583333,y:264.3749593098958,step:1},{x:301.9101359049479,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:327.236328125,y:288.3984375,step:2},{x:320.6210734049479,y:288.3984375,step:1},{x:316.91668701171875,y:283.19010416666663,step:1},{x:316.91668701171875,y:276.59635416666663,step:1},{x:316.91668701171875,y:271.47330729166663,step:1},{x:318.61783854166663,y:266.39127604166663,step:1},{x:321.603515625,y:263.19921875,step:1},{x:323.98502604166663,y:260.6790364583333,step:1},{x:327.236328125,y:259.16666666666663,step:1},{x:330.90236409505206,y:259.16666666666663,step:1},{x:337.63087972005206,y:259.16666666666663,step:1},{x:341.18424479166663,y:264.20703125,step:1},{x:341.18424479166663,y:270.9693603515625,step:1},{x:341.18424479166663,y:276.1354573567708,step:1},{x:339.55859375,y:281.17447916666663,step:1},{x:336.6477864583333,y:284.3255208333333,step:1},{x:334.2669270833333,y:286.8880615234375,step:1},{x:331.0540364583333,y:288.3984375,step:1},{x:327.2734375,y:288.3984375,step:1},{x:327.236328125,y:288.3984375,step:0},{x:328.02994791666663,y:283.35941569010413,step:2},{x:329.6555989583333,y:283.35941569010413,step:1},{x:331.12957763671875,y:282.6028645833333,step:1},{x:332.30143229166663,y:281.3021240234375,step:1},{x:334.3040364583333,y:279.0755208333333,step:1},{x:335.40104166666663,y:274.41276041666663,step:1},{x:335.40104166666663,y:271.13736979166663,step:1},{x:335.40104166666663,y:267.6087239583333,step:1},{x:334.2669270833333,y:264.20703125,step:1},{x:330.2597452799479,y:264.20703125,step:1},{x:328.55922444661456,y:264.20703125,step:1},{x:327.04689534505206,y:265.0045166015625,step:1},{x:325.8749796549479,y:266.34891764322913,step:1},{x:323.83400472005206,y:268.57486979166663,step:1},{x:322.69986979166663,y:272.9849853515625,step:1},{x:322.69986979166663,y:276.3880208333333,step:1},{x:322.69986979166663,y:280.3775634765625,step:1},{x:324.3255208333333,y:283.35941569010413,step:1},{x:327.99151611328125,y:283.35941569010413,step:1},{x:328.02994791666663,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:347.61002604166663,y:287.9374593098958,step:2},{x:344.435546875,y:259.6288655598958,step:0},{x:350.06705729166663,y:259.6288655598958,step:0},{x:351.201171875,y:273.1106770833333,step:0},{x:351.4661458333333,y:276.1354573567708,step:1},{x:351.6549886067708,y:278.8646240234375,step:1},{x:351.80594889322913,y:281.8046468098958,step:1},{x:351.88151041666663,y:281.8046468098958,step:0},{x:352.82682291666663,y:279.03385416666663,step:1},{x:354.03641764322913,y:276.0091552734375,step:1},{x:355.283203125,y:273.068359375,step:1},{x:360.9915771484375,y:259.6288655598958,step:0},{x:367.07743326822913,y:259.6288655598958,step:0},{x:353.9232177734375,y:287.9374593098958,step:0},{x:347.61002604166663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:381.7805989583333,y:275.88285319010413,step:2},{x:372.74674479166663,y:275.88285319010413,step:0},{x:371.5755208333333,y:282.7708333333333,step:0},{x:381.7434895833333,y:282.7708333333333,step:0},{x:380.87369791666663,y:287.9374593098958,step:0},{x:365.224609375,y:287.9374593098958,step:0},{x:370.06315104166663,y:259.6288655598958,step:0},{x:385.1451416015625,y:259.6288655598958,step:0},{x:384.2376708984375,y:264.79496256510413,step:0},{x:374.6366780598958,y:264.79496256510413,step:0},{x:373.57877604166663,y:270.8014729817708,step:0},{x:382.68815104166663,y:270.8014729817708,step:0},{x:381.7805989583333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:389.52994791666663,y:260.048828125,step:2},{x:391.7220052083333,y:259.6288655598958,step:1},{x:394.103515625,y:259.41861979166663,step:1},{x:396.5989990234375,y:259.41861979166663,step:1},{x:400.5677083333333,y:259.41861979166663,step:1},{x:403.705078125,y:260.42704264322913,step:1},{x:405.8593343098958,y:262.4849853515625,step:1},{x:407.93876139322913,y:264.33268229166663,step:1},{x:409.22391764322913,y:267.146484375,step:1},{x:409.22391764322913,y:271.3470052083333,step:1},{x:409.22391764322913,y:276.8073323567708,step:1},{x:407.1444905598958,y:281.5521240234375,step:1},{x:404.0071614583333,y:284.3671875,step:1},{x:401.05924479166663,y:287.01298014322913,step:1},{x:397.3170166015625,y:288.1458333333333,step:1},{x:391.7981770833333,y:288.1458333333333,step:1},{x:388.73636881510413,y:288.1458333333333,step:1},{x:386.0904541015625,y:287.85282389322913,step:1},{x:384.80533854166663,y:287.5598958333333,step:1},{x:389.52994791666663,y:260.048828125,step:0},{x:391.080078125,y:283.1067708333333,step:2},{x:391.7220052083333,y:283.19010416666663,step:1},{x:392.5162353515625,y:283.2317708333333,step:1},{x:393.4609375,y:283.2317708333333,step:1},{x:396.40946451822913,y:283.2317708333333,step:1},{x:399.017578125,y:282.0573323567708,step:1},{x:400.6809895833333,y:279.9569905598958,step:1},{x:402.4198811848958,y:277.7317708333333,step:1},{x:403.32682291666663,y:274.7916259765625,step:1},{x:403.32682291666663,y:271.38871256510413,step:1},{x:403.32682291666663,y:266.8952229817708,step:1},{x:401.0970052083333,y:264.24869791666663,step:1},{x:396.5989990234375,y:264.24869791666663,step:1},{x:395.6536865234375,y:264.24869791666663,step:1},{x:394.8600667317708,y:264.33268229166663,step:1},{x:394.2923583984375,y:264.458984375,step:1},{x:391.080078125,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],ZEe=[{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:329.54166666666663,y:287.13798014322913,step:2},{x:328.1810099283854,y:287.80985514322913,step:1},{x:325.91276041666663,y:288.35673014322913,step:1},{x:322.8515625,y:288.35673014322913,step:1},{x:316.0852864583333,y:288.35673014322913,step:1},{x:311.58660888671875,y:283.8203125,step:1},{x:311.58660888671875,y:276.3437093098958,step:1},{x:311.58660888671875,y:269.9609375,step:1},{x:314.15690104166663,y:265.046875,step:1},{x:318.0130411783854,y:262.1901448567708,step:1},{x:320.65885416666663,y:260.1745198567708,step:1},{x:323.75844319661456,y:259.2083333333333,step:1},{x:327.349609375,y:259.2083333333333,step:1},{x:330.1087443033854,y:259.2083333333333,step:1},{x:332.18817138671875,y:259.92191569010413,step:1},{x:332.943359375,y:260.38541666666663,step:1},{x:331.43166097005206,y:265.29947916666663,step:0},{x:330.71356201171875,y:264.8802490234375,step:1},{x:329.01236979166663,y:264.3749593098958,step:1},{x:326.8203125,y:264.3749593098958,step:1},{x:324.62760416666663,y:264.3749593098958,step:1},{x:322.5488077799479,y:265.1302083333333,step:1},{x:320.99867757161456,y:266.5598958333333,step:1},{x:318.8821614583333,y:268.4895833333333,step:1},{x:317.4837239583333,y:271.7239583333333,step:1},{x:317.4837239583333,y:275.6718343098958,step:1},{x:317.4837239583333,y:280.16666666666663,step:1},{x:319.78971354166663,y:283.19010416666663,step:1},{x:324.25002034505206,y:283.19010416666663,step:1},{x:326.064453125,y:283.19010416666663,step:1},{x:327.84051513671875,y:282.85416666666663,step:1},{x:329.087890625,y:282.265625,step:1},{x:329.54166666666663,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:342.9987386067708,y:288.3984375,step:2},{x:336.3841145833333,y:288.3984375,step:1},{x:332.67970784505206,y:283.19010416666663,step:1},{x:332.67970784505206,y:276.59635416666663,step:1},{x:332.67970784505206,y:271.4739990234375,step:1},{x:334.380859375,y:266.390625,step:1},{x:337.3665364583333,y:263.19791666666663,step:1},{x:339.74806722005206,y:260.6796875,step:1},{x:342.9987386067708,y:259.16666666666663,step:1},{x:346.6653645833333,y:259.16666666666663,step:1},{x:353.3938802083333,y:259.16666666666663,step:1},{x:356.94730631510413,y:264.2083333333333,step:1},{x:356.94730631510413,y:270.96875,step:1},{x:356.94730631510413,y:276.1354573567708,step:1},{x:355.3216145833333,y:281.17447916666663,step:1},{x:352.4107666015625,y:284.3255208333333,step:1},{x:350.0292561848958,y:286.8880615234375,step:1},{x:346.8170979817708,y:288.3984375,step:1},{x:343.0364583333333,y:288.3984375,step:1},{x:342.9987386067708,y:288.3984375,step:0},{x:343.79296875,y:283.35941569010413,step:2},{x:345.4185791015625,y:283.35941569010413,step:1},{x:346.892578125,y:282.6015625,step:1},{x:348.0638020833333,y:281.3021240234375,step:1},{x:350.06705729166663,y:279.0755208333333,step:1},{x:351.1634114583333,y:274.4140625,step:1},{x:351.1634114583333,y:271.13798014322913,step:1},{x:351.1634114583333,y:267.609375,step:1},{x:350.0292561848958,y:264.2083333333333,step:1},{x:346.0227864583333,y:264.2083333333333,step:1},{x:344.3216552734375,y:264.2083333333333,step:1},{x:342.8098958333333,y:265.00516764322913,step:1},{x:341.6380208333333,y:266.34891764322913,step:1},{x:339.5970052083333,y:268.5755208333333,step:1},{x:338.46291097005206,y:272.9843343098958,step:1},{x:338.46291097005206,y:276.3880208333333,step:1},{x:338.46291097005206,y:280.3775634765625,step:1},{x:340.087890625,y:283.35941569010413,step:1},{x:343.75455729166663,y:283.35941569010413,step:1},{x:343.79296875,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:379.5130208333333,y:287.9374593098958,step:2},{x:381.06315104166663,y:276.26041666666663,step:0},{x:381.478515625,y:273.1953125,step:1},{x:382.04557291666663,y:269.33072916666663,step:1},{x:382.76371256510413,y:265.2161865234375,step:1},{x:382.6503499348958,y:265.2161865234375,step:0},{x:381.2519124348958,y:268.8671875,step:1},{x:379.66471354166663,y:272.7734375,step:1},{x:378.26627604166663,y:275.88285319010413,step:1},{x:373.04886881510413,y:287.4739990234375,step:0},{x:368.8157958984375,y:287.4739990234375,step:0},{x:367.908203125,y:276.00785319010413,step:0},{x:367.68168131510413,y:272.90104166666663,step:1},{x:367.4928792317708,y:268.9948323567708,step:1},{x:367.34183756510413,y:265.2161865234375,step:1},{x:367.26627604166663,y:265.2161865234375,step:0},{x:366.54752604166663,y:268.953125,step:1},{x:365.79166666666663,y:273.2369384765625,step:1},{x:365.14908854166663,y:276.26041666666663,step:1},{x:362.6165364583333,y:287.9374593098958,step:0},{x:357.626953125,y:287.9374593098958,step:0},{x:364.0150146484375,y:259.6302083333333,step:0},{x:371.3105061848958,y:259.6302083333333,step:0},{x:372.10416666666663,y:270.42191569010413,step:0},{x:372.255859375,y:273.06766764322913,step:1},{x:372.5201416015625,y:276.26041666666663,step:1},{x:372.5579427083333,y:279.4114583333333,step:1},{x:372.708984375,y:279.4114583333333,step:0},{x:373.69205729166663,y:276.26041666666663,step:1},{x:375.052734375,y:272.9427083333333,step:1},{x:376.1491292317708,y:270.3802083333333,step:1},{x:380.87369791666663,y:259.6302083333333,step:0},{x:388.2447509765625,y:259.6302083333333,step:0},{x:384.80533854166663,y:287.9374593098958,step:0},{x:379.5130208333333,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:393.99027506510413,y:260.1328125,step:2},{x:395.6536865234375,y:259.6718343098958,step:1},{x:398.1862386067708,y:259.4192708333333,step:1},{x:400.64322916666663,y:259.4192708333333,step:1},{x:402.94921875,y:259.4192708333333,step:1},{x:405.5572509765625,y:259.83854166666663,step:1},{x:407.40946451822913,y:261.3098958333333,step:1},{x:409.1484375,y:262.56766764322913,step:1},{x:410.1692708333333,y:264.5859375,step:1},{x:410.1692708333333,y:267.31510416666663,step:1},{x:410.1692708333333,y:270.8854573567708,step:1},{x:408.6946614583333,y:273.6145833333333,step:1},{x:406.72855631510413,y:275.2942708333333,step:1},{x:404.6503499348958,y:277.1015625,step:1},{x:401.66410319010413,y:277.94010416666663,step:1},{x:398.5644124348958,y:277.94010416666663,step:1},{x:397.656982421875,y:277.94010416666663,step:1},{x:396.9010823567708,y:277.81510416666663,step:1},{x:396.333984375,y:277.7734375,step:1},{x:394.59574381510413,y:287.9374593098958,step:0},{x:389.26566569010413,y:287.9374593098958,step:0},{x:393.99027506510413,y:260.1328125,step:0},{x:397.1659749348958,y:272.8177083333333,step:2},{x:397.73246256510413,y:272.9427083333333,step:1},{x:398.337890625,y:273.02604166666663,step:1},{x:399.28251139322913,y:273.02604166666663,step:1},{x:402.5331624348958,y:273.02604166666663,step:1},{x:404.68815104166663,y:270.6745198567708,step:1},{x:404.68815104166663,y:267.859375,step:1},{x:404.68815104166663,y:265.1302083333333,step:1},{x:402.91141764322913,y:264.25,step:1},{x:400.8326416015625,y:264.25,step:1},{x:399.81180826822913,y:264.25,step:1},{x:399.05533854166663,y:264.3333333333333,step:1},{x:398.60221354166663,y:264.4167073567708,step:1},{x:397.1659749348958,y:272.8177083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:415.421875,y:259.6302083333333,step:2},{x:420.8645833333333,y:259.6302083333333,step:0},{x:416.9348958333333,y:282.64579264322913,step:0},{x:426.7239583333333,y:282.64579264322913,step:0},{x:425.8177083333333,y:287.9374593098958,step:0},{x:410.58329264322913,y:287.9374593098958,step:0},{x:415.421875,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.54947916666663,y:275.88285319010413,step:2},{x:436.515625,y:275.88285319010413,step:0},{x:435.3437093098958,y:282.7708333333333,step:0},{x:445.51041666666663,y:282.7708333333333,step:0},{x:444.6419270833333,y:287.9374593098958,step:0},{x:428.9921875,y:287.9374593098958,step:0},{x:433.83072916666663,y:259.6302083333333,step:0},{x:448.9127197265625,y:259.6302083333333,step:0},{x:448.00516764322913,y:264.7942708333333,step:0},{x:438.4036458333333,y:264.7942708333333,step:0},{x:437.34635416666663,y:270.8021240234375,step:0},{x:446.45572916666663,y:270.8021240234375,step:0},{x:445.54947916666663,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:457.0780843098958,y:264.92191569010413,step:2},{x:450.3489990234375,y:264.92191569010413,step:0},{x:451.2942708333333,y:259.6302083333333,step:0},{x:470.2317708333333,y:259.6302083333333,step:0},{x:469.32548014322913,y:264.92191569010413,step:0},{x:462.5208333333333,y:264.92191569010413,step:0},{x:458.58988444010413,y:287.9374593098958,step:0},{x:453.1458333333333,y:287.9374593098958,step:0},{x:457.0780843098958,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:485.0130208333333,y:275.88285319010413,step:2},{x:475.97782389322913,y:275.88285319010413,step:0},{x:474.8059895833333,y:282.7708333333333,step:0},{x:484.9739583333333,y:282.7708333333333,step:0},{x:484.10416666666663,y:287.9374593098958,step:0},{x:468.45572916666663,y:287.9374593098958,step:0},{x:473.2942708333333,y:259.6302083333333,step:0},{x:488.37504069010413,y:259.6302083333333,step:0},{x:487.46875,y:264.7942708333333,step:0},{x:477.8671875,y:264.7942708333333,step:0},{x:476.8098958333333,y:270.8021240234375,step:0},{x:485.9192708333333,y:270.8021240234375,step:0},{x:485.0130208333333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:492.76041666666663,y:260.04947916666663,step:2},{x:494.953125,y:259.6302083333333,step:1},{x:497.33463541666663,y:259.4192708333333,step:1},{x:499.8294270833333,y:259.4192708333333,step:1},{x:503.7981770833333,y:259.4192708333333,step:1},{x:506.9348958333333,y:260.42704264322913,step:1},{x:509.0911458333333,y:262.4843343098958,step:1},{x:511.1692708333333,y:264.3333333333333,step:1},{x:512.4544270833333,y:267.14579264322913,step:1},{x:512.4544270833333,y:271.34635416666663,step:1},{x:512.4544270833333,y:276.8073323567708,step:1},{x:510.37504069010413,y:281.5521240234375,step:1},{x:507.2382405598958,y:284.3671875,step:1},{x:504.28910319010413,y:287.01298014322913,step:1},{x:500.546875,y:288.1458333333333,step:1},{x:495.0286865234375,y:288.1458333333333,step:1},{x:491.9661458333333,y:288.1458333333333,step:1},{x:489.3203125,y:287.8515218098958,step:1},{x:488.03641764322913,y:287.5598958333333,step:1},{x:492.76041666666663,y:260.04947916666663,step:0},{x:494.3099365234375,y:283.1067708333333,step:2},{x:494.953125,y:283.19010416666663,step:1},{x:495.7473958333333,y:283.2317708333333,step:1},{x:496.6927083333333,y:283.2317708333333,step:1},{x:499.640625,y:283.2317708333333,step:1},{x:502.2473958333333,y:282.0573323567708,step:1},{x:503.91141764322913,y:279.95572916666663,step:1},{x:505.6510823567708,y:277.7317708333333,step:1},{x:506.5572509765625,y:274.7916259765625,step:1},{x:506.5572509765625,y:271.3880615234375,step:1},{x:506.5572509765625,y:266.8958740234375,step:1},{x:504.32816569010413,y:264.25,step:1},{x:499.8294270833333,y:264.25,step:1},{x:498.8841145833333,y:264.25,step:1},{x:498.0911458333333,y:264.3333333333333,step:1},{x:497.52347819010413,y:264.45829264322913,step:1},{x:494.3099365234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],e2e=[{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:306.875,y:287.13798014322913,step:2},{x:305.51434326171875,y:287.80985514322913,step:1},{x:303.24609375,y:288.35673014322913,step:1},{x:300.1848958333333,y:288.35673014322913,step:1},{x:293.41861979166663,y:288.35673014322913,step:1},{x:288.91994222005206,y:283.8203125,step:1},{x:288.91994222005206,y:276.3437093098958,step:1},{x:288.91994222005206,y:269.9609375,step:1},{x:291.490234375,y:265.046875,step:1},{x:295.34637451171875,y:262.1901448567708,step:1},{x:297.9921875,y:260.1745198567708,step:1},{x:301.0917765299479,y:259.2083333333333,step:1},{x:304.6829427083333,y:259.2083333333333,step:1},{x:307.44207763671875,y:259.2083333333333,step:1},{x:309.52150472005206,y:259.92191569010413,step:1},{x:310.2766927083333,y:260.38541666666663,step:1},{x:308.7649943033854,y:265.29947916666663,step:0},{x:308.04689534505206,y:264.8802490234375,step:1},{x:306.345703125,y:264.3749593098958,step:1},{x:304.1536458333333,y:264.3749593098958,step:1},{x:301.9609375,y:264.3749593098958,step:1},{x:299.88214111328125,y:265.1302083333333,step:1},{x:298.3320109049479,y:266.5598958333333,step:1},{x:296.21549479166663,y:268.4895833333333,step:1},{x:294.81705729166663,y:271.7239583333333,step:1},{x:294.81705729166663,y:275.6718343098958,step:1},{x:294.81705729166663,y:280.16666666666663,step:1},{x:297.123046875,y:283.19010416666663,step:1},{x:301.5833536783854,y:283.19010416666663,step:1},{x:303.3977864583333,y:283.19010416666663,step:1},{x:305.17384847005206,y:282.85416666666663,step:1},{x:306.4212239583333,y:282.265625,step:1},{x:306.875,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:320.3320109049479,y:288.3984375,step:2},{x:313.71744791666663,y:288.3984375,step:1},{x:310.0130411783854,y:283.19010416666663,step:1},{x:310.0130411783854,y:276.59635416666663,step:1},{x:310.0130411783854,y:271.4739990234375,step:1},{x:311.7141927083333,y:266.390625,step:1},{x:314.69986979166663,y:263.19791666666663,step:1},{x:317.0814005533854,y:260.6796875,step:1},{x:320.3320109049479,y:259.16666666666663,step:1},{x:323.99867757161456,y:259.16666666666663,step:1},{x:330.72721354166663,y:259.16666666666663,step:1},{x:334.28057861328125,y:264.2083333333333,step:1},{x:334.28057861328125,y:270.96875,step:1},{x:334.28057861328125,y:276.1354573567708,step:1},{x:332.65494791666663,y:281.17447916666663,step:1},{x:329.74416097005206,y:284.3255208333333,step:1},{x:327.3626505533854,y:286.8880615234375,step:1},{x:324.150390625,y:288.3984375,step:1},{x:320.36981201171875,y:288.3984375,step:1},{x:320.3320109049479,y:288.3984375,step:0},{x:321.1263020833333,y:283.35941569010413,step:2},{x:322.751953125,y:283.35941569010413,step:1},{x:324.2259114583333,y:282.6015625,step:1},{x:325.39711507161456,y:281.3021240234375,step:1},{x:327.400390625,y:279.0755208333333,step:1},{x:328.49676513671875,y:274.4140625,step:1},{x:328.49676513671875,y:271.13798014322913,step:1},{x:328.49676513671875,y:267.609375,step:1},{x:327.3626505533854,y:264.2083333333333,step:1},{x:323.35611979166663,y:264.2083333333333,step:1},{x:321.65494791666663,y:264.2083333333333,step:1},{x:320.14322916666663,y:265.00516764322913,step:1},{x:318.97135416666663,y:266.34891764322913,step:1},{x:316.93033854166663,y:268.5755208333333,step:1},{x:315.7962443033854,y:272.9843343098958,step:1},{x:315.7962443033854,y:276.3880208333333,step:1},{x:315.7962443033854,y:280.3775634765625,step:1},{x:317.4212239583333,y:283.35941569010413,step:1},{x:321.087890625,y:283.35941569010413,step:1},{x:321.1263020833333,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:335.56512451171875,y:287.9374593098958,step:2},{x:340.4036458333333,y:259.6302083333333,step:0},{x:346.79166666666663,y:259.6302083333333,step:0},{x:350.1556396484375,y:270.42191569010413,step:0},{x:351.17643229166663,y:274.03385416666663,step:1},{x:351.8573811848958,y:276.9739583333333,step:1},{x:352.46158854166663,y:280.0833740234375,step:1},{x:352.57486979166663,y:280.0833740234375,step:0},{x:352.6888427734375,y:277.18485514322913,step:1},{x:353.06640625,y:274.0755208333333,step:1},{x:353.74674479166663,y:269.9192708333333,step:1},{x:355.4857177734375,y:259.6302083333333,step:0},{x:360.58854166666663,y:259.6302083333333,step:0},{x:355.75,y:287.9374593098958,step:0},{x:350.11783854166663,y:287.9374593098958,step:0},{x:346.5650634765625,y:276.6380208333333,step:0},{x:345.4309895833333,y:272.7734375,step:1},{x:344.75065104166663,y:270.2135823567708,step:1},{x:344.0697021484375,y:266.7682698567708,step:1},{x:343.9563802083333,y:266.7682698567708,step:0},{x:343.69205729166663,y:269.54166666666663,step:1},{x:343.0872395833333,y:273.53129069010413,step:1},{x:342.3313802083333,y:278.0234375,step:1},{x:340.63087972005206,y:287.9374593098958,step:0},{x:335.56512451171875,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.57743326822913,y:259.6302083333333,step:2},{x:380.50846354166663,y:259.6302083333333,step:0},{x:379.6009521484375,y:264.7942708333333,step:0},{x:370.1516927083333,y:264.7942708333333,step:0},{x:368.9798177083333,y:271.42972819010413,step:0},{x:377.86258951822913,y:271.42972819010413,step:0},{x:376.9557698567708,y:276.51298014322913,step:0},{x:368.11063639322913,y:276.51298014322913,step:0},{x:366.1823323567708,y:287.9374593098958,step:0},{x:360.7395833333333,y:287.9374593098958,step:0},{x:365.57743326822913,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.22265625,y:259.6302083333333,step:2},{x:385.3847249348958,y:287.9374593098958,step:0},{x:379.94071451822913,y:287.9374593098958,step:0},{x:384.7792561848958,y:259.6302083333333,step:0},{x:390.22265625,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:395.1737874348958,y:260.04947916666663,step:2},{x:397.36649576822913,y:259.6302083333333,step:1},{x:399.748046875,y:259.4192708333333,step:1},{x:402.24283854166663,y:259.4192708333333,step:1},{x:406.21158854166663,y:259.4192708333333,step:1},{x:409.3489990234375,y:260.42704264322913,step:1},{x:411.50260416666663,y:262.4843343098958,step:1},{x:413.58329264322913,y:264.3333333333333,step:1},{x:414.8671875,y:267.14579264322913,step:1},{x:414.8671875,y:271.34635416666663,step:1},{x:414.8671875,y:276.8073323567708,step:1},{x:412.7890625,y:281.5521240234375,step:1},{x:409.6510823567708,y:284.3671875,step:1},{x:406.7030843098958,y:287.01298014322913,step:1},{x:402.9609375,y:288.1458333333333,step:1},{x:397.4420166015625,y:288.1458333333333,step:1},{x:394.380859375,y:288.1458333333333,step:1},{x:391.734375,y:287.8515218098958,step:1},{x:390.4491780598958,y:287.5598958333333,step:1},{x:395.1737874348958,y:260.04947916666663,step:0},{x:396.7239583333333,y:283.1067708333333,step:2},{x:397.36649576822913,y:283.19010416666663,step:1},{x:398.16015625,y:283.2317708333333,step:1},{x:399.10477701822913,y:283.2317708333333,step:1},{x:402.0540364583333,y:283.2317708333333,step:1},{x:404.662109375,y:282.0573323567708,step:1},{x:406.3249104817708,y:279.95572916666663,step:1},{x:408.0638020833333,y:277.7317708333333,step:1},{x:408.970703125,y:274.7916259765625,step:1},{x:408.970703125,y:271.3880615234375,step:1},{x:408.970703125,y:266.8958740234375,step:1},{x:406.74088541666663,y:264.25,step:1},{x:402.24283854166663,y:264.25,step:1},{x:401.2974853515625,y:264.25,step:1},{x:400.5038655598958,y:264.3333333333333,step:1},{x:399.9368489583333,y:264.45829264322913,step:1},{x:396.7239583333333,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:432.7096761067708,y:275.88285319010413,step:2},{x:423.67447916666663,y:275.88285319010413,step:0},{x:422.50260416666663,y:282.7708333333333,step:0},{x:432.6718343098958,y:282.7708333333333,step:0},{x:431.80204264322913,y:287.9374593098958,step:0},{x:416.1536865234375,y:287.9374593098958,step:0},{x:420.9921875,y:259.6302083333333,step:0},{x:436.07291666666663,y:259.6302083333333,step:0},{x:435.16666666666663,y:264.7942708333333,step:0},{x:425.56510416666663,y:264.7942708333333,step:0},{x:424.5077718098958,y:270.8021240234375,step:0},{x:433.61722819010413,y:270.8021240234375,step:0},{x:432.7096761067708,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:435.69535319010413,y:287.9374593098958,step:2},{x:440.53385416666663,y:259.6302083333333,step:0},{x:446.921875,y:259.6302083333333,step:0},{x:450.2864583333333,y:270.42191569010413,step:0},{x:451.3072509765625,y:274.03385416666663,step:1},{x:451.98697916666663,y:276.9739583333333,step:1},{x:452.59244791666663,y:280.0833740234375,step:1},{x:452.70572916666663,y:280.0833740234375,step:0},{x:452.8190511067708,y:277.18485514322913,step:1},{x:453.1978759765625,y:274.0755208333333,step:1},{x:453.87760416666663,y:269.9192708333333,step:1},{x:455.61722819010413,y:259.6302083333333,step:0},{x:460.71875,y:259.6302083333333,step:0},{x:455.8802083333333,y:287.9374593098958,step:0},{x:450.24869791666663,y:287.9374593098958,step:0},{x:446.6953125,y:276.6380208333333,step:0},{x:445.56119791666663,y:272.7734375,step:1},{x:444.8802083333333,y:270.2135823567708,step:1},{x:444.2005208333333,y:266.7682698567708,step:1},{x:444.0872395833333,y:266.7682698567708,step:0},{x:443.8228759765625,y:269.54166666666663,step:1},{x:443.21875,y:273.53129069010413,step:1},{x:442.4622802734375,y:278.0234375,step:1},{x:440.76041666666663,y:287.9374593098958,step:0},{x:435.69535319010413,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:469.4127197265625,y:264.92191569010413,step:2},{x:462.6848958333333,y:264.92191569010413,step:0},{x:463.6302490234375,y:259.6302083333333,step:0},{x:482.5677083333333,y:259.6302083333333,step:0},{x:481.65885416666663,y:264.92191569010413,step:0},{x:474.85550944010413,y:264.92191569010413,step:0},{x:470.92447916666663,y:287.9374593098958,step:0},{x:465.4818115234375,y:287.9374593098958,step:0},{x:469.4127197265625,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:490.9583740234375,y:259.6302083333333,step:2},{x:486.1197509765625,y:287.9374593098958,step:0},{x:480.67704264322913,y:287.9374593098958,step:0},{x:485.51566569010413,y:259.6302083333333,step:0},{x:490.9583740234375,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:498.1770833333333,y:280.5859375,step:2},{x:495.1913655598958,y:287.9374593098958,step:0},{x:489.3697509765625,y:287.9374593098958,step:0},{x:501.8072509765625,y:259.6302083333333,step:0},{x:508.79947916666663,y:259.6302083333333,step:0},{x:511.7473958333333,y:287.9374593098958,step:0},{x:506.0403645833333,y:287.9374593098958,step:0},{x:505.51041666666663,y:280.5859375,step:0},{x:498.1770833333333,y:280.5859375,step:0},{x:505.28385416666663,y:275.9661458333333,step:2},{x:504.79166666666663,y:269.87760416666663,step:0},{x:504.6796875,y:268.3229573567708,step:1},{x:504.5650634765625,y:266.05472819010413,step:1},{x:504.4530843098958,y:264.3333333333333,step:1},{x:504.3385009765625,y:264.3333333333333,step:0},{x:503.6966552734375,y:266.05472819010413,step:1},{x:502.9792073567708,y:268.2396240234375,step:1},{x:502.2981770833333,y:269.87760416666663,step:1},{x:499.80204264322913,y:275.9661458333333,step:0},{x:505.28385416666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:519.3463541666666,y:259.6302083333333,step:2},{x:524.7890625,y:259.6302083333333,step:0},{x:520.8568115234375,y:282.64579264322913,step:0},{x:530.6484375,y:282.64579264322913,step:0},{x:529.7395833333333,y:287.9374593098958,step:0},{x:514.5077718098958,y:287.9374593098958,step:0},{x:519.3463541666666,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],t2e=[{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:356.54886881510413,y:260.048828125,step:2},{x:358.7415364583333,y:259.6288655598958,step:1},{x:361.12308756510413,y:259.41861979166663,step:1},{x:363.61722819010413,y:259.41861979166663,step:1},{x:367.5865478515625,y:259.41861979166663,step:1},{x:370.7239583333333,y:260.42704264322913,step:1},{x:372.8782552083333,y:262.4849853515625,step:1},{x:374.9577229817708,y:264.33268229166663,step:1},{x:376.24283854166663,y:267.146484375,step:1},{x:376.24283854166663,y:271.3470052083333,step:1},{x:376.24283854166663,y:276.8073323567708,step:1},{x:374.1634114583333,y:281.5521240234375,step:1},{x:371.0267333984375,y:284.3671875,step:1},{x:368.07743326822913,y:287.01298014322913,step:1},{x:364.3352864583333,y:288.1458333333333,step:1},{x:358.8170979817708,y:288.1458333333333,step:1},{x:355.7552083333333,y:288.1458333333333,step:1},{x:353.10868326822913,y:287.85282389322913,step:1},{x:351.8235677083333,y:287.5598958333333,step:1},{x:356.54886881510413,y:260.048828125,step:0},{x:358.0989990234375,y:283.1067708333333,step:2},{x:358.7415364583333,y:283.19010416666663,step:1},{x:359.53515625,y:283.2317708333333,step:1},{x:360.47977701822913,y:283.2317708333333,step:1},{x:363.4284261067708,y:283.2317708333333,step:1},{x:366.0370686848958,y:282.0573323567708,step:1},{x:367.69986979166663,y:279.9569905598958,step:1},{x:369.4388020833333,y:277.7317708333333,step:1},{x:370.34574381510413,y:274.7916259765625,step:1},{x:370.34574381510413,y:271.38871256510413,step:1},{x:370.34574381510413,y:266.8952229817708,step:1},{x:368.1158447265625,y:264.24869791666663,step:1},{x:363.61722819010413,y:264.24869791666663,step:1},{x:362.67252604166663,y:264.24869791666663,step:1},{x:361.8782552083333,y:264.33268229166663,step:1},{x:361.31180826822913,y:264.458984375,step:1},{x:358.0989990234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:382.3288167317708,y:260.1335042317708,step:2},{x:384.0292561848958,y:259.67057291666663,step:1},{x:386.599609375,y:259.41861979166663,step:1},{x:389.1321614583333,y:259.41861979166663,step:1},{x:391.5520833333333,y:259.41861979166663,step:1},{x:394.0462239583333,y:259.79752604166663,step:1},{x:395.8228759765625,y:261.056640625,step:1},{x:397.48636881510413,y:262.1491292317708,step:1},{x:398.658203125,y:263.91276041666663,step:1},{x:398.658203125,y:266.5592854817708,step:1},{x:398.658203125,y:270.7591145833333,step:1},{x:396.1634114583333,y:273.4049072265625,step:1},{x:392.8743489583333,y:274.58072916666663,step:1},{x:392.8743489583333,y:274.70703125,step:0},{x:394.38671875,y:275.46354166666663,step:1},{x:395.06705729166663,y:277.3098958333333,step:1},{x:395.2942708333333,y:279.8723958333333,step:1},{x:395.6341145833333,y:283.06510416666663,step:1},{x:395.8228759765625,y:286.76041666666663,step:1},{x:396.2766927083333,y:287.9374593098958,step:1},{x:390.6823323567708,y:287.9374593098958,step:0},{x:390.45572916666663,y:287.18094889322913,step:1},{x:390.1907552083333,y:284.74479166666663,step:1},{x:389.96415201822913,y:281.2591145833333,step:1},{x:389.69921875,y:277.81510416666663,step:1},{x:388.6412353515625,y:276.765625,step:1},{x:386.486328125,y:276.765625,step:1},{x:384.8236083984375,y:276.765625,step:0},{x:382.9329427083333,y:287.9374593098958,step:0},{x:377.5657958984375,y:287.9374593098958,step:0},{x:382.3288167317708,y:260.1335042317708,step:0},{x:385.6549886067708,y:272.22855631510413,step:2},{x:387.88541666666663,y:272.22855631510413,step:0},{x:390.833984375,y:272.22855631510413,step:1},{x:392.9876708984375,y:270.25455729166663,step:1},{x:392.9876708984375,y:267.48246256510413,step:1},{x:392.9876708984375,y:265.1731770833333,step:1},{x:391.287109375,y:264.16471354166663,step:1},{x:389.0950520833333,y:264.16471354166663,step:1},{x:388.07421875,y:264.16471354166663,step:1},{x:387.431640625,y:264.24869791666663,step:1},{x:386.978515625,y:264.3749593098958,step:1},{x:385.6549886067708,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:406.9739583333333,y:280.5859375,step:2},{x:403.9876302083333,y:287.9374593098958,step:0},{x:398.1659749348958,y:287.9374593098958,step:0},{x:410.6028645833333,y:259.6288655598958,step:0},{x:417.59635416666663,y:259.6288655598958,step:0},{x:420.5442708333333,y:287.9374593098958,step:0},{x:414.8359375,y:287.9374593098958,step:0},{x:414.30729166666663,y:280.5859375,step:0},{x:406.9739583333333,y:280.5859375,step:0},{x:414.08072916666663,y:275.9661458333333,step:2},{x:413.58854166666663,y:269.8769124348958,step:0},{x:413.4753011067708,y:268.3229573567708,step:1},{x:413.36197916666663,y:266.0553792317708,step:1},{x:413.24869791666663,y:264.33268229166663,step:1},{x:413.1353759765625,y:264.33268229166663,step:0},{x:412.4921468098958,y:266.0553792317708,step:1},{x:411.7734375,y:268.2389729817708,step:1},{x:411.0937093098958,y:269.8769124348958,step:1},{x:408.599609375,y:275.9661458333333,step:0},{x:414.08072916666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:428.1419677734375,y:259.6288655598958,step:2},{x:443.07291666666663,y:259.6288655598958,step:0},{x:442.1653645833333,y:264.79496256510413,step:0},{x:432.71610514322913,y:264.79496256510413,step:0},{x:431.5442708333333,y:271.4309895833333,step:0},{x:440.42704264322913,y:271.4309895833333,step:0},{x:439.51822916666663,y:276.51298014322913,step:0},{x:430.67447916666663,y:276.51298014322913,step:0},{x:428.7460530598958,y:287.9374593098958,step:0},{x:423.3033447265625,y:287.9374593098958,step:0},{x:428.1419677734375,y:259.6288655598958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:451.1614583333333,y:264.9206136067708,step:2},{x:444.43229166666663,y:264.9206136067708,step:0},{x:445.37760416666663,y:259.6288655598958,step:0},{x:464.3151448567708,y:259.6288655598958,step:0},{x:463.40885416666663,y:264.9206136067708,step:0},{x:456.6041259765625,y:264.9206136067708,step:0},{x:452.6731770833333,y:287.9374593098958,step:0},{x:447.22916666666663,y:287.9374593098958,step:0},{x:451.1614583333333,y:264.9206136067708,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],n2e=[{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01236979166666,step:0},{x:347.61588541666663,y:248.14583333333331,step:1},{x:352.7974853515625,y:243.345703125,step:1},{x:359.1308186848958,y:243.345703125,step:1},{x:458.4973958333333,y:243.345703125,step:0},{x:464.83203125,y:243.345703125,step:1},{x:470.0130208333333,y:248.14583333333331,step:1},{x:470.0130208333333,y:254.01236979166666,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01302083333331,step:0},{x:347.61588541666663,y:248.14652506510416,step:1},{x:352.7974853515625,y:243.34635416666666,step:1},{x:359.1308186848958,y:243.34635416666666,step:1},{x:458.4973958333333,y:243.34635416666666,step:0},{x:464.83203125,y:243.34635416666666,step:1},{x:470.0130208333333,y:248.14652506510416,step:1},{x:470.0130208333333,y:254.01302083333331,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.95768229166663,y:259.62955729166663,step:2},{x:380.888671875,y:259.62955729166663,step:0},{x:379.9810791015625,y:264.79496256510413,step:0},{x:370.5318603515625,y:264.79496256510413,step:0},{x:369.36002604166663,y:271.431640625,step:0},{x:378.24283854166663,y:271.431640625,step:0},{x:377.3359375,y:276.51298014322913,step:0},{x:368.4908447265625,y:276.51298014322913,step:0},{x:366.5625,y:287.9374593098958,step:0},{x:361.1197509765625,y:287.9374593098958,step:0},{x:365.95768229166663,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.6028645833333,y:259.62955729166663,step:2},{x:385.76493326822913,y:287.9374593098958,step:0},{x:380.3210042317708,y:287.9374593098958,step:0},{x:385.1595052083333,y:259.62955729166663,step:0},{x:390.6028645833333,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.79166666666663,y:287.9374593098958,step:2},{x:395.62955729166663,y:259.62955729166663,step:0},{x:402.01822916666663,y:259.62955729166663,step:0},{x:405.3822021484375,y:270.423828125,step:0},{x:406.4030354817708,y:274.03641764322913,step:1},{x:407.0833333333333,y:276.9739583333333,step:1},{x:407.68815104166663,y:280.0833740234375,step:1},{x:407.8013916015625,y:280.0833740234375,step:0},{x:407.91471354166663,y:277.18485514322913,step:1},{x:408.29300944010413,y:274.078125,step:1},{x:408.97330729166663,y:269.91861979166663,step:1},{x:410.7109375,y:259.62955729166663,step:0},{x:415.81510416666663,y:259.62955729166663,step:0},{x:410.97660319010413,y:287.9374593098958,step:0},{x:405.34440104166663,y:287.9374593098958,step:0},{x:401.79166666666663,y:276.6380208333333,step:0},{x:400.6569417317708,y:272.775390625,step:1},{x:399.9771728515625,y:270.212890625,step:1},{x:399.2962239583333,y:266.7689208984375,step:1},{x:399.18290201822913,y:266.7689208984375,step:0},{x:398.9185791015625,y:269.541015625,step:1},{x:398.31315104166663,y:273.53129069010413,step:1},{x:397.5579427083333,y:278.0260823567708,step:1},{x:395.8567708333333,y:287.9374593098958,step:0},{x:390.79166666666663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.9974365234375,y:280.5859375,step:2},{x:420.0103759765625,y:287.9374593098958,step:0},{x:414.1888427734375,y:287.9374593098958,step:0},{x:426.625,y:259.62955729166663,step:0},{x:433.61722819010413,y:259.62955729166663,step:0},{x:436.5677083333333,y:287.9374593098958,step:0},{x:430.859375,y:287.9374593098958,step:0},{x:430.3294270833333,y:280.5859375,step:0},{x:422.9974365234375,y:280.5859375,step:0},{x:430.1028645833333,y:275.9661458333333,step:2},{x:429.61197916666663,y:269.8769124348958,step:0},{x:429.4973958333333,y:268.322265625,step:1},{x:429.38541666666663,y:266.0553792317708,step:1},{x:429.27079264322913,y:264.33268229166663,step:1},{x:429.15751139322913,y:264.33268229166663,step:0},{x:428.515625,y:266.0553792317708,step:1},{x:427.796875,y:268.2389729817708,step:1},{x:427.1171468098958,y:269.8769124348958,step:1},{x:424.6223958333333,y:275.9661458333333,step:0},{x:430.1028645833333,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:444.1640625,y:259.62955729166663,step:2},{x:449.6068115234375,y:259.62955729166663,step:0},{x:445.67704264322913,y:282.64579264322913,step:0},{x:455.4661458333333,y:282.64579264322913,step:0},{x:454.5598958333333,y:287.9374593098958,step:0},{x:439.32548014322913,y:287.9374593098958,step:0},{x:444.1640625,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],i2e=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,50,130,1)",background:"linear-gradient(to right bottom, #ccc2ff, #8677c7)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.35221354166663,y:267.82421875,step:2},{x:384.50846354166663,y:278.6067708333333,step:0},{x:382.435546875,y:278.6067708333333,step:0},{x:384.27799479166663,y:267.82421875,step:0},{x:386.35221354166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.4237874348958,y:278.6067708333333,step:2},{x:388.2669677734375,y:267.82421875,step:0},{x:390.7005208333333,y:267.82421875,step:0},{x:391.982421875,y:271.935546875,step:0},{x:392.37113444010413,y:273.3118489583333,step:1},{x:392.6302490234375,y:274.4322509765625,step:1},{x:392.8606770833333,y:275.6145833333333,step:1},{x:392.9036458333333,y:275.6145833333333,step:0},{x:392.94730631510413,y:274.51298014322913,step:1},{x:393.0911458333333,y:273.32816569010413,step:1},{x:393.3503011067708,y:271.744140625,step:1},{x:394.0124104817708,y:267.82421875,step:0},{x:395.9563802083333,y:267.82421875,step:0},{x:394.1132405598958,y:278.6067708333333,step:0},{x:391.9680989583333,y:278.6067708333333,step:0},{x:390.61393229166663,y:274.3046468098958,step:0},{x:390.1823323567708,y:272.83203125,step:1},{x:389.9232177734375,y:271.8561604817708,step:1},{x:389.66410319010413,y:270.5435791015625,step:1},{x:389.6204833984375,y:270.5435791015625,step:0},{x:389.52018229166663,y:271.599609375,step:1},{x:389.28971354166663,y:273.11979166666663,step:1},{x:389.0013020833333,y:274.83203125,step:1},{x:388.353515625,y:278.6067708333333,step:0},{x:386.4237874348958,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.88736979166663,y:267.82421875,step:2},{x:398.0442708333333,y:278.6067708333333,step:0},{x:395.970703125,y:278.6067708333333,step:0},{x:397.8138020833333,y:267.82421875,step:0},{x:399.88736979166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:403.2141927083333,y:269.83984375,step:2},{x:400.65104166666663,y:269.83984375,step:0},{x:401.0110677083333,y:267.82421875,step:0},{x:408.22526041666663,y:267.82421875,step:0},{x:407.87955729166663,y:269.83984375,step:0},{x:405.28776041666663,y:269.83984375,step:0},{x:403.7897542317708,y:278.6067708333333,step:0},{x:401.71610514322913,y:278.6067708333333,step:0},{x:403.2141927083333,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:411.421875,y:267.82421875,step:2},{x:409.5780843098958,y:278.6067708333333,step:0},{x:407.50455729166663,y:278.6067708333333,step:0},{x:409.3489990234375,y:267.82421875,step:0},{x:411.421875,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:414.1718343098958,y:275.80729166666663,step:2},{x:413.0338948567708,y:278.6067708333333,step:0},{x:410.8177490234375,y:278.6067708333333,step:0},{x:415.55472819010413,y:267.82421875,step:0},{x:418.21875,y:267.82421875,step:0},{x:419.3411458333333,y:278.6067708333333,step:0},{x:417.16666666666663,y:278.6067708333333,step:0},{x:416.9661458333333,y:275.80729166666663,step:0},{x:414.1718343098958,y:275.80729166666663,step:0},{x:416.8802083333333,y:274.04691569010413,step:2},{x:416.6927083333333,y:271.7278645833333,step:0},{x:416.6484375,y:271.1360677083333,step:1},{x:416.6054280598958,y:270.2714436848958,step:1},{x:416.5625,y:269.61588541666663,step:1},{x:416.5181884765625,y:269.61588541666663,step:0},{x:416.27347819010413,y:270.2714436848958,step:1},{x:416,y:271.1034749348958,step:1},{x:415.7421875,y:271.7278645833333,step:1},{x:414.79166666666663,y:274.04691569010413,step:0},{x:416.8802083333333,y:274.04691569010413,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.2357177734375,y:267.82421875,step:2},{x:424.3099365234375,y:267.82421875,step:0},{x:422.81254069010413,y:276.5911458333333,step:0},{x:426.5417073567708,y:276.5911458333333,step:0},{x:426.19535319010413,y:278.6067708333333,step:0},{x:420.39322916666663,y:278.6067708333333,step:0},{x:422.2357177734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],r2e=[{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,0.2)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:281.60611979166663,y:288,step:2},{x:286.44403076171875,y:259.69205729166663,step:0},{x:292.83270263671875,y:259.69205729166663,step:0},{x:296.1966145833333,y:270.4856770833333,step:0},{x:297.21744791666663,y:274.0989583333333,step:1},{x:297.89711507161456,y:277.0377197265625,step:1},{x:298.50260416666663,y:280.1458333333333,step:1},{x:298.61588541666663,y:280.1458333333333,step:0},{x:298.72914632161456,y:277.2473958333333,step:1},{x:299.10744222005206,y:274.14066569010413,step:1},{x:299.78774007161456,y:269.9817708333333,step:1},{x:301.52604166666663,y:259.69205729166663,step:0},{x:306.62957763671875,y:259.69205729166663,step:0},{x:301.791015625,y:288,step:0},{x:296.15887451171875,y:288,step:0},{x:292.60546875,y:276.70182291666663,step:0},{x:291.47137451171875,y:272.837890625,step:1},{x:290.791015625,y:270.27604166666663,step:1},{x:290.1106974283854,y:266.83203125,step:1},{x:289.99737548828125,y:266.83203125,step:0},{x:289.73305257161456,y:269.6041259765625,step:1},{x:289.12760416666663,y:273.59375,step:1},{x:288.3724161783854,y:278.0885823567708,step:1},{x:286.67057291666663,y:288,step:0},{x:281.60611979166663,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:318.19596354166663,y:288.4622395833333,step:2},{x:311.58074951171875,y:288.4622395833333,step:1},{x:307.8763020833333,y:283.25394694010413,step:1},{x:307.8763020833333,y:276.66015625,step:1},{x:307.8763020833333,y:271.5364583333333,step:1},{x:309.57682291666663,y:266.4544270833333,step:1},{x:312.56378173828125,y:263.26236979166663,step:1},{x:314.9446614583333,y:260.7421875,step:1},{x:318.19596354166663,y:259.2298177083333,step:1},{x:321.86195882161456,y:259.2298177083333,step:1},{x:328.5911458333333,y:259.2298177083333,step:1},{x:332.14322916666663,y:264.27018229166663,step:1},{x:332.14322916666663,y:271.0325520833333,step:1},{x:332.14322916666663,y:276.1979573567708,step:1},{x:330.51822916666663,y:281.2369384765625,step:1},{x:327.60805257161456,y:284.3880208333333,step:1},{x:325.2265421549479,y:286.9505615234375,step:1},{x:322.0136515299479,y:288.4622395833333,step:1},{x:318.23307291666663,y:288.4622395833333,step:1},{x:318.19596354166663,y:288.4622395833333,step:0},{x:318.9895833333333,y:283.42191569010413,step:2},{x:320.6145833333333,y:283.42191569010413,step:1},{x:322.08854166666663,y:282.66666666666663,step:1},{x:323.26041666666663,y:281.3645833333333,step:1},{x:325.26430257161456,y:279.13798014322913,step:1},{x:326.3606974283854,y:274.4765218098958,step:1},{x:326.3606974283854,y:271.2005208333333,step:1},{x:326.3606974283854,y:267.6718343098958,step:1},{x:325.2265421549479,y:264.27018229166663,step:1},{x:321.2200520833333,y:264.27018229166663,step:1},{x:319.51822916666663,y:264.27018229166663,step:1},{x:318.00649007161456,y:265.06766764322913,step:1},{x:316.83465576171875,y:266.412109375,step:1},{x:314.79361979166663,y:268.6380208333333,step:1},{x:313.65948486328125,y:273.0481770833333,step:1},{x:313.65948486328125,y:276.4505208333333,step:1},{x:313.65948486328125,y:280.44010416666663,step:1},{x:315.28515625,y:283.42191569010413,step:1},{x:318.95182291666663,y:283.42191569010413,step:1},{x:318.9895833333333,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:340.64906819661456,y:264.98368326822913,step:2},{x:333.92055257161456,y:264.98368326822913,step:0},{x:334.865234375,y:259.69205729166663,step:0},{x:353.8033447265625,y:259.69205729166663,step:0},{x:352.8958740234375,y:264.98368326822913,step:0},{x:346.091796875,y:264.98368326822913,step:0},{x:342.16080729166663,y:288,step:0},{x:336.71744791666663,y:288,step:0},{x:340.64906819661456,y:264.98368326822913,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:366.0124104817708,y:280.64969889322913,step:2},{x:363.02604166666663,y:288,step:0},{x:357.2044270833333,y:288,step:0},{x:369.640625,y:259.69205729166663,step:0},{x:376.6341145833333,y:259.69205729166663,step:0},{x:379.58203125,y:288,step:0},{x:373.8743489583333,y:288,step:0},{x:373.3450520833333,y:280.64969889322913,step:0},{x:366.0124104817708,y:280.64969889322913,step:0},{x:373.11844889322913,y:276.0299886067708,step:2},{x:372.626953125,y:269.94010416666663,step:0},{x:372.513671875,y:268.38602701822913,step:1},{x:372.400390625,y:266.1184895833333,step:1},{x:372.2864583333333,y:264.3958333333333,step:1},{x:372.1731770833333,y:264.3958333333333,step:0},{x:371.5305989583333,y:266.1184895833333,step:1},{x:370.81254069010413,y:268.3020833333333,step:1},{x:370.1321614583333,y:269.94010416666663,step:1},{x:367.63736979166663,y:276.0299886067708,step:0},{x:373.11844889322913,y:276.0299886067708,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:387.06640625,y:260.1966552734375,step:2},{x:388.7292073567708,y:259.7337239583333,step:1},{x:391.2624104817708,y:259.4818115234375,step:1},{x:393.71940104166663,y:259.4818115234375,step:1},{x:396.0247395833333,y:259.4818115234375,step:1},{x:398.63346354166663,y:259.90234375,step:1},{x:400.4856770833333,y:261.3723958333333,step:1},{x:402.22391764322913,y:262.6321614583333,step:1},{x:403.2447509765625,y:264.6477864583333,step:1},{x:403.2447509765625,y:267.37760416666663,step:1},{x:403.2447509765625,y:270.94791666666663,step:1},{x:401.77079264322913,y:273.6783447265625,step:1},{x:399.8052978515625,y:275.35807291666663,step:1},{x:397.7259114583333,y:277.1640625,step:1},{x:394.7395833333333,y:278.00394694010413,step:1},{x:391.6399739583333,y:278.00394694010413,step:1},{x:390.73307291666663,y:278.00394694010413,step:1},{x:389.9771728515625,y:277.87760416666663,step:1},{x:389.41015625,y:277.8359375,step:1},{x:387.6712239583333,y:288,step:0},{x:382.3411458333333,y:288,step:0},{x:387.06640625,y:260.1966552734375,step:0},{x:390.2415364583333,y:272.8802490234375,step:2},{x:390.80863444010413,y:273.0058186848958,step:1},{x:391.4134114583333,y:273.0898030598958,step:1},{x:392.35807291666663,y:273.0898030598958,step:1},{x:395.609375,y:273.0898030598958,step:1},{x:397.763671875,y:270.7382405598958,step:1},{x:397.763671875,y:267.92447916666663,step:1},{x:397.763671875,y:265.19401041666663,step:1},{x:395.98697916666663,y:264.3118489583333,step:1},{x:393.908203125,y:264.3118489583333,step:1},{x:392.8880615234375,y:264.3118489583333,step:1},{x:392.13151041666663,y:264.3958333333333,step:1},{x:391.67838541666663,y:264.4798177083333,step:1},{x:390.2415364583333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.3847249348958,y:260.1966552734375,step:2},{x:410.0481770833333,y:259.7337239583333,step:1},{x:412.58072916666663,y:259.4818115234375,step:1},{x:415.0378011067708,y:259.4818115234375,step:1},{x:417.3437093098958,y:259.4818115234375,step:1},{x:419.9517822265625,y:259.90234375,step:1},{x:421.8033447265625,y:261.3723958333333,step:1},{x:423.5417073567708,y:262.6321614583333,step:1},{x:424.5638020833333,y:264.6477864583333,step:1},{x:424.5638020833333,y:267.37760416666663,step:1},{x:424.5638020833333,y:270.94791666666663,step:1},{x:423.08854166666663,y:273.6783447265625,step:1},{x:421.12369791666663,y:275.35807291666663,step:1},{x:419.0442708333333,y:277.1640625,step:1},{x:416.05729166666663,y:278.00394694010413,step:1},{x:412.9583740234375,y:278.00394694010413,step:1},{x:412.0520833333333,y:278.00394694010413,step:1},{x:411.2956136067708,y:277.87760416666663,step:1},{x:410.7292073567708,y:277.8359375,step:1},{x:408.9896240234375,y:288,step:0},{x:403.66019694010413,y:288,step:0},{x:408.3847249348958,y:260.1966552734375,step:0},{x:411.5598958333333,y:272.8802490234375,step:2},{x:412.12760416666663,y:273.0058186848958,step:1},{x:412.7317708333333,y:273.0898030598958,step:1},{x:413.67704264322913,y:273.0898030598958,step:1},{x:416.9270833333333,y:273.0898030598958,step:1},{x:419.08203125,y:270.7382405598958,step:1},{x:419.08203125,y:267.92447916666663,step:1},{x:419.08203125,y:265.19401041666663,step:1},{x:417.3059895833333,y:264.3118489583333,step:1},{x:415.2265625,y:264.3118489583333,step:1},{x:414.20572916666663,y:264.3118489583333,step:1},{x:413.45048014322913,y:264.3958333333333,step:1},{x:412.9974365234375,y:264.4798177083333,step:1},{x:411.5598958333333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:429.77860514322913,y:260.1966552734375,step:2},{x:431.4792073567708,y:259.7337239583333,step:1},{x:434.0494384765625,y:259.4818115234375,step:1},{x:436.58329264322913,y:259.4818115234375,step:1},{x:439.00260416666663,y:259.4818115234375,step:1},{x:441.4973958333333,y:259.8606770833333,step:1},{x:443.2734375,y:261.11979166666663,step:1},{x:444.9362386067708,y:262.2122395833333,step:1},{x:446.10807291666663,y:263.9759114583333,step:1},{x:446.10807291666663,y:266.6223958333333,step:1},{x:446.10807291666663,y:270.82230631510413,step:1},{x:443.6145833333333,y:273.46879069010413,step:1},{x:440.3255208333333,y:274.64322916666663,step:1},{x:440.3255208333333,y:274.7708333333333,step:0},{x:441.83719889322913,y:275.5260823567708,step:1},{x:442.5181884765625,y:277.37369791666663,step:1},{x:442.7447509765625,y:279.93619791666663,step:1},{x:443.08463541666663,y:283.12760416666663,step:1},{x:443.2734375,y:286.82425944010413,step:1},{x:443.7265625,y:288,step:1},{x:438.1328125,y:288,step:0},{x:437.90625,y:287.24479166666663,step:1},{x:437.640625,y:284.8073323567708,step:1},{x:437.4140625,y:281.3229573567708,step:1},{x:437.1497395833333,y:277.87760416666663,step:1},{x:436.0911458333333,y:276.82816569010413,step:1},{x:433.9374593098958,y:276.82816569010413,step:1},{x:432.27347819010413,y:276.82816569010413,step:0},{x:430.3841145833333,y:288,step:0},{x:425.01566569010413,y:288,step:0},{x:429.77860514322913,y:260.1966552734375,step:0},{x:433.1054280598958,y:272.2916259765625,step:2},{x:435.3359375,y:272.2916259765625,step:0},{x:438.2838948567708,y:272.2916259765625,step:1},{x:440.43876139322913,y:270.31766764322913,step:1},{x:440.43876139322913,y:267.54557291666663,step:1},{x:440.43876139322913,y:265.2362874348958,step:1},{x:438.73697916666663,y:264.2279052734375,step:1},{x:436.5442708333333,y:264.2279052734375,step:1},{x:435.5247395833333,y:264.2279052734375,step:1},{x:434.88151041666663,y:264.3118489583333,step:1},{x:434.42838541666663,y:264.4381103515625,step:1},{x:433.1054280598958,y:272.2916259765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:458.43094889322913,y:288.4622395833333,step:2},{x:451.81510416666663,y:288.4622395833333,step:1},{x:448.1119384765625,y:283.25394694010413,step:1},{x:448.1119384765625,y:276.66015625,step:1},{x:448.1119384765625,y:271.5364583333333,step:1},{x:449.8125,y:266.4544270833333,step:1},{x:452.79947916666663,y:263.26236979166663,step:1},{x:455.1796468098958,y:260.7421875,step:1},{x:458.43094889322913,y:259.2298177083333,step:1},{x:462.09765625,y:259.2298177083333,step:1},{x:468.8255208333333,y:259.2298177083333,step:1},{x:472.3802083333333,y:264.27018229166663,step:1},{x:472.3802083333333,y:271.0325520833333,step:1},{x:472.3802083333333,y:276.1979573567708,step:1},{x:470.75390625,y:281.2369384765625,step:1},{x:467.8437093098958,y:284.3880208333333,step:1},{x:465.4622802734375,y:286.9505615234375,step:1},{x:462.24869791666663,y:288.4622395833333,step:1},{x:458.4687093098958,y:288.4622395833333,step:1},{x:458.43094889322913,y:288.4622395833333,step:0},{x:459.22391764322913,y:283.42191569010413,step:2},{x:460.85026041666663,y:283.42191569010413,step:1},{x:462.32421875,y:282.66666666666663,step:1},{x:463.49609375,y:281.3645833333333,step:1},{x:465.5,y:279.13798014322913,step:1},{x:466.59635416666663,y:274.4765218098958,step:1},{x:466.59635416666663,y:271.2005208333333,step:1},{x:466.59635416666663,y:267.6718343098958,step:1},{x:465.4622802734375,y:264.27018229166663,step:1},{x:461.45572916666663,y:264.27018229166663,step:1},{x:459.75390625,y:264.27018229166663,step:1},{x:458.2421875,y:265.06766764322913,step:1},{x:457.0703125,y:266.412109375,step:1},{x:455.0286865234375,y:268.6380208333333,step:1},{x:453.8958333333333,y:273.0481770833333,step:1},{x:453.8958333333333,y:276.4505208333333,step:1},{x:453.8958333333333,y:280.44010416666663,step:1},{x:455.5208740234375,y:283.42191569010413,step:1},{x:459.1875,y:283.42191569010413,step:1},{x:459.22391764322913,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:478.8046875,y:288,step:2},{x:475.6302490234375,y:259.69205729166663,step:0},{x:481.2630208333333,y:259.69205729166663,step:0},{x:482.3958740234375,y:273.1737874348958,step:0},{x:482.6614583333333,y:276.1979573567708,step:1},{x:482.8489990234375,y:278.9284261067708,step:1},{x:483.0013020833333,y:281.8684895833333,step:1},{x:483.07682291666663,y:281.8684895833333,step:0},{x:484.0208740234375,y:279.09635416666663,step:1},{x:485.23173014322913,y:276.07291666666663,step:1},{x:486.47916666666663,y:273.13151041666663,step:1},{x:492.1862386067708,y:259.69205729166663,step:0},{x:498.27213541666663,y:259.69205729166663,step:0},{x:485.1171468098958,y:288,step:0},{x:478.8046875,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:512.9766031901041,y:275.9466145833333,step:2},{x:503.94266764322913,y:275.9466145833333,step:0},{x:502.7708333333333,y:282.8333333333333,step:0},{x:512.9388020833333,y:282.8333333333333,step:0},{x:512.0690104166666,y:288,step:0},{x:496.4192708333333,y:288,step:0},{x:501.2578125,y:259.69205729166663,step:0},{x:516.3411458333333,y:259.69205729166663,step:0},{x:515.4323323567708,y:264.85807291666663,step:0},{x:505.83203125,y:264.85807291666663,step:0},{x:504.7734375,y:270.8646240234375,step:0},{x:513.8828125,y:270.8646240234375,step:0},{x:512.9766031901041,y:275.9466145833333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:520.7252604166666,y:260.1119384765625,step:2},{x:522.9166259765625,y:259.69205729166663,step:1},{x:525.2994791666666,y:259.4818115234375,step:1},{x:527.7942708333333,y:259.4818115234375,step:1},{x:531.7630208333333,y:259.4818115234375,step:1},{x:534.8997395833333,y:260.4901936848958,step:1},{x:537.0547281901041,y:262.5482177734375,step:1},{x:539.1340738932291,y:264.3958333333333,step:1},{x:540.4192708333333,y:267.20963541666663,step:1},{x:540.4192708333333,y:271.4101155598958,step:1},{x:540.4192708333333,y:276.86979166666663,step:1},{x:538.33984375,y:281.61588541666663,step:1},{x:535.203125,y:284.4296875,step:1},{x:532.25390625,y:287.0755208333333,step:1},{x:528.5116780598958,y:288.20963541666663,step:1},{x:522.9935302734375,y:288.20963541666663,step:1},{x:519.9309895833333,y:288.20963541666663,step:1},{x:517.2851155598958,y:287.91666666666663,step:1},{x:516,y:287.6223958333333,step:1},{x:520.7252604166666,y:260.1119384765625,step:0},{x:522.2747802734375,y:283.1692708333333,step:2},{x:522.9166259765625,y:283.25394694010413,step:1},{x:523.7109375,y:283.29557291666663,step:1},{x:524.65625,y:283.29557291666663,step:1},{x:527.6041666666666,y:283.29557291666663,step:1},{x:530.2135416666666,y:282.11979166666663,step:1},{x:531.8763020833333,y:280.0208333333333,step:1},{x:533.6145833333333,y:277.7942708333333,step:1},{x:534.5221354166666,y:274.85416666666663,step:1},{x:534.5221354166666,y:271.45182291666663,step:1},{x:534.5221354166666,y:266.95829264322913,step:1},{x:532.2917073567708,y:264.3118489583333,step:1},{x:527.7942708333333,y:264.3118489583333,step:1},{x:526.8489990234375,y:264.3118489583333,step:1},{x:526.0547281901041,y:264.3958333333333,step:1},{x:525.4870198567708,y:264.52213541666663,step:1},{x:522.2747802734375,y:283.1692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],o2e=[{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #f89077, #b21f10)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],s2e=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(110,0,5,1)",background:"linear-gradient(to right bottom, #f89077, #cc4a31)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:397.2669270833333,y:276.1119384765625,step:2},{x:397.8430989583333,y:276.4791259765625,step:1},{x:398.64908854166663,y:276.78385416666663,step:1},{x:399.556640625,y:276.78385416666663,step:1},{x:400.3483479817708,y:276.78385416666663,step:1},{x:401.08268229166663,y:276.3671875,step:1},{x:401.08268229166663,y:275.5364583333333,step:1},{x:401.08268229166663,y:274.9114583333333,step:1},{x:400.6653645833333,y:274.5286458333333,step:1},{x:399.77274576822913,y:274,step:1},{x:398.75,y:273.3919270833333,step:1},{x:397.77079264322913,y:272.5598958333333,step:1},{x:397.77079264322913,y:271.16796875,step:1},{x:397.77079264322913,y:268.9921875,step:1},{x:399.4700520833333,y:267.6640625,step:1},{x:401.5865478515625,y:267.6640625,step:1},{x:402.75321451822913,y:267.6640625,step:1},{x:403.44462076822913,y:267.95182291666663,step:1},{x:403.86258951822913,y:268.1920979817708,step:1},{x:403.2141927083333,y:270.111328125,step:0},{x:402.8977864583333,y:269.919921875,step:1},{x:402.220703125,y:269.6314697265625,step:1},{x:401.4140625,y:269.6477864583333,step:1},{x:400.4491780598958,y:269.6477864583333,step:1},{x:399.9452718098958,y:270.17582194010413,step:1},{x:399.9452718098958,y:270.767578125,step:1},{x:399.9452718098958,y:271.3919270833333,step:1},{x:400.53580729166663,y:271.775390625,step:1},{x:401.35611979166663,y:272.28776041666663,step:1},{x:402.53776041666663,y:272.9759114583333,step:1},{x:403.2720947265625,y:273.83984375,step:1},{x:403.2720947265625,y:275.13541666666663,step:1},{x:403.2720947265625,y:277.5364583333333,step:1},{x:401.48636881510413,y:278.7682698567708,step:1},{x:399.34049479166663,y:278.7682698567708,step:1},{x:398.0013020833333,y:278.75260416666663,step:1},{x:397.0221761067708,y:278.3671875,step:1},{x:396.5755208333333,y:278,step:1},{x:397.2669270833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.052734375,y:267.82421875,step:2},{x:406.20963541666663,y:278.6067708333333,step:0},{x:404.1361083984375,y:278.6067708333333,step:0},{x:405.97916666666663,y:267.82421875,step:0},{x:408.052734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:416.1302083333333,y:278.1119384765625,step:2},{x:415.3958740234375,y:278.3827718098958,step:1},{x:414.2161458333333,y:278.71879069010413,step:1},{x:412.9921875,y:278.71879069010413,step:1},{x:411.66666666666663,y:278.71879069010413,step:1},{x:410.5572509765625,y:278.3358968098958,step:1},{x:409.765625,y:277.5364583333333,step:1},{x:408.98832194010413,y:276.78385416666663,step:1},{x:408.5423177083333,y:275.5833333333333,step:1},{x:408.5423177083333,y:274.2083333333333,step:1},{x:408.5423177083333,y:272.1920979817708,step:1},{x:409.27665201822913,y:270.44791666666663,step:1},{x:410.515625,y:269.279296875,step:1},{x:411.609375,y:268.2714436848958,step:1},{x:413.12109375,y:267.7115478515625,step:1},{x:414.8059895833333,y:267.7115478515625,step:1},{x:416.05859375,y:267.7115478515625,step:1},{x:416.9948323567708,y:267.98368326822913,step:1},{x:417.3697509765625,y:268.1920979817708,step:1},{x:416.75,y:270.1438802083333,step:0},{x:416.3177490234375,y:269.919921875,step:1},{x:415.55472819010413,y:269.69596354166663,step:1},{x:414.69010416666663,y:269.69596354166663,step:1},{x:413.7265625,y:269.69596354166663,step:1},{x:412.8763020833333,y:270,step:1},{x:412.2292073567708,y:270.5598958333333,step:1},{x:411.37890625,y:271.29557291666663,step:1},{x:410.8177490234375,y:272.57621256510413,step:1},{x:410.8177490234375,y:274.04691569010413,step:1},{x:410.8177490234375,y:275.8567708333333,step:1},{x:411.7812093098958,y:276.7682698567708,step:1},{x:413.3072509765625,y:276.7682698567708,step:1},{x:413.796875,y:276.7682698567708,step:1},{x:414.12894694010413,y:276.6875,step:1},{x:414.37504069010413,y:276.5755208333333,step:1},{x:414.7630615234375,y:274.3046468098958,step:0},{x:413.2499593098958,y:274.3046468098958,step:0},{x:413.58203125,y:272.46354166666663,step:0},{x:417.109375,y:272.46354166666663,step:0},{x:416.1302083333333,y:278.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:417.81510416666663,y:278.6067708333333,step:2},{x:419.65885416666663,y:267.82421875,step:0},{x:422.09244791666663,y:267.82421875,step:0},{x:423.37504069010413,y:271.935546875,step:0},{x:423.7630208333333,y:273.3118489583333,step:1},{x:424.0221761067708,y:274.4322509765625,step:1},{x:424.25260416666663,y:275.6145833333333,step:1},{x:424.2956136067708,y:275.6145833333333,step:0},{x:424.3385009765625,y:274.51298014322913,step:1},{x:424.4817708333333,y:273.32816569010413,step:1},{x:424.7421875,y:271.744140625,step:1},{x:425.4036458333333,y:267.82421875,step:0},{x:427.3489990234375,y:267.82421875,step:0},{x:425.50516764322913,y:278.6067708333333,step:0},{x:423.359375,y:278.6067708333333,step:0},{x:422.00516764322913,y:274.3046468098958,step:0},{x:421.5729573567708,y:272.83203125,step:1},{x:421.31510416666663,y:271.8561604817708,step:1},{x:421.05472819010413,y:270.5435791015625,step:1},{x:421.0130208333333,y:270.5435791015625,step:0},{x:420.91141764322913,y:271.599609375,step:1},{x:420.6809895833333,y:273.11979166666663,step:1},{x:420.39322916666663,y:274.83203125,step:1},{x:419.7447509765625,y:278.6067708333333,step:0},{x:417.81510416666663,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],a2e=[{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:371.2519124348958,y:286.9765625,step:2},{x:368.0761311848958,y:258.6692708333333,step:0},{x:373.708984375,y:258.6692708333333,step:0},{x:374.84183756510413,y:272.15043131510413,step:0},{x:375.1073811848958,y:275.17447916666663,step:1},{x:375.2962239583333,y:277.90360514322913,step:1},{x:375.447265625,y:280.8450520833333,step:1},{x:375.5228271484375,y:280.8450520833333,step:0},{x:376.46805826822913,y:278.07291666666663,step:1},{x:377.677734375,y:275.0494384765625,step:1},{x:378.923828125,y:272.1087239583333,step:1},{x:384.6321614583333,y:258.6692708333333,step:0},{x:390.71805826822913,y:258.6692708333333,step:0},{x:377.564453125,y:286.9765625,step:0},{x:371.2519124348958,y:286.9765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.7519124348958,y:287.4388427734375,step:2},{x:393.1373291015625,y:287.4388427734375,step:1},{x:389.4329427083333,y:282.2318115234375,step:1},{x:389.4329427083333,y:275.63798014322913,step:1},{x:389.4329427083333,y:270.51298014322913,step:1},{x:391.1347249348958,y:265.4309895833333,step:1},{x:394.1204427083333,y:262.2389729817708,step:1},{x:396.501953125,y:259.7193603515625,step:1},{x:399.7519124348958,y:258.20768229166663,step:1},{x:403.4185791015625,y:258.20768229166663,step:1},{x:410.14847819010413,y:258.20768229166663,step:1},{x:413.7005615234375,y:263.2473958333333,step:1},{x:413.7005615234375,y:270.0091552734375,step:1},{x:413.7005615234375,y:275.17447916666663,step:1},{x:412.0755208333333,y:280.2161865234375,step:1},{x:409.1634114583333,y:283.3645833333333,step:1},{x:406.7831624348958,y:285.9270833333333,step:1},{x:403.5697021484375,y:287.4388427734375,step:1},{x:399.791015625,y:287.4388427734375,step:1},{x:399.7519124348958,y:287.4388427734375,step:0},{x:400.5462239583333,y:282.3984375,step:2},{x:402.1712239583333,y:282.3984375,step:1},{x:403.646484375,y:281.64322916666663,step:1},{x:404.818359375,y:280.3411458333333,step:1},{x:406.8210042317708,y:278.1145833333333,step:1},{x:407.91727701822913,y:273.453125,step:1},{x:407.91727701822913,y:270.1771240234375,step:1},{x:407.91727701822913,y:266.64908854166663,step:1},{x:406.7831624348958,y:263.2473958333333,step:1},{x:402.7753499348958,y:263.2473958333333,step:1},{x:401.0761311848958,y:263.2473958333333,step:1},{x:399.5631917317708,y:264.044921875,step:1},{x:398.39127604166663,y:265.38871256510413,step:1},{x:396.3509114583333,y:267.6145833333333,step:1},{x:395.21683756510413,y:272.0247395833333,step:1},{x:395.21683756510413,y:275.4270833333333,step:1},{x:395.21683756510413,y:279.4167073567708,step:1},{x:396.84183756510413,y:282.3984375,step:1},{x:400.50846354166663,y:282.3984375,step:1},{x:400.5462239583333,y:282.3984375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:425.1536458333333,y:258.6692708333333,step:2},{x:420.3151448567708,y:286.9765625,step:0},{x:414.8723958333333,y:286.9765625,step:0},{x:419.7109375,y:258.6692708333333,step:0},{x:425.1536458333333,y:258.6692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:430.10416666666663,y:259.0892333984375,step:2},{x:432.29691569010413,y:258.6692708333333,step:1},{x:434.6796875,y:258.458984375,step:1},{x:437.1744384765625,y:258.458984375,step:1},{x:441.1431884765625,y:258.458984375,step:1},{x:444.2786458333333,y:259.46683756510413,step:1},{x:446.43485514322913,y:261.5247395833333,step:1},{x:448.51298014322913,y:263.373046875,step:1},{x:449.79947916666663,y:266.1868896484375,step:1},{x:449.79947916666663,y:270.38736979166663,step:1},{x:449.79947916666663,y:275.8463134765625,step:1},{x:447.71875,y:280.59375,step:1},{x:444.58072916666663,y:283.40625,step:1},{x:441.6328125,y:286.0521240234375,step:1},{x:437.8905843098958,y:287.1874593098958,step:1},{x:432.3724365234375,y:287.1874593098958,step:1},{x:429.3098958333333,y:287.1874593098958,step:1},{x:426.6640625,y:286.89322916666663,step:1},{x:425.3802083333333,y:286.5989583333333,step:1},{x:430.10416666666663,y:259.0892333984375,step:0},{x:431.6536865234375,y:282.1458333333333,step:2},{x:432.29691569010413,y:282.2318115234375,step:1},{x:433.0911458333333,y:282.2734375,step:1},{x:434.03641764322913,y:282.2734375,step:1},{x:436.98441569010413,y:282.2734375,step:1},{x:439.59375,y:281.09635416666663,step:1},{x:441.2552083333333,y:278.9973958333333,step:1},{x:442.9948323567708,y:276.7708333333333,step:1},{x:443.90104166666663,y:273.83072916666663,step:1},{x:443.90104166666663,y:270.42899576822913,step:1},{x:443.90104166666663,y:265.9348958333333,step:1},{x:441.6718343098958,y:263.28971354166663,step:1},{x:437.1744384765625,y:263.28971354166663,step:1},{x:436.2292073567708,y:263.28971354166663,step:1},{x:435.4348958333333,y:263.373046875,step:1},{x:434.8671875,y:263.4993489583333,step:1},{x:431.6536865234375,y:282.1458333333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],l2e=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(213,177,66,1)",background:"linear-gradient(to right bottom, #f7fc93, #f8fb4f)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:409.1328125,y:278.6067708333333,step:2},{x:408.75846354166663,y:267.82421875,step:0},{x:410.8606770833333,y:267.82421875,step:0},{x:410.8606770833333,y:272.6236572265625,step:0},{x:410.8606770833333,y:273.9348958333333,step:1},{x:410.83203125,y:275.1510009765625,step:1},{x:410.80338541666663,y:276.12760416666663,step:1},{x:410.83203125,y:276.12760416666663,step:0},{x:411.17704264322913,y:275.07157389322913,step:1},{x:411.52347819010413,y:273.9674886067708,step:1},{x:411.96875,y:272.6555989583333,step:1},{x:413.7109375,y:267.82421875,step:0},{x:415.98697916666663,y:267.82421875,step:0},{x:415.9583333333333,y:272.6399739583333,step:0},{x:415.9439697265625,y:273.9348958333333,step:1},{x:415.9140625,y:275.0078125,step:1},{x:415.8567708333333,y:276.0638020833333,step:1},{x:415.88541666666663,y:276.0638020833333,step:0},{x:416.21744791666663,y:274.9427083333333,step:1},{x:416.5780843098958,y:273.7916259765625,step:1},{x:416.9661458333333,y:272.6236572265625,step:1},{x:418.6366780598958,y:267.82421875,step:0},{x:420.8255208333333,y:267.82421875,step:0},{x:416.54947916666663,y:278.6067708333333,step:0},{x:414.28910319010413,y:278.6067708333333,step:0},{x:414.23050944010413,y:274.1927490234375,step:0},{x:414.2161458333333,y:272.912109375,step:1},{x:414.2447509765625,y:271.82421875,step:1},{x:414.3020833333333,y:270.607421875,step:1},{x:414.27347819010413,y:270.607421875,step:0},{x:413.9270833333333,y:271.759765625,step:1},{x:413.58203125,y:272.927734375,step:1},{x:413.1067708333333,y:274.2396240234375,step:1},{x:411.4375,y:278.6067708333333,step:0},{x:409.1328125,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:424.0234375,y:267.82421875,step:2},{x:422.1796875,y:278.6067708333333,step:0},{x:420.10546875,y:278.6067708333333,step:0},{x:421.9478759765625,y:267.82421875,step:0},{x:424.0234375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:427.3489990234375,y:269.83984375,step:2},{x:424.7851155598958,y:269.83984375,step:0},{x:425.1458333333333,y:267.82421875,step:0},{x:432.359375,y:267.82421875,step:0},{x:432.01432291666663,y:269.83984375,step:0},{x:429.421875,y:269.83984375,step:0},{x:427.92447916666663,y:278.6067708333333,step:0},{x:425.8515218098958,y:278.6067708333333,step:0},{x:427.3489990234375,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:431.6823323567708,y:278.6067708333333,step:2},{x:433.52604166666663,y:267.82421875,step:0},{x:435.95963541666663,y:267.82421875,step:0},{x:437.2421875,y:271.935546875,step:0},{x:437.6302490234375,y:273.3118489583333,step:1},{x:437.88932291666663,y:274.4322509765625,step:1},{x:438.1197509765625,y:275.6145833333333,step:1},{x:438.16276041666663,y:275.6145833333333,step:0},{x:438.20572916666663,y:274.51298014322913,step:1},{x:438.3503011067708,y:273.32816569010413,step:1},{x:438.6093343098958,y:271.744140625,step:1},{x:439.27079264322913,y:267.82421875,step:0},{x:441.2161458333333,y:267.82421875,step:0},{x:439.3723958333333,y:278.6067708333333,step:0},{x:437.2265625,y:278.6067708333333,step:0},{x:435.8723958333333,y:274.3046468098958,step:0},{x:435.44010416666663,y:272.83203125,step:1},{x:435.18229166666663,y:271.8561604817708,step:1},{x:434.921875,y:270.5435791015625,step:1},{x:434.8802083333333,y:270.5435791015625,step:0},{x:434.77860514322913,y:271.599609375,step:1},{x:434.5481770833333,y:273.11979166666663,step:1},{x:434.26041666666663,y:274.83203125,step:1},{x:433.61197916666663,y:278.6067708333333,step:0},{x:431.6823323567708,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:447.58072916666663,y:274.015625,step:2},{x:444.1380208333333,y:274.015625,step:0},{x:443.6927083333333,y:276.640625,step:0},{x:447.56510416666663,y:276.640625,step:0},{x:447.234375,y:278.6067708333333,step:0},{x:441.2734375,y:278.6067708333333,step:0},{x:443.1171468098958,y:267.82421875,step:0},{x:448.8620198567708,y:267.82421875,step:0},{x:448.515625,y:269.7916259765625,step:0},{x:444.859375,y:269.7916259765625,step:0},{x:444.45572916666663,y:272.08011881510413,step:0},{x:447.92578125,y:272.08011881510413,step:0},{x:447.58072916666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:449.1497395833333,y:276.1119384765625,step:2},{x:449.7265625,y:276.4791259765625,step:1},{x:450.5312093098958,y:276.78385416666663,step:1},{x:451.44010416666663,y:276.78385416666663,step:1},{x:452.2317708333333,y:276.78385416666663,step:1},{x:452.9661458333333,y:276.3671875,step:1},{x:452.9661458333333,y:275.5364583333333,step:1},{x:452.9661458333333,y:274.9114583333333,step:1},{x:452.546875,y:274.5286458333333,step:1},{x:451.65629069010413,y:274,step:1},{x:450.6328125,y:273.3919270833333,step:1},{x:449.6536865234375,y:272.5598958333333,step:1},{x:449.6536865234375,y:271.16796875,step:1},{x:449.6536865234375,y:268.9921875,step:1},{x:451.3529052734375,y:267.6640625,step:1},{x:453.46875,y:267.6640625,step:1},{x:454.63541666666663,y:267.6640625,step:1},{x:455.328125,y:267.95182291666663,step:1},{x:455.7447509765625,y:268.1920979817708,step:1},{x:455.09635416666663,y:270.111328125,step:0},{x:454.7812093098958,y:269.919921875,step:1},{x:454.10416666666663,y:269.6314697265625,step:1},{x:453.29691569010413,y:269.6477864583333,step:1},{x:452.33207194010413,y:269.6477864583333,step:1},{x:451.828125,y:270.17582194010413,step:1},{x:451.828125,y:270.767578125,step:1},{x:451.828125,y:271.3919270833333,step:1},{x:452.4192708333333,y:271.775390625,step:1},{x:453.2395833333333,y:272.28776041666663,step:1},{x:454.4192708333333,y:272.9759114583333,step:1},{x:455.1536458333333,y:273.83984375,step:1},{x:455.1536458333333,y:275.13541666666663,step:1},{x:455.1536458333333,y:277.5364583333333,step:1},{x:453.3697509765625,y:278.7682698567708,step:1},{x:451.22391764322913,y:278.7682698567708,step:1},{x:449.8841145833333,y:278.75260416666663,step:1},{x:448.90494791666663,y:278.3671875,step:1},{x:448.4583333333333,y:278,step:1},{x:449.1497395833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:456.4934895833333,y:276.1119384765625,step:2},{x:457.0703125,y:276.4791259765625,step:1},{x:457.87504069010413,y:276.78385416666663,step:1},{x:458.7838134765625,y:276.78385416666663,step:1},{x:459.5755208333333,y:276.78385416666663,step:1},{x:460.3099365234375,y:276.3671875,step:1},{x:460.3099365234375,y:275.5364583333333,step:1},{x:460.3099365234375,y:274.9114583333333,step:1},{x:459.8919270833333,y:274.5286458333333,step:1},{x:459,y:274,step:1},{x:457.9765625,y:273.3919270833333,step:1},{x:456.9974365234375,y:272.5598958333333,step:1},{x:456.9974365234375,y:271.16796875,step:1},{x:456.9974365234375,y:268.9921875,step:1},{x:458.6966145833333,y:267.6640625,step:1},{x:460.81254069010413,y:267.6640625,step:1},{x:461.97916666666663,y:267.6640625,step:1},{x:462.6718343098958,y:267.95182291666663,step:1},{x:463.08854166666663,y:268.1920979817708,step:1},{x:462.44010416666663,y:270.111328125,step:0},{x:462.125,y:269.919921875,step:1},{x:461.4478759765625,y:269.6314697265625,step:1},{x:460.6405843098958,y:269.6477864583333,step:1},{x:459.67704264322913,y:269.6477864583333,step:1},{x:459.1718343098958,y:270.17582194010413,step:1},{x:459.1718343098958,y:270.767578125,step:1},{x:459.1718343098958,y:271.3919270833333,step:1},{x:459.7630208333333,y:271.775390625,step:1},{x:460.58329264322913,y:272.28776041666663,step:1},{x:461.7642822265625,y:272.9759114583333,step:1},{x:462.49869791666663,y:273.83984375,step:1},{x:462.49869791666663,y:275.13541666666663,step:1},{x:462.49869791666663,y:277.5364583333333,step:1},{x:460.71354166666663,y:278.7682698567708,step:1},{x:458.5677083333333,y:278.7682698567708,step:1},{x:457.22782389322913,y:278.75260416666663,step:1},{x:456.2499593098958,y:278.3671875,step:1},{x:455.80204264322913,y:278,step:1},{x:456.4934895833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}];class Kc extends IEe{constructor(l){var u;super(Ht(qe({type:"annotationStamp"},l),{style:Ht(qe({},l.style),{stampConfig:(null==l||null===(u=l.style)||void 0===u?void 0:u.stampConfig)||nZ(null==l?void 0:l.style.iconName)})})),N(this,"shapeType","annotationStamp"),N(this,"stampType","base"),N(this,"controls",void 0),N(this,"eventHandler",void 0),N(this,"context",void 0),N(this,"shapes",[]),N(this,"initialRect",void 0),N(this,"iconName",void 0),N(this,"imageLoadedByDraw",!1),N(this,"initByDraw",!1),N(this,"hooks",{reRenderImage:up()}),this.initByDraw=(null==l?void 0:l.initByDraw)||!1,this.initStamp(),this.init(l.transform,l.selectableStyle),this.initSize(l.style,l.transform)}init(l,u){this.eventHandler=new $c(this),this.context=new qc(this,u),this.context.setTransform(l),this.initialRect=this.getBoundingRect()}initStamp(){const{imageData:l,width:u,height:f}=this.style;if(this.stampItemShapes.forEach(g=>{g.destroy()}),this.stampItemShapes=[],l){let g;this.renderType="image",this.imageLoadedByDraw=!1,g=l instanceof Blob?URL.createObjectURL(l):l;const m=new Image;m.src=g,this.style.img=m,m.onload=()=>{if(this.initByDraw||!Xt(u)||!Xt(f)){const{width:v,height:_}=m;let b=v,S=_;if(v>400||_>400){const I=Math.max(v/400,_/400);b/=I,S/=I}this.updateStyle({width:b,height:S}),this.setLocalScale(1,1,1),this.initialWidth=b,this.initialHeight=S,this.initByDraw=!1,this.imageLoadedByDraw=!0}this.hooks.reRenderImage.emit()}}else this.initByDraw=!1,super.initStamp()}initSize(l,u){if("image"===this.renderType){const{x:b,y:S}=this.getLocalScale();1===b&&1===S||this.updateSize(this.parsedStyle.width.value,this.parsedStyle.height.value)}const f={},g=this.getAnnotationConfig(),{x:m,y:v}=(null==u?void 0:u.scale)||{x:1,y:1};var _;Xt(null==l?void 0:l.x)&&(null==l?void 0:l.x)!==g.style.x&&(f.x=l.x),Xt(null==l?void 0:l.y)&&(null==l?void 0:l.y)!==g.style.y&&(f.y=l.y),Xt(null==l?void 0:l.width)&&l.width*m!==g.style.width&&(f.width=l.width),Xt(null==l?void 0:l.height)&&l.height*v!==g.style.height&&(f.height=l.height),_=f,(0!==Object.keys(_).length||_.constructor!==Object)&&this.updateStampStyle(f)}update(){this.updateOrigin(),this.context.updateControls()}updateSize(l,u){const{x:f,y:g}=this.getLocalScale(),{x:m,y:v}=this.getPosition();if("image"===this.renderType){const{x:k,y:O}=this.getLocalPosition(),j=this.getAngle(),W=l*f,J=u*g;this.setAngle(0),this.setLocalScale(1,1,1),this.updateStyle({width:W,height:J});const K=k+(l-W)/2,Q=O+(u-J)/2;return this.initialWidth=W,this.initialHeight=J,this.setLocalPosition({x:K,y:Q}),void this.setAngle(j)}const{width:_,height:b}=this.parsedStyle;this.setLocalScale((l||_.value*f)/_.value,(u||b.value*g)/b.value),this.setPosition({x:m,y:v})}updateStampStyle(l){const{x:u,y:f}=this.getLocalPosition(),{x:g,y:m}=this.getLocalScale(),{width:v,height:_}=this.parsedStyle,{width:b,height:S}=l,{imageData:I,iconName:k}=this.style;let O=u,j=f;I||pt(null==l?void 0:l.imageData)||this.setLocalScale(1),null!=l&&l.imageData&&l.imageData!==I?(this.style.imageData=l.imageData,this.initStamp()):null!=l&&l.iconName&&l.iconName!==k&&(this.style.imageData=null,this.style.iconName=l.iconName,this.stampConfig=nZ(l.iconName),this.initStamp()),Xt(null==l?void 0:l.opacity)&&(null==l?void 0:l.opacity)!==this.style.opacity&&(this.style.opacity=l.opacity),this.updateSize(Xt(b)?b:v.value*g,Xt(S)?S:_.value*m);const{x:W,y:J}=this.getLocalScale();Xt(null==l?void 0:l.x)&&(O=l.x-(this.initialWidth-this.initialWidth*W)/2),Xt(null==l?void 0:l.y)&&(j=l.y-(this.initialHeight-this.initialHeight*J)/2),this.setLocalPosition(O,j)}getAnnotationConfig(){const l=this.context.getTransform(),{x:u,y:f}=this.style,g=hn(l);if(g.position.x===u&&g.position.y===f&&1===g.scale.x&&1===g.scale.y&&(delete g.position,delete g.scale),this.style.imageData)return{type:"annotationStamp",style:{x:l.position.x,y:l.position.y,width:this.style.width,height:this.style.height,opacity:this.style.opacity,imageData:this.style.imageData},transform:qe({},g)};const{initialWidth:m,initialHeight:v}=this,_=m*l.scale.x,b=v*l.scale.y;return{type:"annotationStamp",style:{x:l.position.x+(m-_)/2,y:l.position.y+(v-b)/2,width:_,height:b,opacity:this.style.opacity,stampConfig:[...this.stampConfig],iconName:this.style.iconName},transform:qe({},g)}}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}}function nZ(p){return[o2e,JEe,QEe,r2e,ZEe,t2e,n2e,a2e,e2e,i2e,s2e,l2e][[Pi.REJECTED,Pi.ACCEPTED,Pi.APPROVED,Pi.NOT_APPROVED,Pi.COMPLETED,Pi.DRAFT,Pi.FINAL,Pi.VOID,Pi.CONFIDENTIAL,Pi.INITIAL_HERE,Pi.SIGN_HERE,Pi.WITNESS].indexOf(p)]}var zd;!function(p){p.HIGHLIGHT="highlight",p.UNDERLINE="underline",p.STRIKEOUT="strikeout"}(zd||(zd={}));class jh extends Kc{constructor(l,u){super(qe({},l)),N(this,"stampType","textAssist"),N(this,"textAssistType",void 0),N(this,"annotationRaw",void 0),this.textAssistType=u,this.annotationRaw=l.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1})}getAnnotationConfig(){const l=super.getAnnotationConfig();return this.annotationRaw&&(l.style.annotationRaw=this.annotationRaw),l}}class c5 extends Kc{constructor(l){super(qe({},l)),N(this,"stampType","raw"),N(this,"annotationRaw",void 0),this.annotationRaw=l.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1})}getAnnotationConfig(){const l=super.getAnnotationConfig();return this.annotationRaw&&(l.style.annotationRaw=this.annotationRaw),l}}function c2e(p,l,u){var f;(u instanceof eZ||u instanceof Pv||u instanceof ZQ)&&p!==l&&(null===(f=u.context)||void 0===f||f.updateControls())}function u2e(p,l,u){p!==l&&u.childNodes.length>0&&u.childNodes.forEach(f=>{f&&f.style&&(f.style.opacity=l)})}function d2e(p,l,u){var f;(u instanceof Gd||u instanceof Kx||u instanceof Jx)&&p!==l&&(null===(f=u.context)||void 0===f||f.updateControls())}function h2e(p,l,u){if(!(u instanceof Kx||u instanceof Jx||u instanceof Qx||u instanceof Gd)||p===l)return;const{x:f,y:g}=u.getBoundingRect();u.updatePosition(f,g),u.updateOrigin()}function f2e(p,l,u){var f;(u instanceof r2||u instanceof or)&&p!==l&&(null===(f=u.context)||void 0===f||f.updateControls())}function iZ(p,l,u){var f;u instanceof $Ee&&p!==l&&(null===(f=u.context)||void 0===f||f.updateControls())}function p2e(p,l,u){var f;u instanceof Qx&&p!==l&&(null==u||null===(f=u.context)||void 0===f||f.updateControls())}function g2e(p,l,u){u instanceof or&&p!==l&&(u.textEditEventHandler.calculateCharPosition(),u.updateCursor(),u.hooks.reRenderText.emit())}function m2e(p,l,u){u instanceof or&&p!==l&&(u.textEditEventHandler.calculateCharPosition(),u.textEditEventHandler.updateTextSelection(),u.hooks.reRenderText.emit())}const v2e={annotationRect:"rectangle",annotationEllipse:"ellipse",annotationPolygon:"polygon",annotationPolyline:"polyline",annotationLine:"line",annotationInk:"ink",annotationTextBox:"textBox",annotationFreeText:"textTypewriter",annotationStamp:"stamp"};class y2e{constructor(l){N(this,"eraser",void 0),N(this,"eraserPath",void 0),N(this,"erasedShapeIds",[]),N(this,"selectionBox",void 0),N(this,"startCanvasPoint",void 0),N(this,"startLocalPoint",void 0),N(this,"lastMovePoint",void 0),N(this,"resetActivatedZIndex",!0),N(this,"isSeparateText",!1),N(this,"lastClickPointerType",""),N(this,"drawType","annotationRect"),N(this,"isStartEdit",!1),N(this,"isStartDraw",!1),N(this,"controller",void 0),N(this,"eventArea",void 0),N(this,"eventMode","none"),N(this,"defaultGroup",void 0),N(this,"activatedShape",void 0),N(this,"activatedZIndex",0),N(this,"drawLineShape",!1),N(this,"stampPreview",void 0),N(this,"inkDelayTimeout",void 0),N(this,"drawInkShape",!1),this.controller=l,this.defaultGroup=new pp("ddvDefaultGroup"),this.defaultGroup.style.zIndex=1e5}isDefaultGroup(l){return l===this.defaultGroup}getDrawInitStyle(l,u){var f,g;let m={};const{defaultStyleConfig:v,eraserStyle:_,selectionStyle:b}=this.controller.interactiveConfig,S={x:u.x,y:u.y};switch(l){case"annotationInk":m={lineCap:"round",lineJoin:"round",segments:[[u]]};break;case"annotationPolygon":case"annotationPolyline":m={points:[u]};break;case"annotationLine":m={startPoint:u,endPoint:u};break;case"annotationFreeText":m=Ht(qe({},S),{textContents:[qe(qe({},qi.textContent),null==v||null===(f=v.textTypewriter)||void 0===f?void 0:f.textContent)]});break;case"annotationTextBox":m=Ht(qe({},S),{textContents:[qe(qe({},qi.textContent),null==v||null===(g=v.textBox)||void 0===g?void 0:g.textContent)]});break;default:m=S}let I=qe(qe({},qi),v[v2e[l]]||{});return"select"===this.eventMode?I=Ht(qe({},b),{zIndex:999}):"erase"===this.eventMode&&(I=_),qe(qe({},I),m)}getDrawUpdateStyle(l,u){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=(this.startLocalPoint.x+u.x)/2,m=(this.startLocalPoint.y+u.y)/2,v=u.x-this.startLocalPoint.x,_=u.y-this.startLocalPoint.y;const b=["annotationCircle","annotationEllipse"].includes(l),S=Math.min(Math.abs(v),Math.abs(_));f&&(v=u.x>=this.startLocalPoint.x?S:-S,_=u.y>=this.startLocalPoint.y?S:-S,b&&(g=(2*this.startLocalPoint.x+v)/2,m=(2*this.startLocalPoint.y+_)/2));let I={};switch(l){case"annotationFreeText":break;case"annotationCircle":case"annotationArc":I={x:g,y:m,r:S};break;case"annotationEllipse":I={x:g,y:m,rx:Math.abs(v)/2,ry:Math.abs(_)/2};break;case"annotationLine":I={endPoint:u};break;default:I={width:v,height:_}}return I}limitPoint(l,u,f){if(!this.eventArea)return;const{x:g,y:m,width:v,height:_}=this.eventArea;let b=0,S=0,I=0;if(u){const{lastHitControlPoint:k,lastHitControlPointCenter:O}=this.activatedShape.context;k&&O&&(S=k.x-O.x,I=k.y-O.y)}else b=$x(f)?f.parsedStyle.borderWidth.value:0;l.x<g+b+S&&(l.x=g+b+S),l.y<m+b+I&&(l.y=m+b+I),l.x>g+v+S&&(l.x=g+v+S),l.y>m+_+I&&(l.y=m+_+I)}executeErase(){var l;"erase"===this.eventMode&&(this.erasedShapeIds.length>0&&this.controller.deleteShape(this.erasedShapeIds),this.controller.deleteShape([null===(l=this.eraserPath)||void 0===l?void 0:l.id],!1),this.eraser=null,this.eraserPath=null,this.activatedShape=null,this.erasedShapeIds=[])}executeBoxSelect(){if("select"!==this.eventMode)return;const{shapeArrMap:l,containerId:u}=this.controller,f=[],g=l.get(u),{width:m,height:v}=this.selectionBox.parsedStyle;if(m.value<2&&v.value<2){const _=[];g.forEach(b=>{if("hidden"===b.style.visibility||!b.context.controlsFlags.enableControl||b===this.selectionBox||"annotationGroup"===b.shapeType)return;const S=Gu(b,this.startCanvasPoint);!b.context.isGrouped&&b.isPointInPath(S,this.getHitBorderOffset(b))&&_.push(b)}),_.length&&(_.sort((b,S)=>b.style.zIndex-S.style.zIndex),f.push(_[_.length-1]))}else g.forEach(_=>{"annotationGroup"!==_.shapeType&&"visible"===_.style.visibility&&_.context.controlsFlags.enableControl&&_!==this.selectionBox&&function(b,S){S.controls||S.context.initControls(),S.context.renderControls();const I=S.controls.controlPoints.slice(0,4);for(let le=0;le<4;le++){const he=Gu(b,I[le].getPosition());if(b.isPointInPath(he))return!0}const k=[],{x:O,y:j}=b.getPosition(),{width:W,height:J}=b.parsedStyle,K=Math.abs(b.getScale().x),Q=Math.abs(b.getScale().y);k.push({x:O,y:j},{x:O+W.value*K,y:j},{x:O+W.value*K,y:j+J.value*Q},{x:O,y:j+J.value*Q});const ie=S.getBoundingRectObject();ie.setLocalTransform(S.getLocalTransform()),S.parentNode.appendChild(ie);const oe=ie.getWorldTransform().inverse();for(let le=0;le<4;le++){const he=oe.transformPoint(k[le]);if(he.x+=ie.parsedStyle.x,he.y+=ie.parsedStyle.y,ie.isPointInPath(he))return ie.destroy(),!0}return ie.destroy(),S.context.destroyControls(),!1}(this.selectionBox,_)&&f.push(_)});1===f.length?this.selectShapes([f[0]]):f.length>1?this.selectShapes(f):(this.activatedShape=null,this.controller.hooks.emitSelectAnnotation(null)),this.controller.deleteShape([this.selectionBox.id],!1),this.selectionBox=null,this.controller.hooks.emitAnnotationRender()}activateShape(l){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!l||"hidden"===l.style.visibility||!l.context.controlsFlags.enableControl||this.activatedShape===l&&l.context.isActive)return;const{showOnTopWhenSelected:g}=this.controller.interactiveConfig;var m;this.activatedShape&&this.activatedShape!==l&&(u?(g&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.isDefaultGroup(this.activatedShape)||this.defaultGroup.shapes.includes(this.activatedShape)||((null===(m=this.activatedShape)||void 0===m?void 0:m.parentNode)===(null==l?void 0:l.parentNode)?this.defaultGroup.add(this.activatedShape):this.inactivateShape())):this.inactivateShape()),this.activatedShape=l,this.activatedShape.context.isActive=!0,this.activatedShape.eventHandler.setLimitArea(this.eventArea),g&&(this.resetActivatedZIndex&&(this.activatedZIndex=this.activatedShape.style.zIndex),this.resetActivatedZIndex=!0,this.activatedShape.style.zIndex=99999),this.activatedShape.controls||l.context.initControls(),l.context.renderControls(),Hg(l)&&l.pointEventsHandler.enableEditMode(),this.isDefaultGroup(l)&&l.showAllControls(),u||this.controller.hooks.emitSelectAnnotation(l),f&&this.controller.hooks.emitAnnotationRender()}inactivateShape(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.activatedShape)return;const{showOnTopWhenSelected:f}=this.controller.interactiveConfig;if(f&&!this.isDefaultGroup(this.activatedShape)&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.drawInkShape&&this.activatedShape instanceof Gd&&(this.drawInkShape=!1,clearTimeout(this.inkDelayTimeout)),this.activatedShape.context.unHitShape(),this.activatedShape.context.destroyControls(),this.isDefaultGroup(this.activatedShape)&&this.activatedShape.clear(),this.activatedShape instanceof or&&"freeTextWriter"===this.activatedShape.textType){const{textContents:g}=this.activatedShape.style;let m="";g.forEach(v=>{m+=(null==v?void 0:v.content)||""}),0===m.length&&this.controller.deleteShape([this.activatedShape.id],!0)}this.activatedShape=null,this.controller.hooks.emitAnnotationRender(),l&&this.controller.hooks.emitSelectAnnotation(null,u)}setEventArea(l){this.eventArea=l,this.activatedShape&&this.activatedShape.eventHandler.setLimitArea(this.eventArea)}setEventMode(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"annotationRect";if("draw"===this.eventMode&&this.activatedShape&&("annotationInk"===this.drawType&&this.activatedShape instanceof Gd&&this.activatedShape.setUseDouglasPeucker(!0),this.drawLineShape)){const f=[...this.activatedShape.style.points];ir()||f.pop(),this.activatedShape.style.points=f}this.drawLineShape&&this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape]),(this.drawInkShape||this.drawLineShape)&&(clearTimeout(this.inkDelayTimeout),this.inactivateShape(!1)),this.isStartDraw=!1,this.drawLineShape=!1,this.drawInkShape=!1,this.eventMode=l,this.drawType=u,this.stampPreview&&(this.controller.deleteShape([this.stampPreview.id],!1),this.stampPreview=null,this.controller.hooks.emitAnnotationRender()),"none"!==l&&(this.inactivateShape(!0),"erase"===l&&(this.drawType="annotationInk"),"select"===l&&(this.drawType="annotationRect"))}getFreeTextLimitWidth(l,u,f,g,m,v){const _=l,b=u,S=Math.round(f),I=Math.round(v);if(!_)return 0;let k=_,O=g;if(I!==S){if(0===I)switch(S){case 90:return m;case 180:return g;case-90:k=b,O=m}if(-90===I)switch(S){case 0:return m;case 90:return g;case 180:k=b,O=m}if(180===I||-180===I)switch(S){case 0:return g;case-90:return m;case 90:k=b,O=m}if(90===I)switch(S){case 180:return m;case-90:return g;case 0:k=b,O=m}}let j=k-O;return j<0&&(j=k),j}selectShapes(l){const u=[];return l.forEach(f=>{"visible"===f.parsedStyle.visibility&&f.context.controlsFlags.enableControl&&u.push(f)}),this.inactivateShape(!l.length),!!u.length&&(this.defaultGroup.clear(),1===u.length?this.activateShape(u[0],!1,!0):(u.forEach(f=>{this.defaultGroup.add(f)}),this.activateShape(this.defaultGroup,!1,!0)),!0)}editStartHandler(l){if("none"!==this.eventMode||!this.activatedShape)return;const{offsetX:u,offsetY:f}=Hd(this.controller.canvas,l),g={x:u,y:f};this.isStartEdit=!0,180===this.activatedShape.getAngle()&&this.activatedShape.setAngle(179.99),this.activatedShape.eventHandler.startHandler(g,!0),this.controller.hooks.emitBeforeAnnotationEdit(this.activatedShape)}editMoveHandler(l){if(!this.activatedShape||"none"!==this.eventMode||!this.isStartEdit)return;const{offsetX:u,offsetY:f}=Hd(this.controller.canvas,l),g={x:u,y:f};this.limitPoint(g,!0,this.activatedShape),this.activatedShape.eventHandler.moveHandler(g,l.shiftKey),this.controller.hooks.emitAnnotationRender()}editEndHandler(l){this.isStartEdit=!1,this.activatedShape&&"none"===this.eventMode&&(this.activatedShape.eventHandler.endHandler(this.controller.hooks),this.controller.hooks.emitAfterAnnotationEdit(this.activatedShape))}drawStartHandler(l){if(!this.controller.container||"none"===this.eventMode)return;if("draw"===this.eventMode&&"annotationStamp"===this.drawType)return void("touch"!==l.pointerType&&"pen"!==l.pointerType||this.drawStampMoveHandler(l,!1));if(!this.eventArea)return;const{controller:u}=this,{drawType:f,drawLineShape:g,eventMode:m}=this,{offsetX:v,offsetY:_}=Hd(u.canvas,l),{x:b,y:S,width:I,height:k}=this.eventArea;if(v<b||v>b+I||_<S||_>S+k)return;const O={x:v,y:_},j=u.container.getWorldTransform().inverse().transformPoint(O);if(this.isStartDraw=!0,this.startCanvasPoint=O,this.startLocalPoint=j,this.lastMovePoint=null,"select"===m&&(this.inactivateShape(),this.controller.hooks.emitBeforeAnnotationEdit(null)),this.drawInkShape&&clearTimeout(this.inkDelayTimeout),"draw"===m&&(g||this.drawInkShape)){const ie=this.activatedShape instanceof Gd;return ie&&(this.activatedShape.addSegment(),this.activatedShape.setUseDouglasPeucker(!1)),this.activatedShape.addPoint(j),void(ie||"touch"!==l.pointerType&&"pen"!==l.pointerType||this.controller.hooks.emitAnnotationRender())}-1!==["annotationPolyline","annotationPolygon"].indexOf(f)&&(this.drawLineShape=!0),"draw"===m&&-1!==["annotationInk"].indexOf(f)&&(this.drawInkShape=!0);const W={style:this.getDrawInitStyle(this.drawType,j)};if("annotationFreeText"===this.drawType){const{cropBoxRect:ie}=this.controller.container.parentNode.parentNode.parentNode,oe=this.getFreeTextLimitWidth(ie.width,ie.height,this.controller.container.getAngle(),W.style.x-ie.left||0,W.style.y-ie.top||0,0);W.style.width=oe||W.style.width}const J=this.controller.addShape(this.drawType,W,!1);J.style.zIndex=999,J instanceof Gd&&J.setUseDouglasPeucker(!1);const K=()=>{0!==this.controller.container.getAngle()&&rZ(J)&&(J.setAngle(0),J.setPosition(O))},{container:Q}=this.controller;if("draw"===m)this.controller.hooks.emitBeforeAnnotationDraw(J),K();else if("erase"===m){if(J.style.background=null,Q){const ie=J.style.borderWidth/Q.getScale().x;J.style.borderWidth=ie}this.eraserPath=J}else{if(Q){const ie=J.style.borderWidth/Q.getScale().x;J.style.borderWidth=ie}this.selectionBox=J,K()}this.activatedShape=J,this.controller.hooks.emitAnnotationRender()}drawMoveHandler(l,u){const{activatedShape:f,eventMode:g,isStartDraw:m,drawType:v}=this;if("none"===g)return;if("draw"===g&&"annotationStamp"===v)return void this.drawStampMoveHandler(l,u);if("draw"===g&&"annotationFreeText"===v||!m)return;const{offsetX:_,offsetY:b}=Hd(this.controller.canvas,l),S={x:_,y:b};this.limitPoint(S,!1,this.activatedShape);const I=this.controller.container.getWorldTransform().inverse().transformPoint(S);if("annotationPolyline"===v||"annotationPolygon"===v){const k=hn(f.parsedStyle.points),O=k.length;1===O?k[O]=I:k[O-1]=I,f.style.points=k}else if("annotationInk"===v)f.addPoint(I);else{const k=this.getDrawUpdateStyle(this.drawType,I,l.shiftKey),O=this.controller.container.getAngle();if(0!==O&&rZ(f)){if(90===Math.abs(Math.round(O))){const j=k.width;k.width=k.height,k.height=j}k.width=S.x-this.startCanvasPoint.x>0?Math.abs(k.width):-Math.abs(k.width),k.height=S.y-this.startCanvasPoint.y>0?Math.abs(k.height):-Math.abs(k.height),f.updateStyle(k),f.setPosition(qe({},this.startCanvasPoint))}else f.updateStyle(k)}this.controller.hooks.emitAnnotationRender()}drawStampMoveHandler(l,u){const{offsetX:f,offsetY:g}=Hd(this.controller.canvas,l),m={x:f,y:g},v=this.controller.container.getRootNode(),_=v.getWorldTransform().inverse().transformPoint(m),b=()=>{if(!this.stampPreview)return;const S=this.stampPreview.getBoundingRect(),I=(null==l?void 0:l.target)instanceof HTMLCanvasElement;this.stampPreview.style.visibility=!u&&I?"visible":"hidden",this.stampPreview.setLocalPosition(_.x-S.width/2,_.y-S.height/2)};if(!this.stampPreview){const{defaultStyleConfig:S}=this.controller.interactiveConfig,{stamp:I}=S,k=(null==I?void 0:I.stampIcon)||(null==qi?void 0:qi.stampIcon),O=(null==I?void 0:I.imageData)||(null==qi?void 0:qi.imageData);if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:k,imageData:O,opacity:Xt(I.opacity)?I.opacity:.5,zIndex:9999},initByDraw:!0}),v.appendChild(this.stampPreview),!O&&k){const{width:j,height:W}=this.stampPreview.parsedStyle;if(W.value>60){const J=W.value/60;this.stampPreview.updateSize(j.value/J,W.value/J)}this.stampPreview.hooks.reRenderImage.on(()=>{this.controller.hooks.emitAnnotationRender()})}else this.stampPreview.hooks.reRenderImage.on(()=>{b(),this.controller.hooks.emitAnnotationRender()})}b(),this.controller.hooks.emitAnnotationRender()}eraseMoveHandler(l){const{eventMode:f,eraser:g,isStartDraw:m,erasedShapeIds:v,controller:_}=this;if("erase"!==f&&g&&(this.eraser=null,g.destroy()),"erase"!==f||!_.container||!m)return;const{offsetX:b,offsetY:S}=Hd(_.canvas,l),I={x:b,y:S};this.lastMovePoint||(this.lastMovePoint=I),_.shapeArrMap.get(_.containerId).forEach(k=>{k!==this.eraserPath&&"visible"===k.parsedStyle.visibility&&k.context.controlsFlags.enableControl&&function(O,j,W){const J=Gu(O,j),K=Og(j,W),Q=O.isPointInPath(J,5);if(Q||K<=.9)return Q;const ie=K/1,oe=(j.x-W.x)/ie,le=(j.y-W.y)/ie;for(let he=0;he<Math.abs(ie);he++){const _e=Gu(O,{x:W.x+oe*he,y:W.y+le*he});if(O.isPointInPath(_e,5))return!0}return!1}(k,I,this.lastMovePoint)&&(k.style.opacity=.5,v.push(k.id))}),this.lastMovePoint=I,this.controller.hooks.emitAnnotationRender()}drawEndHandler(l){const{eventMode:u,isStartDraw:f,drawLineShape:g,drawType:m,activatedShape:v,controller:_}=this;if("draw"===u&&"annotationStamp"===m)return void this.drawStampEndHandler(l);if("none"===u||!f||g)return;if(this.isStartDraw=!1,["annotationRect","annotationTextBox"].includes(m)){const{width:S,height:I,borderWidth:k}=v.parsedStyle,{x:O,y:j}=v.getPosition(),{x:W,y:J}=v.getScale(),K=(null==k?void 0:k.value)||0;let Q=O,ie=j;S.value<0&&(Q=O-(-S.value+K)*W,v.style.width=2*K-S.value),I.value<0&&(ie=j-(-I.value+K)*J,v.style.height=2*K-I.value),v.setPosition({x:Q,y:ie})}if("draw"===u&&this.drawInkShape)return v.setUseDouglasPeucker(!0),this.controller.hooks.emitAnnotationRender(),1===this.activatedShape.style.segments.length?_.hooks.emitAddAnnotation("draw",[this.activatedShape]):_.hooks.emitModifyAnnotation(["resized"],[this.activatedShape]),void(this.inkDelayTimeout=setTimeout(()=>{this.drawInkShape&&(this.drawInkShape=!1,this.activatedShape&&this.activatedShape instanceof Gd&&(this.activatedShape.setUseDouglasPeucker(!0),this.inactivateShape(!1,!1)))},this.controller.interactiveConfig.inkCreateDelay));if("draw"===u&&"annotationFreeText"!==m&&"annotationStamp"!==m){const{offsetX:S,offsetY:I}=Hd(_.canvas,l);((this.startCanvasPoint.x-S)**2+(this.startCanvasPoint.y-I)**2)**.5<2&&"annotationStamp"!==v.shapeType&&(_.deleteShape([v.id],!1),_.hooks.emitAfterAnnotationDraw(null),this.activatedShape=null)}const b=(S,I)=>{S instanceof or&&(S.textEditEventHandler.enableEditMode(this.startCanvasPoint,I),"textBox"===S.textType&&this.controller.hooks.emitAnnotationRender(),"freeTextWriter"===S.textType&&setTimeout(()=>{document.activeElement instanceof HTMLTextAreaElement||S.textEditEventHandler.enableEditMode(this.startCanvasPoint,I)},10))};if("draw"===u&&this.activatedShape){const S=this.activatedShape,{canvas:I}=this.controller;_.hooks.emitAddAnnotation("draw",[this.activatedShape]),_.interactiveConfig.enableContinuousDrawing?v instanceof or?(this.eventMode="none",this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),b(v,I)):this.activatedShape=null:(this.controller.setAnnotationMode("none",!0),_.hooks.emitAfterAnnotationDraw(S),this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),b(v,I))}"erase"===u&&this.executeErase(),"select"===u&&this.executeBoxSelect()}drawStampEndHandler(l){const{offsetX:u,offsetY:f}=Hd(this.controller.canvas,l);if(!this.stampPreview||!this.eventArea||this.stampPreview&&"image"===this.stampPreview.renderType&&!this.stampPreview.imageLoadedByDraw)return;const{x:g,y:m,width:v,height:_}=this.eventArea;if(u<g||u>v+g||f<m||f>_+m)return;const{defaultStyleConfig:b}=this.controller.interactiveConfig,{stamp:S}=b,I=Xt(null==S?void 0:S.opacity)?null==S?void 0:S.opacity:null==qi?void 0:qi.opacity,k=this.stampPreview;k.style.opacity=I;const{containerId:O,container:j,shapeArrMap:W}=this.controller,J=qe({},k.getPosition()),K=qe({},k.getScale()),Q=j.getScale(),ie=K.x/Q.x,oe=K.y/Q.y;if(W.get(O).set(k.id,k),k.index=W.get(O).size,k.pageUid=O,j.appendChild(k),k.style.imageData){const{width:le,height:he}=k.parsedStyle;k.updateStyle({width:le.value*ie,height:he.value*oe}),k.setLocalScale(1,1,1)}else k.scale(ie,oe);k.setAngle(0),k.setPosition(J),this.stampPreview=null,this.activatedShape=k,this.controller.hooks.emitBeforeAnnotationDraw(k),this.controller.hooks.emitAddAnnotation("draw",[k]),this.controller.interactiveConfig.enableContinuousDrawing||(this.resetActivatedZIndex=!1,this.controller.setAnnotationMode("none",!0),this.activateShape(k,!1,!0),this.controller.hooks.emitAfterAnnotationDraw(k))}dblClickHandler(l){const{activatedShape:u,controller:f}=this;if(!u)return;const{shapeType:g}=u;if(this.drawLineShape&&("annotationPolygon"===g||"annotationPolyline"===g)){const m=[...u.style.points],v=m.length;return ir()?Og(m[v-1],m[v-2])<=15&&m.pop():m.pop(),"mouse"===this.lastClickPointerType&&(m.pop(),this.lastClickPointerType=""),m.length<2?(f.deleteShape([u.id],!1),this.activatedShape=null):(u.style.points=m,this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape])),this.isStartDraw=!1,this.drawLineShape=!1,void(!f.interactiveConfig.enableContinuousDrawing&&this.activatedShape?(this.controller.setAnnotationMode("none",!0),this.controller.hooks.emitAfterAnnotationDraw(u),this.resetActivatedZIndex=!1,this.activateShape(u,!1,!0)):this.activatedShape=null)}if("annotationFreeText"===g&&!this.isSeparateText){const{offsetX:m,offsetY:v}=Hd(this.controller.canvas,l),{textEditEventHandler:_}=u,b={x:m,y:v};if(this.activatedShape instanceof or&&"freeTextWriter"===this.activatedShape.textType){const{cropBoxRect:S}=this.controller.container.parentNode.parentNode.parentNode,I=this.getFreeTextLimitWidth(S.width,S.height,this.controller.container.getAngle(),this.activatedShape.getLocalPosition().x-S.left,this.activatedShape.getLocalPosition().y-S.top,this.activatedShape.getAngle());I!==this.activatedShape.style.width&&(this.activatedShape.style.width=I,this.controller.hooks.emitModifyAnnotation(["appearanceChanged"],[this.activatedShape]))}_.enableEditMode(b,this.controller.canvas),this.controller.hooks.emitAnnotationRender()}}clickHandler(l){const{activatedShape:u,eventMode:f}=this;if(!u)return;const{shapeType:g}=u,m=()=>{if("annotationFreeText"===g){const{offsetX:v,offsetY:_}=Hd(this.controller.canvas,l),{textEditEventHandler:b}=u;b.editClickHandler({x:v,y:_},this.controller.canvas)}};if(this.lastClickPointerType=null==l?void 0:l.pointerType,this.isSeparateText=!1,"none"===f){if(l.ctrlKey){if(this.isDefaultGroup(u)){const{clickedShape:v}=u;this.defaultGroup.delete(v);const{shapes:_}=this.defaultGroup;if(_.length<2&&(this.defaultGroup.context.isActive=!1),1===_.length){const b=_[0];this.activateShape(b,!1,!1),this.isSeparateText=b instanceof or}}else this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.defaultGroup.add(this.activatedShape),this.defaultGroup.shapes.length>=2?(this.defaultGroup.context.isActive=!0,this.activateShape(this.defaultGroup,!1,!1)):(this.controller.hooks.emitSelectAnnotation(u),m());return void this.controller.hooks.emitAnnotationRender()}m()}}keyDownHandler(l){const{activatedShape:u}=this;if(u&&("Delete"===l.key||"Backspace"===l.key)){if(qx(u)&&u.textEditEventHandler.editMode)return;this.controller.deleteShape([u.id]),this.inactivateShape()}}getHitBorderOffset(l){if(!l)return 10;const u=l.getScale();if(u.x<1||u.y<1){const f=Math.min(u.x,u.y);return Math.round(Math.abs(10/f))}return 10}createStampPreviewForMobile(){if(this.stampPreview)return;const{defaultStyleConfig:l}=this.controller.interactiveConfig,{stamp:u}=l,f=(null==u?void 0:u.stampIcon)||(null==qi?void 0:qi.stampIcon),g=(null==u?void 0:u.imageData)||(null==qi?void 0:qi.imageData),m=this.controller.container.getRootNode();if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:f,imageData:g,opacity:Xt(u.opacity)?u.opacity:.5,zIndex:9999,visibility:!1},initByDraw:!0}),m.appendChild(this.stampPreview),!g&&f){const{width:v,height:_}=this.stampPreview.parsedStyle;if(_.value>60){const b=_.value/60;this.stampPreview.updateSize(v.value/b,_.value/b)}}}}function rZ(p){return["annotationFreeText","annotationTextBox","annotationRect"].includes(p.shapeType)}var hl,Hh,o2=new WeakMap;class _2e extends rr{constructor(){super(...arguments),N(this,"renderAnnotation",Et(this)),N(this,"addAnnotation",Et(this)),N(this,"deleteAnnotation",Et(this)),N(this,"selectAnnotation",Et(this)),N(this,"modifyAnnotation",Et(this)),N(this,"annotationModeChanged",Et(this)),N(this,"beforeAnnotationEdit",Et(this)),N(this,"afterAnnotationEdit",Et(this)),N(this,"beforeAnnotationDraw",Et(this)),N(this,"afterAnnotationDraw",Et(this)),N(this,"selectAnnotationTextChars",Et(this)),N(this,"enableAnnotationTextEditMode",Et(this)),N(this,"disableAnnotationTextEditMode",Et(this)),bi(this,o2,[])}emitAddAnnotation(l,u){const f=[];u.forEach(g=>{f.push({uid:g.id,shape:g})}),this.addAnnotation.emit({action:l,shapes:f})}emitDeleteAnnotation(l){const u=[];l.forEach(f=>{u.push({uid:f.id,shape:f})}),this.deleteAnnotation.emit({shapes:u})}emitSelectAnnotation(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=[];l instanceof pp?l.shapes.forEach(g=>{f.push(g.id)}):l&&f.push(l.id),(f.length||Ye(o2,this).length)&&(this.selectAnnotation.emit({newAnnotationUids:[...f],oldAnnotationsUids:[...Ye(o2,this)],emitSelected:u}),Bn(o2,this,f))}emitModifyAnnotation(l,u){const f=[];u.forEach(g=>{g instanceof pp?g.shapes.forEach(m=>{f.push({uid:m.id,shape:m})}):f.push({uid:g.id,shape:g})}),this.modifyAnnotation.emit({actions:l,shapes:f})}emitAnnotationModeChanged(l){this.annotationModeChanged.emit(l)}emitBeforeAnnotationEdit(l){l instanceof or&&l.textEditEventHandler.editMode||this.beforeAnnotationEdit.emit(l)}emitAfterAnnotationEdit(l){this.afterAnnotationEdit.emit(l)}emitAnnotationRender(){this.renderAnnotation.emit()}emitSelectAnnotationTextChar(l){this.selectAnnotationTextChars.emit(l)}emitBeforeAnnotationDraw(l){this.beforeAnnotationDraw.emit(l)}emitAfterAnnotationDraw(l){this.afterAnnotationDraw.emit(l)}emitEnableAnnotationTextEditMode(l){this.enableAnnotationTextEditMode.emit(l)}emitDisableAnnotationTextEditMode(l){this.disableAnnotationTextEditMode.emit(l)}}class C2e{constructor(l){N(this,"shapeArrMap",void 0),N(this,"shapeMap",void 0),N(this,"annotationMode","none"),N(this,"brush","annotationRect"),N(this,"canvas",void 0),N(this,"hooks",void 0),N(this,"interactiveConfig",hn(zEe)),N(this,"eventService",void 0),N(this,"containerId",void 0),N(this,"container",void 0),ju.bindHandler(["opacity"],void 0,u2e),ju.bindHandler(["fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,iZ),ju.bindHandler(["text","width","wordWarp","borderWidth","lineHeight","fontWeight","textTransform","textBaseLine"],void 0,iZ),ju.bindHandler(["width","height","borderWidth"],void 0,f2e),ju.bindHandler(["startPoint","endPoint","lineEnding"],void 0,p2e),ju.bindHandler(["r","rx","ry","borderWidth"],void 0,c2e),ju.bindHandler(["points","segments"],void 0,d2e),ju.bindHandler(["borderWidth"],void 0,h2e),ju.bindHandler(["textContents","borderWidth","textAlign"],void 0,g2e),ju.bindHandler(["textAlign"],void 0,m2e),this.canvas=l,this.eventService=new y2e(this),this.hooks=new _2e,this.shapeArrMap=new Map,this.shapeMap=new Map}set drawType(l){this.brush=l,"draw"===this.annotationMode&&this.eventService.setEventMode("draw",l)}get drawType(){return this.brush}bindFreeTextHooks(l){if(!(l instanceof or))return;const u=l.hooks;let f;u.reRenderText.on(()=>{this.hooks.emitAnnotationRender()}),u.textContentUpdated.on(()=>{this.hooks.emitModifyAnnotation(["contentChanged"],[l])}),u.selectTextChars.on(g=>{var m;if(g.startChar===g.endChar&&l.isSameChar(f,g.endChar)&&!g.needUpdate)return;const{freeTextContentStyle:v}=l,_="freeTextWriter"===l.textType?"textTypewriter":"textBox",{defaultStyleConfig:b}=this.interactiveConfig;b[_]||(b[_]={}),b[_].textContent=Ht(qe({},v),{content:null===(m=b[_])||void 0===m||null===(m=m.textContent)||void 0===m?void 0:m.content}),f=g.endChar,this.hooks.emitSelectAnnotationTextChar(l)}),u.enableTextEditMode.on(g=>{this.hooks.emitEnableAnnotationTextEditMode(l)}),u.disableTextEditMode.on(g=>{f=null,this.hooks.emitDisableAnnotationTextEditMode(l)})}bindStampHooks(l){l instanceof Kc&&l.hooks.reRenderImage.on(()=>{this.hooks.emitAnnotationRender()})}isHitShape(l){const{offsetX:u,offsetY:f}=Hd(this.canvas,l),{activatedShape:g,defaultGroup:m}=this.eventService,v={x:u,y:f},{shapeArrMap:_,shapeMap:b,containerId:S}=this,I=_.get(S)||b;if(g&&(m===this.eventService.activatedShape&&(null==m?void 0:m.parentNode)===this.container||I.has(g.id))){const J=g.eventHandler.isHit(v,!1);if(-1!==J)return{isHit:!0,isHitSelected:!0,hitControlPointIndex:J,shape:g}}const O=[];let j=!1,W=null;return I.forEach(J=>{if("hidden"===J.style.visibility||!J.context.controlsFlags.enableControl||J===g)return;const K=Gu(J,v);!J.context.isGrouped&&J.isPointInPath(K,this.eventService.getHitBorderOffset(J))&&(j=!0,O.push(J))}),j&&(O.sort((J,K)=>J.style.zIndex-K.style.zIndex),W=O[O.length-1]),{isHit:j,shape:W,isHitSelected:!1,hitControlPointIndex:-1}}isInTextEditMode(){return!!(this.eventService.activatedShape&&this.eventService.activatedShape instanceof or)&&this.eventService.activatedShape.isEditMode}setAnnotationMode(l){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.annotationMode=l,this.eventService.setEventMode(l,this.drawType),ir()&&"draw"===l&&"annotationStamp"===this.drawType&&this.eventService.createStampPreviewForMobile(),"none"!==l&&this.eventService.inactivateShape(),u&&this.hooks.emitAnnotationModeChanged(l)}setAnnotationContainer(l,u){if(u!==this.container){const{activatedShape:f,drawLineShape:g,drawInkShape:m,drawType:v}=this.eventService;if("draw"===this.eventService.eventMode&&f){if(m&&f instanceof Gd&&(clearTimeout(this.eventService.inkDelayTimeout),f.setUseDouglasPeucker(!0),this.eventService.drawInkShape=!1),g){const _=[...f.style.points];f.style.points=_,this.eventService.drawLineShape=!1,this.eventService.isStartDraw=!1}"annotationInk"!==v&&(this.hooks.emitAddAnnotation("draw",[f]),this.interactiveConfig.enableContinuousDrawing||(this.setAnnotationMode("none",!0),this.hooks.emitAfterAnnotationDraw(f)),this.eventService.activatedShape=null)}}this.containerId=l,this.container=u,this.shapeArrMap.get(l)||this.shapeArrMap.set(l,new Map)}setAnnotationInteractiveConfig(l){const u=hn(l),{controlsStyle:f,defaultStyleConfig:g,eraserStyle:m,selectionStyle:v}=this.interactiveConfig;u.defaultStyleConfig=(null==u?void 0:u.defaultStyleConfig)||{};const{stamp:_}=g,{stamp:b}=u.defaultStyleConfig,S=(null==_?void 0:_.stampIcon)||qi.stampIcon,I=(null==b?void 0:b.stampIcon)||qi.stampIcon,k=(null==_?void 0:_.imageData)||qi.imageData,O=(null==b?void 0:b.imageData)||qi.imageData;this.interactiveConfig=Ht(qe(qe({},this.interactiveConfig),u),{controlsStyle:yo((null==u?void 0:u.controlsStyle)||{},f),defaultStyleConfig:yo((null==u?void 0:u.defaultStyleConfig)||{},g),eraserStyle:yo((null==u?void 0:u.eraserStyle)||{},m),selectionStyle:yo((null==u?void 0:u.selectionStyle)||{},v)}),null!=u&&u.controlsStyle&&this.updateAllShapeControlsStyle(this.interactiveConfig.controlsStyle);const{stampPreview:j}=this.eventService;var W;j&&j.style.opacity!==(null==b?void 0:b.opacity)&&(this.eventService.stampPreview.style.opacity=null==b?void 0:b.opacity),S===I&&k===O||!this.eventService.stampPreview||(null===(W=this.eventService.stampPreview)||void 0===W||W.destroy(),this.eventService.stampPreview=null)}setAnnotationFlags(l,u){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const g=this.getShape(l);if(!(g instanceof c5||g instanceof jh)&&g){if(g!==this.eventService.activatedShape||!1!==u.enableControl&&!1!==u.isVisible||this.eventService.inactivateShape(!0),g.context.updateControlsFlags(qe({},u)),g.context.isInGroup&&(!g.context.controlsFlags.isVisible||!g.context.controlsFlags.enableControl)){const{defaultGroup:m}=this.eventService;m.delete(g),this.eventService.activatedShape===m&&1===m.shapes.length&&this.eventService.activateShape(m.shapes[0],!1,!0)}f&&this.hooks.emitAnnotationRender()}}getShape(l){return"ddvDefaultGroup"===l?this.eventService.defaultGroup:this.shapeMap.get(l)||null}getSelectedShapeUids(){const{activatedShape:l}=this.eventService;if(!l)return[];const u=[];return l instanceof pp?l.shapes.forEach(f=>{u.push(f.id)}):u.push(l.id),u}createShape(l,u){var f,g;let m;if(u.selectableStyle=qe(qe({},this.interactiveConfig.controlsStyle),u.selectableStyle),"annotationEllipse"===l){const{style:_}=u;_.x+=_.width/2||0,_.y+=_.height/2||0,_.rx=_.width/2||_.rx,_.ry=_.height/2||_.ry}const{defaultStyleConfig:v}=this.interactiveConfig;switch(l){case"annotationRect":m=new r2(u);break;case"annotationGroup":m=new pp(null==u?void 0:u.id);break;case"annotationArc":m=new ZQ(u);break;case"annotationCircle":m=new eZ(u);break;case"annotationEllipse":m=new Pv(u);break;case"annotationLine":m=new Qx(u);break;case"annotationInk":m=new Gd(u);break;case"annotationPolygon":m=new Kx(u);break;case"annotationPolyline":m=new Jx(u);break;case"annotationFreeText":m=new or(u,"freeTextWriter",qe(qe({},qi.textContent),null===(f=v.textTypewriter)||void 0===f?void 0:f.textContent));break;case"annotationTextBox":m=new or(u,"textBox",qe(qe({},qi.textContent),null===(g=v.textBox)||void 0===g?void 0:g.textContent));break;case"annotationImage":m=new XEe(u);break;case"annotationStamp":m=new Kc(u);break;case"annotationHighlight":m=new jh(u,zd.HIGHLIGHT);break;case"annotationUnderline":m=new jh(u,zd.UNDERLINE);break;case"annotationStrikeout":m=new jh(u,zd.STRIKEOUT);break;default:m=new c5(u)}return m?(m.id||(m.id=Ai()),this.shapeMap.set(m.id,m),m):null}addShape(l,u){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null!=u&&u.id){const m=this.getShape(null==u?void 0:u.id);if(m)return m}const g=this.createShape(l,u);return this.containerId&&this.shapeArrMap.get(this.containerId).set(g.id,g),this.container&&(g.index=this.shapeArrMap.get(this.containerId).size,g.pageUid=this.containerId,this.container.appendChild(g),f&&this.hooks.emitAddAnnotation("data",[g])),this.bindFreeTextHooks(g),this.bindStampHooks(g),g}updateShape(l,u){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const g=this.getShape(l);if(!g)return!1;const{isGrouped:m}=g.context;if(m&&this.eventService.defaultGroup.delete(g),null!=u&&u.style)if(g instanceof Kc)g.updateStampStyle(qe({},u.style));else{if(g instanceof Pv){const{x:v,y:_,width:b,height:S}=u.style,{x:I,y:k}=g.getLocalPosition(),O=b?ni(b).value/2:0,j=S?ni(S).value/2:0,W=Xt(v)?v+O:I,J=Xt(_)?_+j:k,K=O||g.style.rx,Q=j||g.style.ry;u.style=Ht(qe({},u.style),{x:W,y:J,rx:K,ry:Q})}g.updateStyle(qe({},u.style))}if(null!=u&&u.transform){const{angle:v,scale:_}=u.transform;pt(v)||g.setLocalAngle(v),pt(_)||g instanceof Kc||g.setLocalScale(_)}return f&&this.hooks.emitModifyAnnotation(["appearanceChanged"],[g]),m&&this.eventService.defaultGroup.add(g),!0}updateAllShapeControlsStyle(l){let u=!1;this.shapeMap.forEach(f=>{f.context.controlsStyle=l,f.context.parseControlsStyle(),f.controls&&(f.controls.isVisible&&(u=!0),f.context.destroyControls(),f.context.initControls(),f.context.renderControls())}),u&&this.hooks.emitAnnotationRender()}updateFreeTextDefaultConfig(){const{defaultStyleConfig:l}=this.interactiveConfig;this.shapeMap.forEach(u=>{if(u instanceof or){const f=qi.textContent,g="freeTextWriter"===u.textType?"textTypewriter":"textBox",{textContent:m}=l[g]||{};u.updateFreeTextContentStyle(Ht(qe(qe({},f),m),{content:f.content}))}})}updateLayer(l,u){const f=this.getShape(l);return!!f&&(this.interactiveConfig.showOnTopWhenSelected&&this.eventService.activatedShape===f?this.eventService.activatedZIndex=u:f.updateStyle({zIndex:u}),this.interactiveConfig.showOnTopWhenSelected&&this.interactiveConfig.enableContinuousDrawing&&"draw"===this.eventService.eventMode&&f.updateStyle({zIndex:u}),!0)}deleteShape(l){var u;let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const m=[],{eventService:v}=this,_=l.includes(null==v||null===(u=v.activatedShape)||void 0===u?void 0:u.id);if(l.forEach(k=>{const O=this.getShape(k);O&&(O instanceof pp?(m.push(...O.shapes),O.clear()):m.push(O))}),!m.length)return!1;f&&this.hooks.emitDeleteAnnotation(m),m.forEach(k=>{k.context.isInGroup&&this.eventService.defaultGroup.delete(k),this.shapeMap.delete(k.id),this.shapeArrMap.get(k.pageUid)&&this.shapeArrMap.get(k.pageUid).delete(k.id),k.destroy()});const{activatedShape:b,defaultGroup:S}=v;return(_||b===S&&!S.state)&&this.eventService.inactivateShape(!0,g),!0}selectShape(l){const u=[];return l.forEach(f=>{u.push(this.getShape(f))}),this.eventService.selectShapes(u)}moveShape(l,u,f){l.forEach(g=>{const m=this.getShape(g);if(!m)return;const _=this.shapeArrMap.get(m.pageUid);_&&_.delete(g),this.shapeArrMap.get(u)||this.shapeArrMap.set(u,new Map),this.shapeArrMap.get(u).set(g,m),m.context.isGrouped&&m.parentNode.delete(m,!0),f.appendChild(m)})}setShapeLayout(l,u){var f;if(!l.parentNode)return;const g=l.parentNode;let m,v;if(g instanceof Ev)m=g.width,v=g.height;else{const{width:he,height:_e}=qQ(g);m=he,v=_e}const{x:_,y:b}=g.getLocalScale();g.scale(_<0?-1:1,b<0?-1:1);const S=g.getAngle(),{width:I,height:k}=qQ(l),{x:O,y:j}=g.getPosition(),{x:W,y:J}=l.getPosition(),{shapeType:K}=l;let Q,ie;if(g.setAngle(0),null!=g&&null!==(f=g.context)&&void 0!==f&&f.referencePoint){const{x:he,y:_e}=g.context.referencePoint.getPosition();Q=he,ie=_e}else Q=O,ie=j;switch(u){case"left":ie=J;break;case"top":Q=W;break;case"right":Q+=m-I,ie=J;break;case"bottom":Q=W,ie+=v-k;break;case"center":Q+=m/2-I/2,ie+=v/2-k/2;break;case"horizontal-center":Q+=m/2-I/2,ie=J;break;case"vertical-center":Q=W,ie+=v/2-k/2}const oe=l.getAngle();if(l.setAngle(0),["annotationCircle","annotationArc","annotationEllipse"].includes(K)&&(["left","right","horizontal-center"].includes(u)?Q+=I/2:(["top","bottom","vertical-center"].includes(u)||(Q+=I/2),ie+=k/2)),"annotationText"===K&&["top","bottom","vertical-center","center"].includes(u)){var le;const{lineHeight:he}=l.parsedStyle,_e=null===(le=l.chars[0])||void 0===le?void 0:le.height,Ve=Math.max(he,_e);ie+=l.getTextBaseLineOffset(Ve)/2}l.setPosition({x:Q,y:ie}),l.setAngle(oe),g.setAngle(S),g.scale(_<0?-1:1,b<0?-1:1),this.hooks.emitAnnotationRender()}clickHandler(l){this.eventService.clickHandler(l)}dblClickHandler(l){this.eventService.dblClickHandler(l)}keyDownHandler(l){this.eventService.keyDownHandler(l)}startHandler(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=this.isHitShape(l);if("none"===this.annotationMode&&u&&(f.isHit?this.eventService.activateShape(f.shape,l.ctrlKey,!0):this.eventService.inactivateShape()),"draw"!==this.annotationMode||f.isHit||this.annotationMode===this.eventService.eventMode||this.eventService.setEventMode(this.annotationMode,this.brush),"draw"===this.annotationMode&&!this.eventService.drawLineShape&&"annotationInk"!==this.brush&&"annotationStamp"!==this.brush&&f.isHit&&(this.eventService.setEventMode("none"),this.eventService.activateShape(f.shape,l.ctrlKey,!0)),"select"===this.annotationMode){const{isHitSelected:g,isHit:m}=f;g?this.eventService.setEventMode("none"):!g&&m&&l.ctrlKey?(this.eventService.setEventMode("none"),this.eventService.activateShape(f.shape,l.ctrlKey,!0)):(this.eventService.setEventMode("select"),this.eventService.defaultGroup.clear())}this.eventService.editStartHandler(l),this.eventService.drawStartHandler(l)}moveHandler(l,u){this.eventService.editMoveHandler(l),this.eventService.drawMoveHandler(l,u),this.eventService.eraseMoveHandler(l)}endHandler(l){this.eventService.editEndHandler(l),this.eventService.drawEndHandler(l)}cursorHandler(l,u,f){if(!(this.container&&l.target instanceof HTMLCanvasElement))return;if(u||!(this.shapeArrMap.get(this.containerId)||this.shapeMap).size&&"none"===this.eventService.eventMode)return void(l.target.style.cursor=f);if("erase"===this.eventService.eventMode)return void(l.target.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAATtJREFUOE+Vk8ErRFEUxs93/gXZUUrNhiRFWUkWVpaWSomlpaVkaUlZ2CiWllZKjbJQVqQokaYspPwL5+e9aeb15s17z7i7273nd77v3O/KBliSrs1sycxugMV8if6ql3RpZiPAvaR5M/vJQ2oBki7MbBR47DYqQioB7n4OjAHPRZV5SCnA3U+AceCtyqKkZTP76AO4+yHQAFoDzGerB+DuB8DUgMXpQL8zgLvvA3P/KG4BK13AnqQFMxsC7uqkS5o1s3dgNb0ndz9ON8BwAmnWQSRNS3qNiLXcswogs1IFSTIxIeklIjZ7kij1AtqyCkokNSQ9RcR2Xybc/QyYASYL5LYdM/uS9BARO2WzaUvvdLS+jyI1Jd1GxG5loHLDSDtmEEmfSWSvImKj9lXyh+5+Cqx3VB2VeS7CfgHdAKKUgZXPMQAAAABJRU5ErkJggg==) 10 10,auto");if(this.eventService.isStartDraw)return;const g=this.isHitShape(l);if(this.eventService.isStartEdit){if(!g.isHitSelected||9!==g.hitControlPointIndex)return;l.target.style.cursor="move"}"draw"===this.eventService.eventMode&&["annotationInk","annotationStamp"].includes(this.eventService.drawType)?l.target.style.cursor="crosshair":g.isHit?g.isHitSelected?(l.target.style.cursor=9===g.hitControlPointIndex?"move":"grab",9===g.hitControlPointIndex&&g.shape instanceof or&&g.shape.isEditMode&&(l.target.style.cursor="text")):l.target.style.cursor="pointer":l.target.style.cursor="draw"===this.annotationMode?"crosshair":f}}class P_ extends Na{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&l.context.renderControls())}}class b2e extends P_{constructor(){super(),this.close=!1}}class x2e extends P_{render(l,u){super.render(l,u)}}class w2e extends P_{}class S2e extends GQ{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&(l.pointEventsHandler.updateLineControls(),l.context.renderControls()))}}class T2e extends P_{}class I2e extends UQ{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&l.context.renderControls())}}class E2e extends VQ{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&l.context.renderControls())}}class D2e extends P_{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&(l.pointEventsHandler.updateLineControls(),l.context.renderControls()))}}class A2e extends jQ{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&(l.pointEventsHandler.updateLineControls(),l.context.renderControls()))}}class P2e extends P_{}class R2e extends Na{render(l,u){if("hidden"!==l.parsedStyle.visibility){if("stamp"===l.renderType)super.render(l,u);else{const{width:f,height:g,img:m,opacity:v}=l.parsedStyle;if(xn(m))return;u.save(),u.globalAlpha=v,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality&&(u.imageSmoothingQuality="high"),u.drawImage(m,0,0,f.value,g.value),u.restore()}l.controls&&l.context.renderControls()}}}class k2e extends HQ{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&l.context.renderControls())}}class M2e extends zQ{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&l.context.renderControls())}}class O2e extends Na{render(l,u){"hidden"!==l.parsedStyle.visibility&&oZ(l,u)}}function oZ(p,l){const{container:u}=p,f=p.parentNode;if(!f)return;const g=f.getLocalTransform(),{a:m,b:v,c:_,d:b,e:S,f:I}=g;let k=null,O=u.parentNode;for(;!k&&O;)"pageCropBox"===O.name&&(k=O),O=O.parentNode;if(k){const{x:j,y:W,width:J,height:K}=function(Q){let{x:ie,y:oe}=Q.getPosition(),{width:le,height:he}=Q;const Ve=(Q.parentNode.parentNode.rotation%360+360)%360/90,ee=devicePixelRatio;if(1===Ve?ie-=he:2===Ve?(ie-=le,oe-=he):3===Ve&&(oe-=le),1===Ve||3===Ve){const ke=le;le=he,he=ke}return{x:ie*ee,y:oe*ee,width:le*ee,height:he*ee}}(k);l.save(),l.setTransform(m,v,_,b,S,I),l.beginPath(),l.moveTo(j,W),l.lineTo(j+J,W),l.lineTo(j+J,W+K),l.lineTo(j,W+K),l.closePath(),l.restore(),l.clip()}}class F2e extends Na{render(l,u){"hidden"!==l.parsedStyle.visibility&&(oZ(l,u),super.render(l,u))}}class sZ{init(l){[{name:"annotationArc",renderer:new b2e},{name:"annotationCircle",renderer:new x2e},{name:"annotationEllipse",renderer:new w2e},{name:"annotationLine",renderer:new S2e},{name:"annotationImage",renderer:new I2e},{name:"annotationInk",renderer:new E2e},{name:"annotationPolygon",renderer:new D2e},{name:"annotationPolyline",renderer:new A2e},{name:"annotationRect",renderer:new P2e},{name:"annotationText",renderer:new k2e},{name:"annotationFreeText",renderer:new M2e},{name:"annotationGroup",renderer:new T2e},{name:"annotationStamp",renderer:new R2e},{name:"annotationControls",renderer:new O2e},{name:"annotationLineControls",renderer:new F2e}].forEach(u=>{let{name:f,renderer:g}=u;l.contextService.registerShapeRenderer(f,g)})}destroy(){}}function R_(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vn.displayResolution;const u={left:0,top:0,width:p.imageWidth/p.imageXResolution*l,height:p.imageHeight/p.imageYResolution*l};return{fileIndex:0,mediaBox:u,cropBox:qe({},u),resource:{data:p.imageData,width:p.imageWidth,height:p.imageHeight,resolutionX:p.imageXResolution,resolutionY:p.imageYResolution,bitDepth:p.imageBitDepth}}}class s2 extends x_{constructor(){super(),N(this,"type","imageParser"),N(this,"once",!1),N(this,"imgReader",void 0),N(this,"isDestroy",!1),N(this,"source",void 0),N(this,"parserOptions",void 0),this.imgReader=new Sv}initParser(l,u){this.source={fileSource:l},u&&(this.parserOptions=u)}getPageCount(){return Fe(function*(){return 1})()}destroy(){var l;null===(l=this.imgReader)||void 0===l||l.destroy(),this.imgReader=null,this.isDestroy=!0}parse(){var l=this;return Fe(function*(){return l.isDestroy?null:[R_(yield l.imgReader.readImageInfo(l.source))]})()}getPage(){var l=this;return Fe(function*(){var u;if(l.isDestroy)return null;const f={"image/jpeg":La.IT_JPG,"image/png":La.IT_PNG,"image/bmp":La.IT_BMP},{outputType:g,jpegQuality:m,returnBase64:v}=null!==(u=l.parserOptions)&&void 0!==u?u:{},_=yield l.imgReader.readImage({source:l.source,outputType:null!=g?g:f[l.source.fileSource.type],jpegQuality:m,returnBase64:v});return _?R_(_):null})()}cancelGetPage(l){var u;if(this.isDestroy)return;const{outputType:f}=null!==(u=this.parserOptions)&&void 0!==u?u:{};this.imgReader.cancelReadImage(this.source,f)}}class L2e{constructor(){N(this,"type","tiffParser"),N(this,"once",!1),N(this,"imgReader",void 0),N(this,"parserOptions",void 0),N(this,"source",void 0),N(this,"isDestroy",!1),this.imgReader=new Sv}initParser(l,u){this.source={fileSource:l},u&&(this.parserOptions=u)}getPageCount(){var l=this;return Fe(function*(){return l.imgReader.getTiffPageCount(l.source)})()}destroy(){var l;null===(l=this.imgReader)||void 0===l||l.destroy(),this.imgReader=void 0,this.isDestroy=!0}parse(l){var u=this;return Fe(function*(){return u.isDestroy||!u.source?null:(yield u.imgReader.readTiffPageInfo(u.source,l)).map(f=>{const g=R_(f);return g.fileIndex=f.pageIndex,g})})()}getPage(l){var u=this;return Fe(function*(){var f;if(u.isDestroy||!u.source)return null;const{outputType:g,returnBase64:m}=null!==(f=u.parserOptions)&&void 0!==f?f:{},v=yield u.imgReader.readTiffPage({source:u.source,index:l,outputType:g,returnBase64:m});if(v){const _=R_(v);return _.fileIndex=v.pageIndex,_}return null})()}cancelGetPage(l){!this.isDestroy&&this.source&&this.imgReader.cancelReadTiffPage(this.source,l)}}function k_(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=jd(p),g=l||1;if(Di(f)&&f[0]&&f[0]instanceof S_){const I=f[0].value.steps,{length:k}=f[0].value.steps,O=[0,0,0];I.forEach(W=>{const J=jd(W.color);O[0]+=J.r,O[1]+=J.g,O[2]+=J.b});const j=[O[0]/k,O[1]/k,O[2]/k];return u&&(j[3]=255),j}const{r:m,g:v,b:_,alpha:b}=f,S=[m,v,_];return u&&(S[3]=Math.floor(b*g*255+.5)),S}function M_(p,l){return{strokeColor:p?k_(p,1,!1):null,fillColor:l?k_(l,1,!1):null}}function Rv(p,l,u){let f,g;return f=p?k_(p,u,!0):null,g=l?k_(l,u,!0):null,{apStrokeColor:f,apFillColor:g}}function kv(p,l,u){const f=p.value?p.value/u:0,g=Mv(l||[],u);return g.length?{width:f,style:"D",dash:g}:{width:f}}function aZ(p){const l=p.getLocalTransform().clone(),{a:u,b:f,c:g,d:m}=l;return[a2(u),-a2(f),-a2(g),a2(m),0,0]}function lZ(p,l){const{min:u,max:f}=Math;let g=p[0][0],m=p[0][1],v=p[0][0],_=p[0][1];for(let b=1;b<p.length;b++){const S=p[b];g=u(g,S[0]),v=f(v,S[0]),_=u(_,S[1]),m=f(m,S[1])}return g===v&&(g-=1,v+=1),_===m&&(_-=1,m+=1),[g-l/2,_-l/2,v+l/2,m+l/2]}function Gg(p,l,u,f,g,m){const v=[],_=fp(l),b=u/2,S=[{x:_.left-b*f,y:_.bottom+b*g},{x:_.right+b*f,y:_.bottom+b*g},{x:_.right+b*f,y:_.top-b*g},{x:_.left-b*f,y:_.top-b*g}],I=p.getLocalTransform();return S.forEach(k=>{const O=I.transformPoint({x:k.x,y:k.y});v.push([O.x/f,m-O.y/g])}),lZ(v,0)}function cZ(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const u=[],{length:f}=p;if(f>50&&l){const g=Math.floor(f/2),m=Math.floor(f/4);u.push(p[0][0],p[0][1]),u.push(p[m][0],p[m][1]),u.push(p[g][0],p[g][1]),u.push(p[f-m][0],p[f-m][1]),u.push(p[f-1][0],p[f-1][1]),u.push(p[0][0],p[0][1])}else p.forEach(g=>{u.push(g[0],g[1])});return u}function N2e(p){const l=[];for(let u=0;u<p.length;u++){const f=[];p[u].forEach(g=>{f.push(g[0],g[1])}),l.push(f)}return l}function Mv(p,l){return p?2===p.length&&0===p[0]&&0===p[1]?[]:p.map(u=>u/l):[]}function B2e(p){return Math.max(["butt","round","square"].indexOf(p),0)}function W2e(p){return Math.max(["miter","round","bevel"].indexOf(p),0)}function uZ(p){const l=[],u=p.getLocalTransform();return p.renderPath.forEach(f=>{const g=u.transformPoint({x:f.x,y:f.y});l.push({x:g.x,y:g.y})}),l}function U2e(p,l){const u=jd(p);let f=0,g=0,m=99999,v=99999;if(Di(u)&&u[0]&&u[0]instanceof S_){const _=(k=>{const O=k.match(/(to\s+\w+\s+\w+)|(#\w+)/g);if(!O)return null;const j=O[0],W=O.slice(1);return{direction:j.replace(/\s+/g," ").trim(),colors:W.map(J=>J.trim())}})(p);l.forEach(k=>{f=Math.max(f,k[0]),m=Math.min(m,k[0]),g=Math.max(g,k[1]),v=Math.min(v,k[1])});const b=[m,g,f,v];_.direction.includes("left")&&(b[0]=f,b[2]=m),_.direction.includes("top")&&(b[1]=v,b[3]=g);const S=jd(_.colors[0]),I=jd(_.colors[1]);return{coords:b,extend:[!0,!0],function:[{bounds:[],domain:[0,1],encode:[0,1],functions:[{c0:[S.r/255,S.g/255,S.b/255],c1:[I.r/255,I.g/255,I.b/255],domain:[0,1],n:1,type:"exponentialInterpolation"}],type:"stitching"}],shadingType:"axial",type:"shading"}}return null}function zg(p){return p.map(l=>l.toLowerCase())}function dZ(p,l,u,f,g){const{width:m,height:v}=p.parsedStyle;let _=m.value,b=v.value;if(p instanceof or){const{width:K,height:Q}=p.getBoundingRect();_=K,b=Q}const{x:S,y:I}=p.getLocalPosition(),k=l/2,O=S/u,j=g-I/f,W=_/u,J=b/f;return[[O+k,j-J+k,2,!1],[O+W-k,j-J+k,0,!1],[O+W-k,j-k,0,!1],[O+k,j-k,0,!1],[O+k,j-J+k,0,!0]]}function hZ(p,l,u,f){p.renderPath||p.getPath();const{renderPath:g}=p,m=[],{x:v,y:_}=p.getLocalPosition();let b=[];for(let S=0;S<g.length;S++){const{step:I,close:k}=g[S],O=(g[S].x+v)/l,j=f-(g[S].y+_)/u;0!==S?0!==I||0===S?b.push([O,j,0,k]):(m.push(b),b=[],b.push([O,j,2,k])):b.push([O,j,2,k])}return m.push(b),m}function fZ(p,l,u,f){const g=p.childNodes,m=[];for(let v=0;v<g.length;v++){if(!(g[v]instanceof n2))continue;const _=[],{renderPath:b}=g[v],{x:S,y:I}=g[v].getLocalPosition();b.forEach((k,O)=>{const j=[(k.x+S)/l,f-(k.y+I)/u,k.step,!1];O===b.length-1&&(j[3]=!0),_.push(j)}),m.push(_)}return m}function Ov(p,l,u,f,g,m,v){let _=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const{lineDash:b}=p.parsedStyle,S=aZ(p),I=lZ(m,g),k=[];return _&&k.push(O_(p,m,l,u,g,Mv(b,v))),{bbox:I,matrix:S,transform:I,objs:k}}function O_(p,l,u,f,g,m){const{miterLimit:v,lineCap:_,lineJoin:b}=p.parsedStyle;return{dashArray:m,dashPhase:0,fillColor:u||[0,0,0,0],fillType:u?2:0,isStroke:g>0,lineCap:B2e(_),lineJoin:W2e(b),lineWidth:g,miterLimit:v,objMatrix:[1,0,0,1,0,0],segments:l,strokeColor:f||[0,0,0,0],type:"path"}}function V2e(p,l,u,f){const{fontSize:g,fontFamily:m,fontWeight:v,fontStyle:_,opacity:b,text:S}=p.parsedStyle,{color:I,borderColor:k}=p.style,{x:O,y:j}=p.getLocalPosition(),{fillColor:W,strokeColor:J}=M_(k,I),K=pZ(v),Q="italic"===_;return{type:"text",charSpace:0,wordSpace:0,fillColor:W?[...W,255*b]:[0,0,0,255],strokeColor:J?[...J,255*b]:[0,0,0,255],fontName:m,renderMode:0,fontIsBold:K,fontIsItalic:Q,fontSize:g.value/l,fontPitchFamily:16,text:S,position:[O/l,j/u],objMatrix:[1,0,0,1,O/l,f-j/u]}}function a2(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;const u=p.toFixed(l);return Number.parseFloat(u)}function pZ(p){return"bold"===p||Xt(p)&&p>=600}function l2(p,l,u){return p.replace(new RegExp(l,"g"),u)}function c2(p,l,u,f,g){const{segments:m,lineWidth:v,strokeColor:_,fillType:b,fillColor:S,dashArray:I,lineCap:k,lineJoin:O,miterLimit:j,isStroke:W,pattern:J}=p,K={type:"path",stampPoints:j2e(m,u,f,g),borderWidth:W?(v||1)*u:0,borderColor:gs(_,l),background:b>0?gs(S,l):null,lineDash:zh(I,u),lineCap:Fv(k),lineJoin:Lv(O),miterLimit:j};return J&&(K.background=function(Q,ie,oe,le){var he,_e,Ve,ee;const{coords:ke,type:xe}=Q;if("shading"!==xe)return null;const Le_y=le-ke[1]*oe,V_y=le-ke[3]*oe;if(!Q||null==Q||!Q.function||null==Q||null===(he=Q.function[0])||void 0===he||!he.functions)return null;let $=null==Q||null===(_e=Q.function[0])||void 0===_e||null===(_e=_e.functions[0])||void 0===_e?void 0:_e.c0,P=null==Q||null===(Ve=Q.function[0])||void 0===Ve||null===(Ve=Ve.functions[0])||void 0===Ve?void 0:Ve.c1;if(!$||!P)return null;const L=(null==Q||null===(ee=Q.function[0])||void 0===ee?void 0:ee.encode)||[1,0];if(L[0]>L[L.length-1]){const Z=P;P=$,$=Z}const ne=`rgb(${255*P[0]},${255*P[1]},${255*P[2]})`;return`linear-gradient(to ${ke[0]*ie<ke[2]*ie?"right":"left"} ${Le_y===V_y?"":Le_y<V_y?"bottom":"top"}, ${qE(`rgb(${255*$[0]},${255*$[1]},${255*$[2]})`)}, ${qE(ne)})`}(J,u,f,g)||K.background),K}function u5(p,l,u,f,g){const{text:m,renderMode:v,fontIsBold:_,fontIsItalic:b,fillColor:S,fontSize:I,fontName:k,strokeColor:O,objMatrix:j}=p,W=new so(j),{scale:J}=W.decompose(),K=function(Q,ie,oe,le,he,_e){const Ve=Gh(Q,ie,[1,0,0,1,0,0]);return[Ve[0]*oe,(he-Ve[1])*le]}(j[4],j[5],u,f,g);return{type:"text",text:m,color:gs(S,l),borderWidth:v?u:"0px",borderColor:gs(O,l),fontWeight:_?"bold":"normal",fontStyle:b?"italic":"normal",fontSize:I*u*Math.abs(J.x),fontFamily:k,textBaseLine:"alphabetic",x:K[0],y:K[1]+Math.floor(I*u*Math.abs(J.x))}}function gZ(p,l,u){const f=function(_,b){const S=_.replace(/[^A-Za-z0-9\+\/]/g,""),I=S.length,k=3*I+1>>>2,O=new Uint8Array(k);for(let j,W,J=0,K=0,Q=0;Q<I;Q++)if(W=3&Q,J|=H2e(S.charCodeAt(Q))<<18-6*W,3===W||I-Q==1){for(j=0;j<3&&K<k;j++,K++)O[K]=J>>>(16>>>j&24)&255;J=0}return O}(p),g=new ImageData(new Uint8ClampedArray(f),l,u);let m=document.createElement("canvas");m.width=l,m.height=u,m.getContext("2d").putImageData(g,0,0);const v=m.toDataURL();return m=null,v}function Gh(p,l,u){return[u[0]*p+u[2]*l+u[4],u[1]*p+u[3]*l+u[5]]}function Jc(p,l,u,f,g,m){let v=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const _=new so(u),b=_.decompose(),S={x:(l[2]+l[0])/2,y:(l[1]+l[3])/2},I=(l[2]-l[0])/2,k=(l[1]-l[3])/2,O=_.transformPoint(S),j={x:(O.x-I)*f,y:(m-O.y+k)*g},W=-b.rotation.z,J={x:b.scale.x,y:b.scale.y};let K=j;var Q;return v&&(K=null!==(Q=function(ie,oe,le,he,_e,Ve){const ee=[];let ke=!0;if(ie.forEach(xe=>{let Le;"path"===xe.type?(Le=c2(xe,1,he,_e,Ve),ke=!1):"text"===xe.type&&(Le=u5(xe,1,he,_e,Ve),ke=!1),Le&&ee.push(Le)}),ke)return null;if(ee.length){const xe=function(Le,V,F,z,$){const P_x=V[0]*F,P_y=($-V[3])*z,L=[],X=[];return Le.forEach(te=>{if("path"!==te.type)return;const{borderWidth:ae,stampPoints:fe,lineCap:be}=te;if(2===fe.length){const Pe=zx(fe[0],fe[1],ni(ae).value,be);L.push(Pe.x,Pe.x+Pe.width),X.push(Pe.y,Pe.y+Pe.height)}else{const Pe=fp(fe),De=ni(ae).value/2,Xe=Pe.left-De,Re=Pe.top-De,de=Pe.height+2*De;L.push(Xe,Xe+(Pe.width+2*De)),X.push(Re,Re+de)}}),0===L.length?{offsetX:0,offsetY:0}:{offsetX:Math.min(...L)-P_x,offsetY:Math.min(...X)-P_y}}(ee,oe,he,_e,Ve);le.x+=xe.offsetX,le.y+=xe.offsetY}return le}(p,l,qe({},j),f,g,m))&&void 0!==Q?Q:K),{position:K,angle:W,scale:J}}function d5(p,l,u,f){const g=[];return p.forEach(m=>{g.push({x:m[0]*l,y:(f-m[1])*u})}),g}function j2e(p,l,u,f){const g=[];return p.forEach(m=>{g.push({x:m[0]*l,y:(f-m[1])*u,step:m[2]})}),g}function Fv(p){return["butt","round","square"][null!=p?p:0]}function Lv(p){return["miter","round","bevel"][null!=p?p:0]}function gs(p,l){return p.length<3?null:4===p.length?`rgba(${p.slice(0,3).join()},${p[3]/255/(l||1)})`:`rgb(${p.join()})`}function zh(p,l){return p&&0!==p.length?p.map(u=>u*l):[0,0]}function zu(p){let l=[];for(let u=0;u<p.length;u++)p[u]instanceof Array?l=l.concat(zu(p[u])):l.push(hn(p[u]));return l}function H2e(p){return p>64&&p<91?p-65:p>96&&p<123?p-71:p>47&&p<58?p+4:43===p?62:47===p?63:0}function Zx(p,l){if(!p)return"";let u="";return p.split(";").forEach(f=>{const g=f.split(":");g[0].trim()===l&&(u=g[1].trim())}),u}function mZ(p){if(!p)return{contents:[],textStyle:{}};const l=new DOMParser,u='xmlns="http://www.w3.org/1999/xhtml"';let f=p;p.includes('xmlns="')||(f=p.replace(/<body/,`<body ${u}`)),f=l2(f,'xmlns=""',u);const g=l.parseFromString(f,"text/xml"),m=g.getElementsByTagName("body")[0],v=g.getElementsByTagName("span"),_=g.getElementsByTagName("p"),b=ie=>{for(const oe in ie)null!=ie[oe]&&""!==ie[oe]||delete ie[oe];return ie},{color:S,fontFamily:I,fontSize:k,fontWeight:O,fontStyle:j,textDecoration:W}=m.style,J=b({color:S,fontFamily:I,fontSize:k,fontWeight:O,fontStyle:j,lineThrough:W.includes("line-through"),underline:W.includes("word")||W.includes("underline")}),K=[];return(ie=>{for(let oe=0;oe<ie.length;oe++){const le=ie[oe],{color:he,fontFamily:_e,fontSize:Ve,fontStyle:ee,fontWeight:ke}=le.style||{},xe=Zx(le.getAttribute("style"),"text-decoration"),Le=b({content:le.textContent,color:he,fontFamily:_e,fontSize:Ve,fontWeight:ke,fontStyle:ee,lineThrough:xe.includes("line-through")||void 0,underline:xe.includes("word")||xe.includes("underline")||void 0});K.push(Le)}})(v.length?v:_),{textStyle:J,contents:K}}class G2e{constructor(){N(this,"pageWidth",void 0),N(this,"pageHeight",void 0),N(this,"ratioX",0),N(this,"ratioY",0)}setParserConfig(l,u,f,g){this.pageWidth=l,this.pageHeight=u,this.ratioX=f,this.ratioY=g}parseAnnotation(l){let u=null;switch(l.type){case"FreeText":u=l.intent&&"FreeText"!==l.intent?"freetexttypewriter"===l.intent.toLocaleLowerCase()?this.parseFreeText(l):this.parseIncomplete(l):this.parseTextBox(l);break;case"Circle":u=this.parseCircle(l);break;case"Square":u=this.parseRect(l);break;case"Line":u=l.intent&&"linedimension"===l.intent.toLocaleLowerCase()?this.parseIncomplete(l):this.parseLine(l);break;case"Polygon":u=!l.intent||"polygondimension"!==l.intent.toLocaleLowerCase()&&"polygoncloud"!==l.intent.toLocaleLowerCase()?this.parsePolygon(l):this.parseIncomplete(l);break;case"PolyLine":u=l.intent&&"polylinedimension"===l.intent.toLocaleLowerCase()?this.parseIncomplete(l):this.parsePolyline(l);break;case"Ink":u=this.parseInk(l);break;case"Stamp":u=this.parseStamp(l);break;case"Highlight":u=this.parseTextAssist(l,"highlight");break;case"StrikeOut":u=this.parseTextAssist(l,"strikeout");break;case"Underline":u=this.parseTextAssist(l,"underline");break;default:u=l.normalAppearance?this.parseIncomplete(l):this.parseUnknown(l)}if(u||(u=l.normalAppearance?this.parseIncomplete(l):this.parseUnknown(l)),u){var f;const{opacity:g}=l,m=u.style;if(u.raw=l,m.opacity=Xt(m.opacity)?m.opacity:null!=g?g:1,null!=l&&l.normalAppearance){const{blendMode:v}=l.normalAppearance;u.style.renderBlendMode=v.toLowerCase()}null!==(f=u)&&void 0!==f&&f.transform&&u.transform.angle<0&&(u.transform.angle+=360),u.uid=Ai()}return u}parseFreeText(l){const{normalAppearance:u,richText:f,rect:g,defaultAppearanceData:m,defaultStyle:v}=l,{objs:_,transform:b,bbox:S}=u,{ratioX:I,ratioY:k,pageHeight:O}=this,{position:j,angle:W,scale:J}=Jc(0===_.length?null:zu(_),S,b,I,k,O,!1),{x:K,y:Q}=j;let ie;(Math.round(W)+360)/90%2==0?(ie=(g[2]-g[0])*this.ratioX+12,ie+K>this.pageWidth*this.ratioX&&(ie=this.pageWidth*this.ratioX-K)):(ie=(g[3]-g[1])*this.ratioY,ie+K>this.pageHeight*this.ratioY&&(ie=this.pageHeight*this.ratioY-K));const{fontName:oe,fontSize:le,fontColor:he}=m,_e={content:"",fontFamily:oe,color:Zx(v,"color")||`rgb(${he[0]},${he[1]},${he[2]})`,fontSize:le},Ve=mZ(f),ee=[];return Ve.contents.forEach(ke=>{const xe=qe(qe(qe({},_e),Ve.textStyle),ke),Le=ni(xe.fontSize);xe.fontFamily=xe.fontFamily.replace(/^"|"$/g,""),(Xt(xe.fontSize)||"pt"===Le.unit)&&(xe.fontSize=Le.value*this.ratioX),ee.push(xe)}),{type:"textTypewriter",style:{x:K,y:Q,width:ie,textContents:ee},transform:{scale:J,angle:W},iconColor:_e.color}}parseTextBox(l){const{normalAppearance:u,richText:f,defaultAppearanceData:g,defaultStyle:m,opacity:v}=l;if(!u)return null;const{objs:_,transform:b,bbox:S}=u;if(!_||0===_.length)return null;const{fillType:I,fillColor:k,dashArray:O,isStroke:j,lineWidth:W,strokeColor:J,segments:K}=_[0],{ratioX:Q,ratioY:ie,pageHeight:oe}=this,{position:le,angle:he,scale:_e}=Jc(zu(_),S,b,Q,ie,oe,"path"===_[0].type),Ve="path"===_[0].type?(K[1][0]-K[0][0]+W)*this.ratioX:(S[2]-S[0])*this.ratioX,ee="path"===_[0].type?(K[2][1]-K[0][1]+W)*this.ratioY:(S[3]-S[1])*this.ratioY,{x:ke,y:xe}=le,{fontName:Le,fontSize:V,fontColor:F}=g,z={content:"",fontFamily:Le,color:Zx(m,"color")||`rgb(${F[0]},${F[1]},${F[2]})`,fontSize:V},$=mZ(f);let P=Zx(f,"text-align")||Zx(m,"text-align");"justify-center"===P&&(P="justify");const L=[];if($.contents.forEach(X=>{const ne=qe(qe(qe({},z),$.textStyle),X),Z=ni(ne.fontSize);ne.fontFamily=ne.fontFamily.replace(/^"|"$/g,""),(Xt(ne.fontSize)||"pt"===Z.unit)&&(ne.fontSize=Z.value*this.ratioX),L.push(ne)}),0===L.length&&l.contents){const X=Ht(qe({},z),{content:l.contents});Xt(X.fontSize)&&(X.fontSize*=this.ratioX),L.push(X)}return{type:"textBox",style:{x:ke,y:xe,width:Ve,height:ee,borderWidth:j?(W||1)*this.ratioX:0,borderColor:gs(J,v),background:I>0?gs(k,v):"",lineDash:zh(O,this.ratioX),textContents:L,textAlign:P},transform:{scale:_e,angle:he},iconColor:z.color}}parseCircle(l){const{normalAppearance:u,opacity:f,color:m,interiorColor:v,borderStyle:_}=l,{objs:b,transform:S,bbox:I}=u,{ratioX:k,ratioY:O,pageHeight:j}=this;let W;if(0===b.length){var J;const{position:K,angle:Q,scale:ie}=Jc(null,I,S,k,O,j,!1),{x:oe,y:le}=K,he=(I[2]-I[0])*this.ratioX,_e=(I[3]-I[1])*this.ratioY,Ve=gs(m||[0,0,0],f),ee=v?gs(v,f):"";W={type:"ellipse",style:{x:oe,y:le,width:he,height:_e,borderWidth:(null!==(J=null==_?void 0:_.width)&&void 0!==J?J:1)*this.ratioX,borderColor:Ve,background:v?ee:"",lineDash:zh(null==_?void 0:_.dash,this.ratioX)},transform:{angle:Q,scale:ie},iconColor:v?ee:Ve}}else{if("path"!==b[0].type)return null;{const{fillColor:K,strokeColor:Q,lineWidth:ie,dashArray:oe,fillType:le,isStroke:he}=b[0],{position:_e,angle:Ve,scale:ee}=Jc(zu(b),I,S,k,O,j),{x:ke,y:xe}=_e,Le=(I[2]-I[0])*this.ratioX,V=(I[3]-I[1])*this.ratioY,F=gs(Q,f),z=gs(K,f);W={type:"ellipse",style:{x:ke,y:xe,width:Le,height:V,borderWidth:he?(ie||1)*this.ratioX:0,borderColor:F,background:le>0?z:"",lineDash:zh(oe,this.ratioX)},transform:{angle:Ve,scale:ee},iconColor:le>0?z:F}}}return W}parseRect(l){const{normalAppearance:u,opacity:f,color:m,interiorColor:v,borderStyle:_}=l,{objs:b,transform:S,bbox:I}=u,{ratioX:k,ratioY:O,pageHeight:j}=this;let W;if(0===b.length){var J;const{position:K,angle:Q,scale:ie}=Jc(null,I,S,k,O,j,!1),{x:oe,y:le}=K,he=(I[2]-I[0])*this.ratioX,_e=(I[3]-I[1])*this.ratioY,Ve=gs(m||[0,0,0],f),ee=v?gs(v,f):"";W={type:"rectangle",style:{x:oe,y:le,width:he,height:_e,borderWidth:(null!==(J=null==_?void 0:_.width)&&void 0!==J?J:1)*this.ratioX,borderColor:Ve,background:ee,lineDash:zh(null==_?void 0:_.dash,this.ratioX),lineCap:Fv(0),lineJoin:Lv(0)},transform:{scale:ie,angle:Q},iconColor:v?ee:Ve}}else{const{fillColor:K,strokeColor:Q,lineWidth:ie,dashArray:oe,isStroke:le,fillType:he,segments:_e,lineCap:Ve,lineJoin:ee}=b[0],{position:ke,angle:xe,scale:Le}=Jc(zu(b),I,S,k,O,j),{x:V,y:F}=ke,z=(_e[1][0]-_e[0][0]+ie)*this.ratioX,$=(_e[2][1]-_e[0][1]+ie)*this.ratioY,P=gs(Q,f),L=gs(K,f);W={type:"rectangle",style:{x:V,y:F,width:z,height:$,borderWidth:le?(ie||1)*this.ratioX:0,borderColor:P,background:he>0?L:"",lineDash:zh(oe,this.ratioX),lineCap:Fv(Ve),lineJoin:Lv(ee)},transform:{scale:Le,angle:xe},iconColor:he>0?L:P}}return W}parseLine(l){const{normalAppearance:u,lineEnding:f,interiorColor:g,opacity:m}=l;if(!u)return null;const{objs:v,bbox:_}=u;let{transform:b}=u;if(0===v.length)return null;const{strokeColor:S,lineWidth:I,dashArray:k,lineCap:O,lineJoin:j,miterLimit:W,isStroke:J,segments:K}=v[0],{ratioX:Q,ratioY:ie,pageHeight:oe}=this;if(1!==Math.abs(b[0])||1!==Math.abs(b[3])){const ee=Gh(_[0],_[1],b),ke=Gh(_[2],_[3],b);v.forEach(xe=>{xe.segments.forEach(Le=>{const V=Gh(Le[0],Le[1],b);Le[0]=V[0],Le[1]=V[1]})}),_[0]=ee[0],_[1]=ee[1],_[2]=ke[0],_[3]=ke[1],b=[1,0,0,1,0,0]}const{position:le,angle:he,scale:_e}=Jc(zu(v),_,b,Q,ie,oe),Ve=gs(S,m);return{type:"line",style:{startPoint:{x:K[0][0]*this.ratioX,y:(this.pageHeight-K[0][1])*this.ratioY},endPoint:{x:K[1][0]*this.ratioX,y:(this.pageHeight-K[1][1])*this.ratioY},lineEnding:f||["None","None"],borderColor:Ve,borderWidth:J?(I||1)*this.ratioX:0,background:g?gs(g,m):"",lineCap:Fv(O),lineJoin:Lv(j),miterLimit:W,lineDash:zh(k,this.ratioX)},transform:{position:le,scale:_e,angle:he},iconColor:Ve}}parsePolygon(l){const{normalAppearance:u,opacity:f}=l,{objs:g,bbox:m}=u;let{transform:v}=u;if(0===g.length)return null;const{dashArray:_,fillColor:b,fillType:S,lineCap:I,lineJoin:k,lineWidth:O,miterLimit:j,segments:W,strokeColor:J}=g[0],{ratioX:K,ratioY:Q,pageHeight:ie}=this;if(1!==Math.abs(v[0])||1!==Math.abs(v[3])){const Le=Gh(m[0],m[1],v),V=Gh(m[2],m[3],v);g.forEach(F=>{F.segments.forEach(z=>{const $=Gh(z[0],z[1],v);z[0]=$[0],z[1]=$[1]})}),m[0]=Le[0],m[1]=Le[1],m[2]=V[0],m[3]=V[1],v=[1,0,0,1,0,0]}const{position:oe,angle:le,scale:he}=Jc(zu(g),m,v,K,Q,ie),_e=d5(W,this.ratioX,this.ratioY,this.pageHeight),Ve=gs(J,f),ee=gs(b,f);var ke,xe;return _e.length>2&&(ke=_e[0]).x===(xe=_e[_e.length-1]).x&&ke.y===xe.y&&_e.pop(),{type:"polygon",style:{points:_e,borderWidth:(O||0)*this.ratioX,borderColor:Ve,background:S>0?ee:"",lineDash:zh(_,this.ratioX),lineCap:Fv(I),lineJoin:Lv(k),miterLimit:j},transform:{position:oe,scale:he,angle:le},iconColor:S>0?ee:Ve}}parsePolyline(l){const{normalAppearance:u,interiorColor:f,opacity:g}=l,{objs:m,bbox:v}=u;let{transform:_}=u;if(0===m.length)return null;const{dashArray:b,lineCap:S,lineJoin:I,lineWidth:k,miterLimit:O,segments:j,strokeColor:W,isStroke:J}=m[0],{ratioX:K,ratioY:Q,pageHeight:ie}=this;if(1!==Math.abs(_[0])||1!==Math.abs(_[3])){const ee=Gh(v[0],v[1],_),ke=Gh(v[2],v[3],_);m.forEach(xe=>{xe.segments.forEach(Le=>{const V=Gh(Le[0],Le[1],_);Le[0]=V[0],Le[1]=V[1]})}),v[0]=ee[0],v[1]=ee[1],v[2]=ke[0],v[3]=ke[1],_=[1,0,0,1,0,0]}const{position:oe,angle:le,scale:he}=Jc(zu(m),v,_,K,Q,ie),_e=d5(j,this.ratioX,this.ratioY,this.pageHeight),Ve=gs(W,g);return{type:"polyline",style:{points:_e,borderWidth:J?(k||1)*this.ratioX:0,borderColor:Ve,background:f?gs(f,g):"",lineDash:zh(b,this.ratioX),lineCap:Fv(S),lineJoin:Lv(I),lineEnding:l.lineEnding||["None","None"],miterLimit:O},transform:{position:oe,scale:he,angle:le},iconColor:Ve}}parseInk(l){const{normalAppearance:u,inkList:f,opacity:g}=l,{objs:m,transform:v,bbox:_}=u;if(0===m.length||!f)return null;const{dashArray:b,lineCap:S,fillColor:I,lineJoin:k,lineWidth:O,miterLimit:j,strokeColor:W,fillType:J,isStroke:K}=m[0],Q=[];for(let ke=0;ke<f.length;ke++){const xe=f[ke],Le=[];for(let F=0;F<xe.length;F+=2)Le.push([xe[F],xe[F+1],1,!1]);const V=d5(Le,this.ratioX,this.ratioY,this.pageHeight);Q.push(V)}const{ratioX:ie,ratioY:oe,pageHeight:le}=this,{position:he,angle:_e,scale:Ve}=Jc(zu(m),_,v,ie,oe,le),ee=gs(W,g);return{type:"ink",style:{segments:Q,borderWidth:K?(O||1)*this.ratioX:0,borderColor:ee,background:J>0?gs(I,g):"",lineDash:zh(b,this.ratioX),lineCap:Fv(S),lineJoin:Lv(k),miterLimit:j},transform:{position:he,scale:Ve,angle:_e},iconColor:ee}}parseStamp(l){const{icon:u,opacity:f}=l,{objs:g,transform:m,bbox:v}=l.normalAppearance;if(0===g.length)return null;const _=zu(g),b=[],{ratioX:S,ratioY:I,pageHeight:k}=this,{position:O,angle:j,scale:W}=Jc(_,v,m,S,I,k),J={position:O,angle:j,scale:W};for(let K=0;K<_.length;K++){let Q;if("path"===_[K].type&&(Q=c2(_[K],f,this.ratioX,this.ratioY,this.pageHeight)),"text"===_[K].type&&(Q=u5(_[K],f,this.ratioX,this.ratioY,this.pageHeight)),"image"===_[K].type){let ie;return ie=_[K].jpegBase64?`data:image/jpeg;base64,${_[K].jpegBase64}`:gZ(_[K].RGBABase64,_[K].width,_[K].height),{type:"stamp",style:{imageData:ie,width:v[2]*this.ratioX,height:v[3]*this.ratioY},transform:J}}Q&&b.push(Q)}return{type:"stamp",style:{iconName:u,stampConfig:b},transform:J,iconColor:"#868E96"}}parseTextAssist(l,u){const{objs:f,transform:g,bbox:m}=l.normalAppearance,{opacity:v}=l;if(0===f.length)return null;const _=zu(f),b=[],{ratioX:S,ratioY:I,pageHeight:k}=this,{position:O,angle:j,scale:W}=Jc(_,m,g,S,I,k),J={position:O,angle:j,scale:W};for(let K=0;K<_.length;K++){let Q;"path"===_[K].type&&(Q=c2(_[K],v,this.ratioX,this.ratioY,this.pageHeight)),Q&&b.push(Q)}return{type:u,style:{opacity:v||1,stampConfig:b,annotationRaw:l},transform:J}}parseIncomplete(l){const{normalAppearance:u,opacity:f}=l;if(!u)return null;const{objs:g,transform:m,bbox:v}=l.normalAppearance;if(!g||0===g.length)return null;const _=zu(g),b=[],{ratioX:S,ratioY:I,pageHeight:k}=this,{position:O,angle:j,scale:W}=Jc(_,v,m,S,I,k),J={position:O,angle:j,scale:W};for(let K=0;K<_.length;K++){let Q;if("path"===_[K].type)Q=c2(_[K],f,S,I,k);else if("text"===_[K].type)Q=u5(_[K],f,S,I,k);else if("image"===_[K].type){let ie;return ie=_[K].jpegBase64?`data:image/jpeg;base64,${_[K].jpegBase64}`:gZ(_[K].RGBABase64,_[K].width,_[K].height),{type:"incomplete",style:{imageData:ie,width:v[2]*this.ratioX,height:v[3]*this.ratioY,annotationRaw:l},transform:J}}Q&&b.push(Q)}return{type:"incomplete",style:{stampConfig:b,annotationRaw:l},transform:J}}parseUnknown(l){return{type:"unknown",style:{annotationRaw:l}}}}class z2e{constructor(){N(this,"map",new Map),N(this,"ratioX",Vn.displayResolution/Vn.pdfResolution),N(this,"ratioY",Vn.displayResolution/Vn.pdfResolution)}toPdfAnnotations(l,u){var f=this;return Fe(function*(){const g=[],m=[...l];m.sort((v,_)=>v.layer-_.layer);for(let v=0;v<m.length;v++){const _=m[v];if(_){const b=yield f.toPdfAnnotation(_,{width:u.width/f.ratioX,height:u.height/f.ratioY});b&&(b.oriIndex=_.oriIndex,b.modified=_.modified,g.push(b))}}return g})()}toPdfAnnotation(l,u){var f=this;return Fe(function*(){if("stamp"===l.type&&l.style.imageData&&(!Xt(l.style.width)||!Xt(l.style.height))){const v=new Sv,_=yield v.readImageInfo({fileSource:l.style.imageData});let b=_.imageWidth,S=_.imageHeight;if(b>400||S>400){const I=Math.max(b/400,S/400);b/=I,S/=I}l.style.width=b,l.style.height=S}const g=f.createShape(l);if(g instanceof or&&"freeTextWriter"===g.textType){const{width:v,height:_}=g.getBoundingRect();g.setOrigin(v/2,_/2)}let m=null;switch(l.type){case"rectangle":case"ellipse":m=f.toPdfRectOrEllipse(l,u,g);break;case"polyline":case"polygon":m=f.toPdfPolygonal(l,u,g);break;case"line":m=f.toPdfLine(l,u,g);break;case"ink":m=f.toPdfInk(l,u,g);break;case"stamp":m=yield f.toPdfStamp(l,u,g);break;case"textBox":m=f.toPdfFreeText(l,u,g,"textBox");break;case"textTypewriter":m=f.toPdfFreeText(l,u,g,"freeTextWriter");break;case"highlight":m=f.toPdfTextAssist(l,"Highlight",u,g);break;case"underline":m=f.toPdfTextAssist(l,"Underline",u,g);break;case"strikeout":m=f.toPdfTextAssist(l,"StrikeOut",u,g);break;case"incomplete":m=l.style.annotationRaw}return m&&(m.title=l.comment.author,m.subject=l.comment.subject,m.creationdate=l.comment.creationDate),m})()}toPdfRectOrEllipse(l,u,f){const{borderColor:g,background:m,lineDash:v}=l.style,{borderWidth:_,opacity:b}=f.parsedStyle,{strokeColor:S,fillColor:I}=M_(g,m),{apStrokeColor:k,apFillColor:O}=Rv(g,m,b),j=kv(_,v,this.ratioX),W=j.width,K=Ov(f,O,k,b,W,"rectangle"===l.type?dZ(f,W,this.ratioX,this.ratioY,u.height):function(Q,ie,oe,le){const{x:he,y:_e}=Q.getLocalPosition();Q.path||Q.getPath();const{path:Ve}=Q,ee=[];for(let ke=0;ke<Ve.length;ke++){const xe=(Ve[ke].x+he)/ie,Le=le-(Ve[ke].y+_e)/oe;0===ke?(ee.push([xe,Le,2,!1]),ee.push([xe,Le,0,!1])):ee.push(ke===Ve.length-1?[xe,Le,1,!0]:[xe,Le,1,!1])}return ee}(f,this.ratioX,this.ratioY,u.height),this.ratioX);return f.path||f.getPath(),{type:"rectangle"===l.type?"Square":"Circle",normalAppearance:K,interiorColor:I,color:S,borderStyle:j,opacity:b,rect:Gg(f,f.path,W,this.ratioX,this.ratioY,u.height),flags:zg([...l.flags]),date:l.comment.modificationDate,name:l.uid,contents:""}}toPdfPolygonal(l,u,f){const{borderWidth:g,opacity:m}=f.parsedStyle,{borderColor:v,background:_,lineEnding:b,lineDash:S}=l.style,I="polyline"===l.type,{strokeColor:k,fillColor:O}=M_(v,_),{apStrokeColor:j,apFillColor:W}=Rv(v,_,m),J=kv(g,S,this.ratioX),K=J.width;let Q,ie,oe;I?(Q=hZ(f,this.ratioX,this.ratioY,u.height),ie=Q.flat(),oe=cZ(Q[0])):(Q=function(_e,Ve,ee,ke){_e.renderPath||_e.getPath();const{x:xe,y:Le}=_e.getLocalPosition(),{renderPath:V}=_e,F=[];for(let z=0;z<V.length;z++){const $=(V[z].x+xe)/Ve,P=ke-(V[z].y+Le)/ee;if(0!==z){if(z===V.length-1){F.push([$,P,0,!0]);break}F.push([$,P,0,!1])}else F.push([$,P,2,!1])}return F}(f,this.ratioX,this.ratioY,u.height),ie=Q,oe=cZ(ie));const le=Ov(f,W,j,m,K,ie,this.ratioX,!I);if(I){const _e=[];Q.forEach(Ve=>{_e.push(O_(f,Ve,W,j,K,Mv(S,this.ratioX)))}),le.objs=_e}const he={type:I?"PolyLine":"Polygon",borderStyle:J,color:k,interiorColor:O,normalAppearance:le,vertices:oe,opacity:m,rect:Gg(f,f.renderPath,K,this.ratioX,this.ratioY,u.height),name:l.uid,contents:"",flags:zg([...l.flags]),date:l.comment.modificationDate};return I&&f.isLineArrow()&&(he.lineEnding=b),he}toPdfLine(l,u,f){const{borderWidth:g,opacity:m}=f.parsedStyle,{borderColor:v,background:_,lineEnding:b,lineDash:S}=l.style,{strokeColor:I,fillColor:k}=M_(v,_),{apStrokeColor:O,apFillColor:j}=Rv(v,_,m),W=kv(g,S,this.ratioX),J=W.width,K=hZ(f,this.ratioX,this.ratioY,u.height),Q=K.flat(),ie=[];K.forEach(he=>{ie.push(O_(f,he,j,O,J,Mv(S,this.ratioX)))});const oe=Ov(f,j,O,m,J,Q,this.ratioX,!1);oe.objs=ie;const le={type:"Line",line:[Q[0][0],Q[0][1],Q[1][0],Q[1][1]],interiorColor:k,color:I,normalAppearance:oe,borderStyle:W,opacity:m,rect:Gg(f,f.renderPath,J,this.ratioX,this.ratioY,u.height),name:l.uid,contents:"",flags:zg([...l.flags]),date:l.comment.modificationDate,toJsonString:()=>""};return f.isLineArrow()&&(le.lineEnding=b,le.intent="LineArrow"),le}toPdfInk(l,u,f){const{borderWidth:g,opacity:m}=f.parsedStyle,{borderColor:v,background:_,lineDash:b}=l.style,{strokeColor:S}=M_(v,_),{apStrokeColor:I,apFillColor:k}=Rv(v,_,m),O=kv(g,b,this.ratioX),j=O.width,W=function(_e,Ve,ee,ke){_e.inkOriginalRenderPath||_e.getInkOriginalRenderPath();const{x:xe,y:Le}=_e.getLocalPosition(),{inkOriginalRenderPath:V}=_e,F=[];for(let z=0;z<V.length;z++){const $=V[z],P=[];for(let L=0;L<$.length;L++){const X=($[L].x+xe)/Ve,ne=ke-($[L].y+Le)/ee;P.push(0===L?[X,ne,2,!1]:[X,ne,1,!1])}if(P.length&&P.length<4)for(;P.length<4;)P.push([...P[P.length-1]]);F.push(P)}return F}(f,this.ratioX,this.ratioY,u.height),J=W.flat(),K=[],{x:Q,y:ie}=f.getLocalPosition();f.getPath();const{inkRenderSteps:oe}=f,le=[];oe.forEach(_e=>{const Ve=[];_e.forEach((ee,ke)=>{0===ke?Ve.push([(ee.data[0].x+Q)/this.ratioX,u.height-(ee.data[0].y+ie)/this.ratioY,2,!1]):ee.data.forEach(xe=>{Ve.push([(xe.x+Q)/this.ratioX,u.height-(xe.y+ie)/this.ratioY,1,!1])})}),le.push(Ve)}),le.forEach(_e=>{K.push(O_(f,_e,k,I,j,Mv(b,this.ratioX)))});const he=Ov(f,k,I,m,j,J,this.ratioX,!1);return he.objs=K,{type:"Ink",color:S,normalAppearance:he,borderStyle:O,opacity:m,inkList:N2e(W),rect:Gg(f,f.inkOriginalRenderPath.flat(),j,this.ratioX,this.ratioY,u.height),name:l.uid,contents:"",flags:zg([...l.flags]),date:l.comment.modificationDate}}toPdfStamp(l,u,f){var g=this;return Fe(function*(){const{imageData:m,iconName:v,opacity:_}=l.style;if(m)return yield g.toPdfStampImage(l,u,f);const b=f.childNodes,S=fZ(f,g.ratioX,g.ratioY,u.height),I=[],k=[];let O=0,j=0;for(let J=0;J<b.length;J++){let K;if(b[J].style.opacity=b[J].parsedStyle.opacity/(l.style.opacity||1),b[J]instanceof n2){const ie=uZ(b[J]);k.push(...ie);const{borderWidth:oe,lineDash:le}=b[J].parsedStyle,{borderColor:he,background:_e}=b[J].style,{apStrokeColor:Ve,apFillColor:ee}=Rv(he,_e,_),ke=kv(oe,le,g.ratioX).width,xe=U2e(_e,S[O]);j=Math.max(ke,j),K=O_(b[J],S[O],ee,Ve,ke,Mv(le,g.ratioX)),xe&&(K.pattern=xe),O+=1,I.push(K)}b[J]instanceof Yx&&(K=V2e(b[J],g.ratioX,g.ratioY,u.height),I.push(K))}const W=Ov(f,null,null,_,j,S.flat(),g.ratioX,!1);return W.objs=I,{type:"Stamp",icon:v,rect:Gg(f,k,j,g.ratioX,g.ratioY,u.height),normalAppearance:W,opacity:_,name:l.uid,contents:"",flags:zg([...l.flags]),date:l.comment.modificationDate}})()}toPdfStampImage(l,u,f){var g=this;return Fe(function*(){const{imageData:m,opacity:v}=l.style;let _=m,b=[];xn(m)&&(b=m.split(","),b[0].match(/:(.*?);/),_=function(J){let K=null;const Q=J.split(","),ie=Q[0].match(/:(.*?);/)[1],oe=window.atob(Q[1]);let le=oe.length;const he=new Uint8Array(le);for(;le--;)he[le]=oe.charCodeAt(le);return K=new Blob([he],{type:ie}),K}(m));const{width:S,height:I}=f.parsedStyle,k=aZ(f),O=[0,0,S.value/g.ratioX,I.value/g.ratioY],j=yield(J=Fe(function*(K,Q,ie,oe){const{width:le,height:he}=K.parsedStyle,_e=le.value/ie,Ve=he.value/oe;let ee;if("image/jpeg"===Q.type){const ke=new Sv,xe=yield ke.readImage({source:{fileSource:Q},outputType:1,returnBase64:!0});ke.destroy(),ee={type:"image",jpegBase64:xe.imageData,objMatrix:[_e,0,0,Ve,0,0],rect:[0,0,_e,Ve]}}else{const ke=new Sv,xe=yield ke.readImage({source:{fileSource:Q},outputType:-2,returnBase64:!0});ke.destroy(),ee={type:"image",RGBABase64:xe.imageData,height:xe.imageHeight,width:xe.imageWidth,objMatrix:[_e,0,0,Ve,0,0],rect:[0,0,_e,Ve]}}return ee}),function(K,Q,ie,oe){return J.apply(this,arguments)})(f,_,g.ratioX,g.ratioY),W=function(J,K,Q,ie){const{width:oe,height:le}=J.parsedStyle,{x:he,y:_e}=J.getLocalScale(),{x:Ve,y:ee}=J.getLocalPosition(),ke=J.getAngle();let z=new ps({style:{x:Ve+oe.value/2-oe.value*he*.5,y:ie*Q-le.value*_e-(ie*Q-le.value*_e*.5-(ee+le.value/2)),width:oe.value*he,height:le.value*_e}});z.setAngle(ke),z.getPath();const $=Gg(z,z.path,0,K,Q,ie);return z=null,$}(f,g.ratioX,g.ratioY,u.height);var J;return{type:"Stamp",normalAppearance:{bbox:O,matrix:k,objs:[j],transform:k},rect:W,opacity:v,name:l.uid,contents:"",flags:zg([...l.flags]),date:l.comment.modificationDate}})()}toPdfFreeText(l,u,f,g){const{opacity:m,textContents:v,borderColor:_,background:b,lineDash:S,textAlign:I}=l.style;"freeTextWriter"===g&&(f.style.borderWidth=0);const{borderWidth:k}=f.parsedStyle,{strokeColor:O,fillColor:j}=M_(_,b),{apStrokeColor:W,apFillColor:J}=Rv(_,b,m),K="textBox"===g?kv(k,S,this.ratioX):{width:0},Q=K.width,ie=Ov(f,J,W,m,Q,dZ(f,Q,this.ratioX,this.ratioY,u.height),this.ratioX,"textBox"===g),oe=function(Le,V,F,z){const{lines:$}=Le,{opacity:P}=Le.parsedStyle,L=[],X=(ne,Z,te)=>({type:"path",strokeColor:ne,fillColor:ne,fillType:0,isStroke:!0,lineCap:0,lineJoin:0,miterLimit:10,lineWidth:te,objMatrix:[1,0,0,1,0,0],segments:Z,dashArray:[],dashPhase:0});return $.forEach(ne=>{const Z=ne.height/30,te=Le.getTextAlignOffset(ne);ne.words.forEach(ae=>{const{fontFamily:fe,fontSize:be,fontStyle:Pe,fontWeight:De,color:Xe,underline:Re,lineThrough:Ae}=ae.style,de=k_(Xe,1,!1),tt=de?[...de,255*P]:[0,0,0,255],Ze=(ae.x+te)/V,et=z-ne.y/F,Qe={type:"text",charSpace:0,wordSpace:0,renderMode:0,fontPitchFamily:0,strokeColor:[0,0,0,255],fillColor:tt,fontName:fe,fontIsBold:pZ(De),fontIsItalic:"italic"===Pe,fontSize:be.value/V,text:(Je=ae.text,Je.replace(/\r?\n$/,"")),objMatrix:[1,0,0,1,Ze,et],position:[Ze,et]};var Je;if(L.push(Qe),Re){const st=z-(ne.y+Z)/F,mt=X(tt,[[Ze,st,2,!1],[Ze+ae.widthWithoutLf/V,st,0,!1]],Z/F);L.push(mt)}if(Ae){const st=z-(ne.y-ae.wordHeight/3)/F,mt=X(tt,[[Ze,st,2,!1],[Ze+ae.widthWithoutLf/V,st,0,!1]],Z/F);L.push(mt)}})}),L}(f,this.ratioX,this.ratioY,u.height);"textBox"===g?ie.objs.push(...oe):ie.objs=oe;const{defaultAppearance:le,defaultAppearanceData:he,defaultStyle:_e}=function(Le,V,F,z,$){const P=F[0]||{color:"rgb(0,0,0)",fontFamily:"Times Roman",fontStyle:"normal",fontWeight:"normal",fontSize:"12px"},{fontFamily:L,fontSize:X,fontStyle:ne,fontWeight:Z,color:te}=P,ae=k_(te,1,!1),fe=qE(`rgb(${ae[0]}, ${ae[1]}, ${ae[2]})`),be=ni(X).value/$,Pe=l2(L," ","");return{defaultAppearance:"textBox"===Le?`${V[0]/255} ${V[1]/255} ${V[2]/255} rg /${Pe} ${be} Tf`:`${ae[0]/255} ${ae[1]/255} ${ae[2]/255} rg /${Pe} ${be} Tf`,defaultStyle:`font:${"bold"===Z?"bold":""} ${"italic"===ne?"italic":""} '${L}' ${be}pt; text-align:${"justify"===z?"justify-center":z}; color:${fe.toLocaleUpperCase()}`,defaultAppearanceData:{fontColor:ae,fontSize:be,fontName:L}}}(g,O||[0,0,0],v,"freeTextWriter"===g?"left":I,this.ratioX);f.getPath();const Ve=Gg(f,f.path,Q,this.ratioX,this.ratioY,u.height);let ee="";v.forEach(Le=>{ee+=Le.content});const ke=function(Le,V,F){if(!Le||!Le.length)return null;const z=document.implementation.createDocument(null,"body",null),$=z.documentElement;$.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),$.setAttribute("xmlns:xfa","http://www.xfa.org/schema/xfa-data/1.0/"),$.setAttribute("xfa:APIVersion","Acrobat:18.11.0"),$.setAttribute("xfa:spec","2.0.2");const P=Ze=>`font-size:${ni(Ze).value/F}pt;`,L=Ze=>`font-weight:${"bold"===Ze?"bold":"normal"};`,X=Ze=>`font-style:${"italic"===Ze?"italic":"normal"};`,ne=Ze=>`color:${qE(jd(Ze).formatted)};`,Z=Ze=>`font-family:'${Ze}';`,te=Le[0],{fontFamily:ae,fontSize:fe,fontStyle:be,fontWeight:Pe,color:De}=te,Xe=jd(De),Re=`${P(fe)}text-align:${"justify"===V?"justify-center":V};${ne(Xe.formatted)}${L(Pe)}${X(be)}${Z(ae)}font-stretch:normal;`;$.setAttribute("style",Re);const Ae=z.createElement("p");Ae.setAttribute("dir","ltr"),Le.forEach(Ze=>{if(!Ze.content.length)return;const et=z.createElement("span"),Qe=z.createTextNode(Ze.content);et.appendChild(Qe);let Je="";ae!==Ze.fontFamily&&(Je+=Z(Ze.fontFamily)),fe!==Ze.fontSize&&(Je+=P(Ze.fontSize)),be!==Ze.fontStyle&&(Je+=X(Ze.fontStyle)),Pe!==Ze.fontWeight&&(Je+=L(Ze.fontWeight)),De!==Ze.color&&(Je+=ne(Ze.color)),(Ze.lineThrough||Ze.underline)&&(Je+=`text-decoration:${Ze.underline?"word":""} ${Ze.lineThrough?"line-through":""}`),Je&&et.setAttribute("style",Je),Ae.appendChild(et)}),$.appendChild(Ae);const de=`<?xml version="1.0"?>${(new XMLSerializer).serializeToString(z)}`,tt='xmlns="http://www.w3.org/1999/xhtml"';return de.includes(tt)?l2(de,'xmlns=""',tt):l2(de.replace(/<body/,`<body ${tt}`),'xmlns=""',tt)}(v,I,this.ratioX),xe={borderStyle:K,type:"FreeText",color:j,normalAppearance:ie,defaultAppearance:le,defaultAppearanceData:he,defaultStyle:_e,rect:Ve,name:l.uid,contents:ee,opacity:m,flags:zg([...l.flags]),date:l.comment.modificationDate};return"freeTextWriter"===g&&(xe.intent="FreeTextTypeWriter"),ke&&(xe.richText=ke),xe}toPdfTextAssist(l,u,f,g){if(l.style.annotationRaw)return l.style.annotationRaw;const{opacity:m}=l.style,v=g.childNodes,_=fZ(g,this.ratioX,this.ratioY,f.height),b=[],S=[];for(let j=0;j<v.length;j++){const W=uZ(v[j]);S.push(...W);const{borderWidth:J,lineDash:K}=v[j].parsedStyle,{borderColor:Q,background:ie}=v[j].style,{apStrokeColor:oe,apFillColor:le}=Rv(Q,ie,m),he=kv(J,K,this.ratioX).width,_e=O_(v[j],_[j],le,oe,he,Mv(K,this.ratioX));b.push(_e)}const I=Ov(g,null,null,m,0,_.flat(),this.ratioX,!1);I.objs=b;const k=Gg(g,S,0,this.ratioX,this.ratioY,f.height),O=[];return _.forEach(j=>{const W=[];j.forEach(le=>{W.push({x:le[0],y:le[1]})});const J=fp(W),{left:K,bottom:Q,top:ie,right:oe}=J;O.push([K,Q,oe,Q,K,ie,oe,ie])}),{type:u,rect:k,normalAppearance:I,opacity:m,quadPoints:O,name:l.uid,flags:zg([...l.flags]),date:l.comment.modificationDate}}createShape(l){const{type:u,transform:f,style:g}=hn(l),m={id:l.uid,style:g,transform:f};let v;switch("ellipse"===u&&(g.x+=g.width/2||0,g.y+=g.height/2||0,g.rx=g.width/2||g.rx,g.ry=g.height/2||g.ry),u){case"rectangle":v=new r2(m);break;case"ellipse":v=new Pv(m);break;case"line":v=new Qx(m);break;case"ink":v=new Gd(m);break;case"polygon":v=new Kx(m);break;case"polyline":v=new Jx(m);break;case"textTypewriter":v=new or(m,"freeTextWriter",{},!1);break;case"textBox":v=new or(m,"textBox");break;case"stamp":v=new Kc(m);break;case"highlight":v=new jh(m,zd.HIGHLIGHT);break;case"underline":v=new jh(m,zd.UNDERLINE);break;case"strikeout":v=new jh(m,zd.STRIKEOUT)}return v}}class vZ{constructor(){N(this,"annotationParser",new G2e),N(this,"annotationWriter",new z2e)}getParsedAnnotations(l,u,f){const g=Vn.displayResolution/Vn.pdfResolution;l=l.filter(v=>null!==v),this.annotationParser.setParserConfig(u,f,g,g),this.moveReplyToAnnotation(l);const m=[];return l.forEach(v=>{if(v){const b=this.annotationParser.parseAnnotation(v);if(b){var _;b.flags=this.parseFlags(v.flags||[]);const S=this.parseReply(v);null!==(_=v.replies)&&void 0!==_&&_.length&&(S.replies=v.replies.map(I=>this.parseReply(I))||[]),b.comment=S,m.push(b)}}}),m}moveReplyToAnnotation(l){l.forEach(u=>{if(u&&"Text"===u.type&&!pt(u.inreplyto)){const f=l[u.inreplyto];"Review"===u.statemodel?(f.reviewStates||(f.reviewStates=[]),f.reviewStates.push(u)):"Marked"===u.statemodel?(f.markedStates||(f.markedStates=[]),f.markedStates.push(u)):(f.replies||(f.replies=[]),f.replies.push(u))}}),l.slice().forEach(u=>{if(!u||"Popup"===u.type||!pt(u.inreplyto)){const f=l.findIndex(g=>g===u);l.splice(f,1)}})}parseReply(l){var u,f;const g=this.parseCommon(l);return g.subject=l.subject,null!==(u=l.reviewStates)&&void 0!==u&&u.length&&(g.reviewStates=l.reviewStates.map(m=>this.parseState(m))),null!==(f=l.markedStates)&&void 0!==f&&f.length&&(g.markedStates=l.markedStates.map(m=>this.parseState(m))),g}parseFlags(l){const u=[],f={readonly:"readOnly",noview:"noView"};return l.forEach(g=>{u.push(f[g]||g)}),u}parseState(l){return Ht(qe({},this.parseCommon(l)),{state:l.state,stateModel:l.statemodel})}parseCommon(l){const u=l.creationdate,f=l.date;return{uid:Ai(),author:l.title,contents:l.contents,type:l.type,creationDate:u||f,modifiedDate:f||u,flags:l.flags?[...l.flags]:[]}}parseDate(l){if(!l)return;let u=2;if(!l)return"";const f=[4,2,2,2,2,2].map(m=>{const v=l.slice(u,u+m);return u+=m,parseInt(v,10)});f[1]-=1;const g=new Date(...f).getTime();return VJ("yyyy.MM.dd hh:mm:ss",g)}getOriginalAnnotations(l,u){var f=this;return Fe(function*(){return yield f.annotationWriter.toPdfAnnotations(l,u)})()}}function u2(p){return{left:p[0],top:p[1],width:p[2]-p[0],height:p[3]-p[1]}}(function(p){p.CM_RENDERALL="cm/renderall",p.CM_IMAGEONLY="cm/imageonly",p.CM_AUTO="cm/auto"})(hl||(hl={})),function(p){p.NO_ANNOTATIONS="noAnnotations",p.RENDER_ANNOTATIONS="renderAnnotations",p.LOAD_ANNOTATIONS="loadAnnotations"}(Hh||(Hh={}));var d2=new WeakSet;class Y2e{constructor(){al(this,d2),N(this,"type","pdfParser"),N(this,"once",!1),N(this,"pdfReader",void 0),N(this,"parserOptions",{convertMode:hl.CM_AUTO}),N(this,"source",void 0),N(this,"isDestroy",!1),N(this,"annotationMapper",void 0),this.pdfReader=new jE,this.annotationMapper=new vZ}initParser(l,u){this.parserOptions=null!=u?u:{convertMode:hl.CM_AUTO},this.source={fileSource:l,password:this.parserOptions.password}}getPageCount(){var l=this;return Fe(function*(){return l.pdfReader.getPdfPageCount(l.source,at(d2,l,h5).call(l))})()}destroy(){var l;null===(l=this.pdfReader)||void 0===l||l.destroy(),this.pdfReader=null,this.isDestroy=!0}parse(l){var u=this;return Fe(function*(){if(u.isDestroy||!u.source)return null;const f=[],g=yield u.pdfReader.readPageImageInfos({source:u.source,indices:(null==l?void 0:l.slice())||[],readOptions:at(d2,u,h5).call(u),outputType:La.IT_JPG,isInfoOnly:!1,returnBase64:!1}),{displayResolution:m,pdfResolution:v}=Vn;for(let I=0;I<g.length;++I){var _,b,S;const k=g[I],O=1===k.realReadMode,j=O?u2(k.mediaBox):{left:0,top:0,width:k.imageWidth/k.imageXResolution*v,height:k.imageHeight/k.imageYResolution*v},W=O?u2([k.cropBox[0],k.mediaBox[1]+k.mediaBox[3]-k.cropBox[3],k.cropBox[2],k.mediaBox[1]+k.mediaBox[3]-k.cropBox[1]]):qe({},j),J={fileIndex:k.pageIndex,rotation:k.rotation,mediaBox:Kn(j,v,m),cropBox:Kn(W,v,m),resource:{width:k.imageWidth,height:k.imageHeight,resolutionX:k.imageXResolution,resolutionY:k.imageYResolution,bitDepth:k.imageBitDepth},pdfOptions:{convertMode:O?hl.CM_RENDERALL:hl.CM_IMAGEONLY,renderOptions:{renderAnnotations:null===(_=u.parserOptions.renderOptions)||void 0===_?void 0:_.renderAnnotations,renderGrayscale:null===(b=u.parserOptions.renderOptions)||void 0===b?void 0:b.renderGrayscale}},annotations:[]};if(O&&(null===(S=u.parserOptions.renderOptions)||void 0===S?void 0:S.renderAnnotations)===Hh.LOAD_ANNOTATIONS){const K=yield u.pdfReader.readAnnotations(u.source,J.fileIndex);K.length&&(J.annotations=u.annotationMapper.getParsedAnnotations(K,2*j.left+j.width,2*j.top+j.height))}f.push(J)}return f})()}getPage(l){var u=this;return Fe(function*(){if(u.isDestroy||!u.source)return null;const f=yield u.pdfReader.readPage({source:u.source,index:l,readOptions:at(d2,u,h5).call(u),outputType:La.IT_JPG,isInfoOnly:!1,returnBase64:!1});if(f){const{displayResolution:g,pdfResolution:m}=Vn,v=f.imageInfos[0];return{fileIndex:f.pageIndex,rotation:f.rotation,mediaBox:Kn(u2(f.mediaBox),m,g),cropBox:Kn(u2(f.cropBox),m,g),resource:{data:f.imageData,width:v.imageWidth,height:v.imageHeight,resolutionX:v.imageXResolution,resolutionY:v.imageYResolution,bitDepth:v.imageBitDepth}}}return null})()}cancelGetPage(l){!this.isDestroy&&this.source&&this.pdfReader.cancelReadPage(this.source,l)}}function h5(){var p,l;if(this.isDestroy||!this.parserOptions)return null;const u={[Hh.NO_ANNOTATIONS]:0,[Hh.RENDER_ANNOTATIONS]:1,[Hh.LOAD_ANNOTATIONS]:2};return{convertMode:{[hl.CM_IMAGEONLY]:2,[hl.CM_RENDERALL]:1,[hl.CM_AUTO]:3}[(null===(p=this.parserOptions)||void 0===p?void 0:p.convertMode)||hl.CM_AUTO],renderOptions:Ht(qe({},this.parserOptions.renderOptions||{}),{renderAnnotations:u[null===(l=this.parserOptions.renderOptions)||void 0===l?void 0:l.renderAnnotations]||0,renderIgnoreCrop:!0})}}class X2e{constructor(){N(this,"type","rgbaParser"),N(this,"once",!1),N(this,"processor",void 0),N(this,"cachePage",[]),N(this,"source",void 0),N(this,"parserOptions",void 0),this.processor=new Ng}initParser(l,u){this.source=l,this.parserOptions=u}getPageCount(){return Fe(function*(){return 1})()}destroy(){var l;null===(l=this.processor)||void 0===l||l.terminate(),this.processor=void 0}parse(){var l=this;return Fe(function*(){var u;const{outputType:f,jpegQuality:g,width:v,height:_,bitDepth:b,xResolution:S,yResolution:I}=null!==(u=l.parserOptions)&&void 0!==u?u:{},k=yield l.source.arrayBuffer();yield l.processor.initImage({source:k,isRGBA:!0,width:v,height:_,isBGRA:!1});const j=R_(yield l.processor.getImage({jpegQuality:g,ifDeleteObject:!0,isRGBA:!0,bitDepth:b,xDpi:S,yDpi:I,returnBlob:!0,returnType:f}));return l.cachePage=[j],l.cachePage})()}getPage(){var l=this;return Fe(function*(){return Promise.resolve(l.cachePage[0])})()}cancelGetPage(l){}}class yZ{constructor(){N(this,"db",void 0),this.db=new Map}saveByMime(l,u){this.db.set(l,u)}hasByMime(l){return this.db.has(l)}deleteConstructorByMime(l){return!!this.hasByMime(l)&&(this.db.delete(l),!0)}getConstructorByMime(l){return this.db.get(l)}has(l){throw new Error("Method not implemented.")}save(l){throw new Error("Method not implemented.")}clear(){this.db.clear()}}const F_=new class{constructor(){N(this,"db",void 0),this.db=new Map}saveByFileUid(p,l){this.db.set(p,l)}getParserByFileUid(p){return this.db.get(p)}deleteParserByFileUid(p){return this.db.delete(p)}has(p){throw new Error("Method not implemented.")}save(p){throw new Error("Method not implemented.")}clear(){this.db.clear()}getAllParsers(){return Array.from(this.db.values())}},h2=new yZ,ew=new yZ,tw=new class{constructor(){N(this,"db",void 0),this.db=new Map}getDefaultOptionsByMime(p){return this.db.get(p)}deleteDefaultOptionsByMime(p){return this.db.delete(p)}saveDefaultOptionsByMime(p,l){this.db.set(p,l)}has(p){throw new Error("Method not implemented.")}save(p){throw new Error("Method not implemented.")}clear(){this.db.clear()}},f5=new class{constructor(p,l,u){N(this,"parserRepo",void 0),N(this,"parserConstructorRepo",void 0),N(this,"customParserConstructorRepo",void 0),this.parserRepo=p,this.parserConstructorRepo=l,this.customParserConstructorRepo=u}getParser(p,l){let u=this.parserRepo.getParserByFileUid(p);return u||(u=new(this.customParserConstructorRepo.getConstructorByMime(l)||this.parserConstructorRepo.getConstructorByMime(l)),u.once||this.parserRepo.saveByFileUid(p,u),u)}}(F_,h2,ew),$2e=new class{constructor(p){N(this,"parserRepo",void 0),this.parserRepo=p}execute(p){let{fileIndex:l,fileUid:u}=p;const f=this.parserRepo.getParserByFileUid(u);f&&f.cancelGetPage(l)}}(F_),q2e=new class{constructor(p){N(this,"parserRepo",void 0),this.parserRepo=p}execute(p){const l=this.parserRepo.getParserByFileUid(p);l&&(l.destroy(),this.parserRepo.deleteParserByFileUid(p))}}(F_),K2e=new class{constructor(p,l){N(this,"parserService",void 0),N(this,"parserRepo",void 0),this.parserService=p,this.parserRepo=l}execute(p){var l=this;return Fe(function*(){const{fileData:u,mime:f,fileUid:g,fileIndex:m}=p;let v=l.parserRepo.getParserByFileUid(g);return v||(v=l.parserService.getParser(g,f),v.initParser(u)),v.getPage(m)})()}}(f5,F_),J2e=new class{constructor(p,l){N(this,"parserService",void 0),N(this,"defaultParserOptionsRepo",void 0),this.parserService=p,this.defaultParserOptionsRepo=l}execute(p){var l=this;return Fe(function*(){const{fileData:u,mime:f,fileUid:g,indices:m}=p;let{parseOptions:v}=p;v=v||l.defaultParserOptionsRepo.getDefaultOptionsByMime(f);const _=l.parserService.getParser(g,f);return _.initParser(u,v),_.parse(m)})()}}(f5,tw),Q2e=new class{constructor(p){N(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=p}execute(p){let{mime:l,parser:u}=p;this.parserConstructorRepo.saveByMime(l,u)}}(h2),Z2e=new class{constructor(p){N(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=p}execute(p){this.parserConstructorRepo.deleteConstructorByMime(p)}}(ew),eDe=new class{constructor(p){N(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=p}execute(p){let{mime:l,parser:u}=p;this.customParserConstructorRepo.saveByMime(l,u)}}(h2),tDe=new class{constructor(p){N(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=p}execute(p){this.customParserConstructorRepo.deleteConstructorByMime(p)}}(ew),nDe=new class{constructor(p){N(this,"defaultParserOptionsRepo",void 0),this.defaultParserOptionsRepo=p}execute(p){return this.defaultParserOptionsRepo.getDefaultOptionsByMime(p)}}(tw),iDe=new class{constructor(p,l,u){N(this,"defaultParserOptionsRepo",void 0),N(this,"parserConstructorRepo",void 0),N(this,"customParserConstructorRepo",void 0),this.defaultParserOptionsRepo=p,this.parserConstructorRepo=l,this.customParserConstructorRepo=u}execute(p){let{mime:l,options:u}=p;return!(!u||!Un(u)||!this.customParserConstructorRepo.hasByMime(l)&&!this.parserConstructorRepo.hasByMime(l)||(this.defaultParserOptionsRepo.saveDefaultOptionsByMime(l,hn(u)),0))}}(tw,h2,ew),rDe=new class{constructor(p){N(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=p}execute(p){return this.customParserConstructorRepo.getConstructorByMime(p)}}(ew),oDe=new class{constructor(p,l){N(this,"parserService",void 0),N(this,"defaultParserOptionsRepo",void 0),this.parserService=p,this.defaultParserOptionsRepo=l}execute(p){var l=this;return Fe(function*(){var u,f;let{fileData:g,mime:m,fileUid:v,options:_}=p;_=_||l.defaultParserOptionsRepo.getDefaultOptionsByMime(m);const b=l.parserService.getParser(v,m);return b.initParser(g,_),{pageCount:yield b.getPageCount(),batchSize:null!==(u=null===(f=_)||void 0===f?void 0:f.batchSize)&&void 0!==u?u:0}})()}}(f5,tw);class sDe{constructor(){N(this,"type",void 0),N(this,"once",!1),N(this,"cachedPage",void 0),N(this,"parserOptions",void 0)}initParser(l,u){this.parserOptions=u}getPageCount(){return Fe(function*(){return Promise.resolve(1)})()}destroy(){}parse(){var l=this;return Fe(function*(){const{width:u,height:f,bitDepth:g,resolutionX:m,resolutionY:v}=l.parserOptions,_=R_({imageBitDepth:g,imageHeight:f,imageWidth:u,imageXResolution:m,imageYResolution:v});return l.cachedPage=_,[l.cachedPage]})()}getPage(){var l=this;return Fe(function*(){const u=yield l.createBlankPage(l.parserOptions.width,l.parserOptions.height);return l.cachedPage.resource.data=u,l.cachedPage})()}cancelGetPage(){}createBlankPage(l,u){var f=this;return Fe(function*(){var g,m,v;const _=new Uint8Array([255,255,255,255]),b=new Ng;yield b.initImage({source:_,isRGBA:!0,width:1,height:1,isBGRA:!1}),yield b.resize(l,u);const S=yield b.getImage({jpegQuality:null!==(g=f.parserOptions.jpegQuality)&&void 0!==g?g:80,ifDeleteObject:!0,isRGBA:!0,bitDepth:24,xDpi:null!==(m=f.parserOptions.resolutionX)&&void 0!==m?m:96,yDpi:null!==(v=f.parserOptions.resolutionY)&&void 0!==v?v:96,returnBlob:!1,returnType:Bx[Tr.JPEG]});return new Blob([S.imageData],{type:S.blobType})})()}}var Ba;!function(p){p.GOOD="Good",p.AUTO_CAPTURE="AutoCaptured",p.SMALL_SIZE="SmallSize",p.OFF_CENTER="OffCenter",p.SKEW="Skew",p.NOTHING_DETECTED="NothingDetected"}(Ba||(Ba={}));var Ys,Wa=new WeakSet;class _Z{constructor(){al(this,Wa),N(this,"detector",void 0),N(this,"succeedDetect",0),N(this,"failedDetect",0),N(this,"autoCaptureStartTime",0),this.succeedDetect=0,this.failedDetect=0}destroy(){this.clear()}clear(){var l;null===(l=this.detector)||void 0===l||l.terminate(),this.detector=void 0}detect(l,u){return Fe(function*(){return Promise.resolve({success:!1})})()}getStatusMsg(l){switch(l){case Ba.AUTO_CAPTURE:return"Auto capture completed.";case Ba.GOOD:return"Capturing your document... Please do not move the camera.";case Ba.SMALL_SIZE:return"The document is too small. Try moving closer.";case Ba.OFF_CENTER:return"Try holding the device at the center of the document.";case Ba.SKEW:return"Please hold the device over a document to start scanning.";case Ba.NOTHING_DETECTED:return"No document is detected."}}processDetectResult(l){if([].concat(...l.location).every(S=>0===S))return{success:!1,confidence:0,status:Ba.NOTHING_DETECTED};let u;const f=this.calculateConfidence(l.location,l.width,l.height);u=pt(l.confidence)?this.calculateTotalConfidence(f):l.confidence;const g={success:!0,location:l.location,confidence:u},{angleConfidence:m,areaConfidence:v,centerConfidence:_}=f,{config:b}=l;return u>=(null==b?void 0:b.acceptedPolygonConfidence)?(this.succeedDetect+=1,g.status=Ba.GOOD,null!=b&&b.enableAutoCapture?this.autoCaptureStartTime<=0?this.autoCaptureStartTime=(new Date).getTime():(new Date).getTime()-this.autoCaptureStartTime>b.autoCaptureDelay&&(this.autoCaptureStartTime=0,g.status=Ba.AUTO_CAPTURE):this.autoCaptureStartTime=0):.45*m+.45*_+10>=(null==b?void 0:b.acceptedPolygonConfidence)?(this.reset(),g.status=Ba.SMALL_SIZE):.45*m+.45*v+10>=(null==b?void 0:b.acceptedPolygonConfidence)?(this.reset(),g.status=Ba.OFF_CENTER):.45*v+.45*_+10>=(null==b?void 0:b.acceptedPolygonConfidence)?(this.reset(),g.status=Ba.SKEW):(g.success=!1,g.status=Ba.NOTHING_DETECTED,this.failedDetect+=1,this.autoCaptureStartTime=0),this.failedDetect>5&&this.reset(),g.statusMsg=this.getStatusMsg(g.status),g}calculateConfidence(l,u,f){return at(Wa,this,lDe).call(this,at(Wa,this,aDe).call(this,l),u,f)}calculateTotalConfidence(l){const{angleConfidence:u,areaConfidence:f,centerConfidence:g}=l;return u&&f&&g?.3*u+.3*f+.3*g+10:0}reset(){this.succeedDetect=0,this.failedDetect=0,this.autoCaptureStartTime=0}}function aDe(p){return p?[p[0][0],p[0][1],p[1][0],p[1][1],p[2][0],p[2][1],p[3][0],p[3][1]]:[0,0,0,0,0,0,0,0]}function lDe(p,l,u){return{angleConfidence:at(Wa,this,cDe).call(this,p),areaConfidence:at(Wa,this,uDe).call(this,p,l,u),centerConfidence:at(Wa,this,dDe).call(this,p,l,u)}}function cDe(p){let l=0;const u=at(Wa,this,p2).call(this,[p[0],p[1]],[p[2],p[3]],[p[4],p[5]]),f=at(Wa,this,p2).call(this,[p[2],p[3]],[p[4],p[5]],[p[6],p[7]]),g=at(Wa,this,p2).call(this,[p[4],p[5]],[p[6],p[7]],[p[0],p[1]]),m=at(Wa,this,p2).call(this,[p[6],p[7]],[p[0],p[1]],[p[2],p[3]]);return l+=Math.abs(u-90),l+=Math.abs(f-90),l+=Math.abs(g-90),l+=Math.abs(m-90),Math.max(0,100*Math.min(1,1-.025*l))}function uDe(p,l,u){const f=at(Wa,this,hDe).call(this,p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7]);return Math.min(100,400*Math.max(0,f/(l*u)))}function dDe(p,l,u){const f=[(p[0]+p[2]+p[4]+p[6])/4,(p[1]+p[3]+p[5]+p[7])/4],g=at(Wa,this,f2).call(this,f,[l/2,u/2]);return Math.max(0,100*Math.min(1,1-g/Math.min(l,u)))}function f2(p,l){return Math.sqrt((l[0]-p[0])*(l[0]-p[0])+(l[1]-p[1])*(l[1]-p[1]))}function p2(p,l,u){const f=at(Wa,this,f2).call(this,l,p),g=at(Wa,this,f2).call(this,l,u),m=at(Wa,this,f2).call(this,p,u);return 0===f||0===g?0:Math.acos((f*f+g*g-m*m)/(2*f*g))/Math.PI*180}function CZ(p,l,u,f,g,m){return(p*f+l*g+u*m-g*f-m*p-u*l)/2}function hDe(p,l,u,f,g,m,v,_){return at(Wa,this,CZ).call(this,p,l,u,f,g,m)+at(Wa,this,CZ).call(this,p,l,g,m,v,_)}!function(p){p.NONE="none",p.BLACK_AND_WHITE="blackAndWhite",p.GRAY="gray",p.REMOVE_SHADOW="removeShadow",p.SAVE_INK="saveInk",p.ENHANCE="enhance",p.INVERT="invert",p.BRIGHTNESS="brightness",p.CONTRAST="contrast",p.BRIGHTNESS_AND_CONTRAST="brightnessAndContrast"}(Ys||(Ys={}));var Nv=new WeakMap,g2=new WeakMap,m2=new WeakSet;function fDe(p,l,u,f){return p5.apply(this,arguments)}function p5(){return p5=Fe(function*(p,l,u,f){var g;return yield null===(g=this.filter)||void 0===g?void 0:g.applyFilter(p,l)}),p5.apply(this,arguments)}function pDe(p){return Ye(Nv,this).push(p),Ye(g2,this)||(Bn(g2,this,!0),at(m2,this,gDe).call(this)),p.promise}function gDe(){return g5.apply(this,arguments)}function g5(){return g5=Fe(function*(){do{if(Ye(Nv,this).isEmpty())break;const p=Ye(Nv,this).pop();try{let l;"filter"===(null==p?void 0:p.api)&&(l=yield at(m2,this,fDe).apply(this,p.params)),null==p||p.resolve(l)}catch(l){p.retry<1?(p.retry+=1,Ye(Nv,this).push(p)):null==p||p.reject(l)}}while(!Ye(Nv,this).isEmpty());Bn(g2,this,!1)}),g5.apply(this,arguments)}const bZ=new Map([[Ys.NONE,"None"],[Ys.BLACK_AND_WHITE,"toBW"],[Ys.GRAY,"toGray"],[Ys.REMOVE_SHADOW,"removeShadow"],[Ys.SAVE_INK,"toBW"],[Ys.ENHANCE,"enhance"],[Ys.INVERT,"invert"],[Ys.CONTRAST,"brightnessAndContrast"],[Ys.BRIGHTNESS,"brightnessAndContrast"],[Ys.BRIGHTNESS_AND_CONTRAST,"brightnessAndContrast"]]);var ms,m5=new WeakSet;function mDe(p,l){const u=qe({},l||{});return p===Ys.SAVE_INK&&(u.method="adaptiveThreshold"),u}function vDe(p){var l,u;return p.returnType=Bx[p.outputType],p.bRGBA=p.outputType===Tr.RGBA,p.returnBlob=null!==(l=p.returnBlob)&&void 0!==l&&l,p.returnType=p.bRGBA&&void 0===p.returnType?La.IT_JPG:null!==(u=p.returnType)&&void 0!==u?u:La.IT_ALL,p.is1BitTo8Bit=gn.isApple,p}class it{static replaceMessage(l,u,f){let g=l;return u&&(g=g.replace("<%api%>",u)),f&&(g=g.replace("<%param%>",f)),g}static getLastError(){return this.lastError}static clearLastError(){this.lastError=null}static buildError(l,u,f){if(l&&!l.code&&l.cause&&l.cause.code&&l.cause.message)return xn(l.message)&&(l.message=this.replaceMessage(l.message,u,f)),l;const g={code:l.code,message:l.message};null!=l&&l.details&&(g.details=l.details);let m=qe({},l);return g.code>-8e4&&0!==g.code?g.code<=-2e4||(g.code=it.WASM_ERR.code,g.message=it.WASM_ERR.message,m.actualCode=m.code,m.code=g.code):g.code?(g.message=this.replaceMessage(g.message,u,f),m=qe({},g),Array.isArray(g.details)&&0!==g.details.length&&(m.details=g.details)):(g.code=it.EXTERNAL_ERR.code,g.message=it.EXTERNAL_ERR.message,m.actualCode=l.code,m.message=l.message,l.name&&(m.name=l.name),l.stack&&(m.stack=l.stack),m.code=g.code,m.actualError=l),new Error(g.message,{cause:m})}static warning(l,u,f){const g=it.buildError(l,u,f);this.lastError=g,this.onWarning.emit(g)}static error(l,u,f){const g=it.buildError(l,u,f);throw this.lastError=g,this.onError.emit(g),g}static verbose(l,u,f){this.onVerbose.emit(l)}static throw(l,u,f){const g=it.buildError(l,u,f);throw this.lastError=g,this.onError.emit(g),g}static reject(l,u,f){const g=it.buildError(l,u,f);return this.lastError=g,this.onError.emit(g),Promise.reject(g)}static on(l,u){"error"===l?this.onError.on(u):"verbose"===l?(this.onVerbose.on(u),0===this.verboseListenerCount&&(gn.enableDebugOutput(!0,f=>{this.verbose(f)}),this.verboseListenerCount+=1)):"warning"===l&&this.onWarning.on(u)}static off(l,u){"error"===l?this.onError.off(u):"verbose"===l?(this.onVerbose.off(u),this.verboseListenerCount-=1,0===this.verboseListenerCount&&gn.enableDebugOutput(!1,void 0)):"warning"===l&&this.onWarning.off(u)}}function _n(p,l,u,f){return l?u?`${l}${f?"":"."}${u}`:`${l}`:u?`${p}${f?"":"."}${u}`:`${p}`}N(it,"onError",new Fo),N(it,"onWarning",new Fo),N(it,"onVerbose",new Fo),N(it,"verboseListenerCount",0),N(it,"lastError",void 0),N(it,"LIC_EMPTY",{code:-8e4,message:"No license."}),N(it,"LIC_INVALID",{code:-80001,message:"License string is invalid."}),N(it,"LIC_EXPIRED",{code:-80002,message:"XXX module license has expired."}),N(it,"LIC_MISS_MODULE",{code:-80003,message:"XXX module license is missing."}),N(it,"LIC_VER_NOT_MATCHED",{code:-80004,message:"XXX module license version does not match."}),N(it,"LIC_DOMAIN_NOT_MATCHED",{code:-80005,message:"Domain does not match the domain bound to the XXX module license."}),N(it,"INIT_SHOULD_SET_CONFIG",{code:-80050,message:"DDV.Core.init() has not been set up yet."}),N(it,"INIT_CONFIG_NOT_DONE",{code:-80051,message:"DDV.Core.init() has not been completed."}),N(it,"RESOURCE_NOT_FOUND",{code:-80052,message:"<%api%>: Resource is not found from the specified engineResourcePath."}),N(it,"WASM_ERR",{code:-81e3,message:"WASM Error"}),N(it,"PARAM_INVALID",{code:-80100,message:"<%api%>: '<%param%>' is invalid."}),N(it,"PARAM_OUT_OF_RANGE",{code:-80101,message:"<%api%>: '<%param%>' is out of range."}),N(it,"PARAM_MISS",{code:-80102,message:"<%api%>: '<%param%>' is missing."}),N(it,"PARAM_NOT_SUPPORT",{code:-80103,message:"<%api%>: The value for '<%param%>' is not supported."}),N(it,"DOC_NOT_EXIST",{code:-80104,message:"<%api%>: The specified document(s) do not exist."}),N(it,"PAGE_NOT_EXIST",{code:-80105,message:"<%api%>: The specified page(s) do not exist."}),N(it,"ANNOTATION_NOT_EXIST",{code:-80106,message:"<%api%>: The specified annotation does not exist."}),N(it,"FILE_NOT_SUPPORT",{code:-80200,message:"File type is not supported."}),N(it,"DOC_UID_DUPLICATE",{code:-80201,message:"DocUid does not allow duplicate."}),N(it,"CONTAINER_NOT_EXIST",{code:-80301,message:"The specified container does not exist."}),N(it,"MIN_ZOOM_INVALID",{code:-80302,message:"minZoom value cannot be larger than maxZoom value."}),N(it,"MAX_ZOOM_INVALID",{code:-80303,message:"maxZoom value cannot be smaller than minZoom value."}),N(it,"DOC_NOT_OPEN",{code:-80304,message:"No document opened."}),N(it,"DOC_NO_IMAGE",{code:-80305,message:"There is no image in the current document."}),N(it,"ZOOM_TOO_LARGE",{code:-80306,message:"The value for zoom is larger than maxZoom value."}),N(it,"ZOOM_TOO_SMALL",{code:-80307,message:"The value for zoom is smaller than minZoom value."}),N(it,"ROW_COLUMN_CAN_NOT_CHANGE",{code:-80308,message:"<%api%>: Not available in current displayMode."}),N(it,"RECT_EXCEED_PAGE_BOUND",{code:-80309,message:"The specified rect exceeds the bounds of the current page."}),N(it,"UNDO_NOOP",{code:-80310,message:"No operations to undo."}),N(it,"REDO_NOOP",{code:-80311,message:"No operations to redo."}),N(it,"QUAD_EXCEED_PAGE_BOUND",{code:-80312,message:"The specified quad exceeds the bounds of the current page."}),N(it,"ELEMENT_UNSUPPORTED",{code:-80313,message:"The element '<%param%>' is not supported in <%api%> class."}),N(it,"TOOL_MODE_NOT_AVAILABLE",{code:-80314,message:"<%api%>: Not available in current toolMode."}),N(it,"DOC_DETECT_MISS",{code:-80315,message:"DocumentDetect needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the document detection feature."}),N(it,"IMG_FILTER_MISS",{code:-80316,message:"ImageFilter needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the image filter feature."}),N(it,"ANNOTATION_SELECT",{code:-80317,message:"The specified annotation(s) is not on the current page or does not exist."}),N(it,"WASM_FONT_LOSS",{code:-80318,message:"The document contains unsupported fonts, which may result in font loss after saving."}),N(it,"UNSELECTED_READONLY",{code:-80319,message:"ReadOnly annotation or noView annotation cannot be selected."}),N(it,"UNSELECTED_UNKNOWN",{code:-80320,message:"Unknown annotation or incomplete annotation cannot be selected."}),N(it,"CAMERA_NOT_EXIST",{code:-80400,message:"The specified camera does not exist."}),N(it,"CAMERA_OCCUPIED",{code:-80401,message:"The specified camera is occupied."}),N(it,"CAMERA_NO_VIDEO",{code:-80402,message:"No video stream is played."}),N(it,"CAMERA_NEED_HTTPS",{code:-80403,message:"Not HTTPS, failed to play the video stream."}),N(it,"CAMERA_NOT_SUPPORT_TORCH",{code:-80404,message:"The camera does not support a flashlight."}),N(it,"CAMERA_NO_CAMERA",{code:-80405,message:"No camera available."}),N(it,"CAMERA_DENIED",{code:-80406,message:"The selected camera is denied by browser."}),N(it,"CONTAINER_NO_BOUND",{code:-80407,message:"No bound container."}),N(it,"EXTERNAL_ERR",{code:-81100,message:"External Error"});class gt{static makeSureValid(l,u,f,g){const m=this.composeError(f,g);it.throw(m,l,u)}static output(l,u,f,g,m){let v=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const _=this.composeError(g,m);return 2===l?it.reject(_,u,f):1===l?(it.warning(_,u,f),v):0===l?it.error(_,u,f):3===l?it.verbose(_,u,f):void 0}static error(l,u,f,g){const m=this.composeError(f,g);it.throw(m,l,u)}static warning(l,u,f,g){let m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const v=this.composeError(f,g);return it.warning(v,l,u),m}static verbose(l,u,f,g){const m=this.composeError(f,g);it.verbose(m,l,u)}static reject(l,u,f,g){const m=this.composeError(f,g);return it.reject(m,l,u)}static composeError(l,u){const f=qe({},pt(u)?it.PARAM_INVALID:u);return l&&(f.details=l),f}static formatDetails(l,u){const f=[];if(Ds(u))u||f.push(`'${l}' is invalid.`);else{const{isValid:g,isInRange:m,isSupported:v}=u;!1===g&&f.push(`'${l}' is invalid.`),!1===m&&f.push(`'${l}' is out of range.`),!1===v&&f.push(`'${l}' is not supported.`)}return f}static formatError(l,u){const{isValid:f,isInRange:g,isSupported:m}=l;if(!1===f||!1===g||!1===m){if(u)return u;if(!f)return it.PARAM_INVALID;if(!g)return it.PARAM_OUT_OF_RANGE;if(!m)return it.PARAM_NOT_SUPPORT}return null}static isArrayBufferOrBlob(l){return RE(l)||ul(l)}static isArrayAndMeetMinLength(l,u){return Di(l)?Xt(u)?{isValid:0!==l.length,isInRange:l.length>=u}:{isValid:!0}:{isValid:!1}}static isNumberAndIsInRange(l,u,f){return Xt(l)?{isValid:!0,isInRange:!(!pt(u)&&l<u||!pt(f)&&l>f)}:{isValid:!1}}static isStringAndNotEmpty(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return xn(l)?u?{isValid:!0}:{isValid:0!==l.trim().length}:{isValid:!1}}static isPdfDate(l){if(!xn(l))return{isValid:!1};const u=l.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['\u2019](\d{2})['\u2019]|)$/);let f=!1;if(u){const[,g,m,v,_,b,S,I,k,O]=u,j=new Date(`${g}-${m}-${v}T${_}:${b}:${S}`);if(f=!0,j.getFullYear()===parseInt(g,10)&&j.getMonth()+1===parseInt(m,10)&&j.getDate()===parseInt(v,10)&&j.getHours()===parseInt(_,10)&&j.getMinutes()===parseInt(b,10)&&j.getSeconds()===parseInt(S,10)||(f=!1),f&&I){const W=parseInt(k,10),J=parseInt(O,10);(W<0||W>12||J<0||J>59||"+"!==I&&"-"!==I)&&(f=!1)}}return{isSupported:f}}}!function(p){p[p.BlackAndWhite=1]="BlackAndWhite",p[p.Gray=2]="Gray",p[p.RemoveShadow=3]="RemoveShadow",p[p.Enhance=4]="Enhance",p[p.Invert=5]="Invert",p[p.Brightness=6]="Brightness",p[p.Contrast=7]="Contrast",p[p.BrightnessAndContrast=8]="BrightnessAndContrast",p[p.Perspective=9]="Perspective",p[p.Deskew=10]="Deskew",p[p.Rotate=11]="Rotate",p[p.Flip=12]="Flip",p[p.Resize=13]="Resize",p[p.SetHeight=14]="SetHeight",p[p.SetWidth=15]="SetWidth",p[p.SetDPI=16]="SetDPI",p[p.Crop=17]="Crop",p[p.Erase=18]="Erase",p[p.DrawPolygon=19]="DrawPolygon"}(ms||(ms={}));var v5=new WeakSet;class yDe{constructor(){al(this,v5)}process(l,u,f){var g=this;return Fe(function*(){Di(u)||(u=[u]),at(v5,g,_De).call(g,u);const m=new Ng,v={inputImageInfo:null,output:null,outputImageInfo:null,outputContentType:"",outputType:null};try{var _,b,S,I;const k=yield m.initImage({source:l.data,isRGBA:l.type===Tr.RGBA,width:l.width,height:l.height,isBGRA:l.type===Tr.BGRA});k.srcBuffer&&(l.data=k.srcBuffer);for(const j of u)at(v5,g,CDe).call(g,m,j);const O=yield m.getImage({jpegQuality:null==f||null===(_=f.params)||void 0===_?void 0:_.jpegQuality,ifDeleteObject:!0,isRGBA:l.type===Tr.RGBA,bitDepth:null==f||null===(b=f.params)||void 0===b?void 0:b.bitDepth,xDpi:null==f||null===(S=f.params)||void 0===S?void 0:S.xDpi,yDpi:null==f||null===(I=f.params)||void 0===I?void 0:I.yDpi,returnBlob:!1,returnType:Bx[null==f?void 0:f.type]});yield m.freeReservedData(),v.output=O.imageData,v.outputContentType=O.blobType,v.outputImageInfo={width:O.imageWidth,height:O.imageHeight,bitDepth:O.imageBitDepth,resolutionX:O.imageXResolution,resolutionY:O.imageYResolution},v.outputType=XIe[O.imageType]}finally{try{yield m.terminate()}catch(k){it.warning(k)}}return v})()}}function _De(p){for(const l of p);}function CDe(p,l){return y5.apply(this,arguments)}function y5(){return y5=Fe(function*(p,l){var u;const f=null!==(u=l.params)&&void 0!==u?u:{};switch(l.type){case ms.BlackAndWhite:return p.toBinaryLevel(f.saveInk,f.level);case ms.Gray:return p.toGrayscale(f.level);case ms.RemoveShadow:return p.removeShadowLevel(f.level,f.alpha);case ms.Enhance:return p.brighten();case ms.Invert:return p.invert();case ms.Contrast:return p.changeBrightnessAndContrast(void 0,f.contrast);case ms.Brightness:return p.changeBrightnessAndContrast(f.brightness,void 0);case ms.BrightnessAndContrast:return p.changeBrightnessAndContrast(f.brightness,f.contrast);case ms.Perspective:return p.perspective(f.location);case ms.Deskew:{var g;const m=yield p.getSkewAngle(f.options);return p.rotate({angle:m,fillColor:f.fillColor,keepSize:null===(g=f.keepSize)||void 0===g||g,mode:f.mode})}case ms.Rotate:return p.rotate({angle:f.angle,fillColor:f.fillColor,keepSize:f.keepSize,mode:f.mode});case ms.Flip:return p.flip();case ms.Resize:{const{newWidth:m,newHeight:v,mode:_}=f;return p.resize(m,v,_)}case ms.SetHeight:{const{newHeight:m,fillColor:v}=f;return p.setImageHeight(m,v)}case ms.SetWidth:{const{newWidth:m,fillColor:v}=f;return p.setImageWidth(m,v)}case ms.SetDPI:return p.setDpi({rawResolutionX:0,rawResolutionY:0,resolutionX:f.xRes,resolutionY:f.yRes,resample:!1});case ms.Crop:return p.crop({left:f.left,top:f.top,width:f.right-f.left,height:f.bottom-f.top});case ms.Erase:return p.erase({left:f.left,top:f.top,width:f.right-f.left,height:f.bottom-f.top},f.fillColor);case ms.DrawPolygon:return p.drawQuadrangle({location:f.location,strokeColor:f.strokeColor,lineWidth:f.lineWidth})}}),y5.apply(this,arguments)}!bv&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID")),!bv&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const xZ=function(){var p=Fe(function*(l,u,f){if(!l._bNeverShowDialog)try{let g=yield fetch(l.engineResourcePath+"dls.license.dialog.html");if(!g.ok)throw Error("Get license dialog fail. Network Error: "+g.statusText);let m=yield g.text();if(!m.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let v=document.createElement("div");v.innerHTML=m;let _=[];for(let K=0;K<v.childElementCount;++K){let Q=v.children[K];Q instanceof HTMLStyleElement&&(_.push(Q),document.head.append(Q))}let b=1==v.childElementCount?v.children[0]:v;b.remove();let S,I,k,O,j,W=[b],J=b.children;for(let K of J)W.push(K);for(let K=0;K<W.length;++K)for(let Q of W[K].children)W.push(Q);for(let K of W)if(!S&&K.classList.contains("dls-license-mask"))S=K,K.addEventListener("click",Q=>{if(K==Q.target){b.remove();for(let ie of _)ie.remove()}});else if(!I&&K.classList.contains("dls-license-icon-close"))I=K,K.addEventListener("click",()=>{b.remove();for(let Q of _)Q.remove()});else if(!k&&K.classList.contains("dls-license-icon-error"))k=K,"error"!=u&&K.remove();else if(!O&&K.classList.contains("dls-license-icon-warn"))O=K,"warn"!=u&&K.remove();else if(!j&&K.classList.contains("dls-license-msg-content")){j=K;let Q=f;for(;Q;){let ie=Q.indexOf("["),oe=Q.indexOf("]",ie),le=Q.indexOf("(",oe),he=Q.indexOf(")",le);if(-1==ie||-1==oe||-1==le||-1==he){K.appendChild(new Text(Q));break}ie>0&&K.appendChild(new Text(Q.substring(0,ie)));let _e=document.createElement("a"),Ve=Q.substring(ie+1,oe);_e.innerText=Ve;let ee=Q.substring(le+1,he);_e.setAttribute("href",ee),_e.setAttribute("target","_blank"),K.appendChild(_e),Q=Q.substring(he+1)}}document.body.appendChild(b)}catch(g){l._onLog&&l._onLog(g.message||g)}});return function(u,f,g){return p.apply(this,arguments)}}();var L_=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(p){return}}();function wZ(p,l){p=p||[],l=l||{};try{return new Blob(p,l)}catch(g){if("TypeError"!==g.name)throw g;for(var u=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),f=0;f<p.length;f+=1)u.append(p[f]);return u.getBlob(l.type)}}function Bl(p,l){l&&p.then(function(u){l(null,u)},function(u){l(u)})}function nw(p,l,u){"function"==typeof l&&p.then(l),"function"==typeof u&&p.catch(u)}function N_(p){return"string"!=typeof p&&(p=String(p)),p}function SZ(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const _5="local-forage-detect-blob-support";let v2;const Yu={},xDe=Object.prototype.toString,C5="readonly",y2="readwrite";function _2(p){var l=Yu[p.name],u={};u.promise=new Promise(function(f,g){u.resolve=f,u.reject=g}),l.deferredOperations.push(u),l.dbReady=l.dbReady?l.dbReady.then(function(){return u.promise}):u.promise}function b5(p){var l=Yu[p.name].deferredOperations.pop();if(l)return l.resolve(),l.promise}function x5(p,l){var u=Yu[p.name].deferredOperations.pop();if(u)return u.reject(l),u.promise}function TZ(p,l){return new Promise(function(u,f){if(Yu[p.name]=Yu[p.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},p.db){if(!l)return u(p.db);_2(p),p.db.close()}var g=[p.name];l&&g.push(p.version);var m=L_.open.apply(L_,g);l&&(m.onupgradeneeded=function(v){var _=m.result;try{_.createObjectStore(p.storeName),v.oldVersion<=1&&_.createObjectStore(_5)}catch(b){if("ConstraintError"!==b.name)throw b}}),m.onerror=function(v){v.preventDefault(),f(m.error)},m.onsuccess=function(){var v=m.result;v.onversionchange=function(_){_.target.close()},u(v),b5(p)}})}function w5(p){return TZ(p,!1)}function S5(p){return TZ(p,!0)}function IZ(p,l){if(!p.db)return!0;var u=!p.db.objectStoreNames.contains(p.storeName),g=p.version>p.db.version;if(p.version<p.db.version&&(p.version=p.db.version),g||u){if(u){var m=p.db.version+1;m>p.version&&(p.version=m)}return!0}return!1}function TDe(p){var l=this,u=l._initReady().then(function(){var f=Yu[l._dbInfo.name];if(f&&f.dbReady)return f.dbReady});return nw(u,p,p),u}function Bv(p,l,u,f){void 0===f&&(f=1);try{var g=p.db.transaction(p.storeName,l);u(null,g)}catch(m){if(f>0&&(!p.db||"InvalidStateError"===m.name||"NotFoundError"===m.name))return Promise.resolve().then(()=>{if(!p.db||"NotFoundError"===m.name&&!p.db.objectStoreNames.contains(p.storeName)&&p.version<=p.db.version)return p.db&&(p.version=p.db.version+1),S5(p)}).then(()=>function(v){_2(v);for(var _=Yu[v.name],b=_.forages,S=0;S<b.length;S++){const I=b[S];I._dbInfo.db&&(I._dbInfo.db.close(),I._dbInfo.db=null)}return v.db=null,w5(v).then(I=>(v.db=I,IZ(v)?S5(v):I)).then(I=>{v.db=_.db=I;for(var k=0;k<b.length;k++)b[k]._dbInfo.db=I}).catch(I=>{throw x5(v,I),I})}(p).then(function(){Bv(p,l,u,f-1)})).catch(u);u(m)}}var IDe={_driver:"asyncStorage",_initStorage:function(p){var l=this,u={db:null};if(p)for(var f in p)u[f]=p[f];var g=Yu[u.name];g||(Yu[u.name]=g={forages:[],db:null,dbReady:null,deferredOperations:[]}),g.forages.push(l),l._initReady||(l._initReady=l.ready,l.ready=TDe);var m=[];function v(){return Promise.resolve()}for(var _=0;_<g.forages.length;_++){var b=g.forages[_];b!==l&&m.push(b._initReady().catch(v))}var S=g.forages.slice(0);return Promise.all(m).then(function(){return u.db=g.db,w5(u)}).then(function(I){return u.db=I,IZ(u)?S5(u):I}).then(function(I){u.db=g.db=I,l._dbInfo=u;for(var k=0;k<S.length;k++){var O=S[k];O!==l&&(O._dbInfo.db=u.db,O._dbInfo.version=u.version)}})},_support:function(){try{if(!L_||!L_.open)return!1;var p="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),l="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!p||l)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(u){return!1}}(),getItem:function(p,l){var u=this;p=N_(p);var f=new Promise(function(g,m){u.ready().then(function(){Bv(u._dbInfo,C5,function(v,_){if(v)return m(v);try{var b=_.objectStore(u._dbInfo.storeName).get(p);b.onsuccess=function(){var I,S=b.result;void 0===S&&(S=null),(I=S)&&I.__local_forage_encoded_blob&&(S=function SDe(p){return wZ([function(u){for(var f=u.length,g=new ArrayBuffer(f),m=new Uint8Array(g),v=0;v<f;v++)m[v]=u.charCodeAt(v);return g}(atob(p.data))],{type:p.type})}(S)),g(S)},b.onerror=function(){m(b.error)}}catch(S){m(S)}})}).catch(m)});return Bl(f,l),f},setItem:function(p,l,u){var f=this;p=N_(p);var g=new Promise(function(m,v){var _;f.ready().then(function(){return _=f._dbInfo,"[object Blob]"===xDe.call(l)?function wDe(p){return"boolean"==typeof v2?Promise.resolve(v2):(l=p,new Promise(function(u){var f=l.transaction(_5,y2),g=wZ([""]);f.objectStore(_5).put(g,"key"),f.onabort=function(m){m.preventDefault(),m.stopPropagation(),u(!1)},f.oncomplete=function(){var m=navigator.userAgent.match(/Chrome\/(\d+)/),v=navigator.userAgent.match(/Edge\//);u(v||!m||parseInt(m[1],10)>=43)}}).catch(function(){return!1})).then(function(l){return v2=l,v2});var l}(_.db).then(function(b){return b?l:(S=l,new Promise(function(I,k){var O=new FileReader;O.onerror=k,O.onloadend=function(j){var W=btoa(j.target.result||"");I({__local_forage_encoded_blob:!0,data:W,type:S.type})},O.readAsBinaryString(S)}));var S}):l}).then(function(b){Bv(f._dbInfo,y2,function(S,I){if(S)return v(S);try{var k=I.objectStore(f._dbInfo.storeName);null===b&&(b=void 0);var O=k.put(b,p);I.oncomplete=function(){void 0===b&&(b=null),m(b)},I.onabort=I.onerror=function(){v(O.error?O.error:O.transaction.error)}}catch(j){v(j)}})}).catch(v)});return Bl(g,u),g},removeItem:function(p,l){var u=this;p=N_(p);var f=new Promise(function(g,m){u.ready().then(function(){Bv(u._dbInfo,y2,function(v,_){if(v)return m(v);try{var b=_.objectStore(u._dbInfo.storeName).delete(p);_.oncomplete=function(){g()},_.onerror=function(){m(b.error)},_.onabort=function(){m(b.error?b.error:b.transaction.error)}}catch(S){m(S)}})}).catch(m)});return Bl(f,l),f},clear:function(p){var l=this,u=new Promise(function(f,g){l.ready().then(function(){Bv(l._dbInfo,y2,function(m,v){if(m)return g(m);try{var _=v.objectStore(l._dbInfo.storeName).clear();v.oncomplete=function(){f()},v.onabort=v.onerror=function(){g(_.error?_.error:_.transaction.error)}}catch(b){g(b)}})}).catch(g)});return Bl(u,p),u},length:function(p){var l=this,u=new Promise(function(f,g){l.ready().then(function(){Bv(l._dbInfo,C5,function(m,v){if(m)return g(m);try{var _=v.objectStore(l._dbInfo.storeName).count();_.onsuccess=function(){f(_.result)},_.onerror=function(){g(_.error)}}catch(b){g(b)}})}).catch(g)});return Bl(u,p),u},keys:function(p){var l=this,u=new Promise(function(f,g){l.ready().then(function(){Bv(l._dbInfo,C5,function(m,v){if(m)return g(m);try{var _=v.objectStore(l._dbInfo.storeName).openKeyCursor(),b=[];_.onsuccess=function(){var S=_.result;S?(b.push(S.key),S.continue()):f(b)},_.onerror=function(){g(_.error)}}catch(S){g(S)}})}).catch(g)});return Bl(u,p),u},dropInstance:function(p,l){l=SZ.apply(this,arguments);var u,f=this.config();if((p="function"!=typeof p&&p||{}).name||(p.name=p.name||f.name,p.storeName=p.storeName||f.storeName),p.name){u=(p.name===f.name&&this._dbInfo.db?Promise.resolve(this._dbInfo.db):w5(p).then(m=>{const v=Yu[p.name],_=v.forages;v.db=m;for(var b=0;b<_.length;b++)_[b]._dbInfo.db=m;return m})).then(p.storeName?m=>{if(!m.objectStoreNames.contains(p.storeName))return;const v=m.version+1;_2(p);const _=Yu[p.name],b=_.forages;m.close();for(let I=0;I<b.length;I++){const k=b[I];k._dbInfo.db=null,k._dbInfo.version=v}return new Promise((I,k)=>{const O=L_.open(p.name,v);O.onerror=j=>{O.result.close(),k(j)},O.onupgradeneeded=()=>{O.result.deleteObjectStore(p.storeName)},O.onsuccess=()=>{const j=O.result;j.close(),I(j)}}).then(I=>{_.db=I;for(let k=0;k<b.length;k++){const O=b[k];O._dbInfo.db=I,b5(O._dbInfo)}}).catch(I=>{throw(x5(p,I)||Promise.resolve()).catch(()=>{}),I})}:m=>{_2(p);const v=Yu[p.name],_=v.forages;m.close();for(var b=0;b<_.length;b++)_[b]._dbInfo.db=null;return new Promise((I,k)=>{var O=L_.deleteDatabase(p.name);O.onerror=()=>{const j=O.result;j&&j.close(),k(O.error)},O.onblocked=()=>{},O.onsuccess=()=>{const j=O.result;j&&j.close(),I(j)}}).then(I=>{v.db=I;for(var k=0;k<_.length;k++)b5(_[k]._dbInfo)}).catch(I=>{throw(x5(p,I)||Promise.resolve()).catch(()=>{}),I})})}else u=Promise.reject("Invalid arguments");return Bl(u,l),u}};const Yh=new Map;function EZ(p,l){let u=p.name+"/";return p.storeName!==l.storeName&&(u+=p.storeName+"/"),u}var EDe={_driver:"tempStorageWrapper",_initStorage:function(){var p=Fe(function*(l){const u={};if(l)for(let g in l)u[g]=l[g];const f=u.keyPrefix=EZ(l,this._defaultConfig);this._dbInfo=u,Yh.has(f)||Yh.set(f,new Map)});return function(u){return p.apply(this,arguments)}}(),getItem:function(p,l){p=N_(p);const u=this.ready().then(()=>Yh.get(this._dbInfo.keyPrefix).get(p));return Bl(u,l),u},setItem:function(p,l,u){p=N_(p);const f=this.ready().then(()=>(void 0===l&&(l=null),Yh.get(this._dbInfo.keyPrefix).set(p,l),l));return Bl(f,u),f},removeItem:function(p,l){p=N_(p);const u=this.ready().then(()=>{Yh.get(this._dbInfo.keyPrefix).delete(p)});return Bl(u,l),u},clear:function(p){const l=this.ready().then(()=>{const u=this._dbInfo.keyPrefix;Yh.has(u)&&Yh.delete(u)});return Bl(l,p),l},length:function(p){const l=this.ready().then(()=>Yh.get(this._dbInfo.keyPrefix).size);return Bl(l,p),l},keys:function(p){const l=this.ready().then(()=>[...Yh.get(this._dbInfo.keyPrefix).keys()]);return Bl(l,p),l},dropInstance:function(p,l){if(l=SZ.apply(this,arguments),!(p="function"!=typeof p&&p||{}).name){const f=this.config();p.name=p.name||f.name,p.storeName=p.storeName||f.storeName}let u;return u=p.name?new Promise(f=>{f(p.storeName?EZ(p,this._defaultConfig):`${p.name}/`)}).then(f=>{Yh.delete(f)}):Promise.reject("Invalid arguments"),Bl(u,l),u}};const DDe=(p,l)=>p===l||"number"==typeof p&&"number"==typeof l&&isNaN(p)&&isNaN(l),ADe=(p,l)=>{const u=p.length;let f=0;for(;f<u;){if(DDe(p[f],l))return!0;f++}return!1},DZ=Array.isArray||function(p){return"[object Array]"===Object.prototype.toString.call(p)},iw={},AZ={},rw={INDEXEDDB:IDe,TEMPSTORAGE:EDe},PDe=[rw.INDEXEDDB._driver,rw.TEMPSTORAGE._driver],C2=["dropInstance"],T5=["clear","getItem","keys","length","removeItem","setItem"].concat(C2),RDe={description:"",driver:PDe.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function kDe(p,l){p[l]=function(){const u=arguments;return p.ready().then(function(){return p[l].apply(p,u)})}}function I5(){for(let p=1;p<arguments.length;p++){const l=arguments[p];if(l)for(let u in l)l.hasOwnProperty(u)&&(arguments[0][u]=DZ(l[u])?l[u].slice():l[u])}return arguments[0]}class E5{constructor(l){for(let u in rw)if(rw.hasOwnProperty(u)){const f=rw[u],g=f._driver;this[u]=g,iw[g]||this.defineDriver(f)}this._defaultConfig=I5({},RDe),this._config=I5({},this._defaultConfig,l),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(()=>{})}config(l){if("object"==typeof l){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let u in l){if("storeName"===u&&(l[u]=l[u].replace(/\W/g,"_")),"version"===u&&"number"!=typeof l[u])return new Error("Database version must be a number.");this._config[u]=l[u]}return!("driver"in l)||!l.driver||this.setDriver(this._config.driver)}return"string"==typeof l?this._config[l]:this._config}defineDriver(l,u,f){const g=new Promise(function(m,v){try{const _=l._driver,b=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!l._driver)return void v(b);const S=T5.concat("_initStorage");for(let O=0,j=S.length;O<j;O++){const W=S[O];if((!ADe(C2,W)||l[W])&&"function"!=typeof l[W])return void v(b)}!function(){const O=function(j){return function(){const W=new Error(`Method ${j} is not implemented by the current driver`),J=Promise.reject(W);return Bl(J,arguments[arguments.length-1]),J}};for(let j=0,W=C2.length;j<W;j++){const J=C2[j];l[J]||(l[J]=O(J))}}();const k=function(O){iw[_]=l,AZ[_]=O,m()};"_support"in l?l._support&&"function"==typeof l._support?l._support().then(k,v):k(!!l._support):k(!0)}catch(_){v(_)}});return nw(g,u,f),g}driver(){return this._driver||null}getDriver(l,u,f){const g=iw[l]?Promise.resolve(iw[l]):Promise.reject(new Error("Driver not found."));return nw(g,u,f),g}ready(l){const u=this,f=u._driverSet.then(()=>(null===u._ready&&(u._ready=u._initDriver()),u._ready));return nw(f,l,l),f}setDriver(l,u,f){const g=this;DZ(l)||(l=[l]);const m=this._getSupportedDrivers(l);function v(){g._config.driver=g.driver()}function _(S){return g._extend(S),v(),g._ready=g._initStorage(g._config),g._ready}const b=null!==this._driverSet?this._driverSet.catch(()=>Promise.resolve()):Promise.resolve();return this._driverSet=b.then(()=>{const S=m[0];return g._dbInfo=null,g._ready=null,g.getDriver(S).then(I=>{var k;g._driver=I._driver,v(),g._wrapLibraryMethodsWithReady(),g._initDriver=(k=m,function(){let O=0;return function j(){for(;O<k.length;){let J=k[O];return O++,g._dbInfo=null,g._ready=null,g.getDriver(J).then(_).catch(j)}v();const W=new Error("No available storage method found.");return g._driverSet=Promise.reject(W),g._driverSet}()})})}).catch(()=>{v();const S=new Error("No available storage method found.");return g._driverSet=Promise.reject(S),g._driverSet}),nw(this._driverSet,u,f),this._driverSet}supports(l){return!!AZ[l]}_extend(l){I5(this,l)}_getSupportedDrivers(l){const u=[];for(let f=0,g=l.length;f<g;f++){const m=l[f];this.supports(m)&&u.push(m)}return u}_wrapLibraryMethodsWithReady(){for(let l=0,u=T5.length;l<u;l++)kDe(this,T5[l])}createInstance(l){return new E5(l)}}var MDe=new E5;Date.prototype.kUtilFormat=function(p){const l={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"H+":this.getUTCHours(),"h+":this.getUTCHours()%12||12,"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),"S+":this.getUTCMilliseconds()};/(y+)/.test(p)&&(p=p.replace(RegExp.$1,(this.getUTCFullYear()+"").substr(4-RegExp.$1.length)));for(let u in l)new RegExp("("+u+")").test(p)&&(p=p.replace(RegExp.$1,1==RegExp.$1.length?l[u]:("000"+l[u]).substr(("000"+l[u]).length-RegExp.$1.length)));return p},String.prototype.startsWith||(String.prototype.startsWith=function(p){return 0==this.indexOf(p)});let ODe=p=>{let l,u,f,g,m,v,_,b,S,I,k,O,j,W,J,K,Q,ie,oe,le,he,_e,Ve=p.fetch||xv.fetch,ee=p.btoa||xv.btoa,ke=p.atob||xv.atob,xe=p.bd,Le=p.dm,V=["https://mlts.dynamsoft.com/","https://slts.dynamsoft.com/"],F=!1,z=Promise.resolve(),$=p.lf,P=p.log&&function(){try{for(var ut=arguments.length,Ke=new Array(ut),nt=0;nt<ut;nt++)Ke[nt]=arguments[nt];p.log.apply(null,Ke)}catch(lt){setTimeout(()=>{throw lt},0)}}||(()=>{}),L=xe&&P||(()=>{}),X=p.fol,ne=p.sutlcb,Z=p.feab,te=ut=>ke(ke(ut.replace(/\n/g,"+").replace(/\s/g,"=")).substring(1)),ae=ut=>ee(String.fromCharCode(97+25*Math.random())+ee(ut)).replace(/\+/g,"\n").replace(/=/g," "),fe=()=>{if(_e)return _e;if(xv.crypto){let ut=new Uint8Array(36);xv.crypto.getRandomValues(ut);let Ke="";for(let nt=0;nt<36;++nt){let lt=ut[nt]%36;Ke+=lt<10?lt:String.fromCharCode(lt+87)}return Ke}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(ut){var Ke=16*Math.random()|0;return("x"==ut?Ke:3&Ke|8).toString(16)})};const be=" Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.";let Pe,De,Xe,Re,Ae={dlsErrorAndCacheExpire:"Failed to connect to the Dynamsoft License Server. The cached license has expired. Please get connected to the network as soon as possible or contact the site administrator for more information.",publicTrialNetworkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out."+be,networkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out. Check your Internet connection or contact the site administrator for more information.",publicTrialFailConnect:"Failed to connect to the Dynamsoft License Server: network connection error."+be,failConnect:"Failed to connect to the Dynamsoft License Server: network connection error. Check your Internet connection or contact the site administrator for more information.",checkLocalTime:"Your system date and time appear to have been changed, causing the license to fail. Please correct the system data and time and try again."},de=function(){var ut=Fe(function*(){return Pe=Pe||Fe(function*(){if(yield Fe(function*(){$||($=MDe)})(),yield(yield $.createInstance({name:"dynamjssdkhello"})).setItem("dynamjssdkhello","available"),K=yield $.createInstance({name:"dynamdlsinfo"}),Q=_e?null:ee(ee("v2")+String.fromCharCode(Le.charCodeAt(Le.length/2)+1)+ee(Le)),!_e){try{var Ke,nt;let lt=yield K.getItem(Q);!lt&&null!==(Ke=yield null===(nt=self.indexedDB)||void 0===nt?void 0:nt.databases())&&void 0!==Ke&&Ke.some(xt=>"dynamltsinfo"===(null==xt?void 0:xt.name))&&(lt=yield(yield $.createInstance({name:"dynamltsinfo"})).getItem(Q),lt&&(yield K.setItem(Q,lt))),lt&&([_,j]=JSON.parse(yield te(lt)))}catch(lt){}try{null==_&&(_=fe(),K.setItem(Q,yield ae(JSON.stringify([_,null]))))}catch(lt){}}})(),Pe});return function(){return ut.apply(this,arguments)}}(),tt=function(){var ut=Fe(function*(Ke){Xe=Date.now(),De||(De=Fe(function*(){try{let nt={pd:l,vm:f,v:u,dt:v||"browser",ed:"javascript",cu:_,ad:Le,os:b,fn:S};O&&(nt.rmk=O),g&&(-1!=g.indexOf("-")?nt.hs=g:nt.og=g);let lt={};if(j&&!_e){let dt=yield K.getItem(Q);dt&&([_,j]=JSON.parse(yield te(dt))),lt["lts-time"]=j}k&&(nt.sp=k),m=yield Promise.race([Fe(function*(){let dt,Dt=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");j&&!_e&&(K.setItem(Q,yield ae(JSON.stringify([_,Dt]))),j=Dt);let Rt,Nt="auth/?ext="+encodeURIComponent(ee(JSON.stringify(nt))),Ot=!1,Vt=!1,$t=function(){var dn=Fe(function*(sn){if(sn&&!sn.ok)try{let bn=yield sn.text();if(bn){let ct=JSON.parse(bn);ct.errorCode&&(Rt=ct,ct.errorCode>100&&ct.errorCode<200&&(m=null,Ot=!0,Vt=!0))}}catch(bn){}});return function(bn){return dn.apply(this,arguments)}}();try{dt=yield Ve(V[0]+Nt,{headers:lt,cache:Ke?"reload":"default",mode:"cors",timeout:1e4}),yield $t(dt)}catch(dn){}if(!(m||dt&&dt.ok||Ot))try{dt=yield Ve(V[1]+Nt,{headers:lt,mode:"cors",timeout:3e4})}catch(dn){}if(!(m||dt&&dt.ok||Ot))try{dt=yield Ve(V[0]+Nt,{headers:lt,mode:"cors",timeout:3e4}),yield $t(dt)}catch(dn){}Rt&&151==Rt.errorCode&&!_e&&(K.removeItem(Q),K.removeItem(ie),_=fe(),nt.cu=_,j=void 0,Nt="auth/?ext="+encodeURIComponent(ee(JSON.stringify(nt))),dt=yield Ve(V[0]+Nt,{headers:lt,mode:"cors",timeout:3e4}),yield $t(dt)),(()=>{if(!dt||!dt.ok){let dn;Vt&&K.setItem(ie,""),Rt?111==Rt.errorCode?dn=Rt.message:(dn=Rt.message.trim(),dn.endsWith(".")||(dn+="."),dn=I?`An error occurred during authorization: ${dn} [Contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.`:`An error occurred during authorization: ${dn} Contact the site administrator for more information.`):dn=I?Ae.publicTrialFailConnect:Ae.failConnect;let sn=Error(dn);throw Rt&&Rt.errorCode&&(sn.ltsErrorCode=Rt.errorCode),sn}})();let on=yield dt.text();try{j||_e||(K.setItem(Q,yield ae(JSON.stringify([_,Dt]))),j=Dt),K.setItem(ie,on)}catch(dn){}return on})(),new Promise((dt,Dt)=>{let Rt;Rt=I?Ae.publicTrialNetworkTimeout:Ae.networkTimeout,setTimeout(()=>Dt(new Error(Rt)),m?3e3:15e3)})])}catch(nt){W=nt}De=null})()),yield De});return function(nt){return ut.apply(this,arguments)}}(),Ze=function(){var ut=Fe(function*(){Re||(Re=Fe(function*(){if(L(_),!m){if(!F)throw P(W.message),W;return}let Ke={dm:Le};xe&&(Ke.bd=!0),Ke.brtk=!0,Ke.ls=V[0],g&&(-1!=g.indexOf("-")?Ke.hs=g:Ke.og=g),Ke.cu=_,S&&(Ke.fn=S),l&&(Ke.pd=l),u&&(Ke.v=u),v&&(Ke.dt=v),b&&(Ke.os=b),O&&(Ke.rmk=O),L(m);try{Ke.ar=m,Ke.bafc=!!W}catch(nt){}L(Ke);try{yield oe(Ke)}catch(nt){L("error updl")}yield et(),F||(F=!0),Re=null})()),yield Re});return function(){return ut.apply(this,arguments)}}(),et=function(){var ut=Fe(function*(){let Ke=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),nt=yield he();if(L(nt),nt&&nt<Ke)throw W?new Error(Ae.dlsErrorAndCacheExpire):new Error(Ae.checkLocalTime)});return function(){return ut.apply(this,arguments)}}(),Qe=null;const Je=new Promise(ut=>{Qe=()=>{Je.isPending=!1,Je.isFulfilled=!0,ut()}});let st=null,mt=function(){var ut=Fe(function*(Ke,nt){return z=z.then(Fe(function*(){try{let lt=yield J.keys();if(nt||(Je.isFulfilled?Ke&&(lt=lt.filter(xt=>xt<Ke)):Ke&&lt.includes(Ke)?lt=[Ke]:(lt=[],L("Unexpected null key"))),!lt.length)return;for(let xt=0;xt<lt.length/1e3;++xt){let dt=lt.slice(1e3*xt,1e3*(xt+1)),Dt=[];for(let Rt=0;Rt<dt.length;++Rt)Dt.push(yield J.getItem(dt[Rt]));if(j=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),!_e){let Rt=yield K.getItem(Q);Rt&&([_]=JSON.parse(yield te(Rt))),K.setItem(Q,yield ae(JSON.stringify([_,j])))}try{let Rt,Nt,Ot=V[0]+"verify/v2";j&&!_e&&(Ot+="?ltstime="+encodeURIComponent(j));try{Rt=Ve(Ot,{method:"POST",body:Dt.join(";"),keepalive:!0})}finally{!Je.isFulfilled&&BIe&&Qe()}try{Nt=yield Rt}finally{Je.isFulfilled||Qe()}if(!Nt.ok)throw new Error("verify failed. Status Code: "+Nt.status);for(let Vt=0;Vt<dt.length;++Vt)yield J.removeItem(dt[Vt])}catch(Rt){throw Je.isFulfilled||Qe(),X&&(X(Rt),X=null),Rt}}ne&&ne()}catch(lt){}})),yield z});return function(nt,lt){return ut.apply(this,arguments)}}();return{i:(ut=Fe(function*(Ke){return l=Ke.pd,u=Ke.v,f=u.split(".")[0],Ke.dt&&(v=Ke.dt),g=Ke.l||"",b="string"!=typeof Ke.os?JSON.stringify(Ke.os):Ke.os,S=Ke.fn,"string"==typeof S&&(S=S.substring(0,255)),Ke.ls&&Ke.ls.length&&(V=Ke.ls,1==V.length&&V.push(V[0])),I=!g||"200001"===g||g.startsWith("200001-"),k=Ke.sp,O=Ke.rmk,"string"==typeof O&&(O=O.substring(0,255)),Ke.lf&&($=Ke.lf),Ke.lsu&&(_=_e=Ke.lsu),Ke.feab&&(Z=Ke.feab),oe=Ke.updl,le=Ke.mnet,he=Ke.mxet,Ke.sutlcb&&(ne=Ke.sutlcb),yield de(),yield Fe(function*(){ie=ee(String.fromCharCode(g.charCodeAt(0)+10)+ee(l)+ee(g)+f+ee(""+v)),J=yield $.createInstance({name:"dynamdlsuns"+ee(ee("v2"))+ee(String.fromCharCode(g.charCodeAt(0)+10)+ee(l)+ee(g)+f+ee(""+v))});try{m=yield K.getItem(ie)}catch(nt){}})(),yield tt(),yield Ze(),(!W||W.ltsErrorCode>=102&&W.ltsErrorCode<=120)&&mt(null,!0),{ar:m,cu:_}}),function(nt){return ut.apply(this,arguments)}),c:function(){var ut=Fe(function*(){let Ke=new Date;if(Ke.getTime()<Xe+36e4)return;let nt=Ke.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),lt=yield le(),xt=yield he();if(xt&&xt<nt)yield tt(!0),yield Ze();else if(lt&&lt<nt){let dt=new Date(Ke.getTime());dt.setMinutes(Ke.getMinutes()-6);let Dt=dt.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");j<Dt&&tt().then(()=>Ze())}});return function(){return ut.apply(this,arguments)}}(),s:function(){var ut=Fe(function*(Ke,nt,lt,xt){if(nt){try{let dt;dt=nt.startsWith("{")&&nt.endsWith("}")?yield Z(nt):nt,dt?(L("bs "+lt),yield J.setItem(lt,dt),L("ss "+lt)):L("ept ecpt")}catch(dt){}xt&&(L("bd "+lt),yield mt(lt,2==xt),L("sd "+lt)),st&&clearTimeout(st),st=setTimeout(Fe(function*(){yield mt()}),36e4)}else yield mt(lt)});return function(nt,lt,xt,dt){return ut.apply(this,arguments)}}(),p:Je,u:function(){var ut=Fe(function*(){return yield de(),_});return function(){return ut.apply(this,arguments)}}(),caret:et};var ut};var gp;class xi{static init(){ow._=at(xi,this,void 0),sw._=at(xi,this,void 0),B_._=at(xi,this,"init")}static reset(){ow._=at(xi,this,void 0),sw._=at(xi,this,void 0),B_._=at(xi,this,"")}static setLicenseInfo(l){var u;B_._=at(xi,this,"done"),ow._=at(xi,this,[]),ow._=at(xi,this,null!==(u=null==l?void 0:l.modules)&&void 0!==u?u:[])}static setLicenseErr(l){sw._=at(xi,this,l),B_._=at(xi,this,"done")}static makeSureLoadLicenseExist(){return at(xi,this,b2).call(this,3101,5001)}static makeSureCoreLicenseExist(){return at(xi,this,b2).call(this,3101)}static makeSureCameraLicenseExist(){return at(xi,this,b2).call(this,3006,8002)}static makeSureAnnotationLicenseExist(){return at(xi,this,b2).call(this,15)}static annotationLicenseModuleIsExist(){return at(xi,this,FDe).call(this,15)}}function D5(p){for(const l of at(gp,this,ow)._)if(l.module===p)return l;return{code:it.LIC_MISS_MODULE.code,message:it.LIC_MISS_MODULE.message,module:p}}function b2(p,l){""===at(gp,this,B_)._&&it.throw(it.INIT_SHOULD_SET_CONFIG),"done"!==at(gp,this,B_)._&&it.throw(it.INIT_CONFIG_NOT_DONE),at(gp,this,sw)._&&it.throw(at(gp,this,sw)._);const u=at(gp,this,D5).call(this,p);0!==u.code&&(!l||l&&0!==at(gp,this,D5).call(this,l).code)&&it.throw({code:u.code,message:u.message})}function FDe(p){return 0===at(gp,this,D5).call(this,p).code}gp=xi;var ow={_:void 0},sw={_:void 0},B_={_:""};function PZ(p){let l;if(p){let u;const f=p.message;u=p.ltsErrorCode,Xt(u)?111===u?u=it.LIC_EXPIRED.code:106===u||108===u?u=it.LIC_INVALID.code:u>0&&(u=-(2e4+u)):u=it.LIC_INVALID.code,l={code:u,message:f}}else l=it.LIC_INVALID;return l}const RZ="2.0.0";var mp;!function(p){p[p.publicTrial=0]="publicTrial",p[p.privateTrial=1]="privateTrial",p[p.normal=2]="normal"}(mp||(mp={}));var Xh,aw=new WeakMap,x2=new WeakMap,w2=new WeakMap,S2=new WeakMap,T2=new WeakMap,Yg=new WeakMap,I2=new WeakMap,lw=new WeakMap,Wv=new WeakSet;class LDe{constructor(l){al(this,Wv),bi(this,aw,void 0),bi(this,x2,void 0),bi(this,w2,void 0),bi(this,S2,void 0),bi(this,T2,void 0),bi(this,Yg,void 0),bi(this,I2,void 0),bi(this,lw,void 0),Bn(x2,this,void 0),Bn(aw,this,void 0),Bn(w2,this,""),Bn(S2,this,""),Bn(Yg,this,mp.publicTrial),Bn(lw,this,void 0),Bn(I2,this,"");const u=function(p){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const u=p;if(u._pLoad.isEmpty){let f,g,m,v=u._license||"",_=JSON.parse(JSON.stringify(u._licenseServer)),b=u._sessionPassword,S=0;if(v.startsWith("t")||v.startsWith("f"))S=0;else if(0===v.length||v.startsWith("P")||v.startsWith("L")||v.startsWith("Y")||v.startsWith("A"))S=1;else{S=2;const I=v.indexOf(":");-1!=I&&(v=v.substring(I+1));const k=v.indexOf("?");if(-1!=k&&(g=v.substring(k+1),v=v.substring(0,k)),v.startsWith("DLC2"))S=0;else{if(v.startsWith("DLS2")){let O;try{let j=v.substring(4);j=atob(j),O=JSON.parse(j)}catch(j){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(v=O.handshakeCode?O.handshakeCode:O.organizationID?O.organizationID:"","number"==typeof v&&(v=JSON.stringify(v)),0===_.length){let j=[];O.mainServerURL&&(j[0]=O.mainServerURL),O.standbyServerURL&&(j[1]=O.standbyServerURL),_=(W=>{if(null==W)W=[];else{W=W instanceof Array?[...W]:[W];for(let J=0;J<W.length;++J){if(!bv){let K=document.createElement("a");K.href=W[J],W[J]=K.href}W[J].endsWith("/")||(W[J]+="/")}}return W})(j)}!b&&O.sessionPassword&&(b=O.sessionPassword),f=O.remark}v&&"200001"!==v&&!v.startsWith("200001-")||(S=1)}}if(S&&(l||(xv.crypto||(m="Please upgrade your browser to support online key."),xv.crypto.subtle||(m="Require https to use online key in this browser."))),m){if(1!==S)throw new Error(m);S=0,u._lastErrorCode=-1,u._lastErrorString=m}return 1===S&&(v=""),{lt:S,l:v,ls:_,sp:b,rmk:f,cv:g}}throw new Error("Can't preprocess license again is not allowed to change after `createInstance` or `loadWasm` is called.")}({_pLoad:{isEmpty:!0},_license:l,_licenseServer:[]},!0);let f;if(u&&xn(u.l)?(f=u.l.trim(),Bn(Yg,this,1===u.lt?mp.publicTrial:2===u.lt?mp.privateTrial:mp.normal)):(f="",Bn(Yg,this,mp.publicTrial)),""===f?Bn(aw,this,f):f.includes("-")?Bn(x2,this,f):Bn(aw,this,f),Di(u.ls)){u.ls.length>0&&Bn(lw,this,u.ls);const g=Ye(lw,this);let m,v;if(g&&g.length>0){for(m=0;m<g.length;m++)v=g[m],v.endsWith("/")||(g[m]=`${v}/`);at(Wv,this,NDe).call(this,g,f)&&Bn(Yg,this,mp.publicTrial)}}Bn(I2,this,u.sp)}init(l,u,f){var g=this;return Fe(function*(){let m=l;m.endsWith("/")||(m=`${m}/`),Ye(T2,g)||(yield at(Wv,g,WDe).call(g,f));try{yield at(Wv,g,jDe).call(g,u)}catch(v){const _=PZ(v);let b=!1;_.code===it.LIC_EXPIRED.code?-1!==_.message.toLowerCase().indexOf("trial license")&&(b=!0):g.isPublicTrial()&&(b=!0),b&&xZ({_bNeverShowDialog:!1,engineResourcePath:m,_onLog:console.log},"error",_.message),it.throw(_)}})()}getClientUUID(){return Ye(S2,this)}getAuthResult(){return Ye(w2,this)}isPublicTrial(){return Ye(Yg,this)===mp.publicTrial}setClientUUID(l){Bn(S2,this,l)}setAuthResult(l){Bn(w2,this,l)}}function NDe(p,l){let u=!0;if(Di(p)&&p.length>0){const f=p[0];xn(f)&&""!==f&&!f.includes("https://mlts.dynamsoft.com")&&(u=!1)}return u&&(!l||"200001"===l||l.startsWith("200001-"))}function BDe(){return window.location.origin?window.location.origin.startsWith("http")?window.location.origin:"https://localhost":window.location.href.startsWith("http")?window.location.href:"https://localhost"}function WDe(p){const l={dm:at(Wv,this,BDe).call(this),fetch:window.fetch};p&&(l.bd=!0,l.log=console.log),Bn(T2,this,ODe(l))}function UDe(){return this.isPublicTrial()?"":Ye(x2,this)||Ye(aw,this)}function VDe(){const p=[];return p.push(cl.browser),p.push(cl.version.toString()),p.push(cl.OS),p.join(" ")}function jDe(p){return A5.apply(this,arguments)}function A5(){return A5=Fe(function*(p){if(this.getAuthResult()&&this.getClientUUID())return{ar:this.getAuthResult(),cu:this.getClientUUID()};const l={pd:"ddv",dt:"browser",v:RZ,os:at(Wv,this,VDe).call(this),l:at(Wv,this,UDe).call(this),ls:Ye(lw,this),sp:Ye(I2,this),fn:p||"",mnet(){},mxet(){}};""!==this.getClientUUID()&&(l.lsu=this.getClientUUID()),l.updateLicense=f=>{this.setAuthResult(f.ar),this.getClientUUID()||this.setClientUUID(f.cu)};const u=yield Ye(T2,this).i(l);return this.getAuthResult()||this.setAuthResult(u.ar),this.getClientUUID()||this.setClientUUID(u.cu),u}),A5.apply(this,arguments)}function P5(){return P5=Fe(function*(p){let l=p.engineResourcePath.trim();if(l.endsWith("/")||(l=`${l}/`),gn.resourceDir=l,xi.init(),!(yield gn.isResourceDirValid()))return xi.reset(),it.reject(it.RESOURCE_NOT_FOUND,"DDV.Core.init");yield gn.preloadModule("core");const u=p.license.trim();let f,g,m=u.startsWith("DLS")||0===u.length,v=!1,_=!1;if(m)try{var b;let k=!1;if(!u&&null!==(b=window)&&void 0!==b&&null!==(b=b.Dynamsoft)&&void 0!==b&&b.DWT){let O=window.Dynamsoft.DWT,j=O.lgar(O.EnumInstance.dwt_desktop,""),W=O.li({instanceMode:O.EnumInstance.dwt_desktop},"");j&&W&&(f=j,g=W,v=O.isPublicLicense(),k=!0)}if(!k){var S;let O;if(null!=no&&no.license?O=yield no.license.getAR():null!==(S=window)&&void 0!==S&&null!==(S=S.Dynamsoft)&&void 0!==S&&null!==(S=S.Core)&&void 0!==S&&null!==(S=S.mapPackageRegister)&&void 0!==S&&S.license&&(O=yield window.Dynamsoft.Core.mapPackageRegister.license.getAR()),O)f=O.ar,g=O.u,v=O.pt,O.pk?(f=O.pk,m=!1):_=!0,pt(f)&&O.ae&&it.throw(PZ(O.ae));else{const j=yield(W=Fe(function*(J,K,Q,ie){const oe=new LDe(J);return yield oe.init(K,Q,ie),{authResult:oe.getAuthResult(),clientUUID:oe.getClientUUID(),bPublicTrial:oe.isPublicTrial()}}),function(J,K,Q,ie){return W.apply(this,arguments)})(u,l,p.deviceFriendlyName||"");f=j.authResult,g=j.clientUUID,v=j.bPublicTrial}}}catch(k){throw xi.setLicenseErr(k),k}else f=u,g="";var W;const I={licenseInfo:null};try{const k=yield gn.getLicenseInfo(f,m,g);I.licenseInfo=k,xi.setLicenseInfo(k),!_&&v&&k.trial&&k.msg&&xZ({_bNeverShowDialog:!1,engineResourcePath:l,_onLog:console.log},"warn",k.msg)}catch(k){throw k&&k.code<=-8e4&&xi.setLicenseErr(k),k}return m&&(I.deviceUuid=g),I}),P5.apply(this,arguments)}const GDe={scrollToLatest:!1};class zDe{constructor(l){N(this,"viewerUids",void 0),N(this,"groupUid",void 0),N(this,"config",void 0),N(this,"isSetScrollToLatest",!1),this.groupUid=l,this.viewerUids=new Set,this.config=hn(GDe)}getViewerUids(){return[...this.viewerUids.values()]}updateConfig(){Object.assign(this.config,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}}var kZ,qo;(function(p){p.LEFT="left",p.TOP="top",p.RIGHT="right",p.BOTTOM="bottom"})(kZ||(kZ={})),function(p){p.DEFAULT="default",p.CAPTURE="capture",p.PERSPECTIVE="perspective",p.THUMBNAIL="thumbnail"}(qo||(qo={}));class MZ{constructor(){N(this,"db",void 0),this.db=new Map}set(l,u){var f=this;return Fe(function*(){return new Promise((g,m)=>{f.db.has(l)?m(new Error(`The item ${l} already exists.`)):(f.db.set(l,u),g(`Save ${l} to database successful.`))})})()}get(l){var u=this;return Fe(function*(){return new Promise((f,g)=>{u.db.has(l)?f(u.db.get(l)):g(new Error(`The item ${l} does not exist.`))})})()}remove(l){var u=this;return Fe(function*(){return new Promise((f,g)=>{const m=u.db.get(l);u.db.delete(l),f(m)})})()}update(l,u){var f=this;return Fe(function*(){return new Promise((g,m)=>{f.db.has(l)?(f.db.set(l,u),g(`Update ${l} successful.`)):m(new Error(`The item ${l} does not exist.`))})})()}dispose(){this.db.clear()}reset(){this.db.clear()}}class YDe extends rr{constructor(){super(),N(this,"openDocument",void 0),N(this,"closeDocument",void 0),N(this,"syncDocument",void 0),N(this,"addPagesToDoc",void 0),N(this,"deletePages",void 0),N(this,"updatePage",void 0),N(this,"selectedPageChanged",void 0),N(this,"viewerModeChanged",void 0),N(this,"pageChanged",void 0),N(this,"currentPageChanged",void 0),N(this,"pageChangedAfterRender",void 0),N(this,"pageExistenceChanged",void 0),N(this,"tabChanged",void 0),N(this,"displayModeChanged",void 0),N(this,"fitModeChanged",void 0),N(this,"filterChanged",void 0),N(this,"toolModeChanged",void 0),N(this,"zoomChanged",void 0),N(this,"visibleChanged",void 0),N(this,"cropRectDrawn",void 0),N(this,"cropRectDeleted",void 0),N(this,"cropModeChanged",void 0),N(this,"quadModified",void 0),N(this,"autoCaptureChanged",void 0),N(this,"autoDetectChanged",void 0),N(this,"torchChanged",void 0),N(this,"cameraPlayed",void 0),N(this,"cameraClosed",void 0),N(this,"cameraInit",void 0),N(this,"beforeLayout",void 0),N(this,"afterLayout",void 0),N(this,"beforeRender",void 0),N(this,"afterRender",void 0),N(this,"destroy",void 0),N(this,"canvasCursorStyleChanged",void 0),N(this,"quadSelectionStyleChanged",void 0),N(this,"perspectiveQuadChanged",void 0),N(this,"beforeCropPages",void 0),N(this,"operationsChanged",void 0),N(this,"resize",void 0),N(this,"annotationsUpdated",void 0),N(this,"annotationModeChanged",void 0),N(this,"annotationDefaultStyleChanged",void 0),N(this,"selectedAnnotationsChanged",void 0),N(this,"annotationLayerStateChanged",void 0),N(this,"beforeAnnotationEdit",void 0),N(this,"afterAnnotationEdit",void 0),N(this,"beforeAnnotationDraw",void 0),N(this,"afterAnnotationDraw",void 0),N(this,"annotationTextCharsSelected",void 0),N(this,"scroll",void 0),this.openDocument=Et(this),this.closeDocument=Et(this),this.syncDocument=Et(this),this.addPagesToDoc=Et(this),this.deletePages=Et(this),this.updatePage=Et(this),this.selectedPageChanged=Et(this),this.viewerModeChanged=Et(this),this.pageChanged=Et(this),this.currentPageChanged=Et(this),this.pageChangedAfterRender=Et(this),this.pageExistenceChanged=Et(this),this.tabChanged=Et(this),this.displayModeChanged=Et(this),this.fitModeChanged=Et(this),this.filterChanged=Et(this),this.toolModeChanged=Et(this),this.zoomChanged=Et(this),this.visibleChanged=Et(this),this.cropRectDrawn=Et(this),this.cropRectDeleted=Et(this),this.cropModeChanged=Et(this),this.quadModified=Et(this),this.autoCaptureChanged=Et(this),this.autoDetectChanged=Et(this),this.torchChanged=Et(this),this.cameraPlayed=Et(this),this.cameraClosed=Et(this),this.cameraInit=Et(this),this.beforeLayout=Et(this),this.afterLayout=Et(this),this.beforeRender=Et(this),this.afterRender=Et(this),this.destroy=Et(this),this.canvasCursorStyleChanged=Et(this),this.quadSelectionStyleChanged=Et(this),this.perspectiveQuadChanged=Et(this),this.beforeCropPages=Et(this),this.operationsChanged=Et(this),this.resize=Et(this),this.annotationModeChanged=Et(this),this.selectedAnnotationsChanged=Et(this),this.annotationLayerStateChanged=Et(this),this.annotationDefaultStyleChanged=Et(this),this.beforeAnnotationEdit=Et(this),this.afterAnnotationEdit=Et(this),this.beforeAnnotationDraw=Et(this),this.afterAnnotationDraw=Et(this),this.annotationsUpdated=Et(this),this.annotationTextCharsSelected=Et(this),this.scroll=Et(this)}}class en{static numberArrayIsValid(l,u,f,g,m){return at(en,this,E2).call(this,l,1,u,f,m,g)}static stringArrayIsValid(l,u){return at(en,this,E2).call(this,l,2,void 0,void 0,0,u)}static blobArrayIsValid(l,u){return at(en,this,E2).call(this,l,4,void 0,void 0,void 0,u)}static quadIsValid(l,u){const f=[],g="Quad";at(en,this,ao).call(this,f,l,6,at(en,this,qr).call(this,g,u,void 0),4);let m=0;for(const v of l){const _=`[${m}]`;f.push(...at(en,this,E2).call(this,v,1,void 0,void 0,2,at(en,this,qr).call(this,g,u,_,!0))),m+=1}return f}static docDetectConfigIsValid(l,u){const f=[],g="DocumentDetectConfig";return at(en,this,ao).call(this,f,l,5,at(en,this,qr).call(this,g,u)),at(en,this,ao).call(this,f,l.autoCaptureDelay,1,at(en,this,qr).call(this,g,u,"autoCaptureDelay")),pt(l.acceptedPolygonConfidence)||at(en,this,ao).call(this,f,l.acceptedPolygonConfidence,1,at(en,this,qr).call(this,g,u,"acceptedPolygonConfidence")),pt(l.enableAutoCapture)||at(en,this,ao).call(this,f,l.enableAutoCapture,3,at(en,this,qr).call(this,g,u,"enableAutoCapture")),f}static docDetectConfIsValid(l,u){const f=[],g="DocumentDetectConfidence";return at(en,this,ao).call(this,f,l,5,at(en,this,qr).call(this,g,u)),at(en,this,ao).call(this,f,l.angleConfidence,1,at(en,this,qr).call(this,g,u,"angleConfidence"),0,100),at(en,this,ao).call(this,f,l.areaConfidence,1,at(en,this,qr).call(this,g,u,"areaConfidence"),0,100),at(en,this,ao).call(this,f,l.centerConfidence,1,at(en,this,qr).call(this,g,u,"centerConfidence"),0,100),f}static imageDataIsValid(l,u){const f=[],g="VImageData";return at(en,this,ao).call(this,f,l,5,at(en,this,qr).call(this,g,u)),at(en,this,ao).call(this,f,l.data,8,at(en,this,qr).call(this,g,u,"data")),at(en,this,ao).call(this,f,l.type,9,at(en,this,qr).call(this,g,u,"type")),pt(l.height)||at(en,this,ao).call(this,f,l.height,1,at(en,this,qr).call(this,g,u,"height")),pt(l.width)||at(en,this,ao).call(this,f,l.width,1,at(en,this,qr).call(this,g,u,"width")),f}static filterTypeIsValid(l,u){const f=[];return at(en,this,ao).call(this,f,l,10,at(en,this,qr).call(this,"EnumImageFilterType",u)),f}static imageEncodeOptionIsValid(l,u){const f=[],g="ImageEncodeOption";return at(en,this,ao).call(this,f,l,5,at(en,this,qr).call(this,g,u)),at(en,this,ao).call(this,f,l.type,9,at(en,this,qr).call(this,g,u,"type")),pt(l.params)||at(en,this,ao).call(this,f,l.params,5,at(en,this,qr).call(this,g,u,"params")),f}static makeSureNumberValid(l,u,f,g,m,v){return at(en,this,OZ).call(this,at(en,this,FZ).call(this,l,u,f),g,m,v)}static makeSureStringValid(l,u,f,g){return at(en,this,OZ).call(this,{isValid:at(en,this,k5).call(this,l)},u,f,g)}static makeSureDetectResultValid(l,u,f,g){const m=[],v="DetectResult";at(en,this,ao).call(this,m,l,5,at(en,this,qr).call(this,v,g)),m.push(...en.quadIsValid(null==l?void 0:l.location,v)),at(en,this,ao).call(this,m,null==l?void 0:l.width,1,at(en,this,qr).call(this,v,g,"width"),1,void 0),at(en,this,ao).call(this,m,null==l?void 0:l.height,1,at(en,this,qr).call(this,v,g,"height"),1,void 0),m.push(...en.docDetectConfigIsValid(null==l?void 0:l.config,v)),null!=l&&l.confidence&&at(en,this,ao).call(this,m,l.confidence,1,at(en,this,qr).call(this,v,g,"confidence")),this.makeSureValid(m,u,f)}static makeSureValid(l,u,f,g){0!==l.length&&at(en,this,R5).call(this,l,u,f,g)}static makeSureMissing(l,u,f){pt(l)&&at(en,this,R5).call(this,void 0,u,f,it.PARAM_MISS)}static makeSureCameraObject(l,u,f){const g=[],m=f;this.makeSureMissing(l,u,f),xn(l)?this.makeSureStringValid(l,u,f):(at(en,this,ao).call(this,g,l,5,at(en,this,qr).call(this,m)),at(en,this,ao).call(this,g,l.deviceId,2,at(en,this,qr).call(this,m,void 0,"deviceId")),at(en,this,ao).call(this,g,l.label,2,at(en,this,qr).call(this,m,void 0,"label")),this.makeSureValid(g,u,f))}static initTypeCheckMap(){at(en,this,Ua)._[7]=RE,at(en,this,Ua)._[15]=xn,at(en,this,Ua)._[3]=Ds,at(en,this,Ua)._[5]=Un,at(en,this,Ua)._[4]=ul,at(en,this,Ua)._[2]=at(en,this,k5),at(en,this,Ua)._[8]=at(en,this,$De),at(en,this,Ua)._[11]=at(en,this,QDe),at(en,this,Ua)._[12]=at(en,this,ZDe),at(en,this,Ua)._[13]=at(en,this,eAe),at(en,this,Ua)._[14]=at(en,this,tAe),at(en,this,Ua)._[1]=at(en,this,FZ),at(en,this,Ua)._[6]=at(en,this,qDe),at(en,this,Ua)._[9]=at(en,this,KDe),at(en,this,Ua)._[10]=at(en,this,JDe),at(en,this,Ua)._[16]=at(en,this,nAe)}}function E2(p,l,u,f,g,m){const v=[],_="Array";if(at(Xh,this,ao).call(this,v,p,6,at(Xh,this,qr).call(this,_,m),g),v.length>0)return v;let b=0;for(const S of p){const I=`[${b}]`;at(Xh,this,ao).call(this,v,S,l,at(Xh,this,qr).call(this,_,m,I,!0),u,f),b+=1}return v}function OZ(p,l,u,f){const{isValid:g,isInRange:m,isSupported:v}=p,_=!!pt(g)||g,b=!!pt(m)||m,S=!!pt(v)||v;_&&b&&S||(f||(f=_?b?it.PARAM_NOT_SUPPORT:it.PARAM_OUT_OF_RANGE:it.PARAM_INVALID),at(Xh,this,R5).call(this,void 0,l,u,f))}function qr(p,l,u,f){return l?u?`${l}${f?"":"."}${u}`:`${l}`:u?`${p}${f?"":"."}${u}`:`${p}`}function R5(p,l,u,f){const g=pt(f)?qe({},it.PARAM_INVALID):qe({},f);p&&(g.details=p),it.throw(g,l,u)}function ao(p,l,u,f,g,m){const v=at(Xh,this,XDe).call(this,l,u,f,g,m);v&&p.push(v)}function XDe(p,l,u,f,g){if(pt(p))return`${u} is missing.`;const m=at(Xh,this,Ua)._[l];if(m){const v=m.bind(this)(p,f,g);if(Ds(v)){if(!v)return`${u} is invalid.`}else if(Un(v)){const{isValid:_,isInRange:b,isSupported:S}=v;if(!1===_)return`${u} is invalid.`;if(!1===b)return`${u} is out of range.`;if(!1===S)return`${u} is not supported.`}}}function $De(p){return RE(p)||ul(p)}function qDe(p,l){return Di(p)?Xt(l)&&0===p.length||!pt(l)&&p.length<l?{isValid:!1}:{isValid:!0,isInRange:!!pt(l)||p.length>=l}:{isValid:!1}}function KDe(p){return Xt(p)?{isValid:!0,isInRange:p>=Tr.RGBA&&p<=Tr.PNG}:{isValid:!1}}function JDe(p){return xn(p)?{isValid:!0,isInRange:(l=p,!!bZ.get(l))}:{isValid:!1};var l}function QDe(p){return void 0!==BO.get(p)}function ZDe(p){return void 0!==HE.get(p)}function eAe(p){return void 0!==NO.get(p)}function tAe(p){if(xn(p)){const l=p.trim();return-1!==at(Xh,this,iAe)._.indexOf(l)}return!1}function FZ(p,l,u){let f=!0;return Xt(p)?(pt(l)||(f=p>=l),!pt(u)&&f&&(f=p<=u),{isValid:!0,isInRange:f}):{isValid:!1}}function k5(p){return!!xn(p)&&0!==p.trim().length}function nAe(p){if(!at(Xh,this,k5).call(this,p))return{isValid:!1};const l=p.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['\u2019](\d{2})['\u2019]|)$/);let u=!1;if(l){const[,f,g,m,v,_,b,S,I,k]=l,O=new Date(`${f}-${g}-${m}T${v}:${_}:${b}`);if(u=!0,O.getFullYear()===parseInt(f,10)&&O.getMonth()+1===parseInt(g,10)&&O.getDate()===parseInt(m,10)&&O.getHours()===parseInt(v,10)&&O.getMinutes()===parseInt(_,10)&&O.getSeconds()===parseInt(b,10)||(u=!1),u&&S){const j=parseInt(I,10),W=parseInt(k,10);("+"===S&&(j<0||j>12||W<0||W>59)||"-"===S&&(j<0||j>12||W<0||W>59))&&(u=!1)}}return{isSupported:u}}Xh=en;var iAe={_:["1.1","1.2","1.3","1.4","1.5","1.6","1.7"]},Ua={_:Object.create(null)};en.initTypeCheckMap();class rAe{constructor(l){N(this,"maxConcurrency",void 0),N(this,"currentConcurrency",void 0),N(this,"queue",void 0),this.maxConcurrency=l,this.currentConcurrency=0,this.queue=[]}acquire(){var l=this;return Fe(function*(){return new Promise(u=>{l.currentConcurrency<l.maxConcurrency?(l.currentConcurrency+=1,u(!0)):l.queue.push(u)})})()}release(){this.queue.length>0?this.queue.shift()():this.currentConcurrency-=1}}class cw extends class oAe{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;N(this,"tasks",void 0),N(this,"semaphore",void 0),this.tasks=[],this.semaphore=new rAe(l)}process(l){var u=this;return Fe(function*(){yield u.semaphore.acquire();let f=null;try{l.cancelled||(f=yield u.handler(l.taskUid))}catch(g){f=null}if(l.completed=!0,u.tasks.includes(l)){const g=u.tasks.indexOf(l);u.tasks.splice(g,1)}l.emitter.emit(l.taskUid,f),u.semaphore.release()})()}executeTask(l){var u=this;return Fe(function*(){return new Promise((f,g)=>{let m=u.tasks.find(v=>v.taskUid===l);m||(m={taskUid:l,emitter:new Bh,completed:!1,cancelled:!1,running:!1},u.tasks.push(m)),m.cancelled=!1,m.emitter.on(l,v=>{f(v)}),m.running||(m.running=!0,u.process(m))})})()}cancel(l){const u=this.tasks.find(f=>f.taskUid===l);u&&(u.cancelled=!0)}destroy(){this.tasks=[]}handler(l){return Fe(function*(){return Promise.resolve(null)})()}}{handler(l){return Fe(function*(){return new Promise((u,f)=>{const g=new Image;g.crossOrigin="Anonymous",g.onload=()=>{g.onload=null,g.onerror=null,u(g)},g.onerror=m=>{g.onload=null,g.onerror=null,u(null)},g.src=l})})()}}class sAe extends cw{constructor(l,u){super(),N(this,"core",void 0),N(this,"imageLoader",void 0),this.core=l,this.imageLoader=u}handler(l){var u=this;return Fe(function*(){let f=u.core.pageService.getPage(l);if(!f||f.isDestroyed)return null;let{img:g}=f.raw;if(!g){let{url:m}=f.raw;if(!m){let v=f.raw.data;if(!v){let _=yield u.core.imageDataService.getRaw(l);const b=u.core.pageService.getPage(l);if(!b||(f.isDestroyed&&!b.isDestroyed&&(_=yield u.core.imageDataService.getRaw(l,!0)),!_||b.isDestroyed))return null;v=_.data}m=URL.createObjectURL(v),f.raw.url=m}if(g=yield u.imageLoader.executeTask(m),f=u.core.pageService.getPage(l),!f||f.isDestroyed)return null;f.raw.img=g}return g})()}}class aAe extends cw{constructor(l,u){super(),N(this,"core",void 0),N(this,"imageLoader",void 0),this.core=l,this.imageLoader=u}handler(l){var u=this;return Fe(function*(){var f;let g=u.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;let m=null===(f=g.original)||void 0===f?void 0:f.img;if(!m){var v;let b=null===(v=g.original)||void 0===v?void 0:v.url;if(!b){var _;let S=null===(_=g.original)||void 0===_?void 0:_.data;if(!S){let I=yield u.core.imageDataService.getOriginal(l);const k=u.core.pageService.getPage(l);if(!k||(g.isDestroyed&&!k.isDestroyed&&(I=yield u.core.imageDataService.getRaw(l,!0)),!I||k.isDestroyed))return null;S=I.data}b=URL.createObjectURL(S),g.original.url=b}if(m=yield u.imageLoader.executeTask(b),g=u.core.pageService.getPage(l),!g||g.isDestroyed)return null;g.original.img=m}return m})()}}class lAe extends cw{constructor(l,u){super(),N(this,"core",void 0),N(this,"imageLoader",void 0),this.core=l,this.imageLoader=u}handler(l){var u=this;return Fe(function*(){var f;let g=u.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;let m=null===(f=g.display)||void 0===f?void 0:f.img;if(!m){var v;let b=null===(v=g.display)||void 0===v?void 0:v.url;if(!b){var _;let I=null===(_=g.display)||void 0===_?void 0:_.data;if(!I){let k=yield u.core.imageDataService.getDisplay(l,!0);const O=u.core.pageService.getPage(l);if(!O||(g.isDestroyed&&!O.isDestroyed&&(k=yield u.core.imageDataService.getDisplay(l,!0)),!k||O.isDestroyed))return null;I=k.data}b=URL.createObjectURL(I),g.display.url=b}const{filter:S}=g;if(m=yield u.imageLoader.executeTask(b),g=u.core.pageService.getPage(l),!g||g.isDestroyed)return null;if(S!==g.filter)return u.handler(g.uid);g.display.img=m}return m})()}}class cAe extends cw{constructor(l,u){super(),N(this,"core",void 0),N(this,"imageLoader",void 0),this.core=l,this.imageLoader=u}handler(l){var u=this;return Fe(function*(){var f;let g=u.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;let m=null===(f=g.thumbnail)||void 0===f?void 0:f.img;if(!m){var v;let b=null===(v=g.thumbnail)||void 0===v?void 0:v.url;if(!b){var _;let S=null===(_=g.thumbnail)||void 0===_?void 0:_.data;if(!S){const I=yield u.core.imageDataService.getThumbnail(l);if(g=u.core.pageService.getPage(l),!I||g.isDestroyed)return null;S=I.data}b=URL.createObjectURL(S),g.thumbnail.url=b}if(m=yield u.imageLoader.executeTask(b),g=u.core.pageService.getPage(l),g.isDestroyed)return null;g.thumbnail.img=m}return m})()}}class uAe{constructor(l){N(this,"rawImageLoader",void 0),N(this,"originalImageLoader",void 0),N(this,"displayImageLoader",void 0),N(this,"thumbnailImageLoader",void 0);const u=new cw;this.rawImageLoader=new sAe(l,u),this.originalImageLoader=new aAe(l,u),this.displayImageLoader=new lAe(l,u),this.thumbnailImageLoader=new cAe(l,u)}loadRawImage(l){var u=this;return Fe(function*(){return u.rawImageLoader.executeTask(l)})()}cancelLoadRawImage(l){this.rawImageLoader.cancel(l)}loadOriginalImage(l){var u=this;return Fe(function*(){return u.originalImageLoader.executeTask(l)})()}cancelLoadOriginalImage(l){this.originalImageLoader.cancel(l)}loadDisplayImage(l){var u=this;return Fe(function*(){return u.displayImageLoader.executeTask(l)})()}cancelLoadDisplayImage(l){this.displayImageLoader.cancel(l)}loadThumbnailImage(l){var u=this;return Fe(function*(){return u.thumbnailImageLoader.executeTask(l)})()}cancelLoadThumbnailImage(l){this.thumbnailImageLoader.cancel(l)}}class dAe{constructor(l,u,f){N(this,"worker",void 0),N(this,"id",void 0),N(this,"manager",void 0),N(this,"callbacks",{}),N(this,"busy",!1),N(this,"counter",0),N(this,"tasks",[]),this.worker=l,this.id=u,this.manager=f,this.worker.addEventListener("message",g=>{this.onMessage(g)},!1)}cancel(l){const u=this.tasks.findIndex(f=>{var g;return(null===(g=f.data)||void 0===g?void 0:g.taskUid)===l});if(u>=0){const f=this.tasks.splice(u,1)[0];this.callbacks[f.callbackId]&&delete this.callbacks[f.callbackId],this.setBusy(!1)}}setBusy(l){if(this.busy=l,!l)if(this.tasks.length){const u=this.tasks.shift();this.send(u)}else this.worker.terminate(),this.manager.removeActor(this)}isBusy(){return this.busy}getWorker(){return this.worker}onMessage(l){this.setBusy(!1);const{callbackId:u}=l.data,f=u?this.callbacks[u]:null;f&&f(l.data),delete this.callbacks[u]}send(l,u){if(this.busy)return void this.tasks.push(qe({},l));this.setBusy(!0);const f=`${this.id}-${l.action}-cb-${this.counter}`;l.callback&&(this.callbacks[f]=l.callback,this.counter+=1),l.callbackId=f;const g=Ht(qe({},l.data),{callbackId:f});u?this.worker.postMessage(g,[u.data.buffer]):this.worker.postMessage(g)}}class hAe{constructor(l,u){N(this,"concurrency",1),N(this,"actors",[]),N(this,"workerUrl",void 0),this.workerUrl=l,this.concurrency=u}send(l,u){this.getActor().send(l,u)}getActor(){const l=this.actors.filter(f=>!f.isBusy())[0];if(l)return l;if(this.actors.length<this.concurrency){const f=new Worker(this.workerUrl),g=new dAe(f,this.actors.length,this);return this.actors.push(g),g}const u=Math.floor(Math.random()*this.concurrency);return this.actors[u]}removeActor(l){const u=this.actors.indexOf(l);this.actors.splice(u,1)}cancel(l){for(const u of this.actors)u.cancel(l)}clear(){for(const l of this.actors)l.getWorker().terminate();this.actors=[]}}function fAe(){onmessage=p=>{const{index:l}=p.data,u=p.data.sourceWidth,f=p.data.sourceHeight,g=p.data.width,m=p.data.height,v=p.data.source.data,_=g*m*4,b=new ArrayBuffer(_);let S=null;try{S=new Uint8ClampedArray(b,0,_)}catch(k){S=new Uint8Array(b,0,_)}for(let k=0;k<m;k++){const O=k*f/m,j=Math.floor(O),W=1-(O-j),J=j,K=(k+1)*f/m,Q=Math.floor(K-1e-5),ie=K-Q,oe=Q;let le=k*g*4;for(let he=0;he<g;he++){const _e=he*u/g,Ve=Math.floor(_e),ee=1-(_e-Ve),ke=Ve,xe=(he+1)*u/g,Le=Math.floor(xe-1e-5),V=xe-Le,F=Le;let z=0,$=0,P=0,L=0,X=0;const ne=255;let Z,te,ae=(J+1)*u*4+4*ke;for(Z=J+1;Z<oe;++Z)z+=v[ae+2]*ee*ne,$+=v[ae+1]*ee*ne,P+=v[ae]*ee*ne,L+=v[ae+3]*ee*ne,X+=ne*ee,ae+=4*u;let fe=(J+1)*u*4+4*F;for(Z=J+1;Z<oe;++Z)z+=v[fe+2]*V*ne,$+=v[fe+1]*V*ne,P+=v[fe]*V*ne,L+=v[fe+3]*V*ne,X+=ne*V,fe+=4*u;let be=J*u*4+4*(ke+1);for(te=ke+1;te<F;++te)z+=v[be+2]*W*ne,$+=v[be+1]*W*ne,P+=v[be]*W*ne,L+=v[be+3]*W*ne,X+=ne*W,be+=4;let Pe=oe*u*4+4*(ke+1);for(te=ke+1;te<F;++te)z+=v[Pe+2]*ie*ne,$+=v[Pe+1]*ie*ne,P+=v[Pe]*ie*ne,L+=v[Pe+3]*ie*ne,X+=ne*ie,Pe+=4;for(Z=J+1;Z<oe;++Z){let Je=Z*u*4+4*(ke+1);for(te=ke+1;te<F;++te)z+=v[Je+2]*ne,$+=v[Je+1]*ne,P+=v[Je]*ne,L+=v[Je+3]*ne,X+=ne,Je+=4}let De=J*u*4+4*ke;z+=v[De+2]*(W*ee)*ne,$+=v[De+1]*(W*ee)*ne,P+=v[De]*(W*ee)*ne,L+=v[De+3]*(W*ee)*ne,X+=ne*(W*ee),De=J*u*4+4*F,z+=v[De+2]*(W*V)*ne,$+=v[De+1]*(W*V)*ne,P+=v[De]*(W*V)*ne,L+=v[De+3]*(W*V)*ne,X+=ne*(W*V),De=oe*u*4+4*ke,z+=v[De+2]*(ie*ee)*ne,$+=v[De+1]*(ie*ee)*ne,P+=v[De]*(ie*ee)*ne,L+=v[De+3]*(ie*ee)*ne,X+=ne*(ie*ee),De=oe*u*4+4*F,z+=v[De+2]*(ie*V)*ne,$+=v[De+1]*(ie*V)*ne,P+=v[De]*(ie*V)*ne,L+=v[De+3]*(ie*V)*ne,X+=ne*(ie*V);let tt=L/X,Ze=0,et=0,Qe=0;0!==tt&&(Ze=z/X,et=$/X,Qe=P/X),Ze+=.5,et+=.5,Qe+=.5,tt+=.5,S[le]=Math.floor(Qe),le+=1,S[le]=Math.floor(et),le+=1,S[le]=Math.floor(Ze),le+=1,S[le]=Math.floor(tt),le+=1}}const I={index:l,target:S,taskUid:p.data.taskUid,callbackId:p.data.callbackId};try{postMessage(I,[S.buffer])}catch(k){postMessage(I,null)}S=null}}class gAe{constructor(){}reset(){}perspectivePreview(l,u,f,g){var m=arguments;return Fe(function*(){var v,_,b;let S=m.length>4&&void 0!==m[4]?m[4]:{};const I=new Ng,k=yield I.initImage({source:l,isRGBA:u===Tr.RGBA,width:g.width,height:g.height,isBGRA:u===Tr.BGRA});k.srcBuffer&&(l=k.srcBuffer);let O=g.width,j=g.height;const W=null!==(v=g.angle)&&void 0!==v?v:0;90!==W&&270!==W||(O=g.height,j=g.width);const J=Math.min((null!==(_=S.width)&&void 0!==_?_:O)/O,(null!==(b=S.height)&&void 0!==b?b:j)/j),K=Math.floor(O*J+.5),Q=Math.floor(j*J+.5);yield I.resize(K,Q,S.mode),null!=g&&g.angle&&(yield I.rotate({angle:g.angle}));const ie=[[Math.floor(f[0][0]*J+.5),Math.floor(f[0][1]*J+.5)],[Math.floor(f[1][0]*J+.5),Math.floor(f[1][1]*J+.5)],[Math.floor(f[2][0]*J+.5),Math.floor(f[2][1]*J+.5)],[Math.floor(f[3][0]*J+.5),Math.floor(f[3][1]*J+.5)]];yield I.drawQuadrangle({location:ie,strokeColor:S.strokeColor,lineWidth:S.lineWidth});const oe=yield I.getImage({ifDeleteObject:!0,isRGBA:u===Tr.RGBA,returnBlob:!1});yield I.freeReservedData();const le={data:new Blob([oe.imageData],{type:oe.blobType}),width:oe.imageWidth,height:oe.imageHeight,resolutionX:oe.imageXResolution,resolutionY:oe.imageYResolution};return I.terminate(),le})()}resize(l,u,f,g,m){var v=arguments;return Fe(function*(){let _=v.length>5&&void 0!==v[5]?v[5]:{};const b=new Ng,S=yield b.initImage({source:l,isRGBA:u===Tr.RGBA,width:f,height:g,isBGRA:u===Tr.BGRA});if(S.srcBuffer&&(l=S.srcBuffer),m>0){let O=1;O=f>g?f/m:g/m;const j=Math.floor(f/O+.5),W=Math.floor(g/O+.5);yield b.resize(j,W,_.mode)}const I=yield b.getImage({ifDeleteObject:!0,isRGBA:u===Tr.RGBA,returnBlob:!1});yield b.freeReservedData();const k={data:new Blob([I.imageData],{type:I.blobType}),width:I.imageWidth,height:I.imageHeight,resolutionX:I.imageXResolution,resolutionY:I.imageYResolution};return b.terminate(),k})()}}class Gn{constructor(l){}}class M5 extends Gn{static create(l,u){return new M5(l,u)}constructor(l,u){super("cameraChanged"),N(this,"oldDeviceId",void 0),N(this,"newDeviceId",void 0),this.oldDeviceId=l,this.newDeviceId=u}}class O5 extends Gn{static create(l){return new O5(l)}constructor(l){super("captured"),N(this,"pageUid",void 0),this.pageUid=l}}class F5 extends Gn{static create(l){return new F5(l)}constructor(l){super("cropRectDeleted"),N(this,"rect",void 0),this.rect=l}}class L5 extends Gn{static create(l){return new L5(l)}constructor(l){super("cropRectDrawn"),N(this,"rect",void 0),this.rect=l}}class N5 extends Gn{static create(l,u){return new N5(l,u)}constructor(l,u){super("cropRectModified"),N(this,"oldRect",void 0),N(this,"newRect",void 0),this.oldRect=l,this.newRect=u}}class B5 extends Gn{static create(l,u){return new B5(l,u)}constructor(l,u){super("currentIndexChanged"),N(this,"oldIndex",void 0),N(this,"newIndex",void 0),this.oldIndex=l,this.newIndex=u}}class W5 extends Gn{static create(l,u){return new W5(l,u)}constructor(l,u){super("displayModeChanged"),N(this,"oldDisplayMode",void 0),N(this,"newDisplayMode",void 0),this.oldDisplayMode=l,this.newDisplayMode=u}}class D2 extends Gn{static create(l,u){return new D2(l,u)}constructor(l,u){super("document"),N(this,"docUid",void 0),N(this,"docName",void 0),this.docUid=l,this.docName=u}}class W_ extends Gn{static create(l,u){return new W_(l,u)}constructor(l,u){super("fitModeChanged"),N(this,"oldFitMode",void 0),N(this,"newFitMode",void 0),this.oldFitMode=l,this.newFitMode=u}}class U5 extends Gn{static create(l,u){return new U5(l,u)}constructor(l,u){super("pagesDragged"),N(this,"indices",void 0),N(this,"pageUids",void 0),this.indices=l,this.pageUids=u}}class V5 extends Gn{static create(l,u,f){return new V5(l,u,f)}constructor(l,u,f){super("pagesDropped"),N(this,"indicesBefore",void 0),N(this,"indicesAfter",void 0),N(this,"pageUids",void 0),this.indicesBefore=l,this.indicesAfter=u,this.pageUids=f}}class j5 extends Gn{static create(l,u){return new j5(l,u)}constructor(l,u){super("pageRendered"),N(this,"index",void 0),N(this,"pageUid",void 0),this.index=l,this.pageUid=u}}class U_ extends Gn{static create(l,u,f){return new U_(l,u,f)}constructor(l,u,f){super("pagesAdded"),N(this,"docUid",void 0),N(this,"indices",void 0),N(this,"pageUids",void 0),this.docUid=l,this.indices=u,this.pageUids=f}}class A2 extends Gn{static create(l,u,f){return new A2(l,u,f)}constructor(l,u,f){super("pagesDeleted"),N(this,"docUid",void 0),N(this,"pageUids",void 0),N(this,"indices",void 0),this.docUid=l,this.pageUids=u,this.indices=f}}class H5 extends Gn{static create(l,u){return new H5(l,u)}constructor(l,u){super("played"),N(this,"deviceId",void 0),N(this,"resolution",void 0),this.deviceId=l,this.resolution=u}}class P2 extends Gn{static create(l,u){return new P2(l,u)}constructor(l,u){super("quadModified"),N(this,"oldQuad",void 0),N(this,"newQuad",void 0),this.oldQuad=l,this.newQuad=u}}class G5 extends Gn{static create(l,u,f,g){return new G5(l,u,f,g)}constructor(l,u,f,g){super("resized"),N(this,"oldWidth",void 0),N(this,"oldHeight",void 0),N(this,"newWidth",void 0),N(this,"newHeight",void 0),this.oldWidth=l,this.oldHeight=u,this.newWidth=f,this.newHeight=g}}class z5 extends Gn{static create(l,u,f,g){return new z5(l,u,f,g)}constructor(l,u,f,g){super("selectedPagesChanged"),N(this,"oldIndices",void 0),N(this,"newIndices",void 0),N(this,"oldPageUids",void 0),N(this,"newPageUids",void 0),this.oldIndices=l,this.newIndices=u,this.oldPageUids=f,this.newPageUids=g}}class Y5 extends Gn{static create(l){return new Y5(l)}constructor(l){super("stopped"),N(this,"deviceId",void 0),this.deviceId=l}}class X5 extends Gn{static create(l,u){return new X5(l,u)}constructor(l,u){super("toolModeChanged"),N(this,"oldToolMode",void 0),N(this,"newToolMode",void 0),this.oldToolMode=l,this.newToolMode=u}}class R2 extends Gn{static create(l,u,f,g,m,v,_){return new R2(l,u,f,g,m,v,_)}constructor(l,u,f,g,m,v,_){super("vPointer"),N(this,"index",void 0),N(this,"pageUid",void 0),N(this,"imageX",void 0),N(this,"imageY",void 0),N(this,"canvasX",void 0),N(this,"canvasY",void 0),N(this,"nativeEvent",void 0),this.index=l,this.pageUid=u,this.imageX=f,this.imageY=g,this.canvasX=m,this.canvasY=v,this.nativeEvent=_}}class $5 extends Gn{static create(l,u){return new $5(l,u)}constructor(l,u){super("zoomChanged"),N(this,"oldZoomRatio",void 0),N(this,"newZoomRatio",void 0),this.oldZoomRatio=l,this.newZoomRatio=u}}class q5 extends Gn{static create(l,u){return new q5(l,u)}constructor(l,u){super("currentPageChanged"),N(this,"oldPageUid",void 0),N(this,"newPageUid",void 0),this.oldPageUid=l,this.newPageUid=u}}class K5 extends Gn{static create(l,u){return new K5(l,u)}constructor(l,u){super("selectedAnnotationsChanged"),N(this,"oldAnnotationUids",void 0),N(this,"newAnnotationUids",void 0),this.oldAnnotationUids=l,this.newAnnotationUids=u}}class J5 extends Gn{static create(l,u){return new J5(l,u)}constructor(l,u){super("annotationModeChanged"),N(this,"oldAnnotationMode",void 0),N(this,"newAnnotationMode",void 0),this.oldAnnotationMode=l,this.newAnnotationMode=u}}class Q5 extends Gn{static create(l){return new Q5(l)}constructor(l){super("annotationLayerStateChanged"),N(this,"state",void 0),this.state=l}}class Z5 extends Gn{static create(l,u,f,g){return new Z5(l,u,f,g)}constructor(l,u,f,g){super("addPagesToDoc"),N(this,"docUid",void 0),N(this,"pageUids",void 0),N(this,"indices",void 0),N(this,"index",void 0),this.docUid=l,this.pageUids=u,this.indices=f,this.index=g}}class eF extends Gn{static create(l,u,f){return new eF(l,u,f)}constructor(l,u,f){super("createPage"),N(this,"pageUid",void 0),N(this,"fileUid",void 0),N(this,"fileIndex",void 0),this.pageUid=l,this.fileUid=u,this.fileIndex=f}}class tF extends Gn{static create(l,u,f){return new tF(l,u,f)}constructor(l,u,f){super("movePages"),N(this,"docUid",void 0),N(this,"indices",void 0),N(this,"insertBeforeIndex",void 0),this.docUid=l,this.indices=u,this.insertBeforeIndex=f}}class nF extends Gn{static create(l,u,f){return new nF(l,u,f)}constructor(l,u,f){super("renameDocument"),N(this,"docUid",void 0),N(this,"oldName",void 0),N(this,"newName",void 0),this.docUid=l,this.oldName=u,this.newName=f}}class iF extends Gn{static create(l,u){return new iF(l,u)}constructor(l,u){super("reorderPages"),N(this,"docUid",void 0),N(this,"indices",void 0),this.docUid=l,this.indices=u}}class rF extends Gn{static create(l,u,f){return new rF(l,u,f)}constructor(l,u,f){super("switchPage"),N(this,"docUid",void 0),N(this,"one",void 0),N(this,"another",void 0),this.docUid=l,this.one=u,this.another=f}}class oF extends Gn{static create(l,u,f){return new oF(l,u,f)}constructor(l,u,f){super("updatePage"),N(this,"docUid",void 0),N(this,"pageUid",void 0),N(this,"data",void 0),this.docUid=l,this.pageUid=u,this.data=f}}class sF extends Gn{static create(l){return new sF(l)}constructor(l){super("autoCaptureChanged"),N(this,"enableAutoCapture",void 0),this.enableAutoCapture=l}}class aF extends Gn{static create(l){return new aF(l)}constructor(l){super("autoDetectChanged"),N(this,"enableAutoDetect",void 0),this.enableAutoDetect=l}}class lF extends Gn{static create(l){return new lF(l)}constructor(l){super("torchChanged"),N(this,"torchState",void 0),this.torchState=l}}class cF extends Gn{static create(l){return new cF(l)}constructor(l){super("cameraPlayed"),N(this,"resolution",void 0),this.resolution=l}}class uw extends Gn{static create(l,u){return new uw(l,u)}constructor(l,u){super("paginationChanged"),N(this,"current",void 0),N(this,"total",void 0),this.current=l,this.total=u}}class uF extends Gn{static create(l,u){return new uF(l,u)}constructor(l,u){super("visibleChanged"),N(this,"newVisibility",void 0),N(this,"oldVisibility",void 0),this.newVisibility=l,this.oldVisibility=u}}class dF extends Gn{static create(l,u,f){return new dF(l,u,f)}constructor(l,u,f){super("openDocument"),N(this,"doc",void 0),N(this,"viewerUid",void 0),N(this,"groupUid",void 0),this.doc=l,this.viewerUid=u,this.groupUid=f}}class hF extends Gn{static create(l,u,f){return new hF(l,u,f)}constructor(l,u,f){super("closeDocument"),N(this,"doc",void 0),N(this,"viewerUid",void 0),N(this,"groupUid",void 0),this.doc=l,this.viewerUid=u,this.groupUid=f}}class fF extends Gn{static create(l,u,f,g){return new fF(l,u,f,g)}constructor(l,u,f,g){super("gotoPage"),N(this,"docUid",void 0),N(this,"groupUid",void 0),N(this,"viewerUid",void 0),N(this,"index",void 0),this.docUid=l,this.groupUid=u,this.viewerUid=f,this.index=g}}class k2 extends Gn{static create(l){return new k2(l)}constructor(l){super("cameraInit"),N(this,"enableConvert",void 0),this.enableConvert=l}}class pF extends Gn{static create(l,u,f,g){return new pF(l,u,f,g)}constructor(l,u,f,g){super("selectPages"),N(this,"docUid",void 0),N(this,"groupUid",void 0),N(this,"viewerUid",void 0),N(this,"indices",void 0),this.docUid=l,this.groupUid=u,this.viewerUid=f,this.indices=g}}class M2 extends Gn{static create(l,u,f){return new M2(l,u,f)}constructor(l,u,f){super("filterChanged"),N(this,"docUid",void 0),N(this,"pageUids",void 0),N(this,"filterType",void 0),this.docUid=l,this.pageUids=u,this.filterType=f}}class O2 extends Gn{static create(l,u,f,g){return new O2(l,u,f,g)}constructor(l,u,f,g){super("currentChangedByScroll"),N(this,"docUid",void 0),N(this,"groupUid",void 0),N(this,"viewerUid",void 0),N(this,"current",void 0),this.docUid=l,this.groupUid=u,this.viewerUid=f,this.current=g}}class F2 extends Gn{static create(l,u,f){return new F2(l,u,f)}constructor(l,u,f){super("rotatePages"),N(this,"docUid",void 0),N(this,"angle",void 0),N(this,"pageUids",void 0),this.docUid=l,this.angle=u,this.pageUids=f}}class L2 extends Gn{static create(l,u,f){return new L2(l,u,f)}constructor(l,u,f){super("cropPages"),N(this,"docUid",void 0),N(this,"rect",void 0),N(this,"pageUids",void 0),this.docUid=l,this.rect=u,this.pageUids=f}}class V_ extends Gn{static create(l,u){return new V_(l,u)}constructor(l,u){super("perspectiveQuadChanged"),N(this,"quad",void 0),N(this,"isFull",void 0),this.quad=l,this.isFull=u}}class dw extends Gn{static create(l){return new dw(l)}constructor(l){super("deletePages"),N(this,"pageUids",void 0),this.pageUids=l}}class gF extends Gn{static create(l,u,f){return new gF(l,u,f)}constructor(l,u,f){super("operationsChanged"),N(this,"docUid",void 0),N(this,"undo",void 0),N(this,"redo",void 0),this.docUid=l,this.undo=u,this.redo=f}}class mF extends Gn{static create(l,u,f,g,m){return new mF(l,u,f,g,m)}constructor(l,u,f,g,m){super("perspective"),N(this,"docUid",void 0),N(this,"pageUid",void 0),N(this,"quad",void 0),N(this,"width",void 0),N(this,"height",void 0),this.docUid=l,this.pageUid=u,this.quad=f,this.width=g,this.height=m}}class vF extends Gn{static create(l){return new vF(l)}constructor(l){super("pageExistenceChanged"),N(this,"pageCount",void 0),this.pageCount=l}}class yF extends Gn{static create(l){return new yF(l)}constructor(l){super("deleteDocs"),N(this,"docUids",void 0),this.docUids=l}}class N2 extends Gn{static create(l,u,f,g){return new N2(l,u,f,g)}constructor(l,u,f,g){super("pagePreloadChanged"),N(this,"docUid",void 0),N(this,"viewerUid",void 0),N(this,"viewerMode",void 0),N(this,"changes",void 0),this.docUid=l,this.viewerUid=u,this.viewerMode=f,this.changes=g}}class _F extends Gn{static create(l){return new _F(l)}constructor(l){super("viewerCreated"),N(this,"viewer",void 0),this.viewer=l}}class CF extends Gn{static create(l,u){return new CF(l,u)}constructor(l,u){super("annotationsUpdated"),N(this,"uids",void 0),N(this,"actions",void 0),this.uids=l,this.actions=u}}class bF extends Gn{static create(l,u,f,g){return new bF(l,u,f,g)}constructor(l,u,f,g){super("copyPage"),N(this,"pageUid",void 0),N(this,"fileUid",void 0),N(this,"fileIndex",void 0),N(this,"annotations",void 0),this.pageUid=l,this.fileUid=u,this.fileIndex=f,this.annotations=g}}let LZ=0;const NZ=()=>{const p=`doc-${Date.now().toString()}-${LZ.toString()}`;return LZ+=1,p};function ac(p){if(p||(p=`D:${VJ("yyyyMMddhhmmss")}`),/[+-]\d{2}'\d{2}'$/.test(p))return p;const l=-(new Date).getTimezoneOffset();return`${p}${l>=0?"+":"-"}${String(Math.floor(Math.abs(l)/60)).padStart(2,"0")}'${String(Math.abs(l)%60).padStart(2,"0")}'`}class mAe{constructor(){var l,u;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N(this,"type",void 0),N(this,"uid",void 0),N(this,"name",void 0),N(this,"pages",void 0),N(this,"tags",void 0),N(this,"creationDate",void 0),N(this,"author",void 0),N(this,"isDestroyed",void 0),N(this,"pageSize",void 0),this.uid=Ai(),this.name=null!==(l=f.name)&&void 0!==l?l:NZ(),this.type=f.type||"document",this.pages=[],this.tags=f.tags||[],this.creationDate=ac(f.creationDate),this.author=null!==(u=f.author)&&void 0!==u?u:"",this.pageSize="none"}dispose(){this.isDestroyed=!0}}class vAe{constructor(){N(this,"users",void 0),this.users=[]}addUser(l){this.users.push(l)}deleteUser(l){const u=this.users.indexOf(l);u>-1&&this.users.splice(u,1)}}var BZ;!function(p){p.IMAGE_PNG="image/png",p.IMAGE_JPEG="image/jpeg",p.IMAGE_BMP="image/bmp",p.IMAGE_TIFF="image/tiff",p.IMAGE_JP2="image/jp2",p.APPLICATION_PDF="application/pdf"}(BZ||(BZ={}));class yAe{constructor(l){let{uid:u,mime:f,pageCount:g}=l;N(this,"uid",void 0),N(this,"mime",void 0),N(this,"pageCount",void 0),N(this,"name",void 0),N(this,"count",void 0),N(this,"pages",void 0),this.uid=u,this.mime=f,this.count=0,this.pages=[],this.pageCount=g;for(let m=0;m<g;m++){const v=new vAe;this.pages.push(v)}}getPageByIndex(l){return this.pages[l]}addUser(l,u){const f=this.pages[l];return!!f&&(f.addUser(u),this.count+=1,!0)}deleteUser(l,u){const f=this.pages[l];return!!f&&(f.deleteUser(u),this.count-=1,!0)}}function WZ(p,l,u,f){if(0==(l=(l%360+360)%360))return p;const g=l/90;for(let m=0;m<4;m++){const v=p[2*m],_=p[2*m+1];1===g?(p[2*m]=_,p[2*m+1]=f-v):2===g?(p[2*m]=u-v,p[2*m+1]=f-_):3===g&&(p[2*m]=u-_,p[2*m+1]=v)}return UZ(p,8-2*g),p}function xF(p,l,u,f){if(0==(l=(l%360+360)%360))return p;const g=l/90;for(let m=0;m<4;m++){const v=p[2*m],_=p[2*m+1];1===g?(p[2*m]=f-_,p[2*m+1]=v):2===g?(p[2*m]=u-v,p[2*m+1]=f-_):3===g&&(p[2*m]=_,p[2*m+1]=u-v)}return UZ(p,2*g),p}function wF(p,l,u){for(;l<u;){const f=p[l];p[l]=p[u],p[u]=f,l+=1,u-=1}}function UZ(p,l){const u=l%p.length;0!==u&&(wF(p,0,p.length-1),wF(p,0,u-1),wF(p,u,p.length-1))}const B2=p=>Array(4).fill(0).map((l,u)=>[p[2*u],p[2*u+1]]),VZ=(p,l,u)=>0===p[0][0]&&0===p[0][1]&&p[1][0]===l&&0===p[1][1]&&p[2][0]===l&&p[2][1]===u&&0===p[3][0]&&p[3][1]===u;class $h{constructor(l){N(this,"data",void 0),N(this,"width",void 0),N(this,"height",void 0),N(this,"url",void 0),N(this,"img",void 0),N(this,"users",void 0),N(this,"isDestroyed",void 0),N(this,"isAvailable",void 0),N(this,"pageWidth",void 0),N(this,"pageHeight",void 0),N(this,"docPage",void 0),this.isDestroyed=!1,this.users=[],this.isAvailable=!1,this.docPage=l}getImageDetail(){const{docPage:l}=this;return{data:this.data,width:this.width,height:this.height,pageWidth:this.pageWidth,pageHeight:this.pageHeight,resolutionX:l.resolutionX,resolutionY:l.resolutionY,url:this.url,img:this.img}}getPageSize(){return{width:this.pageWidth,height:this.pageHeight}}updateImageDetail(l){if(!l)return;l.data&&(this.isAvailable=!0,this.data=l.data);const{docPage:u}=this;this.width=l.width,this.height=l.height,this.pageWidth=l.width/u.resolutionX*Vn.displayResolution,this.pageHeight=l.height/u.resolutionY*Vn.displayResolution}addUser(l){this.getUserIndex(l)<0&&this.users.push(l)}deleteUser(l){const u=this.getUserIndex(l);u>-1&&this.users.splice(u,1)}hasUser(){return!!this.users.length}reset(){this.resetBlob(),this.resetImg()}resetBlob(){this.isAvailable=!1,this.data=null,this.url&&URL.revokeObjectURL(this.url),this.url=null}resetImg(){this.img&&(this.img.src&&URL.revokeObjectURL(this.img.src),this.img.src=""),this.img=null}getUserIndex(l){return this.users.findIndex(u=>{let{viewerUid:f,docUid:g,pageUid:m}=u;return f===l.viewerUid&&g===l.docUid&&m===l.pageUid})}dispose(){this.isDestroyed=!0,this.isAvailable=!1,this.reset()}}function jZ(p){const l=function(m){[...m].sort((j,W)=>W[1]-j[1]);let _=Number.MAX_SAFE_INTEGER,b=0;m.forEach((j,W)=>{j[1]<_&&([,_]=j,b=W)});const S=(b+3)%4,I=(b+1)%4,k=HZ(m[S],m[b]);return HZ(m[I],m[b])>k?S:b}(p),u=p.map((m,v)=>{let _=p[v+1];return 3===v&&([_]=p),GZ(_,m)});let f=Math.max(u[l],u[(l+2)%4]),g=Math.max(u[(l+1)%4],u[(l+3)%4]);return f=Math.round(f),g=Math.round(g),{width:f,height:g}}function HZ(p,l){const u=Math.abs(p[0]-l[0]),f=GZ(p,l);return Math.acos(u/f)}function GZ(p,l){return((p[0]-l[0])**2+(p[1]-l[1])**2)**.5}const Xg=p=>{!p||p.forEach(l=>{const u=Math.ceil(l[0]);l[0]=u-l[0]<=1e-7?u:Math.floor(l[0]);const f=Math.ceil(l[1]);l[1]=f-l[1]<=1e-7?f:Math.floor(l[1])})};function hw(p,l,u,f){l=(l%360+360)%360;const g=qe({},p),{left:m,top:v,width:_,height:b}=p,S=Math.floor(l/90);return 1===S?(g.left=f-v-b,g.top=m):2===S?(g.left=u-m-_,g.top=f-v-b):3===S&&(g.left=v,g.top=u-m-_),S%2>0&&(g.width=b,g.height=_),g}class W2{constructor(l,u){let{fileIndex:f,pageUid:g,fileUid:m,rotation:v,filter:_,perspectiveQuad:b,annotations:S,pdfOptions:I,resource:k,cropBox:O,mediaBox:j,pageSize:W}=l;N(this,"uid",void 0),N(this,"doc",void 0),N(this,"metadata",void 0),N(this,"customData",void 0),N(this,"fileUid",void 0),N(this,"fileIndex",void 0),N(this,"resolutionX",void 0),N(this,"resolutionY",void 0),N(this,"filter",void 0),N(this,"rotation",void 0),N(this,"quad",void 0),N(this,"activeQuad",void 0),N(this,"isFull",void 0),N(this,"raw",void 0),N(this,"original",void 0),N(this,"display",void 0),N(this,"thumbnail",void 0),N(this,"editedDisplay",void 0),N(this,"initRotation",void 0),N(this,"editRotation",void 0),N(this,"actionRotation",void 0),N(this,"actions",void 0),N(this,"pActions",void 0),N(this,"actionResult",void 0),N(this,"pActionResult",void 0),N(this,"isDestroyed",void 0),N(this,"annotations",void 0),N(this,"pageSize",void 0),N(this,"cropBox",void 0),N(this,"mediaBox",void 0),N(this,"resource",void 0),N(this,"editCaches",void 0),N(this,"pdfOptions",void 0),N(this,"initState",void 0),this.uid=g,this.doc=u,this.annotations=S||[],this.resolutionX=k.resolutionX,this.resolutionY=k.resolutionY,this.fileIndex=f,this.fileUid=m,this.pageSize=null!=W?W:"none",this.resource=k,"none"===this.pageSize&&(this.mediaBox=qe({},j),this.cropBox=qe({},O)),this.filter=_,this.rotation=v||0,this.initRotation=v||0,this.editRotation=v||0,this.actionRotation=0,this.isFull=!0,this.pdfOptions=I,this.raw=new $h(this),this.original=new $h(this),this.display=new $h(this),this.thumbnail=new $h(this),this.editedDisplay=new $h(this);let J={width:k.width,height:k.height};if(this.raw.updateImageDetail(J),this.initState={mediaBox:this.mediaBox,cropBox:this.cropBox,rotation:v},b){J=jZ(b),this.mediaBox={left:0,top:0,width:Kn(J.width,k.resolutionX,Vn.displayResolution),height:Kn(J.height,k.resolutionY,Vn.displayResolution)},this.cropBox=qe({},this.mediaBox);const K=this.quadToDisplayPPI(b);this.setQuad(K)}this.original.updateImageDetail(J),this.display.updateImageDetail(J),this.actions=[],this.pActions=[],this.actionResult=new Map,this.pActionResult=new Map}isMediaBoxEqualCropBox(){const{mediaBox:l,cropBox:u}=this;return l.left===u.left&&l.top===u.top&&l.width===u.width&&l.height===u.height}getPageSize(){return"inherit"===this.pageSize?this.doc.pageSize:this.pageSize}copy(l,u){const f=new W2({pageSize:this.getPageSize(),fileIndex:this.fileIndex,pageUid:l,fileUid:this.fileUid,rotation:this.rotation,filter:this.filter,pdfOptions:this.pdfOptions&&hn(this.pdfOptions),mediaBox:hn(this.mediaBox),cropBox:hn(this.cropBox),resource:hn(this.resource),annotations:[]},u),g=hn(this.actions);g.forEach(_=>{_.docUid=u.uid});const m=hn(this.pActions);m.forEach(_=>{_.docUid=u.uid}),f.actions=g,f.pActions=m,f.initRotation=this.initRotation,f.actionRotation=this.actionRotation,f.editRotation=this.editRotation,f.quad=hn(this.quad),f.activeQuad=hn(this.activeQuad),f.isFull=this.isFull,f.actionResult=new Map(this.actionResult),f.pActionResult=new Map(this.pActionResult);const v={width:this.mediaBox.width||this.display.width||f.raw.width,height:this.mediaBox.height||this.display.height||f.raw.height};return f.original.updateImageDetail(v),f.display.updateImageDetail(v),f}setQuad(l){const u=this.isQuadFull(l);let f=!1;if(this.isFull=u,u)this.quad&&(f=!0,this.editRotation=this.rotation),this.quad=null,this.activeQuad=null;else{const{width:g,height:m}=this.raw.getPageSize(),v=WZ(l.flat(),this.rotation,g,m),_=B2(v);let b,S;this.quad&&(S=this.quadToPixelPPI(_),b=this.quadToPixelPPI(this.quad),Xg(b),Xg(S)),this.quad&&MO(b,S)||(this.quad=_,this.activeQuad=_,f=!0),this.editRotation=this.actionRotation}return f&&this.clearActions(),f}setActiveQuad(l){const{width:u,height:f}=this.raw.getPageSize();if(!this.isFull){const g=WZ(l.flat(),this.rotation,u,f),m=B2(g);this.activeQuad=m}}getQuadVertices(){let l;const{width:u,height:f}=this.raw.getPageSize();return l=this.isFull?[0,0,u,0,u,f,0,f]:this.activeQuad.flat(),l=xF(l,this.rotation,u,f),l}getProcessedQuad(){if(this.quad){let{width:l,height:u}=this.raw.getPageSize(),{quad:f}=this;f=this.quad.map(m=>[this.toPixelPPI(m[0],!1),this.toPixelPPI(m[1],!0)]),l=this.toPixelPPI(l,!1),u=this.toPixelPPI(u,!0);const g=xF(f.flat(),this.initRotation,l,u);return B2(g)}return null}toggleFull(){let l=!1;return this.isFull&&this.activeQuad?(this.isFull=!1,l=!0):this.isFull||(this.isFull=!0,l=!0),l}isQuadFull(l){let{width:u,height:f}=this.raw.getPageSize();const g=Math.abs((this.rotation%360+360)%360);if(90===g||270===g){const m=u;u=f,f=m}return VZ(l,u,f)}getEditResultForPixel(){const l=this.getEditResult();return{rWidth:this.toPixelPPI(l.rWidth,!1),rHeight:this.toPixelPPI(l.rHeight,!0),cropLeft:this.toPixelPPI(l.cropLeft,!1),cropTop:this.toPixelPPI(l.cropTop,!0),cropWidth:this.toPixelPPI(l.cropWidth,!1),cropHeight:this.toPixelPPI(l.cropHeight,!0),rotation:l.rotation}}getEditResult(){if(!this.actions.length){const m=hw(this.cropBox,this.rotation,this.mediaBox.width,this.mediaBox.height);return{rWidth:m.width,rHeight:m.height,cropLeft:this.cropBox.left,cropTop:this.cropBox.top,cropWidth:this.cropBox.width,cropHeight:this.cropBox.height,rotation:this.rotation,mediaBox:qe({},this.mediaBox),cropBox:qe({},this.cropBox)}}const l=this.actions[this.actions.length-1],{rotatedCropBox:u,cropBox:f,rotation:g}=this.actionResult.get(l.actionUid).to;return{rWidth:u.width,rHeight:u.height,cropLeft:f.left,cropTop:f.top,cropWidth:f.width,cropHeight:f.height,rotation:g,mediaBox:qe({},this.mediaBox),cropBox:qe({},f)}}getEditResultForPerspective(){const l=this.raw.getPageSize(),u={left:0,top:0,width:l.width,height:l.height};if(!this.pActions.length){const _=hw(u,this.rotation,u.width,u.height);return{rWidth:_.width,rHeight:_.height,cropLeft:0,cropTop:0,cropWidth:l.width,cropHeight:l.height,rotation:this.rotation,cropBox:qe({},u),mediaBox:u}}const f=this.pActions[this.pActions.length-1],{rotatedCropBox:g,cropBox:m,rotation:v}=this.pActionResult.get(f.actionUid).to;return{rWidth:g.width,rHeight:g.height,cropLeft:m.left,cropTop:m.top,cropWidth:m.width,cropHeight:m.height,rotation:v,mediaBox:u,cropBox:qe({},m)}}getActions(){return[...this.actions]}getPerspectiveActions(){return this.pActions}addAction(l){let u=null;if(this.actions.length){const f=this.actionResult.get(this.actions[this.actions.length-1].actionUid);u={mediaBox:qe({},f.to.mediaBox),cropBox:qe({},f.to.cropBox),rotation:f.to.rotation,rotatedCropBox:qe({},f.to.rotatedCropBox)}}else u={mediaBox:qe({},this.mediaBox),cropBox:qe({},this.cropBox),rotation:this.rotation,rotatedCropBox:qe({},this.cropBox)};if(this.actions.push(l),!this.actionResult.has(l.actionUid)){const f=function(g,m,v,_){let b=qe({},g);const S=m.left+m.width,I=m.top+m.height;let k=v,O=hw(g,k,S,I);if("rotate"===_.type)k+=_.angle,O=hw(g,k,S,I);else if("crop"===_.type){const j=_.rect;O={left:j.left+O.left,top:j.top+O.top,width:j.width,height:j.height},b=function(W,J,K,Q){J=(J%360+360)%360;const ie=qe({},W),{left:oe,top:le,width:he,height:_e}=W,Ve=Math.floor(J/90);return 1===Ve?(ie.left=le,ie.top=Q-he-oe):2===Ve?(ie.left=K-he-oe,ie.top=Q-_e-le):3===Ve&&(ie.left=K-_e-le,ie.top=oe),Ve%2>0&&(ie.width=_e,ie.height=he),ie}(O,k,S,I)}return{rotatedCropBox:O,cropBox:b,mediaBox:m,rotation:k}}(u.cropBox,this.mediaBox,this.rotation,l);this.actionResult.set(l.actionUid,{from:u,to:f}),this.cropBox=qe({},f.cropBox),this.mediaBox=qe({},f.mediaBox)}if("rotate"===l.type){let f=null;const{width:g,height:m}=this.raw.getPageSize(),v={left:0,top:0,width:g,height:m};if(this.pActions.length){const _=this.pActionResult.get(this.pActions[this.pActions.length-1].actionUid);f={mediaBox:qe({},_.to.mediaBox),cropBox:qe({},_.to.cropBox),rotation:_.to.rotation,rotatedCropBox:qe({},_.to.rotatedCropBox)}}else f={mediaBox:qe({},v),cropBox:qe({},v),rotation:this.rotation,rotatedCropBox:qe({},v)};if(this.pActions.push(l),!this.pActionResult.has(l.actionUid)){const _=function(b,S,I,k){const O=I+k.angle;return{rotatedCropBox:hw(b,O,S.left+S.width,S.top+S.height),cropBox:b,mediaBox:S,rotation:O}}({left:0,top:0,width:g,height:m},{left:0,top:0,width:g,height:m},this.rotation,l);this.pActionResult.set(l.actionUid,{from:f,to:_})}this.rotation+=l.angle}}deleteAction(l){var u,f;if((null===(u=this.actions[this.actions.length-1])||void 0===u?void 0:u.actionUid)===l){this.actions.pop();const g=this.actionResult.get(l);this.cropBox=qe({},g.from.cropBox),this.mediaBox=qe({},g.from.mediaBox),this.rotation=g.from.rotation,this.actionResult.delete(l)}(null===(f=this.pActions[this.pActions.length-1])||void 0===f?void 0:f.actionUid)===l&&(this.pActions.pop(),this.pActionResult.delete(l))}clearActions(){this.actions=[]}toDisplayPPI(l,u){const{resolutionX:f,resolutionY:g}=this;return u?l/g*Vn.displayResolution:l/f*Vn.displayResolution}toPixelPPI(l,u){const{resolutionX:f,resolutionY:g}=this;return u?l*g/Vn.displayResolution:l*f/Vn.displayResolution}quadToDisplayPPI(l){const u=hn(l);for(let f=0;f<4;f++)u[f][0]=this.toDisplayPPI(u[f][0],!1),u[f][1]=this.toDisplayPPI(u[f][1],!0);return u}quadToPixelPPI(l){const u=hn(l);for(let f=0;f<4;f++)u[f][0]=this.toPixelPPI(u[f][0],!1),u[f][1]=this.toPixelPPI(u[f][1],!0);return u}rectToDisplayPPI(l){const u=qe({},l);return u.left=this.toDisplayPPI(l.left,!1),u.top=this.toDisplayPPI(l.top,!0),u.width=this.toDisplayPPI(l.width,!1),u.height=this.toDisplayPPI(l.height,!0),u}rectToPixelPPI(l){const u=qe({},l);return u.left=this.toPixelPPI(l.left,!1),u.top=this.toPixelPPI(l.top,!0),u.width=this.toPixelPPI(l.width,!1),u.height=this.toPixelPPI(l.height,!0),u}dispose(){this.raw.reset(),this.original.reset(),this.display.reset(),this.thumbnail.reset(),this.isDestroyed=!0}getAnnotationUids(){return[...this.annotations]}}class _Ae extends rr{constructor(){super(),N(this,"uid",void 0),N(this,"emitter",void 0),N(this,"repo",void 0),N(this,"onDocumentCreated",Et(this)),N(this,"onDocumentDeleted",Et(this)),N(this,"onDocumentRenamed",Et(this)),N(this,"onPagesAdded",Et(this)),N(this,"onAddPagesToDoc",Et(this)),N(this,"onBeforeDeletePagesFromDoc",Et(this)),N(this,"onDeletePagesFromDoc",Et(this)),N(this,"onBeforeDeleteAllPagesFromDoc",Et(this)),N(this,"onDeleteAllPagesFromDoc",Et(this)),N(this,"onMovePages",Et(this)),N(this,"onSwitchPage",Et(this)),N(this,"onReorderPages",Et(this)),N(this,"onBeforeDeleteDocs",Et(this)),N(this,"onAfterDeleteDocs",Et(this)),N(this,"onOpenDocument",Et(this)),N(this,"onCloseDocument",Et(this)),this.emitter=new Bh,this.uid=Ai(),this.repo=new Map}dispose(){this.repo.forEach(l=>l.dispose()),this.repo.clear(),super.dispose()}reset(){this.repo.clear()}createDocument(){const l=new mAe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});this.repo.set(l.uid,l);const u=D2.create(l.uid,l.name);return this.onDocumentCreated.emit(u),l}getDocument(l){return this.repo.get(l)}getAllDocuments(){return Array.from(this.repo.values())}renameDocument(l,u){const f=this.repo.get(l);if(!f)return!1;const g=nF.create(l,f.name,u);return f.name=u,this.onDocumentRenamed.emit(g),!0}deleteDocuments(l){return l.forEach(u=>{const f=this.getDocument(u);f.dispose(),this.repo.delete(u);const g=D2.create(u,f.name);this.onDocumentDeleted.emit(g)}),!0}addPagesToDocument(l,u,f){const g=this.repo.get(l);if(!g)return!1;const{length:m}=u,v=[];let _=g.pages.length;Xt(f)?(g.pages.splice(f,0,...u),_=f):g.pages.push(...u);for(let S=0;S<m;S++)v.push(_+S);const b=Z5.create(l,u,v,f);return this.onAddPagesToDoc.emit(b),!0}removePagesFromDocument(l,u){const f=this.getDocument(l);if(!f)return!1;const g=u.map(v=>f.pages.indexOf(v));u.forEach(v=>{XJ(f.pages,v)});const m=A2.create(l,u,g);return this.onBeforeDeletePagesFromDoc.emit(m),this.onDeletePagesFromDoc.emit(m),!0}removeAllPagesFromDocument(l){const u=this.getDocument(l);if(!u)return!1;const f=[...u.pages.keys()],g=[...u.pages];u.pages.length=0;const m=A2.create(l,g,f);return this.onBeforeDeleteAllPagesFromDoc.emit(m),this.onDeleteAllPagesFromDoc.emit(m),!0}movePages(l,u,f){const g=this.repo.get(l);if(!g)return!1;$J(g.pages,u,f);const m=tF.create(l,u,f);return this.onMovePages.emit(m),!0}swapPages(l,u,f){const g=this.repo.get(l);if(!g)return!1;qJ(g.pages,u,f);const m=rF.create(l,u,f);return this.onSwitchPage.emit(m),!0}reorderPages(l,u){const f=this.repo.get(l);if(!f)return!1;KJ(f.pages,u);const g=iF.create(l,u);return this.onReorderPages.emit(g),!0}}class zZ{on(l,u){}emit(l){}}(new zZ).on("debug",function(){});class CAe{constructor(){N(this,"undoStack",void 0),N(this,"redoStack",void 0),this.undoStack=[],this.redoStack=[]}getOperation(){return{undo:this.undoStack.length,redo:this.redoStack.length}}execute(l){return!!l.execute()&&(this.undoStack.push(l),this.redoStack.length>0&&(this.redoStack.forEach(u=>{u.dispose()}),this.redoStack.length=0),!0)}undo(){const l=this.undoStack.pop();return l&&(l.undo(),this.redoStack.push(l)),!!l}redo(){const l=this.redoStack.pop();return l&&(l.execute(),this.undoStack.push(l)),!!l}removeUidsFromCommand(l){this.removeFromStack(this.undoStack,l),this.removeFromStack(this.redoStack,l)}removeFromStack(l,u){l.slice().forEach(f=>{if(!f.isValid){const g=l.indexOf(f);l.splice(g,1),f.dispose()}})}reset(){this.undoStack.forEach(l=>{l.dispose()}),this.redoStack.forEach(l=>{l.dispose()}),this.undoStack=[],this.redoStack=[]}}class bAe extends rr{constructor(){super(),N(this,"invokers",void 0),N(this,"onOperationsChanged",Et(this)),N(this,"onBeforeRefreshCommands",Et(this)),N(this,"onRefreshCommands",Et(this)),this.invokers=new Map}createInvoker(l){if(!this.invokers.has(l)){const u=new CAe;this.invokers.set(l,u)}}deleteInvokers(l){l.forEach(u=>{if(this.invokers.has(u)){const f=this.invokers.get(u);null==f||f.reset(),this.invokers.delete(u)}})}execute(l,u){const f=this.invokers.get(u);null!=f&&f.execute(l)&&this.emitOperationsChanged(u)}undo(l){const u=this.invokers.get(l),f=!(null==u||!u.undo());return f&&this.emitOperationsChanged(l),f}redo(l){const u=this.invokers.get(l),f=!(null==u||!u.redo());return f&&this.emitOperationsChanged(l),f}saveOperations(l){const u=this.invokers.get(l);return!!u&&(u.reset(),this.emitOperationsChanged(l),!0)}getOperationState(l){return this.invokers.get(l).getOperation()}removePageFromCommand(l,u){this.onBeforeRefreshCommands.emit({docUid:l,pageUids:u}),this.invokers.get(l).removeUidsFromCommand(u),this.emitOperationsChanged(l)}emitOperationsChanged(l){const u=this.invokers.get(l);let f=0,g=0;if(u){const v=u.getOperation();f=v.undo,g=v.redo}const m=gF.create(l,f,g);this.onOperationsChanged.emit(m)}dispose(){this.invokers.clear(),super.dispose()}reset(){this.invokers.forEach(l=>{l.reset()}),this.invokers.clear()}}class xAe extends rr{constructor(){super(),N(this,"files",void 0),N(this,"onDeleteFileData",void 0),this.files=new Map,this.onDeleteFileData=Et(this)}dispose(){this.files.clear(),super.dispose()}reset(){this.files.clear()}addFile(l,u,f){const g=new yAe({uid:l,mime:u,pageCount:f});this.files.set(l,g)}getByUid(l){return this.files.get(l)}addUser(l,u,f){const g=this.getByUid(l);return null==g?void 0:g.addUser(u,f)}addUsersByParsedPages(l,u){u.forEach(f=>{this.addUser(l,f.fileIndex,f.pageUid)})}deleteUser(l,u,f){const g=this.getByUid(l);return g&&(g.deleteUser(u,f),g.count||(this.onDeleteFileData.emit(l),this.files.delete(l))),!1}}class wAe extends rr{constructor(l){super(),N(this,"pages",void 0),N(this,"core",void 0),N(this,"onUpdatePage",Et(this)),N(this,"onCreatePage",Et(this)),N(this,"onCopyPage",Et(this)),N(this,"onDeletePages",Et(this)),N(this,"onBeforeDeletePages",Et(this)),N(this,"onAfterDeletePages",Et(this)),N(this,"onBeforeCopyPages",Et(this)),N(this,"onCopyPages",Et(this)),this.core=l,this.pages=new Map}handlePagePreloadChange(l){let{viewerUid:u,viewerMode:f,docUid:g,changes:m}=l;m.forEach(v=>{let{pageUid:_,from:b,to:S}=v;const I=this.getPage(_),k={viewerUid:u,docUid:g,pageUid:_},{autoReleaseBlob:O,autoReleaseImg:j}=Vn;b&&!S?(I.raw.deleteUser(k),I.raw.hasUser()||(this.core.imageLoadService.cancelLoadRawImage(_),this.core.parserService.cancelGetPage(I.fileUid,I.fileIndex),O&&I.raw.resetBlob(),j&&I.raw.resetImg()),f!==qo.DEFAULT&&f!==qo.THUMBNAIL||(I.original.deleteUser(k),I.original.hasUser()||(this.core.imageLoadService.cancelLoadOriginalImage(_),O&&I.original.resetBlob(),j&&I.original.resetImg()),I.display.deleteUser(k),I.display.hasUser()||(this.core.imageLoadService.cancelLoadDisplayImage(_),O&&I.display.resetBlob(),j&&I.display.resetImg())),f===qo.THUMBNAIL&&(I.thumbnail.deleteUser(k),I.thumbnail.hasUser()||(this.core.imageLoadService.cancelLoadThumbnailImage(_),O&&I.thumbnail.resetBlob(),j&&I.thumbnail.resetImg())),I.raw.hasUser()||this.core.parserService.cancelGetPage(I.fileUid,I.fileIndex)):(I.raw.addUser(k),f!==qo.DEFAULT&&f!==qo.THUMBNAIL||(I.original.addUser(k),I.display.addUser(k)),f===qo.THUMBNAIL&&I.thumbnail.addUser(k))})}dispose(){this.pages.clear(),super.dispose()}reset(){this.pages.clear()}getPage(l){return this.pages.get(l)}createPagesByParsedPages(l,u,f,g){l.forEach((m,v)=>{this.createPage(Ht(qe({},m),{fileUid:f,annotations:u[v]}),g)})}createPage(l,u){const f=new W2(l,u);this.pages.set(f.uid,f);const g=eF.create(l.pageUid,l.fileUid,l.fileIndex);return this.onCreatePage.emit(g),f}copyPage(l,u,f){const g=f.copy(l,u);return this.pages.set(g.uid,g),bF.create(l,g.fileUid,g.fileIndex,f.annotations.slice()),g}deletePages(l){const u=dw.create(l);this.onBeforeDeletePages.emit(u),l.forEach(f=>{const g=this.pages.get(f);g&&g.dispose(),this.pages.delete(f)}),this.onDeletePages.emit(u),this.onAfterDeletePages.emit(u)}updatePage(l,u){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const g=this.pages.get(l);if(g){const{doc:m,customData:v}=g;g.dispose();const _=new W2(Ht(qe({},f),{pageUid:l}),m);_.customData=v,this.pages.set(l,_);const b=oF.create(m.uid,l,u);this.onUpdatePage.emit(b)}}getPageCount(){return this.pages.size}}var SF=new WeakSet;class SAe{constructor(l){al(this,SF),N(this,"core",void 0),N(this,"annotationMapper",void 0),this.core=l,this.annotationMapper=new vZ}reset(){}saveToPng(l,u){var f=this;return Fe(function*(){const g=f.core.pageService.getPage(l);if(!g)return Promise.resolve(null);const m=yield f.core.getPageData(l,{display:!0,renderAnnotation:!(null==u||!u.saveAnnotation)});if((null==u||!u.saveAnnotation)&&m.fileData&&"image/png"===m.fileData.type&&!at(SF,f,YZ).call(f,g))return m.fileData;const v=f.core.saverService.getSaver("image/png");try{return yield v.save(m.display.data,{outputType:3})}finally{v.destroy()}})()}saveToJpeg(l,u){var f=this;return Fe(function*(){const g=f.core.pageService.getPage(l);if(!g)return Promise.resolve(null);const m=yield f.core.getPageData(l,{display:!0,renderAnnotation:!(null==u||!u.saveAnnotation)});if((null==u||!u.saveAnnotation)&&m.fileData&&"image/jpeg"===m.fileData.type&&!at(SF,f,YZ).call(f,g))return m.fileData;const v=f.core.saverService.getSaver("image/jpeg");try{return yield v.save(m.display.data,{outputType:1,jpegQuality:null==u?void 0:u.quality})}finally{v.destroy()}})()}saveToTiff(l,u){var f=this;return Fe(function*(){const g=f.core.saverService.getSaver("image/tiff"),m=!(null==u||!u.saveAnnotation);try{yield g.init(u);for(let v=0;v<l.length;v++){const _=l[v];if(!f.core.pageService.getPage(_))break;const b=yield f.core.getPageData(_,{display:!0,renderAnnotation:m});yield g.appendPage(b.display.data)}return yield g.getTiff()}finally{g.destroy()}})()}saveToPdf(l,u){var f=this;return Fe(function*(){null!=u&&u.creationDate&&(u.creationDate=ac(u.creationDate)),null!=u&&u.modifiedDate&&(u.modifiedDate=ac(u.modifiedDate)),!u||"annotation"!==u.saveAnnotation&&"flatten"!==u.saveAnnotation||xi.makeSureAnnotationLicenseExist();const g=f.core.saverService.getSaver("application/pdf");try{yield g.init(u);const I=new Map,k=u&&u.pageType&&u.pageType!==Lo.PAGE_DEFAULT;let O=0;for(let W=0;W<l.length;W++){var m,v;const J=l[W],K=f.core.pageService.getPage(J);if(!K)break;const Q=yield f.core.getPageData(J,{raw:!0,display:!0,renderAnnotation:"image"===(null==u?void 0:u.saveAnnotation)}),ie=yield f.core.imageDataService.getNotRotatedDisplay(J,"image"===(null==u?void 0:u.saveAnnotation)),oe=k||(null===(m=K.pdfOptions)||void 0===m?void 0:m.convertMode)===hl.CM_IMAGEONLY||(null===(v=K.pdfOptions)||void 0===v?void 0:v.renderOptions.renderGrayscale),le=[],he=[];if(Q.fileData&&"application/pdf"===Q.fileData.type&&!oe)for(let _e=W;_e<l.length;_e++){var _,b;const Ve=l[_e],ee=f.core.pageService.getPage(Ve);if(!ee||ee.fileUid!==K.fileUid||!ee.isFull||"image"===(null==u?void 0:u.saveAnnotation)&&ee.annotations.length>0||(null===(_=ee.pdfOptions)||void 0===_?void 0:_.convertMode)===hl.CM_IMAGEONLY||null!==(b=ee.pdfOptions)&&void 0!==b&&b.renderOptions.renderGrayscale)break;let ke=!1;ee.filter&&"none"!==ee.filter&&(ke=!0);const xe=ee.getActions(),Le=ee.getPerspectiveActions();xe.every(F=>"rotate"===F.type||"crop"===F.type)&&Le.every(F=>"rotate"===F.type||"crop"===F.type)||(ke=!0);let V=!1;if(ke&&f.core.getAnnotationsByPageUid(l[W]).forEach(F=>{F.oriIndex>=0&&!F.modified&&(V=!0)}),ke&&!V)break;I.set(O+le.length,{mediaBox:ee.mediaBox,cropBox:ee.cropBox,rotation:ee.rotation}),le.push(ee.fileIndex),V&&he.push({pageUid:Ve,pageIndex:_e})}if(le.length>0){var S;const _e=null===(S=(yield f.core.sourceStore.get(K.fileUid)).loadOptions)||void 0===S?void 0:S.password;yield g.appendRawPdfPages(Q.fileData,_e,le),W+=le.length-1,O+=le.length;for(let Ve=0;Ve<he.length;Ve++){const ee=yield f.core.imageDataService.getNotRotatedDisplay(he[Ve].pageUid,"image"===(null==u?void 0:u.saveAnnotation));yield g.changePageImage(he[Ve].pageIndex,ee.data,{cropBox:K.cropBox,mediaBox:K.mediaBox,rotation:K.rotation,width:ie.width,height:ie.height})}}else yield g.appendImagePage(ie.data,{cropBox:K.cropBox,mediaBox:K.mediaBox,rotation:K.rotation,width:ie.width,height:ie.height}),O+=1}I.size>0&&(yield g.setPageInfo(I));const j=[];for(let W=0;W<l.length;W++)if(!u||"annotation"!==u.saveAnnotation&&"flatten"!==u.saveAnnotation)yield g.removePageAnnotations(W);else{const J=f.core.pageService.getPage(l[W]);if(!J)continue;const K=J.pdfOptions&&J.pdfOptions.convertMode===hl.CM_RENDERALL&&J.pdfOptions.renderOptions.renderAnnotations===Hh.RENDER_ANNOTATIONS,Q=f.core.getAnnotationsByPageUid(l[W]);if(!Q.length){K||(yield g.removePageAnnotations(W));continue}Q.forEach(oe=>{!["textBox","textTypewriter"].includes(oe.type)||!oe.modified&&Xt(null==oe?void 0:oe.oriIndex)||oe.style.textContents.forEach(le=>{j.push({family:le.fontFamily,isBlob:"bold"===le.fontWeight,isItalic:"italic"===le.fontStyle})})});const ie=yield f.annotationMapper.getOriginalAnnotations(Q,{width:J.mediaBox.left+J.mediaBox.width,height:2*J.mediaBox.top+J.mediaBox.height});yield g.setPageAnnotations(W,ie,K),"flatten"===u.saveAnnotation&&(yield g.flattenPage(W))}return j.length&&((yield g.ifFontsExist(j))||it.warning(it.WASM_FONT_LOSS)),yield g.getPdf(VE.RT_BINARY)}finally{g.destroy()}})()}}function YZ(p){return!!(!p.isFull||p.filter&&"none"!==p.filter||p.getActions().some(l=>"rotate"!==l.type))||!!p.getPerspectiveActions().some(l=>"rotate"!==l.type)||0!==p.rotation}const fw=p=>{const l=new Set(p);return Array.from(l.values())};class TAe extends rr{constructor(){super(),N(this,"observer",void 0),N(this,"onResizeObserver",Et(this)),this.observer=new ResizeObserver(l=>{l.forEach(u=>{this.onResizeObserver.emit(u)})})}observe(l){this.observer.observe(l)}unobserve(l){this.observer.unobserve(l)}reset(){this.observer.disconnect()}dispose(){this.observer.disconnect(),this.observer=null,super.dispose()}}class IAe{constructor(){N(this,"canvas",void 0),N(this,"renderer",void 0),N(this,"root",void 0),document.createElement("canvas").getContext("2d",{willReadFrequently:!0}),this.renderer=new XQ,this.canvas=new WQ({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement,(new sZ).init(this.canvas)}render(l,u,f){this.root.children.slice().forEach(g=>{this.root.removeChild(g)}),this.root.appendChild(l),this.canvas.resize(u||l.width,f||l.height),this.canvas.render()}reset(){this.root.children.slice().forEach(l=>{this.root.removeChild(l)}),this.root.sortable.sorted=[]}getCanvas(){return this.canvas.contextService.getDomElement()}}let TF;const XZ="p".charCodeAt(0),$Z="H".charCodeAt(0),qZ="Y".charCodeAt(0),KZ="s".charCodeAt(0);class RAe{constructor(l){N(this,"core",void 0),this.core=l}getRaw(l){var u=arguments,f=this;return Fe(function*(){let g=!(u.length>1&&void 0!==u[1])||u[1];try{const m=f.core.pageService.getPage(l);if(!m||m.isDestroyed)return null;if(m.raw.isAvailable)return m.raw.getImageDetail();const{fileUid:v,fileIndex:_}=m,b=yield f.core.sourceStore.get(v);let S;S=f.core.parserService.getCustomParserClasses(b.fileData.type)?b.fileData.type:yield BE(b.fileData),S||it.throw(it.FILE_NOT_SUPPORT);const I=yield f.core.parserService.getPage(b.fileData,S,v,_);if(!I)return null;let{raw:k}=m;return g||(k=new $h(m)),k.updateImageDetail(I.resource),k.getImageDetail()}catch(m){return it.error(m),null}})()}getOriginal(l){var u=arguments,f=this;return Fe(function*(){let g=!(u.length>1&&void 0!==u[1])||u[1];const m=f.core.pageService.getPage(l);if(!m||m.isDestroyed)return null;const{original:v}=m;if(v.isAvailable)return v.getImageDetail();const _=yield f.getRaw(l);if(!_)return null;const b=yield f.handlePerspectiveQuad(l,_);return g&&b&&m.original.updateImageDetail(b),b})()}handlePerspectiveQuad(l,u){var f=this;return Fe(function*(){const g=f.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;let m=u;const v=g.getProcessedQuad();if(v&&(m=yield f.core.perspectiveService.perspective({data:u.data,type:Tr.JPEG},v,{angle:g.initRotation}),!m))return null;const _=new $h(g);return _.updateImageDetail(m),_.getImageDetail()})()}getDisplay(l){var u=arguments,f=this;return Fe(function*(){let g=!(u.length>1&&void 0!==u[1])||u[1];const m=f.core.pageService.getPage(l);if(!m||m.isDestroyed)return null;if(m.display.isAvailable)return m.display.getImageDetail();const v=yield f.getOriginal(l);if(!v)return null;const{filter:_}=m,b=yield f.handleFilter(l,v);return m.filter!==_?f.getDisplay(l):(g&&b&&m.display.updateImageDetail(b),b)})()}handleFilter(l,u){var f=this;return Fe(function*(){const g=f.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;const m=u,{filter:v}=g;if(v&&"none"!==v){const b=yield f.core.filterService.applyFilter({data:u.data,type:Tr.JPEG,width:u.width,height:u.height},v);if(!b)return null;m.data=b}const _=new $h(g);return _.updateImageDetail(m),_.getImageDetail()})()}getEditedDisplay(l,u){var f=arguments,g=this;return Fe(function*(){let m=f.length>2&&void 0!==f[2]&&f[2];const v=g.core.pageService.getPage(l);if(!v||v.isDestroyed)return null;const _=yield g.getDisplay(l,!1);if(v.getActions().length||0!==v.rotation||!v.isMediaBoxEqualCropBox()||u&&v.annotations.length){const b=yield g.applyEditToDisplay(l,u,m),S=new $h(v);return S.updateImageDetail(b),S.getImageDetail()}return _})()}getNotRotatedDisplay(l,u){var f=this;return Fe(function*(){const g=f.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;const m=yield f.getOriginal(l);if(!m)return null;const v=yield f.handleFilter(l,m);if(u&&g.annotations.length){const _=yield f.applyEditToDisplay(l,u,!1,!1),b=new $h(g);return b.updateImageDetail(_),b.getImageDetail()}return v})()}getThumbnail(l){var u=arguments,f=this;return Fe(function*(){let g=!(u.length>1&&void 0!==u[1])||u[1];const m=f.core.pageService.getPage(l);if(!m||m.isDestroyed)return null;if(m.thumbnail.isAvailable)return m.thumbnail.getImageDetail();const v=yield f.getDisplay(l,!0);if(!v)return null;const _=yield f.displayToThumbnail(v.data);return _?(g&&m.thumbnail.updateImageDetail(_),_):null})()}displayToThumbnail(l){return Fe(function*(){return l})()}applyEditToDisplay(l,u){var f=arguments,g=this;return Fe(function*(){let m=f.length>2&&void 0!==f[2]&&f[2],v=!(f.length>3&&void 0!==f[3])||f[3];const _=yield g.core.imageLoadService.loadDisplayImage(l),b=g.core.pageService.getPage(l),S=yield g.getDisplay(l,!1);let I;if(v)I=b.getEditResultForPixel();else{const[J,K]=Kn([b.initState.mediaBox.width,b.initState.mediaBox.height],Vn.displayResolution,b.resource.resolutionX);I={rWidth:J,rHeight:K,cropLeft:0,cropTop:0,cropWidth:J,cropHeight:K,rotation:0}}const k={width:Math.round(I.rWidth),height:Math.round(I.rHeight),data:null},O=new Ev({style:{x:-I.cropLeft,y:-I.cropTop,img:_,width:S.width,height:S.height}}),j=new ps({style:{x:-(I.cropWidth-I.rWidth)/2,y:-(I.cropHeight-I.rHeight)/2,width:I.cropWidth,height:I.cropHeight}});if(j.appendChild(O),j.setLocalAngle(I.rotation),g.core.annotationService&&b.annotations.length&&u){const J=new ps({style:{x:-I.cropLeft,y:-I.cropTop,width:b.original.pageWidth,height:b.original.pageHeight}});yield g.applyAnnotationToPage(J,l,m),j.appendChild(J)}g.core.commonCanvas.render(j,I.rWidth,I.rHeight),g.core.commonCanvas.reset();const W=g.core.commonCanvas.getCanvas();return new Promise((J,K)=>{W.toBlob(function(){var Q=Fe(function*(ie){ie=yield function PAe(p,l){const u=p.slice(0,33);return new Promise((f,g)=>{const m=new FileReader;m.onload=()=>{const v=new Uint8Array(m.result),_=p.slice(33),b=function(I,k,O,j){if("image/jpeg"===O)return I[13]=1,I[14]=k>>8,I[15]=255&k,I[16]=k>>8,I[17]=255&k,I;if("image/png"===O){const W=new Uint8Array(13);k*=39.3701,W[0]=XZ,W[1]=$Z,W[2]=qZ,W[3]=KZ,W[4]=k>>>24,W[5]=k>>>16,W[6]=k>>>8,W[7]=255&k,[W[8],W[9],W[10],W[11]]=[W[4],W[5],W[6],W[7]],W[12]=1;const J=function EAe(p){let l=-1;TF||(TF=function(){const u=new Int32Array(256);for(let f=0;f<256;f++){let g=f;for(let m=0;m<8;m++)g=1&g?3988292384^g>>>1:g>>>1;u[f]=g}return u}());for(let u=0;u<p.length;u++)l=TF[255&(l^p[u])]^l>>>8;return~l}(W),K=new Uint8Array(4);if(K[0]=J>>>24,K[1]=J>>>16,K[2]=J>>>8,void(K[3]=255&J)){const oe=function(le){for(let he=le.length-1;he>=4;he--)if(9===le[he-4]&&le[he-3]===XZ&&le[he-2]===$Z&&le[he-1]===qZ&&le[he]===KZ)return he-3;return-1}(I);return I.set(W,oe),I.set(K,oe+13),I}const Q=new Uint8Array(4);Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=9;const ie=new Uint8Array(54);return ie.set(I,0),ie.set(Q,33),ie.set(W,37),ie.set(K,50),ie}throw new Error(`The format ${O} is not supported.`)}(v,l,p.type),S=new Blob([b,_],{type:p.type});f(S)},m.onerror=v=>{g(v)},m.readAsArrayBuffer(u)})}(ie,b.resolutionX||Vn.displayResolution),k.data=ie,J(k)});return function(ie){return Q.apply(this,arguments)}}(),"image/jpeg",1)})})()}applyAnnotationToPage(l,u){var f=arguments,g=this;return Fe(function*(){let m=f.length>2&&void 0!==f[2]&&f[2];const v=g.core.pageService.getPage(u),_=[];v.annotations.forEach(b=>{const S=g.core.annotationService.getAnnotationByUid(b);_.push(S)}),_.sort((b,S)=>b.layer-S.layer);for(let b=0;b<_.length;b++){if(m&&!_[b].flags.includes("print"))continue;if("stamp"===_[b].type&&_[b].style.imageData&&(!Xt(_[b].style.width)||!Xt(_[b].style.height))){const I=new Sv,k=yield I.readImageInfo({fileSource:_[b].style.imageData});let O=k.imageWidth,j=k.imageHeight;if(O>400||j>400){const W=Math.max(O/400,j/400);O/=W,j/=W}_[b].style.width=O,_[b].style.height=j}const S=g.core.annotationService.createAnnotationShape(_[b],v);S instanceof Kc&&S.style.imageData&&S.style.img instanceof HTMLImageElement&&(yield new Promise(I=>{S.style.img.onload=()=>{I()}})),S&&l.appendChild(S)}})()}}class kAe{constructor(l){N(this,"name",void 0),this.name=l||"Guest"}getUser(){return this.name}setUser(l){this.name=l}}class U2 extends Gn{static create(l){return new U2(l)}constructor(l){super("setExternalHandler"),N(this,"handlerType",void 0),this.handlerType=l}}class IF{static makeSureSourcesTypeSupported(l,u,f,g){const m=[];if(Di(l))l.forEach((v,_)=>{if(!v||0===v.length){const b=_n("Source[]",u,`[${_}].fileData`,!0);m.push(`${b}: ${it.FILE_NOT_SUPPORT.message}`)}});else if(!l||0===l.length){const v=_n("Source",u,"fileData");m.push(`${v}: ${it.FILE_NOT_SUPPORT.message}`)}m.length>0&&it.throw(Ht(qe({},it.FILE_NOT_SUPPORT),{details:m}),f,g)}}const EF=new Map,DF=[];let Uv=class eU extends rr{constructor(l,u,f,g,m){super(),N(this,"parserService",void 0),N(this,"saverService",void 0),N(this,"perspectiveService",void 0),N(this,"filterService",void 0),N(this,"detectorService",void 0),N(this,"viewerService",void 0),N(this,"editService",void 0),N(this,"annotationService",void 0),N(this,"documentService",void 0),N(this,"trackerService",void 0),N(this,"imageLoadService",void 0),N(this,"optimizationService",void 0),N(this,"processService",void 0),N(this,"commandService",void 0),N(this,"fileSaveService",void 0),N(this,"fileService",void 0),N(this,"pageService",void 0),N(this,"resizeService",void 0),N(this,"imageDataService",void 0),N(this,"userService",void 0),N(this,"sourceStore",void 0),N(this,"commonCanvas",void 0),N(this,"onBeforeLoadSource",void 0),N(this,"onSetExternalHandler",void 0),N(this,"onAfterPerspective",void 0),N(this,"onFilterChanged",void 0),N(this,"onUnload",void 0),this.parserService=l,this.saverService=u,this.perspectiveService=f,this.filterService=g,this.detectorService=m,this.onBeforeLoadSource=Et(this),this.onSetExternalHandler=Et(this),this.onUnload=Et(this),this.onAfterPerspective=Et(this),this.onFilterChanged=Et(this),this.commonCanvas=new IAe,this.sourceStore=new MZ,this.trackerService=new zZ,this.documentService=new _Ae,this.fileService=new xAe,this.pageService=new wAe(this),this.imageLoadService=new uAe(this),this.optimizationService=new class{constructor(){N(this,"actorSystem",void 0),N(this,"concurrency",3);const p=window.URL.createObjectURL(new Blob(["(",fAe.toString(),")()"],{type:"text/plain"}));this.actorSystem=new hAe(p,this.concurrency)}cancel(p){this.actorSystem.cancel(p)}optimize(p,l,u,f,g,m){return new Promise((v,_)=>{const b=p.getContext("2d"),S=Math.floor(l)||1,I=Math.floor(u)||1,k=b.getImageData(0,0,S,I),O={action:"optimize",data:{taskUid:m,sourceWidth:S,sourceHeight:I,width:Math.ceil(f)||1,height:Math.ceil(g)||1,source:k},callback(j){v(j)}};this.actorSystem.send(O,O.data.source)})}},this.processService=new gAe,this.commandService=new bAe,this.fileSaveService=new SAe(this),this.resizeService=new TAe,this.imageDataService=new RAe(this),this.userService=new kAe("Guest"),DF.forEach(v=>{var _;null===(_=v.apply)||void 0===_||_.call(v,this)}),this.initServiceEvent()}initServiceEvent(){const{documentService:l,commandService:u,pageService:f,viewerService:g,fileService:m,parserService:v}=this;l.onDocumentCreated.on(_=>{u.createInvoker(_.docUid)},u),l.onDocumentDeleted.on(_=>{u.deleteInvokers([_.docUid])},u),g.onPagePreloadChanged.on(_=>{f.handlePagePreloadChange(_)},f),m.onDeleteFileData.on(_=>{this.sourceStore.remove(_)}),m.onDeleteFileData.on(_=>{v.freeParserByFileUid(_)},v)}static getClass(l){return EF.get(l)}static setClass(l,u){EF.set(l,u)}static registerPlugin(l){DF.includes(l)||DF.push(l),l.install&&l.install(eU)}getClass(l){return EF.get(l)}createAsyncRepository(){return new MZ}createViewer(l){const u=eU.getClass("Viewer"),f=Ht(qe({},l),{core:this,groupUid:l.groupUid||Ai()}),g=this.viewerService.createViewer(u,f);return g.context.isInitialized=!0,g}removeViewer(l){this.viewerService.removeViewer(l.uid)}getViewer(l){return this.viewerService.getViewer(l)}getViewers(){return this.viewerService.getAllViewers()}getFileParserDefaultOptions(l){return this.parserService.getDefaultParserOptions(l)}setFileParserDefaultOptions(l,u){return this.parserService.setDefaultParserOptions(l,u)}setFileParser(l,u){this.parserService.registerCustomParser(l,u)}getSourceParseOptions(l,u){if("application/pdf"===u){var f;const g=l;return g.convertMode=null!==(f=g.convertMode)&&void 0!==f?f:hl.CM_AUTO,hn(g)}if("width"in l)return hn(l)}loadSource(l,u,f){var g=this;return Fe(function*(){Di(l)||(l=[l]);const m=g.documentService.getDocument(u);if(!m)return[];const v=Xt(f)?{insertBeforeIndex:f}:qe({},f),_="ignore"===v.exception,b=yield g.getSourcesMimeTypes(l);_||IF.makeSureSourcesTypeSupported(b,"sources");const S=function(){var k=Fe(function*(O,j){const W=b[j];_&&IF.makeSureSourcesTypeSupported(W,`sources[${j}]`);const J=[],K=Ai(),Q=g.getSourceParseOptions(O,W),{fileData:ie}=O,{pageCount:oe,batchSize:le}=yield g.parserService.getParseInfo(ie,W,K,Q);g.sourceStore.set(K,{fileData:W===ie.type?ie:ie.slice(0,ie.size,W),loadOptions:Q}),g.fileService.addFile(K,W,oe);const he=g.getBatchIndices(le,oe);for(const Ve of he){var _e;const ee=yield g.parserService.parse(ie,W,K,Ve,Q).catch(Le=>{throw Le});null===(_e=O.extraPageData)||void 0===_e||_e.forEach(Le=>{const V=ee.find(F=>F.fileIndex===Le.index);if(V){const F=qe({},Le);delete F.index,Xt(V.rotation)&&Xt(F.rotation)&&(F.rotation+=V.rotation),pt(F.filter)||(V.filter=F.filter),pt(F.rotation)||(V.rotation=F.rotation),pt(F.perspectiveQuad)||(V.perspectiveQuad=F.perspectiveQuad),pt(F.index)||(V.index=F.index)}});const ke=ee.map(Le=>{var V;const F=Ai();return Le.pageUid=F,null!==(V=Le.filter)&&void 0!==V||(Le.filter=g.filterService.getDefaultFilterType()||"none"),F});g.fileService.addUsersByParsedPages(K,ee);const xe=g.annotationService.createAnnotationsByParsedPages(u,ee);g.pageService.createPagesByParsedPages(ee,xe,K,m),g.documentService.addPagesToDocument(u,ke,v.insertBeforeIndex),pt(v.insertBeforeIndex)||(v.insertBeforeIndex+=ee.length),J.push(...ke)}return J});return function(j,W){return k.apply(this,arguments)}}();g.onBeforeLoadSource.emit({docUid:u});const I=[];for(const[k,O]of l.entries())try{const j=yield S(O,k);I.push(...j)}catch(j){if(!_)throw j;it.warning(j)}return g.documentService.onPagesAdded.emit(U_.create(u,I.map(k=>m.pages.indexOf(k)),I)),I})()}getSourcesMimeTypes(l){var u=this;return Fe(function*(){const f=[];for(const g of l){const m=u.parserService.getCustomParserClasses(g.fileData.type)?g.fileData.type:yield BE(g.fileData);f.push(m)}return f})()}getAnnotationsByPageUid(l){const u=this.pageService.getPage(l);return u?u.annotations.map(f=>this.annotationService.getAnnotationByUid(f)):[]}getBatchIndices(l,u){const f=[];for(let g=0;g<u;){const m=l>0?Math.min(l,u-g):u;f.push(Array.from({length:m},(v,_)=>g+_)),g+=m}return f}getPageData(l,u){var f=this;return Fe(function*(){var g;null!==(g=u)&&void 0!==g||(u={raw:!0,display:!0,thumbnail:!0,renderAnnotation:!1,isGetPrintPageData:!1});const m=f.pageService.getPage(l);if(!m)return null;const v=yield f.sourceStore.get(m.fileUid);let{quad:_}=m;_&&(_=m.quadToPixelPPI(_),Xg(_));const b={uid:m.uid,fileData:"application/ddv-blank-image"!==v.fileData.type?v.fileData:null,fileIndex:m.fileIndex,perspectiveQuad:_,rotation:m.rotation,filter:m.filter,mediaBox:qe({},m.mediaBox),cropBox:qe({},m.cropBox)};if(u.raw){const S=yield f.imageDataService.getRaw(l);b.raw=qe({},S)}if(u.display){const S=yield f.imageDataService.getEditedDisplay(l,u.renderAnnotation,u.isGetPrintPageData);b.display=qe({},S)}if(u.thumbnail){const S=yield f.imageDataService.getEditedDisplay(l,u.renderAnnotation,u.isGetPrintPageData);b.thumbnail=qe({},S)}return b})()}setCustomData(l,u){var f=this;return Fe(function*(){const g=f.pageService.getPage(l);return g?(g.customData=hn(u),!0):Promise.reject()})()}getCustomData(l){var u=this;return Fe(function*(){const f=u.pageService.getPage(l);return f?hn(f.customData):Promise.reject()})()}updatePage(l,u){var f=arguments,g=this;return Fe(function*(){var m,v;let _=f.length>2&&void 0!==f[2]?f[2]:{};const b=g.pageService.getPage(l);if(!b)return!1;const S=Ai(),I=g.parserService.getCustomParserClasses(u.type)?u.type:yield BE(u);IF.makeSureSourcesTypeSupported([I],"data");const k=g.getSourceParseOptions({fileData:u},I),{pageCount:O}=yield g.parserService.getParseInfo(u,I,S,k);if(Xt(_.fileIndex)&&(_.fileIndex>=O||_.fileIndex<0))return it.reject(it.PARAM_OUT_OF_RANGE,"IDocument.updatePage","updatePageOptions.fileIndex");g.sourceStore.set(S,{fileData:u,loadOptions:k}),g.fileService.addFile(S,I,O);const[j]=yield g.parserService.parse(u,I,S,[_.fileIndex||0],k).catch(J=>{throw J});j.pageUid=l,null!==(m=j.filter)&&void 0!==m||(j.filter=g.filterService.getDefaultFilterType()||"none");const W=g.annotationService.createAnnotationsByParsedPages(b.doc.uid,[j]);return g.commandService.removePageFromCommand(b.doc.uid,[l]),g.fileService.addUser(S,_.fileIndex,l),g.fileService.deleteUser(b.fileUid,b.fileIndex,l),null===(v=g.annotationService)||void 0===v||v.deleteAnnotations(b.annotations,!1),g.pageService.updatePage(l,u,Ht(qe(qe({},j),_),{fileUid:S,annotations:W[0]})),!0})()}getPerspectivePreviewData(l,u,f){var g=this;return Fe(function*(){const m=g.pageService.getPage(l),v=yield g.imageDataService.getRaw(l);if(!m||!v)return null;let{quad:_}=m;_||(_=[[0,0],[v.width,0],[v.width,v.height],[0,v.height]]);const b=yield g.processService.perspectivePreview(v.data,4,_,{width:v.width,height:v.height},qe(qe({},u),f));return Promise.resolve(b)})()}createDocument(l){return this.documentService.createDocument(l)}getDocument(l){return this.documentService.getDocument(l)}deleteDocuments(l){const{documentService:u,pageService:f}=this;if(l.map(v=>u.getDocument(v)).includes(void 0))return!1;const g=yF.create(l);u.onBeforeDeleteDocs.emit(g),l.forEach(v=>{const _=u.getDocument(v);var b;_&&(_.pages.forEach(S=>{const I=f.getPage(S);this.fileService.deleteUser(I.fileUid,I.fileIndex,S)}),null===(b=this.annotationService)||void 0===b||b.deleteAnnotationPages([..._.pages]),f.deletePages(_.pages))});const m=u.deleteDocuments(l);return u.onAfterDeleteDocs.emit(g),m}renameDocument(l,u){this.documentService.renameDocument(l,u)}transferDocument(l,u){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{documentService:g}=this,m=g.getDocument(l),v=g.getDocument(u);if(!m||!v)return!1;if(l===u&&!f.copy)return!f.sourceIndices||this.movePages(l,f.sourceIndices,f.insertBeforeIndex);let _=[];if(_=null!=f&&f.sourceIndices?fw(f.sourceIndices).map(S=>m.pages[S]):[...m.pages],!_.length)return!0;f.copy?_.forEach((S,I,k)=>{const O=this.pageService.getPage(S),j=Ai();if(this.fileService.addUser(O.fileUid,O.fileIndex,j),this.pageService.copyPage(j,v,O),!1!==(null==f?void 0:f.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(j);const W=O.annotations.map(J=>Ht(qe({},this.annotationService.getAnnotationByUid(J).getConfig()),{docUid:v.uid,pageUid:j,uid:Ai()}));W.length&&this.annotationService.annotationApp.createAnnotations(W)}k[I]=j}):(g.removePagesFromDocument(m.uid,_),_.forEach(S=>{const I=this.pageService.getPage(S);var k;I.doc=v,!1===(null==f?void 0:f.includeAnnotations)&&(null===(k=this.annotationService)||void 0===k||k.deleteAnnotations(I.annotations),I.annotations=[])})),g.addPagesToDocument(v.uid,_,f.insertBeforeIndex);const b=_.map(S=>v.pages.indexOf(S));return g.onPagesAdded.emit(U_.create(v.uid,b,_)),!0}mergeDocuments(l,u){const{documentService:f}=this,g=f.createDocument(u);if(!l.length)return g;l=fw(l);const m=[];if(l.forEach(v=>{const _=f.getDocument(v);m.push(..._.pages)}),null!=u&&u.deleteOriginal?(f.deleteDocuments(l),m.forEach(v=>{const _=this.pageService.getPage(v);var b;_.doc=g,!1===(null==u?void 0:u.includeAnnotations)&&(null===(b=this.annotationService)||void 0===b||b.deleteAnnotations(_.annotations),_.annotations=[])})):m.forEach((v,_,b)=>{const S=this.pageService.getPage(v),I=Ai();if(this.fileService.addUser(S.fileUid,S.fileIndex,I),this.pageService.copyPage(I,g,S),!1!==(null==u?void 0:u.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(I);const k=S.annotations.map(O=>Ht(qe({},this.annotationService.getAnnotationByUid(O).getConfig()),{docUid:g.uid,pageUid:I,uid:Ai()}));k.length&&this.annotationService.annotationApp.createAnnotations(k)}b[_]=I}),m.length){f.addPagesToDocument(g.uid,m);const v=m.map(_=>g.pages.indexOf(_));f.onPagesAdded.emit(U_.create(g.uid,v,m))}return g}openDocument(l,u){return this.openOrCloseDocument(l,u)}closeDocument(l,u){return this.openOrCloseDocument(l,u,!0)}openOrCloseDocument(l,u){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=this.documentService.getDocument(l);if(!g||!this.viewerService.hasViewer(u))return!1;const m=this.viewerService.getViewer(u);return f?this.documentService.onCloseDocument.emit(hF.create(g,u,m.groupUid)):this.documentService.onOpenDocument.emit(dF.create(g,u,m.groupUid)),this.commandService.emitOperationsChanged(l),!0}deletePages(l,u){var f;return u=fw(u),this.commandService.removePageFromCommand(l,[...u]),u.forEach(g=>{const m=this.pageService.getPage(g);this.fileService.deleteUser(m.fileUid,m.fileIndex,g)}),null===(f=this.annotationService)||void 0===f||f.deleteAnnotationPages(u),this.documentService.removePagesFromDocument(l,[...u]),this.pageService.deletePages(u),!0}deleteAllPages(l){var u;const f=this.documentService.getDocument(l),g=[...f.pages];return this.commandService.removePageFromCommand(l,g),f.pages.forEach(m=>{const v=this.pageService.getPage(m);this.fileService.deleteUser(v.fileUid,v.fileIndex,m)}),null===(u=this.annotationService)||void 0===u||u.deleteAnnotationPages(f.pages),this.documentService.removeAllPagesFromDocument(l),this.pageService.deletePages(g),!0}movePages(l,u,f){return u=fw(u),this.documentService.movePages(l,u,f)}swapPages(l,u,f){return this.documentService.swapPages(l,u,f)}reorderPages(l,u){return u=fw(u),this.documentService.reorderPages(l,u)}printPages(l,u,f){var g=this;return Fe(function*(){const m=g.documentService.getDocument(l);if(!m)return Promise.reject(it.DOC_NOT_EXIST);const v=u||Array.from(Array(m.pages.length).keys()),_=[];for(let I=0;I<v.length;I++){var b;const k=yield g.getPageData(m.pages[v[I]],{raw:!1,display:!0,thumbnail:!1,renderAnnotation:null===(b=null==f?void 0:f.printAnnotation)||void 0===b||b,isGetPrintPageData:!0});_.push(k)}if(0===_.length)return Promise.reject();const S=[];return _.forEach(I=>{S.push({data:I.display.data,width:I.display.width,height:I.display.height})}),function(I){let k,O,j="";I.forEach((Q,ie)=>{let oe=1120,le=850;const he=le/Q.width,_e=oe/Q.height;he<_e?oe=Math.floor(Q.height*he):he>_e&&(le=Math.floor(Q.width*_e)),j+=`<div class="imageContainer"><img id="DDV_Image${ie}" src='${kE(Q.data).data}' referrerpolicy='strict-origin-when-cross-origin'"/></div>`,k+=le,O+=oe});const J=window.open("about:blank","_blank",`alwaysRaised=yes, z-look=yes, top=0, left=0, toolbar=no, menubar=no, location=no, status=no,width=${k}, height=${O}`);if(J){J.document.write(`<html><head>\n                    <style>\n                        @page {\n                            margin: 0mm;\n                        }\n                        @media print {\n                            body, html {\n                                margin: 0;\n                                padding: 0;\n                                width: 100%;\n                                height: 100%;\n                            }\n\n                            .imageContainer {\n                                break-after: page;\n                                position: relative;\n                                width: 100%;\n                                height: 100%;\n                                display: flex;\n                                align-items: center;\n                                justify-content: center\n                            }\n\n                            img {\n                                width: 100%;\n                                max-width: 100%;\n                                max-height: 100%;\n                            }\n                        }\n                    </style>\n                </head><body id='DDV_body'>${j}</body></html>`),J.document.close(),J.focus();const Q=J.document.getElementById("DDV_body");Q&&(Q.onload=()=>{J&&J.print()})}}(S),!0})()}setDetectHandler(l,u){this.onSetExternalHandler.emit(U2.create("detect")),this.detectorService.setDetector(u)}setImageFilterHandler(l){this.onSetExternalHandler.emit(U2.create("filter")),this.filterService.setImageFilter(l)}clearExternalHandler(l){if(xn(l))switch(l){case"documentBoundariesDetect":this.setDetectHandler(l,null);break;case"imageFilter":this.setImageFilterHandler(null)}}unload(){var l;this.viewerService.reset(),this.commonCanvas.reset(),this.sourceStore.reset(),this.documentService.reset(),this.fileService.reset(),this.pageService.reset(),this.commandService.reset(),this.resizeService.reset(),this.processService.reset(),this.detectorService.reset(),this.parserService.reset(),this.fileSaveService.reset(),null===(l=this.annotationService)||void 0===l||l.reset(),xi.reset(),gn.unload()}preloadModule(l){gn.preloadModule(l)}perspectivePage(l,u,f){var g=this;return Fe(function*(){let m;const v=g.pageService.getPage(u);if(v.setQuad(f)){if(g.annotationService.deleteAnnotations(v.annotations),g.commandService.removePageFromCommand(l,[u]),v.quad){const{width:S,height:I}=jZ(v.quad);v.original.updateImageDetail({width:S,height:I}),v.display.updateImageDetail({width:S,height:I})}g.imageLoadService.cancelLoadOriginalImage(u),v.original.reset(),m=yield g.imageDataService.getOriginal(u),g.imageLoadService.cancelLoadDisplayImage(u),g.imageLoadService.cancelLoadThumbnailImage(u),v.display.reset(),v.thumbnail.reset();const{width:_,height:b}=v.original.getPageSize();v.isFull?(v.mediaBox=qe({},v.initState.mediaBox),v.cropBox=qe({},v.initState.cropBox)):(v.mediaBox={left:0,top:0,width:_,height:b},v.cropBox=qe({},v.mediaBox)),g.onAfterPerspective.emit(mF.create(l,u,f,_,b))}return m||g.imageDataService.getOriginal(u)})()}filterPages(l,u,f){var g=this;return Fe(function*(){u.forEach(v=>{const _=g.pageService.getPage(v);_.filter!==f&&(_.filter=f,_.display.reset(),_.thumbnail.reset())});const m=M2.create(l,u,f);return g.onFilterChanged.emit(m),!0})()}insertBlankPage(l,u,f,g,m,v){const _=this.documentService.getDocument(l);if(!_)return"";this.onBeforeLoadSource.emit({docUid:l});const b=Ai(),S={fileData:new Blob([""],{type:"application/ddv-blank-image"}),width:null!=u?u:816,height:null!=f?f:1056,resolutionX:null!=g?g:96,resolutionY:null!=m?m:96},I=this.getSourceParseOptions(S,"application/ddv-blank-image");this.sourceStore.set(b,{fileData:S.fileData,loadOptions:I}),this.fileService.addFile(b,"application/ddv-blank-image",1),this.parserService.parse(S.fileData,"application/ddv-blank-image",b,[0],I);const{displayResolution:k}=Vn,O=Ai();this.fileService.addUser(b,0,O);const j={resource:{data:S.fileData,width:S.width,height:S.height,resolutionX:S.resolutionX,resolutionY:S.resolutionY},mediaBox:{left:0,top:0,width:S.width/S.resolutionX*k,height:S.height/S.resolutionY*k},cropBox:{left:0,top:0,width:S.width/S.resolutionX*k,height:S.height/S.resolutionY*k},annotations:[],fileIndex:0,pageUid:O,fileUid:b};return this.pageService.createPage(j,_),this.annotationService.createAnnotationsByParsedPages(l,[j]),this.documentService.addPagesToDocument(l,[O],v),this.documentService.onPagesAdded.emit(U_.create(l,[_.pages.indexOf(O)],[O])),O}};function $g(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const{tag:u,style:f,id:g,className:m,children:v}=p,_=document.createElement(u);return g&&(_.id=g+l),m&&(_.className=m),f&&function(b,S){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(xn(S))b.style.cssText=S;else if(I){let k="";Object.keys(S).forEach(O=>{k+=`${O}:${S[O]};`}),b.style.cssText=k}else Object.keys(S).forEach(k=>{b.style[k]=S[k]})}(_,f),v&&v.forEach(b=>{const S=$g(b,l);_.appendChild(S)}),_}function JZ(p){p&&(p.style.display="none")}function AF(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";p&&(p.style.display=l)}const j_=p=>parseFloat(Number(p).toFixed(4));class qh extends rr{constructor(){super(),N(this,"uid",void 0),N(this,"type",void 0),N(this,"action",void 0),N(this,"isValid",void 0),this.isValid=!0,this.uid=Ai()}execute(){return null}undo(){return null}}new class extends rr{constructor(){super(...arguments),N(this,"docCreated",Et(this)),N(this,"docDeleted",Et(this)),N(this,"pageAdded",Et(this)),N(this,"pageDeleted",Et(this)),N(this,"annotationCreated",Et(this)),N(this,"annotationDeleted",Et(this)),N(this,"annotationUpdated",Et(this)),N(this,"replyToAnnotation",Et(this)),N(this,"commentDeleted",Et(this)),N(this,"commentUpdated",Et(this))}};const MAe={canvasStyle:{cursor:"default"},currentPageStyle:{border:""},pageStyle:{border:"2px solid #707070",background:"#e2e2e2"},selectedPageStyle:{background:"#6f76ff",border:"2px solid #e98b1f"},hoveredPageStyle:{background:"#a5a9fb",border:"2px solid #e98b1f"},placeholderStyle:{background:"#b5b5b5",border:"0px solid #f00"},pageNumberStyle:{width:24,height:24,left:"50%",top:"",right:"",bottom:"0px",translateX:"-50%",translateY:0,border:"0px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",onPage:!1,color:"#000",fontSize:12,fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle"},checkboxStyle:{width:24,height:24,left:0,top:0,right:"",bottom:"",translateX:0,translateY:0,border:"1px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",visibleByHover:!0,checkMarkColor:"#000",checkMarkLineWidth:2},removeBtnStyle:{visibility:"visible",width:24,height:24,background:"#fff",border:"1px solid #515151",borderRadius:"50%",opacity:1,left:"",top:-8,right:-8,bottom:"",checkMarkColor:"#ea2e2e"},quadSelectionStyle:{border:"1px dashed #fe8e14",ctrlBorderRadius:0,ctrlBorder:"1px dashed #fe8e14",ctrlWidth:10,ctrlHeight:10,invalidCtrlBorderColor:"#fe8e14",invalidBorderColor:"#fe8e14"},enableDragPage:!0,dragThreshold:3,dragStartTimeThreshold:500,enablePanX:!0,enablePanY:!0,panThreshold:3,enableZoom:!0,enableZoomWithCtrl:!0,enableZoomWithTouch:!0,zoom:1,minZoom:.02,maxZoom:8,wheelZoomFactor:1.2,tapZoomFactor:1.2,zoomOrigin:{x:"center",y:"center"},enableZoomInCropMode:!0,enableZoomInPanMode:!0,enableZoomInAnnotationMode:!0,enableSlide:!0,startSlideThreshold:20,slideThreshold:.2,startSlideThresholdForPerspective:30,slideThresholdForPerspective:.2,multiselectMode:!1,enableSelectWithShift:!0,enableSelectWithCtrl:!0,enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0,scrollDirection:"vertical",displayMode:"single",fitMode:"window",margin:10,rows:4,columns:1,maxRows:20,maxColumns:20,visibility:"visible",viewerMode:qo.DEFAULT,toolMode:"pan",annotationMode:"select",enableMultiTab:!1,scrollToLatest:!1,autoScroll:!0,autoChangeIndex:!0,enableFillColor:!0,blankFillColor:"#fff",maxOptimizationSize:7e3,enableOptimizePage:!1,enableAnnotationUi:!1,enableAnnotationInteraction:!0,enableSelectAnnotation:!0,enableRotateAnnotation:!0,enableMoveAnnotation:!0,enableResizeAnnotation:!0,enableKeyboardInteraction:!0,enableZoomInWidthKeyboard:!0,enableZoomOutWidthKeyboard:!0,enableUndoWidthKeyboard:!0,enableRedoWidthKeyboard:!0,enableDeleteWidthKeyboard:!0,enableSelectAllWidthKeyboard:!0,enableMoveAnnotationWidthKeyboard:!0,enableSaveWidthKeyboard:!0,enableLoadSourceWidthKeyboard:!0,enablePrintWidthKeyboard:!0,enableSelectPageWidthKeyboard:!0,enableCopyCutPasteWidthKeyboard:!0,moveAnnotationStepSize:2,moveAnnotationAcceleration:1};class OAe extends fs{constructor(){super({name:"Checkbox"}),N(this,"shapeType","checkbox"),N(this,"checkboxStyle",void 0),N(this,"parsedCheckboxStyle",void 0),N(this,"isChecked",!1)}get checked(){return this.isChecked}set checked(l){this.isChecked=l}updateStyle(l){Object.assign(this.style,l)}}class FAe extends fs{constructor(){super({name:"PageNumber"}),N(this,"shapeType","pageNumber"),N(this,"text",void 0),N(this,"parsedPageNumberStyle",void 0),this.text="0"}updateText(l){this.text=l}updateStyle(l){Object.assign(this.style,l)}}class LAe extends ps{constructor(l){super(Ht(qe({},l),{name:"TabPage"})),N(this,"uid",void 0),N(this,"tab",void 0),N(this,"isSelected",!1),N(this,"isHovered",!1),N(this,"isDragging",!1),N(this,"isLoading",!1),N(this,"isPreload",!1),N(this,"isLoaded",!1),N(this,"rWidth",void 0),N(this,"rHeight",void 0),N(this,"rotation",0),N(this,"cropLeft",void 0),N(this,"cropTop",void 0),N(this,"cropWidth",void 0),N(this,"cropHeight",void 0),N(this,"mediaBoxRect",void 0),N(this,"cropBoxRect",void 0),N(this,"isOptimized",!1),N(this,"optimizedUid","1"),N(this,"optimizationUid","2"),N(this,"editUid",void 0),N(this,"editedUid",void 0),N(this,"zoom",1),N(this,"image",void 0),N(this,"borderBox",void 0),N(this,"checkbox",void 0),N(this,"pageNumber",void 0),N(this,"curBox",void 0),N(this,"mediaBox",void 0),N(this,"cropBox",void 0),N(this,"realTimeBox",void 0),this.tab=l.tab,this.uid=l.uid,this.rWidth=l.style.width,this.rHeight=l.style.height,this.initSubShapes(l)}initSubShapes(l){this.updateStyle({visibility:"hidden"});const u=new Ev({name:"pageImage",id:this.uid,style:{x:0,y:0,zIndex:-99999}}),f=new ps({name:"pageOptimizedBox",style:{x:0,y:0}}),g=new ps({name:"pageCropBox"});g.clippable=!0;const m=new ps({name:"pageMediaBox"}),v=new ps({name:"pageBorderBox",style:qe(qe({},l.style),l.formattedPageStyle)}),_=new ps({name:"currentStyleBox",style:{visibility:"hidden"}}),b=new OAe,S=new FAe;m.appendChild(u),g.appendChild(m),v.appendChild(f),v.appendChild(g),v.appendChild(_),v.appendChild(b),this.appendChild(S),this.appendChild(v),this.image=u,this.borderBox=v,this.realTimeBox=f,this.pageNumber=S,this.checkbox=b,this.curBox=_,this.cropBox=g,this.mediaBox=m}getRect(){const l=this.realTimeBox.getPosition();return{left:l.x,top:l.y,width:this.rWidth,height:this.rHeight}}setImgDom(l){this.image.style.img=l}getImgDom(){return this.image.style.img}clearOptimization(){this.isOptimized=!1,this.realTimeBox.imageData=null,this.image.updateStyle({visibility:"visible"}),this.optimizationUid=Ai()}destroy(){this.image.style.img=null,this.image=null,this.realTimeBox=null}setPage(l,u,f,g){this.updateStyle({x:l,y:u,width:f,height:g})}setBorderBox(l,u,f,g,m){pt(m)?this.borderBox.updateStyle({x:l,y:u,width:f,height:g}):this.borderBox.updateStyle({x:l,y:u,width:f,height:g,borderWidth:m})}setCropBox(l,u,f,g,m){let v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.cropBox.setLocalScale(1),this.cropBox.updateStyle({x:l,y:u,width:f,height:g}),this.cropBox.setLocalScale(m),this.cropBox.setLocalAngle(v),180===this.cropBox.getAngle()&&this.cropBox.setLocalAngle(179.9)}setRealTimeBox(l,u,f,g,m){this.realTimeBox.setLocalScale(1),this.realTimeBox.updateStyle({x:l,y:u,width:f,height:g}),this.realTimeBox.setLocalScale(m,m,1)}setMediaBox(l,u,f,g){this.mediaBox.updateStyle({x:l,y:u,width:f,height:g})}setCurBox(l,u,f,g){this.curBox.updateStyle({x:l,y:u,width:f,height:g})}setImage(l,u,f,g){this.image.updateStyle({x:l,y:u,width:f,height:g})}}function PF(p){const{borderWidth:l,borderColor:u,borderStyle:f}=Fx(p),g=parseInt(l||"0px",10);let m=[0,0];return"dashed"===f&&(m=[2*g,g]),{borderWidth:g,borderStyle:m,borderColor:u||"",lineDash:m}}const H_=p=>{const{border:l}=p;if(!l)return 0;const u=l.match(/[0-9]+/g)[0];return parseInt(u||"0",10)};function qg(p,l){if(pt(p)||""===p)return null;const u=Tv(p);return"%"===u.unit?l*u.value/100:u.value}function G_(p,l,u){p.style.width=`${l}px`,p.style.height=`${u}px`}function Vv(p){const l=devicePixelRatio;return Xt(p)&&p>0?(p=Math.floor(p*l)/l)||(p=1/l):p=0,p}function vp(p){const l=devicePixelRatio;return Xt(p)?(p=Math.round(p*l)/l)||(p=1/l):p=0,p}function fl(p){return vp(p)}const RF=()=>{const p=document.createElement("div");p.style.width="100px",p.style.height="100px",p.style.overflow="scroll",p.style.position="absolute",p.style.top="-9999px",document.body.appendChild(p);const l=p.offsetWidth-p.clientWidth;return document.body.removeChild(p),l};class NAe{constructor(l,u){N(this,"tab",void 0),N(this,"viewerContext",void 0),N(this,"viewportWidth",600),N(this,"viewportHeight",800),N(this,"currentViewportWidth",0),N(this,"currentViewportHeight",0),N(this,"currentLayoutWidth",0),N(this,"currentLayoutHeight",0),N(this,"placeholderPages",[]),N(this,"scrollLeft",0),N(this,"scrollTop",0),N(this,"maxScrollLeft",0),N(this,"maxScrollTop",0),N(this,"startRow",0),N(this,"endRow",0),N(this,"startColumn",0),N(this,"endColumn",0),N(this,"preloadCount",1),N(this,"pagePreloadChanges",[]),N(this,"direction","vertical"),N(this,"displayMode",void 0),N(this,"fitMode",void 0),N(this,"rows",void 0),N(this,"columns",void 0),N(this,"zoom",void 0),N(this,"defaultReference",void 0),N(this,"zoomReference",void 0),N(this,"resizeReference",void 0),N(this,"oldZoom",void 0),N(this,"isZoomChanged",void 0),N(this,"isOutOfBounds",void 0),N(this,"isScrollbarResized",!0),N(this,"scrollbarWidthCache",void 0),N(this,"defaultWidth",void 0),N(this,"defaultHeight",void 0),this.tab=l,this.viewerContext=u;const{viewerConfig:f}=u;this.rows=f.rows,this.columns=f.columns,this.zoom=f.zoom,this.oldZoom=f.zoom,this.displayMode=f.displayMode,this.fitMode=f.fitMode,this.direction=f.scrollDirection,this.isZoomChanged=!1,this.isOutOfBounds=!1}get isVertical(){return"vertical"===this.direction}get isContinuousDisplay(){return"continuous"===this.displayMode}get isSingleDisplay(){return"single"===this.displayMode}get scrollbarWidth(){if(!this.isScrollbarResized&&this.scrollbarWidthCache)return this.scrollbarWidthCache;const l=RF();return this.scrollbarWidthCache=l,this.isScrollbarResized=!1,l}getRealRowAndColumnContinuous(){const{rows:l,columns:u,isVertical:f}=this,{total:g}=this.tab;let m=l,v=u;return f?(m=Math.ceil(g/u),g<=u&&(v=Math.max(1,g),m=1)):(v=Math.ceil(g/l),g<=l&&(m=Math.max(1,g),v=1)),{realRow:m,realColumn:v}}getRealRowAndColumnThumbnail(){const{total:l}=this.tab,{rows:u,columns:f,isVertical:g}=this,m=g?f:Math.ceil(l/u);return{realRow:g?Math.ceil(l/f):u,realColumn:m}}getZoomOriginCord(){const{zoomOrigin:l}=this.viewerContext.viewerConfig,u={start:0,center:.5,end:1};return{originX:this.currentViewportWidth*u[l.x],originY:this.currentViewportHeight*u[l.y]}}getMargin(){return this.formatMarginAndGap(this.viewerContext.viewerConfig.margin)}getPageBorderWidth(){const{styleService:l}=this.viewerContext,{borderWidth:u}=l.getParsedPageStyle();return{borderWidth:u,selectedBorderWidth:l.getParsedSelectedPageStyle().borderWidth,hoveredBorderWidth:l.getParsedHoveredPageStyle().borderWidth}}getPages(){return this.tab.pages}getParsedPageNumberStyle(l,u){return this.viewerContext.styleService.getParsedPageNumberStyle({width:l,height:u})}getPageNumberStyle(){return this.viewerContext.viewerConfig.pageNumberStyle}getParsedCheckboxStyle(l,u){return this.viewerContext.styleService.getParsedCheckboxStyle({width:l,height:u})}getParsedPageStyle(){return this.viewerContext.styleService.getParsedPageStyle()}getParsedCurrentPageStyle(){return this.viewerContext.styleService.getParsedCurrentPageStyle()}getParsedSelectedPageStyle(){return this.viewerContext.styleService.getParsedSelectedPageStyle()}getParsedHoveredPageStyle(){return this.viewerContext.styleService.getParsedHoveredPageStyle()}getParsedPlaceholderStyle(){return this.viewerContext.styleService.getParsedPlaceholderStyle()}getParsedCanvasStyle(){return this.viewerContext.styleService.getParsedCanvasStyle()}formatMarginAndGap(l){if(xn(l)){if(/px/.test(l)){const[f]=l.match(/(\d+)/);return parseInt(f,10)}const u=this.viewerContext.rendererService.getCanvasDom();if(/%/.test(l)){const f=u.width/Ox(),[g]=l.match(/(\d+)/);return f*parseInt(g,10)/100}if(/em/.test(l)){const f=getComputedStyle(u).fontSize,[g]=f.match(/(\d+)/),[m]=l.match(/(\d+)/);return parseInt(g,10)*parseInt(m,10)}}return Xt(l)?l:parseInt(l,10)}setZoom(l){this.oldZoom=this.zoom,this.zoom=l,this.tab.pages.forEach(u=>{u.zoom=l})}getTabOffset(){const{maxScrollLeft:l,maxScrollTop:u,currentLayoutWidth:f,currentLayoutHeight:g,currentViewportWidth:m,currentViewportHeight:v,scrollLeft:_,scrollTop:b}=this;let S=0,I=0;const k=this.getParsedCanvasStyle().borderWidth||0;return S=l>0?-_:(m-(f-2*k))/2,I=u>0?-b:(v-(g-2*k))/2,{offsetX:S,offsetY:I}}parseReferenceDefault(){const{tab:l,maxScrollLeft:u,maxScrollTop:f}=this,m=this.placeholderPages[l.current];if(!m)return{scrollLeft:0,scrollTop:0};const v=this.getMargin();let _=m.x-v,b=m.y-v;return this.isContinuousDisplay&&(_=m.pageX-v,b=m.pageY-v),_=Sr(_,0,u),b=Sr(b,0,f),{scrollLeft:_,scrollTop:b}}parseReferenceZoom(l,u,f){if(pt(l)&&(l=this.zoomReference),pt(u)||pt(f)){const{originX:b,originY:S}=this.getZoomOriginCord();u=b,f=S}let{scrollLeft:g,scrollTop:m}=this.parseReference(l,u,f);const{maxScrollLeft:v,maxScrollTop:_}=this;return g=Sr(g,0,v),m=Sr(m,0,_),{scrollLeft:g,scrollTop:m}}parseReferenceResize(){const{resizeReference:l}=this;let{scrollLeft:u,scrollTop:f}=this.parseReference(l,0,0);const{maxScrollLeft:g,maxScrollTop:m}=this;return u=Math.min(u,g),f=Math.min(f,m),{scrollLeft:u,scrollTop:f}}updateReference(){const{currentViewportWidth:l,currentViewportHeight:u}=this,f=this.generateReference(0,0),g=this.generateReference(l/2,u/2),{originX:m,originY:v}=this.getZoomOriginCord(),_=this.generateReference(m,v);this.defaultReference=g,this.resizeReference=f,this.zoomReference=_}generateReference(l,u){let f,g,m,v,_=null,b=Number.MAX_VALUE;const{offsetX:S,offsetY:I}=this.getTabOffset(),{zoom:k}=this;return this.placeholderPages.forEach(O=>{if(O&&("single"===this.displayMode&&O.uid===this.tab.currentUid||"continuous"===this.displayMode)){const j=O.x+S,W=O.y+I,J=new AO(j+O.width/2,W+O.height/2).distanceTo({x:l,y:u});J<b&&(b=J,_=O.uid,l<j?(f="start",m=j-l):l>j+O.width?(f="end",m=l-(j+O.width)):(f="center",m=(l-j)/k),u<W?(g="start",v=W-u):u>W+O.height?(g="end",v=u-(W+O.height)):(g="center",v=(u-W)/k))}}),{pageX:m,pageY:v,positionX:f,positionY:g,pageUid:_}}parseReference(l,u,f){const{pageX:g,pageY:m,positionX:v,positionY:_,pageUid:b}=l,S=this.placeholderPages.find(J=>J.uid===b),{zoom:I}=this;let k,O,j=0,W=0;return S&&("start"===v?k=S.x-g:"center"===v?k=S.x+g*I:"end"===v&&(k=S.x+S.width+g),"start"===_?O=S.y-m:"center"===_?O=S.y+m*I:"end"===_&&(O=S.y+S.height+m)),j=k-u,W=O-f,{scrollLeft:j,scrollTop:W}}getScrollValuesByCurrentChanged(){const{placeholderPages:l,currentViewportWidth:u,currentViewportHeight:f,startRow:g,endRow:m,startColumn:v,endColumn:_,isVertical:b}=this,{current:S}=this.tab,I=this.getMargin(),{realRow:k,realColumn:O}=this.getRealRowAndColumnThumbnail();let j=S,W=S;b?(j=g*O+v,W=m*O+_):(j=v*k+g,W=_*k+_);let J=Sr(this.scrollLeft,0,this.maxScrollLeft),K=Sr(this.scrollTop,0,this.maxScrollTop);if(S>=j&&S<=W)return{scrollLeft:J,scrollTop:K};const Q=l[S];return Q&&(b?(J=0,S<j?K=Q.y-I:S>W&&(K=Q.y+Q.height+I-f)):(K=0,S<j?J=Q.x-I:S>W&&(J=Q.x+Q.width+I-u))),J=Sr(J,0,this.maxScrollLeft),K=Sr(K,0,this.maxScrollTop),{scrollLeft:J,scrollTop:K}}getCurrentByScroll(){let l=this.tab.current;const{placeholderPages:u,currentViewportWidth:f,currentViewportHeight:g,startRow:m,endRow:v,startColumn:_,endColumn:b,isVertical:S}=this,{realRow:I,realColumn:k}=this.getRealRowAndColumnContinuous(),O=f/2,j=g/2,{offsetX:W,offsetY:J}=this.getTabOffset(),{current:K}=this.tab;let Q=Number.MAX_VALUE,ie=Number.MAX_VALUE,oe=S?Math.floor(K/k):K%I,le=S?K%k:Math.floor(K/I);for(let he=m;he<=v;he++){const _e=u[he*k];if(!_e)continue;const{y:Ve,height:ee}=_e,ke=Ve+J,xe=ke-j,Le=j-ke-ee;if(xe<=0&&Le<=0){oe=he;break}xe>0&&xe<ie?(ie=xe,oe=he):Le>0&&Le<ie&&(ie=Le,oe=he)}for(let he=_;he<=b;he++){const _e=u[_];if(!_e)continue;const{x:Ve,width:ee}=_e,ke=Ve+W,xe=ke-O,Le=O-ke-ee;if(xe<=0&&Le<=0){le=he;break}xe>0&&xe<Q?(Q=xe,le=he):Le>0&&Le<Q&&(Q=Le,le=he)}return l=oe*k+le,l===this.tab.current?null:l}setTabScrollValue(l,u){this.scrollLeft=l,this.scrollTop=u;const{offsetX:f,offsetY:g}=this.getTabOffset();this.tab.setPosition({x:f,y:g})}}class BAe extends fs{constructor(l,u){super({name:"DocTab"}),N(this,"uid",void 0),N(this,"docType",void 0),N(this,"docName",void 0),N(this,"doc",void 0),N(this,"isActive",!1),N(this,"currentUid",void 0),N(this,"total",void 0),N(this,"selected",void 0),N(this,"context",void 0),N(this,"viewerContext",void 0),N(this,"shiftReference",void 0),N(this,"oldCurrentUid",void 0),N(this,"oldCurrent",void 0),this.doc=l,this.uid=l.uid,this.docName=l.name,this.docType=l.type,this.total=0,this.selected=[],this.viewerContext=u,this.context=new NAe(this,u),this.oldCurrent=-1,this.oldCurrentUid=void 0,l.pages.forEach(f=>{const g=this.createPage(f);this.appendChild(g)}),this.total=l.pages.length,this.total>0&&(this.updateOldInfo(),this.currentUid=this.pages[this.scrollToLatest?this.total-1:0].uid)}get scrollToLatest(){let{scrollToLatest:l}=this.viewerContext.viewer.group.config;return pt(l)&&(l=this.viewerContext.viewerConfig.scrollToLatest),l}get pages(){return this.childNodes}get current(){return this.currentUid?this.uidToIndex(this.currentUid):-1}get isDocType(){return"document"===this.docType}createPage(l){const{pageStyle:u,pageNumberStyle:f,checkboxStyle:g,removeBtnStyle:m,blankFillColor:v}=this.viewerContext.viewerConfig,_=function(I){const{border:k,background:O}=I;let j={};return k&&(j=PF(k)),qe({background:O},j)}(u),{width:b,height:S}=this.viewerContext.getPageRenderSize(l);return new LAe({tab:this,uid:l,formattedPageStyle:_,pageNumberStyle:f,checkboxStyle:g,removeBtnStyle:m,blankFillColor:v,style:{pointerEvents:"auto",width:b,height:S}})}updateOldInfo(){this.oldCurrentUid=this.currentUid,this.oldCurrent=this.current}updateViewportSize(l,u){this.context.viewportWidth=l,this.context.viewportHeight=u}rename(l){this.docName=l}getCurrentPage(){return this.getPageByUid(this.currentUid)}getAllPageUids(){return this.pages.map(l=>l.uid)}appendPages(l,u,f){const g=l.length;if(!g)return;const m=Xt(f);if(l.forEach((_,b)=>{const S=this.createPage(_);this.appendChild(S,m?f+b:void 0)}),this.total=this.pages.length,u)this.currentUid=this.indexToUid(m?f+g-1:this.total-1),this.updateDefaultReference();else if(!this.currentUid){var v;this.currentUid=null===(v=this.pages[0])||void 0===v?void 0:v.uid,this.updateDefaultReference()}}deletePages(l){this.updateOldInfo();const u=[...l],f=l.includes(this.currentUid);if(f){const g=l.indexOf(this.currentUid);u.splice(g,1),u.push(this.currentUid)}u.forEach(g=>{const m=this.getPageByUid(g);if(f&&m.uid===this.currentUid){if(1===this.total)this.currentUid=null;else{const{current:v}=this;this.currentUid=this.indexToUid(v+(v===this.total-1?-1:1))}this.updateDefaultReference()}XJ(this.selected,g),this.removeChild(m),this.total-=1})}deleteAllPages(){this.updateOldInfo(),[...this.pages].forEach(l=>{this.removeChild(l)}),this.currentUid=null,this.selected=[],this.total=0}movePages(l,u){return this.updateOldInfo(),$J(this.pages,l,u)}switchPage(l,u){return this.updateOldInfo(),qJ(this.pages,l,u)}reorderPages(l){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.updateOldInfo(),KJ(this.pages,l)}gotoPage(l){return 0===this.total?-1:(this.updateOldInfo(),l!==this.current&&(l=Sr(l,0,this.total-1),this.currentUid=this.indexToUid(l),this.updateDefaultReference()),this.updateShiftReference(),l)}selectPages(l){this.pages.forEach(u=>{u.isSelected=l.includes(u.uid)}),this.selected=l}selectPagesByIndices(l){const u=this.indicesToUids(l);this.selectPages(u)}getSelected(){return this.selected.slice()}getSelectedIndices(){return this.selected.map(l=>this.uidToIndex(l))}getPageByIndex(l){return this.pages[l]}getPageByUid(l){return this.pages.find(u=>u.uid===l)}getPageIndex(l){return this.pages.findIndex(u=>u.uid===l.uid)}uidToIndex(l){return this.pages.findIndex(u=>u.uid===l)}uidsToIndices(l){return l.map(u=>this.uidToIndex(u))}indexToUid(l){var u;return null===(u=this.pages[l])||void 0===u?void 0:u.uid}indicesToUids(l){return l.map(u=>this.indexToUid(u))}updateShiftReference(){this.shiftReference=this.currentUid}updateDefaultReference(){this.context.defaultReference={pageUid:this.currentUid}}destroy(){super.destroy(),this.deleteAllPages(),this.isActive=!1,this.doc=null,this.context=null,this.viewerContext=null,this.isDestroyed=!0}}class WAe extends rr{constructor(l){super(),N(this,"tabActivationStack",void 0),N(this,"tabs",void 0),N(this,"activeTabUid",void 0),N(this,"context",void 0),this.tabActivationStack=[],this.tabs=new Map,this.context=l}dispose(){this.clearTabs(),this.tabActivationStack.length=0,super.dispose()}updateViewportSize(l,u){const f=this.getActiveTab();null!=f&&f.isDocType&&f.updateViewportSize(l,u)}createTab(l){if(this.tabs.has(l.uid))return this.tabs.get(l.uid);let u=null;return"document"===l.type&&(u=new BAe(l,this.context)),this.context.viewerConfig.enableMultiTab||this.clearTabs(),this.tabs.set(u.uid,u),u}closeTab(l){if(!this.tabs.has(l))return!1;const{tabActivationStack:u}=this;if(u.includes(l)){const f=u.indexOf(l);u.splice(f,1)}return this.getTab(l).isActive=!1,this.tabs.delete(l),this.activeTabUid===l&&(this.activeTabUid=u[u.length-1]),!0}getTab(l){return this.tabs.get(l)}getDocTab(l){const u=this.getTab(l);return null!=u&&u.isDocType?u:null}hasTab(l){return this.tabs.has(l)}getActiveTab(){return this.tabs.get(this.activeTabUid)}getActiveTabUid(){return this.activeTabUid}getAllTabs(){return Array.from(this.tabs.values())}activateTab(l){if(!this.tabs.has(l))return!1;const{tabActivationStack:u}=this;if(this.context.viewerConfig.enableMultiTab){if(u.includes(l)){const f=u.indexOf(l);u.splice(f,1)}}else u.length=0;return u.push(l),this.activeTabUid=l,this.tabs.forEach(f=>{f.isActive=f.uid===l}),!0}clearTabs(){this.getAllTabs().forEach(l=>{l.destroy()}),this.tabs.clear()}resizeScrollbar(){this.tabs.forEach(l=>{l.context.isScrollbarResized=!0})}}class UAe{constructor(l){N(this,"parsedPageStyleCache",void 0),N(this,"parsedCurrentPageStyleCache",void 0),N(this,"parsedSelectedPageStyleCache",void 0),N(this,"parsedHoveredPageStyleCache",void 0),N(this,"parsedPlaceholderStyleCache",void 0),N(this,"parsedCheckboxStyleCache",void 0),N(this,"parsedPageNumberStyleCache",void 0),N(this,"parsedQuadSelectionStyleCache",void 0),N(this,"parsedCanvasStyleCache",void 0),N(this,"context",void 0),N(this,"isPageStyleChanged",void 0),N(this,"isCurrentPageStyleChanged",void 0),N(this,"isSelectedPageStyleChanged",void 0),N(this,"isHoveredPageStyleChanged",void 0),N(this,"isPlaceholderStyleChanged",void 0),N(this,"isCheckboxStyleChanged",void 0),N(this,"isPageNumberStyleChanged",void 0),N(this,"isQuadSelectionStyleChanged",void 0),N(this,"isCanvasStyleChanged",void 0),this.context=l}getParsedCanvasStyle(){return!this.isCanvasStyleChanged&&this.parsedCanvasStyleCache||(this.parsedCanvasStyleCache=yp(this.context.viewerConfig.canvasStyle),this.isCanvasStyleChanged=!1),this.parsedCanvasStyleCache}getParsedCheckboxStyle(l){return!this.isCheckboxStyleChanged&&this.parsedCheckboxStyleCache||(this.parsedCheckboxStyleCache=yp(this.context.viewerConfig.checkboxStyle,l),this.isCheckboxStyleChanged=!1),this.parsedCheckboxStyleCache}getParsedPageNumberStyle(l){return!this.isPageNumberStyleChanged&&this.parsedPageNumberStyleCache||(this.parsedPageNumberStyleCache=yp(this.context.viewerConfig.pageNumberStyle,l),this.isPageStyleChanged=!1),this.parsedPageNumberStyleCache}getParsedPageStyle(){return!this.isPageStyleChanged&&this.parsedPageStyleCache||(this.parsedPageStyleCache=yp(this.context.viewerConfig.pageStyle),this.isPageStyleChanged=!1),this.parsedPageStyleCache}getParsedCurrentPageStyle(){return!this.isCurrentPageStyleChanged&&this.parsedCurrentPageStyleCache||(this.parsedCurrentPageStyleCache=yp(this.context.viewerConfig.currentPageStyle),this.isCurrentPageStyleChanged=!1),this.parsedCurrentPageStyleCache}getParsedSelectedPageStyle(){return!this.isSelectedPageStyleChanged&&this.parsedSelectedPageStyleCache||(this.parsedSelectedPageStyleCache=yp(this.context.viewerConfig.selectedPageStyle),this.isSelectedPageStyleChanged=!1),this.parsedSelectedPageStyleCache}getParsedHoveredPageStyle(){return!this.isHoveredPageStyleChanged&&this.parsedHoveredPageStyleCache||(this.parsedHoveredPageStyleCache=yp(this.context.viewerConfig.hoveredPageStyle),this.isHoveredPageStyleChanged=!1),this.parsedHoveredPageStyleCache}getParsedPlaceholderStyle(){return!this.isPlaceholderStyleChanged&&this.parsedPlaceholderStyleCache||(this.parsedPlaceholderStyleCache=yp(this.context.viewerConfig.placeholderStyle),this.isPlaceholderStyleChanged=!1),this.parsedPlaceholderStyleCache}getParsedQuadSelectionStyle(){return!this.isQuadSelectionStyleChanged&&this.parsedQuadSelectionStyleCache||(this.parsedQuadSelectionStyleCache=yp(this.context.viewerConfig.quadSelectionStyle),this.isQuadSelectionStyleChanged=!1),this.parsedQuadSelectionStyleCache}isBorderWidthEqualHovered(){const{viewerConfig:l}=this.context;return H_(l.pageStyle)===H_(l.hoveredPageStyle)}isSelectedBorderWidthEqualHovered(){const{viewerConfig:l}=this.context;return H_(l.selectedPageStyle)===H_(l.hoveredPageStyle)}isSelectedBorderWidthEqualNormal(){const{viewerConfig:l}=this.context;return H_(l.pageStyle)===H_(l.selectedPageStyle)}}function yp(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:0,height:0};const u={};if(function(f){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{border:m,ctrlBorder:v}=f;if(!pt(m)){const _=PF(m);Object.assign(g,_)}if(!pt(v)){const _=PF(v);Object.assign(g,{ctrlBorderWidth:_.borderWidth,ctrlBorderColor:_.borderColor,ctrlBorderStyle:_.borderStyle})}}(p,u),function(f){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};VAe.forEach(m=>{pt(f[m])||(g[m]=ni(f[m]).value||0)})}(p,u),function(f){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};jAe.forEach(m=>{pt(f[m])||(g[m]=f[m])})}(p,u),function(f,g){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!pt(f.width)&&(m.width=qg(f.width,g.width),pt(f.translateX)||(m.translateX=qg(f.translateX,m.width)),!pt(f.borderRadius))){const v=qg(f.borderRadius,m.width);m.borderRadiusX=Math.max(0,Math.min(v,m.width/2))}if(!pt(f.height)&&(m.height=qg(f.height,g.height),pt(f.translateY)||(m.translateY=qg(f.translateY,m.height)),!pt(f.borderRadius))){const v=qg(f.borderRadius,m.height);m.borderRadiusY=Math.max(0,Math.min(v,m.height/2))}if(!pt(f.borderRadius)){const v=qg(f.borderRadius,g.width);m.borderRadius=Math.max(0,Math.min(v,g.height/2,g.width/2))}if(!pt(f.ctrlBorderRadius)){const v=qg(f.ctrlBorderRadius,m.ctrlWidth);m.ctrlBorderRadius=Math.max(0,Math.min(v,m.ctrlWidth/2,m.ctrlHeight/2))}HAe.forEach(v=>{const _=["left","right"].includes(v)?g.width:g.height,b=Tv(f[v]);let S=b.value;"%"===b.unit&&(S=_*b.value/100),m[v]=S})}(p,l,u),p.left||p.right||p.bottom||p.top){const{left:f,top:g,right:m,bottom:v,width:_,height:b,translateX:S,translateY:I}=u;u.x=""!==p.left?f+S||0:""!==p.right&&Xt(_)&&l.width-_-m+S||0,u.y=""!==p.top?g+I||0:""!==p.bottom&&Xt(b)&&l.height-b-v+I||0}return u}const VAe=["borderWidth","ctrlBorderWidth","checkMarkLineWidth","fontSize","ctrlWidth","ctrlHeight"],jAe=["background","maskColor","color","borderColor","borderStyle","invalidBorderColor","ctrlBorderColor","ctrlBackground","ctrlBorderStyle","invalidCtrlBorderColor","checkMarkColor","onPage","opacity","visibility","visibleByHover","fontFamily","textAlign","textBaseline","lineJoin","lineCap"],HAe=["left","top","right","bottom"],pw="visible",Kh="hidden";class GAe{constructor(l){N(this,"context",void 0),this.context=l}handleVisibility(l){if(this.context.isDestroyed||l.isDestroyed||!l.total||!l.isActive)return;const{context:u}=this;if(u.isDefaultViewer?l.context.isContinuousDisplay?this.continuousVisibility(l):l.context.isSingleDisplay&&this.singleVisibility(l):u.isThumbnailViewer?this.thumbnailVisibility(l):u.isPerspectiveViewer&&l.context.isSingleDisplay&&this.singleVisibility(l),l.context.pagePreloadChanges.length){l.context.pagePreloadChanges.forEach(g=>{if(g.from&&!g.to){const m=l.getPageByUid(g.pageUid);m&&(m.isLoaded=!1)}});const f=N2.create(l.uid,u.uid,u.viewerConfig.viewerMode,l.context.pagePreloadChanges);u.core.viewerService.onPagePreloadChanged.emit(f)}}thumbnailVisibility(l){const{total:u}=l;if(!u)return;const f=l.context;if(f.isOutOfBounds)return void l.pages.forEach(X=>{X.updateStyle({visibility:"hidden"})});const{rows:g,columns:m,placeholderPages:v,preloadCount:_,isVertical:b}=f,{width:S,height:I}=v[0],k=f.getParsedPageStyle(),O=f.getParsedCurrentPageStyle(),j=f.getParsedSelectedPageStyle(),W=f.getParsedHoveredPageStyle(),J=f.getParsedPlaceholderStyle(),K=f.getParsedPageNumberStyle(S,I),Q=f.getParsedCheckboxStyle(S,I),{visibility:ie,top:oe,bottom:le,onPage:he,height:_e}=K;let Ve=0;const ee="visible"===ie,ke=f.getPageNumberStyle();if(ee){const X=""!==ke.top?oe:le||0;he||(Ve=""!==ke.top?_e+X:0)}const{realColumn:xe,realRow:Le}=f.getRealRowAndColumnThumbnail(),{startRow:V,endRow:F}=this.getVisibleRow(l,Le,xe),{startColumn:z,endColumn:$}=this.getVisibleColumn(l,Le,xe);l.context.startRow=V,l.context.endRow=F,l.context.startColumn=z,l.context.endColumn=$;const P=Vv(O.borderWidth),L=[];l.pages.forEach((X,ne)=>{const Z=b?Math.floor(ne/m):ne%g,te=b?ne%m:Math.floor(ne/g),ae=Z>=V-_&&Z<=F+_&&te>=z-_&&te<=$+_,fe=Z>=V&&Z<=F&&te>=z&&te<=$?pw:Kh;X.isPreload!==ae&&L.push({from:X.isPreload,to:ae,pageUid:X.uid,index:ne});let be={borderWidth:0,background:"#ffffff00"};X.isDragging&&(be=J);let Pe=k;X.isHovered&&(Pe=W),X.isSelected&&(Pe=j);const De=Vv(Pe.borderWidth);if(X.isPreload=ae,X.updateStyle(qe({visibility:fe},be)),X.borderBox.updateStyle(Ht(qe({},Pe),{visibility:fe,borderWidth:De})),ee){let Re=K.y;he||(Re=""!==ke.top?-Ve:K.y+K.bottom),X.pageNumber.parsedPageNumberStyle=Ht(qe({},K),{y:Re}),X.pageNumber.updateText((ne+1).toString())}X.pageNumber.updateStyle({visibility:K.visibility,zIndex:K.onPage?1:0});let Xe=Q.visibility;Q.visibleByHover&&(Xe=X.isHovered||X.isSelected?Q.visibility:"hidden"),X.checkbox.parsedCheckboxStyle=qe({},Q),X.checkbox.updateStyle({visibility:Xe}),X.checkbox.checked=X.isSelected,X.curBox.updateStyle(Ht(qe({},O),{visibility:X.uid===l.currentUid?pw:Kh,borderWidth:P}))}),l.context.pagePreloadChanges=L}continuousVisibility(l){const{preloadCount:u,isVertical:f}=l.context,{pages:g}=l,m=l.context.getParsedPageStyle(),v=l.context.getParsedCurrentPageStyle(),{realRow:_,realColumn:b}=l.context.getRealRowAndColumnContinuous(),{startRow:S,endRow:I}=this.getVisibleRow(l,_,b),{startColumn:k,endColumn:O}=this.getVisibleColumn(l,_,b);l.context.startRow=S,l.context.endRow=I,l.context.startColumn=k,l.context.endColumn=O;const j=Vv(m.borderWidth),W=Vv(v.borderWidth),J=[];g.forEach((K,Q)=>{const ie=f?Math.floor(Q/b):Q%_,oe=f?Q%b:Math.floor(Q/_),le=ie>=S&&ie<=I&&oe>=k&&oe<=O,he=ie>=S-u&&ie<=I+u&&oe>=k-u&&oe<=O+u;K.isPreload!==he&&J.push({from:K.isPreload,to:he,pageUid:K.uid,index:Q}),K.checkbox.updateStyle({visibility:Kh}),K.pageNumber.updateStyle({visibility:Kh}),K.curBox.updateStyle(Ht(qe({},v),{visibility:K.uid===l.currentUid?pw:Kh,borderWidth:W})),K.borderBox.updateStyle(Ht(qe({},m),{borderWidth:j})),K.updateStyle({visibility:le?pw:Kh}),K.isPreload=he}),l.context.pagePreloadChanges=J}singleVisibility(l){const{preloadCount:u}=l.context,{current:f,total:g,pages:m}=l,v=l.getCurrentPage(),_=l.context.getParsedPageStyle(),b=Math.max(f-u,0),S=Math.min(f+u,g-1);v.checkbox.updateStyle({visibility:Kh}),v.pageNumber.updateStyle({visibility:Kh});const I=Vv(_.borderWidth),k=[];m.forEach((O,j)=>{const W=j>=b&&j<=S,J=O.uid===v.uid;O.isPreload!==W&&k.push({from:O.isPreload,to:W,pageUid:O.uid,index:j}),O.borderBox.updateStyle(Ht(qe({},_),{borderWidth:I})),O.updateStyle({visibility:J?pw:Kh}),O.isPreload=W,O.curBox.updateStyle({visibility:Kh})}),l.context.pagePreloadChanges=k}getVisibleColumn(l,u,f){const{scrollLeft:g,placeholderPages:m,currentViewportWidth:v,isVertical:_}=l.context;let b=0,S=f-1;if(_&&this.context.isThumbnailViewer)return{startColumn:b,endColumn:S};let I=Number.MAX_VALUE,k=Number.MAX_VALUE,O=null,j=null;for(let W=0;W<f;W++){const J=m[_?W:W*u];if(!J)continue;const{width:K,x:Q}=J;if(null===O){const ie=Q-g;ie<=0&&g-(Q+K)<-1?(O=W,b=W):ie>0&&ie<I&&(I=ie,b=W)}if(null===j){const ie=g+v,oe=ie-(Q+K);Q-ie<-1&&oe<=0?(j=W,S=W):oe>0&&oe<k&&(k=oe,S=W)}if(null!==O&&null!==j)break}return{startColumn:b,endColumn:S}}getVisibleRow(l,u,f){const{scrollTop:g,placeholderPages:m,currentViewportHeight:v,isVertical:_}=l.context;let b=0,S=u-1;if(!_&&this.context.isThumbnailViewer)return{startRow:b,endRow:S};let I=Number.MAX_VALUE,k=Number.MAX_VALUE,O=null,j=null;for(let W=0;W<u;W++){const J=m[_?W*f:W];if(!J)continue;const{y:K,height:Q}=J;if(null===O){const ie=K-g;ie<=0&&g-(K+Q)<-1?(O=W,b=W):ie>0&&ie<I&&(I=ie,b=W)}if(null===j){const ie=g+v,oe=ie-(K+Q);K-ie<-1&&oe<=0?(j=W,S=W):oe>0&&oe<k&&(k=oe,S=W)}if(null!==O&&null!==j)break}return{startRow:b,endRow:S}}}function QZ(p,l,u,f){const g={isOver:!1,pointerX:-1,pointerY:-1,page:p};if(p&&f){const{x:m,y:v}=p.getPosition(),{width:_,height:b}=p;g.isOver=l>=m&&u>=v&&l<=m+_&&u<=v+b;const S=p.getScale();g.pointerX=(l-m)/S.x,g.pointerY=(u-v)/S.y}return g}const zAe={tag:"div",id:"ddv-thumbnail-container",className:"ddv-thumbnail-container"},YAe={tag:"div",id:"ddv-main-container",className:"ddv-main-container",children:[{tag:"div",id:"ddv-scroller-and-canvas",className:"ddv-scroller-and-canvas",children:[{tag:"div",id:"ddv-scroll-container",className:"ddv-scroll-container",children:[{tag:"div",id:"ddv-scroll-content",className:"ddv-scroll-content"}]},{tag:"div",id:"ddv-canvas-container",className:"ddv-canvas-container",children:[]}]}]},XAe={tag:"div",id:"ddv-video-container",className:"ddv-video-container"},$Ae={tag:"div",id:"ddv-audio-container",className:"ddv-audio-container"},qAe={tag:"div",id:"ddv-main-and-thumbnail",className:"ddv-main-and-thumbnail"},KAe={tag:"div",id:"ddv-core",className:"ddv-core"};class JAe extends rr{constructor(l,u){super(),N(this,"container",void 0),N(this,"defaultDom",void 0),N(this,"mainAndThbContainer",void 0),N(this,"thumbnailContainer",void 0),N(this,"mainContainer",void 0),N(this,"scrollerAndCanvasContainer",void 0),N(this,"scrollContainer",void 0),N(this,"scrollContent",void 0),N(this,"canvasContainer",void 0),N(this,"videoContainer",void 0),N(this,"audioContainer",void 0),N(this,"rootDom",void 0),N(this,"hooks",void 0),N(this,"isBindContainer",!1),N(this,"viewportWidth",void 0),N(this,"viewportHeight",void 0),N(this,"context",void 0),N(this,"dpr",Ox()),N(this,"hasScrollbarX",!1),N(this,"hasScrollbarY",!1),this.context=l,this.hooks=u;const f=$g(KAe,l.postfix);this.defaultDom=f}dispose(){var l,u;null===(l=this.rootDom)||void 0===l||l.remove(),null===(u=this.thumbnailContainer)||void 0===u||u.remove(),this.defaultDom=null,this.rootDom=null,this.thumbnailContainer=null,this.context=null,this.dpr=null,super.dispose()}createMainAndThbContainer(){if(!this.mainAndThbContainer){const u=$g(qAe,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.mainAndThbContainer=u,this.defaultDom.appendChild(u)}}createMainContainer(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainContainer){const u=$g(YAe,l);this.mainContainer=u,this.mainAndThbContainer.appendChild(u);const f=u.querySelector(`#ddv-scroller-and-canvas${l}`),g=u.querySelector(`#ddv-canvas-container${l}`),m=u.querySelector(`#ddv-scroll-container${l}`),v=u.querySelector(`#ddv-scroll-content${l}`);this.scrollerAndCanvasContainer=f,this.canvasContainer=g,this.scrollContainer=m,this.scrollContent=v;const _=S=>{S.target===u&&this.isBindContainer&&this.context.isInitialized&&this.context.resize()},{resizeService:b}=this.context.core;b.observe(u),b.onResizeObserver.on(_,this),this.context.hooks.destroy.on(()=>{b.unobserve(u)})}}createThumbnailContainer(){if(!this.thumbnailContainer){const u=$g(zAe,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.thumbnailContainer=u,this.mainAndThbContainer.insertBefore(u,this.mainContainer)}}createVideoContainer(){if(!this.videoContainer){const u=$g(XAe,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.mainContainer.appendChild(u)}}createAudioContainer(){if(!this.audioContainer){const u=$g($Ae,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.mainContainer.appendChild(u)}}getViewportSize(){if(!this.mainContainer)return{width:0,height:0};const{offsetWidth:l,offsetHeight:u}=this.getElSize(this.mainContainer),f=this.getCanvasBorderSize();return{width:l-2*f,height:u-2*f}}resetViewport(){const{scrollContent:l,canvasContainer:u}=this;G_(u,0,0),G_(l,0,0);const{width:f,height:g}=this.getViewportSize();this.viewportWidth=f,this.viewportHeight=g,this.updateCanvasContainerSize()}resizeViewport(){const{canvasContainer:l,scrollContainer:u}=this;G_(l,0,0);const{offsetWidth:f,offsetHeight:g}=this.getElSize(u);this.viewportWidth=f,this.viewportHeight=g,this.updateCanvasContainerSize()}checkIsRound(l){const u=getComputedStyle(l);return{roundWidth:parseFloat(u.width)%1>=.5,roundHeight:parseFloat(u.height)%1>=.5}}getElSize(l){const{roundWidth:u,roundHeight:f}=this.checkIsRound(l);let{clientWidth:g,clientHeight:m,offsetWidth:v,offsetHeight:_}=l;return u&&(g-=1,v-=1),f&&(m-=1,_-=1),{clientWidth:g,clientHeight:m,offsetWidth:v,offsetHeight:_}}getMaxScrollValue(){const{scrollContainer:l}=this;return{scrollLeft:l.scrollWidth-l.clientWidth,scrollTop:l.scrollHeight-l.clientHeight}}isViewerResized(){return this.scrollContainer.offsetWidth!==this.viewportWidth||this.scrollContainer.offsetHeight!==this.viewportHeight}isDPRChanged(){const l=Ox();return this.dpr!==l&&(this.dpr=l,!0)}isScrollbarAppeared(){return this.scrollContent.offsetWidth>this.scrollContainer.clientWidth||this.scrollContent.offsetHeight>this.scrollContainer.clientHeight}bindContainer(l){let u=l;return l&&xn(l)&&(u=document.querySelector(`#${l}`)),u instanceof HTMLElement&&(u.appendChild(this.defaultDom),this.container=u,this.rootDom=this.defaultDom,this.isBindContainer=!0,this.context.resize(),!0)}unbindContainer(){if(!this.container||0===this.container.children.length)return!1;for(let l=0;l<this.container.children.length;l++)if(this.container.children[l]===this.rootDom){this.container.removeChild(this.rootDom);break}return this.isBindContainer=!1,!0}scrollTo(l,u){const{scrollContainer:f}=this;f.scrollTo?f.scrollTo(l,u):(f.scrollLeft=l,f.scrollTop=u)}scrollBy(l,u){const{scrollContainer:f}=this;f.scrollBy?f.scrollBy(l,u):(f.scrollLeft+=l,f.scrollTop+=u)}updateScrollerContentSize(l){const{currentLayoutWidth:u,currentLayoutHeight:f}=l.context,{scrollContent:g,canvasContainer:m,scrollContainer:v}=this;G_(m,10,10),G_(g,u,f);const _=v.scrollWidth-v.clientWidth,b=v.scrollHeight-v.clientHeight;l.context.maxScrollLeft=_,l.context.maxScrollTop=b;const S=_>0,I=b>0;let k=!1;S!==this.hasScrollbarX&&(this.hasScrollbarX=S,k=!0),I!==this.hasScrollbarY&&(this.hasScrollbarY=I,k=!0),k&&this.context.clearCurrentTabOptimization(),this.updateCanvasContainerSize()}updateCanvasContainerSize(){const{scrollContainer:l,canvasContainer:u}=this,{width:f,height:g}=getComputedStyle(this.scrollContainer);let m,v=parseFloat(f),_=parseFloat(g);l.offsetWidth!==l.clientWidth&&(Xt(m)||(m=RF()),v-=m),l.offsetHeight!==l.clientHeight&&(Xt(m)||(m=RF()),_-=m),G_(u,v,_)}getCanvasBorderSize(){const{canvasContainer:l}=this;return(l.offsetWidth-l.clientWidth)/2}}class QAe{constructor(){N(this,"canvasDom",void 0),N(this,"canvas",void 0),N(this,"renderer",void 0),N(this,"isInitialized",!1),N(this,"canvasWidth",0),N(this,"canvasHeight",0)}clear(){var l;const u=null===(l=this.canvas)||void 0===l?void 0:l.document.documentElement;!u||(u.children.slice().forEach(f=>{u.removeChild(f)}),u.sortable.sorted=[])}render(l){var u;const f=null===(u=this.canvas)||void 0===u?void 0:u.document.documentElement;if(f){if(l)0===f.children.length?f.appendChild(l):f.children.indexOf(l)<0&&f.replaceChild(l,f.children[0]);else{const g=[...f.children];for(let m=g.length;m>=0;m--)f.removeChild(g[m])}this.canvas.render()}}initCanvas(l){let{container:u,width:f,height:g}=l;const m=new XQ({}),v=new WQ({renderer:m,container:u,width:f,height:g});this.canvasWidth=f,this.canvasHeight=g,this.renderer=m,this.canvas=v,this.canvasDom=v.contextService.getDomElement(),this.canvasDom.style.width="100%",this.canvasDom.style.height="100%",this.canvasDom.style.touchAction="none",this.isInitialized=!0}registerShapeRenderer(l,u){this.canvas.contextService.registerShapeRenderer(l,u)}getCanvasPosition(){const l=this.canvasDom.getBoundingClientRect(),{scrollX:u,scrollY:f}={scrollX:void 0===window.scrollX?window.pageXOffset:window.scrollX,scrollY:void 0===window.scrollY?window.pageYOffset:window.scrollY};return{x:l.left+u,y:l.top+f}}resize(l,u){const f=Ox();this.canvas.setDPR(f),this.canvasWidth=l,this.canvasHeight=u,this.canvas.resize(l,u)}}class ZAe{render(l,u){const{opacity:f,visibility:g}=l.parsedCheckboxStyle;0!==f&&"hidden"!==g&&(u.save(),u.globalAlpha=f,this.renderBox(l,u,"out"),u.clip(),this.renderBox(l,u,"in"),this.fill(l,u),this.renderBox(l,u,"center"),this.stroke(l,u),this.renderCheckMark(l,u),u.restore())}renderBox(l,u,f){const{x:g,y:m,width:v,height:_,borderWidth:b,borderRadiusX:S,borderRadiusY:I}=l.parsedCheckboxStyle;let k=0;"center"===f?k=b/2:"in"===f&&(k=b);const O=[{x:g+S,y:m+I,start:Math.PI,end:3*Math.PI/2},{x:g+v-S,y:m+I,start:3*Math.PI/2,end:2*Math.PI},{x:g+v-S,y:m+_-I,start:0,end:Math.PI/2},{x:g+S,y:m+_-I,start:Math.PI/2,end:Math.PI}],j=Math.max(S-k,0),W=Math.max(I-k,0);if(u.beginPath(),u.ellipse&&j&&W)for(let J=0;J<4;J++){const{x:K,y:Q,start:ie,end:oe}=O[J];u.ellipse(K,Q,j,W,0,ie,oe)}else u.rect(g,m,v,_);u.closePath()}fill(l,u){const{background:f}=l.parsedCheckboxStyle;f&&""!==f&&(u.fillStyle=f,u.fill())}stroke(l,u){const{borderColor:f,borderWidth:g,borderStyle:m}=l.parsedCheckboxStyle;u.setLineDash(m),u.strokeStyle=f,u.lineWidth=g,g>0&&f&&""!==f&&u.stroke()}renderCheckMark(l,u){if(!l.checked)return;const{x:f,y:g,width:m,height:v,borderWidth:_,checkMarkLineWidth:b,checkMarkColor:S}=l.parsedCheckboxStyle,I=Math.max(Math.min(m-2*_,v-2*_),0);let k=f,O=g;0!==I&&(m<v?(k+=_,O=O+_+(v-m)/2):(k=k+_+(m-v)/2,O+=_),u.setLineDash([0,0]),u.lineWidth=b,u.strokeStyle=S,u.beginPath(),u.moveTo(k+.15*I,O+.5*I),u.lineTo(k+.4*I,O+.8*I),u.lineTo(k+.85*I,O+.2*I),u.stroke())}}class ePe{render(l,u){const{opacity:f,visibility:g}=l.parsedPageNumberStyle;0!==f&&"hidden"!==g&&(u.save(),u.globalAlpha=f,this.renderBox(l,u,"out"),u.clip(),this.renderBox(l,u,"in"),this.fill(l,u),this.renderBox(l,u,"center"),this.stroke(l,u),this.renderFont(l,u),u.restore())}renderBox(l,u,f){const{x:g,y:m,width:v,height:_,borderWidth:b,borderRadiusX:S,borderRadiusY:I}=l.parsedPageNumberStyle;let k=0;"center"===f?k=b/2:"in"===f&&(k=b);const O=[{x:g+S,y:m+I,start:Math.PI,end:3*Math.PI/2},{x:g+v-S,y:m+I,start:3*Math.PI/2,end:2*Math.PI},{x:g+v-S,y:m+_-I,start:0,end:Math.PI/2},{x:g+S,y:m+_-I,start:Math.PI/2,end:Math.PI}],j=Math.max(S-k,0),W=Math.max(I-k,0);if(u.beginPath(),u.ellipse&&j&&W)for(let J=0;J<4;J++){const{x:K,y:Q,start:ie,end:oe}=O[J];u.ellipse(K,Q,j,W,0,ie,oe)}else u.rect(g,m,v,_);u.closePath()}renderFont(l,u){const{x:f,y:g,width:m,height:v,fontSize:_,color:b,fontFamily:S}=l.parsedPageNumberStyle;u.fillStyle=b,u.textAlign="center",u.textBaseline="middle",u.font=S.includes(" ")?`${_}px '${S}'`:`${_}px ${S}`,u.fillText(l.text,f+m/2,g+v/2+_/8,m)}fill(l,u){const{background:f}=l.parsedPageNumberStyle;f&&""!==f&&(u.fillStyle=f,u.fill())}stroke(l,u){const{borderColor:f,borderWidth:g,borderStyle:m}=l.parsedPageNumberStyle;u.setLineDash(m),u.strokeStyle=f,u.lineWidth=g,g>0&&f&&""!==f&&u.stroke()}}class tPe extends rr{constructor(l,u){super(),N(this,"context",void 0),N(this,"docRenderer",void 0),N(this,"hooks",void 0),this.context=l,this.hooks=u,this.docRenderer=new QAe}dispose(){super.dispose(),this.context=null,this.docRenderer=null,this.hooks=null}initRenderer(l,u,f){this.docRenderer.isInitialized||(Object.assign(l.style,this.context.viewerConfig.canvasStyle),this.docRenderer.initCanvas({container:l,width:u,height:f}),this.docRenderer.registerShapeRenderer("checkbox",new ZAe),this.docRenderer.registerShapeRenderer("pageNumber",new ePe))}getCanvasDom(){return this.docRenderer.canvasDom}clearCanvas(){const l=this.getCanvasDom();!l||l.getContext("2d").clearRect(0,0,l.width,l.height)}resize(l,u){this.docRenderer&&this.docRenderer.resize(l,u)}updateCanvasSize(){if(this.docRenderer){const l=this.getCanvasDom();if(!l)return;const{clientWidth:u,clientHeight:f}=l;this.docRenderer.resize(u,f)}}render(l){l.isDestroyed||(this.hooks.beforeRender.emit(l),this.docRenderer.render(l),this.hooks.afterRender.emit(l),l.pages.forEach((u,f)=>{if(u.isVisible&&u.isLoaded){const g=j5.create(f,u.uid);this.context.emit("pageRendered",g)}}))}getCanvasPosition(){const l=this.docRenderer.canvasDom.getBoundingClientRect(),{scrollX:u,scrollY:f}=window;return{x:l.left+u,y:l.top+f}}}function nPe(p){const l=p.getPages(),u=l.length;if(!u)return p.currentLayoutWidth=0,void(p.currentLayoutHeight=0);let{viewportWidth:f,viewportHeight:g}=p;const{rows:m,columns:v,scrollbarWidth:_,tab:b,isVertical:S}=p,I=p.getMargin();v*m<u&&(S?f-=_:g-=_);let k=0,O=0;S?(k=(f-(v+1)*I)/v,O=(g-(m+1)*I)/m):(O=(g-(m+1)*I)/m,k=(f-(v+1)*I)/v);let j=!1;(k<0||O<0)&&(j=!0,k=Math.max(0,k),O=Math.max(0,O));const W=S?Math.max(m,Math.ceil(u/v)):m,J=S?v:Math.max(v,Math.ceil(u/m)),K=k*J+(J+1)*I,Q=O*W+(W+1)*I,ie=b.pages.map(Z=>({uid:Z.uid,x:0,y:0,width:k,height:O})),oe=p.getParsedPageStyle(),le=p.getParsedSelectedPageStyle(),he=p.getParsedHoveredPageStyle(),_e=p.getParsedPageNumberStyle(k,O),{visibility:Ve,top:ee,bottom:ke,onPage:xe,height:Le}=_e;let V=k,F=O;const z=k;let $=O,P=0;const L="visible"===Ve,X=p.getPageNumberStyle();if(L){const Z=""!==X.top?ee:ke||0;xe||(F=O-Le-Z,$=O-Le-Z,P=""!==X.top?Le+Z:0)}F<0&&(j=!0,F=Math.max(0,F)),(V-2*oe.borderWidth<0||F-2*oe.borderWidth<0)&&(j=!0);const ne=p.viewerContext.viewService.getCanvasBorderSize();p.currentLayoutWidth=j?0:K+2*ne,p.currentLayoutHeight=j?0:Q+2*ne,p.currentViewportWidth=j?p.viewportWidth:f,p.currentViewportHeight=j?p.viewportHeight:g,p.isOutOfBounds=j,j||(V=fl(V),F=fl(F),l.forEach((Z,te)=>{let ae=oe.borderWidth;Z.isHovered&&(ae=he.borderWidth),Z.isSelected&&(ae=le.borderWidth),ae=Vv(ae);const fe=S?te%v:Math.floor(te/m),be=S?Math.floor(te/v):te%m,Pe=I+fe*(I+k),De=I+be*(I+O);ie[te].x=Pe,ie[te].y=De;let Xe=V-2*ae,Re=F-2*ae;Xe=Math.max(Xe,0),Re=Math.max(Re,0);const Ae=Z.rWidth,de=Z.rHeight;let tt=Ae,Ze=de,et=1;(Ae>Xe||de>Re)&&(Ae/de>Xe/Re?(et=Xe/Ae,tt=Xe,Ze=de*et):(et=Re/de,Ze=Re,tt=Ae*et)),Z.zoom=et;const Qe=vp(Pe),Je=vp(De+P);let st=ae+(Xe-tt)/2,mt=ae+(Re-Ze)/2;st=vp(st),mt=vp(mt);const ut=fl(Ae),Ke=fl(de),nt=Ae*(1-et)/2,lt=de*(1-et)/2,xt=Z.cropWidth,dt=Z.cropHeight,Dt=st-nt-(xt-ut)/2,Rt=mt-lt-(dt-Ke)/2,Nt=st-nt,Ot=mt-lt,Vt=ut,$t=Ke,on=st,dn=mt,sn=fl(tt),bn=fl(Ze);Z.setPage(Qe,Je,z,$),Z.setBorderBox(0,0,V,F,ae),Z.setCropBox(Dt,Rt,xt,dt,et,Z.rotation),Z.setRealTimeBox(Nt,Ot,Vt,$t,et);const{width:ct,height:ht}=p.viewerContext.getPageRenderSize(Z.uid);Z.setMediaBox(-Z.cropLeft,-Z.cropTop,ct,ht),Z.setImage(0,0,ct,ht),Z.setCurBox(on,dn,sn,bn)}),p.placeholderPages=ie)}function ZZ(p){const{tab:l}=p,u=l.getCurrentPage();if(!u)return p.currentLayoutWidth=0,void(p.currentLayoutHeight=0);const{viewportWidth:f,viewportHeight:g,scrollbarWidth:m,fitMode:v}=p,_=p.getMargin(),b=p.getParsedPageStyle(),{borderWidth:S=0}=b,I=2*S,k=u.rWidth,O=u.rHeight,j=2*_,W=I+j,J=I+j,K=f-W,Q=g-J;let{zoom:ie}=p;const oe=eee(v,{zoom:ie,validLayoutWidth:k,validLayoutHeight:O,scrollbarWidth:m,fitViewportWidth:K,fitViewportHeight:Q,isZoomChanged:p.isZoomChanged},iPe);p.isZoomChanged=!1;const{zoomedLayoutWidth:le,zoomedLayoutHeight:he,zoomedViewportWidth:_e,zoomedViewportHeight:Ve,newFitMode:ee}=oe;if(ie=oe.zoom,ee&&v!==ee){p.fitMode=ee,p.viewerContext.viewerConfig.fitMode=ee;const Je=W_.create(v,ee);p.viewerContext.hooks.fitModeChanged.emit(Je)}p.setZoom(ie);const ke=le+W,xe=he+J,Le=_e+W,V=Ve+J,F=p.viewerContext.viewService.getCanvasBorderSize();p.currentLayoutWidth=ke+2*F,p.currentLayoutHeight=xe+2*F,p.currentViewportWidth=Le,p.currentViewportHeight=V,u.zoom=ie,p.tab.setPosition({x:-0,y:-0});const z=l.pages.map(Je=>{let{uid:st}=Je;return{uid:st,x:_,y:_,width:le+I,height:he+I}});p.placeholderPages=z;const $=fl(le+I),P=fl(he+I),L=vp(_),X=L,ne=Vv(S),Z=ne,te=fl(k),ae=fl(O),fe=k*(1-ie)/2,be=O*(1-ie)/2,Pe=u.cropWidth,De=u.cropHeight,Xe=ne-fe-(Pe-te)/2,Re=Z-be-(De-ae)/2,Ae=ne-fe,de=Z-be,tt=te,Ze=ae;u.setPage(L,X,$,P),u.setBorderBox(0,0,$,P),u.setCropBox(Xe,Re,Pe,De,ie,u.rotation),u.setRealTimeBox(Ae,de,tt,Ze,ie);const{width:et,height:Qe}=p.viewerContext.getPageRenderSize(u.uid);u.setMediaBox(-u.cropLeft,-u.cropTop,et,Qe),u.setImage(0,0,et,Qe)}function iPe(p,l){let{zoom:u,validLayoutWidth:f,validLayoutHeight:g,scrollbarWidth:m,fitViewportWidth:v,fitViewportHeight:_}=l;return"none"===p||"actualSize"===p?("actualSize"===p&&(u=1),Math.floor(f*u)>v&&(_-=m),Math.floor(g*u)>_&&(v-=m)):"width"===p||"window"===p&&f/v>=g/_?(u=v/f,g*u>_&&(v-=m,u=v/f)):(u=_/g,f*u>v&&(_-=m,u=_/g)),{zoom:u,zoomedLayoutWidth:f*u,zoomedLayoutHeight:g*u,zoomedViewportWidth:v,zoomedViewportHeight:_}}function eee(p,l,u){const{zoom:f,isZoomChanged:g}=l;let m={};if(g){let v;const _=j_(f);1===f?(v="actualSize",m=u("actualSize",l)):(m=u("width",l),j_(m.zoom)===_?(v="width","window"===p&&(v="window")):(m=u("height",l),_===j_(m.zoom)&&(v="height","window"===p&&(v="window")))),v?m.newFitMode=v:(m=u("none",l),m.newFitMode="none")}else m=u(p,l);return m}function rPe(p,l){let{zoom:u,fitWidth:f,fitHeight:g,validLayoutWidth:m,validLayoutHeight:v,scrollbarWidth:_,isVertical:b,fitViewportWidth:S,fitViewportHeight:I}=l;return"none"===p||"actualSize"===p?("actualSize"===p&&(u=1),Math.floor(m*u)>S&&(I-=_),Math.floor(v*u)>I&&(S-=_)):"width"===p||"window"===p&&f/S>=g/I?(u=S/f,b?v*u>I&&(S-=_,u=S/f):(m*u>S&&(I-=_),g*u>I&&(S-=_,u=S/f))):(u=I/g,b?(v*u>I&&(S-=_),f*u>S&&(I-=_,u=I/g)):m*u>S&&(I-=_,u=I/g)),{zoom:u,zoomedLayoutWidth:m*u,zoomedLayoutHeight:v*u,zoomedViewportWidth:S,zoomedViewportHeight:I}}const tee=p=>{const l=p.getPages();if(!l.length)return;const{tab:u}=p,f=u.current,g=l[f-1],m=l[f+1];g&&nee(p,g,-1),m&&nee(p,m,1)};function nee(p,l,u){const{viewportWidth:f,viewportHeight:g}=p,m=p.getParsedPageStyle(),{borderWidth:v=0}=m,_=p.getMargin(),{rWidth:b,rHeight:S}=l,I=f-2*_-2*v,k=g-2*_-2*v;let O=0,j=0,W=1;b/S>I/k?(O=I,W=I/b,j=S*W):(j=k,W=k/S,O=b*W);let J=(I-O)/2+_,K=(k-j)/2+_;J=Math.max(_,J),K=Math.max(_,K);const{x:Q,y:ie}=p.tab.getPosition();-1===u?(J=-f+J-Q,K-=ie):1===u&&(J=f+J-Q,K-=ie);const ke=l.cropWidth,xe=l.cropHeight,Le=v-b*(1-W)/2-(ke-b)/2,V=v-S*(1-W)/2-(xe-S)/2,F="visible",z="hidden";l.updateStyle({visibility:F,x:J,y:K,width:O+2*v,height:j+2*v}),l.borderBox.updateStyle(Ht(qe({x:0,y:0,width:O+2*v,height:j+2*v},m),{background:"#ffffff00",visibility:F})),l.cropBox.setLocalScale(1),l.cropBox.updateStyle({x:Le,y:V,width:ke,height:xe}),l.cropBox.setLocalScale(W,W,1),l.cropBox.setLocalAngle(l.rotation);const{width:$,height:P}=p.viewerContext.getPageRenderSize(l.uid);l.mediaBox.updateStyle({x:-l.cropLeft,y:-l.cropTop,width:$,height:P}),l.zoom=W,l.checkbox.updateStyle({visibility:z}),l.pageNumber.updateStyle({visibility:z}),l.setImage(0,0,$,P)}function oPe(p){const{displayMode:l}=p;"single"===l?ZZ(p):"continuous"===l?function(u){const f=u.getPages();if(!f.length)return u.currentLayoutWidth=0,void(u.currentLayoutHeight=0);let{zoom:g}=u;const{viewportWidth:m,viewportHeight:v,tab:_,fitMode:b,scrollbarWidth:S,isVertical:I}=u,k=u.getParsedPageStyle(),{borderWidth:O}=k,j=2*O,W=u.getMargin(),{realRow:J,realColumn:K}=u.getRealRowAndColumnContinuous(),Q=new Array(K).fill(0),ie=new Array(J).fill(0);let oe=0,le=0;f.forEach((Ae,de)=>{const tt=I?Math.floor(de/K):de%J,Ze=I?de%K:Math.floor(de/J),Qe=Ae.rHeight+j;Q[Ze]=Math.max(Q[Ze],Ae.rWidth+j),ie[tt]=Math.max(ie[tt],Qe),oe=Math.max(Q[Ze],oe),le=Math.max(ie[tt],le)});let he=Q.reduce((Ae,de)=>Ae+de,0),_e=ie.reduce((Ae,de)=>Ae+de,0);const Ve=(K+1)*W,ee=(J+1)*W,ke=K*j+Ve,xe=J*j+ee;he+=Ve,_e+=ee;const Le=he-ke,V=_e-xe;let F=0,z=0,$=0,P=0;I?(F=m-ke,z=v-2*W-j,$=Q.reduce((Ae,de)=>Ae+de-j,0),P=le-j):(F=m-2*W-j,z=v-xe,$=oe-j,P=ie.reduce((Ae,de)=>Ae+de-j,0));const L=eee(b,{zoom:g,fitWidth:$,fitHeight:P,validLayoutWidth:Le,validLayoutHeight:V,scrollbarWidth:S,isVertical:I,fitViewportWidth:F,fitViewportHeight:z,isZoomChanged:u.isZoomChanged},rPe);u.isZoomChanged=!1;const{zoomedLayoutWidth:X,zoomedLayoutHeight:ne,zoomedViewportWidth:Z,zoomedViewportHeight:te,newFitMode:ae}=L;if(g=L.zoom,ae&&b!==ae){u.fitMode=ae,u.viewerContext.viewerConfig.fitMode=ae;const Ae=W_.create(b,ae);u.viewerContext.hooks.fitModeChanged.emit(Ae)}u.setZoom(g);const fe=X+ke,be=ne+xe;let Pe=0,De=0;I?(Pe=Z+(K+1)*W+K*j,De=te+2*W+j):(Pe=Z+2*W+j,De=te+(J+1)*W+J*j);const Xe=u.viewerContext.viewService.getCanvasBorderSize();u.currentLayoutWidth=fe+2*Xe,u.currentLayoutHeight=be+2*Xe,u.currentViewportWidth=Pe,u.currentViewportHeight=De,u.tab.setPosition({x:-0,y:-0});const Re=_.pages.map(Ae=>({uid:Ae.uid,x:0,y:0,width:0,height:0,pageX:0,pageY:0}));f.forEach((Ae,de)=>{const tt=I?Math.floor(de/K):de%J,Ze=I?de%K:Math.floor(de/J),et=(Q[Ze]-j)*g+j,Qe=(ie[tt]-j)*g+j,Je=Ae.rWidth,st=Ae.rHeight;let mt=0,ut=0;if(0===Ze)mt=W;else{const eh=Re[I?de-1:(Ze-1)*J+tt];mt=eh.x+eh.width+W}if(0===tt)ut=W;else{const eh=Re[I?(tt-1)*K+Ze:de-1];ut=eh.y+eh.height+W}const Ke=Re[de];Ke.width=et,Ke.height=Qe,Ke.x=mt,Ke.y=ut,Ae.zoom=g;const nt=Je*g,lt=st*g,xt=ut+(Qe-lt)/2-O,dt=vp(mt+(et-nt)/2-O),Dt=vp(xt);Ke.pageX=dt,Ke.pageY=Dt;let Rt=nt+j,Nt=lt+j;Rt=fl(Rt),Nt=fl(Nt);const Ot=vp(O),Vt=Ot,$t=fl(Je),on=fl(st),dn=Je*(1-g)/2,sn=st*(1-g)/2,bn=Ot,ct=Ot,ht=fl(nt),Ft=fl(lt),Wt=Ae.cropWidth,rn=Ae.cropHeight,Yn=Ot-dn-(Wt-$t)/2,ki=Vt-sn-(rn-on)/2,Hi=Ot-dn,Ji=Vt-sn,Or=$t,Ga=on;Ae.setPage(dt,Dt,Rt,Nt),Ae.setBorderBox(0,0,Rt,Nt),Ae.setCropBox(Yn,ki,Wt,rn,g,Ae.rotation),Ae.setRealTimeBox(Hi,Ji,Or,Ga,g);const{width:ca,height:Ju}=u.viewerContext.getPageRenderSize(Ae.uid);Ae.setMediaBox(-Ae.cropLeft,-Ae.cropTop,ca,Ju),Ae.setImage(Ae.mediaBoxRect.left,Ae.mediaBoxRect.top,ca,Ju),Ae.setCurBox(bn,ct,ht,Ft)}),u.placeholderPages=Re}(p):"slide"===l&&tee(p)}class sPe{constructor(l,u){N(this,"context",void 0),N(this,"hooks",void 0),this.context=l,this.hooks=u}layout(l){if(l.isDestroyed||!l.isActive)return;let u;if(this.context.isDefaultViewer)u=oPe;else if(this.context.isThumbnailViewer)u=nPe;else if(this.context.isPerspectiveViewer){const{displayMode:f}=l.context;"single"===f?u=ZZ:"slide"===f&&(u=tee)}u&&(this.hooks.beforeLayout.emit(l),u(l.context),this.hooks.afterLayout.emit(l))}}const aPe=["viewerMode","displayMode","toolMode","annotationMode","fitMode","visibility","zoom","zoomOrigin","minZoom","maxZoom","multiselectMode","canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle","quadSelectionStyle","rows","columns","maxColumns","maxRows","margin"];class lPe extends rr{constructor(l){super(),N(this,"context",void 0),N(this,"handlers",{}),this.context=l}dispose(){this.context=null,this.handlers={},super.dispose()}updateConfig(l){for(const[u,f]of Object.entries(l))aPe.includes(u)&&this[u](f)}registerHandler(l,u){return!this[l]&&(this[l]=u,!0)}viewerMode(l){const{context:u}=this;u.viewerConfig.viewerMode=l}toolMode(l){const{context:u}=this,f=u.viewerConfig.toolMode;l!==f&&(u.viewerConfig.toolMode=l,u.hooks.toolModeChanged.emit(X5.create(f,l)))}annotationMode(l){const{context:u}=this,f=u.viewerConfig.annotationMode;l!==f&&(u.viewerConfig.annotationMode=l),u.hooks.annotationModeChanged.emit(J5.create(f,l))}fitMode(l){const{context:u}=this,f=u.getActiveTab();if(!f){const m=u.viewerConfig.fitMode;return m===l?void 0:(u.viewerConfig.fitMode=l,void u.hooks.fitModeChanged.emit(W_.create(m,l)))}const g=f.context.fitMode;g!==l&&(f.context.fitMode=l,"none"!==l&&(u.showTab(f,!0),u.hooks.fitModeChanged.emit(W_.create(g,l))))}displayMode(l){const{context:u}=this,f=u.getActiveTab();let g;if(f){if(g=f.context.displayMode,l===g)return;f.context.displayMode=l,u.showTab(f,!0)}else{if(g=u.viewerConfig.displayMode,l===g)return;u.viewerConfig.displayMode=l}if("slide"!==g&&"slide"!==l){const m=W5.create(g,l);u.viewer.hooks.displayModeChanged.emit(m)}}margin(l){const{context:u}=this;u.viewerConfig.margin!==l&&(u.viewerConfig.margin=l,u.showCurrentTab(!0))}rows(l){const{context:u}=this,f=u.getActiveTab();f?l!==f.context.rows&&(u.styleService.isCheckboxStyleChanged=!0,u.styleService.isPageNumberStyleChanged=!0,f.context.rows=l,this.context.showTab(f,!0)):u.viewerConfig.rows=l}columns(l){const{context:u}=this,f=u.getActiveTab();f?l!==f.context.columns&&(u.styleService.isCheckboxStyleChanged=!0,u.styleService.isPageNumberStyleChanged=!0,f.context.columns=l,this.context.showTab(f,!0)):u.viewerConfig.columns=l}maxColumns(l){l=Math.max(1,l);const{context:u}=this;u.viewerConfig.maxColumns=l;const f=u.getActiveTab();f&&f.context.columns>l&&this.columns(l)}maxRows(l){l=Math.max(1,l);const{context:u}=this;u.viewerConfig.maxRows=l;const f=u.getActiveTab();f&&f.context.rows>l&&this.rows(l)}zoom(l){const{context:u}=this;u.getActiveTab()&&u.zoomTo(l)}visibility(l){const{context:u}=this;if(l===u.viewerConfig.visibility)return;const{rootDom:f,defaultDom:g,thumbnailContainer:m}=u.viewService;if(!f)return;const{ui:v}=u.viewer,_=!m&&v.container.classList.contains("ddv-thumbnail-container"),b=u.viewerConfig.visibility;u.viewerConfig.visibility=l,"visible"===l?(f.style.display="flex",g.style.display="flex",_&&(v.container.style.display="flex"),u.core.viewerService.onResize.emit()):(f.style.display="none",_&&(v.container.style.display="none",u.core.viewerService.onResize.emit()));const S=uF.create(l,b);u.hooks.visibleChanged.emit(S)}zoomOrigin(l){const{context:u}=this;u.viewerConfig.zoomOrigin=l}minZoom(l){const{context:u}=this;u.viewerConfig.minZoom=l}maxZoom(l){const{context:u}=this;u.viewerConfig.maxZoom=l}multiselectMode(l){const{context:u}=this;u.viewerConfig.multiselectMode=l}canvasStyle(l){const{context:u}=this;if(Un(l))if(Object.assign(u.viewerConfig.canvasStyle,l),u.isCaptureViewer){var f;const g=null===(f=u.viewer)||void 0===f||null===(f=f.cameraContext)||void 0===f?void 0:f.cameraContainer;g&&Object.assign(g.style,l)}else{const{canvasContainer:g}=u.viewService,m=u.rendererService.getCanvasDom();g&&(Object.assign(g.style,l),l.cursor&&m&&Object.assign(m.style,{cursor:l.cursor}),u.styleService.isCanvasStyleChanged=!0,l.border&&u.resize(),l.cursor&&u.hooks.canvasCursorStyleChanged.emit())}}pageStyle(l){const{context:u}=this;Un(l)&&(Object.assign(u.viewerConfig.pageStyle,l),u.styleService.isPageStyleChanged=!0,u.showCurrentTab(!0))}selectedPageStyle(l){const{context:u}=this;Un(l)&&(Object.assign(u.viewerConfig.selectedPageStyle,l),u.styleService.isSelectedPageStyleChanged=!0,u.showCurrentTab(!0))}hoveredPageStyle(l){const{context:u}=this;Un(l)&&(Object.assign(u.viewerConfig.hoveredPageStyle,l),u.styleService.isHoveredPageStyleChanged=!0,u.showCurrentTab(!0))}placeholderStyle(l){const{context:u}=this;Un&&(Object.assign(u.viewerConfig.placeholderStyle,l),u.styleService.isPlaceholderStyleChanged=!0,u.showCurrentTab())}currentPageStyle(l){const{context:u}=this;Un&&(Object.assign(u.viewerConfig.currentPageStyle,l),u.styleService.isCurrentPageStyleChanged=!0,u.showCurrentTab())}pageNumberStyle(l){const{context:u}=this;if(Un(l)){const{pageNumberStyle:f}=u.viewerConfig,g=(null==l?void 0:l.onPage)!==(null==f?void 0:f.onPage);Object.assign(f,l),u.styleService.isPageNumberStyleChanged=!0,u.showCurrentTab(g)}}checkboxStyle(l){const{context:u}=this;Un(l)&&(Object.assign(u.viewerConfig.checkboxStyle,l),u.styleService.isCheckboxStyleChanged=!0,u.showCurrentTab())}quadSelectionStyle(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{context:u}=this;Un(l)&&(Object.assign(u.viewerConfig.quadSelectionStyle,l),u.styleService.isQuadSelectionStyleChanged=!0,u.hooks.quadSelectionStyleChanged.emit(),u.showCurrentTab())}scrollDirection(l){const{context:u}=this;u.viewerConfig.scrollDirection=l;const f=u.getActiveTab();f&&(f.context.direction=l,u.resize())}}class cPe extends rr{constructor(l){super(),N(this,"context",void 0),this.context=l}dispose(){super.dispose(),this.context=null}handleExternalEvents(){const{context:l}=this,{hooks:u}=this.context;if(u.pageChanged.on(f=>{const g=this.context.getActiveTab();let m;!g||0===g.total||-1===g.current&&-1!==g.oldCurrent?m=0:-1!==g.current&&-1===g.oldCurrent&&(m=f.total),pt(m)||u.pageExistenceChanged.emit(vF.create(m))}),u.pageChangedAfterRender.on(f=>{const g=this.context.getActiveTab();if(!g)return;const{current:m,oldCurrent:v,currentUid:_,oldCurrentUid:b}=g;if(v!==m){const S=B5.create(v,m);l.emit("currentIndexChanged",S)}if(b!==_){const S=q5.create(b||"",_||"");l.emit("currentPageChanged",S),u.currentPageChanged.emit(f)}}),u.displayModeChanged.on(f=>{l.emit("displayModeChanged",qe({},f))}),u.fitModeChanged.on(f=>{l.emit("fitModeChanged",qe({},f))}),u.toolModeChanged.on(f=>{l.emit("toolModeChanged",qe({},f))}),u.zoomChanged.on(f=>{f.oldZoomRatio!==f.newZoomRatio&&this.context.viewer.emit("zoomChanged",qe({},f))}),!this.context.isCaptureViewer){const f=this.context.rendererService.getCanvasDom();Xo(f,"click",this).on(g=>{const m=this.formatEvent(g);l.emit("click",m)}),Xo(f,"dblclick",this).on(g=>{const m=this.formatEvent(g);l.emit("dblclick",m)}),Xo(document.body,"dblclick",this).on(g=>{}),Xo(f,"contextmenu",this).on(g=>{g.preventDefault();const m=this.formatEvent(g);l.emit("rightclick",m)})}}formatEvent(l){var u,f;const[g]=this.context.formatTouches(l),m=this.context.getPointerOverPageInfo(g.pageX,g.pageY),v=Vn.displayResolution,_=Vn.dataResolution,{pointerX:b,pointerY:S}=m.imageInfo;return R2.create(m.index,null!==(u=null===(f=m.pageInfo.page)||void 0===f?void 0:f.uid)&&void 0!==u?u:"",b<0?-1:Wh(Kn(b,v,_),2),S<0?-1:Wh(Kn(S,v,_),2),Math.floor(g.pageX),Math.floor(g.pageY),l)}}class uPe extends rr{constructor(l){super(),N(this,"context",void 0),N(this,"offsetX",0),N(this,"offsetY",0),N(this,"startX",0),N(this,"startY",0),N(this,"isDragging",!1),N(this,"startPage",void 0),N(this,"newIndexes",void 0),N(this,"cacheChildren",void 0),N(this,"cacheSelectedIndexes",void 0),N(this,"isMousedown",!1),N(this,"starDragIndices",[]),this.context=l}dispose(){super.dispose(),this.context=null}startHandler(l){const{context:u}=this,{viewerConfig:f}=u;if("pan"!==f.toolMode||u.isLoadSource)return;const m=u.getActiveTab();if(null==m||!m.total)return;this.isMousedown=!0;const[v]=u.formatTouches(l),{page:_}=u.getPointerOverPageInfo(v.pageX,v.pageY).pageInfo;if(_&&_){this.startX=v.pageX,this.startY=v.pageY;const b=_.getPosition();this.offsetX=v.pageX-b.x,this.offsetY=v.pageY-b.y,this.startPage=_,this.cacheChildren=m.pages.slice()}}moveHandler(l){const{context:u}=this,f=u.getActiveTab();if(!f||!u.isThumbnailViewer)return;const[g]=u.formatTouches(l),m=u.getPointerOverPageInfo(g.pageX,g.pageY),{page:v}=m.pageInfo;if(this.isDragging){var _,b,S;if(v&&!v.isSelected){const W=f.selected.map(oe=>f.uidToIndex(oe)).sort((oe,le)=>oe-le),J=W[0],K=f.getPageIndex(v),Q=f.pages.slice();W.slice().reverse().forEach(oe=>{Q.splice(oe,1)});let ie=Q.indexOf(v);K>J&&(ie+=1),this.cacheSelectedIndexes.forEach((oe,le)=>{const he=f.getPageByUid(oe.uid);Q.splice(ie+le,0,he)}),this.newIndexes=Q.map(oe=>f.getPageIndex(oe)),f.reorderPages(this.newIndexes,!1),u.layoutService.layout(f),u.visibilityService.handleVisibility(f)}const I=u.styleService.getParsedPlaceholderStyle(),k=devicePixelRatio;let O=g.pageX-this.offsetX,j=g.pageY-this.offsetY;O=Math.round(O*k)/k,j=Math.round(j*k)/k,f.selected.forEach(W=>{const J=f.getPageByUid(W);J.isDragging=!0,J.updateStyle(qe({},I)),J.borderBox.updateStyle({visibility:"hidden"})}),null===(_=this.startPage)||void 0===_||_.updateStyle({zIndex:1}),null===(b=this.startPage)||void 0===b||b.borderBox.updateStyle({visibility:"visible"}),null===(S=this.startPage)||void 0===S||S.borderBox.setPosition({x:O,y:j}),u.loadVisiblePages(f),u.rendererService.render(f)}else if(v&&v===this.startPage&&v.isSelected&&((g.pageX-this.startX)**2+(g.pageY-this.startY)**2)**.5>=u.viewerConfig.dragThreshold&&this.startPage&&u.viewerConfig.enableDragPage){this.isDragging=!0,this.cacheSelectedIndexes=f.selected.map(k=>({uid:k,index:f.uidToIndex(k)})).sort((k,O)=>k.index-O.index);const I=f.uidsToIndices(f.selected);this.starDragIndices=[...I],u.viewer.emit("pagesDragged",U5.create(I,[...f.selected]))}}endHandler(l){var u;if(!this.isMousedown)return;const{context:f}=this,g=f.getActiveTab();if(g){if(this.isDragging){if(this.newIndexes){const v=g.pages.map(_=>this.cacheChildren.indexOf(_));g.childNodes=this.cacheChildren,f.viewer.reorderPages(v),this.newIndexes=null}g.selected.forEach(v=>{const _=g.getPageByUid(v);_.borderBox.setLocalPosition({x:0,y:0}),_.isDragging=!1,_.borderBox.updateStyle({visibility:"visible"})});const m=g.uidsToIndices(g.selected);f.viewer.emit("pagesDropped",V5.create(this.starDragIndices,m,[...g.selected]))}null===(u=this.startPage)||void 0===u||u.updateStyle({zIndex:0}),this.isDragging&&(f.scrollByCurrentChanged=!0,f.layoutService.layout(g),f.visibilityService.handleVisibility(g),f.rendererService.render(g)),this.isMousedown=!1,this.startPage=null,this.isDragging=!1}}}class dPe extends rr{constructor(l){super(),N(this,"context",void 0),N(this,"isStart",!1),N(this,"startX",void 0),N(this,"startY",void 0),N(this,"lastX",void 0),N(this,"lastY",void 0),N(this,"startTime",void 0),N(this,"startScrollLeft",void 0),N(this,"startScrollTop",void 0),N(this,"isScrolling",void 0),N(this,"scrollTimer",void 0),N(this,"scrollDirectionX","left"),N(this,"scrollDirectionY","top"),N(this,"canvasElX",void 0),N(this,"canvasElY",void 0),this.context=l,this.isScrolling=!1}startHandler(l){const{context:u}=this;if(u.isPanning||u.isZooming)return;const f=u.getActiveTab();if(null==f||!f.total)return;const g=u.formatTouches(l);if(g.length>1)return;this.canvasElX=l.screenX,this.canvasElY=l.screenY;const{pageX:m,pageY:v}=g[0];this.isStart=!0,this.startX=m,this.startY=v,this.lastX=m,this.lastY=v,this.startTime=(new Date).getTime();const{scrollLeft:_,scrollTop:b}=f.context;this.startScrollLeft=_,this.startScrollTop=b,this.isScrolling=!1,this.scrollTimer&&(PO.clearTimer(this.scrollTimer),this.scrollTimer=null)}moveHandler(l){if(!this.isStart)return;l instanceof PointerEvent&&l.cancelable&&l.preventDefault();const{context:u}=this;if(u.isZooming)return;const f=u.formatTouches(l);if(f.length>1)return;const g=u.getActiveTab(),{maxScrollLeft:m,maxScrollTop:v}=g.context;let{scrollLeft:_,scrollTop:b}=g.context;if(!m&&!v)return;const{viewerConfig:S}=u,{panThreshold:I,enablePanX:k,enablePanY:O}=S,{pageX:j,pageY:W}=f[0],J=j-this.startX,K=W-this.startY,Q=j-this.lastX,ie=W-this.lastY;if(u.isPanning){if(!_&&!b&&Q>=0&&ie>=0||_===m&&b===v&&Q<=0&&ie<=0)return;k&&(_=this.startScrollLeft-J),O&&(b=this.startScrollTop-K),_=Sr(_,0,m),b=Sr(b,0,v),u.viewService.scrollTo(_,b)}else u.isPanning=k&&Math.abs(J)>=I||O&&Math.abs(K)>=I;this.lastX=j,this.lastY=W}endHandler(l){if(!this.isStart)return;this.isStart=!1,this.context.isPanning=!1;const{context:u}=this,f=u.formatTouches(l,!0);if(f.length>1||u.isZooming||"mouse"===l.pointerType||this.canvasElX===l.screenX&&this.canvasElY===l.screenY)return;const{scrollLeft:g,scrollTop:m}=this.context.viewService.getMaxScrollValue(),{scrollLeft:v,scrollTop:_}=this.context.viewService.scrollContainer;if(!this.isScrolling&&(g>0||m>0)){const b=(new Date).getTime(),k=f[0].pageX-this.startX,O=f[0].pageY-this.startY;let j=!1,W=!1;k>0?(j=0!==v,this.scrollDirectionX="right"):(j=v!==g,this.scrollDirectionX="left"),O>0?(W=0!==_,this.scrollDirectionY="bottom"):(W=_!==m,this.scrollDirectionY="top");const J=b-this.startTime;if((Math.abs(k)>10||Math.abs(O)>10)&&J>0&&J<300&&(j||W)){let K=Math.abs(k)/J,Q=Math.abs(O)/J;(K>.4||Q>.4)&&(K=Math.min(K,2.8),Q=Math.min(Q,2.8),this.scroll(K,Q,-.05))}}}scroll(l,u,f){this.isScrolling=!0;const{scrollLeft:g,scrollTop:m}=this.context.viewService.scrollContainer;let v=0,_=0;this.scrollTimer=PO.createTimer(()=>{const{scrollLeft:b,scrollTop:S}=this.context.viewService.getMaxScrollValue();if(l<=0&&u<=0||!1===this.isScrolling)return PO.clearTimer(this.scrollTimer),this.scrollTimer=null,void(this.isScrolling=!1);l>=0&&("right"===this.scrollDirectionX?v-=40*l:v+=40*l,l+=f),u>=0&&("bottom"===this.scrollDirectionY?_-=40*u:_+=40*u,u+=f);const I=Sr(g+v,0,b),k=Sr(m+_,0,S);this.context.viewService.scrollTo(I,k)},25)}}class hPe extends rr{constructor(l){super(),N(this,"context",void 0),N(this,"scrollTimer",void 0),this.context=l}scrollHandler(l){const{context:u}=this;if(u.scrollByCurrentChanged)return void(u.scrollByCurrentChanged=!1);const f=u.getActiveTab();if(null==f||!f.total)return;const{scrollLeft:g,scrollTop:m}=l.target;f.context.setTabScrollValue(g,m),u.visibilityService.handleVisibility(f),this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(()=>{if(!u.isDestroyed&&f.isActive){if(u.isDefaultViewer){if(f.context.updateReference(),f.context.isContinuousDisplay&&u.viewerConfig.autoChangeIndex){const v=f.context.getCurrentByScroll();null!==v&&(f.gotoPage(v),u.visibilityService.handleVisibility(f),u.emitPageChangedEvent(f),u.emitPageChangedAfterRenderEvent(f),u.core.viewerService.onCurrentChangedByScroll.emit(O2.create(f.uid,u.groupUid,u.uid,v)))}u.loadVisiblePages(f)}else u.isThumbnailViewer&&u.loadVisiblePages(f);this.scrollTimer=null}},42),u.rendererService.render(f),u.hooks.scroll.emit()}wheelHandler(l){const{context:u}=this;let{wheelDelta:f}=l;if(l.deltaY&&(f=-l.deltaY),1===l.deltaMode?f*=16:2===l.deltaMode&&(f=f<0?-100:100),!l.ctrlKey){const{scrollLeft:g,scrollTop:m}=u.viewService.getMaxScrollValue();if(g>0||m>0)l.shiftKey&&g>0?(l.cancelable&&l.preventDefault(),u.scrollByCurrentChanged=!1,u.viewService.scrollBy(-f,0)):(l.cancelable&&l.preventDefault(),u.scrollByCurrentChanged=!1,u.viewService.scrollBy(0,-f));else{const v=u.getActiveTab();if("single"===v.context.displayMode){l.cancelable&&l.preventDefault();let _=v.current;f>0&&0!==v.current?_-=1:f<0&&v.current!==v.total-1&&(_+=1),v.current!==_&&u.viewer.gotoPage(_)}}}}}class fPe extends rr{constructor(l){super(),N(this,"context",void 0),N(this,"wheelTimer",void 0),N(this,"isStart",void 0),N(this,"isZooming",void 0),N(this,"startDistance",void 0),N(this,"touchZoomTimer",void 0),N(this,"startZoom",void 0),this.context=l,this.isZooming=!1,this.isStart=!1,this.startZoom=1}zoomTo(l,u,f){l=j_(l);const{context:g}=this;if(!g.isDefaultViewer)return;const m=g.getActiveTab();if(null==m||!m.total)return;const{viewerConfig:v}=g;if((l=Sr(l,v.minZoom,v.maxZoom))===v.zoom)return;Xt(u)&&Xt(f)||({originX:u,originY:f}=m.context.getZoomOriginCord());const _=m.context.generateReference(u,f),b=m.context.zoom;m.context.setZoom(l),v.zoom=l,m.context.isZoomChanged=!0,g.layoutService.layout(m),g.viewService.updateScrollerContentSize(m),g.rendererService.updateCanvasSize();const{scrollLeft:S,scrollTop:I}=m.context.parseReferenceZoom(_,u,f);m.context.setTabScrollValue(S,I),g.viewService.scrollTo(S,I),g.visibilityService.handleVisibility(m),g.loadVisiblePages(m),g.clearCurrentTabOptimization(),g.rendererService.render(m),m.context.oldZoom=b,g.emitZoomChangedEvent(m)}wheelHandler(l){const{context:u}=this,{viewerConfig:f}=u;let{wheelDelta:g}=l;l.deltaY&&(g=-l.deltaY),l.ctrlKey&&!l.shiftKey&&f.enableZoom&&f.enableZoomWithCtrl&&(l.cancelable&&l.preventDefault(),this.wheelTimer||(this.wheelTimer=setTimeout(()=>{clearTimeout(this.wheelTimer),this.wheelTimer=null;const v=f.wheelZoomFactor||1,_=g>0?v:1/v,{x:b,y:S}=u.rendererService.getCanvasPosition();this.zoomTo(f.zoom*_,l.pageX-b,l.pageY-S)},40)))}touchstartHandler(l){const{context:u}=this,f=u.getActiveTab(),{displayMode:g}=f.context;if(!u.viewerConfig.enableZoom||"continuous"!==g&&"single"!==g)return;const v=u.formatTouches(l);v.length<2||(u.isZooming=!0,this.startZoom=f.context.zoom,this.startDistance=iee(v),this.isStart=!0)}touchmoveHandler(l){if(!this.isStart)return;l.cancelable&&l.preventDefault();const{context:u}=this,f=u.formatTouches(l);if(f.length<2)return;const g=(f[0].pageX+f[1].pageX)/2,m=(f[0].pageY+f[1].pageY)/2;let v=iee(f)/this.startDistance;l.scale&&(v=l.scale);const _=u.getActiveTab();let{zoom:b}=_.context;const S=b;b=this.startZoom*v,b!==S&&(this.touchZoomTimer||(this.touchZoomTimer=setTimeout(()=>{this.zoomTo(b,g,m),clearTimeout(this.touchZoomTimer),this.touchZoomTimer=null},25))),u.isZooming=!0}touchendHandler(l){this.isStart&&(this.isStart=!1,this.startZoom=1,this.context.isZooming=!1)}tapZoomHandler(l){const{toolMode:u,enableZoom:f,tapZoomFactor:g}=this.context.viewerConfig;if(!f)return;const m="zoomIn"===u,v="zoomOut"===u;if(!m&&!v)return;const _=this.context.formatTouches(l);if(_.length>1)return;const b=(_[0].pageX+_[1].pageX)/2,S=(_[0].pageY+_[1].pageY)/2,I=this.context.getActiveTab();let{zoom:k}=I.context;m?k*=g||1:v&&(k/=g||1),this.zoomTo(k,b,S)}}function iee(p){return((p[0].pageX-p[1].pageX)**2+(p[0].pageY-p[1].pageY)**2)**.5}class pPe extends rr{constructor(l){super(),N(this,"context",void 0),N(this,"isStart",!1),N(this,"startX",void 0),N(this,"isSliding",void 0),N(this,"slideDistance",void 0),N(this,"slideDirection",void 0),N(this,"slideRAF",void 0),N(this,"tabX",void 0),N(this,"tabY",void 0),this.context=l,this.isSliding=!1}startHandler(l){if(!this.context.viewerConfig.enableSlide||this.isSliding)return;const u=this.context.getActiveTab();if(null==u||!u.total)return;const{scrollLeft:f,scrollTop:g}=this.context.viewService.getMaxScrollValue();if(f||g)return;const m=this.context.formatTouches(l);if(m.length>1)return;const v=u.getPosition();this.tabX=v.x,this.tabY=v.y,this.startX=m[0].pageX,this.isStart=!0}moveHandler(l){if(!this.isStart)return;const{context:u}=this,f=u.getActiveTab(),g=u.formatTouches(l)[0].pageX-this.startX;if(g>0?this.slideDirection="right":g<0&&(this.slideDirection="left"),this.slideDistance=Math.min(f.context.viewportWidth,Math.abs(g)),this.isSliding)"right"===this.slideDirection?f.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&f.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),u.render();else if("single"===f.context.displayMode&&"pan"===u.viewerConfig.toolMode&&u.viewerConfig.enableSlide){const{scrollLeft:m,scrollTop:v}=this.context.viewService.getMaxScrollValue();Math.abs(g)>u.viewerConfig.startSlideThreshold&&!m&&!v&&(this.isSliding=!0,this.context.isSliding=!0,u.configService.updateConfig({displayMode:"slide"}))}}endHandler(l){if(!this.isStart)return;const{context:u}=this;this.context.formatTouches(l,!0);const f=u.getActiveTab(),{displayMode:g}=f.context;"slide"===g&&this.slide(f),this.isStart=!1}slide(l){let u,f=0,g=0,m=0,v=!1;const{viewerConfig:_}=this.context;this.slideDistance>=Math.max(l.context.viewportWidth*_.slideThresholdForPerspective,_.startSlideThreshold)?(g=l.context.viewportWidth,u=g-this.slideDistance,"left"===this.slideDirection?l.current!==l.total-1?(m=-this.slideDistance,f=-u/6):(g=0,u=this.slideDistance,v=!0,m=-this.slideDistance,f=u/6):0!==l.current?(m=this.slideDistance,f=u/6):(g=0,u=this.slideDistance,v=!0,m=this.slideDistance,f=-u/6)):(v=!0,g=0,u=this.slideDistance,"left"===this.slideDirection?(m=-this.slideDistance,f=u/6):(m=this.slideDistance,f=-u/6));const S=()=>{m+=f;const I=m>=0;if(Math.abs(m)>=g&&(m=g,I||(m*=-1)),l.setPosition({x:m+this.tabX,y:this.tabY,z:0}),Math.abs(m)===g)return v||(this.context.viewer.gotoPage("right"===this.slideDirection?l.current-1:l.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(S),this.context.render()};this.slideRAF=requestAnimationFrame(S)}}class gPe extends rr{constructor(l){super(),N(this,"context",void 0),this.context=l}handleOptimizationEvents(){this.context.hooks.afterRender.on(l=>{this.optimizeTab(l)})}dispose(){super.dispose(),this.context=null}optimizeTab(l){this.context.viewerConfig.enableOptimizePage&&l.pages.forEach((u,f)=>{!ir()&&!u.isOptimized&&u.isVisible&&u.isLoaded&&u.zoom<1&&setTimeout(()=>{!u.isOptimized&&u.isVisible&&u.isLoaded&&u.zoom<1&&this.optimizePage(u.uid)},500)})}cancelOptimization(l){this.context.core.optimizationService.cancel(l)}optimizePage(l){if(!this.context)return;const{context:u}=this,{viewerConfig:f}=u;if(!f.enableOptimizePage)return;const g=u.getActiveTab();if(!g)return;const m=g.getPageByUid(l);if(!m||m.isOptimized||!m.isVisible||!m.isLoaded||m.optimizationUid===m.optimizedUid||u.isSliding||u.isDestroyed)return;const v=u.core.pageService.getPage(l);if(null==v||!v.display.img)return;const{img:_}=m.image.style;if(!_)return;const{naturalWidth:b,naturalHeight:S}=_;let I=b,k=S;const{maxOptimizationSize:O}=f;if(I>O||k>O||m.rWidth>O||m.rHeight>O)return;let j=0,W=0,J=0,K=0,Q=0;({rWidth:I,rHeight:k,cropLeft:j,cropTop:W,cropWidth:J,cropHeight:K,rotation:Q}=v.getEditResultForPixel());const ie=Kn(v.mediaBox.left,Vn.displayResolution,v.resource.resolutionX),oe=Kn(v.mediaBox.top,Vn.displayResolution,v.resource.resolutionX),le=new Ev({style:{x:-j+ie,y:-W+oe,img:_,width:b,height:S}});let he="rgba(0,0,0,0)";if(f.enableFillColor)he=f.blankFillColor;else if(f.viewerMode===qo.THUMBNAIL){let V=f.pageStyle;m.isSelected?V=f.selectedPageStyle:m.isHovered&&(V=f.hoveredPageStyle),he=V.background}const _e=new ps({style:{x:-(J-I)/2,y:-(K-k)/2,width:J,height:K,background:he}});_e.appendChild(le),_e.setLocalAngle(Q);const{commonCanvas:Ve}=u.core;Ve.render(_e,I,k),Ve.reset();const ee=Ve.getCanvas(),ke=devicePixelRatio,xe=Math.floor(m.realTimeBox.width*ke+.5)||1,Le=Math.floor(m.realTimeBox.height*ke+.5)||1;m.isOptimized=!0,u.core.optimizationService.optimize(ee,I,k,xe,Le,m.optimizationUid).then(V=>{if(!u.isDestroyed&&V.taskUid===m.optimizationUid){m.isOptimized=!0,m.optimizedUid=m.optimizationUid;const F=ee.getContext("2d",{willReadFrequently:!0}).createImageData(xe,Le);F.data.set(V.target),m.realTimeBox.imageData=F,m.image.updateStyle({visibility:"hidden"}),m.isVisible&&u.render()}}).catch(V=>{m.isOptimized=!1})}}class mPe extends rr{constructor(l,u,f,g,m,v){super(),N(this,"context",void 0),N(this,"panModeInteraction",void 0),N(this,"cropModeInteraction",void 0),N(this,"annotationModeInteraction",void 0),N(this,"zoomInModeInteraction",void 0),N(this,"zoomOutModeInteraction",void 0),this.context=l,this.panModeInteraction=u,this.cropModeInteraction=f,this.annotationModeInteraction=g,this.zoomInModeInteraction=m,this.zoomOutModeInteraction=v}handleEvents(){if(this.context.isCaptureViewer)return;const l=this.context.rendererService.getCanvasDom();Xo(l,"pointerdown",this).on(u=>{if(0!==u.button)return;const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.pointerdownHandler(u),this.cropModeInteraction.pointerdownHandler(u),this.annotationModeInteraction.pointerdownHandler(u),this.zoomInModeInteraction.startHandler(u),this.zoomOutModeInteraction.startHandler(u))}),Xo(l,"pointermove",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.pointermoveHandler(u,!1),this.cropModeInteraction.pointermoveHandler(u),this.annotationModeInteraction.cursorHandler(u))},{passive:!1}),Xo(l,"pointerup",this).on(u=>{if(0!==u.button)return;const f=this.context.getActiveTab();null!=f&&f.total&&this.panModeInteraction.pointerupHandler(u)}),Xo(document,"pointerdown",this).on(u=>{}),Xo(document,"pointermove",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.pointermoveHandler(u,!0),this.annotationModeInteraction.pointermoveHandler(u))},{passive:!1}),Xo(document,"pointerup",this).on(u=>{if(0!==u.button)return;const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.pointerupHandler(u),this.cropModeInteraction.pointerupHandler(u),this.annotationModeInteraction.pointerupHandler(u),this.zoomInModeInteraction.endHandler(u),this.zoomOutModeInteraction.endHandler(u))}),Xo(l,"touchstart",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.touchstartHandler(u),this.cropModeInteraction.touchstartHandler(u))},{passive:!1}),Xo(l,"touchmove",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(u.cancelable&&u.preventDefault(),this.panModeInteraction.touchmoveHandler(u),this.cropModeInteraction.touchmoveHandler(u))},{passive:!1}),Xo(l,"touchend",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.touchendHandler(u),this.cropModeInteraction.touchendHandler(u))}),Xo(l,"wheel",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.wheelHandler(u),this.cropModeInteraction.wheelHandler(u),this.annotationModeInteraction.wheelHandler(u))},{passive:!1}),Xo(this.context.viewService.scrollContainer,"scroll",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.scrollHandler(u),this.cropModeInteraction.scrollHandler(u),this.annotationModeInteraction.scrollHandler(u))}),Xo(document,"keydown",this).on(u=>{if(!this.context.isFocused||!this.context.viewerConfig.enableKeyboardInteraction)return;const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.keydownHandler(u),this.cropModeInteraction.keydownHandler(u),this.annotationModeInteraction.keydownHandler(u),this.zoomInModeInteraction.keydownHandler(u),this.zoomOutModeInteraction.keydownHandler(u))}),Xo(document,"click",this).on(u=>{const f=this.context.rendererService.getCanvasDom();this.context.isFocused=u.target===f})}}class vPe extends rr{constructor(l){super(),N(this,"context",void 0),N(this,"isPointerdown",!1),N(this,"startPage",void 0),N(this,"mouseOverPage",void 0),this.context=l}startHandler(l){const{context:u}=this,{viewerConfig:f,styleService:g}=u,m=this.context.getActiveTab();if(null==m||!m.total)return;this.isPointerdown=!0;const[v]=u.formatTouches(l),{page:_}=u.getPointerOverPageInfo(v.pageX,v.pageY).pageInfo;if(!_||(this.startPage=_,l.ctrlKey))return;const b=m.getPageIndex(_),S=m.getCurrentPage(),I=l.shiftKey&&f.enableSelectWithShift;if(I&&m.selected.length){if(I&&S!==_&&m.shiftReference){const k=m.uidToIndex(m.shiftReference),O=Math.min(b,k),j=Math.max(b,k),W=[];for(let J=O;J<=j;J++)W.push(J);if(u.viewerConfig.enableOptimizePage){g.isSelectedBorderWidthEqualHovered()||u.clearOptimization([_.uid]),g.isSelectedBorderWidthEqualNormal()||W.forEach(K=>{const Q=m.getPageByIndex(O+K);m.selected.includes(Q.uid)||Q.uid===_.uid||g.isSelectedBorderWidthEqualNormal()||u.clearOptimization([Q.uid])});const J=m.indicesToUids(W);g.isSelectedBorderWidthEqualNormal()||m.selected.forEach(K=>{if(!J.includes(K)){const Q=m.getPageByUid(K);Q&&u.clearOptimization([Q.uid])}})}b>k&&W.reverse(),u.viewer.gotoPage(b),u.viewer.selectPagesByIndices(W)}}else f.multiselectMode||(_.uid!==m.currentUid&&u.viewer.gotoPage(b),_.isSelected||(u.viewerConfig.enableOptimizePage&&(g.isSelectedBorderWidthEqualNormal()||m.selected.forEach(k=>{const O=m.getPageByUid(k);O&&u.clearOptimization([O.uid])}),g.isSelectedBorderWidthEqualHovered()||u.clearOptimization([_.uid])),u.viewer.selectPagesByIndices([b])))}moveHandler(l){const{context:u}=this,{styleService:f}=u,g=u.getActiveTab();if(null==g||!g.total)return;const[m]=u.formatTouches(l),v=u.getPointerOverPageInfo(m.pageX,m.pageY),{page:_}=v.pageInfo,{mouseOverPage:b}=this;u.viewerConfig.enableOptimizePage&&!f.isBorderWidthEqualHovered()&&(b&&!b.isSelected&&(_&&b===_||u.clearOptimization([b.uid])),_&&!_.isSelected&&(b&&b===_||u.clearOptimization([_.uid]))),this.mouseOverPage=_;let S=!1;"mouse"===l.pointerType&&g.pages.forEach(I=>{_&&_.uid===I.uid?(I.isHovered||(S=!0),I.isHovered=!0):(I.isHovered&&(S=!0),I.isHovered=!1)}),S&&(u.layoutService.layout(g),u.visibilityService.handleVisibility(g),u.rendererService.render(g))}endHandler(l){if(!this.isPointerdown)return;const{context:u}=this,{styleService:f}=u,[g]=u.formatTouches(l,!0),m=u.getActiveTab();if(null==m||!m.total)return;const v=u.getPointerOverPageInfo(g.pageX,g.pageY).pageInfo.page;if(v&&v===this.startPage&&!l.shiftKey)if(l.ctrlKey&&u.viewerConfig.enableSelectWithCtrl||u.viewerConfig.multiselectMode){const _=m.selected.slice(),b=_.indexOf(v.uid);v.isSelected?_.splice(b,1):_.push(v.uid);const S=m.uidsToIndices(_);if(v.uid!==m.currentUid){const I=m.uidToIndex(v.uid);u.viewer.gotoPage(I)}!f.isSelectedBorderWidthEqualHovered()&&u.viewerConfig.enableOptimizePage&&u.clearOptimization([v.uid]),u.viewer.selectPagesByIndices(S)}else if(!l.ctrlKey&&!l.shiftKey){const _=m.getPageIndex(v);v.uid!==m.currentUid&&u.viewer.gotoPage(_),u.viewerConfig.enableOptimizePage&&(f.isSelectedBorderWidthEqualNormal()||m.selected.forEach(b=>{const S=m.getPageByUid(b);S&&u.clearOptimization([S.uid])}),f.isSelectedBorderWidthEqualHovered()||u.clearOptimization([v.uid])),u.viewer.selectPagesByIndices([_])}this.isPointerdown=!1,this.startPage=null}keydownHandler(l){}}class yPe extends rr{constructor(l){super(),N(this,"context",void 0),this.context=l}undoHandler(l){l.ctrlKey&&this.context.viewerConfig.enableUndoWidthKeyboard&&(l.preventDefault(),this.context.viewer.undo())}redoHandler(l){l.ctrlKey&&this.context.viewerConfig.enableUndoWidthKeyboard&&(l.preventDefault(),this.context.viewer.redo())}zoomInHandler(l){l.ctrlKey&&this.context.viewerConfig.enableZoomInWidthKeyboard&&(l.preventDefault(),this.context.viewer.zoomIn())}zoomOutHandler(l){l.ctrlKey&&this.context.viewerConfig.enableZoomOutWidthKeyboard&&(l.preventDefault(),this.context.viewer.zoomOut())}arrowLeftHandler(l){}arrowRightHandler(l){}arrowUpHandler(l){}arrowDownHandler(l){}escapeHandler(l){}enterHandler(l){}pageUpHandler(l){}pageDownHandler(l){}homeHandler(l){}endHandler(l){}scrollHandler(l){}selectPageHandler(l){}}class _Pe{constructor(l){N(this,"context",void 0),N(this,"isEditAnnotation",!1),N(this,"isMove",!1),N(this,"isSlide",!1),N(this,"isActivateAnnotation",!1),N(this,"isTouchstart",!1),N(this,"isPointerdown",!1),N(this,"isFirstMove",!0),N(this,"isPointerOnAnnotation",!1),N(this,"isAnnotationActive",!1),N(this,"activeShape",void 0),N(this,"pointerNum",0),N(this,"startPoint",void 0),N(this,"dragTimer",void 0),N(this,"isDragPages",!1),N(this,"isMoveForThumbnail",!1),N(this,"isMoved",!1),N(this,"keyboardHandlerMapForDefault",void 0),N(this,"keyboardHandlerMapForThumbnail",void 0),N(this,"canScroll",!0),N(this,"startX",void 0),N(this,"startY",void 0),this.context=l}get isPanMode(){return"pan"===this.context.viewerConfig.toolMode}pointerdownHandler(l){if(this.isPointerdown||!this.isPanMode)return;const u=this.context.getActiveTab();if(null==u||!u.total||"slide"===this.context.viewerConfig.displayMode)return;const{isDefaultViewer:f,isThumbnailViewer:g,viewService:m,hasAnnotationModule:v,annotationEditService:_,selectPagesService:b,moveService:S,dragService:I,slideService:k,viewerConfig:{dragStartTimeThreshold:O,enableSlide:j,enableDragPage:W}}=this.context,{displayMode:J}=u.context;if(this.isPointerdown=!0,this.isFirstMove=!0,f){const{scrollLeft:K,scrollTop:Q}=m.getMaxScrollValue();if(v){const[ie]=this.context.formatTouches(l),{page:oe}=this.context.getPointerOverPageInfo(ie.pageX,ie.pageY).pageInfo;if(this.startPoint={x:ie.pageX,y:ie.pageY},oe){let{x:Ve,y:ee}=oe.cropBox.getPosition(),{width:ke,height:xe}=oe.cropBox;const Le=(oe.rotation%360+360)%360/90;if(1===Le?Ve-=xe:2===Le?(Ve-=ke,ee-=xe):3===Le&&(ee-=ke),1===Le||3===Le){const V=ke;ke=xe,xe=V}_.setAnnotationContainer(oe),_.setAnnotationInteractionArea({x:Ve,y:ee,width:ke,height:xe})}const{isHit:le,shape:he,isHitSelected:_e}=this.context.annotationEditService.isHitAnnotation(l);le&&oe?(this.activeShape=he,this.isPointerOnAnnotation=!0,"touch"===l.pointerType||"pen"===l.pointerType?_e?(this.isAnnotationActive=!0,this.isEditAnnotation=!0,_.startHandler(l,!1)):this.isActivateAnnotation=!0:"mouse"===l.pointerType&&(this.isAnnotationActive=!0,this.isEditAnnotation=!0,_.startHandler(l,!0)),_.hasActiveAnnotation()&&(this.canScroll=!1)):_.deactivateAnnotation()}this.isPointerOnAnnotation||(K||Q?(this.isMove=!0,this.isSlide=!1,S.startHandler(l)):"single"===J&&j&&(this.isMove=!1,this.isSlide=!0,k.startHandler(l)))}else if(g){b.startHandler(l);const[K]=this.context.formatTouches(l),{page:Q}=this.context.getPointerOverPageInfo(K.pageX,K.pageY).pageInfo;Q&&!l.ctrlKey?"touch"===l.pointerType||"pen"===l.pointerType?(W?this.dragTimer=setTimeout(()=>{this.isMoveForThumbnail||(this.isDragPages=!0,I.startHandler(l))},O):(this.isMoveForThumbnail=!0,S.startHandler(l)),this.startX=l.pageX,this.startY=l.pageY):"mouse"===l.pointerType&&(W?(this.isDragPages=!0,I.startHandler(l)):(this.isMoveForThumbnail=!0,S.startHandler(l))):(this.isMoveForThumbnail=!0,S.startHandler(l))}}pointermoveHandler(l,u){if(this.pointerNum>1)return;const f=this.context.getActiveTab();if(null==f||!f.total)return;const{isDefaultViewer:g,isThumbnailViewer:m,viewService:v,moveService:_,slideService:b,annotationEditService:S,dragService:I,selectPagesService:k}=this.context,{displayMode:O}=f.context;if(g&&!u&&this.isPointerdown){if(this.isPointerOnAnnotation&&!this.isAnnotationActive&&this.isFirstMove){const[j]=this.context.formatTouches(l);Og(this.startPoint,{x:j.pageX,y:j.pageY})>1&&(this.isActivateAnnotation=!1);const{scrollLeft:W,scrollTop:J}=v.getMaxScrollValue();W||J?(this.isMove=!0,this.isSlide=!1,_.startHandler(l)):"single"===O&&(this.isMove=!1,this.isSlide=!0,b.startHandler(l))}if(this.isEditAnnotation){const[j]=this.context.formatTouches(l),{page:W}=this.context.getPointerOverPageInfo(j.pageX,j.pageY).pageInfo;S.moveHandler(l,!W)}else this.isMove?_.moveHandler(l):this.isSlide&&b.moveHandler(l);this.isFirstMove=!1}else if(m&&u)if(k.moveHandler(l),"touch"===l.pointerType){const j=Og({x:this.startX,y:this.startY},{x:l.pageX,y:l.pageY});this.isPointerdown&&this.dragTimer&&(this.isDragPages||_.startHandler(l),j>5&&(clearTimeout(this.dragTimer),this.dragTimer=null)),this.isDragPages?(this.isMoved=!0,I.moveHandler(l)):!this.isDragPages&&this.isPointerdown&&(j>5&&(this.isMoveForThumbnail=!0,_.moveHandler(l)),this.isMoved=!0)}else this.isPointerdown&&this.dragTimer&&(this.isDragPages||_.startHandler(l),clearTimeout(this.dragTimer),this.dragTimer=null),this.isDragPages?(this.isMoved=!0,I.moveHandler(l)):!this.isDragPages&&this.isPointerdown&&(this.isMoveForThumbnail=!0,_.moveHandler(l),this.isMoved=!0)}pointerupHandler(l){if(!this.isPointerdown)return;const{isDefaultViewer:u,isThumbnailViewer:f,annotationEditService:g,moveService:m,slideService:v,dragService:_,selectPagesService:b}=this.context;if(u)this.isEditAnnotation?g.endHandler(l):this.isActivateAnnotation?(g.activateAnnotation(this.activeShape,l.ctrlKey),this.context.render()):this.isMove?m.endHandler(l):this.isSlide&&v.endHandler(l);else if(f){this.dragTimer&&(clearTimeout(this.dragTimer),this.dragTimer=null);const S=Og({x:this.startX,y:this.startY},{x:l.pageX,y:l.pageY});(!this.isMoved||S<5)&&b.endHandler(l),this.isDragPages?_.endHandler(l):m.endHandler(l)}this.isPointerdown=!1,this.isFirstMove=!0,this.isEditAnnotation=!1,this.isMove=!1,this.isSlide=!1,this.isActivateAnnotation=!1,this.isPointerOnAnnotation=!1,this.isAnnotationActive=!1,this.activeShape=null,this.isMoveForThumbnail=!1,this.isDragPages=!1,this.isMoved=!1,this.canScroll=!0,this.startPoint=null}touchstartHandler(l){if(this.pointerNum=l.targetTouches.length,this.context.isDefaultViewer){const{enableZoom:u,enableZoomInPanMode:f,enableZoomWithTouch:g}=this.context.viewerConfig;if(!this.isPanMode||2!==l.targetTouches.length||this.isTouchstart||!u||!g||!f)return;this.isTouchstart=!0,this.context.zoomService.touchstartHandler(l)}}touchmoveHandler(l){this.pointerNum=l.targetTouches.length,2===l.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(l)}touchendHandler(l){this.pointerNum=l.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(l))}wheelHandler(l){if(this.pointerNum=0,!this.isPanMode)return;if(!this.canScroll)return void l.preventDefault();const{isDefaultViewer:u,isThumbnailViewer:f,viewerConfig:{enableZoom:g,enableZoomInPanMode:m,enableZoomWithCtrl:v},zoomService:_,scrollService:b}=this.context;if(u)if(l.ctrlKey){if(!g||!m||!v)return;_.wheelHandler(l)}else b.wheelHandler(l);else f&&b.wheelHandler(l)}scrollHandler(l){this.isPanMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(l)}keydownHandler(l){if(!this.isPanMode)return;const{context:u,context:{keyboardService:f,annotationEditService:g,viewerConfig:{enableKeyboardInteraction:m,enableZoom:v,enableZoomInPanMode:_,enableZoomOutWidthKeyboard:b,enableZoomInWidthKeyboard:S,enableCopyCutPasteWidthKeyboard:I,enableUndoWidthKeyboard:k,enableRedoWidthKeyboard:O},hasAnnotationModule:W}}=this;if(!m)return;const J=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];if(u.isDefaultViewer){let K=this.keyboardHandlerMapForDefault;if(K||(K={c:Q=>{I&&g.copyAnnotations()},x:Q=>{I&&g.cutAnnotations()},v:Q=>{I&&g.pasteAnnotations()},y:Q=>{O&&f.redoHandler(Q)},z:Q=>{k&&f.undoHandler(Q)},"-":Q=>{v&&_&&b&&f.zoomOutHandler(Q)},"=":Q=>{v&&_&&S&&f.zoomInHandler(Q)},Escape:Q=>{f.escapeHandler(Q)},Enter:Q=>{f.enterHandler(Q)},PageUp:Q=>{f.pageUpHandler(Q)},PageDown:Q=>{f.pageDownHandler(Q)},Home:Q=>{f.homeHandler(Q)},End:Q=>{f.endHandler(Q)}},this.keyboardHandlerMapForDefault=K),l.ctrlKey){const Q=K[l.key];Q&&l.ctrlKey?Q(l):J.includes(l.key)&&(W&&g.hasActiveAnnotation()?g.moveAnnotationByKeyboard(l):f.scrollHandler(l))}}else if(u.isThumbnailViewer){let K=this.keyboardHandlerMapForThumbnail;K||(K={PageUp:ie=>{f.pageUpHandler(ie)},PageDown:ie=>{f.pageDownHandler(ie)},Home:ie=>{f.homeHandler(ie)},End:ie=>{f.endHandler(ie)}},this.keyboardHandlerMapForThumbnail=K);const Q=K[l.key];Q?Q(l):J.includes(l.key)&&u.selectPagesService.keydownHandler(l)}}}class CPe{constructor(l){N(this,"context",void 0),N(this,"isEditCropBox",!1),N(this,"isPerspectiveQuad",!1),N(this,"isTouchstart",!1),N(this,"isPointerdown",!1),N(this,"pointerNum",0),N(this,"keyboardHandlerMap",void 0),this.context=l}get isCropMode(){return"crop"===this.context.viewerConfig.toolMode}pointerdownHandler(l){if(this.isPointerdown||!this.isCropMode)return;this.isPointerdown=!0;const{context:u}=this;u.hasBoxRendererModule?u.isDefaultViewer?(this.isEditCropBox=u.cropBoxEditService.isEditCropBox(l),this.isEditCropBox?u.cropBoxEditService.startHandler(l):u.moveService.startHandler(l)):u.isPerspectiveViewer&&(this.isPerspectiveQuad=!0,u.perspectiveQuadEditService.startHandler(l)):u.isDefaultViewer&&u.moveService.startHandler(l)}pointermoveHandler(l){if(this.pointerNum>1)return;const{context:u}=this;u.isDefaultViewer?(u.cropBoxEditService.moveHandler(l),!this.isEditCropBox&&this.isPointerdown&&u.moveService.moveHandler(l)):u.isPerspectiveViewer&&u.perspectiveQuadEditService.moveHandler(l)}pointerupHandler(l){if(!this.isPointerdown)return;const{context:u}=this;u.isDefaultViewer?this.isEditCropBox?u.cropBoxEditService.endHandler(l):u.moveService.endHandler(l):u.isPerspectiveViewer&&this.isPerspectiveQuad&&u.perspectiveQuadEditService.endHandler(l),this.isPointerdown=!1,this.isEditCropBox=!1,this.isPerspectiveQuad=!1}touchstartHandler(l){this.pointerNum=l.targetTouches.length;const{context:u,context:{viewerConfig:f}}=this;if(u.isDefaultViewer){if(!this.isCropMode||2!==l.targetTouches.length||this.isTouchstart||!f.enableZoom||!f.enableZoomWithTouch||!f.enableZoomInCropMode)return;this.isTouchstart=!0,u.zoomService.touchstartHandler(l)}}touchmoveHandler(l){this.pointerNum=l.targetTouches.length,2===l.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(l)}touchendHandler(l){this.pointerNum=l.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(l))}wheelHandler(l){if(this.pointerNum=0,!this.isCropMode)return;const{context:u,context:{viewerConfig:f}}=this;if(u.isDefaultViewer)if(l.ctrlKey){if(!f.enableZoom||!f.enableZoomInCropMode||!f.enableZoomWithCtrl)return;u.zoomService.wheelHandler(l)}else u.scrollService.wheelHandler(l)}scrollHandler(l){if(!this.isCropMode)return;const{context:u}=this;(u.isDefaultViewer||u.isThumbnailViewer)&&u.scrollService.scrollHandler(l)}keydownHandler(l){if(!this.isCropMode)return;const{keyboardService:u,isDefaultViewer:f,viewerConfig:{enableKeyboardInteraction:g,enableZoom:m,enableZoomInCropMode:v,enableZoomOutWidthKeyboard:_,enableZoomInWidthKeyboard:b,enableUndoWidthKeyboard:S,enableRedoWidthKeyboard:I}}=this.context;if(!f||!g||!l.ctrlKey)return;let k=this.keyboardHandlerMap;k||(k={y:j=>{I&&u.redoHandler(j)},z:j=>{S&&u.undoHandler(j)},"-":j=>{m&&v&&_&&u.zoomOutHandler(j)},"=":j=>{m&&v&&b&&u.zoomInHandler(j)},Escape:j=>{u.escapeHandler(j)},Enter:j=>{u.enterHandler(j)},PageUp:j=>{u.pageUpHandler(j)},PageDown:j=>{u.pageDownHandler(j)}},this.keyboardHandlerMap=k);const O=k[l.key];O?O(l):["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(l.key)&&u.scrollHandler(l)}}class bPe{constructor(l){N(this,"context",void 0),N(this,"isPointerdown",!1),N(this,"pointerId",null),N(this,"keyboardHandlerMapForDefault",void 0),N(this,"canScroll",!0),this.context=l}get isAnnotationMode(){return"annotation"===this.context.viewerConfig.toolMode}pointerdownHandler(l){if(!this.isPointerdown&&this.isAnnotationMode&&!this.pointerId&&(this.pointerId=l.pointerId,this.context.hasBoxRendererModule&&this.context.isDefaultViewer)){const[u]=this.context.formatTouches(l),{page:f}=this.context.getPointerOverPageInfo(u.pageX,u.pageY).pageInfo;if(f){let{x:g,y:m}=f.cropBox.getPosition(),{width:v,height:_}=f.cropBox;const b=360,S=(f.rotation%b+b)%b/90;if(1===S?g-=_:2===S?(g-=v,m-=_):3===S&&(m-=v),1===S||3===S){const I=v;v=_,_=I}this.context.annotationEditService.setAnnotationContainer(f),this.context.annotationEditService.setAnnotationInteractionArea({x:g,y:m,width:v,height:_})}this.isPointerdown=!0,this.context.annotationEditService.startHandler(l,!0),this.context.annotationEditService.hasActiveAnnotation()&&(this.canScroll=!1)}}pointermoveHandler(l){if((this.pointerId===l.pointerId||"touch"!==l.pointerType)&&this.context.isDefaultViewer){const[u]=this.context.formatTouches(l),{page:f}=this.context.getPointerOverPageInfo(u.pageX,u.pageY).pageInfo;this.context.annotationEditService.moveHandler(l,!f)}}cursorHandler(l){if("mouse"===(null==l?void 0:l.pointerType)&&this.context.isDefaultViewer){const[u]=this.context.formatTouches(l),{page:f}=this.context.getPointerOverPageInfo(u.pageX,u.pageY).pageInfo;"crop"!==this.context.viewerConfig.toolMode&&this.context.annotationEditService.cursorHandler(l,!f,this.context.viewerConfig.canvasStyle.cursor)}}pointerupHandler(l){this.isPointerdown&&(this.context.isDefaultViewer&&this.context.annotationEditService.endHandler(l),this.isPointerdown=!1,this.canScroll=!0,this.pointerId=null)}wheelHandler(l){if(this.isAnnotationMode)if(this.canScroll){if(this.context.isDefaultViewer)if(l.ctrlKey){const{enableZoom:u,enableZoomInAnnotationMode:f,enableZoomWithCtrl:g}=this.context.viewerConfig;if(!(this.isAnnotationMode&&u&&f&&g))return;this.context.zoomService.wheelHandler(l)}else this.context.scrollService.wheelHandler(l)}else l.preventDefault()}scrollHandler(l){this.isAnnotationMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(l)}keydownHandler(l){if(!this.isAnnotationMode)return;const{context:{keyboardService:f,annotationEditService:g,viewerConfig:{enableKeyboardInteraction:m,enableZoom:v,enableZoomInAnnotationMode:_,enableZoomOutWidthKeyboard:b,enableZoomInWidthKeyboard:S,enableCopyCutPasteWidthKeyboard:I,enableUndoWidthKeyboard:k,enableRedoWidthKeyboard:O},hasAnnotationModule:j}}=this;if(!m)return;const W=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];if(this.context.isDefaultViewer){let J=this.keyboardHandlerMapForDefault;J||(J={c:Q=>{I&&g.copyAnnotations()},x:Q=>{I&&g.cutAnnotations()},v:Q=>{I&&g.pasteAnnotations()},y:Q=>{O&&f.redoHandler(Q)},z:Q=>{k&&f.undoHandler(Q)},"-":Q=>{v&&_&&b&&f.zoomOutHandler(Q)},"=":Q=>{v&&_&&S&&f.zoomInHandler(Q)},Escape:Q=>{f.escapeHandler(Q)},Enter:Q=>{f.enterHandler(Q)},PageUp:Q=>{f.pageUpHandler(Q)},PageDown:Q=>{f.pageDownHandler(Q)},Home:Q=>{f.homeHandler(Q)},End:Q=>{f.endHandler(Q)}},this.keyboardHandlerMapForDefault=J);const K=J[l.key];K&&l.ctrlKey?K(l):W.includes(l.key)&&(j&&g.hasActiveAnnotation()?g.moveAnnotationByKeyboard(l):f.scrollHandler(l))}}}class xPe{constructor(l){N(this,"context",void 0),N(this,"isPointerdown",!1),this.context=l}get isZoomInMode(){return"zoomIn"===this.context.viewerConfig.toolMode}startHandler(l){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(l),this.isPointerdown=!0)}endHandler(l){this.isPointerdown&&(this.isPointerdown=!1)}keydownHandler(l){if(!this.isZoomInMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:u}}=this;u.enableKeyboardInteraction&&u.enableZoom&&u.enableZoomInWidthKeyboard&&l.ctrlKey&&"="===l.key&&this.context.keyboardService.zoomInHandler(l)}}class wPe{constructor(l){N(this,"context",void 0),N(this,"isPointerdown",!1),this.context=l}get isZoomOutMode(){return"zoomOut"===this.context.viewerConfig.toolMode}startHandler(l){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(l),this.isPointerdown=!0)}endHandler(l){this.isPointerdown&&(this.isPointerdown=!1)}keydownHandler(l){if(!this.isZoomOutMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:u}}=this;u.enableKeyboardInteraction&&u.enableZoom&&u.enableZoomOutWidthKeyboard&&l.ctrlKey&&"-"===l.key&&this.context.keyboardService.zoomInHandler(l)}}class SPe extends rr{constructor(l,u){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),N(this,"core",void 0),N(this,"viewer",void 0),N(this,"uid",void 0),N(this,"groupUid",void 0),N(this,"hooks",void 0),N(this,"viewService",void 0),N(this,"rendererService",void 0),N(this,"tabService",void 0),N(this,"layoutService",void 0),N(this,"styleService",void 0),N(this,"configService",void 0),N(this,"visibilityService",void 0),N(this,"annotationEditService",void 0),N(this,"cropBoxEditService",void 0),N(this,"perspectiveQuadEditService",void 0),N(this,"eventsService",void 0),N(this,"dragService",void 0),N(this,"moveService",void 0),N(this,"scrollService",void 0),N(this,"zoomService",void 0),N(this,"slideService",void 0),N(this,"optimizationService",void 0),N(this,"interactionService",void 0),N(this,"selectPagesService",void 0),N(this,"keyboardService",void 0),N(this,"viewerConfig",hn(MAe)),N(this,"postfix",void 0),N(this,"isDestroyed",!1),N(this,"viewportWidth",0),N(this,"viewportHeight",0),N(this,"scrollByCurrentChanged",!1),N(this,"isInitialized",!1),N(this,"addPagesTimer",null),N(this,"isPanning",void 0),N(this,"isZooming",void 0),N(this,"isSliding",void 0),N(this,"isLoadSource",!1),N(this,"isFocused",!1),N(this,"hasBoxRendererModule",!1),N(this,"hasAnnotationModule",!1),this.core=l,this.viewer=u,this.postfix=u.postfix,this.hooks=u.hooks,this.uid=u.uid,this.groupUid=u.groupUid,yo(f,this.viewerConfig),this.styleService=new UAe(this),this.viewService=this.register(new JAe(this,this.hooks)),this.rendererService=this.register(new tPe(this,this.hooks)),this.layoutService=new sPe(this,this.hooks),this.configService=this.register(new lPe(this)),this.tabService=this.register(new WAe(this)),this.visibilityService=new GAe(this),this.optimizationService=this.register(new gPe(this)),this.handleViewerModeChanged(),this.eventsService=this.register(new cPe(this)),this.dragService=this.register(new uPe(this)),this.moveService=this.register(new dPe(this)),this.scrollService=this.register(new hPe(this)),this.zoomService=this.register(new fPe(this)),this.slideService=this.register(new pPe(this)),this.interactionService=this.register(new mPe(this,new _Pe(this),new CPe(this),new bPe(this),new xPe(this),new wPe(this))),this.selectPagesService=this.register(new vPe(this)),this.keyboardService=this.register(new yPe(this)),this.eventsService.handleExternalEvents(),this.optimizationService.handleOptimizationEvents(),this.interactionService.handleEvents()}get isCropToolMode(){throw new Error("Method not implemented.")}get isVisible(){var l;return"visible"===(null===(l=this.viewerConfig)||void 0===l?void 0:l.visibility)}syncViewer(l){const u=l.getActiveTab();if(!u)return;const f=this.tabService.createTab(u.doc);if(f.isDocType){const{width:g,height:m}=this.viewService.getViewportSize();f.updateViewportSize(g,m)}f.currentUid=u.currentUid,f.selectPages([...u.selected]),this.tabService.activateTab(f.uid),this.hooks.syncDocument.emit(f.doc),this.emitPageChangedEvent(f),this.showTab(f),this.emitPageChangedAfterRenderEvent(f)}formatTouches(l){const u=[];let f=null;f=l instanceof MouseEvent||l instanceof PointerEvent?[l]:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?l.changedTouches:l.touches;const{x:g,y:m}=this.rendererService.getCanvasPosition();for(let v=0;v<f.length;v++){const _=f[v];u.push({pageX:_.pageX-g,pageY:_.pageY-m})}return u}getPointerOverPageInfo(l,u){return function(g,m,v){const _={pageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},imageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},index:-1};if(g)for(let b=0;b<g.pages.length;b++){const S=g.pages[b],I=QZ(S,m,v,S.isVisible);if(I.isOver){_.index=b,Object.assign(_.pageInfo,I);const k=QZ(S.image,m,v,!0);return k.isOver&&Object.assign(_.imageInfo,k),_}}return _}(this.getActiveTab(),l,u)}resize(){if(this.tabService.resizeScrollbar(),this.isCaptureViewer)return;this.viewService.resizeViewport(),this.updateViewportSize(),this.rendererService.updateCanvasSize(),this.styleService.isCheckboxStyleChanged=!0,this.styleService.isPageNumberStyleChanged=!0;const l=this.getActiveTab();l&&this.showTab(l,!0)}updateViewportSize(){const{width:l,height:u}=this.viewService.getViewportSize();this.viewportWidth=l,this.viewportHeight=u,this.tabService.updateViewportSize(l,u)}handleViewerModeChanged(){const{postfix:l,viewService:u,isDefaultViewer:f,isPerspectiveViewer:g,isThumbnailViewer:m}=this;if(f||g||m){u.createMainAndThbContainer(l),u.createMainContainer(l),m||u.createThumbnailContainer(l),f&&(u.createVideoContainer(l),u.createAudioContainer(l)),AF(u.mainAndThbContainer,"flex");const{width:v,height:_}=u.getViewportSize();this.rendererService.initRenderer(u.canvasContainer,v,_),this.rendererService.updateCanvasSize()}}loadSource(l){const u=this.getActiveTab();let f=null==u?void 0:u.uid;if(!u){const g=this.core.createDocument({name:NZ(),type:"document"});this.viewer.openDocument(g),f=g.uid}return this.core.loadSource(l,f,{exception:"ignore"})}openDocument(l){const{tabService:u}=this;let f=u.getTab(l.uid);if(!f){const g=u.getActiveTab();if(g&&this.hooks.closeDocument.emit(g.doc),f=u.createTab(l),f.isDocType){const{width:m,height:v}=this.viewService.getViewportSize();f.updateViewportSize(m,v)}}f.isActive||(this.tabService.activateTab(f.uid),this.emitPageChangedEvent(f),this.showTab(f),this.hooks.openDocument.emit(l),this.emitPageChangedAfterRenderEvent(f))}closeTabs(l){const u=l.filter(m=>this.tabService.hasTab(m));if(!u.length)return;u.reduce((m,v,_)=>{const b=this.tabService.getTab(v);return b&&m.push(b),m},[]).forEach(m=>{m.isActive&&this.clearCurrentTabOptimization(),this.tabService.closeTab(m.uid),this.hooks.closeDocument.emit(m.doc)});const g=this.tabService.getActiveTab();g?this.showTab(g):(this.rendererService.docRenderer.clear(),this.resetCanvas(),this.hooks.pageChanged.emit(uw.create(-1,0)))}resetCanvas(){this.isCaptureViewer||(this.viewService.resetViewport(),this.rendererService.updateCanvasSize(),this.rendererService.clearCanvas())}render(){if("hidden"===this.viewerConfig.visibility||this.isDestroyed)return;const l=this.getActiveTab();l&&this.rendererService.render(l)}showCurrentTab(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=this.getActiveTab();null!=u&&u.total&&this.showTab(u,l)}showTab(l){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isDestroyed||l.isDestroyed||(this.tabService.activateTab(l.uid),"hidden"!==this.viewerConfig.visibility&&(this.isDefaultViewer?this.showTabDefault(l,u):this.isThumbnailViewer?this.showTabThumbnail(l,u):this.isPerspectiveViewer&&this.showTabPerspective(l)))}showTabDefault(l){const u=l;if(!u.isDocType)return;u.style.visibility="visible";const f=u.context.zoom;this.layoutService.layout(u),this.viewerConfig.zoom=u.context.zoom;const g=u.context.zoom!==f;if(this.viewService.updateScrollerContentSize(u),this.rendererService.updateCanvasSize(),!u.total)return void this.rendererService.render(u);const{scrollLeft:m,scrollTop:v}=u.context.parseReferenceDefault();u.context.setTabScrollValue(m,v),this.viewService.scrollTo(m,v),this.visibilityService.handleVisibility(u),this.loadVisiblePages(u),g&&this.clearCurrentTabOptimization(),this.rendererService.render(u),this.emitZoomChangedEvent(u)}showTabPerspective(l){const u=l;if(!u.isDocType)return;if(u.style.visibility="visible",this.layoutService.layout(u),this.viewService.updateScrollerContentSize(u),this.rendererService.updateCanvasSize(),!u.total)return void this.rendererService.render(u);const{scrollLeft:f,scrollTop:g}=u.context.parseReferenceDefault();u.context.setTabScrollValue(f,g),this.viewService.scrollTo(f,g),this.visibilityService.handleVisibility(u),this.loadVisiblePages(u),this.rendererService.render(u)}showTabThumbnail(l){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!l.isDocType)return;if(l.style.visibility="visible",this.layoutService.layout(l),this.viewService.updateScrollerContentSize(l),this.rendererService.updateCanvasSize(),!l.total)return void this.rendererService.render(l);if(l.isActive&&this.isVisible&&this.viewerConfig.autoScroll){const{scrollLeft:m,scrollTop:v}=l.context.getScrollValuesByCurrentChanged();l.context.setTabScrollValue(m,v)}const{scrollLeft:f,scrollTop:g}=l.context;this.viewService.scrollTo(f,g),this.visibilityService.handleVisibility(l),this.loadVisiblePages(l),u&&this.clearCurrentTabOptimization(),this.rendererService.render(l)}loadPageImage(l){return this.isDefaultViewer||this.isThumbnailViewer?this.core.imageLoadService.loadDisplayImage(l):this.isPerspectiveViewer?this.core.imageLoadService.loadRawImage(l):null}loadVisiblePages(l){if(l.isDestroyed||null==l||!l.total)return;const u=[],f=[],g=l.getCurrentPage();let m=!1;l.pages.forEach(_=>{!_.isPreload||_.isLoaded||_.isLoading||(_.uid===(null==g?void 0:g.uid)?m=!0:_.isVisible?f.push(_):_.isPreload&&u.push(_))});const v=[];m&&v.push(g),v.push(...u.reverse(),...f.reverse()),v.forEach(_=>{!_.isPreload||_.isLoaded||_.isLoading||(_.isLoading=!0,this.loadPageImage(_.uid).then(b=>{_.isLoading=!1,b&&this.renderPage(l,_,b)}).catch(b=>{_.isLoading=!1}))})}renderPage(l,u,f){if(!this.isDestroyed&&this.isVisible&&l.isActive&&l.pages.includes(u)&&!l.isDestroyed&&u.isPreload&&(u.isLoaded=!0,u.setImgDom(f),u.isVisible)){if(this.isDefaultViewer&&l.context.isSingleDisplay){const g=l.getCurrentPage();if(g&&!g.isLoaded)return}this.rendererService.render(l)}}emitPageChangedEvent(l){this.hooks.pageChanged.emit(uw.create(l.current,l.total))}emitPageChangedAfterRenderEvent(l){this.hooks.pageChangedAfterRender.emit(uw.create(l.current,l.total))}emitZoomChangedEvent(l){const{oldZoom:u,zoom:f}=l.context;this.hooks.zoomChanged.emit($5.create(j_(u),j_(f)))}beforeLoadSource(l){this.isLoadSource=!0;const{tabService:u}=this,f=u.getDocTab(l);f&&f.updateOldInfo()}afterLoadSource(l){this.isLoadSource=!1;const{tabService:u}=this,f=u.getDocTab(l);f&&(this.emitPageChangedEvent(f),this.emitPageChangedAfterRenderEvent(f),f.updateOldInfo())}addPages(l,u,f,g){const{tabService:m}=this,v=m.getDocTab(l);v&&(v.appendPages(u,f,g),this.emitPageChangedEvent(v),v.isActive&&!this.addPagesTimer&&(this.addPagesTimer=setTimeout(()=>{v.isActive&&(this.scrollByCurrentChanged=!0,this.showTab(v)),clearTimeout(this.addPagesTimer),this.addPagesTimer=null},200)))}deletePages(l,u){const{tabService:f}=this,g=f.getDocTab(l);g&&(this.clearOptimization(u),g.deletePages(u),this.hooks.deletePages.emit(dw.create(u)),this.emitEventsForTab(g))}deleteAllPages(l){const{tabService:u}=this,f=u.getDocTab(l);if(!f)return;const g=f.pages.map(m=>m.uid);this.clearOptimization(g),f.deleteAllPages(),this.hooks.deletePages.emit(dw.create(g)),this.emitEventsForTab(f)}setCurrentPage(l,u){const{tabService:f}=this,g=f.getDocTab(l);g&&g.current!==u&&(g.gotoPage(u),this.emitEventsForTab(g))}selectPages(l,u){const{tabService:f}=this,g=f.getDocTab(l);if(!g)return;const m=g.getSelected(),v=g.getSelectedIndices();let _=!1;if(v.length!==u.length)_=!0;else for(let S=0;S<u.length;S++)if(v[S]!==u[S]){_=!0;break}if(!_)return;const b=g.indicesToUids(u);if(g.selectPages(b),g.isActive){this.showTab(g);const S=z5.create(v,[...u],[...m],b);this.hooks.selectedPageChanged.emit(S),this.viewer.emit("selectedPagesChanged",S)}}movePages(l,u,f){const g=this.tabService.getDocTab(l);g&&(g.movePages(u,f),this.emitEventsForTab(g,this.isDefaultViewer))}switchPage(l,u,f){const g=this.tabService.getDocTab(l);g&&(g.switchPage(u,f),this.emitEventsForTab(g,this.isDefaultViewer))}reorderPages(l,u){const f=this.tabService.getDocTab(l);f&&(f.reorderPages(u),this.emitEventsForTab(f,this.isDefaultViewer))}emitEventsForTab(l,u){l.isActive&&(this.emitPageChangedEvent(l),this.scrollByCurrentChanged=!0,this.showTab(l,u),this.emitPageChangedAfterRenderEvent(l))}updatePage(l,u,f){const g=this.tabService.getTab(l);if(g&&g.isActive){const m=g.getPageByUid(u);m.isLoaded=!1,m.isLoading=!1,this.clearOptimization([u]),this.showTab(g)}}renameDoc(l,u){const{tabService:f}=this,g=f.getTab(l);g&&(g.rename(u),this.hooks.tabChanged.emit())}filter(l,u,f){if(this.isPerspectiveViewer||this.isCaptureViewer)return;const g=this.getActiveTab();g&&g.uid===l&&(u.forEach(m=>{const v=g.getPageByUid(m);v&&(v.isLoaded=!1)}),this.hooks.filterChanged.emit(M2.create(l,u,f)),this.loadVisiblePages(g),this.clearOptimization(u),this.rendererService.render(g))}activateTab(l){const u=this.tabService.getTab(l);return!!u&&(this.showTab(u),!0)}getActiveTab(){return this.tabService.getActiveTab()}dispose(){this.tabService.getAllTabs().forEach(l=>{const u=[];if(l.pages.forEach((f,g)=>{f.isPreload&&u.push({from:!0,to:!1,pageUid:f.uid,index:g})}),u.length){const f=N2.create(l.uid,this.uid,this.viewerConfig.viewerMode,u);this.core.viewerService.onPagePreloadChanged.emit(f)}}),this.isDestroyed=!0,this.hooks.destroy.emit(),super.dispose()}get isDefaultViewer(){return this.viewerConfig.viewerMode===qo.DEFAULT}get isThumbnailViewer(){return this.viewerConfig.viewerMode===qo.THUMBNAIL}get isPerspectiveViewer(){return this.viewerConfig.viewerMode===qo.PERSPECTIVE}get isCaptureViewer(){return this.viewerConfig.viewerMode===qo.CAPTURE}zoomTo(l,u,f){this.zoomService.zoomTo(l,u,f)}getPageRenderSize(l){const u=this.core.pageService.getPage(l);return this.isPerspectiveViewer?u.raw.getPageSize():u.mediaBox}emit(l,u){this.viewer.emit(l,u)}clearCurrentTabOptimization(){if(!this.viewerConfig.enableOptimizePage)return;const l=this.getActiveTab();if(l){const u=l.pages.map(f=>f.uid);this.clearOptimization(u)}}clearOptimization(l){const u=[],f=this.getActiveTab();f&&l.forEach(g=>{const m=f.getPageByUid(g);m&&(u.push(m.optimizationUid),m.clearOptimization())}),u.forEach(g=>{this.optimizationService.cancelOptimization(g)})}}class TPe extends rr{constructor(l){super(),N(this,"uid",void 0),N(this,"groupUid",void 0),N(this,"group",void 0),N(this,"postfix",void 0),N(this,"context",void 0),N(this,"emitter",void 0),N(this,"hooks",void 0),N(this,"core",void 0),N(this,"isDisposed",!1),this.emitter=new Bh,l.core&&(this.core=l.core),this.uid=Ai(),this.groupUid=l.groupUid,this.postfix=`-${this.uid}`,this.hooks=this.register(new YDe),this.context=new SPe(this.core,this,l.viewerConfig),l.container&&!l.uiConfig&&this.context.viewService.bindContainer(l.container),this.listenGlobalEvents()}listenGlobalEvents(){const{documentService:l,viewerService:u}=this.core,{context:f}=this;this.core.onBeforeLoadSource.on(g=>{let{docUid:m}=g;f.beforeLoadSource(m)},this),this.core.pageService.onUpdatePage.on(g=>{f.updatePage(g.docUid,g.pageUid,g.data),f.hooks.updatePage.emit(g)},this),l.onPagesAdded.on(g=>{f.afterLoadSource(g.docUid),f.hooks.addPagesToDoc.emit(g)},this),l.onAddPagesToDoc.on(g=>{const{group:m}=this;let{scrollToLatest:v}=m.config;pt(v)&&({scrollToLatest:v}=f.viewerConfig),f.addPages(g.docUid,g.pageUids,v,g.index)},this),l.onDeletePagesFromDoc.on(g=>{f.deletePages(g.docUid,g.pageUids)},this),l.onDeleteAllPagesFromDoc.on(g=>{f.deleteAllPages(g.docUid)},this),l.onMovePages.on(g=>{f.movePages(g.docUid,g.indices,g.insertBeforeIndex)},this),l.onSwitchPage.on(g=>{f.switchPage(g.docUid,g.one,g.another)},this),l.onReorderPages.on(g=>{f.reorderPages(g.docUid,g.indices)},this),l.onBeforeDeleteDocs.on(g=>{f.closeTabs(g.docUids)},this),l.onDocumentRenamed.on(g=>{f.renameDoc(g.docUid,g.newName)},this),l.onDocumentDeleted.on(g=>{f.closeTabs([g.docUid])},this),l.onOpenDocument.on(g=>{f.groupUid===g.groupUid&&f.openDocument(g.doc)},this),l.onCloseDocument.on(g=>{f.groupUid===g.groupUid&&f.closeTabs([g.doc.uid])},this),u.onGotoPage.on(g=>{f.groupUid===g.groupUid&&f.setCurrentPage(g.docUid,g.index)},this),u.onSelectPages.on(g=>{f.groupUid===g.groupUid&&f.selectPages(g.docUid,g.indices)},this),u.onResize.on(()=>{f.resize()},this),u.onCurrentChangedByScroll.on(g=>{f.groupUid===g.groupUid&&f.uid!==g.viewerUid&&f.setCurrentPage(g.docUid,g.current)},this),this.core.onFilterChanged.on(g=>{const m=f.getActiveTab();(null==m?void 0:m.uid)===g.docUid&&f.filter(g.docUid,g.pageUids,g.filterType)},this),this.core.commandService.onOperationsChanged.on(g=>{const m=f.getActiveTab();m?m.uid===g.docUid&&f.hooks.operationsChanged.emit(g):this.hooks.operationsChanged.emit({docUid:g.docUid,undo:0,redo:0})},this)}dispose(){this.isDisposed||(this.unbindContainer(),this.context.dispose(),this.context=null,this.isDisposed=!0,this.core.removeViewer(this),super.dispose())}undo(){const l=this.context.getActiveTab();return!!l&&this.core.commandService.undo(l.uid)}redo(){const l=this.context.getActiveTab();return!!l&&this.core.commandService.redo(l.uid)}getOperationState(){const l=this.context.getActiveTab();return l?this.core.commandService.getOperationState(l.uid):{undo:0,redo:0}}saveOperations(){const l=this.context.getActiveTab();return!!l&&this.core.commandService.saveOperations(l.uid)}setRowAndColumn(l,u){return this.context.configService.updateConfig({rows:l,columns:u}),!0}getRowAndColumn(){const l=this.context.getActiveTab();if(l)return{rows:l.context.rows,columns:l.context.columns};const{viewerConfig:u}=this.context;return{rows:u.rows||1,columns:u.columns||1}}on(l,u){this.emitter.on(l,u)}emit(l,u){this.emitter.emit(l,u)}off(l,u){this.emitter.off(l,u)}getViewerConfig(){return this.context.viewerConfig}updateViewerConfig(l){this.context.configService.updateConfig(l)}bindContainer(l){return this.context.viewService.bindContainer(l)}unbindContainer(){this.context.viewService.unbindContainer()}show(){this.updateViewerConfig({visibility:"visible"}),this.context.showCurrentTab()}hide(){this.updateViewerConfig({visibility:"hidden"})}render(){}resize(){this.context.resize()}indexToUid(l){const u=this.context.getActiveTab();return null==u?void 0:u.indexToUid(l)}uidToIndex(l){const u=this.context.getActiveTab();return u?u.uidToIndex(l):-1}getCurrentPageIndex(){const l=this.context.getActiveTab();return l?l.current:-1}getPageCounts(){const l=this.context.getActiveTab();return l?l.total:0}getCurrentPageUid(){var l;const u=this.context.getActiveTab();return null==u||null===(l=u.getCurrentPage())||void 0===l?void 0:l.uid}selectAllPages(){const l=this.getPageCounts();return this.selectPagesByIndices(Array.from(Array(l).keys()))}selectPagesByIndices(l){const u=this.context.getActiveTab();if(!u)return[];const f=u.indicesToUids(l);return this.core.viewerService.onSelectPages.emit(pF.create(u.uid,this.groupUid,this.uid,l)),[...f]}getSelectedPageIndices(){const l=this.context.getActiveTab();return l?l.getSelectedIndices():[]}gotoPage(l){const u=this.context.getActiveTab();return u?(l=Sr(l,0,u.total-1),u.current===l||this.core.viewerService.onGotoPage.emit(fF.create(u.uid,this.groupUid,this.uid,l)),l):-1}movePages(l,u){const f=this.context.getActiveTab();return!!f&&this.core.movePages(f.uid,l,u)}swapPages(l,u){const f=this.context.getActiveTab();return!!f&&this.core.swapPages(f.uid,l,u)}reorderPages(l){const u=this.context.getActiveTab();return!!u&&this.core.reorderPages(u.uid,l)}deletePages(l){const u=this.context.getActiveTab();if(!u||!l.every(g=>g>=0&&g<u.total))return!1;const f=u.indicesToUids(l);return this.core.deletePages(u.uid,f)}deleteAllPages(){const l=this.context.getActiveTab();return!!l&&this.core.deleteAllPages(l.uid)}openDocument(l){this.core.openDocument(l.uid,this.uid)}closeDocument(l){if(!l){const u=this.context.getActiveTab();if(!u)return;l=u.uid}this.core.closeDocument(l,this.uid)}printDocument(){}activateTab(l){var u;return(null===(u=this.context)||void 0===u?void 0:u.activateTab(l))||!1}getActiveTab(){var l;return(null===(l=this.context)||void 0===l?void 0:l.getActiveTab())||null}getAllTabs(){var l;return(null===(l=this.context)||void 0===l?void 0:l.tabService.getAllTabs())||[]}getRealPageSize(l){const u=this.context.getActiveTab();if(!u)return{width:0,height:0};pt(l)&&(l=u.current);const f=u.getPageByIndex(l);return{width:f.rWidth,height:f.rHeight}}getRealPixelSize(l){const u=this.context.getActiveTab();if(!u)return{width:0,height:0};pt(l)&&(l=u.current);const f=u.getPageByIndex(l),g=this.core.pageService.getPage(f.uid),{rWidth:m,rHeight:v}=g.getEditResultForPerspective();return{width:Kn(m,Vn.displayResolution,g.resource.resolutionX),height:Kn(v,Vn.displayResolution,g.resource.resolutionY)}}zoomIn(){const l=this.getActiveTab();if(!l||!l.isDocType)return;const{maxZoom:u}=this.getViewerConfig(),{zoom:f}=l.context;let g=ree(f,"in");(null===g||g>u)&&(g=u),this.updateViewerConfig({zoom:g})}zoomOut(){const l=this.getActiveTab();if(!l||!l.isDocType)return;const{minZoom:u}=this.getViewerConfig(),{zoom:f}=l.context;let g=ree(f,"out");(null===g||g<u)&&(g=u),this.updateViewerConfig({zoom:g})}filter(l,u){const f=this.context.getActiveTab();if(!f)return!1;const g=f.indicesToUids(l);return this.core.filterPages(f.uid,g,u),!1}perspectivePage(l,u){var f=this;return Fe(function*(){const g=f.context.getActiveTab();if(!g)return null;let m=g.currentUid;return pt(u)||(m=g.indexToUid(u)),l=Kn(l,f.context.core.pageService.getPage(m).resource.resolutionX,Vn.displayResolution),(yield f.core.perspectivePage(g.uid,m,l)).data})()}perspectiveAllPage(){const l=this.context.getActiveTab();if(!l)return;const u=[],f=[],g=[];l.pages.forEach((_,b)=>{_.isVisible?u.push(b):_.isPreload?f.push(b):g.push(b)});const m=[...u,...f,...g],{displayResolution:v}=Vn;for(let _=0;_<m.length;_++){const b=this.indexToUid(m[_]),S=this.context.core.pageService.getPage(b);if(S.isFull){let{width:I,height:k}=S.raw.getImageDetail();const O=Math.abs((S.rotation%360+360)%360);if(90===O||270===O){const W=I;I=k,k=W}this.context.core.perspectivePage(l.uid,b,Kn([[0,0],[I,0],[I,k],[0,k]],S.resolutionX,v))}else if(S.activeQuad&&S.activeQuad!==S.quad){const{width:I,height:k}=S.raw.getPageSize(),O=xF(S.activeQuad.flat(),S.rotation,I,k),j=B2(O);this.context.core.perspectivePage(l.uid,b,j)}}}getPerspectivePreviewImage(l,u,f,g){const m=this.context.getActiveTab();if(!m)return null;const v=m.getPageByIndex(l);if(!v)return null;const _=v.uid,{quadSelectionStyle:b}=this.getViewerConfig(),{borderColor:S}=Fx(b.border),I=function(k){const O=j=>{const W=j.toString(16);return 1===W.length?`0${W}`:W};if(k.startsWith("rgb")){const j=k.match(/(\d+)/g);if(3===j.length){const W=parseInt(j[0],10),J=parseInt(j[1],10),K=parseInt(j[2],10);return`#${O(W)}${O(J)}${O(K)}`}}return!k.startsWith("#")||7!==k.length&&4!==k.length?"#FE8E14":k}(S);return this.context.core.getPerspectivePreviewData(_,{width:u||200,height:f||200},{strokeColor:I.substring(1),lineWidth:g})}}function ree(p,l){const u=[.01,.0625,.125,.25,.333,.5,.667,.75,1,1.25,1.5,2,3,4,6,8,12,16,24,32,64];if("in"===l){for(let f=0;f<u.length;f++)if(u[f]>p)return u[f]}else for(let f=u.length-1;f>=0;f--)if(u[f]<p)return u[f];return null}class IPe extends rr{constructor(l){super(),N(this,"isDestroyed",!1),N(this,"viewers",new Map),N(this,"groups",new Map),N(this,"onGotoPage",void 0),N(this,"onSelectPages",void 0),N(this,"onCurrentChangedByScroll",void 0),N(this,"onResize",void 0),N(this,"onPagePreloadChanged",void 0),N(this,"onViewerCreated",void 0),N(this,"core",void 0),this.core=l,this.initEventEmitter()}initEventEmitter(){this.onGotoPage=Et(this),this.onSelectPages=Et(this),this.onCurrentChangedByScroll=Et(this),this.onResize=Et(this),this.onPagePreloadChanged=Et(this),this.onViewerCreated=Et(this)}reset(){for(const l of this.viewers.values())l.dispose();this.viewers.clear(),this.groups.clear()}destroy(){if(!this.isDestroyed){for(const l of this.viewers.values())l.dispose();this.viewers=null,this.groups=null,this.isDestroyed=!0}}createViewer(l,u){var f;const{groupUid:g}=u,m=this.groups.get(g)||new zDe(g);var v;pt(null===(f=u.viewerConfig)||void 0===f?void 0:f.scrollToLatest)||m.isSetScrollToLatest||(m.updateConfig({scrollToLatest:null===(v=u.viewerConfig)||void 0===v?void 0:v.scrollToLatest}),m.isSetScrollToLatest=!0),u.groupConfig&&m.updateConfig(u.groupConfig);const _=new l(u);_.group=m,m.viewerUids.add(_.uid),this.groups.set(g,m),this.viewers.set(_.uid,_);const b=this.getViewersByGroupUid(g);if(b.length>0){_.context.syncViewer(b[0]);const S=b[0].getActiveTab();S&&this.core.commandService.emitOperationsChanged(S.uid)}return this.onViewerCreated.emit(_F.create(_)),_}removeViewer(l){let u;if(u=xn(l)?this.getViewer(l):l,!u)return!1;const{uid:f,groupUid:g}=u,m=this.groups.get(g);return m&&(m.viewerUids.delete(f),m.viewerUids.size||this.groups.delete(g)),this.viewers.delete(u.uid),u.dispose(),!0}hasViewer(l){return this.viewers.has(l)}getViewer(l){return this.viewers.get(l)}getAllViewers(){return Array.from(this.viewers.values())}getViewersByViewerUid(l){const u=this.viewers.get(l);return this.getViewersByGroupUid(u.groupUid)}getViewersByGroupUid(l){return this.groups.has(l)?this.groups.get(l).getViewerUids().map(u=>this.viewers.get(u)):[]}hasGroup(l){return this.groups.has(l)}}const EPe={apply(p){p.viewerService=new IPe(p)},install(p){p.setClass("Viewer",TPe)}},DPe=/^<\/([^>]*)>/,APe=/^<([^\s>]+)[^>]*>/,PPe=/^<slot>.*<\/slot>/,RPe=/(:?[@\w-]+)\s*=\s*"(.*?)"/;function kF(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{template:u,data:f,components:g,injection:m}=p,v=oee(u,f,g,m,l),_=v.length;return _&&(v[0].cpInstance=p,v[_-1].cpInstance=p),v}function oee(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],m=p.trim();const v=[];function _(k){m=m.substring(k)}function b(k){let[O,j]=k;if(j){const W=function(Q){const ie={},oe=JJ(Q,RPe);return oe&&oe.forEach(le=>{let[,he,_e]=le;ie[he]=_e}),ie}(O),J=l[":for"];J&&(delete l[":for"],W[":for"]=J);const K={type:"start",name:j,data:l,attrs:W};v.push(K),(u[j]||f.components&&f.components[j])&&(K.cpOption={Component:u[j]||f.components[j],injection:f}),("input"===j||/\/>/.test(O))&&v.push({type:"end",name:j,data:l,attrs:{}})}}function S(k){let[,O]=k;O&&v.push({type:"end",name:O,attrs:{}})}function I(k){(k=k.trim())&&v.push({type:"text",name:k,attrs:{},data:l})}for(;m;){const k=m.indexOf("<");let O;if(0===k){const j=m.match(DPe);if(j){_(j[0].length),S(j);continue}const W=m.match(PPe);if(W){_(W[0].length),v.push(...g);continue}const J=m.match(APe);if(J&&J[0]!==J.input){_(J[0].length),b(J);continue}O=m}else O=k>0?m.substring(0,k):m;O&&(_(O.length),I(O))}return v}function V2(p){const{cpInstance:l,children:u}=p;l&&!l.isInserted&&(l.isInserted=!0,l.hooks.inserted.emit()),u.forEach(f=>{V2(f)})}function MF(p){const{cpInstance:l,children:u}=p;l&&l.hooks.destroyed.emit(p),u.forEach(f=>{MF(f)})}function OF(p){if(p){const{el:l,children:u}=p;if(function(f){const{cpInstance:g}=f;g&&(g.dispose(),g.hooks.beforeDestroyed.emit(f))}(p),l){const f=l.parentElement;f&&f.removeChild(l),l.vNode=null,p.el=null}return MF(p),p.text=null,p.parent=null,u.length&&u.forEach(f=>{OF(f)}),!0}return!1}class j2{constructor(l){N(this,"el",void 0),N(this,"tagName",void 0),N(this,"sel",""),N(this,"data",void 0),N(this,"children",void 0),N(this,"text",void 0),N(this,"key",void 0),N(this,"cpInstance",void 0),N(this,"cpOptions",void 0),N(this,"parent",void 0),this.createVNode(l)}renderDom(){if(this.el)return this.el;let l;if("FRAGMENT"===this.tagName)l=document.createDocumentFragment();else if("TEXT"===this.tagName){const u=function(f){let g="";return 0===(f=String(f)).length?"":(g=f.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"'),g)}(this.text);l=document.createTextNode(u)}else{l=document.createElement("IMAGE"===this.tagName?"IMG":this.tagName);for(const[u,f]of Object.entries(this.data))l.setAttribute(u,f)}return this.children.forEach(u=>{const f=u.renderDom();l.appendChild(f)}),l.vNode=this,this.el=l,function(u){const{cpInstance:f,el:g}=u;f&&(f.vNode=u,f.hooks.created.emit(g))}(this),l}patch(l){return function kPe(p,l){const u=p.el,f=u.parentNode;null!==f&&(l.el=l.renderDom(),YJ(l.el,u,f),function(v){let _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;_<=b;)OF(v[_]),_+=1}([p]));let g=-1;const m=p.parent;return null==m||m.children.forEach((v,_)=>{v===p&&(g=_)}),g>-1&&(m.children[g]=l,l.parent=m,p.el=null),l}(this,l)}destroy(){return OF(this)}createVNode(l){const{tagName:u,data:f={},children:g=[],el:m=null,key:v,text:_="",cpOptions:b,cpInstance:S}=l;let I=u;f.id&&(I+=`#${f.id}`),f.class&&(I+=`.${f.class}`),this.sel=I,this.data=f,this.tagName=u,this.children=g,this.el=m,this.key=v,this.text=_,this.cpInstance=S,this.cpOptions=b}}function H2(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const u=[],f=[];let g=[];return p.forEach(m=>{if("start"===m.type)u.push(m),f.push(g),g=[];else if("text"===m.type)g.push({type:"text",value:m.name,data:m.data});else if(m instanceof j2)g.push(m);else{let v=u.pop();for(;v.name!==m.name;)v=u.pop();if(v){const{name:_,cpInstance:b,attrs:S,cpOption:I,data:k}=v,O={type:"token",tagName:_,cpInstance:b,cpOption:I,attrs:S,data:k,children:g};g.forEach(j=>{j.parent=O}),g=f.pop(),g.push(O)}}}),l?g[0]:g}const MPe=/'.+'|\\".+\\"|[\w$.]+/g,OPe=/{{([^\s@}]+)}}/;function jv(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Di(p)){const f=[];return p.forEach(g=>{f.push(...G2(jv(g)))}),f}if(p instanceof j2)return p;if("token"===p.type){var u;const{tagName:f,attrs:g,cpInstance:m,children:v,data:_,cpOption:b}=p;if(g[":for"])return function(O){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{attrs:W,data:J}=O,K=JSON.parse(JSON.stringify(W)),Q={":for":W[":for"]};delete W[":for"],see(Q,qe(qe({},J),j));const ie=[];return Q[":for"].forEach(oe=>{const le=jv(O,oe);ie.push(...G2(le))}),O.attrs=K,ie}(p,l);const S=qe(qe({},_),l),I=qe({},g);let k;if(see(g,S),Object.prototype.hasOwnProperty.call(g,"if")&&!g.if)k=null;else if(delete g.if,b)k=function(O){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{children:W,attrs:J,cpOption:K}=O,Q=aee(W,j),{Component:ie,injection:oe}=K,le=new ie({data:J,injection:oe}),he=H2(kF(le,Q));return he?G2(jv(he))[0]:null}(p,l);else{const{key:O}=g;void 0!==O&&delete g.key;const j=aee(v,l);k=new j2({tagName:f.toUpperCase(),data:g,cpInstance:m,key:O,children:j})}return p.attrs=I,null===(u=k)||void 0===u||u.children.forEach(O=>{O.parent=k}),k}return function(f){var g;let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{value:v}=f;const _=null===(g=f.parent)||void 0===g||null===(g=g.attrs)||void 0===g?void 0:g.html;return v=function(b,S){const I=JJ(b,OPe);return I.length&&I.forEach(k=>{const O=k[1].split(".").reduce((W,J)=>W[J],S);b=b.replace(k[0],O)}),b}(v.trim(),qe(qe({},f.data),m)),_?jv(H2(oee(v),!1)):new j2({tagName:"TEXT",text:v})}(p,l)}function see(p,l){for(const g of Object.keys(p)){const[,m,v]=g.match(/^(:|@)(.+)/)||[];if(!v)continue;let _=p[g];if(delete p[g],"for"===v){var u,f;let[b,S]=_.split(" in "),[I,k]=b.split(",");I=I.trim(),k=null===(u=k)||void 0===u?void 0:u.trim(),S=null===(f=S)||void 0===f?void 0:f.trim();const O=[],j=S.split(".").reduce((W,J)=>W[J],l);if(Di(j))j.forEach((W,J)=>{const K={};K[I]=W,k&&(K[k]=J),O.push(K)});else if(Un(j))for(const[W,J]of Object.entries(j)){const K={};K[I]=J,k&&(K[k]=W),O.push(K)}p[":for"]=O}else{const b="this"===_?l:_.split(".").reduce((S,I)=>null==S?void 0:S[I],l);if(void 0!==b)p[v]="class"===v&&p[v]?`${p[v]} ${b}`:b;else{_=_.replace(MPe,S=>S.includes('"')||S.includes("'")||/^(true|false|\d+|undefined|null)$/.test(S)?S:S.split("."));try{const S=FPe(_,l);dl(S)&&(p[v]=void 0),p[v]="class"===v&&p[v]?`${p[v]} ${S}`:S}catch(S){p[v]=void 0}}"@"===m&&(p.events||(p.events={}),p.events[v]=p[v],delete p[`@${v}`])}}}function G2(p){return p?(Di(p)||(p=[p]),p):[]}function aee(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const u=[];return p.forEach(f=>{const g=jv(f,l)||[];u.push(...G2(g))}),u}function FPe(p,l){let u=null;try{const f=p.split(",");for(let g=0;g<f.length;g++){const _=f[g].match(/(\w+)(\[(\d+)\])?/);if(!_){l=null;break}{const b=_[1],S=_[3];if(!Object.prototype.hasOwnProperty.call(l,b)){l=null;break}l=l[b],void 0!==S&&Array.isArray(l)&&(l=l[S])}}u=l}catch(f){u=null}return u}class Ko extends rr{constructor(l){let{data:u={},template:f="",components:g={},injection:m={}}=l;super(),N(this,"el",void 0),N(this,"vNode",null),N(this,"template",""),N(this,"data",{}),N(this,"injection",{}),N(this,"components",{}),N(this,"emitter",void 0),N(this,"uiEmitter",void 0),N(this,"isInserted",!1),N(this,"hooks",{created:Fo.create(),inserted:Fo.create(),updated:Fo.create(),beforeDestroyed:Fo.create(),destroyed:Fo.create()}),N(this,"selfEvents",[]),N(this,"globalEvents",[]),N(this,"nativeEvents",[]),this.template=f,this.emitter=Bh.create(),this.setData(u),this.setComponents(g),this.setInjects(m),this.uiEmitter=this.injection.emitter,this.hooks.created.on(v=>{this.el=v}),this.hooks.destroyed.on(()=>{this.dispose()}),this.initEvents()}setInjects(l){Object.assign(this.injection,l)}initEvents(){var l=this;const u=(m,v)=>{this.on(m,function(){for(var _=arguments.length,b=new Array(_),S=0;S<_;S++)b[S]=arguments[S];xn(v)?l.$emit(v,b):v_(v)&&v(...b)})};for(const[m,v]of Object.entries((null===(f=this.data)||void 0===f?void 0:f.events)||{})){var f;u(m,v)}for(const[m,v]of Object.entries((null===(g=this.data)||void 0===g||null===(g=g.options)||void 0===g?void 0:g.events)||{})){var g;u(m,v)}}setData(l){Object.assign(this.data,l)}setComponents(l){Object.assign(this.components,l)}on(l,u){this.emitter.on(l,u),this.selfEvents.push([l,u])}emit(l){for(var u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];this.emitter.emit(l,...f)}unbindSelfEvents(){this.selfEvents.forEach(l=>{let[u,f]=l;this.emitter.off(u,f)}),this.selfEvents=[]}$on(l,u){var f;this.uiEmitter&&(null===(f=this.uiEmitter)||void 0===f||f.on(l,u),this.globalEvents.push([l,u]))}$emit(l){for(var u,f=arguments.length,g=new Array(f>1?f-1:0),m=1;m<f;m++)g[m-1]=arguments[m];null===(u=this.uiEmitter)||void 0===u||u.emit(l,...g)}unbindGlobalEvents(){this.globalEvents.forEach(l=>{let[u,f]=l;this.uiEmitter.off(u,f)}),this.globalEvents=[]}nativeOn(l,u,f){if(Di(l))l.forEach(g=>{this.nativeOn(g,u,f)});else{const g=(v=u,_=f,(m=l)?(m.addEventListener(v,_,void 0),()=>{m.removeEventListener(v,_)}):null);g&&this.nativeEvents.push(g)}var m,v,_}unbindNativeEvents(){this.nativeEvents.forEach(l=>{l()}),this.nativeEvents=[]}query(l){var u;return null===(u=this.el)||void 0===u?void 0:u.querySelector(l)}queryAll(l){var u;return null===(u=this.el)||void 0===u?void 0:u.querySelectorAll(l)}parseHTML(){return jv(H2(kF(this,[])))}reRenderVNode(){const l=jv(H2(kF(this)));this.vNode.patch(l)}bindEventsEmitter(){var l=this;const{options:u}=this.data;if(null!=u&&u.events)for(const[f,g]of Object.entries(u.events))this.nativeOn(this.el,f,function(){for(var m=arguments.length,v=new Array(m),_=0;_<m;_++)v[_]=arguments[_];l.emit(f,...v)})}dispose(){this.unbindSelfEvents(),this.unbindGlobalEvents(),this.unbindNativeEvents(),super.dispose()}}const Mr=(p,l,u,f)=>{const{id:g,tooltip:m,dataId:v,style:_,className:b}=p||{},S=(I=>{let k="";if(I)for(const[O,j]of Object.entries(I))k+=`${UIe(O)}:${j};`;return k})(_);return(pt(g)?"":` id="${g}"`)+` class="${l}${null!=u?u:""} ${b||""}"`+(pt(f)?"":` :class="${f}"`)+(S?` style="${S}"`:"")+(pt(m)?"":` title="${m}"`)+(pt(v)?"":` data-id="${v}"`)};function lee(p){if(0===Object.keys(p).length||!p)return'<MainView :options="this"></MainView>';const l=-1!==["Root","DDVRoot","Layout","DDVLayout"].indexOf(null==p?void 0:p.type);return xn(p.type)&&!l?`<${p.type} :options="this"></${p.type}>`:'<Root :options="this"></Root>'}function FF(){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const l=hn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return null!=l&&l.children&&(l.children=l.children.map(u=>xn(u)?{type:u}:Un(u)?FF(u):u)),l.children||Di(l.children)||(l.children=[]),p.length&&l.children.push(...p),l}class lc{constructor(l){N(this,"options",void 0),N(this,"postfix",void 0),N(this,"uiEvents",[]),N(this,"parsedUiConfig",void 0),N(this,"injection",void 0),N(this,"rootComponent",void 0),N(this,"emitter",null),N(this,"rootDom",null),N(this,"rootVNode",void 0),N(this,"container",void 0),N(this,"uiConfig",{}),N(this,"popupUiConfig",[]);const{container:u,injection:f,postfix:g,uiConfig:m,emitter:v,popupUiConfig:_}=l;this.options=l,this.injection=f,this.uiConfig=m,this.popupUiConfig=_,this.parsedUiConfig=FF(m,_),this.emitter=v||Bh.create(),this.postfix=g||`-${Ai()}`,xn(u)?this.container=document.getElementById(u):u instanceof HTMLElement&&(this.container=u),this.init()}static registerComponent(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const[u,f]of Object.entries(l))lc.isAlreadyRegistered(u)||(this.components[`DDV${u}`]=f,this.components[u]=f)}static isAlreadyRegistered(l){return!!this.components[l]}static getComponents(){return this.components}init(){const l=new Ko({data:this.parsedUiConfig,template:lee(this.parsedUiConfig),components:lc.getComponents(),injection:Ht(qe({},this.injection),{components:lc.getComponents(),postfix:this.postfix,emitter:this.emitter})}),u=l.parseHTML();if(!u)return;const f=u.renderDom();this.rootComponent=l,this.rootVNode=u,this.rootDom=f,this.container&&(this.container.appendChild(f),V2(this.rootVNode))}updateUiConfig(l){const u=FF(l,this.popupUiConfig),f=new Ko({data:u,template:lee(this.parsedUiConfig),components:lc.getComponents(),injection:Ht(qe({},this.injection),{components:lc.getComponents(),postfix:this.postfix,emitter:this.emitter})}).parseHTML(),g=this.rootVNode.patch(f);return this.rootDom=g.el,this.rootVNode=g,this.uiConfig=l,V2(this.rootVNode),!0}bindContainer(l){let u;if(y_(l)&&(u=l),xn(l)){const f=document.getElementById(l);y_(f)&&(u=f)}return!!u&&(this.container=u,u.appendChild(this.rootDom),V2(this.rootVNode),!0)}unbindContainer(){if(this.container&&0!==this.container.children.length){for(let l=0;l<this.container.children.length;l++)if(this.container.children[l]===this.rootDom)return void this.container.removeChild(this.rootDom);this.container=null}}queryByDataId(l){var u;return null===(u=this.rootDom)||void 0===u?void 0:u.querySelector(`[data-id=${l}]`)}queryAllByDataId(l){var u;return null===(u=this.rootDom)||void 0===u?void 0:u.querySelectorAll(`[data-id=${l}]`)}getElementsByType(l,u){var f;const g=[];return(null===(f=l.cpInstance)||void 0===f||null===(f=f.constructor)||void 0===f?void 0:f.cpName)===u&&l.el&&g.push(l.el),l.children.length>0&&l.children.forEach(m=>{g.push(...this.getElementsByType(m,u))}),g}on(l,u){const f=this.emitter.on(l,u);this.uiEvents.push(f)}emit(l){for(var u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];this.emitter.emit(l,...f)}off(l,u){this.emitter.off(l,u)}offAllEvents(){this.uiEvents.forEach(l=>{let{name:u,fn:f,context:g,once:m}=l;this.emitter.off(u,f,g,m)})}dispose(){this.unbindContainer(),this.offAllEvents(),this.emitter=null,this.rootDom=null,this.uiConfig={},this.parsedUiConfig={},MF(this.rootVNode)}}N(lc,"components",{});class LF extends Ko{constructor(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super(l),N(this,"defaultClass","ddv-button"),this.initTemplate(u),this.bindBaseHooks()}bindBaseHooks(){this.hooks.inserted.on(l=>{this.bindEventsEmitter()})}initTemplate(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{options:u}=this.data,g=`<div ${Mr(u,""===l?this.defaultClass:`${this.defaultClass} ${l}`)} >`+(pt(null==u?void 0:u.label)?"":`<span>${u.label}</span>`)+"<slot></slot></div>";this.template=g}}class cee extends Ko{constructor(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"row";super(l),N(this,"defaultClass","ddv-layout"),N(this,"enableScroll",!1),N(this,"showScrollArrow",!0),N(this,"scrollLeftOrTopBtn",void 0),N(this,"scrollRightOrBottomBtn",void 0);const{options:f}=this.data;this.enableScroll=(null==f?void 0:f.enableScroll)||!1,this.showScrollArrow=(null==f?void 0:f.showScrollArrow)||!0,this.initTemplate((null==f?void 0:f.flexDirection)||u),this.bindHooks()}bindHooks(){this.hooks.inserted.on(()=>{NF(this),this.bindCustomScroll()}),this.hooks.updated.on(()=>{NF(this)})}bindCustomScroll(){if(!this.enableScroll)return;this.showScrollArrow&&this.initCustomScrollButton();const l=new ResizeObserver(()=>{this.showScrollArrow&&this.updateCustomScrollButton()});l.observe(this.el),this.hooks.destroyed.on(()=>{l.disconnect()})}initCustomScrollButton(){const l=document.createElement("div"),u=document.createElement("div"),f=150;l.addEventListener("click",()=>{const{scrollLeft:g,scrollTop:m}=this.el;l.classList.contains("ddv-scroll-top")?this.el.scroll(0,m-f):this.el.scroll(g-f,0)}),u.addEventListener("click",()=>{const{scrollLeft:g,scrollTop:m}=this.el;u.classList.contains("ddv-scroll-bottom")?this.el.scroll(0,m+f):this.el.scroll(g+f,0)}),this.el.addEventListener("scroll",g=>{this.showScrollArrow&&this.updateCustomScrollButton()}),this.el.appendChild(l),this.el.appendChild(u),this.scrollLeftOrTopBtn=l,this.scrollRightOrBottomBtn=u,this.updateCustomScrollButton()}updateCustomScrollButton(){const{vertical:l,horizontal:u}=uee(this.el),{scrollLeft:f,scrollTop:g}=this.el,{scrollRightOrBottomBtn:m,scrollLeftOrTopBtn:v}=this;if(!v||!m)return;if(!l&&!u)return v.style.display="none",void(m.style.display="none");v.className="ddv-scroll-button "+(u?"ddv-scroll-left":"ddv-scroll-top"),m.className="ddv-scroll-button "+(u?"ddv-scroll-right":"ddv-scroll-bottom");const _=function(b){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{vertical:I,horizontal:k}=uee(b);if(!I&&!k)return[!1,!1];const{scrollLeft:O,scrollTop:j,scrollHeight:W,scrollWidth:J,clientWidth:K,clientHeight:Q}=b;return k?[O<=S,O+K-S>=J]:[j<=S,j+Q-S>=W]}(this.el,0);u?(v.style.left=`${f}px`,m.style.right=-f+"px"):(v.style.top=`${g}px`,m.style.bottom=-g+"px"),v.style.display=_[0]?"none":"",m.style.display=_[1]?"none":""}initTemplate(l){const{options:u}=this.data,f=(null==u?void 0:u.children)||[];let m=`${this.defaultClass}${"row"===l?"":"-col"}`;this.enableScroll&&(m+=" ddv-custom-scroll-hidden");let v=`<div ${Mr(u,m)}>`;f&&f.length&&f.forEach((_,b)=>{if(Un(_)){const{type:S}=_;S.trim(),S.length>0&&(v+=`<${S} :options="options.children[${b}]"></${S}>`)}}),v+="</div>",this.template=v}}function NF(p){const{options:l}=p.data,u=p.el.children;((null==l?void 0:l.children)||[]).forEach((f,g)=>{if(y_(f)){const m=f;0===g?(p.el.append(m),p.el.insertBefore(m,u[0])):((v,_)=>{const b=_.parentNode;b.lastChild===_?b.appendChild(v):YJ(v,_.nextSibling,b)})(m,u[g-1])}})}function uee(p){let l=p.scrollHeight>p.clientHeight,u=p.scrollWidth>p.clientWidth;return l&&u&&(p.scrollHeight-p.clientHeight>p.scrollWidth-p.clientWidth?u=!1:l=!1),{vertical:l,horizontal:u}}class dee extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-root"),this.initTemplate(),this.bindHooks()}initTemplate(){const{options:l}=this.data,{children:u}=l;let g=`<div ${Mr(l,"column"===l.flexDirection?`ddv-column ${this.defaultClass}`:this.defaultClass,"")} >`;u&&u.length&&u.forEach((m,v)=>{if(Un(m)){const{type:_}=m;_.trim(),_.length>0&&(g+=`<${_} :options="options.children[${v}]"></${_}>`)}}),g+="</div>",this.template=g}bindHooks(){this.hooks.inserted.on(()=>{NF(this)})}}class hee extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-split-row"),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.inserted.on(()=>{this.updateClassName()}),this.hooks.updated.on(()=>{this.isInserted&&this.updateClassName()})}updateClassName(){const u=window.getComputedStyle(this.el.parentNode),{flexDirection:f}=u;"column"===f&&(this.el.classList.remove(this.defaultClass),this.el.classList.add("ddv-split-column"))}initTemplate(){const{options:l}=this.data,u=Mr(l,this.defaultClass);this.template=`<div ${u}></div>`}}const Hv={CameraResolution:"ddvCameraResolution",Capture:"ddvCapture",Flashlight:"ddvFlashlight",CameraConvert:"ddvCameraConvert",AutoDetect:"ddvAutoDetect",AutoCapture:"ddvAutoCapture",Rotate:"ddvRotate",RotateLeft:"ddvRotateLeft",RotateRight:"ddvRotateRight",Load:"ddvLoad",Delete:"ddvDelete",DeleteCurrent:"ddvDeleteCurrent",DeleteAll:"ddvDeleteAll",Zoom:"ddvZoom",ZoomIn:"ddvZoomIn",ZoomOut:"ddvZoomOut",ZoomByPercentage:"ddvZoomByPercentage",Crop:"ddvCrop",CropAll:"ddvCropAll",CropCurrent:"ddvCropCurrent",CropMode:"ddvCropMode",PerspectiveAll:"ddvPerspectiveAll",FullQuad:"ddvFullQuad",Undo:"ddvUndo",Redo:"ddvRedo",Restore:"ddvRestore",Pan:"ddvPan",Filter:"ddvFilter",Print:"ddvPrint",ThumbnailSwitch:"ddvThumbnailSwitch",DisplayMode:"ddvDisplayMode",ContinuousPage:"ddvContinuousPage",SinglePage:"ddvSinglePage",FitMode:"ddvFitMode",FitWidth:"ddvFitWidth",FitHeight:"ddvFitHeight",FitWindow:"ddvFitWindow",ActualSize:"ddvActualSize",Back:"ddvBack",Close:"ddvClose",Done:"ddvDone",Download:"ddvDownload",ImagePreview:"ddvImagePreview",FirstPage:"ddvFirstPage",LastPage:"ddvLastPage",NextPage:"ddvNextPage",PrevPage:"ddvPrevPage",FitMode_FitWidth:"ddvFitModeFitWidth",FitMode_FitHeight:"ddvFitModeFitHeight",FitMode_FitWindow:"ddvFitModeFitWindow",FitMode_ActualSize:"ddvFitModeActualSize",DisplayMode_SinglePage:"ddvDisplayModeSinglePage",DisplayMode_ContinuousPage:"ddvDisplayModeContinuousPage",Crop_CropAll:"ddvCropCropAll",Crop_CropCurrent:"ddvCropCropCurrent",Crop_CropCancel:"ddvCropCropCancel",Crop_CropApply:"ddvCropCropApply",Filter_FilterAll:"ddvFilterFilterAll",Delete_DeleteCurrent:"ddvDeleteDeleteCurrent",Delete_DeleteAll:"ddvDeleteDeleteAll",RectAnnotation:"ddvRect",EllipseAnnotation:"ddvEllipse",InkAnnotation:"ddvInk",PolygonAnnotation:"ddvPolygon",PolylineAnnotation:"ddvPolyline",LineAnnotation:"ddvLine",StampImageAnnotation:"ddvStampImage",StampIconAnnotation:"ddvStampIcon",TextTypewriterAnnotation:"ddvTypewriter",TextBoxAnnotation:"ddvTextBox",EraseAnnotation:"ddvAnnotationEraser",SelectAnnotation:"ddvAnnotationSelect",SendBackward:"ddvSendBackward",SendToBack:"ddvSendToBack",BringToFront:"ddvBringToFront",BringForward:"ddvBringForward",AnnotationSet:"ddvAnnotationSet"};function fee(p,l,u){const f=g=>{const m=(parseFloat(g.value)-l)/(u-l)*100;p.style.backgroundSize=`${m}% 100%`};f(p),p.oninput=g=>{f(p)},p.onchange=g=>{f(p)}}function BF(p,l){const{bottom:u,height:f}=p.parentNode.getBoundingClientRect(),{height:g}=p.getBoundingClientRect(),{bottom:m}=l.getBoundingClientRect();let v=f;return m-u<g&&(v=-g),v}function z2(p){p.$on("ui_hidePopup",l=>{l!==p&&v_(null==p?void 0:p.togglePopup)&&(null==p||p.togglePopup(!1))})}function gw(p){p.$on("ui_cropClick",l=>{const{viewer:u}=p.injection,f=u.getPageCounts()||0;(l||f)&&Jh(p.el,l)})}function cc(p){p.$on("ui_toolModeRefactor",()=>{const{viewer:l}=p.injection,u=l.getPageCounts()||0,{toolMode:f}=l.context.viewerConfig;u&&Jh(p.el,"annotation"===f||"crop"===f)})}function Jh(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!p)return;const{classList:u}=p,f=u.contains("ddv-button-disabled");l?f||p.classList.add("ddv-button-disabled"):f&&!l&&p.classList.remove("ddv-button-disabled")}function Xu(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"base";if(!p)return;const{classList:f}=p;let g="ddv-button-activated";"deep"===u?g="ddv-button-activated-deep":"light"===u&&(g="ddv-button-activated-light");const m=f.contains(g);l?m||p.classList.add(g):p.classList.remove(g)}function Kg(p,l,u){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{left:m,right:v,bottom:_}=function(Ve,ee){const ke=(ee||Ve.parentElement).getBoundingClientRect(),xe=Ve.getBoundingClientRect();return{top:xe.top-ke.top,bottom:ke.bottom-xe.bottom,left:xe.left-ke.left,right:ke.right-xe.right}}(l,p),{x:b,y:S,width:I}=p.getBoundingClientRect(),{height:k,width:O}=u.getBoundingClientRect(),{x:j,y:W,width:J,height:K}=l.getBoundingClientRect(),Q=ni(getComputedStyle(p).borderWidth);let ie=Math.floor(j)-Math.floor(b)-Q.value;ie<5&&(ie=0);const oe=I-O,le=ie-(Math.floor(O)-Math.floor(J))/2,he=le<5?"0px":`${le}px`;let _e=Math.floor(W)-Math.floor(S)-Q.value;u.style.left=g&&v>O/2&&m>O/2?he:I<O+5?"0px":v>O?`${ie}px`:m>O?ie-(Math.floor(O)-Math.floor(J))+"px":v>O/2&&m>O/2?he:oe<5?"0px":`${oe}px`,_>k?(f&&(_e+=2),u.style.top=_e+Math.floor(K)-1+"px"):(f&&(_e-=4),u.style.top=_e-Math.floor(k)+"px")}function Yd(p,l,u){const f=pl.getTooltip(),g=pl.getDisplayTextConfig();null!=u&&u.id||!(p in Hv)||(u.id=Hv[p]+l.postfix),null!=u&&u.tooltip||!(p in f)||(u.tooltip=f[p]),null!=u&&u.displayText&&(u.label=null==u?void 0:u.displayText),null!=u&&u.label||!(p in g)||(u.label=g[p])}function Xd(p){return(null==p?void 0:p.constructor.cpName)||""}function pee(p){const{value:l}=p,{fontSize:u}=getComputedStyle(p),f=document.createElement("div");f.style.position="absolute",f.style.left="-9999px",f.style.top="-9999px",f.style.visibility="hidden",f.style.fontSize=u,f.style.fontFamily="Arial, Helvetica, sans-serif",document.body.appendChild(f),f.textContent=l;const g=f.clientWidth+1;return f.remove(),g}function Y2(p,l){let u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];p.uiState!==l&&p.el&&(Jh(p.el,"disabled"===l),function(g){let m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!g)return;const{classList:v}=g,_=v.contains("ddv-button-focused");m?_||g.classList.add("ddv-button-focused"):g.classList.remove("ddv-button-focused")}(p.el,"focused"===l),u&&Xu(p.el,"focused"===l,f?"deep":"base"),p.uiState=l)}class _r extends LF{constructor(l,u){super(l,u.class),N(this,"callback",void 0),N(this,"uiState","normal"),N(this,"isFocused",!1),N(this,"isMenuButton",!1),this.callback=u.callback,this.bindHooks(),this.isMenuButton=l.data.menu||!1,"false"!==l.data.default&&this.bindDefaultUi()}bindEvent(){this.nativeOn(this.el,"click",this.callback)}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup")})}setUiState(l){Y2(this,l,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this.isMenuButton)}bindDefaultUi(){const{viewer:l}=this.injection,u=f=>{let g=this.isFocused?"focused":"normal";(pt(null==f?void 0:f.pageCount)?this.injection.viewer.getPageCounts():f.pageCount)||(g="disabled"),this.setUiState(g,!ir())};l.hooks.pageExistenceChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}bindHooks(){this.hooks.created.on(()=>{this.bindEvent(),this.bindHidePopup()}),this.hooks.updated.on(()=>{this.uiState="normal"})}initTemplate(l){const u=this.data;u.options||(u.options={});const{options:f,id:g}=this.data;g&&(f.id=g),Yd(Xd(this),this.injection.viewer,f),"false"===u.default&&(f.label=void 0),super.initTemplate(l)}}class X2 extends Ko{constructor(l){super(l),N(this,"uiState","normal"),N(this,"defaultClass",void 0),N(this,"pullDownBox",void 0),N(this,"isFirstClick",!0),this.bindViewerResized(),this.bindPopupSwitchEvent(),this.bindDefaultUi(),this.bindViewerHooks()}bindViewerResized(){const{viewer:l}=this.injection;l.hooks.resize.on(()=>{const{pullDownBox:u}=this;if(!u)return;const g=this.injection.viewer.rootDom;"none"===u.style.display?this.isFirstClick=!0:Kg(g,this.el,this.pullDownBox)},this)}bindPullDownBoxEvents(){this.nativeOn(this.el,"click",()=>{this.togglePopup(),this.isFirstClick&&(Kg(this.injection.viewer.rootDom,this.el,this.pullDownBox),this.isFirstClick=!1)})}bindPopupSwitchEvent(){z2(this)}bindDefaultUi(){const l=u=>{const f=(pt(null==u?void 0:u.pageCount)?this.injection.viewer.getPageCounts():u.pageCount)?"normal":"disabled";this.isFirstClick=!0,this.setUiState(f)};this.injection.viewer.hooks.pageExistenceChanged.on(l,this),this.hooks.inserted.on(l),this.hooks.updated.on(l)}initPullDownBox(){this.hooks.created.on(()=>{this.pullDownBox=this.query(`.${this.defaultClass}-box`),this.pullDownBox.style.display="none",this.pullDownBox.remove(),this.bindPullDownBoxEvents()}),this.hooks.updated.on(()=>{this.uiState="normal",this.pullDownBox.style.display="none",this.isFirstClick=!0})}bindViewerHooks(){this.injection.viewer.hooks.visibleChanged.on(l=>{"hidden"===l.newVisibility&&this.togglePopup(!1)},this)}setUiState(l){Y2(this,l)}togglePopup(l){const{pullDownBox:u}=this,{viewer:f}=this.injection;let g="none"===u.style.display;g=pt(l)?!g:!l,g?u.remove():(this.$emit("ui_hidePopup",this),f.rootDom.appendChild(u)),Xu(this.el,!g),u.style.display=g?"none":""}}class $2 extends X2{constructor(l){super(l),N(this,"lastSelectedIndex",0),N(this,"defaultClass","ddv-pdl"),N(this,"pullDownBoxClass","ddv-pull-down"),N(this,"children",[]),N(this,"hasCheckIcon",!1);const{defaultClassName:u,children:f,showCheckIcon:g}=l.data.options;u&&(this.defaultClass=u),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,this.children=f,this.hasCheckIcon=g,this.initPullDownBox(),this.initTemplate()}getChildrenTemplate(){let l="";return this.children.forEach((u,f)=>{const{id:g,label:m}=u;u.id=void 0,u.label=void 0,l+=`<${u.type} :options="options.children[${f}]" default="false"id="${g?g+this.injection.viewer.postfix:""}" ><span>${m}</span>`+(this.hasCheckIcon?'<i class="ddv-button-ok" style="visibility: hidden"></i>':"")+`</${u.type}>`}),l}selectChildren(l){if(!this.hasCheckIcon)return;const{pullDownBox:u}=this;if(-1!==l&&!u.childNodes[l])return;if(-1!==this.lastSelectedIndex){const m=u.children[this.lastSelectedIndex],v=m.getElementsByTagName("i")[0];m.classList.remove("ddv-pull-down-selected"),v.style.visibility="hidden"}if(-1===l)return void(this.lastSelectedIndex=-1);const f=u.children[l],g=f.getElementsByTagName("i")[0];f.classList.add("ddv-pull-down-selected"),g.style.visibility="visible",this.lastSelectedIndex=l}initTemplate(){const l=this.data;l.options||(l.options={});const{options:u}=this.data,{pullDownBox:f}=u;Yd(Xd(this),this.injection.viewer,u);const g=`<div ${Mr(u,`ddv-button ${this.defaultClass}`)}>`+(pt(null==u?void 0:u.label)?"":`<span>${u.label}</span>`)+`<div ${Mr(f,this.pullDownBoxClass)}>${this.getChildrenTemplate()}</div><i class="ddv-down-arrow"></i></div>`;this.template=g}}class gee extends X2{constructor(l){super(l),N(this,"defaultClass","ddv-pdm"),N(this,"pullDownBoxClass","ddv-pull-down"),N(this,"children",[]);const{defaultClassName:u,children:f,enableScroll:g}=l.data.options;u&&(this.defaultClass=u),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,g&&(this.pullDownBoxClass+=ir()?" ddv-custom-scroll-hidden":" ddv-custom-scroll"),this.children=f,this.initPullDownBox(),this.initTemplate()}getChildrenTemplate(){let l="";return this.children.forEach((u,f)=>{l+=`<${u.type} :options="options.children[${f}]" menu="true"></${u.type}>`}),l}initTemplate(){const l=this.data;l.options||(l.options={});const{options:u}=this.data,{pullDownBox:f}=u;Yd(Xd(this),this.injection.viewer,u);const g=`<div ${Mr(u,`ddv-button ${this.defaultClass}`)}>`+(pt(null==u?void 0:u.label)?"":`<span>${u.label}</span>`)+`<div ${Mr(f,this.pullDownBoxClass)}>${this.getChildrenTemplate()}</div><i class="ddv-down-arrow"></i></div>`;this.template=g}}class $d extends _r{constructor(l,u){super(l,{class:u.class,callback:()=>{const{viewer:f}=this.injection;ir()&&this.el.classList.contains("ddv-button-focused")?f.updateViewerConfig({toolMode:"pan"}):(f.updateViewerConfig({toolMode:"annotation",annotationMode:u.annotationMode}),"stamp"===u.annotationMode&&f.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:null}}}))}}),N(this,"annotationMode",void 0),this.annotationMode=u.annotationMode}bindDefaultUi(){const l=this.injection.viewer,u=()=>{if(!xi.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:f,annotationMode:g}=l.getViewerConfig();l.getPageCounts()?this.setUiState("annotation"!==f?"normal":g===this.annotationMode?"focused":"normal"):this.setUiState("disabled")};l.hooks.pageExistenceChanged.on(u,this),l.hooks.toolModeChanged.on(u,this),l.hooks.annotationModeChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}class mee extends $d{constructor(l){super(l,{class:"ddv-ellipse",annotationMode:"ellipse"})}}N(mee,"cpName","EllipseAnnotation");class vee extends $d{constructor(l){super(l,{class:"ddv-annot-eraser",annotationMode:"erase"})}}N(vee,"cpName","EraseAnnotation");class yee extends $d{constructor(l){super(l,{class:"ddv-ink",annotationMode:"ink"})}}N(yee,"cpName","InkAnnotation");class _ee extends $d{constructor(l){super(l,{class:"ddv-line",annotationMode:"line"})}}N(_ee,"cpName","LineAnnotation");class Cee extends $d{constructor(l){super(l,{class:"ddv-polygon",annotationMode:"polygon"})}}N(Cee,"cpName","PolygonAnnotation");class bee extends $d{constructor(l){super(l,{class:"ddv-polyline",annotationMode:"polyline"})}}N(bee,"cpName","PolylineAnnotation");class xee extends $d{constructor(l){super(l,{class:"ddv-rect",annotationMode:"rectangle"})}}N(xee,"cpName","RectAnnotation");class wee extends $d{constructor(l){super(l,{class:"ddv-annot-select",annotationMode:"select"})}}N(wee,"cpName","SelectAnnotation");class See extends $d{constructor(l){super(l,{class:"ddv-stamp-icon",annotationMode:"stamp"})}bindDefaultUi(){const l=this.injection.viewer,u=()=>{if(!xi.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:f,annotationMode:g}=l.getViewerConfig(),m=l.getPageCounts(),{defaultStyleConfig:v}=l.getAnnotationConfig(),{stamp:_}=v;this.setUiState(m?"annotation"!==f||"stamp"!==g||(null==_?void 0:_.imageData)?"normal":"focused":"disabled")};l.hooks.pageExistenceChanged.on(u,this),l.hooks.toolModeChanged.on(u,this),l.hooks.annotationModeChanged.on(u,this),l.hooks.annotationDefaultStyleChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}N(See,"cpName","StampIconAnnotation");class Tee extends _r{constructor(l){super(l,{class:"ddv-stamp-image",callback:()=>{this.annotationImageLoader.value=null,delete this.annotationImageLoader.files,ir()&&this.el.classList.contains("ddv-button-focused")?this.injection.viewer.updateViewerConfig({toolMode:"pan"}):(this.injection.viewer.updateViewerConfig({toolMode:"pan"}),this.injection.viewer.selectAnnotations([]),this.annotationImageLoader.click())}}),N(this,"annotationImageLoader",void 0)}createAnnotationImageLoaderInput(){const l=document.createElement("input");return l.accept="image/png,image/jpeg,image/bmp",l.type="file",l.addEventListener("change",u=>{const{files:f}=l,g=new Blob([f[0]],{type:f[0].type});["image/png","image/jpeg","image/bmp"].includes(f[0].type)&&(this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:g}}}),l.value=null,l.files=null,this.injection.viewer.updateViewerConfig({toolMode:"annotation",annotationMode:"stamp"}))},!0),l}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet")})}bindHooks(){super.bindHooks(),this.hooks.inserted.on(()=>{const l=this.createAnnotationImageLoaderInput();l.style.display="none",this.el.appendChild(l),this.annotationImageLoader=l,this.annotationImageLoader.addEventListener("click",u=>{u.stopPropagation()})})}bindDefaultUi(){const l=this.injection.viewer,u=()=>{if(!xi.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:f,annotationMode:g}=l.getViewerConfig(),m=l.getPageCounts(),{defaultStyleConfig:v}=l.getAnnotationConfig(),{stamp:_}=v;this.setUiState(m?"annotation"!==f?"normal":"stamp"===g&&(null==_?void 0:_.imageData)?"focused":"normal":"disabled")};l.hooks.pageExistenceChanged.on(u,this),l.hooks.toolModeChanged.on(u,this),l.hooks.annotationModeChanged.on(u,this),l.hooks.annotationDefaultStyleChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}N(Tee,"cpName","StampImageAnnotation");class Iee extends $d{constructor(l){super(l,{class:"ddv-text-box",annotationMode:"textBox"})}}N(Iee,"cpName","TextBoxAnnotation");class Eee extends $d{constructor(l){super(l,{class:"ddv-typewriter",annotationMode:"textTypewriter"})}}N(Eee,"cpName","TextTypewriterAnnotation");class q2 extends gee{constructor(l){const{AnnotationSet:u}=pl.getDisplayTextConfig(),f=l.data;f.options=Ht(qe({},f.options),{children:[{type:"SelectAnnotation"},{type:"EraseAnnotation"},{type:"SeparatorLine"},{type:"TextTypewriterAnnotation"},{type:"TextBoxAnnotation"},{type:"SeparatorLine"},{type:"StampIconAnnotation"},{type:"StampImageAnnotation"},{type:"SeparatorLine"},{type:"InkAnnotation"},{type:"RectAnnotation"},{type:"EllipseAnnotation"},{type:"PolygonAnnotation"},{type:"PolylineAnnotation"},{type:"LineAnnotation"},{type:"SeparatorLine"},{type:"BringForward"},{type:"BringToFront"},{type:"SendBackward"},{type:"SendToBack"}],defaultClassName:"ddv-annotation-mode",label:u,enableScroll:!0}),super(l),gw(this)}bindDefaultUi(){xi.annotationLicenseModuleIsExist()?(super.bindDefaultUi(),this.hooks.inserted.on(l=>{const{toolMode:u}=this.injection.viewer.getViewerConfig(),f=this.injection.viewer.getPageCounts();"annotation"===u&&f>0&&this.setUiState("focused")})):this.hooks.inserted.on(l=>{this.setUiState("disabled")})}togglePopup(l){if((!0!==l||""!==this.pullDownBox.style.display)&&(!1!==l||"none"!==this.pullDownBox.style.display)&&(super.togglePopup(l),""===this.pullDownBox.style.display&&Dee(this.pullDownBox).horizontal)){this.pullDownBox.style.justifyContent="start";let u=0;for(let f=0;f<this.pullDownBox.children.length;f++){const g=this.pullDownBox.children[f];g.classList.contains("ddv-button-focused")&&(u=g.offsetLeft+g.clientWidth/2-this.pullDownBox.clientWidth/2)}this.pullDownBox.scroll(u,0)}}bindPopupSwitchEvent(){this.$on("ui_hidePopup",l=>{if(l===this||"viewer"===l||l===q2.cpName)return;const{toolMode:u}=this.injection.viewer.getViewerConfig();"annotation"!==u&&this.togglePopup(!1)})}bindViewerHooks(){if(!xi.annotationLicenseModuleIsExist())return;const l=this.injection.viewer;l.hooks.resize.on(()=>{this.pullDownBox.style.justifyContent=Dee(this.pullDownBox).horizontal?"start":""},this),l.hooks.pageExistenceChanged.on(()=>{const{toolMode:u}=l.getViewerConfig();let f="disabled";l.getPageCounts()>0?(f="normal","annotation"===u&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0),f="focused")):this.togglePopup(!1),this.setUiState(f)},this),l.hooks.toolModeChanged.on(u=>{if("crop"===u.newToolMode)return this.togglePopup(!1),void this.setUiState("disabled");const f="annotation"===u.newToolMode;l.getPageCounts()>0&&(this.setUiState(f?"focused":"normal"),this.$emit("ui_annotationModeClick",f),this.$emit("ui_toolModeRefactor",f),f&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0)))},this)}setUiState(l){super.setUiState(l)}}function Dee(p){return{vertical:p.scrollHeight>p.clientHeight,horizontal:p.scrollWidth>p.clientWidth}}N(q2,"cpName","AnnotationSet");class K2 extends _r{constructor(l,u){super(l,{class:u.class,callback:()=>{const{viewer:f}=this.injection,g=f.getSelectedAnnotations();if(1!==g.length)return;const m=g[0].uid;switch(this.layerType){case"bringForward":f.bringForward(m);break;case"bringToFront":f.bringToFront(m);break;case"sendBackward":f.sendBackward(m);break;case"sendToBack":f.sendToBack(m)}}}),N(this,"layerType",void 0),this.layerType=u.layerType}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet")})}bindDefaultUi(){const l=this.injection.viewer,u=xi.annotationLicenseModuleIsExist(),f=()=>{if(!u)return void this.setUiState("disabled");const{viewer:g}=this.injection,m=g.getSelectedAnnotations();l.getPageCounts()&&1===m.length?this.setUiState("normal"):this.setUiState("disabled")};l.hooks.annotationLayerStateChanged.on(g=>{let{state:m}=g;if(!u)return void this.setUiState("disabled");const v=l.getSelectedAnnotations();if(!v.length||v.length>1)return void this.setUiState("disabled");const _=l.getAnnotationObject(v[0].uid);if(_&&!_.context.isActive)return void this.setUiState("disabled");let b=!1;switch(this.layerType){case"bringForward":b=m.forward;break;case"bringToFront":b=m.front;break;case"sendBackward":b=m.backward;break;case"sendToBack":b=m.back}this.setUiState(b?"normal":"disabled")},this),l.hooks.pageExistenceChanged.on(f,this),this.hooks.inserted.on(f),this.hooks.updated.on(f)}}class Aee extends K2{constructor(l){super(l,{class:"ddv-bring-forward",layerType:"bringForward"})}}N(Aee,"cpName","BringForward");class Pee extends K2{constructor(l){super(l,{class:"ddv-bring-to-front",layerType:"bringToFront"})}}N(Pee,"cpName","BringToFront");class Ree extends K2{constructor(l){super(l,{class:"ddv-send-backward",layerType:"sendBackward"})}}N(Ree,"cpName","SendBackward");class kee extends K2{constructor(l){super(l,{class:"ddv-send-to-back",layerType:"sendToBack"})}}N(kee,"cpName","SendToBack");class Mee extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-annotation-toolbar"),N(this,"lastSelected",void 0),N(this,"toolbarOffset",20),this.bindHooks(),this.initTemplate(),this.bindViewerHooks()}bindHooks(){const l=u=>{this.el.style.display="none"};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){const{viewer:l}=this.injection,u=()=>{if(!this.lastSelected)return;const f=l.getActiveTab();if("single"===f.context.displayMode&&this.lastSelected.pageUid!==f.getCurrentPage().uid)return;const{show:g,x:m,y:v}=WF(l.context.viewService.mainContainer,this.lastSelected,this.el,this.toolbarOffset);this.togglePopup(g,m,v)};if(l.hooks.visibleChanged.on(()=>{this.togglePopup(!1)},this),l.hooks.pageExistenceChanged.on(f=>{0===f.pageCount&&(this.togglePopup(!1),this.lastSelected=null)},this),l.hooks.selectedAnnotationsChanged.on(f=>{if(1!==f.newAnnotationUids.length)return this.togglePopup(!1),void(this.lastSelected=null);const m=l.getAnnotationObject(f.newAnnotationUids[0]);if(!m)return;const{show:v,x:_,y:b}=WF(l.context.viewService.mainContainer,m,this.el,this.toolbarOffset);this.lastSelected=m,this.togglePopup(v,_,b)},this),l.hooks.beforeAnnotationEdit.on(()=>{this.togglePopup(!1)},this),l.hooks.afterAnnotationEdit.on(f=>{if(f instanceof pp)return;const{show:g,x:m,y:v}=WF(l.context.viewService.mainContainer,f,this.el,this.toolbarOffset);this.lastSelected=f,this.togglePopup(g,m,v)},this),l.hooks.pageChanged.on(()=>{const f=l.getActiveTab();if(!f||"single"!==f.context.displayMode)return;const g=l.getSelectedAnnotations();if(1!==g.length)return;const m=g[0].pageUid===f.getCurrentPage().uid;this.togglePopup(m)},this),l.hooks.resize.on(u,this),l.hooks.scroll.on(u,this),l.hooks.fitModeChanged.on(u,this),l.hooks.displayModeChanged.on(u,this),l.hooks.zoomChanged.on(u,this),l.hooks.annotationsUpdated.on(u,this),null!=l&&l.annotationViewerContext){const{annotationViewerContext:f}=l,{hooks:g}=f.annotationController;g.enableAnnotationTextEditMode.on(u,this),g.disableAnnotationTextEditMode.on(u,this)}}togglePopup(l,u,f){const{viewer:g}=this.injection;l?(g.context.viewService.mainContainer.appendChild(this.el),this.el.style.display="",this.el.style.left=`${u||0}px`,this.el.style.top=`${f||0}px`):this.el.style.display="none"}initTemplate(){const{options:l}=this.data;Yd(Xd(this),this.injection.viewer,l);const u=`<div ${Mr(l,this.defaultClass,"")}><AnnotationPaletteButton :options="options.paletteButton"></AnnotationPaletteButton><AnnotationDeleteButton :options="options.deleteButton"></AnnotationDeleteButton></div>`;this.template=u}}function WF(p,l,u,f){const{width:g,height:m}=p.getBoundingClientRect(),v=l.context.getRealTimeBoundingBox(),_=getComputedStyle(u),b=ni(_.width).value,S=ni(_.height).value;if(v.right<0||v.left>g||v.top>m||v.bottom<0)return{show:!1,x:0,y:0};let k=v.bottom+f;return k+S>m&&(k=v.top-S-f),k<0&&(k=0),{show:!0,x:v.left+v.width/2-b/2,y:k}}N(Mee,"cpName","AnnotationToolBar");class Oee extends _r{constructor(l){super(l,{class:"ddv-palette",callback:()=>{this.$emit("ui_changePalette_visible")}}),gw(this)}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet"),this.focusTexture()})}focusTexture(){const l=this.injection.viewer.getSelectedAnnotations();if(1===l.length){const u=this.injection.viewer.getAnnotationObject(l[0].uid);u instanceof or&&u.isEditMode&&u.focusTexture()}}}N(Oee,"cpName","AnnotationPaletteButton");class Fee extends _r{constructor(l){super(l,{class:"ddv-delete-annot",callback:()=>{const{viewer:u}=this.injection,f=u.getSelectedAnnotations(),g=[];f.forEach(m=>{g.push(m.uid)}),u.deleteAnnotations(g)}}),gw(this)}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet")})}bindDefaultUi(){const l=this.injection.viewer,u=()=>{const{viewer:f}=this.injection,g=f.getSelectedAnnotations();l.getPageCounts()&&g.length?this.setUiState("normal"):this.setUiState("disabled")};l.hooks.selectedAnnotationsChanged.on(u,this),l.hooks.pageExistenceChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}N(Fee,"cpName","AnnotationDeleteButton");class LPe extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-palette-color-panel"),N(this,"colorList",void 0),N(this,"enableChangeColor",void 0),N(this,"paletteType",void 0),N(this,"colorInput",void 0),N(this,"selectedColorButton",void 0),N(this,"lastUpdatedAnnotation",void 0),N(this,"lastInputColor",void 0),N(this,"lastTextContents",void 0),N(this,"lastPaletteType",void 0),N(this,"dblClickButtons",[]),this.colorList=l.data.colorList,this.enableChangeColor=l.data.enableChangeColor,this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_changePalette_type",u=>{this.el.style.display="stamp"===u?"none":"",this.paletteType=u,this.showNoFill("fill"===u),this.updateButtonSelected()})}bindHooks(){this.hooks.inserted.on(()=>{const l=document.createElement("input");l.type="color",this.colorInput=l,this.el.appendChild(this.colorInput),this.bindEvents(),this.bindColorInputEvents()})}bindEvents(){const l=this.el.querySelector(".ddv-palette-color-grid");l.addEventListener("click",u=>{const f=u.target;if(!(f instanceof HTMLButtonElement)||(this.dblClickButtons.push(f),this.dblClickButtons.length>2&&this.dblClickButtons.shift(),f.classList.contains("ddv-color-selected")))return;const g=f.value,{viewer:m}=this.injection;if(""===g)this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=f;else{const v=m.getSelectedAnnotations();1===v.length&&this.updateColorByData(v[0],g),this.updateDefaultColor(g)}}),l.addEventListener("dblclick",u=>{if(!this.enableChangeColor)return;const f=u.target;if(!(f instanceof HTMLButtonElement)||2===this.dblClickButtons.length&&this.dblClickButtons[0]!==this.dblClickButtons[1])return;const g=f.value;"transparent"!==g&&""!==g&&(this.colorInput.value=g,ir()&&this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=f)})}bindColorInputEvents(){this.colorInput.addEventListener("input",l=>{const{viewer:u}=this.injection,f=this.colorInput.value;this.selectedColorButton.classList.contains("ddv-add-color")&&this.addColor(),this.selectedColorButton.children[0].style.background=f,this.selectedColorButton.value=f,1===u.getSelectedAnnotations().length&&this.updateColorByShape(f),this.updateDefaultColor(f),this.selectedColor(f)}),this.colorInput.addEventListener("change",l=>{this.lastUpdatedAnnotation&&(this.updateColorByData(this.lastUpdatedAnnotation,this.lastInputColor,this.lastPaletteType),this.lastUpdatedAnnotation=null,this.lastInputColor=null,this.lastPaletteType=null)})}bindViewerHooks(){const l=this.injection.viewer;l.hooks.selectedAnnotationsChanged.on(()=>{this.updateButtonSelected()},this),l.hooks.annotationsUpdated.on(()=>{this.updateButtonSelected()},this),l.hooks.annotationModeChanged.on(()=>{this.updateButtonSelected()},this),l.hooks.annotationDefaultStyleChanged.on(()=>{this.updateButtonSelected()},this),l.hooks.annotationTextCharsSelected.on(u=>{const f=u.freeTextContentStyle,{color:g}=f;this.selectedColor(g)},this)}updateColorByShape(l){const u=this.injection.viewer.getSelectedAnnotations();if(1!==u.length)return;const f=this.injection.viewer.getAnnotationObject(u[0].uid);if("fill"===this.paletteType)f.style.background=l;else if("stroke"===this.paletteType)f.style.borderColor=l;else if("text"===this.paletteType&&f instanceof or){if(f.hasSelectedChars){const g=a5(f,{color:l});f.style.textContents=g,f.textEditEventHandler.updateTextSelection()}else{if(f.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[u[0].type]:{textContent:{color:l}}}});{const g=s5(f,{color:l});g.length&&(f.style.textContents=g)}}this.lastTextContents=f.style.textContents}this.lastUpdatedAnnotation=u[0],this.lastInputColor=l,this.lastPaletteType=this.paletteType,this.injection.viewer.context.render()}updateColorByData(l,u,f){const{viewer:g}=this.injection,{uid:m}=l,v={},_=this.injection.viewer.getAnnotationObject(m),b=f||this.paletteType;if("text"===b&&_ instanceof or){if(_.hasSelectedChars){const S=a5(_,{color:u});v.textContents=S}else{if(_.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[l.type]:{textContent:{color:u}}}});{const S=s5(_,{color:u});S.length&&(v.textContents=S)}}return this.lastTextContents&&(v.textContents=this.lastTextContents,this.lastTextContents=null),g.updateAnnotation(m,{style:v},["appearanceChanged"]),void(_.hasSelectedChars&&_.textEditEventHandler.updateTextSelection())}"fill"===b?v.background="transparent"===u?"":u:"stroke"===b&&(v.borderColor=u),g.updateAnnotation(m,{style:v},["appearanceChanged"])}updateDefaultColor(l,u){const{annotationMode:f}=this.injection.viewer.getViewerConfig(),g=this.injection.viewer.getSelectedAnnotations();let m=f;g.length&&g[0]&&(m=g[0].type);const v={};switch(u||this.paletteType){case"fill":v.background=l;break;case"stroke":v.borderColor=l;break;case"text":v.textContent={},v.textContent.color=l}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[m]:v}})}selectedColor(l){const u=this.el.querySelector(".ddv-palette-color-grid").getElementsByTagName("button");for(let f=0;f<u.length;f++){const g=u[f];if(!g.value)continue;const m=jd(g.value),v=jd(l);m.formatted===v.formatted?g.classList.add("ddv-color-selected"):g.classList.contains("ddv-color-selected")&&g.classList.remove("ddv-color-selected")}}updateButtonSelected(){const{viewer:l}=this.injection,u=l.getSelectedAnnotations();if(1===u.length){let S=null;if("fill"===this.paletteType)S=u[0].style.background||"transparent";else if("stroke"===this.paletteType)S=u[0].style.borderColor||"transparent";else if("text"===this.paletteType){const I=l.getAnnotationObject(u[0].uid);var f;I instanceof or&&(S=(null===(f=u[0].style)||void 0===f||null===(f=f.textContents[0])||void 0===f?void 0:f.color)||"transparent"),I instanceof or&&(I.isEditMode||!I.style.textContents.length)&&(S=I.freeTextContentStyle.color)}return void(S&&this.selectedColor(S))}const{toolMode:g,annotationMode:m}=l.getViewerConfig();if("annotation"===g&&"select"!==m&&"erase"!==m){const{defaultStyleConfig:S}=l.getAnnotationConfig(),{background:I,borderColor:k,textContent:O}=qi;let j=null;var v;if("fill"===this.paletteType)j=(null===(v=S[m])||void 0===v?void 0:v.background)||I||"transparent";else if("stroke"===this.paletteType){var _;j=(null===(_=S[m])||void 0===_?void 0:_.borderColor)||k||"transparent"}else if("text"===this.paletteType){var b;j=(null===(b=S[m])||void 0===b||null===(b=b.textContent)||void 0===b?void 0:b.color)||(null==O?void 0:O.color)||"transparent"}j&&this.selectedColor(j)}}getColorTemplate(){const l=document.createElement("div");let u="<div>",f=0;for(let m=0;m<this.colorList.length;m++){const v=this.colorList[m];if(l.style.background=v,""!==l.style.background){if(f>26)break;f+=1,u+=`<button value="${v}"><div style="background:${v}"></div></button>`,0!==f&&f%7==0&&(u+="</div><div>"),l.style.background=""}}const g=f>26?0:27-f;for(let m=0;m<g;m++)u+=0===m?'<button value="" class="ddv-add-color"><div></div></button>':'<button value="" class="ddv-color-placeholder"><div></div></button>',(f+m+1)%7==0&&(u+="</div><div>");return u+='<button value="transparent" class="ddv-color-transparent"><div></div></button>',u+="</div>",l.remove(),u}showNoFill(l){this.el.querySelectorAll(".ddv-color-transparent").forEach(u=>{u.style.visibility=l?"":"hidden",u.style.pointerEvents=l?"":"none"})}addColor(){const l=this.el.querySelector(".ddv-palette-color-grid"),u=l.querySelector(".ddv-add-color"),f=l.querySelector(".ddv-color-placeholder");u&&u.classList.remove("ddv-add-color"),f&&(f.classList.remove("ddv-color-placeholder"),f.classList.add("ddv-add-color"))}initTemplate(){const l=`<div class="${this.defaultClass}"><div class="ddv-palette-color-grid">${this.getColorTemplate()}</div></div>`;this.template=l}}const UF=["Arial","Courier","Helvetica","Times New Roman"],Jg=Vn.displayResolution/Vn.dataResolution;class NPe extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-palette-font-panel"),N(this,"fontFamilyEl",void 0),N(this,"fontSizeEl",void 0),N(this,"fontList",[...UF]),N(this,"inputIsBlur",!0),N(this,"currentFontSizeValue",void 0),N(this,"isArrowKeyPressed",!1),N(this,"maxFontSize",72),this.maxFontSize=l.data.maxFontSize,this.maxFontSize<72&&(this.maxFontSize=72),this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",u=>{"fontFamily"!==u&&this.toggleSelect("fontFamily",!1),"fontSize"!==u&&this.toggleSelect("fontSize",!1)}),this.$on("ui_changePalette_type",u=>{this.el.style.display="text"===u?"":"none"}),this.$on("ui_addFont",u=>{this.addFont(u)})}updateTextStyle(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{toolMode:f,annotationMode:g}=this.injection.viewer.getViewerConfig(),m=this.injection.viewer.getSelectedAnnotations();if(1!==m.length||"textTypewriter"!==m[0].type&&"textBox"!==m[0].type)"annotation"!==f||"textBox"!==g&&"textTypewriter"!==g||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[g]:{textContent:l}}});else{const{uid:v,type:_}=m[0],b=this.injection.viewer.getAnnotationObject(v);if(b.isEditMode)b.hasSelectedChars&&(this.injection.viewer.updateAnnotation(v,{style:{textContents:a5(b,l)}},["appearanceChanged"]),b.textEditEventHandler.updateTextSelection());else{const S=s5(b,l);S.length&&this.injection.viewer.updateAnnotation(v,{style:{textContents:S}},["appearanceChanged"])}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[_]:{textContent:l}}})}u&&this.focusTexture()}bindHooks(){this.hooks.created.on(()=>{this.fontFamilyEl=this.el.querySelector(".ddv-palette-font-family"),this.fontSizeEl=this.el.querySelector(".ddv-palette-font-size")}),this.hooks.inserted.on(()=>{this.bindToggleEvent(),this.bindSelectEvent(),this.bindFontSizeInputEvent(),this.bindTextAlignEvents(),this.bineFontStyleEvents()})}bindToggleEvent(){const l=this.fontSizeEl.querySelector(".ddv-down-arrow");Xo(this.fontFamilyEl,"click",this).on(u=>{u.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontFamily"),this.toggleSelect("fontFamily")},this),Xo(l,"click",this).on(u=>{u.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontSize"),this.toggleSelect("fontSize")},this)}bindSelectEvent(){const l=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),u=this.fontSizeEl.querySelector(".ddv-palette-font-size-select");l.addEventListener("click",f=>{f.stopPropagation(),this.toggleSelect("fontFamily",!1);const g=f.target.value;g&&this.updateTextStyle({fontFamily:g})}),u.addEventListener("click",f=>{f.stopPropagation(),this.toggleSelect("fontSize",!1);const g=f.target.value;g&&this.updateTextStyle({fontSize:ni(g).value*Jg})})}bindFontSizeInputEvent(){const l=this.fontSizeEl.getElementsByTagName("input")[0];l.addEventListener("keydown",f=>{f.stopPropagation(),"ArrowUp"!==f.key&&"ArrowDown"!==f.key||(this.isArrowKeyPressed=!0)}),l.addEventListener("keyup",f=>{if(f.stopPropagation(),this.isArrowKeyPressed){let g=Math.round(ni(l.value).value);g>this.maxFontSize&&(g=this.maxFontSize,l.value=`${this.maxFontSize}`),g<1&&(g=1,l.value="1"),this.updateTextStyle({fontSize:g*Jg},!1),this.isArrowKeyPressed=!1}}),l.addEventListener("focus",()=>{const g=ni(l.value).value;l.value=g,l.type="number",this.inputIsBlur=!1,this.currentFontSizeValue=g,this.$emit("ui_shrinkSelectionBox")}),l.addEventListener("blur",f=>{this.inputIsBlur=!0,"text"!==l.type&&(this.currentFontSizeValue=l.value,l.type="text",l.value+="pt",f.relatedTarget instanceof HTMLInputElement||this.focusTexture())});const u=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;l.type="text",l.value+="pt",l.removeEventListener("change",u),l.blur(),l.addEventListener("change",u);let f=Math.round(ni(l.value).value);f>this.maxFontSize&&(f=this.maxFontSize),f<1&&(f=1),this.updateTextStyle({fontSize:f*Jg})};l.addEventListener("change",u)}bindTextAlignEvents(){const l=this.el.querySelector(".ddv-align-left"),u=this.el.querySelector(".ddv-align-center"),f=this.el.querySelector(".ddv-align-right"),g=this.el.querySelector(".ddv-justify-center"),m=v=>{const{toolMode:_,annotationMode:b}=this.injection.viewer.getViewerConfig(),S=this.injection.viewer.getSelectedAnnotations();1!==S.length||"textTypewriter"!==S[0].type&&"textBox"!==S[0].type?"annotation"!==_||"textBox"!==b&&"textTypewriter"!==b||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[b]:{textAlign:v}}}):this.injection.viewer.updateAnnotation(S[0].uid,{style:{textAlign:v}},["appearanceChanged"])};l.addEventListener("click",()=>{m("left")}),u.addEventListener("click",()=>{m("center")}),f.addEventListener("click",()=>{m("right")}),g.addEventListener("click",()=>{m("justify")})}bineFontStyleEvents(){const l=this.el.querySelector(".ddv-bold"),u=this.el.querySelector(".ddv-italic"),f=this.el.querySelector(".ddv-underline"),g=this.el.querySelector(".ddv-line-through");l.addEventListener("click",()=>{this.updateTextStyle({fontWeight:l.classList.contains("ddv-button-activated-light")?"normal":"bold"})}),u.addEventListener("click",()=>{this.updateTextStyle({fontStyle:u.classList.contains("ddv-button-activated-light")?"normal":"italic"})}),f.addEventListener("click",()=>{this.updateTextStyle({underline:!f.classList.contains("ddv-button-activated-light")})}),g.addEventListener("click",()=>{this.updateTextStyle({lineThrough:!g.classList.contains("ddv-button-activated-light")})})}bindViewerHooks(){const{viewer:l}=this.injection;l.hooks.selectedAnnotationsChanged.on(u=>{if(1!==u.newAnnotationUids.length)return;const f=l.getSelectedAnnotations()[0];if("textTypewriter"!==f.type&&"textBox"!==f.type)return;this.showTextAlignList("textBox"===f.type),this.selectTextAlign(f.style.textAlign||"left");const{defaultStyleConfig:g}=this.injection.viewer.getAnnotationConfig(),{textContent:m}=g[f.type],v=f.style.textContents.length?f.style.textContents[0]:m,{fontFamily:_,fontSize:b,fontWeight:S,fontStyle:I,underline:k,lineThrough:O}=v;this.selectFontStyle(_,Math.round(ni(b).value/Jg),"bold"===S,"italic"===I,k,O)},this),l.hooks.annotationDefaultStyleChanged.on(u=>{const{toolMode:f,annotationMode:g}=this.injection.viewer.getViewerConfig(),m=this.injection.viewer.getSelectedAnnotations();let v,_,b=!1;if("annotation"!==f||"textBox"!==g&&"textTypewriter"!==g||(b=!0,v=g),1===m.length){const Q=this.injection.viewer.getAnnotationObject(m[0].uid);Q instanceof or&&(v=m[0].type,_=m[0].style.textAlign,Q.isEditMode&&!Q.hasSelectedChars?b=!0:Q.isEditMode||Q.style.textContents.length?(this.selectTextAlign(_),b=!1):b=!0)}if(!b)return;const{textAlign:S}=u[v],{fontFamily:I,fontSize:k,fontWeight:O,fontStyle:j,underline:W,lineThrough:J}=u[v].textContent||{},{textContent:K}=qi;this.selectTextAlign(_||S||qi.textAlign),this.selectFontStyle(I||K.fontFamily,Math.round(ni(k||K.fontSize).value/Jg),"bold"===(O||K.fontWeight),"italic"===(j||K.fontStyle),W||K.underline,J||K.lineThrough)},this),l.hooks.annotationTextCharsSelected.on(u=>{const f=u.freeTextContentStyle,{fontFamily:g,fontSize:m,fontStyle:v,fontWeight:_,underline:b,lineThrough:S}=f;this.selectFontStyle(g,Math.round(ni(m).value/Jg),"bold"===_,"italic"===v,b,S)},this),l.hooks.annotationsUpdated.on(u=>{const{actions:f,uids:g}=u,m=this.injection.viewer.getSelectedAnnotations();if(f.includes("appearanceChanged")&&1===m.length&&g.includes(m[0].uid)&&("textTypewriter"===m[0].type||"textBox"===m[0].type)&&(this.selectTextAlign(m[0].style.textAlign||"left"),!this.injection.viewer.getAnnotationObject(m[0].uid).isEditMode&&m[0].style.textContents.length)){const{fontFamily:v,fontSize:_,fontWeight:b,fontStyle:S,underline:I,lineThrough:k}=m[0].style.textContents[0];this.selectFontStyle(v,Math.round(ni(_).value/Jg),"bold"===b,"italic"===S,I,k)}},this),l.hooks.annotationModeChanged.on(u=>{if(!l.getSelectedAnnotations().length&&["textBox","textTypewriter"].includes(u.newAnnotationMode)){this.showTextAlignList("textBox"===u.newAnnotationMode);const{defaultStyleConfig:f}=this.injection.viewer.getAnnotationConfig(),{textContent:g,textAlign:m}=f[u.newAnnotationMode],{fontFamily:v,fontSize:_,fontWeight:b,fontStyle:S,underline:I,lineThrough:k}=g;this.selectTextAlign(m),this.selectFontStyle(v,Math.round(ni(_).value/Jg),"bold"===b,"italic"===S,I,k)}},this),l.hooks.toolModeChanged.on(u=>{if("annotation"!==u.newToolMode)return;const{annotationMode:f}=l.getViewerConfig();["textBox","textTypewriter"].includes(f)&&this.showTextAlignList("textBox"===f)},this)}toggleSelect(l,u){const g="fontFamily"===l?this.fontFamilyEl:this.fontSizeEl,m=g.querySelector("."+("fontFamily"===l?"ddv-palette-font-family-select":"ddv-palette-font-size-select")),v=g.querySelector(".ddv-down-arrow"),_="none"!==m.style.display,b=pt(u)?!_:u,S=this.injection.viewer.context.viewService.mainContainer;_!==b&&(b?(m.style.display="block",m.style.top=`${BF(m,S)}px`,v.style.transform="rotate(180deg)","fontSize"===l&&this.scrollFontSizeSelect()):(m.style.display="none",v.style.transform=""))}getFontFamilySelectTemplate(){let l="";for(let u=0;u<UF.length;u++){const f=UF[u];l+=`<button style="font-family:${f}" value="${f}">${f}</button>`}return`<div class="ddv-palette-font-family"><span>Helvetica</span><i class="ddv-down-arrow"></i><div class="ddv-palette-font-family-select" style="display: none;">${l}</div></div>`}getFontSizeTemplate(){let l="";for(let u=1;u<=12;u++)l+=`<button value="${u}">${u}pt</button>`;for(let u=14;u<=36;u+=2)l+=`<button value="${u}">${u}pt</button>`;for(let u=40;u<=72;u+=4)l+=`<button value="${u}">${u}pt</button>`;if(this.maxFontSize>72){let u=72;for(;u+8<this.maxFontSize;)u+=8,l+=`<button value="${u}">${u}pt</button>`;l+=`<button value="${this.maxFontSize}">${this.maxFontSize}pt</button>`}return`<div class="ddv-palette-font-size"><input type="string"/><i class="ddv-down-arrow"></i><div class="ddv-palette-font-size-select" style="display: none;">${l}</div></div>`}selectTextAlign(l){const u=this.el.querySelector(".ddv-align-left"),f=this.el.querySelector(".ddv-align-center"),g=this.el.querySelector(".ddv-align-right"),m=this.el.querySelector(".ddv-justify-center");Xu(u,"left"===l,"light"),Xu(f,"center"===l,"light"),Xu(g,"right"===l,"light"),Xu(m,"justify"===l,"light")}selectFontStyle(l,u,f,g,m,v){const _=this.fontFamilyEl.getElementsByTagName("span")[0],b=this.fontSizeEl.getElementsByTagName("input")[0],S=this.el.querySelector(".ddv-bold"),I=this.el.querySelector(".ddv-italic"),k=this.el.querySelector(".ddv-underline"),O=this.el.querySelector(".ddv-line-through");_.innerText=l,this.isArrowKeyPressed||("number"===b.type&&(b.type="text"),this.currentFontSizeValue=u,b.value=`${u}pt`),Xu(S,f,"light"),Xu(I,g,"light"),Xu(k,m,"light"),Xu(O,v,"light")}focusTexture(){const l=this.injection.viewer.getSelectedAnnotations();if(1===l.length){const u=this.injection.viewer.getAnnotationObject(l[0].uid);u instanceof or&&u.isEditMode&&u.focusTexture()}}addFont(l){if(this.fontList.includes(l))return;this.fontList.push(l);const u=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),f=document.createElement("button");f.style.fontFamily=l,f.value=l,f.innerText=l,u.appendChild(f)}showTextAlignList(l){const u=this.el.querySelector(".ddv-text-align-list");u&&(u.style.display=l?"":"none")}scrollFontSizeSelect(){if(!this.fontSizeEl)return;const l=this.fontSizeEl.querySelector(".ddv-palette-font-size-select"),{currentFontSizeValue:u}=this;let f=0;for(let g=0;g<l.children.length;g++){const m=l.children[g];if(!(u>=m.value))break;f=m.offsetTop}l.scrollTo(0,f)}initTemplate(){const l=`<div class="${this.defaultClass}"><div style="display:flex; justify-content: space-between; position:relative; z-index:2">${this.getFontFamilySelectTemplate()}${this.getFontSizeTemplate()}</div><div><div class="ddv-button ddv-bold"></div><div class="ddv-button ddv-italic"></div><div class="ddv-button ddv-underline"></div><div class="ddv-button ddv-line-through"></div></div><div class="ddv-text-align-list"><div class="ddv-button ddv-align-left"></div><div class="ddv-button ddv-align-center"></div><div class="ddv-button ddv-align-right"></div><div class="ddv-button ddv-justify-center"></div></div></div>`;this.template=l}}const Lee=["None","ClosedArrow","OpenArrow","ROpenArrow","RClosedArrow","Butt","Circle","Diamond","Square","Slash"],BPe=[[0,0],[3,3],[5,5],[7,7],[7,6,3,6],[5,4,21,4],[11,5,5,5]],Nee={None:"ddv-solid",OpenArrow:"ddv-line-open",ROpenArrow:"ddv-line-r-open",ClosedArrow:"ddv-line-closed",RClosedArrow:"ddv-line-r-closed",Butt:"ddv-line-butt",Square:"ddv-line-square",Diamond:"ddv-line-diamond",Circle:"ddv-line-circle",Slash:"ddv-line-slash"},WPe={33:"ddv-dashed-33",55:"ddv-dashed-55",77:"ddv-dashed-77",7636:"ddv-dashed-7636",54214:"ddv-dashed-54214",11555:"ddv-dashed-11555"};class UPe extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-palette-line-panel"),N(this,"commonClass","ddv-palette-line-panel-common"),N(this,"LineStyleClass","ddv-palette-border-style"),N(this,"lineStyleClassSmall","ddv-palette-border-style-small"),N(this,"startLineEndingClass","ddv-palette-line-start"),N(this,"endLineEndingClass","ddv-palette-line-end"),N(this,"selectionClass","ddv-palette-line-panel-selection"),N(this,"startLineEndingSelect",void 0),N(this,"borderStyleSelect",void 0),N(this,"endLineEndingSelect",void 0),N(this,"isStrokePalette",void 0),this.bindHooks(),this.initTemplate(),this.$on("ui_shrinkSelectionBox",u=>{"lineEndingStart"!==u&&this.toggleSelect(0,!1),"borderStyle"!==u&&this.toggleSelect(1,!1),"lineEndingEnd"!==u&&this.toggleSelect(2,!1)}),this.$on("ui_changePalette_type",u=>{this.el.style.display="stroke"===u?"":"none",this.isStrokePalette="stroke"===u;const{toolMode:f,annotationMode:g}=this.injection.viewer.getViewerConfig(),m=this.injection.viewer.getSelectedAnnotations();("annotation"===f&&"ink"===g||1===m.length&&"ink"===m[0].type)&&(this.el.style.display="none")})}bindHooks(){this.hooks.inserted.on(()=>{const l=this.el.querySelectorAll(`.${this.commonClass}`);this.startLineEndingSelect=l[0],this.borderStyleSelect=l[1],this.endLineEndingSelect=l[2],this.bindViewerHooks(),this.bindToggleEvent(),this.bindSelectEvent()})}bindSelectEvent(){const l=this.startLineEndingSelect.querySelector(`.${this.selectionClass}`),u=this.borderStyleSelect.querySelector(`.${this.selectionClass}`),f=this.endLineEndingSelect.querySelector(`.${this.selectionClass}`),g=(m,v)=>{const _=v.target,b="BUTTON"===_.tagName?_:_.parentNode;return Array.from(m.childNodes).indexOf(b)||0};l.addEventListener("click",m=>{const v=g(l,m),_=Lee[v]||"None";this.updateLineEndingByData(!0,_),this.updateDefaultLineEnding(!0,_)}),u.addEventListener("click",m=>{const v=g(u,m),_=BPe[v]||[0,0];this.updateLineDashByData(_),this.updateDefaultLineDash(_)}),f.addEventListener("click",m=>{const v=g(f,m),_=Lee[v]||"None";this.updateLineEndingByData(!1,_),this.updateDefaultLineEnding(!1,_)})}bindToggleEvent(){this.startLineEndingSelect.addEventListener("click",l=>{l.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingStart"),this.toggleSelect(0)}),this.borderStyleSelect.addEventListener("click",l=>{l.stopPropagation(),this.$emit("ui_shrinkSelectionBox","borderStyle"),this.toggleSelect(1)}),this.endLineEndingSelect.addEventListener("click",l=>{l.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingEnd"),this.toggleSelect(2)})}bindViewerHooks(){const l=this.injection.viewer,u=(f,g,m,v)=>{if(this.startLineEndingSelect.style.display=f?"":"none",this.endLineEndingSelect.style.display=f?"":"none",this.borderStyleSelect.classList.remove(f?this.LineStyleClass:this.lineStyleClassSmall),this.borderStyleSelect.classList.add(f?this.lineStyleClassSmall:this.LineStyleClass),f){const[_,b]=m;this.updateLineEndingSelect(!0,Nee[_]||"ddv-solid"),this.updateLineEndingSelect(!1,Nee[b]||"ddv-solid")}this.el.style.display=v||!this.isStrokePalette?"none":"",this.updateBorderStyleSelect(g||[0,0])};l.hooks.selectedAnnotationsChanged.on(f=>{var g,m;if(1!==f.newAnnotationUids.length)return;const v=l.getSelectedAnnotations()[0];v&&u("line"===v.type||"polyline"===v.type,null===(g=v.style)||void 0===g?void 0:g.lineDash,null===(m=v.style)||void 0===m?void 0:m.lineEnding,"ink"===v.type||"stamp"===v.type)},this),l.hooks.annotationModeChanged.on(f=>{const g=f.newAnnotationMode,m="polyline"===g||"line"===g,v="ink"===g;if("select"!==g&&"erase"!==g&&"stamp"!==g){var _,b;const{defaultStyleConfig:S}=this.injection.viewer.getAnnotationConfig(),I=(null===(_=S[g])||void 0===_?void 0:_.lineEnding)||(null==qi?void 0:qi.lineEnding),k=(null===(b=S[g])||void 0===b?void 0:b.lineDash)||(null==qi?void 0:qi.lineDash);u(m,k,I,v)}},this),l.hooks.annotationDefaultStyleChanged.on(f=>{var g;const{toolMode:m,annotationMode:v}=this.injection.viewer.getViewerConfig();if("annotation"!==m||"select"===v||"erase"===v||"stamp"===v||l.getSelectedAnnotations().length)return;const{defaultStyleConfig:_}=this.injection.viewer.getAnnotationConfig(),I=(null===(g=_[v])||void 0===g?void 0:g.lineEnding)||qi.lineEnding;u("line"===v||"polyline"===v,_[v].lineDash||qi.lineDash,I,"ink"===v)},this),l.hooks.annotationsUpdated.on(f=>{const{actions:g,uids:m}=f,v=l.getSelectedAnnotations();g.includes("appearanceChanged")&&1===v.length&&m.includes(v[0].uid)&&"ink"!==v[0].type&&"stamp"!==v[0].type&&u("line"===v[0].type||"polyline"===v[0].type,v[0].style.lineDash||[0,0],v[0].style.lineEnding||["None","None"],!1)},this)}toggleSelect(l,u){let f=this.borderStyleSelect;0===l?f=this.startLineEndingSelect:2===l&&(f=this.endLineEndingSelect);const g=f.querySelector(`.${this.selectionClass}`),m=f.querySelector(".ddv-down-arrow"),v="none"!==g.style.display,_=pt(u)?!v:u,b=this.injection.viewer.context.viewService.mainContainer;v!==_&&(_?(g.style.display="block",g.style.top=`${BF(g,b)}px`,m.style.transform="rotate(180deg)"):(g.style.display="none",m.style.transform=""))}updateLineEndingSelect(l,u){(l?this.startLineEndingSelect:this.endLineEndingSelect).querySelector("div").className=`ddv-button ${u}`}updateBorderStyleSelect(l){const u=this.borderStyleSelect,f=l.join("")||"0",g=u.querySelector("div");let m="ddv-solid";(function(v){if(0===v.length)return!0;if(1===v.length)return 0===v[0];v.length%2!=0&&(v=v.concat(v));for(let _=1;_<v.length;_+=2)if(0!==v[_])return!1;return!0})(l)||(m=WPe[f]||"ddv-dashed-33"),g.className=`ddv-button ${m}`}updateLineDashByData(l){const u=this.injection.viewer.getSelectedAnnotations();1===u.length&&(u[0].style.lineDash||[0,0]).toString()!==l.toString()&&this.injection.viewer.updateAnnotation(u[0].uid,{style:{lineDash:l}},["appearanceChanged"])}updateLineEndingByData(l,u){const f=this.injection.viewer.getSelectedAnnotations();if(1!==f.length)return;const g=f[0].style.lineEnding||["None","None"];l&&u===g[0]||!l&&u===g[1]||this.injection.viewer.updateAnnotation(f[0].uid,{style:{lineEnding:l?[u,g[1]]:[g[0],u]}},["appearanceChanged"])}updateDefaultLineEnding(l,u){var f;const{annotationMode:g}=this.injection.viewer.getViewerConfig(),m=this.injection.viewer.getSelectedAnnotations(),{defaultStyleConfig:v}=this.injection.viewer.getAnnotationConfig();let _=(null===(f=v[g])||void 0===f?void 0:f.lineEnding)||qi.lineEnding,b=g;m.length&&m[0]&&(_=m[0].style.lineEnding,b=m[0].type);const S=[..._];l?S[0]=u:S[1]=u,this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[b]:{lineEnding:S}}})}updateDefaultLineDash(l){const{annotationMode:u}=this.injection.viewer.getViewerConfig(),f=this.injection.viewer.getSelectedAnnotations();let g=u;f.length&&f[0]&&(g=f[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[g]:{lineDash:l}}})}getBaseLineDashTemplate(){const l=["ddv-solid","ddv-dashed-33","ddv-dashed-55","ddv-dashed-77","ddv-dashed-7636","ddv-dashed-54214","ddv-dashed-11555"];let u="";for(let f=0;f<l.length;f++)u+=`<button><i class="ddv-button ${l[f]}"></i></button>`;return`<div class="${this.commonClass} ${this.lineStyleClassSmall}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${u}</div></div>`}getLineEndingTemplate(l){const u=["ddv-solid","ddv-line-closed","ddv-line-open","ddv-line-r-open","ddv-line-r-closed","ddv-line-butt","ddv-line-circle","ddv-line-diamond","ddv-line-square","ddv-line-slash"];let f="";for(let m=0;m<u.length;m++)f+=`<button><i class="ddv-button ${u[m]}"></i></button>`;return`<div class="${this.commonClass} ${l?this.startLineEndingClass:this.endLineEndingClass}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${f}</div></div>`}initTemplate(){const{label:l}=this.data,u=`<div class="${this.defaultClass}"><span>${l}</span><div style="margin-top:10px">${this.getLineEndingTemplate(!0)}${this.getBaseLineDashTemplate()}${this.getLineEndingTemplate(!1)}</div></div>`;this.template=u}}class VPe extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-palette-opacity-panel"),N(this,"isPointerDown",!1),N(this,"lastPointerValue",void 0),N(this,"range",void 0),N(this,"input",void 0),N(this,"inputIsBlur",!0),N(this,"isArrowKeyPressed",!1),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.inserted.on(()=>{this.range=this.el.querySelector(".ddv-palette-opacity-range"),this.input=this.el.querySelector(".ddv-palette-opacity-input"),fee(this.range,0,100),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent()})}bineInputEvent(){const{input:l}=this;l.addEventListener("keydown",f=>{f.stopPropagation(),"ArrowUp"!==f.key&&"ArrowDown"!==f.key||(this.isArrowKeyPressed=!0)}),l.addEventListener("keyup",f=>{if(f.stopPropagation(),this.isArrowKeyPressed){const g=Tv(l.value).value;g>100&&(l.value=100),g<0&&(l.value=0);let m=parseInt(l.value,10);Xt(m)||(m=100,this.updateInput(100)),this.updateDefaultOpacity(m),this.updateOpacityByData(m),this.isArrowKeyPressed=!1}}),l.addEventListener("focus",()=>{const g=Tv(l.value).value;l.value=g,l.type="number",this.inputIsBlur=!1}),l.addEventListener("blur",f=>{this.inputIsBlur=!0,f.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==l.type&&(l.type="text",l.value+="%")});const u=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;l.type="text",l.value+="%",l.removeEventListener("change",u),l.blur(),l.addEventListener("change",u);const f=Tv(l.value).value;f>100&&(l.value=100),f<0&&(l.value=0);let g=parseInt(l.value,10);Xt(g)||(g=100,this.updateInput(100)),this.updateDefaultOpacity(g),this.updateOpacityByData(g)};l.addEventListener("change",u)}bindRangeEvent(){const{range:l}=this,u=()=>{const f=parseInt(l.value,10);this.updateOpacityByShape(f),this.input.value=`${f}%`;const{toolMode:g,annotationMode:m}=this.injection.viewer.getViewerConfig();"annotation"===g&&"select"!==m&&"erase"!==m&&this.updateInput(f)};l.addEventListener("click",()=>{const f=parseInt(l.value,10);f!==this.lastPointerValue&&(this.updateOpacityByData(f),this.updateDefaultOpacity(f))}),l.addEventListener("pointerdown",f=>{f.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox"),u()}),l.addEventListener("pointermove",()=>{this.isPointerDown&&u()}),l.addEventListener("pointerup",()=>{if(this.isPointerDown){const f=parseInt(l.value,10);this.lastPointerValue=f,this.updateOpacityByData(f),this.updateDefaultOpacity(f)}this.isPointerDown=!1}),l.addEventListener("keydown",f=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(f.key)&&u()}),l.addEventListener("keyup",f=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(f.key)){const g=parseInt(l.value,10);this.updateOpacityByData(g),this.updateDefaultOpacity(g)}})}bindViewerHooks(){const l=this.injection.viewer,u=()=>{const{annotationMode:f}=this.injection.viewer.getViewerConfig();if("select"===f||"erase"===f)return;const{defaultStyleConfig:g}=this.injection.viewer.getAnnotationConfig(),m=Xt(g[f].opacity)?g[f].opacity:qi.opacity;this.updateInput(Math.round(100*m))};l.hooks.selectedAnnotationsChanged.on(f=>{if(1!==f.newAnnotationUids.length)return;const g=l.getSelectedAnnotations()[0];g&&this.updateInput(Math.round(100*g.style.opacity))},this),l.hooks.annotationsUpdated.on(f=>{const{actions:g,uids:m}=f,v=l.getSelectedAnnotations();g.includes("appearanceChanged")&&1===v.length&&m.includes(v[0].uid)&&this.updateInput(Math.round(100*v[0].style.opacity))},this),l.hooks.annotationModeChanged.on(f=>{u()},this),l.hooks.toolModeChanged.on(f=>{"annotation"===f.newToolMode&&u()},this),l.hooks.annotationDefaultStyleChanged.on(f=>{const{toolMode:g,annotationMode:m}=this.injection.viewer.getViewerConfig();if("annotation"!==g||"select"===m||"erase"===m||l.getSelectedAnnotations().length)return;const{defaultStyleConfig:v}=this.injection.viewer.getAnnotationConfig(),_=Xt(v[m].opacity)?v[m].opacity:qi.opacity;this.updateInput(100*_)},this)}updateInput(l){let u=l;l>100&&(u=100),l<0&&(u=0),u=Math.round(u),this.range.value=`${u}`,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?u:`${u}%`}updateOpacityByShape(l){const u=this.injection.viewer.getSelectedAnnotations();if(1!==u.length)return;const f=this.injection.viewer.getAnnotationObject(u[0].uid);if(!f)return;const g=100*f.style.opacity;(l=Math.round(l))!==g&&(f.style.opacity=l/100,this.injection.viewer.context.render())}updateOpacityByData(l){const u=this.injection.viewer.getSelectedAnnotations();if(1!==u.length)return;const f=100*u[0].style.opacity;(l=Math.round(l))!==f&&this.injection.viewer.updateAnnotation(u[0].uid,{style:{opacity:l/100}},["appearanceChanged"])}updateDefaultOpacity(l){const{annotationMode:u}=this.injection.viewer.getViewerConfig(),f=this.injection.viewer.getSelectedAnnotations();let g=u;f.length&&f[0]&&(g=f[0].type),l=Math.round(l),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[g]:{opacity:l/100}}})}focusTexture(){const l=this.injection.viewer.getSelectedAnnotations();if(1===l.length){const u=this.injection.viewer.getAnnotationObject(l[0].uid);u instanceof or&&u.isEditMode&&u.focusTexture()}}initTemplate(){const{label:l}=this.data;this.template=`<div class="${this.defaultClass}"><span>${l}</span><div class="ddv-palette-opacity-range-container"><input class="ddv-palette-opacity-range" type="range" min="0" max="100" value="100"/><input class="ddv-palette-opacity-input" type="string" value="100%"/></div></div>`}}const Bee=[Pi.DRAFT,Pi.FINAL,Pi.VOID,Pi.REJECTED,Pi.ACCEPTED,Pi.APPROVED,Pi.NOT_APPROVED,Pi.COMPLETED,Pi.CONFIDENTIAL,Pi.INITIAL_HERE,Pi.SIGN_HERE,Pi.WITNESS];class jPe extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-palette-stamp-panel"),N(this,"select",void 0),N(this,"selectBox",void 0),N(this,"iconName",Pi.DRAFT),this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",u=>{"stampIcon"!==u&&this.toggleSelect(!1)})}bindHooks(){this.hooks.inserted.on(()=>{this.select=this.el.querySelector(".ddv-palette-stamp-icon"),this.selectBox=this.el.querySelector(".ddv-palette-stamp-icon-select"),this.bindToggleEvent(),this.bindSelectEvent()})}bindToggleEvent(){this.select.addEventListener("click",l=>{l.stopPropagation(),this.$emit("ui_shrinkSelectionBox","stampIcon"),this.toggleSelect()})}bindSelectEvent(){this.selectBox.addEventListener("click",l=>{this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{stampIcon:l.target.value}}})})}bindViewerHooks(){const l=this.injection.viewer,u=()=>{var f;const{toolMode:g,annotationMode:m}=l.getViewerConfig(),v=l.getAnnotationConfig();this.el.style.display="annotation"!==g||"stamp"!==m||null!==(f=v.defaultStyleConfig)&&void 0!==f&&null!==(f=f.stamp)&&void 0!==f&&f.imageData?"none":""};this.hooks.inserted.on(()=>{u();const{defaultStyleConfig:f}=l.getAnnotationConfig(),{stamp:g}=f;this.updateStampSpan((null==g?void 0:g.stampIcon)||(null==qi?void 0:qi.stampIcon))}),l.hooks.annotationDefaultStyleChanged.on(f=>{u();const{stamp:g}=f,m=(null==g?void 0:g.stampIcon)||(null==qi?void 0:qi.stampIcon);m!==this.iconName&&this.updateStampSpan(m)},this),l.hooks.toolModeChanged.on(u,this),l.hooks.annotationModeChanged.on(u,this)}toggleSelect(l){const u=this.select.querySelector(".ddv-down-arrow"),f="none"!==this.selectBox.style.display,g=pt(l)?!f:l,m=this.injection.viewer.context.viewService.mainContainer;f!==g&&(g?(this.selectBox.style.display="block",this.selectBox.style.top=`${BF(this.selectBox,m)}px`,u.style.transform="rotate(180deg)"):(this.selectBox.style.display="none",u.style.transform=""))}updateStampSpan(l){this.el.getElementsByTagName("span")[1].innerText=l.slice(2),this.iconName=l}getStampIconSelectTemplate(){let l="";for(let u=0;u<Bee.length;u++){const f=Bee[u];l+=`<button value="${f}">${f.slice(2)}</button>`}return`<div class="ddv-palette-stamp-icon"><span>${Pi.DRAFT.slice(2)}</span><i class="ddv-down-arrow"></i><div class="ddv-palette-stamp-icon-select" style="display: none;">${l}</div></div>`}initTemplate(){const{label:l}=this.data,u=`<div class="${this.defaultClass}"><span>${l}</span>${this.getStampIconSelectTemplate()}</div>`;this.template=u}}const Gv=Vn.displayResolution/Vn.dataResolution;class HPe extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-palette-stroke-panel"),N(this,"isPointerDown",!1),N(this,"lastPointerValue",void 0),N(this,"range",void 0),N(this,"input",void 0),N(this,"inputIsBlur",!0),N(this,"isArrowKeyPressed",!1),N(this,"maxBorderWidth",20),this.maxBorderWidth=l.data.maxBorderWidth,this.maxBorderWidth<20&&(this.maxBorderWidth=20),this.initTemplate(),this.bindHooks(),this.$on("ui_changePalette_type",u=>{this.el.style.display="stroke"===u?"":"none"})}bindHooks(){this.hooks.inserted.on(()=>{this.range=this.el.querySelector(".ddv-palette-stroke-range"),this.input=this.el.querySelector(".ddv-palette-stroke-input"),fee(this.range,0,this.maxBorderWidth),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent()})}bineInputEvent(){const{input:l}=this;l.addEventListener("keydown",f=>{f.stopPropagation(),"ArrowUp"!==f.key&&"ArrowDown"!==f.key||(this.isArrowKeyPressed=!0)}),l.addEventListener("keyup",f=>{if(f.stopPropagation(),this.isArrowKeyPressed){const g=ni(l.value).value;g>this.maxBorderWidth&&(l.value=this.maxBorderWidth),g<0&&(l.value=0);let m=parseInt(l.value,10);Xt(m)||(m=1,this.updateInput(1*Gv)),this.updateDefaultBorderWidth(m),this.updateBorderWidthByData(m),this.isArrowKeyPressed=!1}}),l.addEventListener("focus",()=>{const g=parseFloat(l.value);l.value=g,l.type="number",this.inputIsBlur=!1}),l.addEventListener("blur",f=>{this.inputIsBlur=!0,f.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==l.type&&(l.type="text",l.value+="pt")});const u=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;l.type="text",l.value+="pt",l.removeEventListener("change",u),l.blur(),l.addEventListener("change",u);const f=ni(l.value).value;f>this.maxBorderWidth&&(l.value=this.maxBorderWidth),f<0&&(l.value=0);let g=parseInt(l.value,10);Xt(g)||(g=1,this.updateInput(1*Gv)),this.updateDefaultBorderWidth(g),this.updateBorderWidthByData(g)};l.addEventListener("change",u)}bindRangeEvent(){const{range:l}=this,u=()=>{const f=ni(l.value).value;this.updateBorderWidthByShape(f),this.input.value=`${f}pt`;const{toolMode:g,annotationMode:m}=this.injection.viewer.getViewerConfig();"annotation"===g&&"select"!==m&&"erase"!==m&&this.updateInput(f*Gv)};l.addEventListener("click",()=>{const f=ni(l.value).value;f!==this.lastPointerValue&&(this.updateBorderWidthByData(f),this.updateDefaultBorderWidth(f))}),l.addEventListener("pointerdown",f=>{f.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox"),u()}),l.addEventListener("pointermove",()=>{this.isPointerDown&&u()}),l.addEventListener("pointerup",()=>{if(this.isPointerDown){const f=ni(l.value).value;this.lastPointerValue=f,this.updateBorderWidthByData(f),this.updateDefaultBorderWidth(f)}this.isPointerDown=!1}),l.addEventListener("keydown",f=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(f.key)&&u()}),l.addEventListener("keyup",f=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(f.key)){const g=ni(l.value).value;this.updateBorderWidthByData(g),this.updateDefaultBorderWidth(g)}})}bindViewerHooks(){const l=this.injection.viewer,u=()=>{const{annotationMode:f}=this.injection.viewer.getViewerConfig();if("select"===f||"erase"===f)return;const{defaultStyleConfig:g}=this.injection.viewer.getAnnotationConfig(),m=Xt(g[f].borderWidth)?g[f].borderWidth:qi.borderWidth;this.updateInput(m)};l.hooks.selectedAnnotationsChanged.on(f=>{if(1!==f.newAnnotationUids.length)return;const g=l.getSelectedAnnotations()[0];g&&this.updateInput(ni(g.style.borderWidth).value,!0)},this),l.hooks.annotationsUpdated.on(f=>{const{actions:g,uids:m}=f,v=l.getSelectedAnnotations();g.includes("appearanceChanged")&&1===v.length&&m.includes(v[0].uid)&&this.updateInput(ni(v[0].style.borderWidth).value)},this),l.hooks.annotationModeChanged.on(f=>{u()},this),l.hooks.toolModeChanged.on(f=>{"annotation"===f.newToolMode&&u()},this),l.hooks.annotationDefaultStyleChanged.on(f=>{const{toolMode:g,annotationMode:m}=this.injection.viewer.getViewerConfig();if("annotation"!==g||"select"===m||"erase"===m||"stamp"===m||l.getSelectedAnnotations().length)return;const{defaultStyleConfig:v}=this.injection.viewer.getAnnotationConfig(),_=Xt(v[m].borderWidth)?v[m].borderWidth:qi.borderWidth;this.updateInput(_)},this)}updateInput(l,u){let f=l/Gv;this.isPointerDown||u?f=Math.round(f):(f=f.toFixed(1),f.endsWith(".0")&&(f=parseInt(f,10))),this.range.value=f,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?parseFloat(f):`${f}pt`}updateBorderWidthByShape(l){const u=this.injection.viewer.getSelectedAnnotations();if(1!==u.length)return;const f=this.injection.viewer.getAnnotationObject(u[0].uid);if(!f)return;const g=l*Gv,{borderWidth:m}=f.style;m!==g&&(f.style.borderWidth=g,this.injection.viewer.context.render())}updateBorderWidthByData(l){const u=this.injection.viewer.getSelectedAnnotations();if(1!==u.length)return;const f=l*Gv,{borderWidth:g}=u[0].style;g!==f&&this.injection.viewer.updateAnnotation(u[0].uid,{style:{borderWidth:f}},["appearanceChanged"])}updateDefaultBorderWidth(l){const{annotationMode:u}=this.injection.viewer.getViewerConfig(),f=this.injection.viewer.getSelectedAnnotations();let g=u;f.length&&f[0]&&(g=f[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[g]:{borderWidth:l*Gv}}})}focusTexture(){const l=this.injection.viewer.getSelectedAnnotations();if(1===l.length){const u=this.injection.viewer.getAnnotationObject(l[0].uid);u instanceof or&&u.isEditMode&&u.focusTexture()}}initTemplate(){const{label:l}=this.data;this.template=`<div class="${this.defaultClass}"><span>${l}</span><div><input class="ddv-palette-stroke-range" type="range" min="0" max="${this.maxBorderWidth}" value="0"/><input class="ddv-palette-stroke-input" type="string" value="0pt"/></div></div>`}}class Wee extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-palette-box"),N(this,"header",void 0),N(this,"fillSpan",void 0),N(this,"textSpan",void 0),N(this,"strokeSpan",void 0),N(this,"thumbnail",void 0),lc.registerComponent({ColorPanel:LPe,FontPanel:NPe,LinePanel:UPe,StampPanel:jPe,OpacityPanel:VPe,StrokePanel:HPe}),this.bindHooks(),this.initTemplate(),this.bindViewerHooks(),this.$on("ui_changePalette_visible",u=>{this.togglePopup(u)})}bindHooks(){const l=u=>{this.header=this.el.querySelector(`.${this.defaultClass}-header`);const f=this.header.getElementsByTagName("span");this.textSpan=f[0],this.strokeSpan=f[1],this.fillSpan=f[2],this.bindEvents(),this.injection.viewer.context.viewService.mainContainer.appendChild(this.el);const{enableDrag:g}=this.data.options;this.el.dataset.enableDrag=`${g}`,function(m){let v,_,b=!1;function S(k){if(!b)return;const j=k.clientY-_;m.style.left=`${m.offsetLeft+(k.clientX-v)}px`,m.style.top=`${m.offsetTop+j}px`,v=k.clientX,_=k.clientY}function I(){b=!1,document.removeEventListener("pointermove",S),document.removeEventListener("pointerup",I)}m.addEventListener("pointerdown",function(k){const O=k.target;O.classList.contains("ddv-button")||"false"===m.dataset.enableDrag||O instanceof HTMLInputElement||O instanceof HTMLButtonElement||(b=!0,v=k.clientX,_=k.clientY,document.addEventListener("pointermove",S),document.addEventListener("pointerup",I))})}(this.el)};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindEvents(){this.el.addEventListener("click",l=>{l.stopPropagation(),this.$emit("ui_shrinkSelectionBox",l)}),this.el.addEventListener("pointerup",l=>{l.target instanceof HTMLInputElement&&!(l.target instanceof HTMLInputElement&&"range"===l.target.type)||this.focusTexture()}),this.textSpan.addEventListener("click",l=>{this.setPaletteType("text")}),this.fillSpan.addEventListener("click",l=>{this.setPaletteType("fill")}),this.strokeSpan.addEventListener("click",l=>{this.setPaletteType("stroke")})}bindViewerHooks(){const l=this.injection.viewer,u=()=>{const{toolMode:g,annotationMode:m}=l.getViewerConfig(),v=l.getSelectedAnnotations();return!l.getPageCounts()||"annotation"!==g&&!v.length||"annotation"===g&&("select"===m||"erase"===m)},f=g=>{"stamp"===g?this.setPaletteType("stamp"):"text"===g?(this.textSpan.style.display="",this.setPaletteType("text")):(this.textSpan.style.display="none",this.setPaletteType("stroke"))};this.hooks.inserted.on(()=>{u()&&this.togglePopup(!1)}),l.hooks.beforeAnnotationEdit.on(()=>{this.togglePopup(!1)},this),l.hooks.beforeAnnotationDraw.on(()=>{this.togglePopup(!1)},this),l.hooks.pageChanged.on(g=>{g.total||this.togglePopup(!1);const m=l.getActiveTab();!m||"single"!==m.context.displayMode||1===l.getSelectedAnnotations().length&&this.togglePopup(!1)},this),l.hooks.toolModeChanged.on(g=>{if(u())return void this.togglePopup(!1);const{annotationMode:m}=l.getViewerConfig();if("annotation"===g.newToolMode&&"select"!==m&&"erase"!==m&&!ir()){const v=["textBox","textTypewriter"].includes(m);f("stamp"===m?"stamp":v?"text":"common"),this.togglePopup(!0)}},this),l.hooks.selectedAnnotationsChanged.on(g=>{u()&&this.togglePopup(!1);const m=l.getSelectedAnnotations();if(1!==m.length)return;const v=m[0],_=["textBox","textTypewriter"].includes(v.type),b="stamp"===v.type?"stamp":_?"text":"common";f(b),("text"===b&&"textTypewriter"===v.type||"ink"===v.type)&&(this.header.style.display="none")},this),l.hooks.annotationModeChanged.on(g=>{if(l.getSelectedAnnotations().length)return;const m=g.newAnnotationMode;if(["erase","select"].includes(m))return void this.togglePopup(!1);const v=["textBox","textTypewriter"].includes(m),_="stamp"===m?"stamp":v?"text":"common";f(_),("text"===_&&"textTypewriter"===m||"ink"===m)&&(this.header.style.display="none");const{toolMode:b}=this.injection.viewer.getViewerConfig(),S=this.injection.viewer.getPageCounts();ir()&&"stamp"!==_?this.togglePopup(!1):this.togglePopup(S>0&&"annotation"===b)},this)}setPaletteType(l){const{header:u,textSpan:f,strokeSpan:g,fillSpan:m}=this;if(this.$emit("ui_changePalette_type",l),"stamp"===l)return void(u.style.display="none");const{backgroundColor:v}=getComputedStyle(this.el);u.style.display="";const _=(b,S,I)=>{b.style.background=l===S?I:"",b.style.borderBottom=l===S?"none":""};_(f,"text",v),_(g,"stroke",v),_(m,"fill",v)}togglePopup(l,u,f){const g="none"!==this.el.style.display,m=pt(l)?!g:l;if(g===m)return;const{options:v}=this.data;m?(this.el.style.display="",null!=v&&v.positionRocked&&(this.el.style.left="",this.el.style.top="")):(this.el.style.display="none",this.$emit("ui_shrinkSelectionBox")),pt(u)||(this.el.style.right=`${u||0}px`),pt(f)||(this.el.style.top=`${f||0}px`),this.injection.viewer.emit("annotationPaletteToggle",m),function(_){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;if("none"===_.style.display||!_.parentElement)return!1;const S=_.getBoundingClientRect(),I=_.parentElement.getBoundingClientRect(),k=S.right-b<I.left||S.left+b>I.right,O=S.bottom-b<I.top||S.top+b>I.bottom;return k||O}(this.el)&&(this.el.style.left="",this.el.style.top="")}focusTexture(){const l=this.injection.viewer.getSelectedAnnotations();if(1===l.length){const u=this.injection.viewer.getAnnotationObject(l[0].uid);u instanceof or&&u.isEditMode&&u.focusTexture()}}initTemplate(){const{options:l}=this.data;Yd(Xd(this),this.injection.viewer,l),null!=l&&l.labels||(l.labels={}),l.labels=qe({text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"Standard Business"},l.labels),l.style=Ht(qe({},l.style),{display:"none"});const u=`<div ${Mr(l,this.defaultClass,"")}><div class="${this.defaultClass}-header"><span>${l.labels.text}</span><span>${l.labels.stroke}</span><span>${l.labels.fill}</span></div><FontPanel :maxFontSize="options.maxFontSize"></FontPanel><ColorPanel :enableChangeColor="options.enableChangeColor" :colorList="options.colorList"></ColorPanel><StampPanel label="${l.labels.standardBusiness}"></StampPanel><OpacityPanel label="${l.labels.opacity}"></OpacityPanel><StrokePanel :maxBorderWidth="options.maxBorderWidth" label="${l.labels.stroke}"></StrokePanel><LinePanel label="${l.labels.style}"></LinePanel></div>`;this.template=u}}N(Wee,"cpName","AnnotationPalette");class Uee extends _r{constructor(l){super(l,{class:"ddv-auto-capture",callback:()=>{const{viewer:u}=this.injection,{viewerMode:f}=u.getViewerConfig(),{enableAutoCapture:g}=u.getCameraConfig();f===qo.CAPTURE&&u.updateCameraConfig({enableAutoCapture:!g})}}),this.bindViewerHooks()}bindDefaultUi(){const l=()=>{const u=this.injection.viewer;u.isVideoPlaying()?u.getCameraConfig().enableAutoCapture?this.setUiState("focused",!ir()):this.setUiState("normal"):this.setUiState("disabled")};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){const{hooks:l}=this.injection.viewer;l.autoCaptureChanged.on(u=>{this.setUiState(u.enableAutoCapture?"focused":"normal",!ir())},this),l.cameraPlayed.on(()=>{const{enableAutoCapture:u}=this.injection.viewer.getCameraConfig();this.setUiState(u?"focused":"normal",!ir())},this),l.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}N(Uee,"cpName","AutoCapture");class Vee extends _r{constructor(l){super(l,{class:"ddv-auto-detect",callback:()=>{const{viewer:u}=this.injection,{viewerMode:f}=u.getViewerConfig(),{enableAutoDetect:g}=u.getCameraConfig();f===qo.CAPTURE&&u.updateCameraConfig({enableAutoDetect:!g})}}),this.bindViewerHooks()}bindDefaultUi(){const l=()=>{const u=this.injection.viewer;u.isVideoPlaying()&&u.context.core.detectorService.enableDetect?u.getCameraConfig().enableAutoDetect?this.setUiState("focused",!ir()):this.setUiState("normal"):this.setUiState("disabled")};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){const{hooks:l}=this.injection.viewer;l.autoDetectChanged.on(u=>{this.setUiState(u.enableAutoDetect?"focused":"normal",!ir())},this),l.cameraPlayed.on(()=>{const{core:u}=this.injection.viewer.context;if(!u.detectorService.enableDetect)return;const{enableAutoDetect:f}=this.injection.viewer.getCameraConfig();this.setUiState(f?"focused":"normal",!ir())},this),l.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}N(Vee,"cpName","AutoDetect");class jee extends _r{constructor(l){super(l,{class:"ddv-capture-image",callback:()=>{if(this.isCapturing)return;const u=this.injection.viewer;this.isCapturing=!0,this.setUiState("disabled"),u.capture().finally(()=>{this.isCapturing=!1,this.setUiState("normal")})}}),N(this,"isCapturing",!1),this.bindViewerHooks()}bindDefaultUi(){const l=()=>{this.setUiState(this.injection.viewer.isVideoPlaying()?"normal":"disabled")};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){const{hooks:l}=this.injection.viewer;l.cameraPlayed.on(()=>{this.setUiState("normal")},this),l.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}N(jee,"cpName","Capture");class Hee extends _r{constructor(l){super(l,{class:"ddv-camera-flashlight",callback:()=>{const{viewer:u}=this.injection;u.cameraContext.turnOnTheTorch?u.turnOffTorch():u.turnOnTorch()}}),this.bindViewerHooks()}bindDefaultUi(){const l=()=>{const{viewer:u}=this.injection;u.isVideoPlaying()&&u.cameraContext.torchSupported?this.setUiState(u.cameraContext.turnOnTheTorch?"focused":"normal"):this.setUiState("disabled")};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){this.injection.viewer.hooks.torchChanged.on(l=>{switch(l.torchState){case"supported":case"off":this.setUiState("normal");break;case"on":this.setUiState("focused",!ir());break;default:this.setUiState("disabled")}},this)}}N(Hee,"cpName","Flashlight");class Gee extends _r{constructor(l){super(l,{class:"ddv-camera-convert",callback:()=>{const{viewer:u}=this.injection;u.cameraContext.convertCamera()}}),this.bindViewerHooks()}bindDefaultUi(){const l=()=>{const u=this.injection.viewer;u.isVideoPlaying()?this.setUiState(u.cameraContext.canFrontCamera?"normal":"disabled"):this.setUiState("disabled")};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){const{hooks:l}=this.injection.viewer;l.cameraPlayed.on(()=>{this.setUiState(this.injection.viewer.cameraContext.canFrontCamera?"normal":"disabled")},this),l.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}N(Gee,"cpName","CameraConvert");const GPe=[{label:" 720P",value:{width:1280,height:720}},{label:" 1080P",value:{width:1920,height:1080}},{label:" 1440P",value:{width:2560,height:1440}},{label:" 2160P",value:{width:3840,height:2160}}];class zee extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-resolution"),N(this,"cssPrefix",`${this.defaultClass}-`),N(this,"checkedClassName",`${this.cssPrefix}checkbox-checked`),N(this,"resolutionOptions",[]),N(this,"isFirstClick",!0),N(this,"fakeResolution",!1),N(this,"lastCheckIndex",0),N(this,"box",void 0),this.bindHooks(),this.initTemplate(),z2(this)}bindHooks(){this.hooks.created.on(l=>{this.box=this.query(`.${this.cssPrefix}box`),this.box.style.display="none",this.box.remove(),this.updateResolution(),this.bindEvents(),this.bindViewerHooks(),this.bindEventsEmitter(),Jh(this.el,!0)}),this.hooks.updated.on(()=>{this.box.style.display="none",this.isFirstClick=!0,this.injection.viewer.isVideoPlaying()||Jh(this.el,!0)})}bindEvents(){const l=this.box.getElementsByTagName("ul")[0];this.nativeOn(this.el,"click",()=>{const u=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(Kg(u,this.el,this.box),this.isFirstClick=!1)}),this.ulEvent(l)}ulEvent(l){l&&this.nativeOn(l,"click",u=>{const f=this.injection.viewer,g=u.target,m=g.parentNode;if("LI"===g.tagName||"LI"===m.tagName){const v="LI"===g.tagName?g.value:m.value;if(v===this.lastCheckIndex)return;const{width:_,height:b}=this.resolutionOptions[v].value;this.fakeResolution=!0,f.setResolution(_,b),this.updateChecked(_,b)}this.togglePopup(!1)})}bindViewerHooks(){const{viewer:l}=this.injection,{hooks:u}=l;u.cameraPlayed.on(f=>{if(Jh(this.el,!1),this.fakeResolution)return;const{width:g,height:m}=f.resolution;this.updateChecked(g,m),this.fakeResolution=!1},this),u.cameraClosed.on(()=>{Jh(this.el,!0)},this),u.visibleChanged.on(f=>{"hidden"===f.newVisibility&&this.togglePopup(!1)},this)}updateChecked(l,u){const f=function(b,S){let I=-1;const k=S.width*S.height;for(let O=0;O<b.length;O++){const{value:j}=b[O],W=j.width*j.height;if(0===O&&k<=W)return 0;if(O===b.length&&k>=W)return b.length-1;k>W&&(I=O+1)}return I}(this.resolutionOptions,{width:l,height:u}),{box:g,checkedClassName:m}=this,v=g.getElementsByClassName(`${this.cssPrefix}checkbox`)[f],_=g.getElementsByClassName(m)[0];v!==_&&(this.lastCheckIndex=f,null==v||v.classList.add(m),null==_||_.classList.remove(m))}initTemplate(){const{options:l}=this.data,{popupBox:u}=l;Yd(Xd(this),this.injection.viewer,l);const f=`<div ${Mr(l,`${this.defaultClass} ddv-button`)}>`+(pt(null==l?void 0:l.label)?"":`<span>${l.label}</span>`)+`<i class="ddv-down-arrow"></i><div ${Mr(u,this.cssPrefix,"box")}><ul></ul></div></div>`;this.template=f}getOptionTemplate(){const{options:l}=this.data;let u=GPe;if(Di(null==l?void 0:l.valueList))u=l.valueList;else{const{CameraResolution_720P:g,CameraResolution_1080P:m,CameraResolution_1440P:v,CameraResolution_2160P:_}=pl.getDisplayTextConfig(),b=[g,m,v,_];u.forEach((S,I)=>{b[I]&&(S.label=b[I])})}let f="";return u.forEach((g,m)=>{const{width:v,height:_}=g.value;Xt(v)&&Xt(_)&&(f+=[`<li value="${m}">`,`<i class="${this.cssPrefix}checkbox"></i>`,`<span>${(null==g?void 0:g.label)||""}</span>`,"</li>"].join(""))}),this.resolutionOptions=u,f}updateResolution(){const l=this.getOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=l}togglePopup(l){const{box:u}=this,{viewer:f}=this.injection;let g="none"!==u.style.display;g=pt(l)?!g:l,g?(this.$emit("ui_hidePopup",this),f.rootDom.appendChild(u)):u.remove(),Xu(this.el,g),u.style.display=g?"":"none"}}N(zee,"cpName","CameraResolution");class Yee extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-image-preview"),N(this,"cssPrefix",`${this.defaultClass}-`),N(this,"uiState",void 0),N(this,"image",void 0),N(this,"counter",void 0),N(this,"imagePageUid",void 0),N(this,"hasTask",!1),N(this,"isUpdateTask",!1),N(this,"lastPageUid",void 0),N(this,"pageTaskUids",[]),N(this,"currentTimer",void 0),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.created.on(l=>{this.setState("disabled"),this.bindViewerHooks(),this.bindEventsEmitter()}),this.hooks.inserted.on(l=>{this.image=this.el.getElementsByTagName("img")[0],this.counter=this.query(`.${this.cssPrefix}counter`)}),this.hooks.destroyed.on(()=>{clearTimeout(this.currentTimer),this.image.src&&URL.revokeObjectURL(this.image.src)})}bindViewerHooks(){var l=this;const u=this.injection.viewer,f=ir()?10:4;u.hooks.updatePage.on(function(){var g=Fe(function*(m){if(m.pageUid!==l.lastPageUid)return;if(l.hasTask)return l.pageTaskUids.push(m.pageUid),void(l.isUpdateTask=!0);l.hasTask=!0;const v=u.getPageCounts(),_=yield u.getPerspectivePreviewImage(v-1,400,400,f);_&&(l.image.src&&URL.revokeObjectURL(l.image.src),l.image.src=kE(_.data).data),l.hasTask=!1,l.pageTaskUids.length>0&&l.createTask()});return function(m){return g.apply(this,arguments)}}(),this),u.hooks.pageChanged.on(function(){var g=Fe(function*(m){if(0===m.total)return l.image.src="",l.setState("disabled"),l.imagePageUid=void 0,void(l.lastPageUid=void 0);if(null==l||!l.counter)return;l.counter.innerText=`${m.total}`;const v=u.getActiveTab();if(!v)return;const _=v.pages[m.total-1].uid;l.pageTaskUids.push(_),l.hasTask||_!==l.lastPageUid&&l.createTask()});return function(m){return g.apply(this,arguments)}}(),this)}createTask(){var l=this;return Fe(function*(){l.hasTask||(l.hasTask=!0,yield l.updateImage(),l.currentTimer=setTimeout(()=>{l.hasTask=!1,0!==l.pageTaskUids.length&&l.createTask()},300))})()}updateImage(){var l=this;return Fe(function*(){const u=l.injection.viewer;if(!u||!u.context)return;const f=u.getActiveTab(),g=ir()?10:4;if(!f)return;const m=f.pages.length;if(!m)return;const v=l.pageTaskUids[l.pageTaskUids.length-1],_=f.pages[m-1].uid;if(l.pageTaskUids.length=0,l.lastPageUid=f.pages[m-1].uid,l.lastPageUid===v&&l.imagePageUid===v&&!l.isUpdateTask)return;let b;l.isUpdateTask&&(l.isUpdateTask=!1);try{b=yield u.getPerspectivePreviewImage(m-1,400,400,g)}catch(S){}b&&!u.isDestroy&&u.getActiveTab()&&(l.image.src&&URL.revokeObjectURL(l.image.src),l.image.src=kE(b.data).data,l.imagePageUid=_,l.setState(m>0?"normal":"disabled"))})()}setState(l){this.uiState!==l&&this.el&&("normal"===l?(this.el.style.visibility="",this.el.style.pointerEvents=""):(this.el.style.visibility="hidden",this.el.style.pointerEvents="none"),this.uiState=l)}initTemplate(){const{options:l}=this.data,{imageCounter:u}=l,f=this.injection.viewer.getPageCounts();Yd(Xd(this),this.injection.viewer,l);const g=`<div ${Mr(l,this.defaultClass)}> <img src=""></img><div ${Mr(u,this.cssPrefix,"counter")}>${f}</div></div>`;this.template=g}}N(Yee,"cpName","ImagePreview");class Xee extends _r{constructor(l){super(l,{class:"ddv-load-image",callback:()=>{this.fileLoader.value=null,delete this.fileLoader.files,this.fileLoader.click()}}),N(this,"fileLoader",void 0),this.$on("ui_cropClick",u=>{const{viewer:f}=this.injection;0!==(f.getPageCounts()||0)&&this.setUiState(u?"disabled":"normal")})}createFileInput(){const l=document.createElement("input");return l.accept="image/png,image/jpeg,image/bmp,image/tiff,application/pdf",l.type="file",l.multiple=!0,l.addEventListener("change",u=>{const{files:f}=l,g=f.length,m=[];for(let v=0;v<g;v++){const _=new Blob([f[v]],{type:f[v].type});if("application/pdf"===f[v].type){const b=xi.annotationLicenseModuleIsExist();m.push({fileData:_,convertMode:hl.CM_AUTO,renderOptions:{renderAnnotations:b?Hh.LOAD_ANNOTATIONS:Hh.NO_ANNOTATIONS}})}else m.push({fileData:_})}this.injection.viewer.context.loadSource(m),l.value=null,l.files=null},!0),l}bindHooks(){super.bindHooks(),this.hooks.inserted.on(()=>{const l=this.createFileInput();l.style.display="none",this.el.appendChild(l),this.fileLoader=l,this.fileLoader.addEventListener("click",u=>{u.stopPropagation()})})}bindDefaultUi(){this.injection.viewer.hooks.pageExistenceChanged.on(l=>{null!=l&&l.pageCount||this.setUiState("normal")},this)}}N(Xee,"cpName","Load");class $ee extends _r{constructor(l){super(l,{class:"ddv-delete-all",callback:()=>{this.injection.viewer.deleteAllPages()}}),cc(this)}}N($ee,"cpName","DeleteAll");class qee extends _r{constructor(l){super(l,{class:"ddv-delete-current",callback:()=>{const u=this.injection.viewer,f=u.getCurrentPageIndex();u.deletePages([f])}}),cc(this)}}function VF(p){try{p.dispatchEvent(new MouseEvent("click"))}catch(l){const u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),p.dispatchEvent(u)}}function Kee(p,l,u){if("download"in HTMLAnchorElement.prototype){const f=document.createElementNS("http://www.w3.org/1999/xhtml","a");f.download=l=l||p.name||"download",f.rel="noopener","string"==typeof p?(f.href=p,f.origin!==location.origin?function(g){const m=new XMLHttpRequest;m.open("HEAD",g,!1);try{m.send()}catch(v){}return m.status>=200&&m.status<=299}(f.href)?function(g,m){const v=new XMLHttpRequest;v.open("GET",g),v.responseType="blob",v.onload=function(){Kee(v.response,m)},v.onerror=function(){},v.send()}(p,l):VF(f,f.target="_blank"):VF(f)):(f.href=URL.createObjectURL(p),setTimeout(()=>{URL.revokeObjectURL(f.href)},4e4),setTimeout(()=>{VF(f)},0))}}N(qee,"cpName","DeleteCurrent");class Jee extends _r{constructor(l){super(l,{class:"ddv-button-download",callback:()=>{const u=this.injection.viewer,f=u.getActiveTab();u.context.core.fileSaveService.saveToPdf(f.doc.pages,{mimeType:"application/octet-stream",saveAnnotation:xi.annotationLicenseModuleIsExist()?"annotation":"none"}).then(g=>{Kee(g,`${f.docName}.pdf`)})}}),gw(this)}}N(Jee,"cpName","Download");class Qee extends $2{constructor(l){const{Delete_DeleteCurrent:u,Delete_DeleteAll:f}=pl.getDisplayTextConfig(),{Delete_DeleteCurrent:g,Delete_DeleteAll:m}=Hv;l.data.options=Ht(qe({},l.data.options),{children:[{type:"DeleteCurrent",label:u,id:g},{type:"DeleteAll",label:f,id:m}],defaultClassName:"ddv-delete-btn",showCheckIcon:!1}),super(l),cc(this)}}N(Qee,"cpName","Delete");class Zee extends _r{constructor(l){super(l,{class:"ddv-print-page",callback:()=>{const u=this.injection.viewer,f=u.getCurrentPageIndex(),g=u.getActiveTab(),{displayMode:m}=g.context;"single"===m?u.context.core.printPages(g.uid,[f]):u.context.core.printPages(g.uid)}}),gw(this)}}N(Zee,"cpName","Print");class ete extends _r{constructor(l){super(l,{class:"ddv-crop-current",callback:()=>{this.cropEvent()}})}bindDefaultUi(){tte(this)}cropEvent(){const l=this.injection.viewer,u=l.getRectBox(),f=l.getCurrentPageIndex();u&&l.cropPages(u,[f])}}function tte(p){const l=p.injection.viewer,u=f=>{const g=pt(null==f?void 0:f.pageCount)?l.getPageCounts():f.pageCount,m=l.getRectBox();p.setUiState(g&&m?"normal":"disabled")};p.hooks.inserted.on(u),p.hooks.updated.on(u),l.hooks.pageExistenceChanged.on(u,p),l.hooks.cropRectDrawn.on(f=>{p.setUiState("normal")},p),l.hooks.cropRectDeleted.on(f=>{p.setUiState("disabled")},p)}N(ete,"cpName","CropCurrent");class nte extends _r{constructor(l){super(l,{class:"ddv-crop-all",callback:()=>{this.cropEvent()}})}bindDefaultUi(){tte(this)}cropEvent(){const{viewer:l}=this.injection,u=l.getRectBox(),f=l.getCropIndices();u&&l.cropPages(u,f)}}N(nte,"cpName","CropAll");class ite extends _r{constructor(l){super(l,{class:"ddv-perspective",callback:()=>{this.perspectiveEvent()}})}perspectiveEvent(){const{viewer:l}=this.injection;l.perspectiveAllPage()}}N(ite,"cpName","PerspectiveAll");class rte extends _r{constructor(l){super(l,{class:"ddv-full-quad",callback:()=>{this.toggleFull()}}),this.bindViewerHooks()}toggleFull(){const{viewer:l}=this.injection;l.toggleFullPerspective()}bindViewerHooks(){const{hooks:l}=this.injection.viewer;l.perspectiveQuadChanged.on(u=>{this.isFocused=u.isFull||!1,this.setUiState(u.isFull?"focused":"normal",!ir())},this)}}N(rte,"cpName","FullQuad");class ote extends _r{constructor(l){super(l,{class:"ddv-redo-page",callback:()=>{this.injection.viewer.redo()}}),this.$on("ui_cropClick",()=>{const u=this.injection.viewer.getOperationState().redo>0?"normal":"disabled";this.setUiState(u)})}bindDefaultUi(){ste("redo",this)}}function ste(p,l){const{viewer:u}=l.injection,f=()=>{const g=u.getOperationState();l.setUiState(("redo"===p?g.redo:g.undo)>0?"normal":"disabled")};l.hooks.inserted.on(f),l.hooks.updated.on(f),u.hooks.operationsChanged.on(g=>{let m="disabled";m="redo"===p?g.redo>0?"normal":"disabled":g.undo>0?"normal":"disabled",l.setUiState(m)},l)}N(ote,"cpName","Redo");class ate extends _r{constructor(l){super(l,{class:"ddv-restore-page",callback:()=>{const{viewer:u}=this.injection,f=u.getCurrentPageIndex();u.reset(f)}}),cc(this)}}N(ate,"cpName","Restore");class lte extends _r{constructor(l){super(l,{class:"ddv-rotate-left",callback:()=>{const{viewer:u}=this.injection,f=u.getCurrentPageIndex();u.rotatePages(-90,[f])}}),cc(this)}}N(lte,"cpName","RotateLeft");class cte extends _r{constructor(l){super(l,{class:"ddv-rotate-right",callback:()=>{const{viewer:u}=this.injection,f=u.getCurrentPageIndex();u.rotatePages(90,[f])}}),cc(this)}}N(cte,"cpName","RotateRight");class ute extends _r{constructor(l){super(l,{class:"ddv-undo-page",callback:()=>{this.injection.viewer.undo()}}),this.$on("ui_cropClick",()=>{const u=this.injection.viewer.getOperationState().undo>0?"normal":"disabled";this.setUiState(u)})}bindDefaultUi(){ste("undo",this)}}N(ute,"cpName","Undo");class dte extends X2{constructor(l){super(l),this.defaultClass="ddv-crop",this.initPullDownBox(),this.initTemplate(),this.initHooks()}initHooks(){const l=this.injection.viewer;l.hooks.toolModeChanged.on(u=>{const f="crop"===u.newToolMode;this.injection.viewer.getPageCounts()>0&&(this.setUiState(f?"focused":"normal"),this.togglePopup(f),this.isFirstClick&&f&&this.el.click()),this.$emit("ui_cropClick",f),this.$emit("ui_toolModeRefactor")},this),l.hooks.cropRectDrawn.on(()=>{Jh(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!1)},this),l.hooks.pageChanged.on(()=>{Jh(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!this.injection.viewer.getRenderedRectBoxCount())},this)}bindPullDownBoxEvents(){const{viewer:l}=this.injection,u=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`),f=this.pullDownBox.getElementsByTagName("input")[1],g=this.pullDownBox.getElementsByTagName("input")[0],m=u.children[0],_=()=>{this.togglePopup(!1),l.updateViewerConfig({toolMode:"pan",canvasStyle:{cursor:"default"}})};this.nativeOn(u.children[1],"click",()=>{const b=l.getRectBox(),S=l.getCropIndices();b&&(l.cropPages(b,S),_())}),this.nativeOn(m,"click",_),this.nativeOn(this.el,"click",()=>{const b=l.rootDom,S=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1];l.updateViewerConfig({toolMode:"crop"}),this.togglePopup(!0),this.setUiState("focused"),this.$emit("ui_cropClick",!0),this.$emit("ui_toolModeRefactor"),Jh(S,!l.getRectBox()),this.isFirstClick&&(Kg(b,this.el,this.pullDownBox),this.isFirstClick=!1)}),this.nativeOn(f,"change",()=>{l.cropMode="all"}),this.nativeOn(g,"change",()=>{l.cropMode="current"})}bindPopupSwitchEvent(){}bindDefaultUi(){const l=this.injection.viewer,u=()=>{const{toolMode:f}=l.getViewerConfig();let g="disabled";l.getPageCounts()>0?("crop"===f&&this.el.click(),g=""===this.pullDownBox.style.display?"focused":"normal"):this.togglePopup(!1),this.setUiState(g)};l.hooks.pageExistenceChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}bindViewerHooks(){}initTemplate(){const{defaultClass:l}=this,{options:u}=this.data,{popupBox:f}=u,{postfix:g,cropMode:m}=this.injection.viewer,{Crop_CropCurrent:v,Crop_CropAll:_,Crop_CropApply:b,Crop_CropCancel:S}=pl.getDisplayTextConfig(),{Crop_CropCurrent:I,Crop_CropAll:k,Crop_CropApply:O,Crop_CropCancel:j}=Hv,W="current"===m?'checked="checked"':"",J="all"===m?'checked="checked"':"";Yd(Xd(this),this.injection.viewer,u);const K=`<div ${Mr(u,`ddv-button ${l}`)}>`+(pt(null==u?void 0:u.label)?"":`<span>${u.label}</span>`)+`<div ${Mr(f,`${l}-box`)}><div><input ${W} type="radio" id="${I+g}" name="cropType" value="cropCurrent" /><label for="${I+g}">${v}</label><input ${J} type="radio" id="${k+g}" name="cropType" value="cropAll" /><label for="${k+g}">${_}</label></div><div class= "${l}-buttonGroup"><div id="${j+g}"><span>${S}</span></div><div id="${O+g}"><span>${b}</span></div></div></div></div>`;this.template=K}}N(dte,"cpName","Crop");class zPe extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-filter-item"),N(this,"cssPrefix",`${this.defaultClass}-`),N(this,"checkedClass",`${this.cssPrefix}checked`),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.created.on(l=>{this.bindEvents()}),this.hooks.inserted.on(()=>{this.bindFilterEvents()})}bindEvents(){const{el:l}=this;this.nativeOn(l,"click",()=>{if(""===this.el.getElementsByTagName("img")[0].getAttribute("src"))return;const{itemValue:u}=this.data;this.$emit("ui_filterClick",u.type)})}bindFilterEvents(){this.$on("ui_filterReset",l=>{this.resetSelect(l.currentFilter);const{filterList:u}=l,{itemValue:f}=this.data,g=this.el.getElementsByTagName("img")[0];u.forEach(m=>{if(m.type===f.type){let v="";m.imageData&&(v=kE(m.imageData).data),g.src=v}})}),this.$on("ui_filterLoading",l=>{const u=this.el.getElementsByTagName("img")[0],f=this.el.getElementsByTagName("div")[0];u.style.display=l?"none":"",f.style.display=l?"":"none",this.el.style.pointerEvents=l?"none":""}),this.injection.viewer.hooks.filterChanged.on(l=>{this.resetSelect(l.filterType)},this)}resetSelect(l){const{itemValue:u}=this.data;l===u.type?this.el.classList.add(this.checkedClass):this.el.classList.remove(this.checkedClass)}initTemplate(){const{options:l,itemValue:u}=this.data,f=`<div ${Mr(l,this.defaultClass)}><img src=""></img><div class="ddv-filter-loading" style="display:none"></div><span>${u.label}</span></div>`;this.template=f}}const YPe=[{type:"none",label:"Original"}];class hte extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-filter"),N(this,"cssPrefix",`${this.defaultClass}-`),N(this,"isFirstClick",!0),N(this,"box",void 0),N(this,"applyAll",!1),N(this,"filterList",void 0),N(this,"filterUpdateStatus",!1),N(this,"enableFilter",!1),N(this,"uiState","normal"),this.bindHooks(),this.initTemplate(),this.bindDefaultUi(),z2(this);const{filterService:u}=this.injection.viewer.context.core;u.enableFilter&&(this.enableFilter=!0,cc(this),this.bindViewerHooks(),this.bindFilterEvents(),this.bindViewerResized()),lc.registerComponent({FilterItem:zPe})}bindHooks(){this.hooks.created.on(l=>{this.box=this.query(`.${this.cssPrefix}list`),this.box.style.display="none",this.box.remove(),this.bindNativeEvents()}),this.hooks.updated.on(()=>{this.uiState="normal"})}bindViewerResized(){const{viewer:l}=this.injection;l.hooks.resize.on(()=>{const{box:u}=this,g=this.injection.viewer.rootDom;"none"===u.style.display?this.isFirstClick=!0:Kg(g,this.el,this.box)},this)}bindViewerHooks(){var l=this;const u=this.injection.viewer;u.hooks.pageChanged.on(function(){var f=Fe(function*(g){if(0===g.total)return l.filterUpdateStatus=!0,void l.togglePopup(!1);const m=u.context.getActiveTab();if(!m||!l.box)return;const{currentUid:v,oldCurrentUid:_}=m;_!==v&&(l.filterUpdateStatus=!0,l.togglePopup(!1))});return function(g){return f.apply(this,arguments)}}(),this),u.hooks.updatePage.on(f=>{var g;const m=u.context.getActiveTab();m&&this.box&&(null===(g=m.getCurrentPage())||void 0===g?void 0:g.uid)===f.pageUid&&(this.filterUpdateStatus=!0,this.togglePopup(!1))},this),u.hooks.visibleChanged.on(f=>{"hidden"===f.newVisibility&&this.togglePopup(!1)},this)}bindNativeEvents(){var l=this;const{el:u,box:f}=this,g=f.querySelector(`.${this.cssPrefix}list-header`),m=g.getElementsByTagName("span")[0],v=g.getElementsByTagName("div")[0];this.nativeOn(u,"click",function(){var _=Fe(function*(b){l.togglePopup(),l.isFirstClick&&(Kg(l.injection.viewer.rootDom,l.el,l.box),l.isFirstClick=!1)});return function(b){return _.apply(this,arguments)}}()),this.nativeOn(f,"click",_=>{_.stopPropagation()}),this.nativeOn([m,v],"click",()=>{if(this.clickApplyToAll(),this.applyAll){const{viewer:_}=this.injection,b=_.getPageCounts(),S=_.getCurrentPageUid(),I=_.context.core.pageService.getPage(S);_.filter(Array.from(Array(b).keys()),I.filter)}})}bindFilterEvents(){this.$on("ui_filterClick",l=>{const{viewer:u}=this.injection,f=u.getPageCounts();if(f<1)return;let g=Array.from(Array(f).keys());if(!this.applyAll){const m=u.getCurrentPageUid();if(u.context.core.pageService.getPage(m).fileIndex===l)return;g=[u.getCurrentPageIndex()]}u.filter(g,l)})}clickApplyToAll(l){const g=document.getElementById(Hv.Filter_FilterAll+this.injection.viewer.postfix);if(pt(l))return this.applyAll?g.classList.remove(`${this.cssPrefix}checked`):g.classList.add(`${this.cssPrefix}checked`),void(this.applyAll=!this.applyAll);l?g.classList.add(`${this.cssPrefix}checked`):g.classList.remove(`${this.cssPrefix}checked`),this.applyAll=l}updateFilterPreview(){var l=this;return Fe(function*(){const u=l.injection.viewer,f=u.getCurrentPageUid(),g=yield u.context.core.imageDataService.getOriginal(f);if(!g)return;l.$emit("ui_filterLoading",!0);const m=[],v=u.context.core.pageService.getPage(f);let _;try{_=yield u.context.core.processService.resize(g.data,3,g.width,g.height,200)}catch(S){}for(let S=0;S<l.filterList.length;S++){const I=l.filterList[S];if("none"===I.type)m.push({type:"none",imageData:g.data});else{let k;try{var b;_&&null!==(b=_)&&void 0!==b&&b.data&&(k=yield u.context.core.filterService.applyFilter({data:_.data,type:Tr.JPEG,width:_.width,height:_.height},I.type))}catch(O){k=null}m.push({type:I.type,imageData:k})}}l.$emit("ui_filterLoading",!1),l.$emit("ui_filterReset",{currentFilter:v.filter||"none",filterList:m}),l.filterUpdateStatus=!1})()}initTemplate(){var l;const u=this.data,{options:f}=u,{popupBox:g,filterHeader:m,filterContent:v,valueList:_}=f,{filterService:b}=this.injection.viewer.context.core,S=Hv.Filter_FilterAll+this.injection.viewer.postfix;Yd(Xd(this),this.injection.viewer,f);const I=(null===(l=pl.getDisplayTextConfig())||void 0===l?void 0:l.Filter_FilterAll)||"Apply to All";u.valueList=_||YPe,b.enableFilter&&(u.valueList=b.getSupportedFilters()),this.filterList=u.valueList;const k=`<div ${Mr(f,`ddv-button ${this.defaultClass}`)}>`+(pt(null==f?void 0:f.label)?"":`<span>${f.label}</span>`)+`<i class="ddv-down-arrow"></i><div ${Mr(g,this.cssPrefix,"list")}><div id="${S}"${Mr(m,this.cssPrefix,"list-header")}><div></div><span>${I}</span></div><div ${Mr(v,this.cssPrefix,"list-content")}><FilterItem :for="item in valueList":options="options.filterItem" :itemValue="item"></FilterItem></div></div></div>`;this.template=k}togglePopup(l){var u=this;return Fe(function*(){const{box:f}=u,{viewer:g}=u.injection;let m="none"===f.style.display;m=pt(l)?!m:!l,m?f.remove():(u.$emit("ui_hidePopup",u),g.rootDom.appendChild(f),u.filterUpdateStatus&&u.updateFilterPreview()),Xu(u.el,!m),f.style.display=m?"none":""})()}bindDefaultUi(){const l=this.injection.viewer,u=()=>{let f="normal";0!==l.getPageCounts()&&this.enableFilter||(f="disabled"),Y2(this,f)};l.hooks.pageChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}N(hte,"cpName","Filter");class fte extends _r{constructor(l){super(l,{class:"ddv-button-blank",callback:()=>{}})}bindDefaultUi(){}}class jF extends _r{constructor(l){super(l,{class:"ddv-button-close",callback:()=>{}})}bindDefaultUi(){}}N(jF,"cpName","Close");class HF extends _r{constructor(l){super(l,{class:"ddv-button-back",callback:()=>{}})}bindDefaultUi(){}}N(HF,"cpName","Back");class GF extends _r{constructor(l){super(l,{class:"ddv-button-done",callback:()=>{}})}bindDefaultUi(){}}N(GF,"cpName","Done");const XPe=[{displayName:"continuous",className:"ddv-continuous-mode"},{displayName:"single",className:"ddv-single-mode"}];class pte extends $2{constructor(l){const{DisplayMode_ContinuousPage:u,DisplayMode_SinglePage:f}=pl.getDisplayTextConfig(),{DisplayMode_ContinuousPage:g,DisplayMode_SinglePage:m}=Hv;l.data.options=Ht(qe({},l.data.options),{children:[{type:"ContinuousPage",label:u,id:g},{type:"SinglePage",label:f,id:m}],defaultClassName:"ddv-display-mode",showCheckIcon:!0}),super(l),cc(this)}updateUiState(l){const{el:u}=this;XPe.forEach((f,g)=>{l===f.displayName?(u.classList.add(f.className),this.selectChildren(g)):u.classList.remove(f.className)})}bindDefaultUi(){super.bindDefaultUi();const l=this.injection.viewer,u=()=>{const{displayMode:f}=l.getViewerConfig();this.updateUiState(f)};l.hooks.displayModeChanged.on(f=>{this.updateUiState(f.newDisplayMode)},this),l.hooks.openDocument.on(()=>{const f=l.context.getActiveTab();f&&this.updateUiState(f.context.displayMode)},this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}N(pte,"cpName","DisplayMode");class zF extends _r{constructor(l,u){super(l,{class:u.class,callback:()=>{this.injection.viewer.updateViewerConfig({displayMode:u.displayMode})}}),N(this,"displayMode",void 0),this.displayMode=u.displayMode,cc(this)}bindDefaultUi(){const l=this.injection.viewer,u=f=>{var g;const m=l.getActiveTab(),v=(null==f?void 0:f.pageCount)||l.getPageCounts(),_=(null==m||null===(g=m.context)||void 0===g?void 0:g.displayMode)||l.getViewerConfig().displayMode;this.setUiState(v?_===this.displayMode?"focused":"normal":"disabled")};l.hooks.pageExistenceChanged.on(u,this),l.hooks.displayModeChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}class gte extends zF{constructor(l){super(l,{class:"ddv-continuous-mode",displayMode:"continuous"})}}N(gte,"cpName","ContinuousPage");class mte extends zF{constructor(l){super(l,{class:"ddv-multiple-mode",displayMode:"multiple"})}}N(mte,"cpName","MultiPage");class vte extends zF{constructor(l){super(l,{class:"ddv-single-mode",displayMode:"single"})}}N(vte,"cpName","SinglePage");const $Pe=[{displayName:"window",className:"ddv-fit-window"},{displayName:"width",className:"ddv-fit-width"},{displayName:"height",className:"ddv-fit-height"},{displayName:"actualSize",className:"ddv-fit-actual"}];class yte extends $2{constructor(l){const{FitMode_FitWindow:u,FitMode_FitWidth:f,FitMode_FitHeight:g,FitMode_ActualSize:m}=pl.getDisplayTextConfig(),{FitMode_FitWindow:v,FitMode_FitWidth:_,FitMode_FitHeight:b,FitMode_ActualSize:S}=Hv;l.data.options=Ht(qe({},l.data.options),{children:[{type:"FitWindow",label:u,id:v},{type:"FitWidth",label:f,id:_},{type:"FitHeight",label:g,id:b},{type:"ActualSize",label:m,id:S}],defaultClassName:"ddv-fit-type",showCheckIcon:!0}),super(l),cc(this)}updateUiState(l){const{el:u}=this;"none"!==l?$Pe.forEach((f,g)=>{l===f.displayName?(u.classList.add(f.className),this.selectChildren(g)):u.classList.remove(f.className)}):this.selectChildren(-1)}bindDefaultUi(){super.bindDefaultUi();const l=this.injection.viewer,u=()=>{const{fitMode:f}=l.getViewerConfig();this.updateUiState(f)};l.hooks.fitModeChanged.on(f=>{this.updateUiState(f.newFitMode)},this),l.hooks.openDocument.on(()=>{const f=l.context.getActiveTab();f&&this.updateUiState(f.context.fitMode)},this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}N(yte,"cpName","FitMode");class J2 extends _r{constructor(l,u){super(l,{class:u.class,callback:()=>{const{viewer:f}=this.injection;f.updateViewerConfig({fitMode:u.fitMode})}}),N(this,"fitMode",void 0),this.fitMode=u.fitMode,cc(this)}bindDefaultUi(){const l=this.injection.viewer,u=()=>{const f=l.getPageCounts(),g=l.getActiveTab();let{fitMode:m}=l.getViewerConfig();g&&(m=g.context.fitMode),this.setUiState(f>0?f>0&&m===this.fitMode?"focused":"normal":"disabled")};l.hooks.pageExistenceChanged.on(u,this),l.hooks.fitModeChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}class _te extends J2{constructor(l){super(l,{class:"ddv-fit-height",fitMode:"height"})}}N(_te,"cpName","FitHeight");class Cte extends J2{constructor(l){super(l,{class:"ddv-fit-width",fitMode:"width"})}}N(Cte,"cpName","FitWidth");class bte extends J2{constructor(l){super(l,{class:"ddv-fit-window",fitMode:"window"})}}N(bte,"cpName","FitWindow");class xte extends J2{constructor(l){super(l,{class:"ddv-fit-actual",fitMode:"actualSize"})}}N(xte,"cpName","ActualSize");class wte extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-main-canvas"),this.initTemplate(),this.bindHooks()}bindHooks(){const{inserted:l}=this.hooks;l.on(()=>{var u;null===(u=this.injection.viewer)||void 0===u||u.context.viewService.bindContainer(this.el)})}initTemplate(){const{options:l}=this.data;l.id=l.id||`ddvMainView${this.injection.viewer.postfix}`;const u=`<div ${Mr(l,this.defaultClass,"")} ><slot></slot></div>`;this.template=u}}N(wte,"cpName","MainView");class Ste extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-pagination"),N(this,"cssPrefix",`${this.defaultClass}-`),N(this,"uiState","normal"),N(this,"input",void 0),N(this,"totalSpan",void 0),this.initTemplate(),this.bindHooks(),this.bindDefaultUi()}bindHooks(){this.hooks.created.on(l=>{this.bindEvents(),this.input=this.query(`.${this.cssPrefix}goto`),this.totalSpan=this.query(`.${this.cssPrefix}total`)})}bindEvents(){const l=this.injection.viewer,u=this.query(`.${this.cssPrefix}goto`);this.nativeOn(u,"input",f=>{YF(u,this.totalSpan.clientWidth)}),this.nativeOn(u,"blur",()=>{const f=l.getPageCounts(),g=l.getCurrentPageIndex();let m=parseInt(u.value,10);Xt(m)?m<1?m=1:m>f&&(m=f):m=g+1,u.value=`${m}`,YF(u),l.gotoPage(m-1)}),this.nativeOn(u,"keydown",f=>{f.stopPropagation(),"Enter"===f.key&&u.blur()})}setState(l){this.uiState!==l&&this.el&&("normal"===l?this.el.classList.remove(`${this.cssPrefix}disabled`):this.el.classList.add(`${this.cssPrefix}disabled`),this.uiState=l)}bindDefaultUi(){const l=this.injection.viewer,u=f=>{const g=pt(null==f?void 0:f.total)?l.getPageCounts():null==f?void 0:f.total,m=pt(null==f?void 0:f.current)?l.getCurrentPageIndex():null==f?void 0:f.current;this.setState(g>0?"normal":"disabled"),this.input.value=`${m+1}`,this.totalSpan.innerText=`${g}`,YF(this.input,this.totalSpan.clientWidth)};l.hooks.pageChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(()=>{this.uiState="normal",u(null)})}initTemplate(){const{options:l}=this.data,{gotoPage:u,total:f,separator:g}=l,{cssPrefix:m,injection:v,defaultClass:_}=this,{viewer:b}=v,S=b.getCurrentPageIndex()+1,I=b.getPageCounts(),k=`<div ${Mr(l,_,"")}><FirstPage :options="options.firstPage"></FirstPage><PrevPage :options="options.prevPage"></PrevPage><input ${Mr(u,m,"goto")} value="${S}" type="number" ><div ${Mr(g,m,"separator")}></div><span ${Mr(f,m,"total")} >${I}</span><NextPage :options="options.nextPage"></NextPage><LastPage :options="options.lastPage"></LastPage></div>`;this.template=k}}function YF(p,l){const{fontSize:u,width:f}=getComputedStyle(p);let g=function(v,_){const b=document.createElement("span");b.innerText=v,b.style.fontSize=_,b.style.position="absolute",b.style.top="0px",b.style.visibility="hidden",document.body.appendChild(b);const S=b.offsetWidth;return b.remove(),S}(p.value,u);pt(l)||0===l||(g=Math.min(l+10,g));const m=`${g+3}px`;f!==m&&(p.style.width=m)}N(Ste,"cpName","Pagination");class Q2 extends _r{constructor(l,u){super(l,{class:u.class,callback:u.callback}),N(this,"type",void 0),this.type=u.type}bindDefaultUi(){const l=this.injection.viewer,u=()=>{const f=l.getPageCounts(),g=l.getCurrentPageIndex();let m=!1;switch(this.type){case"previous":case"first":m=f>0&&0!==g;break;case"last":case"next":m=g<f-1}0===f&&(m=!1),this.setUiState(m?"normal":"disabled")};this.hooks.inserted.on(u),this.hooks.updated.on(u),l.hooks.pageChanged.on(u,this)}}class Tte extends Q2{constructor(l){super(l,{class:"ddv-first-page",type:"first",callback:()=>{this.injection.viewer.gotoPage(0)}})}}N(Tte,"cpName","FirstPage");class Ite extends Q2{constructor(l){super(l,{class:"ddv-last-page",type:"last",callback:()=>{const u=this.injection.viewer,f=u.getPageCounts();u.gotoPage(f-1)}})}}N(Ite,"cpName","LastPage");class Ete extends Q2{constructor(l){super(l,{class:"ddv-next-page",type:"next",callback:()=>{const u=this.injection.viewer,f=u.getCurrentPageIndex();u.gotoPage(f+1)}})}}N(Ete,"cpName","NextPage");class Dte extends Q2{constructor(l){super(l,{class:"ddv-prev-page",type:"previous",callback:()=>{const u=this.injection.viewer,f=u.getCurrentPageIndex();u.gotoPage(f-1)}})}}N(Dte,"cpName","PrevPage");class Ate extends _r{constructor(l){super(l,{class:"ddv-thumbnail-switch",callback:()=>{const{thumbnail:u}=this;if(!u)return;const{visibility:f}=u.getViewerConfig();u.updateViewerConfig({visibility:"visible"===f?"hidden":"visible"})}}),N(this,"thumbnail",void 0),this.injection.viewer.on("thumbnailBind",u=>{if(this.thumbnail)return;const f=this.injection.viewer.context.core.getViewer(u);f&&(this.thumbnail=f,this.bindThumbnailHooks(f));const{visibility:g}=f.getViewerConfig();this.setUiState("visible"===g?"focused":"normal",!ir())}),this.injection.viewer.hooks.destroy.on(()=>{this.thumbnail=null},this)}bindThumbnailHooks(l){l.hooks.visibleChanged.on(u=>{this.setUiState("visible"===u.newVisibility?"focused":"normal",!ir())},this)}bindDefaultUi(){const l=()=>{if(!this.thumbnail)return;const{visibility:u}=this.thumbnail.getViewerConfig();this.setUiState("visible"===u?"focused":"normal",!ir())};this.injection.viewer.hooks.pageExistenceChanged.on(l,this),this.hooks.updated.on(l)}}N(Ate,"cpName","ThumbnailSwitch");class XF extends _r{constructor(l,u){super(l,{class:u.class,callback:()=>{this.injection.viewer.updateViewerConfig({toolMode:u.toolMode,canvasStyle:{cursor:u.cursor}})}}),N(this,"toolMode",void 0),this.toolMode=u.toolMode,this.bindViewerHooks()}bindDefaultUi(){const l=this.injection.viewer,u=()=>{const{toolMode:f}=l.getViewerConfig();l.getPageCounts()>0?this.setUiState(f===this.toolMode?"focused":"normal"):this.setUiState("disabled")};l.hooks.pageExistenceChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}bindViewerHooks(){const l=this.injection.viewer;l.hooks.toolModeChanged.on(u=>{const f=u.newToolMode===this.toolMode;l.getPageCounts()>0?this.setUiState(f?"focused":"normal"):this.setUiState("disabled")},this)}}class Pte extends XF{constructor(l){super(l,{class:"ddv-pan-mode",toolMode:"pan",cursor:"default"})}}N(Pte,"cpName","Pan"),N(class extends XF{constructor(p){super(p,{class:"ddv-zoom-mode",toolMode:"zoomIn",cursor:"zoom-in"})}},"cpName","ZoomMode");class Rte extends XF{constructor(l){super(l,{class:"ddv-crop-mode",toolMode:"crop",cursor:"crosshair"})}}N(Rte,"cpName","CropMode");class $F extends _r{constructor(l){super(l,{class:"ddv-zoom-in",callback:()=>{this.injection.viewer.zoomIn()}}),this.bindViewerHooks(),cc(this)}bindViewerHooks(){const l=this.injection.viewer;l.hooks.zoomChanged.on(u=>{const{maxZoom:f}=l.getViewerConfig();l.getPageCounts()<1||u.newZoomRatio>=f?this.setUiState("disabled"):this.setUiState("normal")},this)}}N($F,"cpName","ZoomIn");class qF extends _r{constructor(l){super(l,{class:"ddv-zoom-out",callback:()=>{this.injection.viewer.zoomOut()}}),this.bindViewerHooks(),cc(this)}bindViewerHooks(){const l=this.injection.viewer;l.hooks.zoomChanged.on(u=>{const{minZoom:f}=l.getViewerConfig();l.getPageCounts()<1||u.newZoomRatio<=f?this.setUiState("disabled"):this.setUiState("normal")},this)}}N(qF,"cpName","ZoomOut");class kte extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-zoom-controller"),lc.registerComponent({ZoomIn:$F,ZoomOut:qF}),this.initTemplate()}initTemplate(){const{options:l}=this.data;Yd(Xd(this),this.injection.viewer,l);const u=`<div ${Mr(l,this.defaultClass)}><ZoomOut :options:"options.ZoomOut"></ZoomOut><ZoomByPercentage :options:"options.ZoomByPercentage"></ZoomByPercentage><ZoomIn :options:"options.ZoomIn"></ZoomIn></div>`;this.template=u}}N(kte,"cpName","Zoom");const qPe=[10,25,50,75,100,125,150,200,400,800,1600,2400,3200,6400];class Mte extends Ko{constructor(l){super(l),N(this,"defaultClass","ddv-zoom-percentage"),N(this,"cssPrefix",`${this.defaultClass}-`),N(this,"isFirstClick",!0),N(this,"box",void 0),N(this,"uiState","normal"),this.initTemplate(),this.bindHooks(),this.bindDefaultUi(),this.bindViewerHooks(),this.bindViewerResized(),cc(this),z2(this),this.hooks.destroyed.on(()=>{this.dispose()})}bindHooks(){this.hooks.created.on(l=>{this.box=this.query(`.${this.cssPrefix}selectbox`),this.box.style.display="none",this.box.remove(),this.bindEvents()}),this.hooks.inserted.on(()=>{const l=this.injection.viewer,{zoom:u}=l.getViewerConfig();this.updateZoom(u),this.updateZoomOption()}),this.hooks.updated.on(()=>{this.uiState="normal",this.box.style.display="none",this.isFirstClick=!0})}bindDefaultUi(){const l=this.injection.viewer,u=()=>{Y2(this,0===l.getPageCounts()?"disabled":"normal"),this.updateZoom(l.getViewerConfig().zoom)};l.hooks.pageChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}bindViewerHooks(){const{viewer:l}=this.injection,{hooks:u}=l;u.zoomChanged.on(f=>{this.updateZoom(f.newZoomRatio)},this),u.visibleChanged.on(f=>{if("hidden"===f.newVisibility)return void this.togglePopup(!1);const{zoom:g}=l.getViewerConfig();this.updateZoom(g)},this)}bindEvents(){const{el:l,box:u}=this,f=l.querySelector(`.${this.cssPrefix}selector`),g=l.getElementsByTagName("input")[0],m=u.getElementsByTagName("ul")[0];this.nativeOn(f,"click",()=>{const v=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(Kg(v,this.el,this.box,!0,!0),this.isFirstClick=!1)}),this.inputEvent(g),this.ulEvent(m)}bindViewerResized(){const{viewer:l}=this.injection;l.hooks.resize.on(()=>{const{box:u}=this,g=this.injection.viewer.rootDom;"none"===u.style.display?this.isFirstClick=!0:Kg(g,this.el,this.box,!0,!0)},this)}inputEvent(l){const u=this.injection.viewer,{maxZoom:f,minZoom:g}=u.getViewerConfig();l.value=`${f}`;const m=pee(l);function v(){const b=Sr(l.value/100,g,f);u.updateViewerConfig({zoom:b})}this.nativeOn(l,"input",()=>{this.adaptInputWidth(m)}),this.nativeOn(l,"blur",v),this.nativeOn(l,"keydown",_=>{_.stopPropagation(),"Enter"===_.key&&v()})}ulEvent(l){this.nativeOn(l,"click",u=>{u.stopPropagation();const{viewer:f}=this.injection,{maxZoom:g,minZoom:m}=f.getViewerConfig(),v=u.target;if("LI"===v.tagName){const _=Sr(v.value,100*m,100*g);f.updateViewerConfig({zoom:_/100})}this.togglePopup(!1)})}getZoomOptionTemplate(){var l;const u=(null===(l=this.data.options)||void 0===l?void 0:l.valueList)||null,f=this.injection.viewer,{maxZoom:g,minZoom:m}=f.getViewerConfig(),v=Di(u)?u:qPe,_=m<1e-4?.01:parseFloat((100*m).toFixed(2)),b=Math.floor(100*g);v.push(_,b);const S=Array.from(new Set(v)).sort((k,O)=>k-O);let I="";return S.forEach(k=>{Xt(k)&&k<=100*g&&k>=100*m&&(I+=`<li value="${k}">${k}%</li>`)}),I}updateZoomOption(){const l=this.getZoomOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=l}updateZoom(l){const u=this.el.getElementsByTagName("input")[0],f=100*l;if(Number.isInteger(f))u.value=`${f}`;else{let g=f;g=g>=1e3?+g.toFixed(0).toString():g>=100?+g.toFixed(1).toString():g>=10?+g.toFixed(2).toString():+g.toFixed(3).toString(),u.value=`${g}`}this.adaptInputWidth()}initTemplate(){const{options:l={}}=this.data,{input:u,selector:f,popupBox:g}=l,{cssPrefix:m}=this,{viewer:v}=this.injection;Yd(Xd(this),v,l);const _=`<div ${Mr(l,this.defaultClass)}><div style="display: flex"><div ${Mr(u,m,"input")}><input type="number"><span>%</span></div><div ${Mr(f,m,"selector")}><i></i></div></div><div ${Mr(qe({id:`ddvZoomByPercentageSelectBox${v.postfix}`},g),m,"selectbox")}><ul></ul></div></div>`;this.template=_}adaptInputWidth(l){const u=this.el.getElementsByTagName("input")[0];let f=pee(u);l&&f>l&&(f=l),u.style.width=`${f}px`}togglePopup(l){const{viewer:u}=this.injection,{box:f}=this;let g="none"!==f.style.display;g=pt(l)?!g:l,g?(this.$emit("ui_hidePopup",this),u.rootDom.appendChild(f)):f.remove(),f.style.display=g?"":"none"}}N(Mte,"cpName","ZoomByPercentage");class pl{static getTooltip(){return this.tooltip}static setTooltip(l){this.tooltip=qe(qe({},this.tooltip),l)}static getDisplayTextConfig(){return this.displayTextConfig}static setDisplayTextConfig(l){this.displayTextConfig=qe(qe({},this.displayTextConfig),l)}static registerAll(){lc.registerComponent({Capture:jee,Flashlight:Hee,CameraConvert:Gee,CameraResolution:zee,AutoDetect:Vee,AutoCapture:Uee,ImagePreview:Yee,RotateLeft:lte,RotateRight:cte,Delete:Qee,DeleteAll:$ee,DeleteCurrent:qee,Zoom:kte,ZoomIn:$F,ZoomOut:qF,ZoomByPercentage:Mte,PerspectiveAll:ite,FullQuad:rte,Restore:ate,Undo:ute,Redo:ote,FitMode:yte,FitWidth:Cte,FitHeight:_te,FitWindow:bte,ActualSize:xte,DisplayMode:pte,SinglePage:vte,MultiPage:mte,ContinuousPage:gte,Pan:Pte,Print:Zee,Filter:hte,ThumbnailSwitch:Ate,Back:HF,Done:GF,Pagination:Ste,FirstPage:Tte,LastPage:Ite,NextPage:Ete,PrevPage:Dte,Root:dee,Layout:cee,Button:LF,MainView:wte,Load:Xee,Download:Jee,Close:jF,Blank:fte,SeparatorLine:hee,CropCurrent:ete,CropAll:nte,CropMode:Rte,Crop:dte,AnnotationSet:q2,EllipseAnnotation:mee,EraseAnnotation:vee,InkAnnotation:yee,LineAnnotation:_ee,PolygonAnnotation:Cee,PolylineAnnotation:bee,RectAnnotation:xee,SelectAnnotation:wee,StampIconAnnotation:See,StampImageAnnotation:Tee,TextBoxAnnotation:Iee,TextTypewriterAnnotation:Eee,BasePullDownButton:X2,PullDownListButton:$2,PullDownMenuButton:gee,BringForward:Aee,BringToFront:Pee,SendBackward:Ree,SendToBack:kee,AnnotationToolBar:Mee,AnnotationDeleteButton:Fee,AnnotationPaletteButton:Oee,AnnotationPalette:Wee})}}N(pl,"tooltip",{}),N(pl,"displayTextConfig",{FitMode_FitWidth:"Fit Width",FitMode_FitHeight:"Fit Height",FitMode_FitWindow:"Fit Window",FitMode_ActualSize:"Actual Size",DisplayMode_SinglePage:"Single Page",DisplayMode_ContinuousPage:"Continuous Page",Crop_CropAll:"Crop All",Crop_CropCurrent:"Crop Current",Crop_CropCancel:"Cancel",Crop_CropApply:"Apply",Filter_FilterAll:"Apply to All",Delete_DeleteCurrent:"Delete current",Delete_DeleteAll:"Delete all",CameraResolution_720P:"720P",CameraResolution_1080P:"1080P",CameraResolution_1440P:"1440P",CameraResolution_2160P:"2160P"});const KPe={install(p){const l=function(u){var f,g,m,v;return f=new WeakMap,g=new WeakMap,m=new WeakMap,v=new WeakSet,class extends u{constructor(b){super(b),al(this,v),N(this,"ui",void 0),N(this,"rootDom",void 0),bi(this,f,!1),bi(this,g,0),bi(this,m,0),pl.registerAll();const S=b.viewerConfig.enableAnnotationUi?this.getPopupUiConfig({annotationToolBarConfig:(null==b?void 0:b.annotationToolBarConfig)||{},annotationPaletteConfig:(null==b?void 0:b.annotationPaletteConfig)||{}}):[];this.ui=new lc({container:b.container,emitter:this.emitter,postfix:this.uid,uiConfig:b.uiConfig,popupUiConfig:S,injection:{viewer:this}}),b.container&&(b.uiConfig?(this.bindContainer(b.container),this.rootDom=this.ui.rootDom):this.rootDom=this.context.viewService.rootDom),this.listenNativeEventsForUi()}listenNativeEventsForUi(){this.on("click",()=>{this.emit("ui_hidePopup","viewer")})}getPopupUiConfig(b){return[Ht(qe({},b.annotationToolBarConfig),{type:"AnnotationToolBar"}),Ht(qe({colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#FFFFFF","#CECECE"],enableChangeColor:!0,enableDrag:!0},b.annotationPaletteConfig),{type:"AnnotationPalette"})]}addFontToUi(b){this.emit("ui_addFont",b)}getUiConfig(){return hn(this.ui.uiConfig)}updateUiConfig(b){const{resizeService:S}=this.context.core;S&&(S.unobserve(this.ui.rootDom),Bn(f,this,!1));const I=this.ui.updateUiConfig(b);return this.rootDom=this.ui.rootDom,this.context.viewService.rootDom=this.rootDom,at(v,this,_).call(this,this.ui.rootDom),I}getElementsByType(b){return xn(b)?this.ui.getElementsByType(this.ui.rootVNode,b):""}bindContainer(b){let S=b;return xn(b)&&(S=document.querySelector(`#${b}`)),S instanceof HTMLElement&&(at(v,this,_).call(this,this.ui.rootDom),this.ui.bindContainer(S),this.context.viewService.container=S,this.context.viewService.rootDom=this.ui.rootDom,this.rootDom=this.ui.rootDom,"hidden"===this.context.viewerConfig.visibility&&(this.context.viewService.rootDom.style.display="none"),this.context.viewService.isBindContainer=!0,!0)}unbindContainer(){this.rootDom&&this.ui.container&&(this.ui.unbindContainer(),this.context.viewService.container=null,this.context.viewService.isBindContainer=!1)}dispose(){var b;super.dispose(),null===(b=this.ui)||void 0===b||b.dispose()}};function _(b){if(Ye(f,this))return;const{resizeService:S}=this.context.core;S.observe(b),this.register(S.onResizeObserver.on(I=>{if(I.target===b){var k;let O=0,j=0;if((null===(k=I.borderBoxSize)||void 0===k?void 0:k.length)>0){const J=I.borderBoxSize[0];O=J.inlineSize,j=J.blockSize}else O=b.offsetWidth,j=b.offsetHeight;const W=G5.create(Ye(g,this),Ye(m,this),O,j);Bn(g,this,O),Bn(m,this,j),this.hooks.resize.emit(W),this.emit("resized",{oldWidth:W.oldWidth,oldHeight:W.oldHeight,newWidth:W.newWidth,newHeight:W.newHeight})}})),this.hooks.destroy.on(()=>{S.unobserve(b)}),Bn(f,this,!0)}}(p.getClass("Viewer"));p.setClass("Viewer",l)}};function rt(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function Ki(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}"function"==typeof SuppressedError&&SuppressedError;const Ote="undefined"==typeof self;let mw,vw,Z2,KF,Jo;function Wl(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function qd(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}"undefined"!=typeof navigator&&(mw=navigator,vw=mw.userAgent,Z2=mw.platform,KF=mw.mediaDevices),function(){if(!Ote){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:mw.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Z2,search:"Win"},Mac:{str:Z2},Linux:{str:Z2}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let S=v.verStr||vw,I=v.verSearch||m;if(I instanceof Array||(I=[I]),-1!=(v.str||vw).indexOf(v.search||m)){u=m;for(let k of I){let O=S.indexOf(k);if(-1!=O){f=parseFloat(S.substring(O+k.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||vw).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=vw.indexOf("Windows NT")&&(g="HarmonyOS"),Jo={browser:u,version:f,OS:g}}Ote&&(Jo={browser:"ssr",version:0,OS:"ssr"})}(),"function"==typeof SuppressedError&&SuppressedError;class Qc{static multiply(l,u){const f=[];for(let g=0;g<3;g++){const m=u.slice(3*g,3*g+3);for(let v=0;v<3;v++){const _=[l[v],l[v+3],l[v+6]].reduce((b,S,I)=>b+S*m[I],0);f.push(_)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(l,u,f){return Qc.multiply(l,[1,0,0,0,1,0,u,f,1])}static rotate(l,u){var f=Math.cos(u),g=Math.sin(u);return Qc.multiply(l,[f,-g,0,g,f,0,0,0,1])}static scale(l,u,f){return Qc.multiply(l,[u,0,0,0,f,0,0,0,1])}}var jr,_p,Cp,eD,z_,yw,_w,Y_,tD,zv,nD,JF,Fn,wi,sr,iD,rD,Kr,$u,bp,Cw,oD,Qh,xp,Zc,X_,$_,bw,sD,q_,Yv,wp,Sp,QF,Xs,ZF,Xv,K_,aD,lD,Fte,Kd,eL,tL,J_,xw,cD,eu,Q_,nL,iL,Lte;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(jr||(jr={}));class ui{static get version(){return"1.1.1-0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(qd(ui,_p,!1,"f",Cp),!1):(qd(ui,_p,!0,"f",Cp),!0)}get disposed(){return Wl(this,tD,"f")}constructor(){eD.set(this,jr.RGBA),z_.set(this,null),yw.set(this,null),_w.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Y_.set(this,null),tD.set(this,!1)}drawImage(l,u,f,g,m,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Wl(ui,_p,"f",Cp)&&ui.checkWebGLSupport(),(null==v?void 0:v.bUseWebGL)&&!Wl(ui,_p,"f",Cp))throw new Error("Your browser or machine may not support WebGL.");if(u instanceof HTMLVideoElement&&4!==u.readyState||u instanceof HTMLImageElement&&!u.complete)throw new Error("The source is not loaded.");let _;ui._onLog&&(_=Date.now(),ui._onLog("drawImage(), START: "+_));let b=0,S=0,I=f,k=g,O=0,j=0,W=f,J=g;m&&(m.sx&&(b=Math.round(m.sx)),m.sy&&(S=Math.round(m.sy)),m.sWidth&&(I=Math.round(m.sWidth)),m.sHeight&&(k=Math.round(m.sHeight)),m.dx&&(O=Math.round(m.dx)),m.dy&&(j=Math.round(m.dy)),m.dWidth&&(W=Math.round(m.dWidth)),m.dHeight&&(J=Math.round(m.dHeight)));let K,Q=jr.RGBA;if((null==v?void 0:v.pixelFormat)&&(Q=v.pixelFormat),(null==v?void 0:v.bufferContainer)&&(K=v.bufferContainer,K.length<4*W*J))throw new Error("Unexpected size of the 'bufferContainer'.");const ie=l;if(!Wl(ui,_p,"f",Cp)||!(this.useWebGLByDefault&&null==(null==v?void 0:v.bUseWebGL)||(null==v?void 0:v.bUseWebGL))){ui._onLog&&ui._onLog("drawImage() in context2d."),ie.ctx2d||(ie.ctx2d=ie.getContext("2d",{willReadFrequently:!0}));const oe=ie.ctx2d;if(!oe)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(ie.width<O+W||ie.height<j+J)&&(ie.width=O+W,ie.height=j+J),oe.drawImage(u,b,S,I,k,O,j,W,J),ui._onLog&&ui._onLog("drawImage() in context2d end. Costs: "+(Date.now()-_)),{context:oe,pixelFormat:jr.RGBA,bUseWebGL:!1}}ui._onLog&&ui._onLog("drawImage() in WebGL.");try{(ie.width<O+W||ie.height<j+J)&&(ie.width=O+W,ie.height=j+J,ie.ctxWebGL&&ie.ctxWebGL.viewport(0,0,O+W,j+J));const oe=ie.ctxWebGL||ie.getContext("webgl",{antialias:!1})||ie.getContext("experimental-webgl",{antialias:!1});if(!oe){ui._onLog&&ui._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const ee=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw ee.name="WebGLError",ee}if(!ie.ctxWebGL||Q!==Wl(this,eD,"f")){ie.ctxWebGL=oe;const ee=P=>{const L=P.createBuffer();P.bindBuffer(P.ARRAY_BUFFER,L),P.bufferData(P.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),P.STATIC_DRAW);const X=P.createBuffer();return P.bindBuffer(P.ARRAY_BUFFER,X),P.bufferData(P.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),P.STATIC_DRAW),{positions:L,texCoords:X}},ke=P=>{const L=P.createTexture();return P.bindTexture(P.TEXTURE_2D,L),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),L},xe=(P,L)=>{const X=P.createProgram();if(L.forEach(ne=>P.attachShader(X,ne)),P.linkProgram(X),!P.getProgramParameter(X,P.LINK_STATUS)){const ne=new Error(`An error occured linking the program: ${P.getProgramInfoLog(X)}.`);throw ne.name="WebGLError",ne}return P.useProgram(X),X},Le=(P,L,X)=>{const ne=P.createShader(L);if(P.shaderSource(ne,X),P.compileShader(ne),!P.getShaderParameter(ne,P.COMPILE_STATUS)){const Z=new Error(`An error occured compiling the shader: ${P.getShaderInfoLog(ne)}.`);throw Z.name="WebGLError",Z}return ne},V="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let F="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(Q)&&(F=Q.slice(0,3));const z=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${F} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,$=xe(oe,[Le(oe,oe.VERTEX_SHADER,V),Le(oe,oe.FRAGMENT_SHADER,z)]);qd(this,yw,{program:$,attribLocations:{vertexPosition:oe.getAttribLocation($,"a_position"),texPosition:oe.getAttribLocation($,"a_texCoord")},uniformLocations:{uSampler:oe.getUniformLocation($,"u_image"),uColorFactor:oe.getUniformLocation($,"uColorFactor"),uMatrix:oe.getUniformLocation($,"u_matrix"),uTextureMatrix:oe.getUniformLocation($,"u_textureMatrix")}},"f"),qd(this,_w,ee(oe),"f"),qd(this,z_,ke(oe),"f"),qd(this,eD,Q,"f")}const le=(ee,ke,xe)=>{ee.bindBuffer(ee.ARRAY_BUFFER,ke),ee.enableVertexAttribArray(xe),ee.vertexAttribPointer(xe,2,ee.FLOAT,!1,0,0)},_e=(ee,ke,xe,Le)=>{ee.clearColor(0,0,0,1),ee.clearDepth(1),ee.enable(ee.DEPTH_TEST),ee.depthFunc(ee.LEQUAL),ee.clear(ee.COLOR_BUFFER_BIT|ee.DEPTH_BUFFER_BIT),le(ee,xe.positions,ke.attribLocations.vertexPosition),le(ee,xe.texCoords,ke.attribLocations.texPosition),ee.activeTexture(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_2D,Le),ee.uniform1i(ke.uniformLocations.uSampler,0),ee.uniform1f(ke.uniformLocations.uColorFactor,[jr.GREY,jr.GREY32].includes(Q)?1:0);let V,F,z=Qc.translate(Qc.identity(),-1,-1);z=Qc.scale(z,2,2),z=Qc.scale(z,1/ee.canvas.width,1/ee.canvas.height),V=Qc.translate(z,O,j),V=Qc.scale(V,W,J),ee.uniformMatrix3fv(ke.uniformLocations.uMatrix,!1,V),F=Qc.translate(Qc.identity(),b/f,S/g),F=Qc.scale(F,I/f,k/g),ee.uniformMatrix3fv(ke.uniformLocations.uTextureMatrix,!1,F),ee.drawArrays(ee.TRIANGLES,0,6)};((ee,ke,xe)=>{const Le=ee.RGBA,V=ee.RGBA,F=ee.UNSIGNED_BYTE;ee.bindTexture(ee.TEXTURE_2D,ke),ee.texImage2D(ee.TEXTURE_2D,0,Le,V,F,xe)})(oe,Wl(this,z_,"f"),u),_e(oe,Wl(this,yw,"f"),Wl(this,_w,"f"),Wl(this,z_,"f"));const Ve=K||new Uint8Array(4*W*J);if(oe.readPixels(O,j,W,J,oe.RGBA,oe.UNSIGNED_BYTE,Ve),255!==Ve[3]){ui._onLog&&ui._onLog("Incorrect WebGL drawing .");const ee=new Error("WebGL error: incorrect drawing.");throw ee.name="WebGLError",ee}return ui._onLog&&ui._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-_)),{context:oe,pixelFormat:Q===jr.GREY?jr.GREY32:Q,bUseWebGL:!0}}catch(oe){if(this.forceLoseContext(),null==(null==v?void 0:v.bUseWebGL))return ui._onLog&&ui._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(l,u,f,g,m,Object.assign({},v,{bUseWebGL:!1}));throw oe.name="WebGLError",oe}}readCvsData(l,u,f){if(!(l instanceof CanvasRenderingContext2D||l instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let g,m=0,v=0,_=l.canvas.width,b=l.canvas.height;if(u&&(u.x&&(m=u.x),u.y&&(v=u.y),u.width&&(_=u.width),u.height&&(b=u.height)),(null==f?void 0:f.length)<4*_*b)throw new Error("Unexpected size of the 'bufferContainer'.");if(l instanceof WebGLRenderingContext){const S=l;f?(S.readPixels(m,v,_,b,S.RGBA,S.UNSIGNED_BYTE,f),g=new Uint8Array(f.buffer,0,4*_*b)):(g=new Uint8Array(4*_*b),S.readPixels(m,v,_,b,S.RGBA,S.UNSIGNED_BYTE,g))}else if(l instanceof CanvasRenderingContext2D){let S;S=l.getImageData(m,v,_,b),g=new Uint8Array(S.data.buffer),null==f||f.set(g)}return g}transformPixelFormat(l,u,f,g){let m,v;if(ui._onLog&&(m=Date.now(),ui._onLog("transformPixelFormat(), START: "+m)),u===f)return ui._onLog&&ui._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),g?new Uint8Array(l):l;const _=[jr.RGBA,jr.RBGA,jr.GRBA,jr.GBRA,jr.BRGA,jr.BGRA];if(_.includes(u))if(f===jr.GREY){v=new Uint8Array(l.length/4);for(let b=0;b<l.length;b+=4)v[b/4]=.21*l[b]+.71*l[b+1]+.07*l[b+2]}else if(f===jr.GREY32){v=g?new Uint8Array(l):l;for(let b=0;b<l.length;b+=4){const S=.21*l[b]+.71*l[b+1]+.07*l[b+2];v[b]=S,v[b+1]=S,v[b+2]=S}}else{if(!_.includes(f))throw new Error("Unable to transform.");if(g){v=new Uint8Array(l);const b=u.indexOf("r"),S=u.indexOf("g"),I=u.indexOf("b"),k=f.indexOf("r"),O=f.indexOf("g"),j=f.indexOf("b");for(let W=0;W<l.length;W+=4)v[W+k]=l[W+b],v[W+O]=l[W+S],v[W+j]=l[W+I]}else{v=l;const b=u.indexOf("r"),S=u.indexOf("g"),I=u.indexOf("b"),k=f.indexOf("r"),O=f.indexOf("g"),j=f.indexOf("b");for(let W=0;W<l.length;W+=4){let J=[l[W],l[W+1],l[W+2]];v[W+k]=J[b],v[W+O]=J[S],v[W+j]=J[I]}}}else if(u===jr.GREY){if(f!==jr.GREY32)throw new Error("Unable to transform.");v=new Uint8Array(4*l.length);for(let b=0;b<l.length;b++)v[4*b]=l[b],v[4*b+1]=l[b],v[4*b+2]=l[b],v[4*b+3]=255}else{if(u!==jr.GREY32)throw new Error("Unable to transform.");if(f!==jr.GREY)throw new Error("Unable to transform.");v=new Uint8Array(l.length/4);for(let b=0;b<l.length;b+=4)v[b/4]=l[b]}return ui._onLog&&ui._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),v}getImageData(l,u,f,g,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!u||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Wl(ui,_p,"f",Cp)&&ui.checkWebGLSupport(),(null==m?void 0:m.bUseWebGL)&&!Wl(ui,_p,"f",Cp))throw new Error("Your browser or machine may not support WebGL.");if(g.sx>u||g.sy>f||g.sx+g.sWidth>u||g.sy+g.sHeight>f)throw new Error("Invalid position.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let v;ui._onLog&&(v=Date.now(),ui._onLog("getImageData(), START: "+v));const _=Math.round(g.sx),b=Math.round(g.sy),S=Math.round(g.sWidth),I=Math.round(g.sHeight),k=Math.round(g.dWidth),O=Math.round(g.dHeight);let j=jr.RGBA;(null==m?void 0:m.pixelFormat)&&(j=m.pixelFormat);let W,J,K,Q=null;if((null==m?void 0:m.bufferContainer)&&(Q=m.bufferContainer),Wl(ui,_p,"f",Cp)&&(this.useWebGLByDefault&&null==(null==m?void 0:m.bUseWebGL)||(null==m?void 0:m.bUseWebGL))){ui._onLog&&ui._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),W=this._reusedWebGLCvs;try{if(Q)if(j===jr.GREY){if(K=new Uint8Array(4*k*O),J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:j,bUseWebGL:!0,bufferContainer:K}),K=this.transformPixelFormat(K,J.pixelFormat,j),Q){if(Q.length<K.length)throw new Error("Unexpected size of the 'bufferContainer'.");Q.set(K)}}else J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:j,bUseWebGL:!0,bufferContainer:Q}),K=new Uint8Array(Q.buffer,0,4*k*O),K=this.transformPixelFormat(K,J.pixelFormat,j);else j===jr.GREY?((!Wl(this,Y_,"f")||Wl(this,Y_,"f").length<4*k*O)&&qd(this,Y_,new Uint8Array(4*k*O),"f"),K=new Uint8Array(Wl(this,Y_,"f").buffer,0,4*k*O)):K=new Uint8Array(4*k*O),J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:j,bUseWebGL:!0,bufferContainer:K}),K=this.transformPixelFormat(K,J.pixelFormat,j)}catch(ie){if("WebGLError"===ie.name&&(this.forceLoseContext(),null==(null==m?void 0:m.bUseWebGL)))return ui._onLog&&ui._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},Object.assign({},m,{bUseWebGL:!1}));throw ie}}else if(ui._onLog&&ui._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),W=this._reusedCvs,J=this.drawImage(W,l,u,f,{sx:_,sy:b,sWidth:S,sHeight:I,dWidth:k,dHeight:O},{pixelFormat:jr.RGBA,bUseWebGL:!1}),K=this.readCvsData(J.context,{width:k,height:O},null),K=this.transformPixelFormat(K,J.pixelFormat,j),Q){if(Q.length<K.length)throw new Error("Unexpected size of the 'bufferContainer'.");Q.set(K)}return ui._onLog&&ui._onLog("getImageData() end. Costs: "+(Date.now()-v)),{data:K,pixelFormat:j,width:k,height:O,bUseWebGL:J.bUseWebGL}}convertDataToCvs(l,u,f,g){if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof u||u<=0)throw new Error("Invalid 'width'.");if("number"!=typeof f||f<=0)throw new Error("Invalid 'height'.");const m=document.createElement("canvas");let v;if(m.width=u,m.height=f,g===jr.GREY){v=new Uint8ClampedArray(4*u*f);for(let b=0;b<v.length;b+=4)v[b]=l[b/4],v[b+1]=l[b/4],v[b+2]=l[b/4],v[b+3]=255}else v=new Uint8ClampedArray(l.buffer);const _=new ImageData(v,u,f);return m.getContext("2d").putImageData(_,0,0),m}forceLoseContext(){if(!this._reusedWebGLCvs)return;const l=this._reusedWebGLCvs.ctxWebGL;l&&!l.isContextLost()&&l.getExtension("WEBGL_lose_context")&&l.getExtension("WEBGL_lose_context").loseContext(),qd(this,z_,null,"f"),qd(this,yw,null,"f"),qd(this,_w,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),qd(this,tD,!0,"f")}}_p=ui,eD=new WeakMap,z_=new WeakMap,yw=new WeakMap,_w=new WeakMap,Y_=new WeakMap,tD=new WeakMap,Cp={value:void 0};class JPe{constructor(){zv.set(this,new Map),nD.set(this,!1)}get disposed(){return rt(this,nD,"f")}on(l,u){l=l.toLowerCase();const f=rt(this,zv,"f").get(l);if(f){if(f.includes(u))return;f.push(u)}else rt(this,zv,"f").set(l,[u])}off(l,u){l=l.toLowerCase();const f=rt(this,zv,"f").get(l);if(!f)return;const g=f.indexOf(u);-1!==g&&f.splice(g,1)}offAll(l){l=l.toLowerCase();const u=rt(this,zv,"f").get(l);u&&(u.length=0)}fire(l){var u=arguments,f=this;return Fe(function*(){let g=u.length>1&&void 0!==u[1]?u[1]:[],m=u.length>2&&void 0!==u[2]?u[2]:{async:!1,copy:!0};g||(g=[]),l=l.toLowerCase();const v=rt(f,zv,"f").get(l);if(v&&v.length){m=Object.assign({async:!1,copy:!0},m);for(let _ of v){if(!_)continue;let b=[];if(m.copy)for(let I of g){try{I=JSON.parse(JSON.stringify(I))}catch(k){}b.push(I)}else b=g;let S=!1;if(m.async)setTimeout(()=>{f.disposed||_.apply(m.target,b)},0);else try{S=yield _.apply(m.target,b)}catch(I){}if(!0===S)break}}})()}dispose(){Ki(this,nD,!0,"f")}}zv=new WeakMap,nD=new WeakMap;const uc=(p,l,u,f)=>{if(!u)return p;let g=l+Math.round((p-l)/u)*u;return f&&(g=Math.min(g,f)),g};class vi{static get version(){return"2.0.0-16"}static isStorageAvailable(l){let u;try{u=window[l];const f="__storage_test__";return u.setItem(f,f),u.removeItem(f),!0}catch(f){return f instanceof DOMException&&(22===f.code||1014===f.code||"QuotaExceededError"===f.name||"NS_ERROR_DOM_QUOTA_REACHED"===f.name)&&u&&0!==u.length}}static findBestRearCameraInIOS(l,u){if(!l||!l.length)return null;let f=!1;if((null==u?void 0:u.getMainCamera)&&(f=!0),f){const g=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],m=l.find(v=>g.includes(v.label.toLowerCase()));return null==m?void 0:m.deviceId}{const g=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],m=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],v=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],_=l.filter(I=>{const k=I.label.toLowerCase();return g.some(O=>k.includes(O))});if(!_.length)return null;const b=_.find(I=>{const k=I.label.toLowerCase();return m.some(O=>k.includes(O))});if(b)return b.deviceId;const S=_.find(I=>{const k=I.label.toLowerCase();return v.some(O=>k.includes(O))});return S?S.deviceId:_[0].deviceId}}static findBestRearCamera(l,u){if(!l||!l.length)return null;if(["iPhone","iPad","Mac"].includes(Jo.OS))return vi.findBestRearCameraInIOS(l,{getMainCamera:null==u?void 0:u.getMainCameraInIOS});const f=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let g of l){const m=g.label.toLowerCase();if(m&&f.some(v=>m.includes(v))&&/\b0(\b)?/.test(m))return g.deviceId}return["Android","HarmonyOS"].includes(Jo.OS)?l[l.length-1].deviceId:null}static findBestCamera(l,u,f){return l&&l.length?"environment"===u?this.findBestRearCamera(l,f):"user"===u?null:u?void 0:null:null}static playVideo(l,u,f){return Fe(function*(){if(!l)throw new Error("Invalid 'videoEl'.");if(!u)throw new Error("Invalid 'source'.");return"string"==typeof u||u instanceof String?l.src=u:l.srcObject=u,new Promise((g,m)=>{let v;const _=()=>{l.removeEventListener("loadstart",I),l.removeEventListener("abort",k),l.removeEventListener("play",O),l.removeEventListener("error",j)},b=()=>{v&&clearTimeout(v),_(),g(l)},S=W=>{v&&clearTimeout(v),_(),m(W)},I=()=>{l.addEventListener("abort",k,{once:!0})},k=()=>{const W=new Error("Video playing was interrupted.");W.name="AbortError",S(W)},O=()=>{b()},j=()=>{S(new Error(`Video error ${l.error.code}: ${l.error.message}.`))};l.addEventListener("loadstart",I,{once:!0}),l.autoplay&&["iPhone","iPad","Mac"].includes(Jo.OS)&&Jo.version>=17?(l.addEventListener("play",O,{once:!0}),l.addEventListener("error",j,{once:!0})):(l.load(),l.play().then(()=>{b()}).catch(W=>{S(W)})),f&&(v=setTimeout(()=>{_(),m(new Error("Failed to play video. Timeout."))},f))})})()}static testCameraAccess(l){return Fe(function*(){var u,f;if(!(null===(f=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===f?void 0:f.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let g;try{g=l?yield navigator.mediaDevices.getUserMedia(l):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(m){return{ok:!1,errorName:m.name,errorMessage:m.message}}finally{null==g||g.getTracks().forEach(m=>{m.stop()})}return{ok:!0}})()}get state(){if(!rt(this,Zc,"f"))return"closed";if("pending"===rt(this,Zc,"f"))return"opening";if("fulfilled"===rt(this,Zc,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(l){l&&vi.isStorageAvailable("localStorage")?Ki(this,Cw,!0,"f"):Ki(this,Cw,!1,"f")}get ifSaveLastUsedCamera(){return rt(this,Cw,"f")}get isVideoPlaying(){return!(!rt(this,wi,"f")||rt(this,wi,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(l){var u,f,g;if(!(l instanceof HTMLElement)&&null!=l)throw new TypeError("Invalid 'element'.");null===(u=rt(this,Yv,"f"))||void 0===u||u.removeEventListener("click",rt(this,q_,"f")),null===(f=rt(this,Yv,"f"))||void 0===f||f.removeEventListener("touchend",rt(this,q_,"f")),null===(g=rt(this,Yv,"f"))||void 0===g||g.removeEventListener("touchmove",rt(this,sD,"f")),Ki(this,Yv,l,"f"),l&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(Jo.OS)?(l.addEventListener("touchend",rt(this,q_,"f")),l.addEventListener("touchmove",rt(this,sD,"f"))):l.addEventListener("click",rt(this,q_,"f")))}get tapFocusEventBoundEl(){return rt(this,Yv,"f")}get disposed(){return rt(this,lD,"f")}constructor(l){var f,g,u=this;Fn.add(this),wi.set(this,null),sr.set(this,void 0),iD.set(this,()=>{"opened"===this.state&&rt(this,Xs,"f").fire("resumed",null,{target:this,async:!0})}),rD.set(this,()=>{rt(this,Xs,"f").fire("paused",null,{target:this,async:!1})}),Kr.set(this,void 0),$u.set(this,void 0),this.cameraOpenTimeout=4e3,this._arrCameras=[],bp.set(this,void 0),Cw.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,oD.set(this,void 0),Qh.set(this,!0),xp.set(this,void 0),Zc.set(this,void 0),X_.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},$_.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(m,v)=>{let _,b;const S=window.getComputedStyle(rt(this,wi,"f")).objectFit,I=this.getResolution(),k=rt(this,wi,"f").getBoundingClientRect(),O=k.left,j=k.top,{width:W,height:J}=rt(this,wi,"f").getBoundingClientRect();if(W<=0||J<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const K=W/J,Q=I.width/I.height;let ie=1;if("contain"===S)Q>K?(ie=W/I.width,_=(m-O)/ie,b=(v-j-(J-W/Q)/2)/ie):(ie=J/I.height,b=(v-j)/ie,_=(m-O-(W-J*Q)/2)/ie);else{if("cover"!==S)throw new Error("Unsupported object-fit.");Q>K?(ie=J/I.height,b=(v-j)/ie,_=(m-O+(J*Q-W)/2)/ie):(ie=W/I.width,_=(m-O)/ie,b=(v-j+(W/Q-J)/2)/ie)}return{x:_,y:b}},bw.set(this,!1),sD.set(this,()=>{Ki(this,bw,!0,"f")}),q_.set(this,function(){var m=Fe(function*(v){var _;if(rt(u,bw,"f"))return void Ki(u,bw,!1,"f");if(!(rt(u,$_,"f")&&u.isVideoPlaying&&rt(u,sr,"f")&&u._focusSupported))return;if(!u._focusParameters.fds&&(u._focusParameters.fds=null===(_=u.getCameraCapabilities())||void 0===_?void 0:_.focusDistance,!u._focusParameters.fds))return void(u._focusSupported=!1);if(null==u._focusParameters.kTimeout&&(u._focusParameters.kTimeout=(u._focusParameters.maxTimeout-u._focusParameters.minTimeout)/(1/u._focusParameters.fds.min-1/u._focusParameters.fds.max)),1==u._focusParameters.isDoingFocus)return;let b,S;if(u._focusParameters.taskBackToContinous&&(clearTimeout(u._focusParameters.taskBackToContinous),u._focusParameters.taskBackToContinous=null),v instanceof MouseEvent)b=v.clientX,S=v.clientY;else{if(!(v instanceof TouchEvent))throw new Error("Unknown event type.");if(!v.changedTouches.length)return;b=v.changedTouches[0].clientX,S=v.changedTouches[0].clientY}const I=u.getResolution(),k=2*Math.round(Math.min(I.width,I.height)/u._focusParameters.defaultFocusAreaSizeRatio/2);let O;try{O=u.calculateCoordInVideo(b,S)}catch(Q){}if(O.x<0||O.x>I.width||O.y<0||O.y>I.height)return;const j={x:O.x+"px",y:O.y+"px"},W=k+"px",J=W;let K;vi._onLog&&(K=Date.now());try{yield rt(u,Fn,"m",nL).call(u,j,W,J,u._focusParameters.tapFocusMinDistance,u._focusParameters.tapFocusMaxDistance)}catch(Q){if(vi._onLog)throw vi._onLog(Q),Q}vi._onLog&&vi._onLog(`Tap focus costs: ${Date.now()-K} ms`),u._focusParameters.taskBackToContinous=setTimeout(()=>{var Q;vi._onLog&&vi._onLog("Back to continuous focus."),null===(Q=rt(u,sr,"f"))||void 0===Q||Q.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},u._focusParameters.focusBackToContinousTime),rt(u,Xs,"f").fire("tapfocus",null,{target:u,async:!0})});return function(v){return m.apply(this,arguments)}}()),Yv.set(this,null),wp.set(this,1),Sp.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!rt(this,wi,"f"))return;const m=rt(this,wp,"f");if(m<1)throw new RangeError("Invalid scale value.");if(1===m)rt(this,wi,"f").style.transform="";else{const v=window.getComputedStyle(rt(this,wi,"f")).objectFit,_=rt(this,wi,"f").videoWidth,b=rt(this,wi,"f").videoHeight,{width:S,height:I}=rt(this,wi,"f").getBoundingClientRect();if(S<=0||I<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const k=S/I,O=_/b;let j=1;"contain"===v?j=k<O?S/(_/m):I/(b/m):"cover"===v&&(j=O>k?I/(_/m):S/(b/m));const W=j*(1-1/m)*(_/2-rt(this,Sp,"f").x),J=j*(1-1/m)*(b/2-rt(this,Sp,"f").y);rt(this,wi,"f").style.transform=`translate(${W}px, ${J}px) scale(${m})`}},QF.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const m=document.createElement("canvas");let v;if(m.width=this.width,m.height=this.height,this.pixelFormat===jr.GREY){v=new Uint8ClampedArray(this.width*this.height*4);for(let b=0;b<v.length;b+=4)v[b]=this.data[b/4],v[b+1]=this.data[b/4],v[b+2]=this.data[b/4],v[b+3]=255}else v=new Uint8ClampedArray(this.data.buffer);const _=new ImageData(v,this.width,this.height);return m.getContext("2d").putImageData(_,0,0),m}),Xs.set(this,void 0),ZF.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],Xv.set(this,new Map),K_.set(this,!1),aD.set(this,Fe(function*(){var m,v;if("visible"===document.visibilityState){if(vi._onLog&&vi._onLog("document visible. video paused: "+(null===(m=rt(u,wi,"f"))||void 0===m?void 0:m.paused)),rt(u,K_,"f")&&rt(u,wi,"f")&&u.videoSrc&&"opened"===u.state)return void u.resume().catch(()=>{});if(!u._mediaStream)return;if(u._mediaStream.active&&rt(u,sr,"f"))if(rt(u,sr,"f").muted&&["iPhone","iPad","Mac"].includes(Jo.OS)){if(Jo.version>=17)return;yield rt(u,Fn,"m",J_).call(u)}else rt(u,K_,"f")&&u.resume().catch(()=>{});else yield rt(u,Fn,"m",J_).call(u)}else if("hidden"===document.visibilityState&&(vi._onLog&&vi._onLog("document hidden. video paused: "+(null===(v=rt(u,wi,"f"))||void 0===v?void 0:v.paused)),["iPhone","iPad","Mac"].includes(Jo.OS)?Ki(u,K_,!0,"f"):Ki(u,K_,u.isVideoPlaying,"f"),u.isVideoLoaded()&&"opened"==u.state)){if(["iPhone","iPad","Mac"].includes(Jo.OS)&&Jo.version>=17)return;u.pause()}})),lD.set(this,!1),(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia)||setTimeout(()=>{vi.onWarning&&vi.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),l instanceof HTMLVideoElement&&this.setVideoEl(l),Ki(this,Xs,new JPe,"f"),this.imageDataGetter=new ui,document.addEventListener("visibilitychange",rt(this,aD,"f"))}setVideoEl(l){if(!(l&&l instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");l.addEventListener("play",rt(this,iD,"f")),l.addEventListener("pause",rt(this,rD,"f")),Ki(this,wi,l,"f")}getVideoEl(){return rt(this,wi,"f")}releaseVideoEl(){var l,u;null===(l=rt(this,wi,"f"))||void 0===l||l.removeEventListener("play",rt(this,iD,"f")),null===(u=rt(this,wi,"f"))||void 0===u||u.removeEventListener("pause",rt(this,rD,"f")),Ki(this,wi,null,"f")}isVideoLoaded(){return!!rt(this,wi,"f")&&4==rt(this,wi,"f").readyState}open(){var l=this;return Fe(function*(){if(rt(l,xp,"f")&&!rt(l,Qh,"f")){if("pending"===rt(l,Zc,"f"))return rt(l,xp,"f");if("fulfilled"===rt(l,Zc,"f"))return}rt(l,Xs,"f").fire("before:open",null,{target:l}),yield rt(l,Fn,"m",J_).call(l),rt(l,Xs,"f").fire("opened",null,{target:l,async:!0}),rt(l,Xs,"f").fire("played",null,{target:l,async:!0})})()}close(){var l=this;return Fe(function*(){if("closed"===l.state)return;rt(l,Xs,"f").fire("before:close",null,{target:l});const u=rt(l,xp,"f");if(rt(l,Fn,"m",cD).call(l),u&&"pending"===rt(l,Zc,"f")){try{yield u}catch(f){}if(!1===rt(l,Qh,"f")){const f=new Error("'close()' was interrupted.");throw f.name="AbortError",f}}Ki(l,xp,null,"f"),Ki(l,Zc,null,"f"),rt(l,Xs,"f").fire("closed",null,{target:l,async:!0})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");rt(this,wi,"f").pause()}resume(){var l=this;return Fe(function*(){if(!l.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==l.state)throw new Error("Camera or video is not open.");yield rt(l,wi,"f").play()})()}setCamera(l){var u=this;return Fe(function*(){if("string"!=typeof l)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof rt(u,Kr,"f").video&&(rt(u,Kr,"f").video={}),delete rt(u,Kr,"f").video.facingMode,rt(u,Kr,"f").video.deviceId={exact:l},!("closed"===u.state||u.videoSrc||"opening"===u.state&&rt(u,Qh,"f"))){rt(u,Xs,"f").fire("before:camera:change",[],{target:u,async:!1}),yield rt(u,Fn,"m",xw).call(u);try{u.resetSoftwareScale()}catch(f){}return rt(u,$u,"f")}})()}switchToFrontCamera(l){var u=this;return Fe(function*(){if("object"!=typeof rt(u,Kr,"f").video&&(rt(u,Kr,"f").video={}),(null==l?void 0:l.resolution)&&(rt(u,Kr,"f").video.width={ideal:l.resolution.width},rt(u,Kr,"f").video.height={ideal:l.resolution.height}),delete rt(u,Kr,"f").video.deviceId,rt(u,Kr,"f").video.facingMode={exact:"user"},Ki(u,bp,null,"f"),!("closed"===u.state||u.videoSrc||"opening"===u.state&&rt(u,Qh,"f"))){rt(u,Xs,"f").fire("before:camera:change",[],{target:u,async:!1}),rt(u,Fn,"m",xw).call(u);try{u.resetSoftwareScale()}catch(f){}return rt(u,$u,"f")}})()}getCamera(){var l;if(rt(this,$u,"f"))return rt(this,$u,"f");{let u=(null===(l=rt(this,Kr,"f").video)||void 0===l?void 0:l.deviceId)||"";if(u){u=u.exact||u.ideal||u;for(let f of this._arrCameras)if(f.deviceId===u)return JSON.parse(JSON.stringify(f))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(l){var u=this;return Fe(function*(){var f,g;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;if(l){let b=yield navigator.mediaDevices.getUserMedia({video:!0});m=(yield navigator.mediaDevices.enumerateDevices()).filter(S=>"videoinput"===S.kind),b.getTracks().forEach(S=>{S.stop()})}else m=(yield navigator.mediaDevices.enumerateDevices()).filter(b=>"videoinput"===b.kind);const v=[],_=[];if(u._arrCameras)for(let b of u._arrCameras)b._checked&&_.push(b);for(let b=0;b<m.length;b++){let S,I=m[b];for(let k of _)if(I.deviceId==k.deviceId){S=k;break}S||(S={deviceId:I.deviceId,label:I.label?I.label:"camera "+b,_checked:!1}),S.deviceId&&v.push(S)}return u._arrCameras=v,vi._onLog&&vi._onLog(JSON.stringify(u._arrCameras)),v})()}getCameras(){var l=this;return Fe(function*(){var u,f;if(!(null===(f=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===f?void 0:f.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const g=(yield navigator.mediaDevices.enumerateDevices()).filter(m=>"videoinput"===m.kind);return l._getCameras(!(!g||!g.length||g[0].deviceId))})()}getAllCameras(){var l=this;return Fe(function*(){return l.getCameras()})()}setResolution(l,u,f){var g=this;return Fe(function*(){if("number"!=typeof l||l<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof u||u<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof rt(g,Kr,"f").video&&(rt(g,Kr,"f").video={}),f?(rt(g,Kr,"f").video.width={exact:l},rt(g,Kr,"f").video.height={exact:u}):(rt(g,Kr,"f").video.width={ideal:l},rt(g,Kr,"f").video.height={ideal:u}),"closed"===g.state||g.videoSrc||"opening"===g.state&&rt(g,Qh,"f"))return null;rt(g,Xs,"f").fire("before:resolution:change",[],{target:g,async:!1}),yield rt(g,Fn,"m",xw).call(g);try{g.resetSoftwareScale()}catch(v){}const m=g.getResolution();return{width:m.width,height:m.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&rt(this,wi,"f"))return{width:rt(this,wi,"f").videoWidth,height:rt(this,wi,"f").videoHeight};if(rt(this,sr,"f")){const l=rt(this,sr,"f").getSettings();return{width:l.width,height:l.height}}if(this.isVideoLoaded())return{width:rt(this,wi,"f").videoWidth,height:rt(this,wi,"f").videoHeight};{const l={width:0,height:0};let u=rt(this,Kr,"f").video.width||0,f=rt(this,Kr,"f").video.height||0;return u&&(l.width=u.exact||u.ideal||u),f&&(l.height=f.exact||f.ideal||f),l}}getResolutions(l){var u=this;return Fe(function*(){var f,g,m,v,_,b,S,I,k,O,j;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let W="";const J=(K,Q)=>{const ie=rt(u,Xv,"f").get(K);if(!ie||!ie.length)return!1;for(let oe of ie)if(oe.width===Q.width&&oe.height===Q.height)return!0;return!1};if(u._mediaStream){W=null===(j=rt(u,$u,"f"))||void 0===j?void 0:j.deviceId;let K=rt(u,Xv,"f").get(W);if(K&&!l)return JSON.parse(JSON.stringify(K));K=[],rt(u,Xv,"f").set(W,K),Ki(u,X_,!0,"f");try{for(let Q of u.detectedResolutions){yield rt(u,sr,"f").applyConstraints({width:{ideal:Q.width},height:{ideal:Q.height}}),rt(u,Fn,"m",Kd).call(u);const ie=rt(u,sr,"f").getSettings(),oe={width:ie.width,height:ie.height};J(W,oe)||K.push({width:oe.width,height:oe.height})}}catch(Q){throw rt(u,Fn,"m",cD).call(u),Ki(u,X_,!1,"f"),Q}try{yield rt(u,Fn,"m",J_).call(u)}catch(Q){if("AbortError"===Q.name)return K;throw Q}finally{Ki(u,X_,!1,"f")}return K}{const K=function(){var oe=Fe(function*(le,he,_e){const Ve={video:{deviceId:{exact:le},width:{ideal:he},height:{ideal:_e}}};let ee=null;try{ee=yield navigator.mediaDevices.getUserMedia(Ve)}catch(Le){return null}if(!ee)return null;const ke=ee.getVideoTracks();let xe=null;try{const Le=ke[0].getSettings();xe={width:Le.width,height:Le.height}}catch(Le){const V=document.createElement("video");V.srcObject=ee,xe={width:V.videoWidth,height:V.videoHeight},V.srcObject=null}return ke.forEach(Le=>{Le.stop()}),xe});return function(he,_e,Ve){return oe.apply(this,arguments)}}();let Q=(null===(_=null===(v=null===(m=rt(u,Kr,"f"))||void 0===m?void 0:m.video)||void 0===v?void 0:v.deviceId)||void 0===_?void 0:_.exact)||(null===(I=null===(S=null===(b=rt(u,Kr,"f"))||void 0===b?void 0:b.video)||void 0===S?void 0:S.deviceId)||void 0===I?void 0:I.ideal)||(null===(O=null===(k=rt(u,Kr,"f"))||void 0===k?void 0:k.video)||void 0===O?void 0:O.deviceId);if(!Q)return[];let ie=rt(u,Xv,"f").get(Q);if(ie&&!l)return JSON.parse(JSON.stringify(ie));ie=[],rt(u,Xv,"f").set(Q,ie);for(let oe of u.detectedResolutions){const le=yield K(Q,oe.width,oe.height);le&&!J(Q,le)&&ie.push({width:le.width,height:le.height})}return ie}})()}setMediaStreamConstraints(l,u){var f=this;return Fe(function*(){if(null===(g=l)||"[object Object]"!==Object.prototype.toString.call(g))throw new TypeError("Invalid 'mediaStreamConstraints'.");var g;Ki(f,Kr,JSON.parse(JSON.stringify(l)),"f"),Ki(f,bp,null,"f"),u&&rt(f,Fn,"m",xw).call(f)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(rt(this,Kr,"f")))}resetMediaStreamConstraints(){Ki(this,Kr,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!rt(this,sr,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return rt(this,sr,"f").getCapabilities?rt(this,sr,"f").getCapabilities():{}}getCameraSettings(){if(!rt(this,sr,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return rt(this,sr,"f").getSettings()}turnOnTorch(){var l=this;return Fe(function*(){if(!rt(l,sr,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield rt(l,sr,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var l=this;return Fe(function*(){if(!rt(l,sr,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield rt(l,sr,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(l,u){var f=this;return Fe(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!rt(f,sr,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.colorTemperature;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=uc(l,m.min,m.step,m.max)),yield rt(f,sr,"f").applyConstraints({advanced:[{colorTemperature:l,whiteBalanceMode:"manual"}]}),l})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(l,u){var f=this;return Fe(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!rt(f,sr,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.exposureCompensation;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=uc(l,m.min,m.step,m.max)),yield rt(f,sr,"f").applyConstraints({advanced:[{exposureCompensation:l}]}),l})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(l,u){var f=this;return Fe(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!rt(f,sr,"f")||"opened"!==f.state)throw new Error("Camera is not open.");let m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.frameRate;if(!m)throw Error("Not supported.");u&&(l<m.min?l=m.min:l>m.max&&(l=m.max));const v=f.getResolution();return yield rt(f,sr,"f").applyConstraints({width:{ideal:Math.max(v.width,v.height)},frameRate:l}),l})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(l,u){var f=this;return Fe(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if(!rt(f,sr,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const g=f.getCameraCapabilities(),m=null==g?void 0:g.focusMode,v=null==g?void 0:g.focusDistance;if(!m)throw Error("Not supported.");if("string"!=typeof l.mode)throw TypeError("Invalid 'mode'.");const _=l.mode.toLowerCase();if(!m.includes(_))throw Error("Unsupported focus mode.");if("manual"===_){if(!v)throw Error("Manual focus unsupported.");if(l.hasOwnProperty("distance")){let b=l.distance;u&&(b<v.min?b=v.min:b>v.max&&(b=v.max),b=uc(b,v.min,v.step,v.max)),f._focusParameters.focusArea=null,yield rt(f,sr,"f").applyConstraints({advanced:[{focusMode:_,focusDistance:b}]})}else{if(!l.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const b=l.area.centerPoint;let S=l.area.width,I=l.area.height;if(!S||!I){const k=f.getResolution();S||(S=2*Math.round(Math.min(k.width,k.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),I||(I=2*Math.round(Math.min(k.width,k.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}f._focusParameters.focusArea={centerPoint:{x:b.x,y:b.y},width:S,height:I},yield rt(f,Fn,"m",nL).call(f,b,S,I)}}}else f._focusParameters.focusArea=null,yield rt(f,sr,"f").applyConstraints({advanced:[{focusMode:_}]})})()}getFocus(){const l=this.getCameraSettings(),u=l.focusMode;return u?"manual"===u?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:l.focusDistance}:{mode:u}:null}enableTapToFocus(){var l=this;return Fe(function*(){Ki(l,$_,!0,"f")})()}disableTapToFocus(){Ki(this,$_,!1,"f")}isTapToFocusEnabled(){return rt(this,$_,"f")}setZoom(l){var u=this;return Fe(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if("number"!=typeof l.factor)throw new TypeError("Illegal type of 'factor'.");if(l.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==u.state)throw new Error("Video is not playing.");l.centerPoint?rt(u,Fn,"m",iL).call(u,l.centerPoint):u.resetScaleCenter();try{if(rt(u,Fn,"m",Lte).call(u,rt(u,Sp,"f"))){const f=yield u.setHardwareScale(l.factor,!0);let g=u.getHardwareScale();1==g&&1!=f&&(g=f),u.setSoftwareScale(l.factor>g?l.factor/g:1)}else yield u.setHardwareScale(1),u.setSoftwareScale(l.factor)}catch(f){const g=f.message||f;if("Not supported."!==g&&"Camera is not open."!==g)throw f;u.setSoftwareScale(l.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let l=1;try{l=this.getHardwareScale()}catch(u){if("Camera is not open."!==(u.message||u))throw u}return{factor:l*rt(this,wp,"f")}}resetZoom(){var l=this;return Fe(function*(){yield l.setZoom({factor:1})})()}setHardwareScale(l,u){var f=this;return Fe(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if(!rt(f,sr,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.zoom;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=uc(l,m.min,m.step,m.max)),yield rt(f,sr,"f").applyConstraints({advanced:[{zoom:l}]}),l})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(l,u){if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");u&&rt(this,Fn,"m",iL).call(this,u),Ki(this,wp,l,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return rt(this,wp,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();Ki(this,Sp,{x:l.width/2,y:l.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(l){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||rt(this,X_,"f"))return null;const u=Date.now();vi._onLog&&vi._onLog("getFrameData() START: "+u);const f=rt(this,wi,"f").videoWidth,g=rt(this,wi,"f").videoHeight;let m={sx:0,sy:0,sWidth:f,sHeight:g,dWidth:f,dHeight:g};(null==l?void 0:l.position)&&(m=JSON.parse(JSON.stringify(l.position)));let v=jr.RGBA;(null==l?void 0:l.pixelFormat)&&(v=l.pixelFormat);let _=rt(this,wp,"f");(null==l?void 0:l.scale)&&(_=l.scale);let b=rt(this,Sp,"f");if(null==l?void 0:l.scaleCenter){if("string"!=typeof l.scaleCenter.x||"string"!=typeof l.scaleCenter.y)throw new Error("Invalid scale center.");let O=0,j=0;if(l.scaleCenter.x.endsWith("px"))O=parseFloat(l.scaleCenter.x);else{if(!l.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");O=parseFloat(l.scaleCenter.x)/100*f}if(l.scaleCenter.y.endsWith("px"))j=parseFloat(l.scaleCenter.y);else{if(!l.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");j=parseFloat(l.scaleCenter.y)/100*g}if(isNaN(O)||isNaN(j))throw new Error("Invalid scale center.");b.x=Math.round(O),b.y=Math.round(j)}let S=null;if((null==l?void 0:l.bufferContainer)&&(S=l.bufferContainer),0==f||0==g)return null;1!==_&&(m.sWidth=Math.round(m.sWidth/_),m.sHeight=Math.round(m.sHeight/_),m.sx=Math.round((1-1/_)*b.x+m.sx/_),m.sy=Math.round((1-1/_)*b.y+m.sy/_));const I=this.imageDataGetter.getImageData(rt(this,wi,"f"),f,g,m,{pixelFormat:v,bufferContainer:S});if(!I)return null;const k=Date.now();return vi._onLog&&vi._onLog("getFrameData() END: "+k),{data:I.data,width:I.width,height:I.height,pixelFormat:I.pixelFormat,timeSpent:k-u,timeStamp:k,toCanvas:rt(this,QF,"f")}}on(l,u){if(!rt(this,ZF,"f").includes(l.toLowerCase()))throw new Error(`Event '${l}' does not exist.`);rt(this,Xs,"f").on(l,u)}off(l,u){rt(this,Xs,"f").off(l,u)}dispose(){var l=this;return Fe(function*(){l.tapFocusEventBoundEl=null,yield l.close(),l.releaseVideoEl(),rt(l,Xs,"f").dispose(),l.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",rt(l,aD,"f")),Ki(l,lD,!0,"f")})()}}function QPe(p,l){Xt(l)&&(p.config.maxFrameNumber=l)}function ZPe(p,l){Xt(l)&&(p.config.autoCaptureDelay=l)}function e6e(p,l){if(!Ds(l))return;const{context:u}=p.viewer;u.core.detectorService.enableDetect&&(p.config.enableAutoDetect=l,p.isVideoPlaying&&(p.viewer.hooks.autoDetectChanged.emit(aF.create(l)),l?p.loop.startLoop():p.config.enableAutoCapture?p.loop.cancelAnimation():p.loop.closeLoop()))}function t6e(p,l){Ds(l)&&(p.config.enableAutoCapture=l,p.isVideoPlaying&&(p.viewer.hooks.autoCaptureChanged.emit(sF.create(l)),l?p.loop.startLoop():p.config.enableAutoDetect||p.loop.closeLoop()))}function n6e(p,l){Xt(l)&&(p.config.acceptedPolygonConfidence=l)}function i6e(p,l){return!!p.videoEl&&(p.config.fullscreen=l,p.videoEl.style.objectFit=l?"cover":"contain",p.loop.updateVideoLayout(),!0)}wi=new WeakMap,sr=new WeakMap,iD=new WeakMap,rD=new WeakMap,Kr=new WeakMap,$u=new WeakMap,bp=new WeakMap,Cw=new WeakMap,oD=new WeakMap,Qh=new WeakMap,xp=new WeakMap,Zc=new WeakMap,X_=new WeakMap,$_=new WeakMap,bw=new WeakMap,sD=new WeakMap,q_=new WeakMap,Yv=new WeakMap,wp=new WeakMap,Sp=new WeakMap,QF=new WeakMap,Xs=new WeakMap,ZF=new WeakMap,Xv=new WeakMap,K_=new WeakMap,aD=new WeakMap,lD=new WeakMap,Fn=new WeakSet,Fte=function(){var p=Fe(function*(){var l=this;const u=this.getMediaStreamConstraints();if("boolean"==typeof u.video&&(u.video={}),!u.video.deviceId)if(rt(this,bp,"f"))delete u.video.facingMode,u.video.deviceId={exact:rt(this,bp,"f")};else if(this.ifSaveLastUsedCamera&&vi.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete u.video.facingMode,u.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const f=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),g=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));f&&g&&(u.video.width=f,u.video.height=g)}else if(!this.ifSkipCameraInspection){const f=function(){var v=Fe(function*(_){let b=null;return"environment"===_&&["Android","HarmonyOS","iPhone","iPad"].includes(Jo.OS)?(yield l._getCameras(!1),rt(l,Fn,"m",Kd).call(l),b=vi.findBestCamera(l._arrCameras,"environment",{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})):_||["Android","HarmonyOS","iPhone","iPad"].includes(Jo.OS)||(yield l._getCameras(!1),rt(l,Fn,"m",Kd).call(l),b=vi.findBestCamera(l._arrCameras,null,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})),b});return function(b){return v.apply(this,arguments)}}();let g=u.video.facingMode;g instanceof Array&&g.length&&(g=g[0]),"object"==typeof g&&(g=g.exact||g.ideal);const m=yield f(g);m&&(delete u.video.facingMode,u.video.deviceId={exact:m})}return u});return function(){return p.apply(this,arguments)}}(),Kd=function(){if(rt(this,Qh,"f")){const p=new Error("The operation was interrupted.");throw p.name="AbortError",p}},eL=function(){var p=Fe(function*(l){var f,g,u=this;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;try{vi._onLog&&vi._onLog("======try getUserMedia========");let v=[0,500],_=null;const b=function(){var S=Fe(function*(I){for(let k of v){k&&(yield new Promise(O=>setTimeout(O,k)),rt(u,Fn,"m",Kd).call(u));try{vi._onLog&&vi._onLog("ask "+JSON.stringify(I)),m=yield navigator.mediaDevices.getUserMedia(I),rt(u,Fn,"m",Kd).call(u);break}catch(O){if("NotFoundError"===O.name||"NotAllowedError"===O.name||"AbortError"===O.name||"OverconstrainedError"===O.name)throw O;_=O,vi._onLog&&vi._onLog(O.message||O)}}});return function(k){return S.apply(this,arguments)}}();if(yield b(l),m||(vi._onLog&&vi._onLog("======try getUserMedia again========"),vi._onLog&&vi._onLog(l),yield b(l)),m||(v=[1e3,2e3],yield b(l)),m||(yield b(l)),!m)throw _;return m}catch(v){throw null==m||m.getTracks().forEach(_=>{_.stop()}),"NotFoundError"===v.name&&(DOMException?v=new DOMException("No camera available, please use a device with an accessible camera.",v.name):(v=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),v}});return function(u){return p.apply(this,arguments)}}(),tL=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(p=>{p.stop()}),this._mediaStream=null),Ki(this,sr,null,"f")},J_=function(){var p=Fe(function*(){var l=this;Ki(this,Qh,!1,"f");const u=Ki(this,oD,Symbol(),"f");if(rt(this,xp,"f")&&"pending"===rt(this,Zc,"f")){try{yield rt(this,xp,"f")}catch(g){}rt(this,Fn,"m",Kd).call(this)}return u!==rt(this,oD,"f")?void 0:Ki(this,xp,Fe(function*(){Ki(l,Zc,"pending","f");try{if(l.videoSrc){if(!rt(l,wi,"f"))throw new Error("'videoEl' should be set.");yield vi.playVideo(rt(l,wi,"f"),l.videoSrc,l.cameraOpenTimeout),rt(l,Fn,"m",Kd).call(l)}else{let g=yield rt(l,Fn,"m",Fte).call(l);rt(l,Fn,"m",tL).call(l);let m=yield rt(l,Fn,"m",eL).call(l,g);yield l._getCameras(!1),rt(l,Fn,"m",Kd).call(l);const v=()=>{const I=m.getVideoTracks();let k,O;if(I.length&&(k=I[0]),k){const j=k.getSettings();if(j)for(let W of l._arrCameras)if(j.deviceId===W.deviceId){W._checked=!0,W.label=k.label,O=W;break}}return O},_=rt(l,Kr,"f");if("object"==typeof _.video){let I=_.video.facingMode;if(I instanceof Array&&I.length&&(I=I[0]),"object"==typeof I&&(I=I.exact||I.ideal),!(rt(l,bp,"f")||l.ifSaveLastUsedCamera&&vi.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||l.ifSkipCameraInspection||_.video.deviceId)){const k=v(),O=vi.findBestCamera(l._arrCameras,I,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault});O&&O!=(null==k?void 0:k.deviceId)&&(m.getTracks().forEach(j=>{j.stop()}),g.video.deviceId={exact:O},m=yield rt(l,Fn,"m",eL).call(l,g),rt(l,Fn,"m",Kd).call(l))}}const b=v();(null==b?void 0:b.deviceId)&&(Ki(l,bp,b&&b.deviceId,"f"),l.ifSaveLastUsedCamera&&vi.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",rt(l,bp,"f")),"object"==typeof g.video&&g.video.width&&g.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(g.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(g.video.height))))),rt(l,wi,"f")&&(yield vi.playVideo(rt(l,wi,"f"),m,l.cameraOpenTimeout),rt(l,Fn,"m",Kd).call(l)),l._mediaStream=m;const S=m.getVideoTracks();(null==S?void 0:S.length)&&Ki(l,sr,S[0],"f"),Ki(l,$u,b,"f")}}catch(g){throw rt(l,Fn,"m",cD).call(l),Ki(l,Zc,null,"f"),g}Ki(l,Zc,"fulfilled","f")})(),"f")});return function(){return p.apply(this,arguments)}}(),xw=function(){var p=Fe(function*(){var l;if("closed"===this.state||this.videoSrc)return;const u=null===(l=rt(this,$u,"f"))||void 0===l?void 0:l.deviceId,f=this.getResolution();yield rt(this,Fn,"m",J_).call(this);const g=this.getResolution();u&&u!==rt(this,$u,"f").deviceId&&rt(this,Xs,"f").fire("camera:changed",[rt(this,$u,"f").deviceId,u],{target:this,async:!0}),f.width==g.width&&f.height==g.height||rt(this,Xs,"f").fire("resolution:changed",[{width:g.width,height:g.height},{width:f.width,height:f.height}],{target:this,async:!0}),rt(this,Xs,"f").fire("played",null,{target:this,async:!0})});return function(){return p.apply(this,arguments)}}(),cD=function(){rt(this,Fn,"m",tL).call(this),Ki(this,$u,null,"f"),rt(this,wi,"f")&&(rt(this,wi,"f").srcObject=null,this.videoSrc&&(rt(this,wi,"f").pause(),rt(this,wi,"f").currentTime=0)),Ki(this,Qh,!0,"f");try{this.resetSoftwareScale()}catch(p){}},eu=function(){var p=Fe(function*(u,f){const g=K=>{if(!rt(this,sr,"f")||!this.isVideoPlaying||K.focusTaskId!=this._focusParameters.curFocusTaskId){rt(this,sr,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const Q=new Error(`Focus task ${K.focusTaskId} canceled.`);throw Q.name="DeprecatedTaskError",Q}1===this._focusParameters.isDoingFocus&&Date.now()-K.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let m;f=uc(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield rt(this,sr,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}),g(u),m=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/f),Math.abs(1/this._focusParameters.fds.max-1/f))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/f)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=f,yield new Promise(K=>{setTimeout(K,m)}),g(u);let v=u.focusL-u.focusW/2,_=u.focusT-u.focusH/2,b=u.focusW,S=u.focusH;const I=this.getResolution();if(v>=I.width||_>=I.height)throw new Error("Invalid area.");v+b>I.width&&(b=I.width-v),_+S>I.height&&(S=I.height-_),v=Math.round(v),_=Math.round(_),b=Math.round(b),S=Math.round(S);const k=4*I.width*I.height*this._focusParameters.defaultTempBufferContainerLenRatio,O=4*b*S;let j=this._focusParameters.tempBufferContainer;if(j){const K=j.length;k>K&&k>=O?j=new Uint8Array(k):O>K&&O>=k&&(j=new Uint8Array(O))}else j=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(k,O));if(!this.imageDataGetter.getImageData(rt(this,wi,"f"),I.width,I.height,{sx:v,sy:_,sWidth:b,sHeight:S,dWidth:b,dHeight:S},{pixelFormat:jr.RGBA,bufferContainer:j}))return rt(this,Fn,"m",l).call(this,u,f);const W=j;let J=0;for(let K=0,Q=O-8;K<Q;++K){let ie=W[K]-W[K+8];++K;let oe=W[K]-W[K+8];++K;let le=W[K]-W[K+8];++K,J+=ie*ie+oe*oe+le*le}return-J});function l(u,f){return p.apply(this,arguments)}return l}(),Q_=function(){var p=Fe(function*(u,f,g,m,v,_,b){let S;if(f=uc(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),m=uc(m,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),_?_=uc(_,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(_=uc(Math.sqrt((f||this._focusParameters.fds.step)*(m||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),b=yield rt(this,Fn,"m",eu).call(this,u,_)),b<=g&&b<=v?S=3:g<v&&g<b?S=1:v<g&&v<b&&(S=2),(m-f)/2<=this._focusParameters.fds.step)return 3===S||(1===S?yield rt(this,sr,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}):2===S&&(yield rt(this,sr,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:m}]}))),!0;if(1===S)return yield rt(this,Fn,"m",l).call(this,u,f,g,_,b);if(2===S)return yield rt(this,Fn,"m",l).call(this,u,_,b,m,v);if(3!==S)return g=yield rt(this,Fn,"m",eu).call(this,u,f),v=yield rt(this,Fn,"m",eu).call(this,u,m),yield rt(this,Fn,"m",l).call(this,u,f,g,m,v);let I=uc(Math.sqrt((f||this._focusParameters.fds.step)*(_||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),k=uc(Math.sqrt((m||this._focusParameters.fds.step)*(_||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/I)<=Math.abs(1/this._focusParameters.oldDistance-1/k)){let O=yield rt(this,Fn,"m",eu).call(this,u,I);if(O<b)return yield rt(this,Fn,"m",l).call(this,u,f,g,_,b,I,O);if(O==b)return yield rt(this,Fn,"m",l).call(this,u,I,O,_,b);let j=yield rt(this,Fn,"m",eu).call(this,u,k);if(O>b&&b<j)return yield rt(this,Fn,"m",l).call(this,u,I,O,k,j,_,b);if(b==j)return yield rt(this,Fn,"m",l).call(this,u,_,b,k,j);if(b>j)return yield rt(this,Fn,"m",l).call(this,u,_,b,m,v,k,j)}else{let O=yield rt(this,Fn,"m",eu).call(this,u,k);if(b>O)return yield rt(this,Fn,"m",l).call(this,u,_,b,m,v,k,O);if(b==O)return yield rt(this,Fn,"m",l).call(this,u,_,b,k,O);let j=yield rt(this,Fn,"m",eu).call(this,u,I);if(j>b&&b<O)return yield rt(this,Fn,"m",l).call(this,u,I,j,k,O,_,b);if(j==b)return yield rt(this,Fn,"m",l).call(this,u,I,j,_,b);if(j<b)return yield rt(this,Fn,"m",l).call(this,u,f,g,_,b,I,j)}return!1});function l(u,f,g,m,v,_,b){return p.apply(this,arguments)}return l}(),nL=function(){var p=Fe(function*(l,u,f,g,m){var _,v=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!l||"string"!=typeof l.x||"string"!=typeof l.y)throw new Error("Invalid 'centerPoint'.");if(!u||"string"!=typeof u)throw new Error("Invalid 'width'.");if(!f||"string"!=typeof f)throw new Error("Invalid 'height'.");const b=this.getResolution();let S=0,I=0;if(l.x.endsWith("px"))S=parseFloat(l.x);else{if(!l.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");S=parseFloat(l.x)/100*b.width}if(l.y.endsWith("px"))I=parseFloat(l.y);else{if(!l.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");I=parseFloat(l.y)/100*b.height}if(isNaN(S)||isNaN(I)||S<0||S>b.width||I<0||I>b.height)throw new Error("Invalid 'centerPoint'.");let k=0;if(u.endsWith("px"))k=parseFloat(u);else{if(!u.endsWith("%"))throw new Error("Invalid 'width'.");k=parseFloat(u)/100*b.width}if(isNaN(k)||k<0)throw new Error("Invalid 'width'.");let O=0;if(f.endsWith("px"))O=parseFloat(f);else{if(!f.endsWith("%"))throw new Error("Invalid 'height'.");O=parseFloat(f)/100*b.height}if(isNaN(O)||O<0)throw new Error("Invalid 'height'.");if(1!==rt(this,wp,"f")){const J=rt(this,wp,"f"),K=rt(this,Sp,"f");k/=J,O/=J,S=(1-1/J)*K.x+S/J,I=(1-1/J)*K.y+I/J}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(_=this.getCameraCapabilities())||void 0===_?void 0:_.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const j={focusL:S,focusT:I,focusW:k,focusH:O,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},W=function(){var J=Fe(function*(K,Q,ie){try{(null==Q||Q<v._focusParameters.fds.min)&&(Q=v._focusParameters.fds.min),(null==ie||ie>v._focusParameters.fds.max)&&(ie=v._focusParameters.fds.max),v._focusParameters.oldDistance=null;let oe=uc(Math.sqrt(ie*(Q||v._focusParameters.fds.step)),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),le=uc(Math.sqrt((Q||v._focusParameters.fds.step)*oe),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),he=uc(Math.sqrt(oe*ie),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),_e=yield rt(v,Fn,"m",eu).call(v,K,he),Ve=yield rt(v,Fn,"m",eu).call(v,K,le),ee=yield rt(v,Fn,"m",eu).call(v,K,oe);if(Ve>ee&&ee<_e){const ke=yield rt(v,Fn,"m",Q_).call(v,K,le,Ve,he,_e,oe,ee);return v._focusParameters.isDoingFocus=0,ke}if(Ve<ee&&Ve<_e){let ke=yield rt(v,Fn,"m",eu).call(v,K,Q);const xe=yield rt(v,Fn,"m",Q_).call(v,K,Q,ke,oe,ee,le,Ve);return v._focusParameters.isDoingFocus=0,xe}if(ee>_e&&Ve>_e){let ke=yield rt(v,Fn,"m",eu).call(v,K,ie);const xe=yield rt(v,Fn,"m",Q_).call(v,K,oe,ee,ie,ke,he,_e);return v._focusParameters.isDoingFocus=0,xe}if(Ve==ee&&ee<_e){const ke=yield rt(v,Fn,"m",Q_).call(v,K,le,Ve,oe,ee);return v._focusParameters.isDoingFocus=0,ke}if(ee==_e&&Ve>ee){const ke=yield rt(v,Fn,"m",Q_).call(v,K,oe,ee,he,_e);return v._focusParameters.isDoingFocus=0,ke}return W(K,Q,ie)}catch(oe){if("DeprecatedTaskError"!==oe.name)throw oe}});return function(Q,ie,oe){return J.apply(this,arguments)}}();return W(j,g,m)});return function(u,f,g,m,v){return p.apply(this,arguments)}}(),iL=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");if(!p||"string"!=typeof p.x||"string"!=typeof p.y)throw new Error("Invalid 'center'.");const l=this.getResolution();let u=0,f=0;if(p.x.endsWith("px"))u=parseFloat(p.x);else{if(!p.x.endsWith("%"))throw new Error("Invalid scale center.");u=parseFloat(p.x)/100*l.width}if(p.y.endsWith("px"))f=parseFloat(p.y);else{if(!p.y.endsWith("%"))throw new Error("Invalid scale center.");f=parseFloat(p.y)/100*l.height}if(isNaN(u)||isNaN(f))throw new Error("Invalid scale center.");Ki(this,Sp,{x:u,y:f},"f")},Lte=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();return p&&p.x==l.width/2&&p.y==l.height/2},vi.browserInfo=Jo,vi.onWarning=null===(JF=null==window?void 0:window.console)||void 0===JF?void 0:JF.warn;class r6e{constructor(l){N(this,"isLooping",!1),N(this,"lastDetectTime",(new Date).getTime()),N(this,"loopTimer",void 0),N(this,"autoCaptureStartTime",0),N(this,"lastRenderedQuad",void 0),N(this,"animation",void 0),N(this,"cameraContext",void 0),N(this,"videoLayout",void 0),this.cameraContext=l}getLoopState(){const{enableAutoCapture:l,enableAutoDetect:u}=this.cameraContext.config;return l||u}clearLoopTimer(){clearTimeout(this.loopTimer),this.loopTimer=null,this.isLooping=!1,this.autoCaptureStartTime=0,this.lastDetectTime=(new Date).getTime()}loopTimeout(){var l=this;if(!this.cameraContext.isVideoPlaying&&!this.getLoopState())return;const u=this.getDetectRemainTime();this.loopTimer=setTimeout(Fe(function*(){if(!l.getLoopState()||l.isLooping)return;l.isLooping=!0;const f=yield l.loopTaskDetail();l.isLooping=!1,f&&l.getLoopState()&&setTimeout(()=>{l.getLoopState()&&l.loopTimeout()},10)}),u)}loopTaskDetail(){var l=this;return Fe(function*(){if(!(l.cameraContext&&l.cameraContext.isVideoPlaying&&l.cameraContext.videoEl&&l.cameraContext.canvasEl&&l.getLoopState()))return!1;const{viewer:u}=l.cameraContext;if(l.lastDetectTime=(new Date).getTime(),!u.context.viewService.isBindContainer)return!0;if("hidden"===u.getViewerConfig().visibility)return!1;const{config:f}=l.cameraContext,{enableDetect:g}=u.context.core.detectorService,m=l.cameraContext.getFrameData();if(!m)return!1;const v={type:1,data:m.data.buffer,height:m.height,width:m.width};let _={success:!1};var b;g&&(_=yield l.getDetectResult(v),0===m.data.length&&(m.data=new Uint8Array(v.data)),f.enableAutoDetect&&l.cameraContext.isVideoPlaying&&_.success&&null!==(b=_)&&void 0!==b&&b.location?(l.lastRenderedQuad?l.createDetectAnimation(l.lastRenderedQuad,_.location):l.drawQuadrilateral(_.location),l.lastRenderedQuad=_.location):(l.clearCanvas(),l.lastRenderedQuad=null));let S=!1;var I;if(f.enableAutoCapture?((null===(I=_)||void 0===I?void 0:I.status)===Ba.AUTO_CAPTURE&&(S=!0),!g&&(l.autoCaptureStartTime<=0?l.autoCaptureStartTime=(new Date).getTime():(new Date).getTime()-l.autoCaptureStartTime>f.autoCaptureDelay&&(l.autoCaptureStartTime=0,S=!0))):l.autoCaptureStartTime=0,S){var k,O,j;if(null===(k=l.cameraContext.viewer)||void 0===k||!k.context)return!1;const W=yield l.cameraContext.viewer.context.core.processService.resize(m.data.buffer,1,m.width,m.height,-1);if(l.cameraContext.isCapturedPages=!0,null===(O=l.cameraContext.viewer)||void 0===O||!O.context)return!1;yield l.cameraContext.viewer.context.loadSource({extraPageData:[{index:0,perspectiveQuad:null===(j=_)||void 0===j?void 0:j.location}],fileData:W.data}),l.startCaptureAnimation(),yield Nte(),l.closeCaptureAnimation()}return!0})()}getDetectRemainTime(){const l=(new Date).getTime(),{maxFrameNumber:u}=this.cameraContext.config;return Math.max(0,1e3/u-(l-this.lastDetectTime))}startLoop(){this.loopTimer||(this.getLoopState()?this.loopTimeout():(this.clearLoopTimer(),this.clearCanvas()))}closeLoop(){if(!this.loopTimer)return;const{context:l}=this.cameraContext.viewer,{detectorService:u}=l.core;u.resetDetector(),this.clearLoopTimer(),this.clearCanvas(),cancelAnimationFrame(this.animation)}updateVideoLayout(){const{videoEl:l,config:u}=this.cameraContext,{fullscreen:f}=u,{videoWidth:g,videoHeight:m}=l,{width:v,height:_}=l.getBoundingClientRect(),b={zoom:1,left:0,top:0};if(f){const S=Math.max(v/g,_/m);b.zoom=S}else{const S=Math.min(v/g,_/m),I=(v-g*S)/2,k=(_-m*S)/2;b.zoom=S,b.left=I,b.top=k}this.videoLayout=b}getDetectResult(l){var u=this;return Fe(function*(){const{cameraContext:f}=u,{context:g}=f.viewer,{detectorService:m}=g.core;if(!m.enableDetect)return Promise.resolve({success:!1});let v=l;if(!l){const O=f.getFrameData();v={type:1,data:O.data.buffer,height:O.height,width:O.width}}const{acceptedPolygonConfidence:_,enableAutoCapture:b,autoCaptureDelay:S}=f.config,I={acceptedPolygonConfidence:_,enableAutoCapture:b,autoCaptureDelay:S};return(yield m.detect(v,I))||Promise.resolve({success:!1})})()}drawQuadrilateral(l){if(!this.loopTimer)return;const{canvasEl:u,viewer:f}=this.cameraContext,{zoom:g,left:m,top:v}=this.videoLayout,_=u.getContext("2d");_.save(),_.clearRect(0,0,u.width,u.height),_.translate(m,v),_.scale(g,g),_.beginPath(),_.moveTo(l[0][0],l[0][1]);for(let K=1;K<l.length;K++)_.lineTo(l[K][0],l[K][1]);_.closePath();const{quadSelectionStyle:b}=f.getViewerConfig(),{border:S,background:I}=b,{borderWidth:k,borderColor:O,borderStyle:j}=Fx(S);let W=ni(k).value/g;0===W&&(W=1);const J="solid"===j?[0,0]:[5*W,2*W];_.strokeStyle=O,_.fillStyle=I,_.lineCap="round",_.lineWidth=W,_.setLineDash(J),_.fill(),_.stroke(),_.restore()}clearCanvas(){const{canvasEl:l}=this.cameraContext;!l||l.getContext("2d").clearRect(0,0,l.width,l.height)}cancelAnimation(){this.clearCanvas(),cancelAnimationFrame(this.animation)}createDetectAnimation(l,u){let f=0;const g=()=>{this.clearCanvas();const m=l.map((v,_)=>{const b=u[_];return[v[0]+(b[0]-v[0])*f,v[1]+(b[1]-v[1])*f]});this.drawQuadrilateral(m),f<1&&(f+=.2,this.animation=requestAnimationFrame(g))};g()}startCaptureAnimation(){var l,u;this.cameraContext&&null!==(l=this.cameraContext)&&void 0!==l&&l.videoEl&&null!==(u=this.cameraContext)&&void 0!==u&&u.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(0%)",this.cameraContext.canvasEl.style.visibility="hidden")}closeCaptureAnimation(){var l,u;this.cameraContext&&null!==(l=this.cameraContext)&&void 0!==l&&l.videoEl&&null!==(u=this.cameraContext)&&void 0!==u&&u.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(100%)",this.cameraContext.canvasEl.style.visibility="")}}function Nte(){return new Promise(p=>{setTimeout(()=>{p("")},50)})}const o6e={tag:"div",id:"ddv-camera-container",className:"ddv-camera-container",children:[{tag:"video",id:"ddv-camera-video",class:"ddv-camera-camera"},{tag:"canvas",id:"ddv-camera-canvas",class:"ddv-camera-canvas"}]},uD={enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:65,fullscreen:!1,autoCaptureDelay:1e3};class s6e{constructor(l){var u;if(N(this,"camera",void 0),N(this,"configHandler",{}),N(this,"isHttps",!0),N(this,"lastDeviceId",void 0),N(this,"userDeviceId",void 0),N(this,"isFirstPlayed",!0),N(this,"isTurningTorch",!1),N(this,"initializing",!1),N(this,"cameraContainer",void 0),N(this,"viewer",void 0),N(this,"loop",void 0),N(this,"videoEl",void 0),N(this,"canvasEl",void 0),N(this,"config",hn(uD)),N(this,"bUser",!1),N(this,"canFrontCamera",!1),N(this,"isCapturedPages",!1),N(this,"lastEnvironmentCameraId",void 0),N(this,"cameraList",[]),N(this,"turnOnTheTorch",!1),N(this,"torchSupported",!1),this.viewer=l,this.camera=new vi,this.loop=new r6e(this),this.initConfigHandler(),null!==(u=navigator)&&void 0!==u&&null!==(u=u.mediaDevices)&&void 0!==u&&u.getUserMedia||(this.isHttps=!1),this.isCaptureViewer&&this.isHttps){this.initializing=!0;const f=this.getCameras().then(m=>{this.cameraList=m}),g=this.getFrontCamera().then(m=>{this.canFrontCamera=m,this.viewer.hooks.cameraInit.emit(k2.create(m))}).catch(m=>{});Promise.all([f,g]).finally(()=>{this.initializing=!1})}this.camera.setResolution(1280,720),this.bindCameraEvents(),this.initHooks(),this.handleViewerModeChanged(),this.bindNativeEvents()}initHooks(){this.bindViewerHooks(),this.bindGlobalHooks()}handleViewerModeChanged(){const{defaultDom:l,mainAndThbContainer:u}=this.viewer.context.viewService;if(this.isCaptureViewer){if(!this.cameraContainer){const f=$g(o6e,this.viewer.postfix);this.cameraContainer=f,Object.assign(f.style,this.viewer.context.viewerConfig.canvasStyle),l.appendChild(f);const g=f.getElementsByTagName("video")[0],m=f.getElementsByTagName("canvas")[0];g.setAttribute("playsinline","true"),g.setAttribute("muted","true"),g.setAttribute("disablePictureInPicture","true"),g.setAttribute("autoplay","autoplay"),g.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),g.style.transition="opacity 300ms, filter 100ms ease",this.bindCameraVideo(g),this.bindCameraCanvas(m),this.updateCameraConfig(uD)}AF(this.cameraContainer,"flex"),JZ(u)}else JZ(this.cameraContainer),AF(u,"flex")}initConfigHandler(){this.configHandler={maxFrameNumber:QPe,enableAutoCapture:t6e,enableAutoDetect:e6e,acceptedPolygonConfidence:n6e,fullscreen:i6e,autoCaptureDelay:ZPe}}bindViewerHooks(){this.viewer.hooks.viewerModeChanged.on(()=>{this.isCaptureViewer&&this.getFrontCamera().then(l=>{this.canFrontCamera=l,this.viewer.hooks.cameraInit.emit(k2.create(l))}),this.handleViewerModeChanged()}),this.viewer.hooks.visibleChanged.on(l=>{this.loop.closeLoop(),"visible"===l.newVisibility&&this.loop.startLoop()})}bindGlobalHooks(){this.viewer.context.core.documentService.onAddPagesToDoc.on(l=>{if(!this.isCapturedPages)return;const u=O5.create(l.pageUids[0]);this.viewer.emit("captured",u),this.isCapturedPages=!1},this.viewer)}bindCameraEvents(){const{camera:l}=this;l.on("paused",()=>{this.loop.closeLoop()}),l.on("resumed",()=>{this.loop.closeLoop(),this.loop.startLoop()}),l.on("before:open",()=>{this.videoEl&&(this.videoEl.style.opacity="0")}),l.on("before:resolution:change",()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop()}),l.on("before:camera:change",()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop(),this.lastDeviceId=this.camera.getCamera().deviceId}),l.on("camera:changed",()=>{const u=M5.create(this.lastDeviceId,this.camera.getCamera().deviceId);this.viewer.emit("cameraChanged",u)}),l.on("played",()=>{if(!this.videoEl||!this.isVideoPlaying)return;this.videoEl.style.opacity="1";const{enableTorch:u}=this.config,f=this.camera.getResolution();let g="unsupported";try{const m=this.camera.getCameraCapabilities();g=null!=m&&m.torch?"supported":"unsupported"}catch(m){}this.torchSupported="supported"===g,this.emitTorchChanged(g),"supported"===g&&u&&this.turnOnTorch().catch(()=>{this.config.enableTorch=!0}),this.viewer.hooks.cameraPlayed.emit(cF.create(f)),this.loop.updateVideoLayout(),this.loop.closeLoop(),this.loop.startLoop()}),l.on("closed",()=>{this.isVideoPlaying||(this.loop.closeLoop(),this.viewer.hooks.cameraClosed.emit(),this.emitTorchChanged("unsupported"))})}emitTorchChanged(l){this.viewer.hooks.torchChanged.emit(lF.create(l))}getVPointerEvent(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=0,m=0,v=0,_=0;if(u){const{left:b,top:S}=u.getBoundingClientRect();v=b,_=S}return l instanceof PointerEvent||l instanceof MouseEvent?(g=l.offsetX,m=l.offsetY):f?(g=l.changedTouches[0].clientX-v,m=l.changedTouches[0].clientY-_):(g=l.touches[0].clientX-v,m=l.touches[0].clientY-_),R2.create(-1,"",-1,-1,Math.floor(g),Math.floor(m),l)}triggerPlayed(l){const u=H5.create(this.camera.getCamera().deviceId,l);this.viewer.emit("played",u)}bindNativeEvents(){const l=this.canvasEl;if(!l)return;const u=_=>{const b=this.getVPointerEvent(_);this.viewer.emit("click",b)},f=_=>{this.viewer.emit("dblclick",this.getVPointerEvent(_))},g=_=>{_.preventDefault();const b=this.getVPointerEvent(_);this.viewer.emit("rightclick",b)},m=()=>{setTimeout(()=>{this.resize()},500)},v=()=>{this.isVideoPlaying&&(this.loop.closeLoop(),"visible"===document.visibilityState&&this.loop.startLoop())};l.addEventListener("click",u),l.addEventListener("dblclick",f),l.addEventListener("contextmenu",g),document.addEventListener("visibilitychange",v),window.addEventListener("orientationchange",m),this.viewer.hooks.destroy.on(()=>{l.removeEventListener("click",u),l.removeEventListener("dblclick",f),l.removeEventListener("contextmenu",g),document.removeEventListener("visibilitychange",v),window.removeEventListener("orientationchange",m)})}get isCaptureViewer(){return this.viewer.context.viewerConfig.viewerMode===qo.CAPTURE}get isVideoPlaying(){return!!this.camera&&this.camera.isVideoPlaying}getFrontCamera(){var l=this;return Fe(function*(){if(!l.isHttps)return it.reject(it.CAMERA_NEED_HTTPS);const u=yield vi.testCameraAccess({video:{facingMode:{exact:"user"}}});return Promise.resolve(u.ok)})()}convertCamera(){if(!this.canFrontCamera)return Promise.reject();if("opening"===this.camera.state)return Promise.resolve();if(!this.bUser){const l=this.getCamera().deviceId;return this.camera.switchToFrontCamera().then(()=>(this.bUser=!0,this.lastEnvironmentCameraId=l,this.torchSupported&&this.emitTorchChanged("unsupported"),Promise.resolve()))}return this.setCamera(this.lastEnvironmentCameraId).then(()=>(this.bUser=!1,this.torchSupported&&this.emitTorchChanged("supported"),Promise.resolve()))}getFrameData(){if(!this.config.fullscreen)return this.camera.getFrameData();const{width:l,height:u}=this.videoEl.getBoundingClientRect(),f=this.videoEl.videoWidth,g=this.videoEl.videoHeight,m=Math.max(l/f,u/g),v=l/(f*m),_=u/(g*m),b=Math.floor((1-v)/2*f),S=Math.floor((1-_)/2*g),I=Math.floor(f*v),k=Math.floor(g*_);return this.camera.getFrameData({position:{sx:b,sy:S,sWidth:I,sHeight:k,dWidth:I,dHeight:k}})}updateCameraConfig(l){for(const[u,f]of Object.entries(l)){const g=this.configHandler[u];g&&!pt(f)&&g(this,f)}}bindCameraVideo(l){l instanceof HTMLVideoElement&&(this.camera.setVideoEl(l),this.videoEl=l)}bindCameraCanvas(l){l instanceof HTMLCanvasElement&&(this.canvasEl=l)}capture(){var l=this;return Fe(function*(){l.loop.startCaptureAnimation(),yield Nte(),l.loop.closeCaptureAnimation(),it.verbose(`[${Date.now()}][cv] start capture`);const u=l.getFrameData();if(it.verbose(`[${Date.now()}][cv] get frame done`),!u)return null;const f={type:1,data:u.data.buffer,width:u.width,height:u.height},g=yield l.loop.getDetectResult(f);it.verbose(`[${Date.now()}][cv] get detect result done`),0===u.data.length&&(u.data=new Uint8Array(f.data));const m=yield l.viewer.context.core.processService.resize(u.data.buffer,1,u.width,u.height,-1);return it.verbose(`[${Date.now()}][cv] create image done`),l.isCapturedPages=!0,yield l.viewer.context.loadSource({fileData:m.data,extraPageData:[{index:0,perspectiveQuad:g.success?g.location:void 0}]}),it.verbose(`[${Date.now()}][cv] capture done`),m.data})()}play(l){var u=this;return Fe(function*(){if(!u.isHttps)return Promise.reject(it.CAMERA_NEED_HTTPS);if(!l&&u.isVideoPlaying)return Promise.resolve();const{fill:f,resolution:g}=l||{},m=u.camera.getResolution();if(Ds(f)&&u.updateCameraConfig({fullscreen:f}),u.isVideoPlaying&&Bte(g)&&g[0]===m.width&&g[1]===m.height)return Promise.resolve();let v=[m.width,m.height];if(Bte(g)){if(u.isVideoPlaying)return u.camera.setResolution(g[0],g[1]).then(_=>(u.resize(),u.triggerPlayed(g),Promise.resolve())).catch();u.camera.setResolution(g[0],g[1]),v=g}return!u.isFirstPlayed||u.isVideoPlaying||g||"opening"===u.camera.state||(u.camera.setResolution(1280,720),v=[1280,720]),u.initializing&&(yield new Promise(_=>{const b=setInterval(()=>{u.initializing||(clearInterval(b),_(""))},100)})),u.isFirstPlayed&&(u.isFirstPlayed=!1),u.camera.open().then(Fe(function*(){return u.resize(),u.triggerPlayed(v),Promise.resolve()})).catch(_=>{let b=it.CAMERA_OCCUPIED;return"Permission denied"===_.message&&(b=it.CAMERA_DENIED),8===_.code&&(b=it.CAMERA_NO_CAMERA),Promise.reject(b)})})()}stop(){var l;this.loop.closeLoop(),this.viewer.emit("stopped",Y5.create(this.getCamera().deviceId)),null===(l=this.camera)||void 0===l||l.close()}setCamera(l){var u=this;return Fe(function*(){let f="";Un(l)?f=l.deviceId||"":xn(l)&&(f=l);let g=!1;for(let _=0;_<u.cameraList.length;_++)u.cameraList[_].deviceId===f&&(g=!0);if(!g)return Promise.reject(it.CAMERA_NOT_EXIST);yield u.camera.setCamera(f).catch(_=>{let b=it.CAMERA_OCCUPIED;"Permission denied"===_.message&&(b=it.CAMERA_DENIED),8===_.code&&(b=it.CAMERA_NO_CAMERA),Promise.reject(b)});const m=u.camera.getResolution(),v={deviceId:f,width:m.width,height:m.height};return u.isVideoPlaying&&u.triggerPlayed([m.width,m.height]),Promise.resolve(v)})()}getCamera(){const l=this.camera.getCamera();return{deviceId:l.deviceId,label:l.label}}getCameras(){var l=this;return Fe(function*(){const u=(yield l.camera.getAllCameras()).map(f=>({deviceId:f.deviceId,label:f.label}));return Promise.resolve(u)})()}setResolution(l,u){var f=this;return Fe(function*(){const g=f.camera.getCamera();if(!g||""===g.deviceId)return Promise.reject(it.CAMERA_NOT_EXIST);let m;if(Xt(l))m=l;else if(Di(l)){const[_,b]=l;m=_,u=b}let v=f.camera.getResolution();return Xt(m)&&Xt(u)&&(f.loop.closeLoop(),v=yield f.camera.setResolution(m,u).catch(_=>{})),f.camera&&f.isVideoPlaying&&f.triggerPlayed([v.width,v.height]),Promise.resolve(qe({deviceId:g.deviceId},v))})()}getResolution(){const l=this.camera.getCamera();if(!l||""===l.deviceId)return[0,0];const u=this.camera.getResolution();return[u.width,u.height]}getResolutions(){var l=this;return Fe(function*(){const u=(yield l.camera.getResolutions()).map(f=>[f.width,f.height]);return Promise.resolve(u)})()}turnOnTorch(){const l=this.camera.getCamera();return l&&""!==l.deviceId?this.isTurningTorch?Promise.resolve():(this.isTurningTorch=!0,this.camera.turnOnTorch().then(()=>(this.isTurningTorch=!1,this.turnOnTheTorch=!0,this.config.enableTorch=!0,this.emitTorchChanged("on"),Promise.resolve())).catch(u=>(this.isTurningTorch=!1,this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),it.reject(it.CAMERA_NOT_SUPPORT_TORCH)))):Promise.reject(it.CAMERA_NO_VIDEO)}turnOffTorch(){const l=this.camera.getCamera();return l&&""!==l.deviceId?this.camera.turnOffTorch().then(()=>(this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),Promise.resolve())).catch(u=>it.reject(it.CAMERA_NOT_SUPPORT_TORCH)):Promise.reject(it.CAMERA_NO_VIDEO)}resize(){const{canvasEl:l}=this,{width:u,height:f}=l.getBoundingClientRect();l.width=Math.floor(u),l.height=Math.floor(f),this.loop.updateVideoLayout()}dispose(){var l,u;this.stop(),null===(l=this.loop)||void 0===l||l.closeLoop(),null===(u=this.camera)||void 0===u||u.dispose(),this.camera=null,this.loop=null,this.videoEl=null,this.canvasEl=null}}function Bte(p){return!!(Di(p)&&Xt(p[0])&&Xt(p[1]))}const a6e={install(p){const l=p.getClass("Viewer"),u=(f=l,class extends f{constructor(g){if(super(g),N(this,"cameraContext",void 0),this.context.viewerConfig.viewerMode===qo.CAPTURE){this.cameraContext=new s6e(this);const m=uD;Un(g.viewerConfig)&&["enableTorch","enableAutoCapture","enableAutoDetect","acceptedPolygonConfidence","maxFrameNumber","autoCaptureDelay"].forEach(v=>{v in g.viewerConfig&&(m[v]=g.viewerConfig[v])}),this.cameraContext.config=Ht(qe({},m),{defaultCameraConfig:uD}),this.on("resized",()=>{this.cameraContext.resize()})}}isVideoPlaying(){return this.cameraContext.isVideoPlaying}convertCamera(){return this.cameraContext.convertCamera()}getCameraConfig(){return hn(this.cameraContext.config)}updateCameraConfig(g){Un(g)&&this.cameraContext.updateCameraConfig(g)}capture(){return this.cameraContext.capture()}play(g){return this.cameraContext.play(g)}stop(){this.isVideoPlaying()?this.cameraContext.stop():it.warning(it.CAMERA_NO_VIDEO)}getCurrentCamera(){return this.cameraContext.getCamera()}getAllCameras(){return this.cameraContext.getCameras()}selectCamera(g){return this.cameraContext.setCamera(g)}getCurrentResolution(){return this.cameraContext.getResolution()}getResolutions(){return this.cameraContext.getResolutions()}setResolution(g,m){return this.cameraContext.setResolution(g,m)}turnOnTorch(){return this.cameraContext.turnOnTorch()}turnOffTorch(){return this.cameraContext.turnOffTorch()}dispose(){var g;this.cameraContext&&(null===(g=this.cameraContext)||void 0===g||g.dispose()),this.cameraContext=null,super.dispose()}});var f;p.setClass("Viewer",u)}};class l6e{constructor(l){N(this,"uid",void 0),N(this,"areaUid",void 0),N(this,"isRect",!0),N(this,"vertexes",[]),N(this,"midpoints",[]),N(this,"points",[]),N(this,"keepAspectRatio",!1),N(this,"isConvex",!0),N(this,"renderer",void 0),N(this,"area",void 0),N(this,"slopeRatio",[]),N(this,"selectedPart",-1),N(this,"startX",null),N(this,"startY",null),N(this,"lastX",null),N(this,"lastY",null),N(this,"lastAspectRatio",1),N(this,"b1",void 0),N(this,"b2",void 0),N(this,"k1",void 0),N(this,"k2",void 0),this.uid=Ai(),Object.assign(this,l),this.initBox(l.vertexes)}initBox(l){this.vertexes=l,this.midpoints=rL(this.vertexes),this.points=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=FE(this.vertexes)}getRect(){if(!this.isRect)return null;const{minX:l,maxX:u,minY:f,maxY:g}=this.getBounds();return{left:l,top:f,width:u-l||1,height:g-f||1}}getQuad(){if(this.isRect)return null;const{points:l}=this,u=[];for(let f=0;f<4;f++)u.push([l[2*f],l[2*f+1]]);return u}getActivePartNum(l,u,f){const g=this.getSelectedCtrlPointNum(l,u,f);return g>-1?g:this.isPointOnBox(l,u)?8:-1}getSelectedCtrlPointNum(l,u,f){const{points:g}=this,{width:m,height:v,zoom:_}=this.area,{ctrlWidth:b,ctrlHeight:S,ctrlRadiusMultipleMobile:I}=this.renderer.config.boxStyle;let k=S/2/_,O=b/2/_;f&&(O*=I,k*=I);const j=Sr(O,0,3*O),W=Sr(k,0,3*k);for(let J=0;J<8;J++){const K=g[2*J],Q=g[2*J+1];if(l<=K+j&&l>=K-j&&u<=Q+W&&u>=Q-W&&l>=0-j&&l<=m+j&&u>=0-W&&u<=v+W&&(J<4&&this.renderer.config.enableEditCropBoxVertices||this.renderer.config.enableEditCropBoxMidpoints))return J}return-1}checkOrientation(l){if(l<0||l>7)return null;const{minX:u,maxX:f,minY:g,maxY:m}=this.getBounds(),{points:v}=this,_=v[2*l],b=v[2*l+1];let S="",I="";return _===f?S="e":_===u&&(S="w"),b===m?I="s":b===g&&(I="n"),l<4?I+S:I||S}onStartHandler(l,u,f,g){var m;if(null!==(m=f)&&void 0!==m||(f=this.getActivePartNum(l,u,g)),!(f<0)&&(this.startX=l,this.startY=u,this.lastX=l,this.lastY=u,this.selectedPart=f,!this.isRect&&f>3&&f<8)){const{points:v,slopeRatio:_}=this,b=f-4;this.k1=_[(b+1)%4],this.b1=v[(2*b+3)%8]-this.k1*v[(2*b+2)%8],this.k2=_[(b+3)%4],this.b2=v[(2*b+1)%8]-this.k2*v[(2*b+0)%8]}}onMoveHandler(l,u,f){const{selectedPart:g}=this;if(g<0)return;const m=l-this.lastX,v=u-this.lastY;if(0===m&&0===v)return;const{points:_}=this;let b=_.slice();var S;g<8?(null!==(S=f)&&void 0!==S||(f=g),this.isRect?b=this.moveRectPoint(b,f,l,u):(b=this.moveQuadPoint(b,f,l,u),this.slopeRatio=FE(_).slice(0,4),this.isConvex=LE(b))):8===g&&(b=this.moveBox(b,m,v));const I=rL(b);this.points=b.slice(0,8).concat(I),this.midpoints=I,this.lastX=l,this.lastY=u}onEndHandler(){const{startX:l,startY:u,vertexes:f,midpoints:g,lastX:m,lastY:v,selectedPart:_}=this;if(_<0)return;this.startX=0,this.startY=0,this.selectedPart=-1;let b=this.points.slice();const S=LE(b);(l===m&&u===v||!S)&&(b=f.slice().concat(g)),this.isConvex=!0,this.vertexes=b.slice(0,8),this.midpoints=rL(b),this.points=b.slice(0,8).concat(this.midpoints),this.slopeRatio=FE(b).slice(0,4)}getBounds(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.points;return{minX:Math.min(l[0],l[2],l[4],l[6]),maxX:Math.max(l[0],l[2],l[4],l[6]),minY:Math.min(l[1],l[3],l[5],l[7]),maxY:Math.max(l[1],l[3],l[5],l[7])}}moveRectPoint(l,u,f,g){let m=0,v=0;const{enableEditCropBoxMidpoints:_,enableEditCropBoxVertices:b}=this.renderer.config;if(this.keepAspectRatio){const{minX:S,maxX:I,minY:k,maxY:O}=this.getBounds(),j=this.checkOrientation(u);let W=(I-S)/(O-k);0===W||W===1/0||W===-1/0||Number.isNaN(W)?W=this.lastAspectRatio:this.lastAspectRatio=W,m=0,v=0;let J="w",K=!1;if(u<4){if(b){if(K=!0,m=f-l[2*u],v=g-l[2*u+1],0===m||0===v)return l;J="w"}}else{const Q=u-4;if(_){K=!0;const ie={e:[(Q+1)%4,"w"],s:[Q,"h"],w:[Q,"w"],n:[(Q+1)%4,"h"]};if(["e","s","w","n"].includes(j)&&([u,J]=ie[j]),m=f-l[2*Q],v=g-l[2*Q+1],0===m||0===v)return l}}if(K){const Q=["ne","sw","n","w"];"h"===J?(m=v*W,Q.includes(j)&&(m=-m)):(v=m/W,Q.includes(j)&&(v=-v));const ie=l[2*u]+m,oe=l[2*u+1]+v,{width:le,height:he}=this.area;ie<0?(m=0-l[2*u],v=0):ie>le?(m=le-l[2*u],v=0):oe<0?(v=0-l[2*u+1],m=0):oe>he&&(v=he-l[2*u+1],m=0),l[2*u]+=m,l[2*u+1]+=v;const _e=(u+1)%4,Ve=(u+3)%4;u%2?(l[2*_e]+=m,l[2*Ve+1]+=v):(l[2*_e+1]+=v,l[2*Ve]+=m)}}else if(u<4){if(b){if(m=f-l[2*u],v=g-l[2*u+1],0===m&&0===v)return l;l[2*u]=f,l[2*u+1]=g;const S=(u+1)%4,I=(u+3)%4;u%2?(l[2*S]=f,l[2*I+1]=g):(l[2*S+1]=g,l[2*I]=f)}}else{const S=u-4;if(_){const I=this.slopeRatio[S%4];0===I?(l[(2*S+3)%8]=g,l[(2*S+1)%8]=g):I!==1/0&&I!==-1/0||(l[(2*S+2)%8]=f,l[(2*S+0)%8]=f)}}return l}moveQuadPoint(l,u,f,g){const m=l.slice();if(u<4){const _=g-l[2*u+1];if(0==f-l[2*u]&&0===_)return l;l[2*u]=f,l[2*u+1]=g}else{const v=u-4,_=this.slopeRatio[v%4],b=g-_*f,S=-b/_,I=b,k=l[(2*v+9)%8]-_*l[(2*v+8)%8],O=-k/_,{k1:j,b1:W,k2:J,b2:K}=this;0===_?(l[(2*v+3)%8]=g,j!==1/0&&j!==-1/0&&(l[(2*v+2)%8]=(g-W)/j),l[(2*v+1)%8]=g,J!==1/0&&J!==-1/0&&(l[(2*v+0)%8]=(g-K)/J)):_===1/0||_===-1/0?(l[(2*v+2)%8]=f,l[(2*v+3)%8]=j*f+W,l[(2*v+0)%8]=f,l[(2*v+1)%8]=J*f+K):(0===j?l[(2*v+2)%8]+=S-O:j===1/0||j===-1/0?l[(2*v+3)%8]+=I-k:(l[(2*v+2)%8]=(W-b)/(_-j),l[(2*v+3)%8]=(_*W-j*b)/(_-j)),0===J?l[(2*v+0)%8]+=S-O:J===1/0||J===-1/0?l[(2*v+1)%8]+=I-k:(l[(2*v+0)%8]=(K-b)/(_-J),l[(2*v+1)%8]=(_*K-J*b)/(_-J)));for(let Q=0;Q<4;Q++){const ie=l[2*Q],oe=l[2*Q+1];if(ie<0||ie>this.area.width||oe<0||oe>this.area.height)return m}}return l}moveBox(l,u,f){const{minX:g,maxX:m,minY:v,maxY:_}=this.getBounds(l);u=Sr(u,-g,this.area.width-m),f=Sr(f,-v,this.area.height-_);for(let b=0;b<4;b++)l[2*b]+=u,l[2*b+1]+=f;return l}isPointOnBox(l,u){if(this.isRect){const{minX:v,maxX:_,minY:b,maxY:S}=this.getBounds();return l>=v&&l<=_&&u>=b&&u<=S}const f=[...this.vertexes],g=[...this.midpoints],m=[];for(let v=0;v<4;v++)m.push([f[2*v],f[2*v+1]]),m.push([g[2*v],g[2*v+1]]);return function(v,_){let b,S,I,k,O=0;const j=_.length;for([I]=_,b=1;b<=j;b++)k=_[b%j],v[0]>Math.min(I[0],k[0])&&v[0]<=Math.max(I[0],k[0])&&v[1]<=Math.max(I[1],k[1])&&I[0]!==k[0]&&(S=(v[0]-I[0])*(k[1]-I[1])/(k[0]-I[0])+I[1],(I[1]===k[1]||v[1]<=S)&&(O+=1)),I=k;return O%2!=0}([l,u],m)}}function rL(p){const l=p.slice(0,8).concat(p[0],p[1]),u=[];for(let f=0;f<4;f++)u.push((l[2*f]+l[2*(f+1)])/2,(l[2*f+1]+l[2*(f+1)+1])/2);return u}class c6e{constructor(l,u,f){N(this,"areaUid",void 0),N(this,"left",void 0),N(this,"top",void 0),N(this,"width",void 0),N(this,"height",void 0),N(this,"boxes",void 0),N(this,"isVisible",!0),N(this,"zoom",1),N(this,"oldRect",void 0),N(this,"oldQuad",void 0),N(this,"isModified",!1),N(this,"isDrawNewBox",!1),N(this,"activeBoxUid",void 0),N(this,"activePartNum",-1),N(this,"startX",void 0),N(this,"startY",void 0),N(this,"isMouseDown",!1),N(this,"isDrawing",!1),N(this,"renderer",void 0),this.renderer=l,this.areaUid=u,this.boxes=[],this.updateAreaRect(f)}hasActiveBox(){return!!this.activeBoxUid}getFullVertexes(){return[0,0,this.width,0,this.width,this.height,0,this.height]}isContainRect(l){return l.left>=0&&l.left<=this.width&&l.left+l.width<=this.width&&l.top>=0&&l.top<=this.height&&l.top+l.height<=this.height}isContainBox(l){const u=l.getRect();return this.isContainRect(u)}isFullBox(l){const{vertexes:u}=l;return 0===u[0]&&0===u[1]&&u[2].toFixed(2)===this.width.toFixed(2)&&0===u[3]&&u[4].toFixed(2)===this.width.toFixed(2)&&u[5].toFixed(2)===this.height.toFixed(2)&&0===u[6]&&u[7].toFixed(2)===this.height.toFixed(2)}addRectBox(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return l=this.handleBoundary(l),this.addBox(l,!0,u)}updateRectBox(l,u){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=l.getRect(),m=l.getQuad();if(u=this.handleBoundary(u),l.initBox(u),f){const v={box:l};l.isRect?(v.oldRect=g,v.newRect=l.getRect()):(v.oldQuad=m,v.newQuad=l.getQuad()),this.renderer.hooks.boxModified.emit(v)}}handleBoundary(l){l=[...l];for(let u=0;u<4;u++){const f=[l[2*u],l[2*u+1]];f[0]=Sr(f[0],0,this.width),f[1]=Sr(f[1],0,this.height),[l[2*u],l[2*u+1]]=f}return l}addQuadBox(l){return this.addBox(l,!1)}addBox(l){let u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const f=new l6e({isRect:!(arguments.length>1&&void 0!==arguments[1])||arguments[1],area:this,renderer:this.renderer,vertexes:[...l],keepAspectRatio:this.renderer.config.keepAspectRatio});return this.boxes.push(f),u&&this.renderer.hooks.boxCreated.emit(f),f}getBoxRects(){return this.boxes.map((l,u)=>qe({index:u},l.getRect()))}getBoxByUid(l){return this.boxes.find(u=>u.uid===l)}deleteBoxByUid(l){const u=this.boxes.findIndex(f=>f.uid===l);u>-1&&this.boxes.splice(u,1)}clearBoxes(){this.boxes.length=0}updateAreaRect(l){this.left=l.left,this.top=l.top,this.width=l.width,this.height=l.height}setKeepAspectRatio(l){this.isDrawing||this.boxes.forEach(u=>{u.keepAspectRatio=l})}isTouchedPoint(l,u,f){return l=Sr(l,0,this.width),u=Sr(u,0,this.height),this.boxes.some(g=>{const m=g.getActivePartNum(l,u,f);return m>-1&&m<8})}isTouchedBox(l,u,f){return l=Sr(l,0,this.width),u=Sr(u,0,this.height),this.boxes.some(g=>g.getActivePartNum(l,u,f)>-1)}onStartHandler(l,u,f){this.isMouseDown=!0,l=Sr(l,0,this.width),u=Sr(u,0,this.height),this.startX=l,this.startY=u;const g=this.boxes.find(m=>{const v=m.getActivePartNum(l,u,f);return v>-1&&(this.activePartNum=v),v>-1});g&&(this.oldRect=g.getRect(),this.oldQuad=g.getQuad(),this.activeBoxUid=g.uid,g.keepAspectRatio=this.renderer.config.keepAspectRatio,g.onStartHandler(l,u,void 0,f))}onMoveHandler(l,u,f,g){if(!this.isMouseDown)return;let m;if(l=Sr(l,0,this.width),u=Sr(u,0,this.height),this.activeBoxUid){m=this.getBoxByUid(this.activeBoxUid);const{keepAspectRatioWithShift:b,keepAspectRatio:S,enableMoveQuad:I}=this.renderer.config;if(m.isRect)m.keepAspectRatio=!(!f||!b)||S;else if(!I&&8===this.activePartNum)return;return m.onMoveHandler(l,u),void(this.isModified=!0)}const{enableCreateBoxByPointer:v,enableMultiple:_}=this.renderer.config;if((_||!this.boxes.length)&&v){const{startX:b,startY:S}=this;let I=u-S;const k=l-b;let O=-1;const j=2/this.zoom;if(k<-j&&I<-j?O=0:k>j&&I<-j?O=1:k>j&&I>j?O=2:k<-j&&I>j&&(O=3),O>-1){const{aspectRatio:W}=this.renderer.config;W>0&&(I=k/W,O%2&&(I=-k/W));const J=[],K=O%2?[b,S,b,S+I,l,S+I,l,S]:[l,S+I,b,S+I,b,S,l,S];for(let Q=0;Q<4;Q++)J.push(K[2*(O+Q)%8]),J.push(K[(2*(O+Q)+1)%8]);m=this.addRectBox(J,!1),this.isDrawNewBox=!0,m.keepAspectRatio=W>0,this.isDrawing=!0,this.activeBoxUid=m.uid,m.onStartHandler(this.startX,this.startY,O,g),m.onMoveHandler(l,u,O)}}}onEndHandler(){if(!this.isMouseDown||!this.activeBoxUid)return;this.isMouseDown=!1;const l=this.getBoxByUid(this.activeBoxUid);if(l.keepAspectRatio=this.renderer.config.keepAspectRatio,l.onEndHandler(),this.isDrawNewBox)this.isDrawNewBox=!1,this.renderer.hooks.boxCreated.emit(l);else if(this.isModified){const u={box:l};l.isRect?(u.oldRect=this.oldRect,u.newRect=l.getRect()):(u.oldQuad=this.oldQuad,u.newQuad=l.getQuad()),this.renderer.hooks.boxModified.emit(u)}this.oldRect=null,this.oldQuad=null,this.isModified=!1,this.isDrawing=!1,this.activeBoxUid=null,this.activePartNum=-1}isPointHover(l){let[u,f]=l;return u>=0&&u<=this.width&&f>=0&&f<=this.height}getCursorInfo(l,u,f){for(let g=this.boxes.length-1;g>=0;g--){const m=this.boxes[g],v=m.getActivePartNum(l,u,f);if(v>-1){let _="move";return v<8&&(_=m.checkOrientation(v)),{part:v,position:_,isRect:m.isRect}}}return null}}const u6e={aspectRatio:0,keepAspectRatio:!1,keepAspectRatioWithShift:!0,enableMultiple:!1,enableCreateBoxByPointer:!0,enableCursor:!0,enableMask:!0,enableMagnifier:!0,moveThreshold:2,enableMoveQuad:!1,magnifier:{fixed:!1,fixedTop:0,fixedLeft:0,size:50,magnification:2},boxStyle:{borderColor:"orange",borderWidth:2,borderStyle:[5,2],background:"rgba(255,255,255,0)",ctrlBorderWidth:2,ctrlBorderRadius:4,ctrlBorderColor:"orange",ctrlWidth:16,ctrlHeight:16,ctrlBackground:"rgba(255,0,0,0)",invalidCtrlBorderColor:"red",invalidBorderColor:"red",ctrlRadiusMultipleMobile:2},defaultCursor:"default",enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0};class d6e{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N(this,"areas",void 0),N(this,"scrollTop",0),N(this,"scrollLeft",0),N(this,"zoom",1),N(this,"config",void 0),N(this,"canvasDom",void 0),N(this,"isMousedown",!1),N(this,"isEditing",!1),N(this,"editingCursor","crosshair"),N(this,"hoveredArea",void 0),N(this,"hooks",{boxCreated:up(),boxModified:up(),boxDeleted:up()}),this.areas=new Map,this.zoom=1,this.config=hn(u6e),yo(l,this.config),this.setCanvasDom(l.canvas)}setCanvasDom(l){l&&(this.canvasDom=l)}updateConfig(l){yo(l,this.config)}addArea(l,u){if(this.areas.has(l)){const g=this.areas.get(l);return g.updateAreaRect(u),g}const f=new c6e(this,l,u);return this.areas.set(l,f),f}deleteArea(l){this.areas.has(l)&&(this.areas.get(l).boxes.forEach(u=>{this.hooks.boxDeleted.emit(u)}),this.areas.delete(l))}clearArea(){this.areas.forEach(l=>{l.boxes.forEach(u=>{this.hooks.boxDeleted.emit(u)})}),this.areas.clear()}clearAreaBoxes(l){if(this.areas.has(l)){const u=this.areas.get(l);u.boxes.forEach(f=>{this.hooks.boxDeleted.emit(f)}),u.clearBoxes()}}addRectBox(l,u){return this.areas.get(u).addRectBox(l)}addQuadBox(l,u){return this.areas.get(u).addQuadBox(l)}updateOptions(l){Object.assign(this,l),Xt(l.zoom)&&this.areas.forEach(u=>{u.zoom=l.zoom})}getAreaByUid(l){return this.areas.get(l)}deleteAreaByUid(l){this.areas.delete(l)}getHoveredArea(l){const u=this.nativeToCanvas(l);for(const f of this.areas.values()){const g=this.canvasToArea(u,f);if(f.isPointHover(g)&&f.isVisible)return f}return null}getHoveredAreaForCursor(l){const u=__(l),f=this.nativeToCanvas(l);for(const g of this.areas.values()){const m=this.canvasToArea(f,g),[v,_]=m,b=g.isVisible&&g.boxes.find(S=>S.getActivePartNum(v,_,u)>-1);if(g.isPointHover(m)||b)return g}return null}isControlPointTouched(l){const u=this.getHoveredArea(l);if(!u||!u.isVisible)return!1;const f=this.nativeToCanvas(l),[g,m]=this.canvasToArea(f,u),v=__(l);return u.isTouchedPoint(g,m,v)}isBoxTouched(l){const u=this.getHoveredArea(l);if(!u||!u.isVisible)return!1;const f=this.nativeToCanvas(l),[g,m]=this.canvasToArea(f,u),v=__(l);return u.isTouchedBox(g,m,v)}onStartHandler(l){const u=this.getHoveredArea(l);if(!u||!u.isVisible)return;this.hoveredArea=u,this.isMousedown=!0;const f=this.nativeToCanvas(l),[g,m]=this.canvasToArea(f,u),v=__(l);u.onStartHandler(g,m,v)}onMoveHandler(l){if(!this.canvasDom)return;const{defaultCursor:u}=this.config,f=this.getHoveredArea(l);if(f){if(!f.isVisible)return}else this.canvasDom.style.cursor=u;const g=__(l),m=this.nativeToCanvas(l);if(this.isMousedown){const[v,_]=this.canvasToArea(m,this.hoveredArea);this.hoveredArea.onMoveHandler(v,_,l.shiftKey,g)}if(this.config.enableCursor&&f){const v="crosshair",_="move",{canvasDom:b}=this;if(this.hasBox()){const[S,I]=this.canvasToArea(m,f),k=f.getCursorInfo(S,I,g);let O;if(null===k)O=this.config.enableMultiple?v:u;else if(k.isRect){const j=k.position===_;this.isMousedown?this.isEditing||(this.editingCursor=j?_:v,this.isEditing=!0):O=j?_:`${k.position}-resize`}else k.part>-1&&k.part<8?this.isMousedown?this.isEditing||(this.editingCursor=v,this.isEditing=!0):O=v:O=u;this.isEditing&&(O=this.editingCursor),b.style.cursor=O}else b.style.cursor!==v&&(b.style.cursor=v)}}hasBox(){for(const l of this.areas.values())if(l.isVisible&&l.boxes.length)return!0;return!1}onEndHandler(l){this.isMousedown&&(this.isMousedown=!1,this.isEditing=!1,this.hoveredArea.onEndHandler(),this.hoveredArea=null)}render(){if(!this.canvasDom||!this.areas.size)return;const l=this.canvasDom.getContext("2d");l.setTransform(1,0,0,1,0,0),this.areas.forEach(u=>{u.isVisible&&u.boxes.length&&this.renderArea(l,u)})}renderArea(l,u){const{borderStyle:f,borderColor:g,borderWidth:m,ctrlBorderColor:v,ctrlBackground:_,ctrlBorderWidth:b,ctrlBorderStyle:S,background:I,maskColor:k,invalidBorderColor:O,invalidCtrlBorderColor:j,ctrlBorderRadius:W,ctrlWidth:J,ctrlHeight:K}=this.config.boxStyle,Q=devicePixelRatio,ie=J*Q,oe=K*Q,le=Math.min(W*Q,ie/2,oe/2),he=[f[0]*Q,f[1]*Q],_e=m*Q,Ve=b*Q,ee=[S[0]*Q,S[1]*Q];l.save(),l.beginPath(),l.rect(u.left*Q,u.top*Q,u.width*u.zoom*Q,u.height*u.zoom*Q),l.closePath(),l.clip(),this.config.enableMask&&k&&(l.save(),l.beginPath(),l.rect(u.left*Q,u.top*Q,u.width*u.zoom*Q,u.height*u.zoom*Q),u.boxes.forEach(ke=>{let xe=this.areaPointsToCanvas(ke.points.slice(0,8),u),Le=this.areaPointsToCanvas(ke.midpoints.slice(0,8),u);1!==Q&&(xe=xe.map(V=>V*Q),Le=Le.map(V=>V*Q)),l.moveTo(xe[0],xe[1]);for(let V=1;V<4;V++)l.lineTo(xe[2*V],xe[2*V+1])}),l.closePath(),l.clip("evenodd"),l.fillStyle=k,l.fill(),l.restore()),u.boxes.forEach(ke=>{let xe=this.areaPointsToCanvas(ke.points.slice(0,8),u),Le=this.areaPointsToCanvas(ke.midpoints.slice(0,8),u);1!==Q&&(xe=xe.map(V=>V*Q),Le=Le.map(V=>V*Q)),l.save(),l.setLineDash(he),l.strokeStyle=ke.isConvex?g:O,l.fillStyle=""===I?"transparent":I,l.lineWidth=_e,l.beginPath(),l.moveTo(xe[0],xe[1]);for(let V=1;V<4;V++)l.lineTo(xe[2*V],xe[2*V+1]);l.closePath(),l.fill(),l.stroke(),l.setLineDash(ee),l.strokeStyle=ke.isConvex?v:j,l.fillStyle=""===_?"transparent":_,l.lineWidth=Ve,this.config.enableEditCropBoxVertices&&this.drawCtrlPoints(l,xe,ie,oe,le,this.config.enableHideEditingCropBoxVertex?ke.selectedPart:-1),this.config.enableEditCropBoxMidpoints&&this.drawCtrlPoints(l,Le,ie,oe,le,this.config.enableHideEditingCropBoxMidpoint?ke.selectedPart-4:-1),l.restore()}),l.restore()}drawCtrlPoints(l,u,f,g,m,v){const _=f/2,b=g/2;for(let S=0;S<4;S++){if(S===v)continue;l.beginPath();const I=u[2*S],k=u[2*S+1];if(0===m)l.rect(I-_,k-b,f,g);else{const{PI:O}=Math;l.arc(I-_+m,k-b+m,m,O,3*O/2),l.arc(I+_-m,k-b+m,m,3*O/2,2*O),l.arc(I+_-m,k+b-m,m,0,O/2),l.arc(I-_+m,k+b-m,m,O/2,O)}l.closePath(),l.fill(),l.stroke()}}areaPointsToCanvas(l,u){const f=[];for(let g=0;g<4;g++){const[m,v]=this.areaToCanvas([l[2*g],l[2*g+1]],u);f.push(m,v)}return f}canvasToArea(l,u){let[f,g]=l;const{scrollLeft:m,scrollTop:v,zoom:_}=this;return f=(f-u.left+m)/_,g=(g-u.top+v)/_,[f,g]}areaToCanvas(l,u){let[f,g]=l;const{scrollLeft:m,scrollTop:v,zoom:_}=this;return f=f*_+u.left-m,g=g*_+u.top-v,[f,g]}nativeToCanvas(l){const u=["touchstart","touchend","touchmove"].includes(l.type)?l.targetTouches[0]:l,f=this.canvasDom.getBoundingClientRect(),{scrollX:g,scrollY:m}=window;return[u.pageX-g-f.left,u.pageY-m-f.top]}}class h6e{constructor(l,u){N(this,"context",void 0),N(this,"core",void 0),N(this,"boxRenderer",void 0),N(this,"viewer",void 0),N(this,"isMousedown",!1),this.viewer=l,this.context=l.context,this.core=l.context.core,this.boxRenderer=u}isEditCropBox(l){const u=this.boxRenderer.getHoveredArea(l);return!(!u||!u.isVisible||u.boxes.length&&!this.boxRenderer.isBoxTouched(l))}mousedown(l){const{context:u}=this,f=this.context.getActiveTab();if(null==f||!f.total||"crop"!==this.context.viewerConfig.toolMode)return;const[g]=this.context.formatTouches(l),{page:m}=this.context.getPointerOverPageInfo(g.pageX,g.pageY).pageInfo;if(f&&m&&m.uid!==f.currentUid){const v=f.getPageIndex(m);f.gotoPage(v),this.context.emitPageChangedEvent(f),this.context.core.viewerService.onCurrentChangedByScroll.emit(O2.create(f.uid,u.groupUid,u.uid,v)),this.context.emitPageChangedAfterRenderEvent(f)}this.isMousedown=!0,this.boxRenderer.onStartHandler(l)}mousemove(l){const u=this.context.getActiveTab();null!=u&&u.total&&"crop"===this.context.viewerConfig.toolMode&&(window.TouchEvent&&l instanceof TouchEvent&&l.cancelable&&l.preventDefault(),this.boxRenderer.onMoveHandler(l),this.isMousedown&&this.context.render())}mouseup(l){this.isMousedown&&(this.boxRenderer.onEndHandler(l),this.isMousedown=!1,this.context.render())}afterPerspective(l){let{pageUid:u,docUid:f,width:g,height:m}=l;const{context:v}=this,_=v.tabService.getTab(f);if(!_)return;const b=_.getPageByUid(u);if(b&&(b.rWidth=g,b.rHeight=m,v.clearOptimization([b.uid])),_.isActive){if("crop"===v.viewerConfig.toolMode){this.boxRenderer.areas.forEach(O=>{O.clearBoxes()});const I=this.boxRenderer.getAreaByUid(u),k=_.getPageByUid(u).getRect();null==I||I.updateAreaRect(k)}b&&(b.isLoaded=!1),v.scrollByCurrentChanged=!0;let S=!0;this.context.isDefaultViewer?"none"===_.context.fitMode&&(S=!1):this.context.isThumbnailViewer&&(S=!1),this.context.showTab(_,S)}}afterRotatePages(l){const{context:u}=this;if("crop"!==u.viewerConfig.toolMode)return;const f=this.context.getActiveTab();null!=f&&f.total&&f.uid===l.docUid&&(this.boxRenderer.areas.forEach(g=>{g.clearBoxes()}),l.pageUids.forEach(g=>{const m=this.boxRenderer.getAreaByUid(g),v=f.getPageByUid(g).getRect();null==m||m.updateAreaRect(v)}),this.context.render())}afterRender(l){const{context:u}=this;"crop"===u.viewerConfig.toolMode&&(l.pages.forEach(f=>{const g=this.boxRenderer.getAreaByUid(f.uid);if(g){if(f.isVisible){const m=f.getRect();g.updateAreaRect(m)}g.isVisible="current"===this.viewer.cropMode?f.uid===l.currentUid:f.isVisible}}),this.boxRenderer.updateOptions({zoom:l.context.zoom}),this.boxRenderer.render())}toolModeChanged(l){if("crop"!==l.oldToolMode&&"crop"===l.newToolMode){const u=this.context.getActiveTab();if(!u)return;u.pages.forEach(f=>{const g=f.getRect();this.boxRenderer.addArea(f.uid,g).isVisible="current"===this.viewer.cropMode?f.uid===u.currentUid:f.isVisible}),this.boxRenderer.updateOptions({zoom:u.context.zoom})}else"crop"!==l.newToolMode&&"crop"===l.oldToolMode&&(this.boxRenderer.clearArea(),this.context.render())}pageChanged(l){if("crop"===this.context.viewerConfig.toolMode)return this.context.getActiveTab()?0===l.total?(this.clearRedundantBoxes(),this.boxRenderer.clearArea(),void this.context.render()):void("current"===this.viewer.cropMode&&this.resetPageCropArea()):void 0}deletePages(l){l.pageUids.forEach(u=>{this.boxRenderer.deleteArea(u)})}updatePage(l){const{context:u}=this;if("crop"!==u.viewerConfig.toolMode)return;const f=u.getActiveTab();if(f&&f.uid===l.docUid&&("current"===this.viewer.cropMode&&l.pageUid===f.currentUid&&this.resetPageCropArea(),"all"===this.viewer.cropMode)){const g=this.boxRenderer.getAreaByUid(l.pageUid),m=f.getPageByUid(l.pageUid).getRect();g.updateAreaRect(m),this.boxRenderer.areas.forEach(v=>{v.clearBoxes()}),u.render()}}addPages(l){const u=this.context.getActiveTab();null!=u&&u.total&&u.uid===l.docUid&&(l.pageUids.forEach(f=>{const g=u.getPageByUid(f),m=g.getRect();this.boxRenderer.addArea(g.uid,m),this.boxRenderer.updateOptions({zoom:u.context.zoom})}),this.boxRenderer.areas.forEach(f=>{f.clearBoxes()}))}resetPageCropArea(){const l=this.context.getActiveTab();this.clearRedundantBoxes();const u=l.getCurrentPage(),f=u.getRect();this.boxRenderer.addArea(u.uid,f),this.boxRenderer.updateOptions({zoom:l.context.zoom}),this.context.render()}clearRedundantBoxes(){const l=this.context.getActiveTab();l&&"current"===this.viewer.cropMode&&this.boxRenderer.areas.forEach(u=>{u.areaUid!==l.currentUid&&this.boxRenderer.clearAreaBoxes(u.areaUid)})}}class f6e{constructor(l,u){N(this,"context",void 0),N(this,"core",void 0),N(this,"boxRenderer",void 0),N(this,"viewer",void 0),N(this,"isMousedown",!1),N(this,"canSlide",!1),N(this,"isStart",!1),N(this,"startX",void 0),N(this,"isSliding",void 0),N(this,"slideDistance",void 0),N(this,"slideDirection",void 0),N(this,"slideRAF",void 0),N(this,"tabX",void 0),N(this,"tabY",void 0),this.viewer=l,this.context=l.context,this.core=l.context.core,this.boxRenderer=u}mousedown(l){const u=this.context.getActiveTab();null==u||!u.total||(this.isMousedown=!0,!this.boxRenderer.isControlPointTouched(l)&&this.context.viewerConfig.enableSlide?(this.canSlide=!0,this.slideStart(l)):this.boxRenderer.onStartHandler(l))}mousemove(l){const u=this.context.getActiveTab();null==u||!u.total||(__(l)&&l.cancelable&&l.preventDefault(),this.canSlide?this.slideMove(l):(this.boxRenderer.onMoveHandler(l),this.isMousedown&&this.context.render()))}mouseup(l){this.isMousedown&&(this.canSlide?this.slideEnd(l):this.boxRenderer.onEndHandler(l),this.canSlide=!1,this.isMousedown=!1,this.context.render())}reRender(){const{context:l}=this,u=l.getActiveTab();null!=u&&u.total&&"visible"===l.viewerConfig.visibility&&(this.updatePageQuad(u),l.render())}updatePage(l){const{context:u}=this,f=u.getActiveTab();null!=f&&f.total&&"visible"===u.viewerConfig.visibility&&f.currentUid===l.pageUid&&(this.updatePageQuad(f),u.render())}afterRender(l){if(null==l||!l.total)return;const{boxRenderer:u}=this;l.pages.forEach(f=>{const g=u.getAreaByUid(f.uid);if(g&&f.isVisible){const m=f.getRect();g.updateAreaRect(m)}}),u.updateOptions({zoom:l.context.zoom}),u.render()}pageChanged(l){if(-1===l.current&&0===l.total)return void this.boxRenderer.clearArea();const u=this.context.getActiveTab();u&&this.updatePageQuad(u)}updatePageQuad(l){const{context:u}=this,f=l.getCurrentPage();if(!f)return!1;let g=null;const m=this.boxRenderer.getAreaByUid(f.uid);m&&m.boxes[0]&&(g=m.boxes[0].getQuad());const v=u.core.pageService.getPage(l.currentUid);this.boxRenderer.clearArea();const _=f.getRect(),b=this.boxRenderer.addArea(f.uid,_);this.boxRenderer.updateOptions({zoom:l.context.zoom});const S=v.getQuadVertices(),I=b.addQuadBox(S);let k=I.getQuad();u.hooks.perspectiveQuadChanged.emit(V_.create(I.getQuad(),v.isFull)),g&&(g=v.quadToPixelPPI(g)),k&&(k=v.quadToPixelPPI(k)),Xg(g),Xg(k);let O=!1;return g&&k&&(O=MO(g,k)),O||u.viewer.emit("quadModified",P2.create(g,k)),I}afterRotatePages(l){const u=this.context.getActiveTab();null!=u&&u.total&&l.pageUids.includes(u.currentUid)&&(this.updatePageQuad(u),this.context.render())}afterPerspective(l){let{pageUid:u,docUid:f}=l;const{context:g}=this,m=this.context.getActiveTab();if(null==m||!m.total||m.uid!==f||m.currentUid!==u)return;const v=m.getCurrentPage();v&&(v.isLoaded=!1),this.updatePageQuad(m),g.scrollByCurrentChanged=!0,g.showTab(m,!0)}slideStart(l){if(!this.context.viewerConfig.enableSlide||this.isSliding)return;const u=this.context.getActiveTab();if(null==u||!u.total)return;const{scrollLeft:f,scrollTop:g}=this.context.viewService.getMaxScrollValue();if(f||g)return;const m=this.context.formatTouches(l);if(m.length>1)return;const v=u.getPosition();this.tabX=v.x,this.tabY=v.y,this.startX=m[0].pageX,this.isStart=!0}slideMove(l){if(!this.isStart)return;const{context:u}=this,{viewerConfig:f}=u,g=u.getActiveTab(),m=u.formatTouches(l)[0].pageX-this.startX;if(m>0?this.slideDirection="right":m<0&&(this.slideDirection="left"),this.slideDistance=Math.min(g.context.viewportWidth,Math.abs(m)),this.isSliding)"right"===this.slideDirection?g.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&g.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),u.render();else if("single"===g.context.displayMode&&"crop"===f.toolMode&&f.enableSlide){const{scrollLeft:v,scrollTop:_}=this.context.viewService.getMaxScrollValue();Math.abs(m)>f.startSlideThresholdForPerspective&&!v&&!_&&(this.isSliding=!0,u.configService.updateConfig({displayMode:"slide"}))}}slideEnd(l){if(!this.isStart)return;const{context:u}=this,f=u.getActiveTab(),{displayMode:g}=f.context;"slide"===g&&this.slide(f),this.isStart=!1}slide(l){let u,f=0,g=0,m=0,v=!1;const{viewerConfig:_}=this.context;this.slideDistance>=Math.max(l.context.viewportWidth*_.slideThresholdForPerspective,_.startSlideThresholdForPerspective)?(g=l.context.viewportWidth,u=g-this.slideDistance,"left"===this.slideDirection?l.current!==l.total-1?(m=-this.slideDistance,f=-u/6):(g=0,u=this.slideDistance,v=!0,m=-this.slideDistance,f=u/6):0!==l.current?(m=this.slideDistance,f=u/6):(g=0,u=this.slideDistance,v=!0,m=this.slideDistance,f=-u/6)):(v=!0,g=0,u=this.slideDistance,"left"===this.slideDirection?(m=-this.slideDistance,f=u/6):(m=this.slideDistance,f=-u/6));const S=()=>{m+=f;const I=m>=0;if(Math.abs(m)>=g&&(m=g,I||(m*=-1)),l.setPosition({x:m+this.tabX,y:this.tabY,z:0}),Math.abs(m)===g)return v||(this.context.viewer.gotoPage("right"===this.slideDirection?l.current-1:l.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(S),this.context.render()};this.slideRAF=requestAnimationFrame(S)}}class p6e{constructor(l){N(this,"service",void 0),this.service=l}startHandler(l){this.service.mousedown(l)}moveHandler(l){this.service.mousemove(l)}endHandler(l){this.service.mouseup(l)}isEditCropBox(l){return this.service.isEditCropBox(l)}}class g6e{constructor(l){N(this,"service",void 0),this.service=l}startHandler(l){this.service.mousedown(l)}moveHandler(l){this.service.mousemove(l)}endHandler(l){this.service.mouseup(l)}}function ww(p,l){return{left:Wh(p.left,l),top:Wh(p.top,l),width:Wh(p.width,l),height:Wh(p.height,l)}}const m6e={install(p){const l=p.getClass("Viewer"),u=(f=l,class extends f{constructor(g){super(g),N(this,"boxRenderer",void 0),N(this,"iCropMode","current"),N(this,"cropRectService",void 0),N(this,"perspectiveQuadService",void 0);const{isDefaultViewer:m,isPerspectiveViewer:v}=this.context;(m||v)&&this.initBoxRenderer(),this.cropRectService=new h6e(this,this.boxRenderer),this.perspectiveQuadService=new f6e(this,this.boxRenderer),this.listenDefaultViewerEventsForBox(),this.listenDefaultGlobalEventsForBox(),this.listenPerspectiveViewerEventsForBox(),this.listenPerspectiveGlobalEventsForBox(),this.context.hasBoxRendererModule=!0,this.context.cropBoxEditService=new p6e(this.cropRectService),this.context.perspectiveQuadEditService=new g6e(this.perspectiveQuadService)}initBoxRenderer(){if(!this.context.isDefaultViewer&&!this.context.isPerspectiveViewer)return;const{canvasStyle:{cursor:g},enableEditCropBoxMidpoints:m,enableEditCropBoxVertices:v,enableHideEditingCropBoxMidpoint:_,enableHideEditingCropBoxVertex:b}=this.context.viewerConfig;this.boxRenderer=new d6e({defaultCursor:g,enableEditCropBoxMidpoints:m,enableEditCropBoxVertices:v,enableHideEditingCropBoxMidpoint:_,enableHideEditingCropBoxVertex:b}),this.boxRenderer.setCanvasDom(this.context.rendererService.getCanvasDom()),this.updateQuadStyle(),this.context.hooks.quadSelectionStyleChanged.on(()=>{this.updateQuadStyle()},this),this.context.hooks.canvasCursorStyleChanged.on(()=>{this.boxRenderer.updateConfig({defaultCursor:this.context.viewerConfig.canvasStyle.cursor})},this),this.hooks.resize.on(()=>{this.context.render()});const{hooks:S}=this.boxRenderer;S.boxCreated.on(I=>{const k=this.context.getActiveTab();if(null!=k&&k.total&&(this.context.isDefaultViewer&&I.isRect&&"all"===this.cropMode&&this.boxRenderer.areas.forEach(O=>{O.boxes.length?O.boxes.forEach(j=>{O.isContainBox(I)?O.updateRectBox(j,[...I.vertexes]):O.clearBoxes()}):O.isContainBox(I)&&O.addRectBox([...I.vertexes])}),I.isRect)){let O=I.getRect();O=Kn(O,Vn.displayResolution,72),O=ww(O,2);const j=L5.create(O);this.hooks.cropRectDrawn.emit(j),this.emit("cropRectDrawn",j)}}),S.boxDeleted.on(I=>{const k=this.context.getActiveTab();if(null!=k&&k.total&&I.isRect){let O=I.getRect();O=Kn(O,Vn.displayResolution,72),O=ww(O,2);const j=F5.create(O);this.hooks.cropRectDeleted.emit(j),this.emit("cropRectDeleted",j)}}),S.boxModified.on(I=>{const k=this.context.getActiveTab();if(null==k||!k.total)return;const{box:O}=I;if(this.context.isDefaultViewer&&O.isRect){let{oldRect:j,newRect:W}=I,J=0;if("all"===this.cropMode&&this.boxRenderer.areas.forEach(K=>{K.boxes.length?K.boxes.forEach(Q=>{K.isContainBox(O)?(J+=1,K.updateRectBox(Q,[...O.vertexes])):K.clearBoxes()}):K.isContainBox(O)&&K.addRectBox([...O.vertexes])}),j&&(j=Kn(j,Vn.displayResolution,72),j=ww(j,2)),W&&(W=Kn(W,Vn.displayResolution,72),W=ww(W,2)),!j||!W||j.left!==W.left||j.top!==W.top||j.width!==W.width||j.height!==W.height){J=Math.max(1,J);for(let K=0;K<J;K++){const Q=N5.create(j,W);this.emit("cropRectModified",Q)}}}if(this.context.isPerspectiveViewer&&!O.isRect){const j=this.context.core.pageService.getPage(O.area.areaUid),W=this.boxRenderer.getAreaByUid(O.area.areaUid).isFullBox(O);j.isFull=W,j.setActiveQuad(O.getQuad());let{oldQuad:J,newQuad:K}=I;J&&(J=j.quadToPixelPPI(J)),K&&(K=j.quadToPixelPPI(K)),Xg(J),Xg(K),this.hooks.perspectiveQuadChanged.emit(V_.create(K,j.isFull));let Q=!1;J&&K&&(Q=MO(K,J)),Q||this.emit("quadModified",P2.create(J,K))}})}updateQuadStyle(){const g=this.context.styleService.getParsedQuadSelectionStyle();this.boxRenderer.updateConfig({boxStyle:g})}get cropMode(){return this.iCropMode}set cropMode(g){if(this.iCropMode===g)return;const m=this.iCropMode;this.iCropMode=g;const v=this.context.getActiveTab();if(null!=v&&v.total){if("current"===m&&"all"===g){const _=this.boxRenderer.getAreaByUid(v.currentUid).boxes[0];_&&this.boxRenderer.areas.forEach(b=>{b.isContainBox(_)?b.boxes.length?b.updateRectBox(b.boxes[0],[..._.vertexes]):b.addRectBox([..._.vertexes]):b.clearBoxes()})}this.cropRectService.clearRedundantBoxes(),this.context.render()}}toggleFullPerspective(){const{context:g}=this;if(!g.isPerspectiveViewer)return;const m=g.getActiveTab();null!=m&&m.total&&g.core.pageService.getPage(m.currentUid).toggleFull()&&(this.perspectiveQuadService.updatePageQuad(m),g.render())}listenDefaultGlobalEventsForBox(){this.context.isPerspectiveViewer||(this.context.core.editService.onAfterRotatePages.on(g=>{this.cropRectService.afterRotatePages(g)},this),this.context.core.onAfterPerspective.on(g=>{this.cropRectService.afterPerspective(g)},this))}listenPerspectiveGlobalEventsForBox(){this.context.isPerspectiveViewer&&(this.context.core.editService.onAfterRotatePages.on(g=>{this.perspectiveQuadService.afterRotatePages(g)},this),this.context.core.onAfterPerspective.on(g=>{this.perspectiveQuadService.afterPerspective(g)},this))}listenPerspectiveViewerEventsForBox(){if(!this.context.isPerspectiveViewer)return;const{perspectiveQuadService:g}=this;this.hooks.resize.on(()=>{g.reRender()}),this.hooks.visibleChanged.on(()=>{g.reRender()}),this.hooks.updatePage.on(m=>{g.updatePage(m)}),this.hooks.afterRender.on(m=>{g.afterRender(m)}),this.hooks.pageChanged.on(m=>{g.pageChanged(m)})}listenDefaultViewerEventsForBox(){if(!this.context.isDefaultViewer)return;const{cropRectService:g}=this;this.hooks.updatePage.on(m=>{g.updatePage(m)}),this.hooks.addPagesToDoc.on(m=>{g.addPages(m)}),this.hooks.afterRender.on(m=>{g.afterRender(m)}),this.hooks.toolModeChanged.on(m=>{g.toolModeChanged(m)}),this.hooks.pageChanged.on(m=>{g.pageChanged(m)}),this.hooks.deletePages.on(m=>{g.deletePages(m)}),this.hooks.beforeCropPages.on(()=>{this.clearRectBox()})}setRectBox(g,m){const v=this.context.getActiveTab();return!(!v||!v.total||(pt(m)&&(m=[v.current]),v.indicesToUids(m).forEach(_=>{let b=g;b=Kn(g,Vn.dataResolution,Vn.displayResolution);const S=(k=>{const{left:O,top:j,width:W,height:J}=k;return[O,j,O+W,j,O+W,j+J,O,j+J]})(b),I=this.boxRenderer.areas.get(_);I.boxes.length?I.updateRectBox(I.boxes[0],S,!0):I.addRectBox(S)}),this.context.render(),0))}getRectBox(){const g=this.context.getActiveTab();if(g&&g.total){let m=null;if(g.pages.find(v=>{const _=this.boxRenderer.getAreaByUid(v.uid);return!(null==_||!_.boxes.length||(m=_,0))}),m){const v=m.boxes[0];if(null!=v&&v.isRect){let _=v.getRect();return _=Kn(_,Vn.displayResolution,Vn.dataResolution),_=ww(_,2),_.width=_.width||1,_.height=_.height||1,_}}}return null}getRenderedRectBoxCount(){const g=this.context.getActiveTab();let m=0;return g&&g.total&&this.boxRenderer.areas.forEach(v=>{m+=v.boxes.length}),m}getCropIndices(){const g=this.context.getActiveTab();let m=[];if(g&&g.total)if("all"===this.iCropMode){const v=[];this.boxRenderer.areas.forEach(_=>{_.boxes.length&&v.push(_.areaUid)}),m=g.uidsToIndices(v)}else m=[g.current];return m}clearRectBox(){return this.boxRenderer.areas.forEach(g=>{g.clearBoxes()}),!0}setQuadBox(g){const m=this.context.getActiveTab();if(!m||!m.total)return!1;const v=this.context.core.pageService.getPage(m.currentUid);let _=g;_=g.map(O=>Kn(O,v.resource.resolutionX,Vn.displayResolution));const b=this.boxRenderer.getAreaByUid(m.currentUid),{width:S,height:I}=b,k=VZ(_,S,I);return v.isFull=k,v.setActiveQuad(_),this.perspectiveQuadService.updatePageQuad(m),this.hooks.perspectiveQuadChanged.emit(V_.create(_,v.isFull)),this.context.render(),!0}getQuadBox(){const g=this.context.getActiveTab();if(g&&g.total){const m=this.boxRenderer.getAreaByUid(g.currentUid).boxes[0];if(!m.isRect){let v=m.getQuad();const _=this.context.core.pageService.getPage(g.currentUid);return v=v.map(b=>Kn(b,Vn.displayResolution,_.resource.resolutionX)),Xg(v),v}}return null}resetQuadBox(g){const m=this.context.getActiveTab();if(null==m||!m.total)return!1;let v=[];return v=pt(g)?[m.currentUid]:m.indicesToUids(g),v.forEach(_=>{const b=this.context.core.pageService.getPage(_),{quad:S}=b;S?(b.isFull&&(b.isFull=!1),b.setActiveQuad(S),this.perspectiveQuadService.updatePageQuad(m)):b.isFull||(b.isFull=!0,this.perspectiveQuadService.updatePageQuad(m)),b.uid===m.currentUid&&this.hooks.perspectiveQuadChanged.emit(V_.create(S,b.isFull))}),this.context.render(),!0}clearQuadBox(){return this.boxRenderer.areas.forEach(g=>{g.clearBoxes()}),!0}isConvexQuad(g){return LE(g.flat())}});var f;p.setClass("Viewer",u)}};class v6e extends qh{constructor(l,u){super(),N(this,"action",void 0),N(this,"core",void 0),this.action=l,this.core=u,this.type="rotate",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on(f=>{const{pageUids:g}=this.action;g.slice().forEach(m=>{if(f.pageUids.includes(m)){const v=g.indexOf(m);g.splice(v,1)}}),this.isValid=g.length>0},this)}execute(){const{core:l,action:u}=this;u.pageUids.forEach(g=>{l.pageService.getPage(g).addAction(u)});const f=F2.create(u.docUid,u.angle,u.pageUids);return l.editService.onRotatePages.emit(f),l.editService.onAfterRotatePages.emit(f),!0}undo(){const{core:l,action:u}=this;u.pageUids.forEach(g=>{l.pageService.getPage(g).deleteAction(u.actionUid)});const f=F2.create(u.docUid,u.angle,u.pageUids);l.editService.onRotatePages.emit(f),l.editService.onAfterRotatePages.emit(f)}}class y6e extends qh{constructor(l,u){super(),N(this,"action",void 0),N(this,"core",void 0),this.action=l,this.core=u,this.type="crop",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on(f=>{const{pageUids:g}=this.action;g.slice().forEach(m=>{if(f.pageUids.includes(m)){const v=g.indexOf(m);g.splice(v,1)}}),this.isValid=g.length>0},this)}execute(){const{core:l,action:u}=this;u.pageUids.forEach(g=>{l.pageService.getPage(g).addAction(this.action)});const f=L2.create(u.docUid,u.rect,u.pageUids);return l.editService.onCropPages.emit(f),!0}undo(){const{core:l,action:u}=this;u.pageUids.forEach(g=>{l.pageService.getPage(g).deleteAction(u.actionUid)});const f=L2.create(u.docUid,u.rect,u.pageUids);l.editService.onCropPages.emit(f)}}class _6e extends rr{constructor(l){super(),N(this,"core",void 0),N(this,"onRotatePages",void 0),N(this,"onAfterRotatePages",void 0),N(this,"onCropPages",void 0),N(this,"onAfterCropPages",void 0),this.core=l,this.initEventEmitter()}initEventEmitter(){this.onRotatePages=Et(this),this.onAfterRotatePages=Et(this),this.onCropPages=Et(this),this.onAfterCropPages=Et(this)}rotatePages(l,u,f,g){const m={actionUid:Ai(),type:"rotate",docUid:l,pageUids:[...u],angle:f,rotationType:g},{core:v}=this,_=new v6e(m,v);return v.commandService.execute(_,l),!0}cropPages(l,u,f){const g={actionUid:Ai(),type:"crop",docUid:l,pageUids:[...u],rect:qe({},f)},{core:m}=this,v=new y6e(g,m);return m.commandService.execute(v,l),!0}}const C6e={apply(p){p.editService=new _6e(p)},install(p){const l=p.getClass("Viewer"),u=(f=l,class extends f{constructor(g){super(g),this.listenGlobalEventsForEdit(),this.listenViewerEventsForEdit()}listenGlobalEventsForEdit(){const{context:g}=this,m=v=>{let{docUid:_,pageUids:b}=v;const S=g.tabService.getTab(_);if(null!=S&&S.isActive){g.scrollByCurrentChanged=!0,g.clearOptimization(b);let I=!0;g.isDefaultViewer?"none"===S.context.fitMode&&(I=!1):g.isThumbnailViewer&&(I=!1),g.showTab(S,I)}};g.core.editService.onRotatePages.on(m,this),g.core.editService.onCropPages.on(m,this)}listenViewerEventsForEdit(){this.hooks.beforeLayout.on(g=>{const{core:{pageService:m},isDefaultViewer:v,isThumbnailViewer:_,isPerspectiveViewer:b}=this.context;(v||_||b)&&g.pages.forEach(S=>{let I=null;const k=m.getPage(S.uid);I=v||_?k.getEditResult():k.getEditResultForPerspective(),I&&(S.rWidth=I.rWidth,S.rHeight=I.rHeight,S.cropLeft=I.cropLeft,S.cropTop=I.cropTop,S.cropWidth=I.cropWidth,S.cropHeight=I.cropHeight,S.rotation=I.rotation,S.mediaBoxRect=I.mediaBox,S.cropBoxRect=I.cropBox)})})}rotatePages(g,m){var v;if(g%360==0)return!0;const _=this.context.getActiveTab();if(!_)return!1;null!==(v=m)&&void 0!==v||(m=[_.current]);const b=_.indicesToUids(m);return this.context.core.editService.rotatePages(_.uid,b,g,"contain")}cropPages(g,m){var v;const _=this.context.getActiveTab();if(!_)return!1;null!==(v=m)&&void 0!==v||(m=[_.current]);const b=_.indicesToUids(m);return g=Kn(g,Vn.dataResolution,Vn.displayResolution),this.hooks.beforeCropPages.emit(),this.context.core.editService.cropPages(_.uid,b,g)}});var f;p.setClass("Viewer",u)}};class dD extends eEe{static create(l){return new dD(l,l.uid)}constructor(l,u){super(u),N(this,"type",void 0),N(this,"docUid",void 0),N(this,"pageUid",void 0),N(this,"style",void 0),N(this,"transform",void 0),N(this,"flags",void 0),N(this,"comment",void 0),N(this,"layer",void 0),N(this,"creationDate",void 0),N(this,"modified",!1),N(this,"oriIndex",void 0),this.type=l.type,this.docUid=l.docUid,this.pageUid=l.pageUid,this.style=l.style,this.flags=l.flags||["print"],this.transform=l.transform,this.oriIndex=l.oriIndex,pt(null==l?void 0:l.modified)||(this.modified=l.modified)}getConfig(){return{uid:this.uid,docUid:this.docUid,pageUid:this.pageUid,type:this.type,style:hn(this.style),transform:hn(this.transform),flags:hn(this.flags),comment:hn(this.comment),creationDate:this.comment.creationDate,modificationDate:this.comment.modificationDate,oriIndex:this.oriIndex,modified:this.modified}}clone(l,u){const f=dD.create({docUid:this.docUid,pageUid:l,type:this.type,style:hn(this.style),transform:hn(this.transform),flags:this.flags.slice(),comment:this.comment}),g=this.comment.clone(f.uid,u);return f.comment=g,f.layer=this.layer,f}updateStyle(l){Object.assign(this.style,l)}updateComment(l){this.comment.updateComment(l)}addReplies(l){this.comment.replies.push(...l)}deleteReplies(l){const u=this.comment.replies;l.forEach(f=>{if(u.includes(f)){const g=u.findIndex(m=>m.uid===f.uid);u.splice(g,1)}})}updateReply(l){const u=this.comment.replies.findIndex(f=>f.uid===l.uid);this.comment.replies[u]=l}getAllReplies(){return[...this.comment.replies]}deleteReplyReviewSate(l){const u=this.comment.getReply(l);u&&u.deleteReviewState()}setReplyReviewState(l,u){const f=this.comment.getReply(l);f&&f.setReviewState(u)}deleteReplyMarkedSate(l){const u=this.comment.getReply(l);u&&u.deleteMarkedState()}setReplyMarkedState(l,u){const f=this.comment.getReply(l);f&&f.setMarkedState(u)}}class Sw{static create(l){return new Sw(l)}constructor(l){N(this,"uid",void 0),N(this,"author",void 0),N(this,"contents",void 0),N(this,"creationDate",void 0),N(this,"state",void 0),this.uid=l.uid,this.author=l.author,this.contents=l.contents,this.creationDate=l.creationDate,this.state=l.state}}class Tw{static create(l){return new Tw(l)}constructor(l){N(this,"uid",void 0),N(this,"author",void 0),N(this,"contents",void 0),N(this,"creationDate",void 0),N(this,"state",void 0),this.uid=l.uid,this.author=l.author,this.contents=l.contents,this.creationDate=l.creationDate,this.state=l.state}}class Z_ extends x_{static create(l,u){return new Z_(l,u)}constructor(l,u){var f,g;super(u),N(this,"annotationUid",void 0),N(this,"author",void 0),N(this,"subject",void 0),N(this,"contents",void 0),N(this,"creationDate",void 0),N(this,"modificationDate",void 0),N(this,"markedStates",void 0),N(this,"reviewStates",void 0),this.annotationUid=l.annotationUid,this.author=l.author,this.subject=l.subject,this.contents=l.contents,this.creationDate=l.creationDate,this.modificationDate=l.modificationDate,this.markedStates=[],this.reviewStates=[],null!==(f=l.markedStates)&&void 0!==f&&f.length&&l.markedStates.forEach(m=>{const v=Tw.create(m);this.markedStates.push(v)}),null!==(g=l.reviewStates)&&void 0!==g&&g.length&&l.reviewStates.forEach(m=>{const v=Sw.create(m);this.reviewStates.push(v)})}updateReply(){Object.assign(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}setMarkedState(l){const f=this.markedStates[this.markedStates.length-1];if((null==f?void 0:f.state)!==l.state||!f&&"marked"===l.state){const g=Tw.create(l);return this.markedStates.push(g),!0}return!1}deleteMarkedState(){this.markedStates.pop()}setReviewState(l){const u=Sw.create(l);this.reviewStates.push(u)}deleteReviewState(){this.reviewStates.pop()}clone(l,u){const f=Z_.create({annotationUid:l,author:this.author,subject:this.subject,contents:this.contents,creationDate:u,modificationDate:u});return this.cloneStates(f),f}cloneStates(l){this.markedStates.forEach(u=>{const f=Tw.create(Ht(qe({},u),{uid:Ai()}));l.markedStates.push(f)}),this.reviewStates.forEach(u=>{const f=Sw.create(Ht(qe({},u),{uid:Ai()}));l.reviewStates.push(f)})}}class hD extends Z_{static create(l,u){return new hD(l,u)}constructor(l,u){super(l,u),N(this,"replies",void 0),this.replies=[]}updateComment(l){Object.assign(this,l)}getReply(l){return this.replies.find(u=>u.uid===l.uid)}clone(l,u){const f=hD.create({annotationUid:l,author:this.author,subject:this.subject,contents:this.contents,creationDate:u,modificationDate:u});return this.cloneStates(f),this.replies.forEach(g=>{f.replies.push(g.clone(l,u))}),f}}class fD extends x_{static create(l){return new fD(l)}constructor(l){super(l),N(this,"bottom",void 0),N(this,"top",void 0),N(this,"annotations",void 0),N(this,"layers",void 0),this.annotations=[],this.bottom=-1,this.top=0,this.layers=[]}clone(l){const u=fD.create(l);return u.top=this.top,u.bottom=this.bottom,u.annotations=this.annotations.slice(),u.layers=hn(this.layers),u}createTop(){const{top:l}=this;return this.top+=1,l}addAnnotation(l,u){if(!this.annotations.includes(l)){this.annotations.push(l);const f={annotationUid:l,layer:u};return this.layers.push(f),pt(u)?(f.layer=this.top,this.top+=1):this.sortLayers(),f}return null}sortLayers(){this.layers.sort((l,u)=>l.layer-u.layer)}deleteAnnotations(l){l.forEach(u=>{const f=this.annotations.indexOf(u);f>-1&&this.annotations.splice(f,1);const g=this.layers.findIndex(m=>m.annotationUid===u);g>-1&&this.layers.splice(g,1)})}moveAnnotation(l){const u=this.annotations.indexOf(l);if(u<0)return null;const f=this.layers.findIndex(m=>m.annotationUid===l);if(f<0)return null;const g={annotationUid:l,index:u,layerIndex:f,layer:this.layers[f].layer};return this.deleteAnnotations([l]),g}undoMoveAnnotation(l){const{annotationUid:u}=l;this.annotations.includes(u)||this.layers.find(f=>f.annotationUid===u)||(this.annotations.splice(l.index,0,u),this.layers.splice(l.layerIndex,0,{annotationUid:u,layer:l.layer}))}bringForward(l){const u=this.layers.findIndex(m=>m.annotationUid===l);if(u<0)return null;const f=this.layers[u],g=this.layers[u+1];return g&&(this.switchLayer(f,g),this.sortLayers()),{curLayer:f,forward:g}}switchLayer(l,u){const f=l.layer;l.layer=u.layer,u.layer=f}sendBackward(l){const u=this.layers.findIndex(m=>m.annotationUid===l);if(u<0)return null;const f=this.layers[u],g=this.layers[u-1];return g&&(this.switchLayer(f,g),this.sortLayers()),{curLayer:f,backward:g}}bringToFront(l){const u=this.layers.findIndex(g=>g.annotationUid===l);if(u<0)return null;const f=this.layers[u];return u<this.layers.length-1&&(f.layer=this.top,this.top+=1,this.sortLayers()),f}sendToBack(l){const u=this.layers.findIndex(g=>g.annotationUid===l);if(u<0)return null;const f=this.layers[u];return u>0&&(f.layer=this.bottom,this.bottom-=1,this.sortLayers()),f}restoreLayer(l,u){const f=this.layers.findIndex(g=>g.annotationUid===l);return f<0?null:(this.layers[f].layer=u,this.sortLayers(),!0)}getLayerState(l){const u=this.layers.findIndex(g=>g.annotationUid===l);if(u<0)return{back:!1,front:!1,forward:!1,backward:!1};const f={back:!0,front:!0,forward:!0,backward:!0};return 0===u&&(f.back=!1,f.backward=!1),u===this.layers.length-1&&(f.front=!1,f.forward=!1),1===this.layers.length&&(f.front=!1,f.forward=!1,f.back=!1,f.backward=!1),f}getAnnotationUidListByLayer(){return this.layers.slice().sort((l,u)=>l.layer-u.layer).map(l=>l.annotationUid)}}const As=new class{constructor(){N(this,"db",void 0),this.db=new Map}findAnnotationByUid(p){return this.db.get(p)}deleteAnnotation(p){return!!this.db.has(p.uid)&&(this.db.delete(p.uid),!0)}has(p){return this.db.has(p.uid)}save(p){this.db.set(p.uid,p)}clear(){this.db.clear()}},Zh=new class{constructor(){N(this,"db",void 0),this.db=new Map}findCommentByUid(p){return this.db.get(p)}deleteComment(p){this.db.has(p.uid)&&this.db.delete(p.uid)}has(p){return this.db.has(p.uid)}save(p){this.db.set(p.uid,p)}clear(){this.db.clear()}},dc=new class{constructor(){N(this,"db",void 0),this.db=new Map}findPageByUid(p){return this.db.get(p)}deletePagesByUids(p){p.forEach(l=>{this.db.delete(l)})}has(p){return this.db.has(p.uid)}save(p){this.db.set(p.uid,p)}clear(){this.db.clear()}},Va=new class extends rr{constructor(){super(...arguments),N(this,"annotationCreated",Et(this)),N(this,"annotationDeleted",Et(this)),N(this,"annotationUpdated",Et(this)),N(this,"commentDeleted",Et(this)),N(this,"commentUpdated",Et(this)),N(this,"replyToAnnotation",Et(this)),N(this,"replyDeleted",Et(this)),N(this,"replyUpdated",Et(this)),N(this,"setReplyReviewState",Et(this)),N(this,"deleteReplyReviewState",Et(this)),N(this,"bringFroward",Et(this)),N(this,"sendBackward",Et(this)),N(this,"bringToFront",Et(this)),N(this,"sendToBack",Et(this)),N(this,"restoreLayer",Et(this)),N(this,"annotationPageSwitched",Et(this))}};class oL extends Ll{static create(l){return new oL(l)}constructor(l){super("annotationCreatedDomainEvent"),N(this,"annotations",void 0),this.annotations=l}}const b6e=new class{constructor(p,l,u,f){N(this,"annotationRepo",void 0),N(this,"replyRepo",void 0),N(this,"annotationPageRepo",void 0),N(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.annotationPageRepo=u,this.eventHooks=f}execute(p){const l=p.map(f=>{const g=dD.create(qe({},f)),m=this.annotationPageRepo.findPageByUid(g.pageUid).addAnnotation(g.uid,f.layer);if(m&&(g.layer=m.layer),this.annotationRepo.save(g),f.comment){var v;const _=hD.create(f.comment);g.comment=_,null!==(v=f.comment.replies)&&void 0!==v&&v.length&&f.comment.replies.forEach(b=>{const S=Z_.create(b);_.replies.push(S),this.replyRepo.save(S)})}return g}),u=oL.create(l);return this.eventHooks.annotationCreated.emit(u),l}}(As,Zh,dc,Va);class sL extends Ll{static create(l,u){return new sL(l,u)}constructor(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super("annotationDeletedDomainEvent"),N(this,"annotations",void 0),N(this,"emitEvent",void 0),this.annotations=l,this.emitEvent=u}}const x6e=new class{constructor(p,l,u){N(this,"annotationRepo",void 0),N(this,"annotationPageRepo",void 0),N(this,"eventHooks",void 0),this.annotationRepo=p,this.annotationPageRepo=l,this.eventHooks=u}execute(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(const f of p)if(!this.annotationRepo.has(f))return!1;p.forEach(f=>{this.annotationRepo.deleteAnnotation(f),this.annotationPageRepo.findPageByUid(f.pageUid).deleteAnnotations([f.uid])});const u=sL.create(p,l);return this.eventHooks.annotationDeleted.emit(u),!0}}(As,dc,Va),w6e=new class{constructor(p){N(this,"annotationRepo",void 0),this.annotationRepo=p}execute(p){return this.annotationRepo.findAnnotationByUid(p)}}(As);class aL extends Ll{static create(l){return new aL(l)}constructor(l){super("replyToAnnotationDomainEvent"),N(this,"reply",void 0),this.reply=l}}const S6e=new class{constructor(p,l,u){N(this,"annotationRepo",void 0),N(this,"replyRepo",void 0),N(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.eventHooks=u}execute(p){const l=this.annotationRepo.findAnnotationByUid(p.annotationUid),u=Z_.create({annotationUid:p.annotationUid,author:p.author,contents:p.contents,creationDate:p.creationDate,modificationDate:p.modifiedDate,subject:""});l.addReplies([u]),this.replyRepo.save(u);const f=aL.create(u);return this.eventHooks.replyToAnnotation.emit(f),!0}}(As,Zh,Va);class lL extends Ll{static create(l,u,f){return new lL(l,u,f)}constructor(l,u,f){super("annotationUpdatedDomainEvent"),N(this,"updateDetails",void 0),N(this,"updatedBy",void 0),N(this,"updateActions",void 0),this.updateDetails=l,this.updatedBy=u,this.updateActions=f}}const T6e=new class{constructor(p,l){N(this,"annotationRepo",void 0),N(this,"eventHooks",void 0),this.annotationRepo=p,this.eventHooks=l}execute(p){const l=[],u=p.updateDetails.map(g=>{const m=this.annotationRepo.findAnnotationByUid(g.uid);if(!m)return null;const v=m.getConfig();g.style&&m.updateStyle(g.style),g.transform&&yo(g.transform,m.transform),g.flags&&(m.flags=[...g.flags]),m.modified=g.modified,g.comment&&Object.assign(m.comment,g.comment),this.annotationRepo.save(m);const _=m.getConfig();return l.push({annotationUid:m.uid,from:v,to:_}),m}),f=lL.create(l,p.updatedBy,p.updateActions);return this.eventHooks.annotationUpdated.emit(f),u}}(As,Va);class cL extends Ll{static create(l){return new cL(l)}constructor(l){super("replyUpdatedDomainEvent"),N(this,"reply",void 0),this.reply=l}}const I6e=new class{constructor(p,l,u){N(this,"annotationRepo",void 0),N(this,"replyRepo",void 0),N(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.eventHooks=u}execute(p){const l=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!l)return!1;const u=this.replyRepo.findCommentByUid(p.replyUid);if(!u)return!1;u.updateReply({author:p.author,contents:p.contents,modifiedDate:p.modifiedDate}),l.updateReply(u),this.annotationRepo.save(l),this.replyRepo.save(u);const f=cL.create(u);return this.eventHooks.replyUpdated.emit(f),!0}}(As,Zh,Va);class uL extends Ll{static create(l){return new uL(l)}constructor(l){super("replyDeletedDomainEvent"),N(this,"reply",void 0),this.reply=l}}const E6e=new class{constructor(p,l,u){N(this,"annotationRepo",void 0),N(this,"replyRepo",void 0),N(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.eventHooks=u}execute(p){if(!this.replyRepo.has(p))return!1;const l=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!l)return!1;l.deleteReplies([p]),this.replyRepo.deleteComment(p);const u=uL.create(p);return this.eventHooks.replyDeleted.emit(u),!0}}(As,Zh,Va);class dL extends Ll{static create(l,u,f){return new dL(l,u,f)}constructor(l,u,f){super("bringToFrontDomainEvent"),N(this,"annotationUid",void 0),N(this,"from",void 0),N(this,"to",void 0),this.annotationUid=l,this.from=u,this.to=f}}const D6e=new class{constructor(p,l,u){N(this,"annotRepo",void 0),N(this,"annotPageRepo",void 0),N(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=l,this.eventHooks=u}execute(p){const l=this.annotRepo.findAnnotationByUid(p);if(!l)return!1;const u=this.annotPageRepo.findPageByUid(l.pageUid),f=u.getAnnotationUidListByLayer(),g=u.bringToFront(p);if(!g)return!1;l.layer=g.layer;const m=u.getAnnotationUidListByLayer(),v=dL.create(p,f,m);return this.eventHooks.bringToFront.emit(v),!0}}(As,dc,Va);class hL extends Ll{static create(l,u,f){return new hL(l,u,f)}constructor(l,u,f){super("sendToBackDomainEvent"),N(this,"annotationUid",void 0),N(this,"from",void 0),N(this,"to",void 0),this.annotationUid=l,this.from=u,this.to=f}}const A6e=new class{constructor(p,l,u){N(this,"annotRepo",void 0),N(this,"annotPageRepo",void 0),N(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=l,this.eventHooks=u}execute(p){const l=this.annotRepo.findAnnotationByUid(p);if(!l)return!1;const u=this.annotPageRepo.findPageByUid(l.pageUid),f=u.getAnnotationUidListByLayer(),g=u.sendToBack(p);if(!g)return!1;l.layer=g.layer;const m=u.getAnnotationUidListByLayer(),v=hL.create(p,f,m);return this.eventHooks.sendToBack.emit(v),!0}}(As,dc,Va);class fL extends Ll{static create(l,u,f,g){return new fL(l,u,f,g)}constructor(l,u,f,g){super("bringForwardDomainEvent"),N(this,"annotationUid",void 0),N(this,"forwardUid",void 0),N(this,"from",void 0),N(this,"to",void 0),this.annotationUid=l,this.forwardUid=u,this.from=f,this.to=g}}const P6e=new class{constructor(p,l,u){N(this,"annotRepo",void 0),N(this,"annotPageRepo",void 0),N(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=l,this.eventHooks=u}execute(p){const l=this.annotRepo.findAnnotationByUid(p);if(!l)return!1;const u=this.annotPageRepo.findPageByUid(l.pageUid),f=u.getAnnotationUidListByLayer(),g=u.bringForward(p);if(!g)return!1;const{curLayer:m,forward:v}=g;l.layer=m.layer,v&&(this.annotRepo.findAnnotationByUid(v.annotationUid).layer=v.layer);const _=u.getAnnotationUidListByLayer(),b=fL.create(p,null==v?void 0:v.annotationUid,f,_);return this.eventHooks.bringFroward.emit(b),!0}}(As,dc,Va);class pL extends Ll{static create(l,u,f,g){return new pL(l,u,f,g)}constructor(l,u,f,g){super("sendBackwardDomainEvent"),N(this,"annotationUid",void 0),N(this,"backwardUid",void 0),N(this,"from",void 0),N(this,"to",void 0),this.annotationUid=l,this.backwardUid=u,this.from=f,this.to=g}}const R6e=new class{constructor(p,l,u){N(this,"annotRepo",void 0),N(this,"annotPageRepo",void 0),N(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=l,this.eventHooks=u}execute(p){const l=this.annotRepo.findAnnotationByUid(p);if(!l)return!1;const u=this.annotPageRepo.findPageByUid(l.pageUid),f=u.getAnnotationUidListByLayer(),g=u.sendBackward(p);if(!g)return!1;const{curLayer:m,backward:v}=g;l.layer=m.layer,v&&(this.annotRepo.findAnnotationByUid(v.annotationUid).layer=v.layer);const _=u.getAnnotationUidListByLayer(),b=pL.create(p,null==v?void 0:v.annotationUid,f,_);return this.eventHooks.sendBackward.emit(b),!0}}(As,dc,Va);class gL extends Ll{static create(l){return new gL(l)}constructor(l){super("commentUpdatedDomainEvent"),N(this,"comment",void 0),this.comment=l}}const k6e=new class{constructor(p,l){N(this,"annotationRepo",void 0),N(this,"eventHooks",void 0),this.annotationRepo=p,this.eventHooks=l}execute(p){const l=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!l)return!1;l.updateComment(p);const u=gL.create(l.comment);return this.eventHooks.commentUpdated.emit(u),!0}}(As,Va);class mL extends Ll{static create(l){return new mL(l)}constructor(l){super("deleteReplyReviewStateDomainEvent"),N(this,"replyUid",void 0),this.replyUid=l}}const M6e=new class{constructor(p,l,u){N(this,"annotationRepo",void 0),N(this,"replyRepo",void 0),N(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.eventHooks=u}execute(p){const l=this.replyRepo.findCommentByUid(p);if(!l)return!1;const u=this.annotationRepo.findAnnotationByUid(l.annotationUid);if(!u)return!1;u.deleteReplyReviewSate(l),this.annotationRepo.save(u);const f=mL.create(p);return this.eventHooks.deleteReplyReviewState.emit(f),!0}}(As,Zh,Va);class vL extends Ll{static create(l){return new vL(l)}constructor(l){super("setReplyReviewStateDomainEvent"),N(this,"author",void 0),N(this,"creationDate",void 0),N(this,"contents",void 0),N(this,"state",void 0),N(this,"replyUid",void 0),this.author=l.author,this.creationDate=l.creationDate,this.contents=l.contents,this.state=l.state,this.replyUid=l.replyUid}}const O6e=new class{constructor(p,l,u){N(this,"annotationRepo",void 0),N(this,"replyRepo",void 0),N(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.eventHooks=u}execute(p){const l=this.replyRepo.findCommentByUid(p.replyUid);if(!l)return!1;const u=this.annotationRepo.findAnnotationByUid(l.annotationUid);if(!u)return!1;u.setReplyReviewState(l,p),this.annotationRepo.save(u);const f=vL.create(p);return this.eventHooks.setReplyReviewState.emit(f),!0}}(As,Zh,Va),F6e=new class{constructor(p){N(this,"annotationPageRepo",void 0),this.annotationPageRepo=p}execute(p){let l=this.annotationPageRepo.findPageByUid(p);return l||(l=fD.create(p),this.annotationPageRepo.save(l)),l}}(dc),L6e=new class{constructor(p,l,u){N(this,"annotationPageRepo",void 0),N(this,"annotationRepo",void 0),N(this,"replyRepo",void 0),this.annotationPageRepo=p,this.annotationRepo=l,this.replyRepo=u}execute(p){const l=this.annotationPageRepo.findPageByUid(p.pageUid);if(!l)return null;const u=l.clone(p.newPageUid),f=new Map;return l.annotations.forEach((g,m)=>{const v=this.annotationRepo.findAnnotationByUid(g).clone(p.newPageUid,"");v.comment.replies.forEach(_=>{this.replyRepo.save(_)}),this.annotationRepo.save(v),u.annotations[m]=v.uid,f.set(g,v.uid)}),u.layers.forEach(g=>{g.annotationUid=f.get(g.annotationUid)}),this.annotationPageRepo.save(u),u}}(dc,As,Zh),N6e=new class{constructor(p){N(this,"annotationPageRepo",void 0),this.annotationPageRepo=p}execute(p){this.annotationPageRepo.deletePagesByUids(p)}}(dc),B6e=new class{constructor(p,l,u){N(this,"annotationPageRepo",void 0),N(this,"annotationRepo",void 0),N(this,"replyRepo",void 0),this.annotationPageRepo=p,this.annotationRepo=l,this.replyRepo=u}execute(p){const l=this.annotationPageRepo.findPageByUid(p.pageUid);if(!l)return null;const u=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!u)return null;const f=u.clone(p.pageUid," ");return f.comment.replies.forEach(g=>{this.replyRepo.save(g)}),l.addAnnotation(f.uid),this.annotationRepo.save(f),f}}(dc,As,Zh);class yL extends Ll{static create(l,u,f){return new yL(l,hn(u),hn(f))}constructor(l,u,f){super("annotationPageSwitchedDomainEvent"),N(this,"annotationUid",void 0),N(this,"from",void 0),N(this,"to",void 0),this.annotationUid=l,this.from=u,this.to=f}}const W6e=new class{constructor(p,l,u){N(this,"annotationRepo",void 0),N(this,"annotationPageRepo",void 0),N(this,"eventHook",void 0),this.annotationRepo=p,this.annotationPageRepo=l,this.eventHook=u}execute(p){const{annotationUid:l,pageUid:u,x:f,y:g,layer:m}=p,v=this.annotationRepo.findAnnotationByUid(l);if(!v)return!1;const _=this.annotationPageRepo.findPageByUid(v.pageUid);if(!_)return!1;const b=this.annotationPageRepo.findPageByUid(u);if(!b)return!1;const S={pageUid:v.pageUid,x:v.style.x,y:v.style.y,layer:v.layer};_.deleteAnnotations([l]),b.addAnnotation(l,m),v.updateStyle({x:f,y:g}),v.layer=m,v.pageUid=u;const I=yL.create(v.uid,S,{pageUid:u,x:f,y:g,layer:m});return this.eventHook.annotationPageSwitched.emit(I),!0}}(As,dc,Va);class _L extends Ll{static create(l,u){return new _L(l,u)}constructor(l,u){super("restoreLayerDomainEvent"),N(this,"annotationUid",void 0),N(this,"layer",void 0),this.annotationUid=l,this.layer=u}}const U6e=new class{constructor(p,l,u){N(this,"annotationRepo",void 0),N(this,"annotationPageRepo",void 0),N(this,"eventHooks",void 0),this.annotationRepo=p,this.annotationPageRepo=l,this.eventHooks=u}execute(p){let{annotationUid:l,layer:u}=p;const f=this.annotationRepo.findAnnotationByUid(l);if(!f)return!1;this.annotationPageRepo.findPageByUid(f.pageUid).restoreLayer(l,u),f.layer=u;const g=_L.create(l,u);return this.eventHooks.restoreLayer.emit(g),!0}}(As,dc,Va),V6e=new class{constructor(p,l){N(this,"annotationPageRepo",void 0),N(this,"annotationRepo",void 0),this.annotationPageRepo=p,this.annotationRepo=l}execute(p){let l={back:!1,front:!1,forward:!1,backward:!1};const u=this.annotationRepo.findAnnotationByUid(p);if(!u)return l;const f=this.annotationPageRepo.findPageByUid(u.pageUid);return f&&(l=f.getLayerState(p)),l}}(dc,As);class j6e extends rr{constructor(){super(),N(this,"annotationRepo",As),N(this,"annotationReplyRepo",Zh),N(this,"annotationPageRepo",dc),N(this,"hooks",Va),this.register(Va)}dispose(){this.reset(),this.hooks.dispose(),super.dispose()}reset(){this.annotationPageRepo.clear(),this.annotationReplyRepo.clear(),this.annotationRepo.clear()}createAnnotationPage(l){return F6e.execute(l)}copyAnnotationPage(l,u){return L6e.execute({pageUid:l,newPageUid:u})}deleteAnnotationPage(l){return N6e.execute(l)}createAnnotations(l){return b6e.execute(l)}copyAnnotation(l,u){return B6e.execute({annotationUid:l,pageUid:u})}deleteAnnotations(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=l.map(g=>(xn(g)&&(g=As.findAnnotationByUid(g)),g));return x6e.execute(f,u)}updateAnnotation(l){return T6e.execute(l)}switchAnnotationPage(l,u){return W6e.execute(qe({annotationUid:Un(l)?l.uid:l},u))}getAnnotationByUid(l){return w6e.execute(l)}getAnnotationLayerState(l){return V6e.execute(l)}replyToAnnotation(l){return S6e.execute(l)}deleteReply(l){return xn(l)&&(l=Zh.findCommentByUid(l)),E6e.execute(l)}updateReply(l){return I6e.execute(l)}updateComment(l){return k6e.execute(l)}deleteReplyReviewState(l){return M6e.execute(l)}setReplyReviewState(l){return O6e.execute(l)}bringToFront(l){return D6e.execute(l)}sendToBack(l){return A6e.execute(l)}bringForward(l){return P6e.execute(l)}sendBackward(l){return R6e.execute(l)}restoreLayer(l,u){return U6e.execute({annotationUid:l,layer:u})}}const H6e=["enableContinuousDrawing","controlsStyle","inkCreateDelay","showOnTopWhenSelected","defaultStyleConfig","eraserStyle","selectionStyle"];class G6e extends rr{constructor(l){super(),N(this,"context",void 0),this.context=l}updateConfig(l){for(const[u,f]of Object.entries(l))H6e.includes(u)&&this[u](f)}defaultStyleConfig(l){if(!Un(l))return;const{annotationController:u}=this.context,{viewer:f}=this.context;u.setAnnotationInteractiveConfig({defaultStyleConfig:l}),u.updateFreeTextDefaultConfig(),f.hooks.annotationDefaultStyleChanged.emit(f.getAnnotationConfig().defaultStyleConfig),f.emit("annotationDefaultStyleChanged",f.getAnnotationConfig().defaultStyleConfig)}enableContinuousDrawing(l){const{annotationController:u}=this.context;u.interactiveConfig.enableContinuousDrawing=l}controlsStyle(l){if(!Un(l))return;const{annotationController:u}=this.context;u.setAnnotationInteractiveConfig({controlsStyle:l})}inkCreateDelay(l){const{annotationController:u}=this.context;u.interactiveConfig.inkCreateDelay=l}showOnTopWhenSelected(l){const{annotationController:u}=this.context;u.interactiveConfig.showOnTopWhenSelected=l}}const Wte={arc:"annotationArc",circle:"annotationCircle",ellipse:"annotationEllipse",image:"annotationImage",ink:"annotationInk",rectangle:"annotationRect",line:"annotationLine",polyline:"annotationPolyline",polygon:"annotationPolygon",textTypewriter:"annotationFreeText",textBox:"annotationTextBox",stamp:"annotationStamp",textAssist:"annotationTextAssist",highlight:"annotationHighlight",underline:"annotationUnderline",strikeout:"annotationStrikeout",incomplete:"annotationIncomplete"},z6e={annotationArc:"arc",annotationCircle:"circle",annotationEllipse:"ellipse",annotationImage:"image",annotationInk:"ink",annotationRect:"rectangle",annotationLine:"line",annotationPolyline:"polyline",annotationPolygon:"polygon",annotationFreeText:"textTypewriter",annotationTextBox:"textBox",annotationStamp:"stamp",annotationTextAssist:"textAssist",annotationHighlight:"highlight",annotationUnderline:"underline",annotationStrikeout:"strikeout"};class Y6e extends rr{constructor(l){super(),N(this,"viewer",void 0),N(this,"annotationConfigService",void 0),N(this,"annotationController",void 0),N(this,"context",void 0),this.viewer=l,this.context=l.context,this.annotationConfigService=new G6e(this),this.initAnnotationController(),this.listenViewerEventsForAnnotation()}initAnnotationController(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&((new sZ).init(this.context.rendererService.docRenderer.canvas),this.annotationController=new C2e(this.context.rendererService.getCanvasDom()),this.listenViewerNativeEventsForAnnotation(),this.annotationController.hooks.deleteAnnotation.on(l=>{const u=new Set(l.shapes.map(f=>f.uid));this.context.core.annotationService.deleteAnnotations([...u])},this),this.annotationController.hooks.selectAnnotation.on(l=>{const u=K5.create(l.oldAnnotationsUids,l.newAnnotationUids);this.syncAnnotationLayerState(),this.viewer.hooks.selectedAnnotationsChanged.emit(u),l.emitSelected&&this.viewer.emit("selectedAnnotationsChanged",{newAnnotationUids:[...l.newAnnotationUids],oldAnnotationUids:[...l.oldAnnotationsUids]})},this),this.annotationController.hooks.modifyAnnotation.on(l=>{const u=l.shapes.map(f=>{const g=f.shape.getAnnotationConfig();return{annotationUid:f.uid,options:{transform:hn(g.transform),style:g.style}}});this.context.core.annotationService.updateAnnotations(u,this.context.uid,l.actions)},this),this.annotationController.hooks.addAnnotation.on(l=>{const u=this.context.getActiveTab();if(!u)return;const{annotationService:f}=this.context.core;l.shapes.forEach(g=>{const m=g.shape.getAnnotationConfig(),v=ac(),_=f.createAnnotation(u.uid,{uid:g.uid,docUid:u.uid,pageUid:g.shape.pageUid,type:z6e[m.type],transform:hn(m.transform),style:hn(m.style),flags:["print"],comment:{annotationUid:g.uid,author:"",subject:"",contents:"",creationDate:v,modificationDate:v,markedStates:[],reviewStates:[],replies:[]}});this.annotationController.updateLayer(g.uid,_.layer)})},this),this.annotationController.hooks.annotationModeChanged.on(l=>{"none"===l&&"annotation"===this.viewer.getViewerConfig().toolMode&&this.viewer.updateViewerConfig({toolMode:"pan"})}),this.annotationController.hooks.beforeAnnotationEdit.on(l=>{this.viewer.hooks.beforeAnnotationEdit.emit(l)}),this.annotationController.hooks.afterAnnotationEdit.on(l=>{this.viewer.hooks.afterAnnotationEdit.emit(l)}),this.annotationController.hooks.beforeAnnotationDraw.on(l=>{this.viewer.hooks.beforeAnnotationDraw.emit(l)}),this.annotationController.hooks.afterAnnotationDraw.on(l=>{this.viewer.hooks.afterAnnotationDraw.emit(l)}),this.annotationController.hooks.renderAnnotation.on(()=>{this.context.render()}),this.annotationController.hooks.selectAnnotationTextChars.on(l=>{this.viewer.hooks.annotationTextCharsSelected.emit(l)}))}listenViewerNativeEventsForAnnotation(){const l=this.context.rendererService.getCanvasDom();Xo(l,ir()?"click":"pointerup",this).on(u=>{u.preventDefault(),this.annotationController.clickHandler(u)}),Xo(document,"keydown",this).on(u=>{this.annotationController.keyDownHandler(u)}),Xo(l,"dblclick",this).on(u=>{this.annotationController.dblClickHandler(u)})}listenViewerEventsForAnnotation(){const{context:l,context:{hooks:u,tabService:f}}=this;(l.isDefaultViewer||l.isThumbnailViewer)&&(u.pageExistenceChanged.on(g=>{0===g.pageCount&&(this.annotationController.container=null,this.annotationController.containerId=null,this.context.annotationEditService.containerPage=null)}),u.toolModeChanged.on(g=>{const{annotationMode:m}=l.viewerConfig;if("annotation"!==g.newToolMode)this.annotationController.setAnnotationMode("none"),"crop"===g.newToolMode&&this.selectAnnotations([]);else{let v="draw";"select"===m?v="select":"erase"===m&&(v="erase"),this.annotationController.setAnnotationMode(v)}},this),u.annotationModeChanged.on(g=>{const{toolMode:m}=l.viewerConfig;if("select"===g.newAnnotationMode||"erase"===g.newAnnotationMode){const v=g.newAnnotationMode;"annotation"===m&&this.annotationController.setAnnotationMode(v)}else this.annotationController.drawType=Wte[g.newAnnotationMode],"annotation"===m&&this.annotationController.setAnnotationMode("draw")},this),u.addPagesToDoc.on(g=>{f.getTab(g.docUid)&&this.addAnnotationByPageUids(g.pageUids)},this),u.openDocument.on(g=>{f.getTab(g.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(g.pages))},this),u.closeDocument.on(g=>{g.pages.forEach(m=>{const v=this.context.core.pageService.getPage(m);this.annotationController.deleteShape(v.annotations,!1,!1)})},this),u.deletePages.on(g=>{g.pageUids.forEach(m=>{const v=this.context.core.pageService.getPage(m);this.annotationController.deleteShape(v.annotations,!1,!1)})},this),u.syncDocument.on(g=>{f.getTab(g.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(g.pages))},this),u.afterRender.on(g=>{if(null==g||!g.total)return;const m=l.annotationEditService.containerPage;if(!m||!g.getPageByUid(m.uid))return;let{x:v,y:_}=m.cropBox.getPosition(),{width:b,height:S}=m.cropBox;const I=(m.rotation%360+360)%360/90;if(1===I?v-=S:2===I?(v-=b,_-=S):3===I&&(_-=b),1===I||3===I){const k=b;b=S,S=k}this.annotationController.eventService.setEventArea({x:v,y:_,width:b,height:S})},this))}disableTextEditMode(){const{eventService:l}=this.annotationController;null!=l&&l.activatedShape&&(null==l?void 0:l.activatedShape)instanceof or&&null!=l&&l.activatedShape.isEditMode&&(null==l||l.activatedShape.textEditEventHandler.disableEditMode(),this.context.render())}addAnnotationByPageUids(l){l.forEach(u=>{const f=this.context.core.pageService.getPage(u);if(f.annotations.forEach(g=>{const m=this.context.core.annotationService.annotationApp.getAnnotationByUid(g);this.addAnnotationByAnnotationData(m)}),0===f.annotations.length){const g=this.context.tabService.getTab(f.doc.uid);if(!g)return;const m=g.getPageByUid(f.uid);if(!m)return;this.annotationController.setAnnotationContainer(f.uid,m.mediaBox)}})}addAnnotationByAnnotationData(l){if("unknown"===l.type)return!0;const u=this.context.core.pageService.getPage(l.pageUid);if(!u)return!1;const f=this.context.tabService.getTab(u.doc.uid);if(!f)return!1;const g=f.getPageByUid(l.pageUid);if(!g)return!1;const m=l.getConfig();this.annotationController.setAnnotationContainer(l.pageUid,g.mediaBox);const v=this.annotationController.addShape(Wte[l.type],{id:l.uid,style:Ht(qe({},m.style),{zIndex:l.layer}),transform:m.transform},!1);if(this.annotationController.setAnnotationFlags(l.uid,{enableControl:!m.flags.includes("readOnly"),isVisible:!m.flags.includes("noView")},!1),v instanceof Kc&&"base"===v.stampType){const _=v.getAnnotationConfig();l.transform.position=_.transform.position,l.transform.scale=_.transform.scale,l.style=_.style}if(v instanceof or&&"freeTextWriter"===v.textType){const _=v.getAnnotationConfig();l.style.width=_.style.width}return this.syncAnnotationLayerState(),!0}updateAnnotations(l,u){if(u===this.context.uid)return!0;const f=l.reduce((g,m)=>{const v=this.context.core.annotationService.annotationApp.getAnnotationByUid(m);if(v){const _=this.context.core.pageService.getPage(v.pageUid);if(_&&this.context.tabService.getTab(_.doc.uid)){const b=v.getConfig();g.push({annotationUid:m,config:b})}}return g},[]);return f.length===l.length&&(f.forEach(g=>{var m,v;let{annotationUid:_,config:b}=g;this.annotationController.updateShape(_,{id:_,style:b.style,transform:b.transform},!1);const S=this.annotationController.getShape(_),I=this.context.core.annotationService.annotationApp.getAnnotationByUid(_),k=S.getAnnotationConfig();null!=k&&null!==(m=k.transform)&&void 0!==m&&m.position&&(I.transform.position=k.transform.position),null!=k&&null!==(v=k.transform)&&void 0!==v&&v.scale&&(I.transform.scale=k.transform.scale),S instanceof Kc&&"stamp"===S.renderType&&(I.style.stampConfig=k.style.stampConfig),this.annotationController.setAnnotationFlags(_,{enableControl:!b.flags.includes("readOnly"),isVisible:!b.flags.includes("noView")})}),!0)}updateAnnotationPage(l,u){const f=this.context.core.annotationService.getAnnotationByUid(l);if(!f)return;const g=this.context.core.pageService.getPage(f.pageUid);if(!g)return;const m=this.context.tabService.getTab(g.doc.uid);if(!m)return;const v=m.getPageByUid(u);v&&(this.annotationController.moveShape([l],u,v.mediaBox),this.syncAnnotationLayerState())}updateLayer(l){const u=l.reduce((f,g)=>{const m=this.context.core.annotationService.annotationApp.getAnnotationByUid(g);if(m){const v=this.context.core.pageService.getPage(m.pageUid);v&&this.context.tabService.getTab(v.doc.uid)&&f.push(m)}return f},[]);return u.length===l.length&&(u.forEach(f=>{this.annotationController.updateLayer(f.uid,f.layer)}),this.syncAnnotationLayerState(),!0)}syncAnnotationLayerState(){let l={back:!1,front:!1,forward:!1,backward:!1};const u=this.annotationController.getSelectedShapeUids();return 1===u.length&&(l=this.context.core.annotationService.getAnnotationLayerState(u[0])),this.viewer.hooks.annotationLayerStateChanged.emit(Q5.create(l)),l}deleteAnnotations(l){this.annotationController.deleteShape(l,!1,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),this.syncAnnotationLayerState()}selectAnnotations(l){return this.annotationController.selectShape(l)}getSelectedAnnotations(){const l=this.annotationController.getSelectedShapeUids();if(!l.length)return[];const u=[];return l.forEach(f=>{const g=this.context.core.annotationService.annotationApp.getAnnotationByUid(f);g&&u.push(g)}),u}duplicateAnnotation(l,u){throw new Error("Method not implemented.")}}class X6e extends rr{constructor(l){super(),N(this,"context",void 0),N(this,"containerPage",void 0),this.context=l}isHitAnnotation(l){return this.context.annotationController.isHitShape(l)}startHandler(l,u){this.context.annotationController.startHandler(l,u)}cursorHandler(l,u,f){this.context.annotationController.cursorHandler(l,u,f)}moveHandler(l,u){this.context.annotationController.moveHandler(l,u)}endHandler(l){this.context.annotationController.endHandler(l)}activateAnnotation(l,u){this.context.annotationController.eventService.activateShape(l,u)}deactivateAnnotation(){this.context.annotationController.eventService.inactivateShape(!0),this.context.annotationController.eventService.defaultGroup.clear()}hasActiveAnnotation(){return this.context.annotationController.getSelectedShapeUids().length>0}moveAnnotationByKeyboard(l){}setAnnotationContainer(l){this.containerPage=l,this.context.annotationController.setAnnotationContainer(l.uid,l.mediaBox)}setAnnotationInteractionArea(l){this.context.annotationController.eventService.setEventArea(l)}copyAnnotations(){const l=this.context.annotationController.getSelectedShapeUids();0===l.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.copyAnnotations(l)}cutAnnotations(){const l=this.context.annotationController.getSelectedShapeUids();0===l.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.cutAnnotations(l)}pasteAnnotations(){this.context.annotationController.isInTextEditMode()||this.context.viewer.pasteAnnotations()}dispose(){super.dispose(),this.containerPage=null}}class $6e extends qh{constructor(l,u){super(),N(this,"action",void 0),N(this,"core",void 0),this.action=l,this.core=u,this.type="createAnnotation",this.core.commandService.onBeforeRefreshCommands.on(f=>{f.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){const{action:l}=this,{annotationApp:u}=this.core.annotationService,{annotationConfig:f}=this.action;return!!u.createAnnotations([{docUid:l.docUid,uid:f.uid,pageUid:l.pageUid,type:f.type,style:f.style,transform:f.transform,flags:f.flags,comment:f.comment,layer:f.layer}])}undo(){this.core.annotationService.annotationApp.deleteAnnotations([this.action.annotationConfig.uid])}}class q6e extends qh{constructor(l,u){super(),N(this,"action",void 0),N(this,"core",void 0),this.action=l,this.core=u,this.type="deleteAnnotation",u.commandService.onBeforeRefreshCommands.on(f=>{l.docUid===f.docUid&&(l.deleteConfigs.slice().forEach(g=>{if(f.pageUids.includes(g.pageUid)){const m=l.deleteConfigs.findIndex(v=>v.pageUid===g.pageUid);l.deleteConfigs.splice(m,1)}}),this.isValid=l.deleteConfigs.length>0)},this)}execute(){const{action:l}=this,u=l.deleteConfigs.map(f=>f.uid);return this.core.annotationService.annotationApp.deleteAnnotations(u),!0}undo(){const{annotationApp:l}=this.core.annotationService,u=this.action.deleteConfigs.map(f=>({docUid:this.action.docUid,uid:f.uid,type:f.type,pageUid:f.pageUid,style:f.style,transform:f.transform,flags:f.flags,comment:f.comment,layer:f.layer,oriIndex:f.oriIndex,modified:f.modified}));l.createAnnotations(u)}}class K6e extends qh{constructor(l,u){super(),N(this,"action",void 0),N(this,"core",void 0),N(this,"oldLayer",void 0),N(this,"newLayer",void 0),this.action=l,this.core=u,this.type="bringAnnotationToFront",this.core.commandService.onBeforeRefreshCommands.on(f=>{f.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){const{annotationApp:l}=this.core.annotationService,{annotationUid:u}=this.action,f=l.getAnnotationByUid(u);return this.oldLayer||(this.oldLayer=f.layer),this.newLayer?l.restoreLayer(u,this.newLayer):(l.bringToFront(u),this.newLayer=f.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer)}}class J6e extends qh{constructor(l,u){super(),N(this,"action",void 0),N(this,"core",void 0),this.action=l,this.core=u,this.type="bringAnnotationForward",this.core.commandService.onBeforeRefreshCommands.on(f=>{f.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){return this.core.annotationService.annotationApp.bringForward(this.action.annotationUid)}undo(){this.core.annotationService.annotationApp.sendBackward(this.action.annotationUid)}}class Q6e extends qh{constructor(l,u){super(),N(this,"action",void 0),N(this,"core",void 0),this.action=l,this.core=u,this.type="sendAnnotationBackward",this.core.commandService.onBeforeRefreshCommands.on(f=>{f.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){return this.core.annotationService.annotationApp.sendBackward(this.action.annotationUid)}undo(){this.core.annotationService.annotationApp.bringForward(this.action.annotationUid)}}class Z6e extends qh{constructor(l,u){super(),N(this,"action",void 0),N(this,"core",void 0),N(this,"oldLayer",void 0),N(this,"newLayer",void 0),this.action=l,this.core=u,this.type="sendAnnotationToBack",this.core.commandService.onBeforeRefreshCommands.on(f=>{f.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){const{annotationApp:l}=this.core.annotationService,{annotationUid:u}=this.action,f=l.getAnnotationByUid(u);return this.oldLayer||(this.oldLayer=f.layer),this.newLayer?l.restoreLayer(u,this.newLayer):(l.sendToBack(u),this.newLayer=f.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer)}}class eRe extends qh{constructor(l,u,f){super(),N(this,"action",void 0),N(this,"core",void 0),N(this,"updatedBy",void 0),this.action=l,this.core=u,this.updatedBy=f,this.type="updateAnnotation",u.commandService.onBeforeRefreshCommands.on(g=>{if(l.docUid!==g.docUid)return;const{pageUid:m}=l;g.pageUids.includes(m)&&(this.isValid=!1)},this)}execute(){return this.update(!0),this.updatedBy=null,!0}undo(){this.update(!1)}update(l){const{annotationApp:u}=this.core.annotationService,f=this.action.updateDetails.map(g=>{const m=hn(l?g.to:g.from);return qe({uid:g.annotationUid},m)});u.updateAnnotation({updateDetails:f,updatedBy:this.updatedBy,updateActions:[...this.action.updateActions]})}}class tRe extends qh{constructor(l,u){super(),N(this,"action",void 0),N(this,"core",void 0),this.action=l,this.core=u,this.type="switchAnnotationPage",u.commandService.onBeforeRefreshCommands.on(f=>{l.docUid===f.docUid&&l.moveConfigs.slice().every(g=>((f.pageUids.includes(g.from.pageUid)||f.pageUids.includes(g.to.pageUid))&&(this.isValid=!1),this.isValid))},this)}execute(){const{annotationApp:l}=this.core.annotationService;return this.action.moveConfigs.forEach(u=>{if(pt(u.to.layer)){const f=l.annotationPageRepo.findPageByUid(u.to.pageUid).createTop();u.to.layer=f}l.switchAnnotationPage(u.annotationUid,qe({},u.to))}),!0}undo(){const{annotationApp:l}=this.core.annotationService;this.action.moveConfigs.forEach(u=>{l.switchAnnotationPage(u.annotationUid,qe({},u.from))})}}class nRe extends rr{constructor(l){super(),N(this,"core",void 0),N(this,"annotationApp",void 0),N(this,"hooks",void 0),N(this,"pasteConfig",{pasteComment:!1,pasteReply:!0,updateDate:!0}),N(this,"clipboard",[]),this.core=l,this.annotationApp=new j6e,this.hooks=this.annotationApp.hooks}reset(){this.annotationApp.reset()}getAnnotationByUid(l){return this.annotationApp.getAnnotationByUid(l)}deleteAnnotationPages(l){const u=l.reduce((f,g)=>{const m=this.core.pageService.getPage(g);return m&&f.push(...m.annotations),f},[]);this.deleteAnnotations(u,!1),this.annotationApp.annotationPageRepo.deletePagesByUids(l)}createAnnotationsByParsedPages(l,u){const f=ac();return u.reduce((g,m)=>{var v;this.annotationApp.createAnnotationPage(m.pageUid);const _=null===(v=m.annotations)||void 0===v?void 0:v.reduce((b,S)=>{var I,k,O,j,W;Vte(S);const J={uid:S.uid,docUid:l,pageUid:m.pageUid,type:S.type,style:S.style,transform:S.transform,flags:S.flags,comment:iRe(S.comment),creationDate:null!==(I=null===(k=S.comment)||void 0===k?void 0:k.creationDate)&&void 0!==I?I:f,modificationDate:null!==(O=null===(j=S.comment)||void 0===j?void 0:j.modifiedDate)&&void 0!==O?O:f,oriIndex:null===(W=S.raw)||void 0===W?void 0:W.oriIndex};return b.push(J),b},[]);return null!=_&&_.length?(this.annotationApp.createAnnotations(_),g.push(_.map(b=>b.uid))):g.push([]),g},[])}createAnnotation(l,u){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(Vte(u),f){const g=new $6e({actionUid:Ai(),type:"createAnnotation",docUid:l,pageUid:u.pageUid,annotationConfig:{uid:u.uid,type:u.type,style:u.style,transform:u.transform,flags:u.flags,comment:u.comment,layer:u.layer,modified:u.modified,oriIndex:u.oriIndex}},this.core);this.core.commandService.execute(g,l)}else this.annotationApp.createAnnotations([u]);return this.annotationApp.getAnnotationByUid(u.uid)}deleteAnnotations(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{pageService:f,commandService:g}=this.core,m=l.reduce((v,_)=>{const b=this.annotationApp.getAnnotationByUid(_);if(b){const S=f.getPage(b.pageUid),I=v.get(S.doc.uid)||{uid:S.doc.uid,annotationConfigs:[]};v.set(I.uid,I);const k=b.getConfig();k.layer=b.layer,I.annotationConfigs.push(k)}return v},new Map);if(u)for(const[v,_]of m){const b=_.annotationConfigs.map(I=>({uid:I.uid,type:I.type,pageUid:I.pageUid,style:I.style,transform:I.transform,flags:I.flags,comment:I.comment,layer:I.layer,oriIndex:I.oriIndex,modified:I.modified})),S=new q6e({actionUid:Ai(),type:"createAnnotation",docUid:v,deleteConfigs:b},this.core);g.execute(S,_.uid)}else this.annotationApp.deleteAnnotations(l,!1)}updateAnnotations(l,u,f){let g,m;const v=l.reduce((I,k)=>{const{annotationUid:O}=k,j=this.annotationApp.getAnnotationByUid(O);if(j){const W=this.core.pageService.getPage(j.pageUid);W&&(g=W.uid,m=W.doc.uid,I.push({annotation:j,page:W,options:k.options}))}return I},[]);if(null==v||!v.length||v.length!==l.length)return;const _=ac(),b=v.map(I=>{let{annotation:k,options:j}=I;return j.comment||(j.comment={}),j.comment.modificationDate=_,{annotationUid:k.uid,from:Ht(qe({},k.getConfig()),{modified:k.modified}),to:Ht(qe({},j),{modified:!0})}}),S=new eRe({actionUid:Ai(),type:"updateAnnotation",docUid:m,pageUid:g,updateDetails:b,updateActions:f||[]},this.core,u);this.core.commandService.execute(S,m)}switchAnnotationPage(l){const u=l.map(v=>qe({annotation:this.annotationApp.getAnnotationByUid(v.annotationUid)},v)),f=this.core.pageService.getPage(u[0].annotation.pageUid);if(!f)return;const g=u.map(v=>{let{annotationUid:_,annotation:b,pageUid:S,x:I,y:k}=v;return{annotationUid:_,from:{pageUid:b.pageUid,x:b.style.x,y:b.style.y,layer:b.layer},to:{pageUid:S,x:pt(I)?b.style.x:I,y:pt(k)?b.style.y:k,layer:void 0}}}),m=new tRe({actionUid:Ai(),type:"switchAnnotationPage",docUid:f.doc.uid,moveConfigs:g},this.core);this.core.commandService.execute(m,f.doc.uid)}duplicateAnnotation(l,u){const f=this.annotationApp.getAnnotationByUid(l);if(!f)return null;const g=f.getConfig();return g.uid=Ai(),u&&(g.pageUid=u),g.comment.creationDate=ac(),g.comment.modificationDate=g.comment.creationDate,this.createAnnotation(g.docUid,g)}copyAnnotations(l){l.length&&(this.clipboard=[]),l.forEach(u=>{const f=this.annotationApp.getAnnotationByUid(u);if(f){const g=f.getConfig();this.clipboard.push(g)}})}cutAnnotations(l){this.copyAnnotations(l),this.deleteAnnotations(l)}pasteAnnotations(l,u){this.clipboard.length&&this.clipboard.forEach(f=>{const g=ac(),m=hn(f),v=Ai();Object.assign(m,{uid:v,docUid:l,pageUid:u,creationDate:g,modificationDate:g});const _={annotationUid:v,creationDate:g,modificationDate:g,markedStates:[],reviewStates:[],replies:[]};this.pasteConfig.pasteComment?this.pasteConfig.pasteReply||Object.assign(m.comment,_):Object.assign(m.comment,_,{contents:""}),this.createAnnotation(f.docUid,m)})}clearAnnotationClipboard(){this.clipboard=[]}bringToFront(l){return this.handleLayer(l,"f")}bringForward(l){return this.handleLayer(l,"fw")}sendToBack(l){return this.handleLayer(l,"b")}sendBackward(l){return this.handleLayer(l,"bw")}handleLayer(l,u){const f=this.annotationApp.getAnnotationByUid(l);if(!f)return!1;const g=this.core.pageService.getPage(f.pageUid);if(!g)return!1;const m={actionUid:Ai(),type:u,annotationUid:l,docUid:g.doc.uid,pageUid:g.uid},v=this.annotationApp.getAnnotationLayerState(l);let _;return"f"===u&&v.front?_=new K6e(m,this.core):"fw"===u&&v.forward?_=new J6e(m,this.core):"bw"===u&&v.backward?_=new Q6e(m,this.core):"b"===u&&v.back&&(_=new Z6e(m,this.core)),_&&this.core.commandService.execute(_,g.doc.uid),!0}getAnnotationLayerState(l){return this.annotationApp.getAnnotationLayerState(l)}updateComment(){}addReply(){}deleteReply(){}updateReply(){}addReviewState(){}deleteReviewState(){}addCheckMarkState(){}deleteCheckMarkState(){}createAnnotationShape(l,u){var f,g;const{type:m,transform:v,style:_}=l.getConfig();let b=_,S=v;if("textTypewriter"===m&&(null===(f=l.transform)||void 0===f||!f.position)){const O=new or({style:_,transform:v},"freeTextWriter",{}).getAnnotationConfig();b=O.style,S=O.transform}u&&function(O,j){const W=["rx","x","width","borderWidth","fontSize"],J=["ry","y","height"],K=["startPoint","endPoint"];Object.keys(O).forEach(Q=>{const ie=O[Q];if(W.includes(Q)||J.includes(Q)){const oe=ni(ie);O[Q]=j.toPixelPPI(oe.value,J.includes(Q))}else K.includes(Q)?O[Q]={x:j.toPixelPPI(ie.x,!1),y:j.toPixelPPI(ie.y,!0)}:"lineDash"===Q?O[Q]=ie.map(oe=>j.toPixelPPI(oe,!1)):"points"===Q?O[Q]=ie.map(oe=>({x:j.toPixelPPI(oe.x,!1),y:j.toPixelPPI(oe.y,!0)})):"segments"===Q?O[Q]=ie.map(oe=>oe.map(le=>({x:j.toPixelPPI(le.x,!1),y:j.toPixelPPI(le.y,!0)}))):"textContents"===Q&&(O[Q]=ie.map(oe=>Ht(qe({},oe),{fontSize:j.toPixelPPI(ni(oe.fontSize).value,!1)})))})}(b,u),"ellipse"===m&&(b.x+=b.width/2||0,b.y+=b.height/2||0,b.rx=b.width/2||b.rx,b.ry=b.height/2||b.ry),S&&null!==(g=S)&&void 0!==g&&g.position&&(S.position={x:u.toPixelPPI(S.position.x,!1),y:u.toPixelPPI(S.position.y,!0)});const I={id:l.uid,style:b,transform:S};let k;switch(m){case"rectangle":k=new r2(I);break;case"ellipse":k=new Pv(I);break;case"line":k=new Qx(I);break;case"ink":k=new Gd(I);break;case"polygon":k=new Kx(I);break;case"polyline":k=new Jx(I);break;case"textTypewriter":k=new or(I,"freeTextWriter",{},!1);break;case"textBox":k=new or(I,"textBox");break;case"stamp":k=new Kc(I);break;case"highlight":k=new jh(I,zd.HIGHLIGHT);break;case"underline":k=new jh(I,zd.UNDERLINE);break;case"strikeout":k=new jh(I,zd.STRIKEOUT);break;case"incomplete":k=new c5(I)}if(k instanceof Kc&&!k.style.imageData&&k.updateStampStyle({x:b.x,y:b.y,width:b.width,height:b.height}),["highlight","underline","strikeout","incomplete"].includes(m)){const{resolutionX:O,resolutionY:j}=u,{displayResolution:W}=Vn,J=O/W,K=j/W;k.setOrigin(0,0),k.scaleLocal(J,K)}return k}getAnnotationUidsByLayer(l){const u=this.annotationApp.annotationPageRepo.findPageByUid(l);return null==u?void 0:u.getAnnotationUidListByLayer()}}function iRe(p){return{annotationUid:p.uid,author:p.author,subject:p.subject,contents:p.contents,creationDate:p.creationDate,modificationDate:p.modifiedDate,markedStates:Ute(p.markedStates||[]),reviewStates:Ute(p.reviewStates||[])}}function Ute(p){return p.map(l=>({uid:l.uid,author:l.author,contents:l.contents,creationDate:l.creationDate,state:l.state}))}function Vte(p){if("stamp"===p.type){const l=new Kc({style:p.style,transform:p.transform}).getAnnotationConfig();p.style=l.style,p.transform=Ht(qe({},p.transform),{position:l.transform.position,scale:l.transform.scale})}}const rRe={install(p){const l=p.getClass("Viewer"),u=(f=l,class extends f{constructor(g){super(g),N(this,"annotationViewerContext",void 0),this.annotationViewerContext=this.register(new Y6e(this)),this.listenGlobalEventForAnnotation(),this.listenHooksForAnnotation(),this.listenNativeEventsForAnnotation(),this.context.hasAnnotationModule=!0,this.context.annotationEditService=this.register(new X6e(this.annotationViewerContext))}listenHooksForAnnotation(){const g=()=>{const m=this.getSelectedAnnotations();if(1!==m.length||!m[0])return;const v=this.getAnnotationObject(m[0].uid);v instanceof or&&v.isEditMode&&v.updateCursor()};this.hooks.scroll.on(m=>{this.context.isDefaultViewer&&g()}),this.hooks.resize.on(m=>{this.context.isDefaultViewer&&g()}),this.hooks.zoomChanged.on(m=>{this.context.isDefaultViewer&&g()}),this.hooks.pageChanged.on(m=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const v=this.getActiveTab();if(null!=v&&v.total){const _=v.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(_)}v&&"single"===v.context.displayMode&&this.annotationViewerContext.disableTextEditMode()}},this),this.hooks.currentPageChanged.on(m=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const v=this.getActiveTab();if(null!=v&&v.total){const _=v.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(_)}}},this)}listenGlobalEventForAnnotation(){if(!this.context.isDefaultViewer&&!this.context.isThumbnailViewer)return;const g=this.context.core.annotationService.annotationApp.hooks;g.annotationCreated.on(v=>{v.annotations.forEach(_=>{this.annotationViewerContext.addAnnotationByAnnotationData(_)}),this.context.render()},this),g.annotationDeleted.on(v=>{this.annotationViewerContext.deleteAnnotations(v.annotations.map(_=>_.uid),v.emitEvent),this.context.render()},this);let m=null;g.annotationUpdated.on(v=>{const _=v.updateDetails.map(b=>b.annotationUid);this.annotationViewerContext.updateAnnotations(_,v.updatedBy),this.hooks.annotationsUpdated.emit(new CF(_,v.updateActions)),m||(m=setTimeout(()=>{var b;null===(b=this.context)||void 0===b||b.render(),m=null},17))},this),g.bringFroward.on(v=>{this.annotationViewerContext.updateLayer([v.annotationUid,v.forwardUid]),this.context.render()},this),g.bringToFront.on(v=>{this.annotationViewerContext.updateLayer([v.annotationUid]),this.context.render()},this),g.sendBackward.on(v=>{this.annotationViewerContext.updateLayer([v.annotationUid,v.backwardUid]),this.context.render()},this),g.sendToBack.on(v=>{this.annotationViewerContext.updateLayer([v.annotationUid]),this.context.render()},this),g.restoreLayer.on(v=>{this.annotationViewerContext.updateLayer([v.annotationUid]),this.context.render()},this),g.annotationPageSwitched.on(v=>{this.annotationViewerContext.updateAnnotationPage(v.annotationUid,v.to.pageUid),this.context.render()},this)}listenNativeEventsForAnnotation(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&Xo(document,"click",this).on(g=>{this.getActiveTab()&&"visible"===this.context.viewerConfig.visibility&&(this.context.viewService.mainContainer.contains(null==g?void 0:g.target)||this.annotationViewerContext.disableTextEditMode())})}getAnnotationConfig(){return hn(this.annotationViewerContext.annotationController.interactiveConfig)}updateAnnotationConfig(g){this.annotationViewerContext.annotationConfigService.updateConfig(g)}selectAnnotations(g){return this.annotationViewerContext.selectAnnotations(g)}deleteAnnotations(g){this.context.core.annotationService.deleteAnnotations(g),this.context.render()}updateAnnotation(g,m,v){this.context.core.annotationService.updateAnnotations([{annotationUid:g,options:m}],void 0,v)}getSelectedAnnotations(){return this.annotationViewerContext.getSelectedAnnotations()}bringForward(g){return this.context.core.annotationService.bringForward(g)}bringToFront(g){return this.context.core.annotationService.bringToFront(g)}sendBackward(g){return this.context.core.annotationService.sendBackward(g)}sendToBack(g){return this.context.core.annotationService.sendToBack(g)}getAnnotationObject(g){return this.annotationViewerContext.annotationController.getShape(g)}copyAnnotations(g){g||(g=this.getSelectedAnnotations().map(m=>m.uid)),g.length&&this.context.core.annotationService.copyAnnotations(g)}cutAnnotations(g){g||(g=this.getSelectedAnnotations().map(m=>m.uid)),g.length&&this.context.core.annotationService.cutAnnotations(g)}pasteAnnotations(g,m){const v=this.context.getActiveTab();if(null==v||!v.total)return;const _=v.getCurrentPage();_&&this.context.core.annotationService.pasteAnnotations(g||v.uid,m||_.uid)}clearAnnotationClipboard(){this.context.core.annotationService.clearAnnotationClipboard()}});var f;p.setClass("Viewer",u)},apply(p){const l=new nRe(p);p.annotationService=l;const{pageService:f}=p;l.hooks.annotationCreated.on(g=>{g.annotations.forEach(m=>{const v=f.getPage(m.pageUid);v&&v.annotations.push(m.uid)})},f),l.hooks.annotationDeleted.on(g=>{g.annotations.forEach(m=>{const v=f.getPage(m.pageUid);if(v){const _=v.annotations.indexOf(m.uid);v.annotations.splice(_,1)}})},f),l.hooks.annotationPageSwitched.on(g=>{const m=f.getPage(g.from.pageUid),v=f.getPage(g.to.pageUid);if(m){const _=m.annotations.indexOf(g.annotationUid);m.annotations.splice(_,1)}v&&v.annotations.push(g.annotationUid)},f)}};class oRe{perspective(l,u,f,g){return Fe(function*(){var m;const v=new Ng,_=yield v.initImage({source:l.data,isRGBA:l.type===Tr.RGBA,width:l.width,height:l.height,isBGRA:l.type===Tr.BGRA});_.srcBuffer&&(l.data=_.srcBuffer),null!=f&&f.angle&&(yield v.rotate({angle:f.angle})),yield v.perspective(u);const b=yield v.getImage({jpegQuality:null==g?void 0:g.jpegQuality,ifDeleteObject:!0,isRGBA:l.type===Tr.RGBA,bitDepth:null==g?void 0:g.bitDepth,xDpi:null==g?void 0:g.xdpi,yDpi:null==g?void 0:g.ydpi,returnBlob:!1,returnType:Bx[null!==(m=null==g?void 0:g.outputType)&&void 0!==m?m:l.type]});yield v.freeReservedData();const S={data:new Blob([b.imageData],{type:b.blobType}),width:b.imageWidth,height:b.imageHeight,resolutionX:b.imageXResolution,resolutionY:b.imageYResolution};return v.terminate(),S})()}}var $v=new WeakMap,pD=new WeakMap,gD=new WeakSet;function sRe(p,l,u,f){return(new oRe).perspective(p,l,u,f)}function aRe(p){return Ye($v,this).push(p),Ye(pD,this)||(Bn(pD,this,!0),at(gD,this,lRe).call(this)),p.promise}function lRe(){return CL.apply(this,arguments)}function CL(){return CL=Fe(function*(){do{if(Ye($v,this).isEmpty())break;const p=Ye($v,this).pop();try{let l;"perspective"===(null==p?void 0:p.api)&&(l=yield at(gD,this,sRe).apply(this,p.params)),null==p||p.resolve(l)}catch(l){p.retry<1?(p.retry+=1,Ye($v,this).push(p)):null==p||p.reject(l)}}while(!Ye($v,this).isEmpty());Bn(pD,this,!1)}),CL.apply(this,arguments)}Uv.registerPlugin(EPe),Uv.registerPlugin(a6e),Uv.registerPlugin(m6e),Uv.registerPlugin(C6e),Uv.registerPlugin(rRe),Uv.registerPlugin(KPe);const Br=new Uv(new class{constructor(){this.registerParser("image/jpeg",s2),this.registerParser("image/bmp",s2),this.registerParser("image/png",s2),this.registerParser("image/tiff",L2e),this.registerParser("image/jp2",s2),this.registerParser("application/pdf",Y2e),this.registerParser("image/rgba",X2e),this.registerParser("application/ddv-blank-image",sDe)}dispose(){this.reset()}reset(){F_.getAllParsers().forEach(p=>p.destroy()),F_.clear(),tw.clear()}freeParserByFileUid(p){q2e.execute(p)}registerParser(p,l){Q2e.execute({mime:p,parser:l})}unregisterParser(p){Z2e.execute(p)}registerCustomParser(p,l){eDe.execute({mime:p,parser:l})}unregisterCustomParser(p){tDe.execute(p)}getDefaultParserOptions(p){return nDe.execute(p)}setDefaultParserOptions(p,l){return iDe.execute({mime:p,options:l})}getCustomParserClasses(p){return rDe.execute(p)}parse(p,l,u,f,g){return Fe(function*(){return J2e.execute({fileData:p,mime:l,fileUid:u,indices:f,parseOptions:g})})()}getPage(p,l,u,f){return Fe(function*(){return K2e.execute({fileData:p,mime:l,fileUid:u,fileIndex:f})})()}cancelGetPage(p,l){$2e.execute({fileUid:p,fileIndex:l})}getParseInfo(p,l,u,f){return Fe(function*(){return oDe.execute({fileData:p,mime:l,fileUid:u,options:f})})()}},new class{constructor(){this.registerSaver("application/pdf",QIe),this.registerSaver("image/png",sQ),this.registerSaver("image/jpeg",sQ),this.registerSaver("image/tiff",ZIe)}registerSaver(p,l){KIe.execute({mime:p,saverConstructor:l})}unregisterSaver(p){JIe.execute(p)}getSaver(p){return qIe.execute(p)}},new class{constructor(){al(this,gD),bi(this,$v,new rQ),bi(this,pD,!1)}dispose(){throw new Error("Method not implemented.")}perspective(p,l,u,f){return this.createTask("perspective",[p,l,u,f])}createTask(p,l){const u={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const f of l)u.params.push(f);return u.promise=new Promise((f,g)=>{u.resolve=f,u.reject=g}),at(gD,this,aRe).call(this,u)}cancelTask(p,l){const u={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const f of l)u.params.push(f);Ye($v,this).remove(u)}},new class{constructor(){al(this,m2),N(this,"filter",void 0),bi(this,Nv,new rQ),bi(this,g2,!1)}get enableFilter(){return!!this.filter}applyFilter(p,l,u,f){var g=this;return Fe(function*(){return g.createTask("filter",[p,l,u,f])})()}cancelFilter(p,l){}setImageFilter(p){p?this.filter=p:this.filter&&(this.filter.destroy(),this.filter=null)}getDefaultFilterType(){var p;return(null===(p=this.filter)||void 0===p?void 0:p.defaultFilterType)||Ys.NONE}getSupportedFilters(){var p;return(null===(p=this.filter)||void 0===p?void 0:p.querySupported())||[]}createTask(p,l){const u={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const f of l)u.params.push(f);return u.promise=new Promise((f,g)=>{u.resolve=f,u.reject=g}),at(m2,this,pDe).call(this,u)}cancelTask(p,l){const u={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const f of l)u.params.push(f);Ye(Nv,this).remove(u)}},new class{constructor(){N(this,"detector",void 0)}get enableDetect(){return this.detector&&this.detector instanceof _Z}detect(p,l){var u;return null===(u=this.detector)||void 0===u?void 0:u.detect(p,l)}setDetector(p){p?this.detector=p:this.detector&&(this.detector.destroy(),this.detector=null)}resetDetector(){this.detector&&this.detector.reset()}reset(){var p;null===(p=this.detector)||void 0===p||p.destroy(),this.detector=null}});function Cn(p,l,u,f){return!!pt(p)&&gt.output(l,u,f,void 0,it.PARAM_MISS,!0)}function e1(p,l,u,f){return!!Un(p)||gt.output(l,u,f,void 0,it.PARAM_INVALID)}class Sn{static getTooltip(){return pl.getTooltip()}static setTooltip(l){const u="Elements.setTooltip",f="tooltip";return!(Cn(l,1,u,f)||!e1(l,1,u,f)||(pl.setTooltip(l),0))}static getDisplayTextConfig(){return pl.getDisplayTextConfig()}static setDisplayTextConfig(l){const u="Elements.displayTextConfig",f="displayTextConfig";return!(Cn(l,1,u,f)||!e1(l,1,u,f)||(pl.setDisplayTextConfig(l),0))}static get Layout(){return"Layout"}static get Button(){return"Button"}static get Capture(){return"Capture"}static get Flashlight(){return"Flashlight"}static get CameraConvert(){return"CameraConvert"}static get CameraResolution(){return"CameraResolution"}static get AutoDetect(){return"AutoDetect"}static get AutoCapture(){return"AutoCapture"}static get ImagePreview(){return"ImagePreview"}static get Rotate(){return"Rotate"}static get RotateLeft(){return"RotateLeft"}static get RotateRight(){return"RotateRight"}static get Delete(){return"Delete"}static get DeleteCurrent(){return"DeleteCurrent"}static get DeleteAll(){return"DeleteAll"}static get Zoom(){return"Zoom"}static get ZoomIn(){return"ZoomIn"}static get ZoomOut(){return"ZoomOut"}static get ZoomByPercentage(){return"ZoomByPercentage"}static get Crop(){return"Crop"}static get CropCurrent(){return"CropCurrent"}static get CropAll(){return"CropAll"}static get FullQuad(){return"FullQuad"}static get PerspectiveAll(){return"PerspectiveAll"}static get Undo(){return"Undo"}static get Redo(){return"Redo"}static get Pan(){return"Pan"}static get CropMode(){return"CropMode"}static get Load(){return"Load"}static get Download(){return"Download"}static get Print(){return"Print"}static get Filter(){return"Filter"}static get Restore(){return"Restore"}static get ThumbnailSwitch(){return"ThumbnailSwitch"}static get Pagination(){return"Pagination"}static get FitMode(){return"FitMode"}static get FitWindow(){return"FitWindow"}static get FitHeight(){return"FitHeight"}static get FitWidth(){return"FitWidth"}static get ActualSize(){return"ActualSize"}static get DisplayMode(){return"DisplayMode"}static get SinglePage(){return"SinglePage"}static get ContinuousPage(){return"ContinuousPage"}static get MainView(){return"MainView"}static get SeparatorLine(){return"SeparatorLine"}static get Done(){return"Done"}static get Back(){return"Back"}static get Blank(){return"Blank"}static get Close(){return"Close"}static get AnnotationSet(){return"AnnotationSet"}static get EllipseAnnotation(){return"EllipseAnnotation"}static get EraseAnnotation(){return"EraseAnnotation"}static get InkAnnotation(){return"InkAnnotation"}static get LineAnnotation(){return"LineAnnotation"}static get PolygonAnnotation(){return"PolygonAnnotation"}static get PolylineAnnotation(){return"PolylineAnnotation"}static get RectAnnotation(){return"RectAnnotation"}static get SelectAnnotation(){return"SelectAnnotation"}static get StampIconAnnotation(){return"StampIconAnnotation"}static get StampImageAnnotation(){return"StampImageAnnotation"}static get TextBoxAnnotation(){return"TextBoxAnnotation"}static get TextTypewriterAnnotation(){return"TextTypewriterAnnotation"}static get BringForward(){return"BringForward"}static get BringToFront(){return"BringToFront"}static get SendBackward(){return"SendBackward"}static get SendToBack(){return"SendToBack"}}const jte={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-capture-viewer-header-mobile",children:[{type:"CameraResolution",className:"ddv-capture-viewer-resolution"},Sn.Flashlight]},Sn.MainView,{type:"Layout",className:"ddv-capture-viewer-footer-mobile",children:[Sn.AutoDetect,Sn.AutoCapture,{type:"Capture",className:"ddv-capture-viewer-captureButton"},Sn.ImagePreview,Sn.CameraConvert]}]},bL={type:"Layout",flexDirection:"column",className:"ddv-edit-viewer-mobile",children:[{type:"Layout",className:"ddv-edit-viewer-header-mobile",children:[Sn.Blank,Sn.Pagination,Sn.Download]},Sn.MainView,{type:"Layout",className:"ddv-edit-viewer-footer-mobile",children:[Sn.DisplayMode,Sn.RotateLeft,Sn.Crop,Sn.Filter,Sn.Undo,Sn.Delete,Sn.Load]}]},Hte={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-mobile",children:[Sn.Blank,Sn.Pagination,Sn.PerspectiveAll]},Sn.MainView,{type:"Layout",className:"ddv-perspective-viewer-footer-mobile",children:[Sn.FullQuad,Sn.RotateLeft,Sn.RotateRight,Sn.DeleteCurrent,Sn.DeleteAll]}]},Gte={type:"Layout",flexDirection:"column",className:"ddv-capture-viewer-desktop",children:[{type:"Layout",className:"ddv-capture-viewer-header-desktop",children:[{type:Sn.CameraResolution,className:"ddv-capture-viewer-resolution-desktop"},Sn.AutoDetect,{type:Sn.Capture,className:"ddv-capture-viewer-capture-desktop"},Sn.AutoCapture]},Sn.MainView,{type:Sn.ImagePreview,className:"ddv-capture-viewer-image-preview-desktop"}]},zte={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-desktop",children:[Sn.FullQuad,Sn.RotateLeft,Sn.RotateRight,Sn.DeleteCurrent,Sn.DeleteAll,{type:Sn.Pagination,className:"ddv-perspective-viewer-pagination-desktop"},{type:Sn.PerspectiveAll,className:"ddv-perspective-viewer-perspective-desktop"}]},Sn.MainView]},xL={type:Sn.Layout,flexDirection:"column",className:"ddv-edit-viewer-desktop",children:[{type:Sn.Layout,className:"ddv-edit-viewer-header-desktop",children:[{type:Sn.Layout,children:[Sn.ThumbnailSwitch,Sn.Zoom,Sn.FitMode,Sn.DisplayMode,Sn.RotateLeft,Sn.RotateRight,Sn.Crop,Sn.Filter,Sn.Undo,Sn.Redo,Sn.DeleteCurrent,Sn.DeleteAll,Sn.Pan]},{type:Sn.Layout,children:[{type:Sn.Pagination,className:"ddv-edit-viewer-pagination-desktop"},Sn.Load,Sn.Download,Sn.Print]}]},Sn.MainView]},mD={type:Sn.Layout,children:[Sn.MainView]},Yte=hn(bL);Yte.children[0].children=[Sn.Blank,Sn.Blank,Sn.Pagination,Sn.AnnotationSet,Sn.Download];const wL=hn(xL);var Ri,la;wL.children[0].children[0].enableScroll=!0,wL.children[0].children[0].children.push(Sn.SeparatorLine,Sn.AnnotationSet),function(p){p.REJECTED="rejected",p.ACCEPTED="accepted",p.INITIAL_HERE="initialHere",p.SIGN_HERE="signHere",p.WITNESS="witness",p.APPROVED="approved",p.NOT_APPROVED="notApproved",p.DRAFT="draft",p.FINAL="final",p.COMPLETED="completed",p.CONFIDENTIAL="confidential",p.VOID="void"}(Ri||(Ri={})),function(p){p.NONE="none",p.OPEN="open",p.OPEN_REVERSE="openReverse",p.CLOSED="closed",p.CLOSED_REVERSE="closedReverse",p.BUTT="butt",p.SLASH="slash",p.SQUARE="square",p.DIAMOND="diamond",p.CIRCLE="circle"}(la||(la={}));const vD={background:"#e2e1de"},Xte={border:"1px solid #707070",background:"#fff"},SL={border:"2px solid #fe8e14",background:"rgba(255,255,255,0)",maskColor:"rgba(128,128,128,0.6)",ctrlBorderRadius:"50%",ctrlBackground:"#fe8e14",ctrlBorder:"2px solid #fe8e14",ctrlWidth:"15px",ctrlHeight:"15px",invalidCtrlBorderColor:"red",invalidBorderColor:"red"},t1={opacity:1,borderWidth:1,borderColor:"rgb(0,0,0)",background:"",lineDash:[0,0]},TL={content:"",color:"rgb(0,0,0)",fontSize:16,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1},$te={content:"",color:"rgb(0,0,0)",fontSize:1536/72,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1};ir()&&(t1.borderWidth=3,TL.fontSize=72);const qte=Ht(qe({},t1),{lineEnding:{start:la.NONE,end:la.NONE}}),n1={paletteConfig:{maxFontSize:256,maxBorderWidth:40,colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#ffffff","#CECECE"],labels:{text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"StandardBusiness"}},toolbarConfig:{},annotationSelectionStyle:{border:"1px solid #59626A",background:"",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},inkCreateDelay:1e3,showOnTopWhenSelected:!1,enableContinuousDrawing:!1,defaultStyleConfig:{rectangle:qe({},t1),ellipse:qe({},t1),polygon:qe({},t1),polyline:qe({},qte),line:qe({},qte),ink:{opacity:1,borderWidth:ir()?3:1,borderColor:"rgb(0,0,0)"},textBox:Ht(qe({},t1),{textAlign:"left",textContent:qe({},TL)}),textTypewriter:{opacity:1,textContent:qe({},TL)},stamp:{opacity:1,stamp:Ri.DRAFT}}},bke={canvasStyle:qe({},vD),quadSelectionStyle:qe({},SL),enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:80};function Qo(p,l){return!!p.getActiveTab()||gt.output(l,void 0,void 0,void 0,it.DOC_NOT_OPEN)}function hc(p,l,u,f){return!u.getActiveTab().doc.pages.length&&gt.output(f,p,l,void 0,it.DOC_NO_IMAGE,!0)}function i1(p,l,u,f){return!(!Xt(g=p)||Xt(g)&&!Number.isInteger(g))||gt.output(f,l,u,void 0,it.PARAM_INVALID);var g}function Kte(p,l,u,f,g){const m=_o.isUiConfigValid(p,f);if(m.length>0)return gt.output(g,u,f,m);const v=Tne(p,l);return!v||gt.output(g,l.charAt(0).toUpperCase()+l.slice(1),v,void 0,it.ELEMENT_UNSUPPORTED)}function r1(p,l,u,f,g,m){return(p<l||p>u)&&gt.output(f,g,m,void 0,it.PARAM_OUT_OF_RANGE,!0)}function yD(p,l,u,f){return!!p.includes(l)||gt.output(u,f,void 0,void 0,it.PAGE_NOT_EXIST)}function ef(p,l,u,f){return!!v_(p)||gt.output(f,l,u,void 0,it.PARAM_INVALID)}function ar(p,l,u,f,g){const m=gt.formatError(gt.isStringAndNotEmpty(p,g));return!m||gt.output(l,u,f,void 0,m)}function Tp(p,l,u,f,g,m,v){const _=_o.isNumberArrayValid(p,g,m,v);return!_.length||gt.output(l,u,f,_,it.PARAM_INVALID)}class _D{getIsBoundContainer(l){return l.context.viewService.isBindContainer}bindContainer(l,u,f){Cn(u,0,f,"container");const g=_o.isContainerParamValid(u);g&&gt.error(f,"container",void 0,g),l.bindContainer(u)}unbindContainer(l){l.unbindContainer()}getIsVisible(l){return"visible"===l.getViewerConfig().visibility}show(l){l.show()}hide(l){l.hide()}getCurrentDocument(l){var u;const f=null===(u=l.getActiveTab())||void 0===u?void 0:u.uid;return f?Fne.getDocument(f):null}openDocument(l,u,f){const g="docUid or doc";var v;Cn(l,0,f,g),xn(v=l)&&0!==v.trim().length||Un(l)||gt.error(f,g,void 0,it.PARAM_INVALID);const m=Un(l)?l.uid:l;(function(v,_,b,S,I){v.getDocument(_)||gt.output(0,S,"docUid or doc",void 0,it.DOC_NOT_EXIST)})(Br.documentService,m,0,f),Br.getViewer(u)||gt.error(f,"viewerUid",void 0,it.PARAM_INVALID),Br.openDocument(m,u)}closeDocument(l,u){return!!Qo(l,1)&&(l.closeDocument(),!0)}getStyle(l,u,f,g,m){const v="styleName";if(Cn(f,1,m,v)||!ar(f,1,m,v))return null;if(!g.includes(f))return gt.warning(m,v,void 0,it.PARAM_NOT_SUPPORT),null;if("annotationSelectionStyle"===f)return l.getAnnotationConfig().controlsStyle;const _=l.getViewerConfig();if(f in _){const b=function(S,I){const k=["border","background"],O=["left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY","opacity","visibility"],j={pageStyle:k,selectedPageStyle:k,hoveredPageStyle:k,canvasStyle:[...k,"cursor"],checkboxStyle:[...O,"checkMarkColor","checkMarkLineWidth"],pageNumberStyle:[...O,"color","fontSize","fontFamily","onPage"],quadSelectionStyle:["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"]};if(S in j){const W=j[S];return Object.fromEntries(Object.entries(I).filter(J=>{let[K,Q]=J;return W.includes(K)}))}return hn(I)}(f,_[f]);return"capture"===u&&"quadSelectionStyle"===f?{border:b.border,background:b.background}:b}return null}updateStyle(l,u,f,g,m){return!(Cn(u,1,m,"styleName")||Cn(f,1,m,"style")||!ar(u,1,m,"styleName")||!e1(f,1,m,"style")||!function(v,_,b,S,I,k){if(!ar(v,1,S,I))return!1;if(!b.includes(v))return gt.output(1,S,I,void 0,it.PARAM_NOT_SUPPORT);const O=Ene(v,_);return!O.length||gt.output(1,S,"style",O)}(u,f,g,m,"styleName")||("annotationSelectionStyle"===u?(l.updateAnnotationConfig({controlsStyle:f}),0):(l.updateViewerConfig({[u]:f}),0)))}getUiConfig(l){return l.getUiConfig()}updateUiConfig(l,u,f,g){const m="uiConfig";return!(Cn(u,1,g,m)||!Kte(u,f,g,m,1))&&l.updateUiConfig(u)}indexToUid(l,u,f){const g="index";return Cn(u,1,f,g)||!i1(u,f,g,1)||!Qo(l,1)||hc(void 0,void 0,l,1)||r1(u,0,l.getPageCounts()-1,1,f,g)?"":l.indexToUid(u)}uidToIndex(l,u,f){return Cn(u,1,f,"uid")||!ar(u,1,f,"uid",!1)||!Qo(l,1)||hc(void 0,void 0,l,1)?-1:yD(this.getCurrentDocument(l).pages,u,1,f)?l.uidToIndex(u):-1}getCurrentPageUid(l){return Qo(l,1)?hc(void 0,void 0,l,1)?"":l.getCurrentPageUid():""}getCurrentPageIndex(l){return Qo(l,1)?hc(void 0,void 0,l,1)?-1:l.getCurrentPageIndex():-1}getPageCount(l){return Qo(l,1)?l.getPageCounts():-1}gotoPage(l,u,f){const g="index";return Cn(u,1,f,g)||!i1(u,f,g,1)||!Qo(l,1)||hc(void 0,void 0,l,1)||r1(u,0,l.getPageCounts()-1,1,f,g)?-1:l.gotoPage(u)}rotate(l,u,f,g){return!(Cn(u,1,g,"angle")||!i1(u,g,"angle",1)||(m=u,v=g,m%90!=0&&!gt.output(1,v,"angle",void 0,it.PARAM_NOT_SUPPORT))||!Qo(l,1)||hc(void 0,void 0,l,1)||!pt(f)&&!Tp(f,1,g,"indices",0,this.getPageCount(l)-1))&&l.rotatePages(u,f);var m,v}saveOperation(l){return!!Qo(l,1)&&l.saveOperations()}on(l,u,f,g){!Cn(f,1,u,"eventName")&&!Cn(g,1,u,"listener")&&ar(f,1,u,"eventName",!1)&&ef(g,u,"listener",1)&&l.on(f,g)}off(l,u,f,g){!Cn(f,1,u,"eventName")&&ar(f,1,u,"eventName",!1)&&(pt(g)||ef(g,u,"listener",1))&&l.off(f,g)}destroy(l){l&&l.dispose()}}function IL(p,l,u,f){return!!Ds(p)||gt.output(f,l,u,void 0,it.PARAM_INVALID)}function Jd(p,l,u,f,g,m){const v=gt.formatError(gt.isNumberAndIsInRange(p,g,m));return!v||gt.output(l,u,f,void 0,v)}function Iw(p,l,u,f,g){if(!Un(p))return gt.output(u,f,g,void 0,it.PARAM_INVALID);const m=[],v=["pageStyle","hoveredPageStyle","selectedPageStyle","currentPageStyle","placeholderStyle","canvasStyle","pageNumberStyle","checkboxStyle","quadSelectionStyle"];return Object.keys(p).forEach(_=>{const b=p[_];if("container"===_)m.push(..._o.isContainerKeyValid(b,g));else if("uiConfig"===_){const S=_o.isUiConfigValid(b,"option.uiConfig");if(S.length>0)m.push(...S);else{const I=Tne(b,l);if(I){const k=it.buildError(it.ELEMENT_UNSUPPORTED,l.charAt(0).toUpperCase()+l.slice(1),I);m.push(`option.uiConfig: ${k.message}`)}}}else"viewerConfig"!==_&&"thumbnailConfig"!==_||Object.keys(b).forEach(S=>{const I=b[S];if(v.includes(S)){const k=Ene(S,I);m.push(...k.map(O=>`${_}.${O}`))}})}),!(m.length>0)||gt.output(u,f,g,m)}const Jte=["canvasStyle","quadSelectionStyle"],Ul="CaptureViewer";var Si=new WeakMap,ja=new WeakMap,Qte=new WeakSet;function wke(){Ye(Si,this).hooks.destroy.on(()=>{Bn(Si,this,null),Object.setPrototypeOf(this,null)})}const Zte={canvasStyle:qe({},vD),currentPageStyle:{border:"4px solid #fe8e14"},pageStyle:{border:"6px solid rgba(0,0,0,0)",background:"rgba(255,255,255,0)"},selectedPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},hoveredPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},placeholderStyle:{border:"6px solid rgba(136,136,136,0.2)",background:"rgba(136,136,136,0.2)"},pageNumberStyle:{onPage:!1,visibility:"visible",width:"32px",height:"24px",background:"rgba(255,255,255,0)",border:"0px solid #000",borderRadius:"0px",opacity:1,color:"#323234",fontSize:"14px",fontFamily:"Open Sans",left:"50%",top:"",right:"",bottom:"3px",translateX:"-50%",translateY:"0px"},checkboxStyle:{visibility:"visible",width:"16px",height:"16px",background:"#fff",border:"2px solid #999999",borderRadius:"0px",opacity:1,left:"2px",top:"2px",checkMarkColor:"#FE8E14",checkMarkLineWidth:"2px",translateX:"0px",translateY:"0px"},rows:2,columns:2,multiselectMode:!1,scrollToLatest:!1,enableDragPage:!0,scrollDirection:"vertical"},Ske=Ht(qe({},Zte),{visibility:"hidden",size:"180px",position:"left",rows:4,columns:1,canvasStyle:{background:"#DDDDDD"}}),Tke={canvasStyle:qe({},vD),pageStyle:qe({},Xte),quadSelectionStyle:qe({},SL),currentPageStyle:{border:"",background:""},minZoom:.01,maxZoom:64,scrollDirection:"vertical",enableSlide:!0,scrollToLatest:!1},ene=["canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle"];var tne=new WeakSet;class nne{constructor(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"BaseBrowseViewer";al(this,tne),N(this,"v",void 0),N(this,"vCommon",new _D),N(this,"uid",void 0),N(this,"groupUid",void 0),N(this,"postfix",void 0),N(this,"errorPrefix",void 0),this.errorPrefix=u;const f=`new ${this.errorPrefix}`;xi.makeSureCoreLicenseExist(),pt(l)||Iw(l,"browseViewer",0,f,"option");const g=yo((null==l?void 0:l.viewerConfig)||{},hn(Ht(qe({},Zte),{viewerMode:qo.THUMBNAIL,displayMode:"multiple",toolMode:"pan",enableOptimizePage:!0})));this.v=Br.createViewer(Ht(qe({uiConfig:hn(mD)},l),{viewerConfig:g})),this.uid=this.v.uid,this.groupUid=this.v.groupUid,this.postfix=this.v.postfix,at(tne,this,Ike).call(this)}get isVisible(){return this.vCommon.getIsVisible(this.v)}get isBoundContainer(){return this.vCommon.getIsBoundContainer(this.v)}set multiselectMode(l){const u="multiselectMode";IL(l,`${this.errorPrefix}.${u}`,u,1)&&this.v.updateViewerConfig({multiselectMode:l})}get multiselectMode(){return this.v.getViewerConfig().multiselectMode}show(){this.vCommon.show(this.v)}hide(){this.vCommon.hide(this.v)}getUiConfig(){return this.vCommon.getUiConfig(this.v)}updateUiConfig(l){return this.vCommon.updateUiConfig(this.v,l,"browseViewer",`${this.errorPrefix}.updateUiConfig`)}getStyle(l){return this.vCommon.getStyle(this.v,"browse",l,ene,`${this.errorPrefix}.getStyle`)}updateStyle(l,u){return this.vCommon.updateStyle(this.v,l,u,ene,`${this.errorPrefix}.updateStyle`)}getSelectedPageIndices(){return Qo(this.v,1)?this.v.getSelectedPageIndices():[]}selectAllPages(){return Qo(this.v,1)?0===this.v.getPageCounts()?(gt.output(1,`${this.errorPrefix}.selectAllPages`,void 0,void 0,it.DOC_NO_IMAGE),[]):this.v.selectAllPages():[]}selectPages(l){const u=`${this.errorPrefix}.selectPages`,f="indices";return Cn(l,1,u,f)||!Qo(this.v,1)?[]:Tp(l,1,u,f,0,this.v.getPageCounts()-1)?this.v.selectPagesByIndices(l):[]}setRowAndColumn(l,u){const f=`${this.errorPrefix}.setRowAndColumn`,g="row",m="column",{maxColumns:v,maxRows:_}=this.v.getViewerConfig();return!(Cn(l,1,f,g)||Cn(u,1,f,m)||!i1(l,f,g,1)||!i1(u,f,m,1)||r1(l,1,_,1,f,g)||r1(u,1,v,1,f,m))&&this.v.setRowAndColumn(l,u)}on(l,u){this.vCommon.on(this.v,`${this.errorPrefix}.on`,l,u)}off(l,u){this.vCommon.off(this.v,`${this.errorPrefix}.off`,l,u)}}function Ike(){this.v.hooks.destroy.on(()=>{this.v=null,Object.setPrototypeOf(this,null)})}function EL(p,l,u,f,g){const m=_o.isAnnotationOptionsValid(p,f,g);return!m.length||gt.output(l,u,f,m)}const qv={borderColor:"rgb(0,0,0)",background:"",borderWidth:1,opacity:1,lineDash:[0,0],flags:{print:!0,noView:!1,readOnly:!1},rotation:0};var o1=new WeakMap;class Qg{constructor(l){N(this,"uid",null),N(this,"creationDate",""),N(this,"modificationDate",""),bi(this,o1,void 0),Bn(o1,this,l),this.uid=Ai(),this.creationDate=ac(),this.modificationDate=this.creationDate}get type(){return null}get pageUid(){const l=Br.annotationService.annotationApp.getAnnotationByUid(this.uid);return l?l.pageUid:""}getOptions(){const l=Br.annotationService.annotationApp.getAnnotationByUid(this.uid);if(l){const u=l.getConfig(),f=Ew(u,this.type);Bn(o1,this,qe({},f)),this.modificationDate=u.comment.modificationDate}return bD(this.type,Ye(o1,this))}updateOptions(l){const u="Annotation.updateOptions";if(Cn(l,1,u,"options")||!e1(l,1,u,"options")||!EL(l,1,u,"options",this.type))return!1;const f=this.getOptions(),g=ine(this.type,l,f);if(!["rectangle","stamp","ellipse","textBox","ink"].includes(this.type)&&g.has("rotated")&&g.delete("rotated"),!g.size)return!0;this.getOptions(),yo(l,Ye(o1,this));const m=DL(qe({},Ye(o1,this)),this.type);return Br.annotationService.updateAnnotations([{annotationUid:this.uid,options:m}],void 0,[...g]),!0}}function ine(p,l,u){const f="moved",g="resized",m="startPoint",v="endPoint",_=new Map([[["x","y"],"moved"],[["width","height"],"resized"],[["rotation"],"rotated"],[["flags"],"flagsChanged"],[["borderWidth","borderColor","background","opacity","textAlign","lineCap","lineJoin","miterLimit","lineDash","lineEnding","textContents"],"appearanceChanged"],[["textContents","stamp"],"contentChanged"]]),b=hn(l);b.flags=qe(qe({},u.flags),(null==b?void 0:b.flags)||{}),["line","polyline"].includes(p)&&l.lineEnding&&(b.lineEnding=qe(qe({},u.lineEnding),(null==b?void 0:b.lineEnding)||{}));const S=new Set,I=Object.keys(b);return I.forEach(k=>{if(!OL(u[k],b[k]))if("points"!==k||"ink"!==p&&"polygon"!==p&&"polyline"!==p)if(k!==m&&k!==v||"line"!==p)for(const[O,j]of _)O.includes(k)&&!S.has(j)&&S.add(j);else I.includes(m)&&I.includes(v)&&Ane([u[m],u[v]],[b[m],b[v]])?S.add(f):S.add(g);else Ane(u[k],b[k])?S.add(f):S.add(g)}),S}function DL(p,l){const u=hn(p),f={style:u,flags:[],transform:{angle:0}},{lineEnding:g,points:m,textContents:v,stamp:_,borderWidth:b,x:S,y:I,width:k,height:O,startPoint:j,endPoint:W,lineDash:J}=u||{},K=Vn.dataResolution,Q=Vn.displayResolution;if(m&&("ink"===l?f.style.segments=sne(m,K,Q):f.style.points=one(m,K,Q)),g&&(f.style.lineEnding=AL(g,"date")),_&&(f.style.imageData=null,_ instanceof Blob||xn(_)&&xne(_)?f.style.imageData=_:xn(_)&&(f.style.iconName=CD(_,"date"))),pt(b)||(f.style.borderWidth=Kn(b,K,Q)),pt(S)||(f.style.x=Kn(S,K,Q)),pt(I)||(f.style.y=Kn(I,K,Q)),pt(k)||(f.style.width=Kn(k,K,Q)),pt(O)||(f.style.height=Kn(O,K,Q)),pt(J)||(f.style.lineDash=Kn(J,K,Q)),pt(j)||(f.style.startPoint=Kn(j,K,Q)),pt(W)||(f.style.endPoint=Kn(W,K,Q)),v){const ie=[];v.forEach(oe=>{null!=oe&&oe.fontSize&&(oe.fontSize=Kn(oe.fontSize,K,Q)),xn(oe.fontFamily)&&""===(null==oe?void 0:oe.fontFamily.trim())&&(oe.fontFamily="Helvetica"),ie.push(qe(qe({},$te),oe))}),f.style.textContents=ie}return Xt(p.rotation)&&["rectangle","stamp","ellipse","textBox","ink"].includes(l)&&(f.transform.angle=p.rotation),p.flags&&(p.flags.print&&f.flags.push("print"),p.flags.noView&&f.flags.push("noView"),p.flags.readOnly&&f.flags.push("readOnly")),f}function Ew(p,l){var u,f,g,m,v,_,b;const{lineEnding:S,iconName:I,imageData:k,segments:O,textContents:j,borderWidth:W,x:J,y:K,width:Q,height:ie,startPoint:oe,endPoint:le,lineDash:he,points:_e}=(null==p?void 0:p.style)||{},Ve=Vn.displayResolution,ee=Vn.dataResolution;if(_e&&(p.style.points=one(_e,Ve,ee)),O&&"ink"===l&&(p.style.points=sne(O,Ve,ee),delete p.style.segments),S&&(p.style.lineEnding=AL(S,"user")),(k||I)&&(p.style.stamp=k||CD(I,"user"),delete p.style.iconName,delete p.style.imageData),pt(W)||(p.style.borderWidth=Kn(W,Ve,ee)),pt(J)||(p.style.x=Kn(J,Ve,ee)),pt(K)||(p.style.y=Kn(K,Ve,ee)),pt(Q)||(p.style.width=Kn(Q,Ve,ee)),pt(ie)||(p.style.height=Kn(ie,Ve,ee)),pt(oe)||(p.style.startPoint=Kn(oe,Ve,ee)),pt(le)||(p.style.endPoint=Kn(le,Ve,ee)),pt(he)||(p.style.lineDash=Kn(he,Ve,ee)),j){const ke=[];j.forEach(xe=>{null!=xe&&xe.fontSize&&(xe.fontSize=Kn(xe.fontSize,Ve,ee)),xn(xe.fontFamily)&&""===(null==xe?void 0:xe.fontFamily.trim())&&(xe.fontFamily="Helvetica"),ke.push(qe(qe({},$te),xe))}),p.style.textContents=ke}return null===(u=p.style)||void 0===u||delete u.lineJoin,null===(f=p.style)||void 0===f||delete f.lineCap,null===(g=p.style)||void 0===g||delete g.miterLimit,Ht(qe({},p.style),{rotation:(null===(m=p.transform)||void 0===m?void 0:m.angle)||0,flags:{print:!(null===(v=p.flags)||void 0===v||!v.includes("print")),noView:!(null===(_=p.flags)||void 0===_||!_.includes("noView")),readOnly:!(null===(b=p.flags)||void 0===b||!b.includes("readOnly"))}})}function AL(p,l){const u={None:la.NONE,OpenArrow:la.OPEN,ROpenArrow:la.OPEN_REVERSE,ClosedArrow:la.CLOSED,RClosedArrow:la.CLOSED_REVERSE,Butt:la.BUTT,Slash:la.SLASH,Square:la.SQUARE,Diamond:la.DIAMOND,Circle:la.CIRCLE};if("user"===l){const[f,g]=p;return{start:u[f],end:u[g]}}return[ML(u,p.start)[0]||"None",ML(u,p.end)[0]||"None"]}function CD(p,l){const u={[Ri.REJECTED]:Pi.REJECTED,[Ri.ACCEPTED]:Pi.ACCEPTED,[Ri.INITIAL_HERE]:Pi.INITIAL_HERE,[Ri.SIGN_HERE]:Pi.SIGN_HERE,[Ri.WITNESS]:Pi.WITNESS,[Ri.APPROVED]:Pi.APPROVED,[Ri.NOT_APPROVED]:Pi.NOT_APPROVED,[Ri.DRAFT]:Pi.DRAFT,[Ri.FINAL]:Pi.FINAL,[Ri.COMPLETED]:Pi.COMPLETED,[Ri.CONFIDENTIAL]:Pi.CONFIDENTIAL,[Ri.VOID]:Pi.VOID};return"user"===l?ML(u,p)[0]||p:u[p]||Pi.DRAFT}function bD(p,l){const u=["opacity","flags"],f=["x","y","width","height"],g=["borderColor","borderWidth","lineDash"],m=[...u,...g,...f,"background","rotation"],v=["points","background",...g,...u],_={rectangle:m,ellipse:m,polygon:v,polyline:["lineEnding",...v],stamp:["stamp",...f,...u,"rotation"],ink:["points","borderWidth","borderColor","rotation",...u],line:["startPoint","endPoint","lineEnding","background",...g,...u],textBox:["textContents","textAlign","background","rotation",...u,...g,...f],textTypewriter:["x","y","textContents",...u]}[p];if(!_)return l;const b={};for(const S in l)if(_.includes(S)){let I=l[S];"points"!==S||"ink"!==p&&"polygon"!==p&&"polyline"!==p?"startPoint"!==S&&"endPoint"!==S||"line"!==p?"borderColor"===S||"background"===S?b[S]=rne(I,2):"opacity"===S?(I>1&&(I=1),I<0&&(I=0),b[S]=tf(I,2)):b[S]="textContents"===S?I.map(k=>(void 0!==k.color&&(k.color=rne(k.color,2)),void 0!==k.fontSize&&(k.fontSize=tf(k.fontSize,2)),k)):"lineDash"===S?I.map(k=>tf(k,2)):Xt(l[S])?tf(I,2):I:b[S]={x:tf(I.x,2),y:tf(I.y,2)}:b[S]=Di(I[0])?I.map(k=>k.map(O=>({x:tf(O.x,2),y:tf(O.y,2)}))):I.map(k=>({x:tf(k.x,2),y:tf(k.y,2)}))}return b}function tf(p,l){return Number.parseFloat(p.toFixed(l))}function rne(p,l){if(p&&p.startsWith("rgb")){const f=p.match(/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+)\s*)?\)/);if(f){const g=parseInt(f[1],10),m=parseInt(f[2],10),v=parseInt(f[3],10);let _=void 0!==f[4]?parseFloat(f[4]):void 0;return void 0!==_?(_<0&&(_=0),_>1&&(_=1),`rgba(${g},${m},${v},${function(S,I){const k=S.toString();return/^\d+\.\d{3,}$/.test(k)?parseFloat(S.toFixed(I)):S}(_,l)})`):`rgb(${g},${m},${v})`}}return p}function one(p,l,u){return p.map(f=>({x:Kn(f.x,l,u),y:Kn(f.y,l,u)}))}function sne(p,l,u){return p.map(f=>f.map(g=>({x:Kn(g.x,l,u),y:Kn(g.y,l,u)})))}const Eke=Ht(qe({},qv),{x:10,y:10,width:100,height:100});class Dke extends Qg{constructor(l){super(l=yo(l||{},hn(Eke)))}get type(){return"rectangle"}}const Ake=Ht(qe({},qv),{x:10,y:10,width:100,height:80});class Pke extends Qg{constructor(l){super(l=yo(l||{},hn(Ake)))}get type(){return"ellipse"}}const Rke=Ht(qe({},qv),{points:[[{x:10,y:10},{x:110,y:80}],[{x:110,y:10},{x:10,y:80}]]});class kke extends Qg{constructor(l){super(l=yo(l||{},hn(Rke)))}get type(){return"ink"}}const Mke=Ht(qe({},qv),{startPoint:{x:10,y:10},endPoint:{x:110,y:80},lineEnding:{start:la.NONE,end:la.NONE}});class Oke extends Qg{constructor(l){super(l=yo(l||{},hn(Mke)))}get type(){return"line"}}const Fke=Ht(qe({},qv),{points:[{x:60,y:10},{x:10,y:55},{x:30,y:110},{x:90,y:110},{x:110,y:55}]});class Lke extends Qg{constructor(l){super(l=yo(l||{},hn(Fke)))}get type(){return"polygon"}}const Nke=Ht(qe({},qv),{points:[{x:10,y:40},{x:50,y:80},{x:110,y:10}],lineEnding:{start:la.NONE,end:la.NONE}});class Bke extends Qg{constructor(l){super(l=yo(l||{},hn(Nke)))}get type(){return"polyline"}}function ane(p,l,u,f,g){return PL.apply(this,arguments)}function PL(){return PL=Fe(function*(p,l,u,f,g){const m=[`${g}.${f} is invalid`];let v=!1;if(ul(p)){const _=yield BE(p);["image/bmp","image/jpeg","image/png"].includes(_)||(v=!0)}else v=!0;return!v||gt.output(l,u,g,m)}),PL.apply(this,arguments)}const Wke={x:10,y:10,stamp:Ri.DRAFT,width:void 0,height:void 0,opacity:1,flags:{print:!0,noView:!1,readOnly:!1},rotation:0},RL={[Ri.REJECTED]:[23.58,23.54],[Ri.ACCEPTED]:[28.39,24.6],[Ri.INITIAL_HERE]:[126.26,33.78],[Ri.SIGN_HERE]:[126.26,33.78],[Ri.WITNESS]:[126.26,33.78],[Ri.APPROVED]:[211.33,59.33],[Ri.NOT_APPROVED]:[284.83,59.33],[Ri.DRAFT]:[144.19,59.66],[Ri.FINAL]:[123.73,59.66],[Ri.COMPLETED]:[227.83,59.33],[Ri.CONFIDENTIAL]:[272.83,59.33],[Ri.VOID]:[114.71,59.66]};var Kv=new WeakMap;class Uke{constructor(l){N(this,"uid",null),N(this,"creationDate",""),N(this,"modificationDate",""),bi(this,Kv,void 0),l=yo(l||{},hn(Wke)),!xn(l.stamp)||!RL[l.stamp]||Xt(l.width)&&Xt(l.height)||(l.width=l.width||RL[l.stamp][0],l.height=l.height||RL[l.stamp][1]),Bn(Kv,this,l),this.uid=Ai(),this.creationDate=ac(),this.modificationDate=this.creationDate}get type(){return"stamp"}get pageUid(){const l=Br.annotationService.annotationApp.getAnnotationByUid(this.uid);return l?l.pageUid:""}getOptions(){const l=Br.annotationService.annotationApp.getAnnotationByUid(this.uid);if(l){const u=l.getConfig(),f=Ew(u,this.type);Bn(Kv,this,qe({},f)),this.modificationDate=u.comment.modificationDate}return bD(this.type,Ye(Kv,this))}updateOptions(l){var u=this;return Fe(function*(){const f="Annotation.updateOptions";if(Cn(l,0,f,"options")||!e1(l,0,f,"options")||!EL(l,0,f,"options",u.type)||ul(l.stamp)&&!(yield ane(l.stamp,0,f,"stamp","options")))return;const g=u.getOptions(),m=ine(u.type,l,g);if(!m.size)return;u.getOptions(),yo(l,Ye(Kv,u));let v=Ye(Kv,u);null!=l&&l.stamp||(v=Ht(qe({},Ye(Kv,u)),{stamp:null}));const _=DL(v,u.type);Br.annotationService.updateAnnotations([{annotationUid:u.uid,options:_}],void 0,[...m])})()}}const Vke=Ht(qe({},qv),{x:10,y:10,width:150,height:80,textAlign:"left",textContents:[{content:"Insert text here"}]});class jke extends Qg{constructor(l){super(l=yo(l||{},hn(Vke)))}get type(){return"textBox"}}const Hke={x:10,y:10,textContents:[{content:"Insert text here"}],opacity:1,author:"",subject:"",flags:{print:!0,noView:!1,readOnly:!1}};class Gke extends Qg{constructor(l){super(l=yo(l||{},hn(Hke)))}get type(){return"textTypewriter"}}function Dw(p,l,u,f,g,m){const v=gt.formatError({isValid:Di(p)});if(v)return gt.output(l,u,f,void 0,v);const _=[];return p.forEach((b,S)=>{const I=gt.formatDetails(_n("Array",g,`[${S}]`,!0),gt.isStringAndNotEmpty(b,m));_.push(...I)}),!_.length||gt.output(l,u,f,_)}function lne(p,l,u,f,g){const m=[];return l.forEach((v,_)=>{p.has(v)||m.push(`annotationUids[${_}]: The specified annotation(s) do not exist.`)}),!m.length||gt.output(u,f,g,m,it.ANNOTATION_NOT_EXIST)}function xD(p,l,u,f,g){return!!p.has(l)||gt.output(u,f,g,void 0,it.ANNOTATION_NOT_EXIST)}class zke{constructor(){N(this,"uid",null),N(this,"creationDate",""),N(this,"modificationDate",""),this.uid=Ai(),this.creationDate=ac(),this.modificationDate=ac()}get type(){return"unknown"}get pageUid(){const l=Br.annotationService.annotationApp.getAnnotationByUid(this.uid);return l?l.pageUid:""}}var kL=new WeakMap;class Yke{constructor(l){bi(this,kL,void 0),N(this,"uid",null),N(this,"creationDate",""),N(this,"modificationDate",""),this.uid=Ai(),this.creationDate=ac(),this.modificationDate=ac(),Bn(kL,this,l)}get type(){return"incomplete"}get pageUid(){const l=Br.annotationService.annotationApp.getAnnotationByUid(this.uid);return l?l.pageUid:""}get raw(){return Ye(kL,this)}}const cne=["annotationsAdded","annotationsDeleted","annotationsModified","annotationLayerChanged"],Zg="AnnotationManager",une=new Map;var Vl=new WeakMap,gl=new WeakMap,Aw=new WeakMap,Jv=new WeakSet;function dne(p,l){switch(p){case"rectangle":return new Dke(l);case"ellipse":return new Pke(l);case"polygon":return new Lke(l);case"polyline":return new Bke(l);case"line":return new Oke(l);case"stamp":return new Uke(l);case"ink":return new kke(l);case"textBox":return new jke(l);case"textTypewriter":return new Gke(l);case"unknown":return new zke;case"highlight":case"underline":case"strikeout":case"incomplete":return new Yke((null==l?void 0:l.annotationRaw)||{});default:return null}}function wD(p,l){Ye(Aw,this).emit(p,l)}const hne=new class{constructor(){al(this,Jv),bi(this,Vl,void 0),bi(this,gl,void 0),bi(this,Aw,void 0),Bn(Vl,this,Br),Bn(gl,this,une),Bn(Aw,this,new Bh);const p=Ye(Vl,this).annotationService.annotationApp.hooks;p.annotationCreated.on(u=>{const f=u.annotations.reduce((g,m)=>{if(!Ye(gl,this).has(m.uid)){const v=m.getConfig(),_=Ew(v),b=at(Jv,this,dne).call(this,v.type,_);b&&(b.uid=v.uid,b.creationDate=v.comment.creationDate,b.modificationDate=v.comment.modificationDate,Ye(gl,this).set(v.uid,b))}return g.push(m.uid),g},[]);at(Jv,this,wD).call(this,"annotationsAdded",{annotationUids:f})}),p.annotationDeleted.on(u=>{u.annotations.forEach(g=>{Ye(gl,this).has(g.uid)&&(this.getAnnotationsByUids([g.uid])[0].modificationDate="",Ye(gl,this).delete(g.uid))});const f=u.annotations.map(g=>g.uid);u.emitEvent&&at(Jv,this,wD).call(this,"annotationsDeleted",{annotationUids:f})}),p.annotationUpdated.on(u=>{const f={modifiedAnnotations:u.updateDetails.map(g=>{const m=this.getAnnotationsByUids([g.annotationUid])[0],v=m.type,_=Br.annotationService.annotationApp.getAnnotationByUid(m.uid);return m.modificationDate=_.comment.modificationDate,{uid:g.annotationUid,oldOptions:bD(v,Ew(hn(g.from),v)),newOptions:bD(v,Ew(hn(g.to),v))}}),actions:[...u.updateActions]};at(Jv,this,wD).call(this,"annotationsModified",f)});const l=(u,f)=>{at(Jv,this,wD).call(this,"annotationLayerChanged",{oldAnnotationUidList:[...u.from],newAnnotationUidList:[...u.to]})};p.bringFroward.on(u=>{l(u)}),p.bringToFront.on(u=>{l(u)}),p.sendBackward.on(u=>{l(u)}),p.sendToBack.on(u=>{l(u)})}createAnnotation(p,l,u){const f="AnnotationManager.createAnnotation",g="pageUid",m="type",v="annotationOptions";let _=null;try{xi.makeSureCoreLicenseExist(),xi.makeSureAnnotationLicenseExist(),Cn(p,0,f,g),Cn(l,0,f,m),ar(p,0,f,g,!1),O=f,j=m,xn(I=l)?["rectangle","ellipse","polygon","polyline","line","stamp","ink","textBox","textTypewriter"].includes(I)||gt.output(0,O,j,void 0,it.PARAM_NOT_SUPPORT):gt.output(0,O,j,void 0,it.PARAM_INVALID),_=Ye(Vl,this).pageService.getPage(p),_||gt.error(f,g,void 0,it.PAGE_NOT_EXIST),pt(u)||(e1(u,0,f,v),EL(u,0,f,v,l))}catch(I){if("stamp"===l)return Promise.reject(I);throw I}var I,O,j;const b=hn(u||{}),S=()=>{var I,k,O;const j=at(Jv,this,dne).call(this,l,b);Ye(gl,this).set(j.uid,j);const W=Ye(Vl,this).pageService.getPage(p).doc.uid,J=DL(j.getOptions(),l);if("textTypewriter"===l){const Q=_.mediaBox.width,ie=_.mediaBox.width-J.style.x;J.style.width=ie<0?Q:ie}const K={uid:j.uid,docUid:W,pageUid:p,type:l,style:J.style,transform:J.transform,flags:J.flags,comment:{annotationUid:j.uid,author:(null===(I=J.comment)||void 0===I?void 0:I.author)||"",subject:(null===(k=J.comment)||void 0===k?void 0:k.subject)||"",contents:(null===(O=J.comment)||void 0===O?void 0:O.contents)||"",creationDate:j.creationDate,modificationDate:j.creationDate,markedStates:[],reviewStates:[],replies:[]}};return Ye(Vl,this).annotationService.createAnnotation(W,K),j};if("stamp"===l&&ul(null==b?void 0:b.stamp)){const I=b;return new Promise(function(){var k=Fe(function*(O,j){try{yield ane(I.stamp,0,f,"stamp",v)}catch(W){return void j(W)}if(!Xt(I.width)||!Xt(I.height)){const W=new Sv,J=yield W.readImageInfo({fileSource:I.stamp}).catch(ie=>{j(ie)});let K=J.imageWidth,Q=J.imageHeight;if(K>400||Q>400){const ie=Math.max(K/400,Q/400);K/=ie,Q/=ie}I.width=K,I.height=Q}O(S())});return function(O,j){return k.apply(this,arguments)}}())}return S()}deleteAnnotations(p){const l=`${Zg}.deleteAnnotations`,u="annotationUids";return!(Cn(p,1,l,u)||!Dw(p,1,l,u,void 0,!1)||!lne(Ye(gl,this),p,1,l,u)||(Ye(Vl,this).annotationService.deleteAnnotations(p),0))}getAnnotationsByUids(p){const l=`${Zg}.getAnnotationsByUids`,u="annotationUids";return!Cn(p,1,l,u)&&Dw(p,1,l,u,void 0,!1)&&lne(Ye(gl,this),p,1,l,u)?p.map(f=>Ye(gl,this).get(f)):[]}getAnnotationsByPage(p){const l=`${Zg}.getAnnotationsByPage`,u="pageUid";if(Cn(p,1,l,u)||!ar(p,1,l,u,!1))return[];if(!Ye(Vl,this).pageService.getPage(p))return gt.warning(l,u,void 0,it.PAGE_NOT_EXIST),[];const f=Ye(Vl,this).annotationService.getAnnotationUidsByLayer(p),g=[];return f.forEach(m=>{const v=Ye(gl,this).get(m);v&&g.push(v)}),g}getAnnotationsByDoc(p){const l=`${Zg}.getAnnotationsByDoc`,u="docUid";if(Cn(p,1,l,u)||!ar(p,1,l,u,!1))return[];const f=Ye(Vl,this).documentService.getDocument(p);return f?f.pages.reduce((g,m)=>(Ye(Vl,this).annotationService.getAnnotationUidsByLayer(m).forEach(v=>{const _=Ye(gl,this).get(v);_&&g.push(_)}),g),[]):(gt.warning(l,u,void 0,it.DOC_NOT_EXIST),[])}bringAnnotationForward(p){const l=`${Zg}.bringAnnotationForward`,u="annotationUid";return!(Cn(p,1,l,u)||!ar(p,1,l,u,!1)||!xD(Ye(gl,this),p,1,l,u))&&Ye(Vl,this).annotationService.bringForward(p)}sendAnnotationBackward(p){const l=`${Zg}.sendAnnotationBackward`,u="annotationUid";return!(Cn(p,1,l,u)||!ar(p,1,l,u,!1)||!xD(Ye(gl,this),p,1,l,u))&&Ye(Vl,this).annotationService.sendBackward(p)}bringAnnotationToFront(p){const l=`${Zg}.bringAnnotationToFront`,u="annotationUid";return!(Cn(p,1,l,u)||!ar(p,1,l,u,!1)||!xD(Ye(gl,this),p,1,l,u))&&Ye(Vl,this).annotationService.bringToFront(p)}sendAnnotationToBack(p){const l=`${Zg}.sendAnnotationToBack`,u="annotationUid";return!(Cn(p,1,l,u)||!ar(p,1,l,u,!1)||!xD(Ye(gl,this),p,1,l,u))&&Ye(Vl,this).annotationService.sendToBack(p)}on(p,l){const u="AnnotationManager.on",f="eventName",g="listener";!Cn(p,1,u,f)&&!Cn(l,1,u,g)&&ar(p,1,u,f,!1)&&ef(l,u,g,1)&&(cne.includes(p)?Ye(Aw,this).on(p,l):it.warning(it.PARAM_NOT_SUPPORT,u,f))}off(p,l){const u="AnnotationManager.off",f="eventName";!Cn(p,1,u,f)&&ar(p,1,u,f,!1)&&(pt(l)||ef(l,u,"listener",1))&&(cne.includes(p)?Ye(Aw,this).off(p,l):it.warning(it.PARAM_NOT_SUPPORT,u,f))}};function fne(p,l,u,f,g,m){const v=[];let _=!1;if(g)g.forEach((b,S)=>{const{width:I,height:k}=u.getRealPageSize(b);Ine(f,I,k)||v.push(`indices[${b}]: ${it.RECT_EXCEED_PAGE_BOUND.message}`)}),v.length>0&&(_=!0);else{const{width:b,height:S}=u.getRealPageSize();Ine(f,b,S)||(_=!0)}return!!_&&gt.output(m,p,l,v.length?v:void 0,it.RECT_EXCEED_PAGE_BOUND,!0)}function pne(p,l,u,f){const g=_o.isRectValid(p);return!!g.length&&gt.output(f,l,u,g,void 0,!0)}const gne=["canvasStyle","pageStyle","quadSelectionStyle","currentPageStyle","annotationSelectionStyle"],Zo="EditViewer";var cn=new WeakMap,s1=new WeakMap,So=new WeakMap,SD=new WeakSet;class mne{constructor(l){var u,f;al(this,SD),bi(this,cn,void 0),bi(this,s1,!0),bi(this,So,new _D),N(this,"uid",void 0),N(this,"groupUid",void 0),N(this,"postfix",void 0),N(this,"thumbnail",void 0),xi.makeSureCoreLicenseExist(),pt(l)||Iw(l,"editViewer",0,"new EditViewer","option");const g=yo((null==l?void 0:l.viewerConfig)||{},hn(Ht(qe({},Tke),{viewerMode:qo.DEFAULT,displayMode:"continuous",enableOptimizePage:!0,enableAnnotationUi:!0})));if(g.minZoom>g.maxZoom){it.warning(it.MIN_ZOOM_INVALID);const b=g.maxZoom;g.maxZoom=g.minZoom,g.minZoom=b}const{maxZoom:m,minZoom:v}=g;g.maxZoom=m>64||m<.01?64:m,g.minZoom=v>64||v<.01?.01:v,ir()&&(n1.toolbarConfig.style={scale:"0.9"}),Bn(cn,this,Br.createViewer(Ht(qe({uiConfig:hn(ir()?bL:xL)},l),{viewerConfig:g,annotationToolBarConfig:qe(qe({},null==n1?void 0:n1.toolbarConfig),null==l||null===(u=l.annotationConfig)||void 0===u?void 0:u.toolbarConfig),annotationPaletteConfig:qe(qe({},n1.paletteConfig),null==l||null===(f=l.annotationConfig)||void 0===f?void 0:f.paletteConfig)}))),this.uid=Ye(cn,this).uid,this.groupUid=Ye(cn,this).groupUid,this.postfix=Ye(cn,this).postfix;const _=yo(hn(null==l?void 0:l.annotationConfig)||{},hn(n1));Ye(cn,this).updateAnnotationConfig(function(b){const{defaultStyleConfig:J}=b;return Object.keys(J).forEach(K=>{const Q=J[K];"object"==typeof Q&&null!==Q&&((K=>{if("lineEnding"in K&&"object"==typeof K.lineEnding&&null!==K.lineEnding){const Q=AL(K.lineEnding,"date");delete K.lineEnding,K.lineEnding=Q}})(Q),(K=>{K.borderWidth="borderWidth"in K&&Xt(null==K?void 0:K.borderWidth)?Kn(K.borderWidth,Vn.dataResolution,Vn.displayResolution):1})(Q),(K=>{var Q,ie,oe,le,he;"textContent"in K&&Un(K.textContent)&&(K.textContent.fontSize=Xt(null==K||null===(Q=K.textContent)||void 0===Q?void 0:Q.fontSize)?Kn(null==K||null===(he=K.textContent)||void 0===he?void 0:he.fontSize,Vn.dataResolution,Vn.displayResolution):n1.defaultStyleConfig.textBox.textContent.fontSize,["normal","italic"].includes(null==K||null===(ie=K.textContent)||void 0===ie?void 0:ie.fontStyle)||(K.textContent.fontStyle="normal"),["normal","bold"].includes(null==K||null===(oe=K.textContent)||void 0===oe?void 0:oe.fontWeight)||(K.textContent.fontWeight="normal"),""===(null==K||null===(le=K.textContent)||void 0===le?void 0:le.fontFamily)&&(K.textContent.fontFamily="Helvetica"))})(Q),(K=>{"lineDash"in K&&K.lineDash.length&&(K.lineDash=Kn(K.lineDash,Vn.dataResolution,Vn.displayResolution))})(Q),(K=>{"textAlign"in K&&!["left","right","center","justify"].includes(null==K?void 0:K.textAlign)&&(K.textAlign="left")})(Q),"stamp"===K&&(K=>{K.stamp instanceof Blob&&(K.imageData=K.stamp),xn(K.stamp)&&(xne(K.stamp)?K.imageData=K.stamp:K.stampIcon=["rejected","accepted","initialHere","signHere","witness","approved","notApproved","draft","final","completed","confidential","void"].includes(K.stamp)?CD(K.stamp,"date"):CD(Ri.DRAFT,"date")),delete K.stamp})(Q))}),Ht(qe({},b),{controlsStyle:b.annotationSelectionStyle})}(_)),Sne(Ye(cn,this).getUiConfig()).includes(Sn.Filter)&&!Ye(cn,this).context.core.filterService.enableFilter&&it.warning(it.IMG_FILTER_MISS),l&&!1===l.createThumbnail||at(SD,this,$ke).call(this,null==l?void 0:l.thumbnailConfig),l&&!pt(null==l?void 0:l.adaptiveIconSize)&&Bn(s1,this,l.adaptiveIconSize),Ye(cn,this).rootDom&&(Ye(cn,this).rootDom.style.fontSize="20px",ID(this,Ye(cn,this).rootDom,Ye(s1,this))),NL.forEach(b=>{Ye(cn,this).addFontToUi(b)}),at(SD,this,qke).call(this),at(SD,this,Xke).call(this)}get isVisible(){return Ye(So,this).getIsVisible(Ye(cn,this))}get isBoundContainer(){return Ye(So,this).getIsBoundContainer(Ye(cn,this))}get currentDocument(){return Ye(So,this).getCurrentDocument(Ye(cn,this))}get zoom(){return parseFloat(Ye(cn,this).getViewerConfig().zoom.toFixed(4))}set zoom(l){const{maxZoom:u,minZoom:f}=Ye(cn,this).getViewerConfig();(function(g,m,v,_,b,S){const I=gt.formatError(gt.isNumberAndIsInRange(g));return I?gt.output(1,v,_,void 0,I):(g<b&&gt.output(1,v,_,void 0,it.ZOOM_TOO_SMALL),g>S&&gt.output(1,v,_,void 0,it.ZOOM_TOO_LARGE),!0)})(l,0,`${Zo}.zoom`,"zoom",f,u)&&Ye(cn,this).updateViewerConfig({zoom:l})}get zoomOrigin(){return Ye(cn,this).getViewerConfig().zoomOrigin}set zoomOrigin(l){(function(u,f,g,m){const v=_o.isZoomOriginValid(u);return!v.length||gt.output(1,f,"zoomOrigin",v)})(l,`${Zo}.zoomOrigin`)&&Ye(cn,this).updateViewerConfig({zoomOrigin:{x:l.x,y:l.y}})}get displayMode(){const{displayMode:l}=Ye(cn,this).getViewerConfig(),u=Ye(cn,this).getActiveTab();return u?u.context.displayMode:l}set displayMode(l){const u="displayMode",f=`${Zo}.${u}`;ar(l,1,f,u)&&(["single","continuous"].includes(l)?Ye(cn,this).updateViewerConfig({displayMode:l}):it.warning(it.PARAM_NOT_SUPPORT,f,u))}get toolMode(){const{toolMode:l}=Ye(cn,this).getViewerConfig();return l}set toolMode(l){const u="toolMode",f=`${Zo}.${u}`;var v;ar(l,1,f,u)&&(v=f,["crop","pan","annotation"].includes(l)||gt.output(1,v,"toolMode",void 0,it.PARAM_NOT_SUPPORT))&&Ye(cn,this).updateViewerConfig({toolMode:l})}get annotationMode(){const{annotationMode:l}=Ye(cn,this).getViewerConfig();return l}set annotationMode(l){const u="annotationMode",f=`${Zo}.${u}`;var v;ar(l,1,f,u)&&(v=f,["rectangle","ellipse","line","polygon","polyline","ink","textBox","textTypewriter","stamp","erase","select"].includes(l)||gt.output(1,v,"annotationMode",void 0,it.PARAM_NOT_SUPPORT))&&Ye(cn,this).updateViewerConfig({annotationMode:l})}get fitMode(){const{fitMode:l}=Ye(cn,this).getViewerConfig(),u=Ye(cn,this).getActiveTab();return u?u.context.fitMode:l}set fitMode(l){const u=`${Zo}.fitMode`;var v;ar(l,1,u,"fitMode")&&(v=u,["width","height","window","actualSize"].includes(l)||gt.output(1,v,"fitMode",void 0,it.PARAM_NOT_SUPPORT))&&Ye(cn,this).updateViewerConfig({fitMode:l})}bindContainer(l){Ye(So,this).bindContainer(Ye(cn,this),l,`${Zo}.bindContainer`)}unbindContainer(){Ye(So,this).unbindContainer(Ye(cn,this))}show(){Ye(So,this).show(Ye(cn,this)),ID(this,Ye(cn,this).rootDom,Ye(s1,this))}hide(){Ye(So,this).hide(Ye(cn,this))}getUiConfig(){return Ye(So,this).getUiConfig(Ye(cn,this))}updateUiConfig(l){return Ye(cn,this).selectAnnotations([]),!!Ye(So,this).updateUiConfig(Ye(cn,this),l,"editViewer",`${Zo}.updateUiConfig`)&&(Ye(cn,this).emit("thumbnailBind",this.thumbnail.uid),ID(this,Ye(cn,this).rootDom,Ye(s1,this)),!0)}openDocument(l){Ye(So,this).openDocument(l,this.uid,`${Zo}.openDocument`)}closeDocument(){return Ye(So,this).closeDocument(Ye(cn,this),`${Zo}.closeDocument`)}getStyle(l){return Ye(So,this).getStyle(Ye(cn,this),"edit",l,gne,`${Zo}.getStyle`)}updateStyle(l,u){const f=`${Zo}.updateStyle`;return Ye(So,this).updateStyle(Ye(cn,this),l,u,gne,f)}setParallelScrollCount(l){const u=`${Zo}.setParallelScrollCount`,f="count",{maxColumns:g,maxRows:m}=Ye(cn,this).getViewerConfig();return!(Cn(l,1,u,f)||!i1(l,u,f,1)||r1(l,1,m,1,u,f)||r1(l,1,g,1,u,f))&&("continuous"!==this.displayMode?(it.warning(it.ROW_COLUMN_CAN_NOT_CHANGE,u),!1):Ye(cn,this).setRowAndColumn(l,l))}setCropRect(l){const u=`${Zo}.setCropRect`,f="rect";return!(Cn(l,1,u,f)||pne(l,u,f,1)||!Qo(Ye(cn,this),1)||hc(void 0,void 0,Ye(cn,this),1)||fne(u,f,Ye(cn,this),l,void 0,1))&&("crop"!==this.toolMode?(it.warning(it.TOOL_MODE_NOT_AVAILABLE,u),!1):Ye(cn,this).setRectBox(l))}getCropRect(){return Qo(Ye(cn,this),1)?Ye(cn,this).getRectBox():null}crop(l,u){const f=`${Zo}.crop`,g=Ye(cn,this).getPageCounts(),m="rect";if(Cn(l,1,f,m)||pne(l,f,m,1)||!Qo(Ye(cn,this),1)||hc(void 0,void 0,Ye(cn,this),1)||u&&!Tp(u,1,f,"indices",0,g-1)||fne(f,m,Ye(cn,this),l,u,1))return!1;const v=Ye(cn,this).getCurrentPageIndex();return Ye(cn,this).cropPages(l,u||[v])}rotate(l,u){const f=`${Zo}.rotate`;return Ye(So,this).rotate(Ye(cn,this),l,u,f)}undo(){if(!Qo(Ye(cn,this),1))return!1;const l=Ye(cn,this).undo();return l||it.warning(it.UNDO_NOOP),l}redo(){if(!Qo(Ye(cn,this),1))return!1;const l=Ye(cn,this).redo();return l||it.warning(it.REDO_NOOP),l}saveOperations(){return Ye(So,this).saveOperation(Ye(cn,this))}indexToUid(l){const u=`${Zo}.indexToUid`;return Ye(So,this).indexToUid(Ye(cn,this),l,u)}uidToIndex(l){const u=`${Zo}.uidToIndex`;return Ye(So,this).uidToIndex(Ye(cn,this),l,u)}getCurrentPageUid(){return Ye(So,this).getCurrentPageUid(Ye(cn,this))}getCurrentPageIndex(){return Ye(So,this).getCurrentPageIndex(Ye(cn,this))}getPageCount(){return Ye(So,this).getPageCount(Ye(cn,this))}goToPage(l){const u=`${Zo}.goToPage`;return Ye(So,this).gotoPage(Ye(cn,this),l,u)}selectAnnotations(l){const u=`${Zo}.selectAnnotations`,f="annotationUids";if(!Qo(Ye(cn,this),1)||hc(void 0,void 0,Ye(cn,this),1)||Cn(l,1,u,f)||!Dw(l,1,u,f,void 0,!1))return!1;if("crop"===this.toolMode)return it.warning(it.TOOL_MODE_NOT_AVAILABLE,u),!1;l=[...new Set(l)];const g=[],m=[],v=[],_=this.getCurrentPageUid(),b=l.reduce((I,k,O)=>{const j=Br.annotationService.getAnnotationByUid(k);return j?j.pageUid!==_?g.push(`${f}[${O}]: The specified annotation is not on the current page.`):"incomplete"===j.type||"unknown"===j.type?m.push(`${f}[${O}]: ${it.UNSELECTED_UNKNOWN.message}`):j.flags.includes("readOnly")||j.flags.includes("noView")?v.push(`${f}[${O}]: ${it.UNSELECTED_READONLY.message}`):I.push(k):g.push(`${f}[${O}]: The specified annotation does not exist.`),I},[]);if(g.length){const I=it.ANNOTATION_SELECT;return I.details=g,it.warning(I,u,f),!1}if(m.length){const I=it.UNSELECTED_UNKNOWN;return I.details=m,it.warning(I,u,f),!1}if(v.length){const I=it.UNSELECTED_READONLY;return I.details=v,it.warning(I,u,f),!1}const S=Ye(cn,this).getSelectedAnnotations().map(I=>I.uid);return S.length===b.length&&function(I,k){if(I.length!==k.length)return!1;const O=I.slice().sort(),j=k.slice().sort();for(let W=0;W<O.length;W++)if(O[W]!==j[W])return!1;return!0}(S,b)||Ye(cn,this).selectAnnotations(b),!0}getSelectedAnnotations(){return!Qo(Ye(cn,this),1)||hc(void 0,void 0,Ye(cn,this),1)?[]:Ye(cn,this).getSelectedAnnotations().length?hne.getAnnotationsByUids(Ye(cn,this).getSelectedAnnotations().map(l=>l.uid)):[]}on(l,u){Ye(So,this).on(Ye(cn,this),`${Zo}.on`,l,u)}off(l,u){Ye(So,this).off(Ye(cn,this),`${Zo}.off`,l,u)}destroy(){Ye(So,this).destroy(Ye(cn,this))}}function Xke(){Ye(cn,this).hooks.destroy.on(()=>{var p;null===(p=this.thumbnail)||void 0===p||p.vCommon.destroy(this.thumbnail.v),this.thumbnail=null,Bn(cn,this,null),Object.setPrototypeOf(this,null)})}function $ke(p){const l=p||{},u=hn(Ske);ir()&&(u.size="100%",u.rows=3,u.columns=2,u.canvasStyle.background="#4B4B4B",u.pageNumberStyle.color="white",u.enableOptimizePage=!0),yo(l,u);const{mainAndThbContainer:f,mainContainer:g,thumbnailContainer:m}=Ye(cn,this).context.viewService,{size:v,position:_,visibility:b}=u,S=hn(mD);let I="row",k=v,O="100%",j="left"===_?"-1":"1";"top"!==_&&"bottom"!==_||(I="column",k="100%",O=v,j="top"===_?"-1":"1"),S.className=`ddv-edit-viewer-thumb-${_}`,Object.assign(m.style,{width:k,height:O,order:j,display:"visible"===b?"block":"none"}),f.style.flexDirection=I,f.insertBefore(m,g),Ye(cn,this).context.resize();const J=new nne({container:m,viewerConfig:u,groupUid:this.groupUid,uiConfig:S},`${Zo}.thumbnail`);this.thumbnail=J,Ye(cn,this).emit("thumbnailBind",J.uid),J.on("click",()=>{Ye(cn,this).emit("ui_hidePopup",null)})}function qke(){this.on("resized",p=>{p.newWidth<1200&&p.newWidth>800&&ID(this,Ye(cn,this).rootDom,Ye(s1,this))})}const Kke={canvasStyle:qe({},vD),pageStyle:qe({},Xte),quadSelectionStyle:qe({},SL),enableSlide:!0};function vne(p,l,u,f){const g=_o.isQuadValid(p);return g.length?gt.output(l,u,f,g):!!LE(p.flat())||gt.output(l,u,f,void 0,it.PARAM_INVALID)}function yne(p,l,u,f){return!!function(g,m,v){for(let _=0;_<g.length;_++)if(g[_][0]>m||g[_][1]>v)return!0;return!1}(p,u,f)&&(gt.output(l,void 0,void 0,void 0,it.QUAD_EXCEED_PAGE_BOUND),!0)}const _ne=["canvasStyle","pageStyle","quadSelectionStyle"],Ha="PerspectiveViewer";var di=new WeakMap,To=new WeakMap,Cne=new WeakSet;function Qke(){Ye(di,this).hooks.destroy.on(()=>{Bn(di,this,null),Object.setPrototypeOf(this,null)})}var qu=new WeakMap,Qv=new WeakMap,TD=new WeakMap,bne=new WeakSet;function t4e(){lc.registerComponent({Root:dee,Layout:cee,Button:LF,Blank:fte,SeparatorLine:hee,Close:jF,Done:GF,Back:HF})}function ID(p,l,u){if(!u||ir()||!p.isVisible)return;const f=l,g=f.clientWidth;if(p instanceof mne){let m=20;g<1280&&(m=Math.max(13.5,g/1280*20)),f.style.fontSize=`${m}px`}}function xne(p){if(p instanceof Blob)return!0;if(xn(p)){const l=u=>{try{return new URL(u),!0}catch(f){return!1}};return!(!/^data:image\/([a-zA-Z]*);base64,/.test(p)&&!l(p))}return!1}function wne(p,l){const u=["Load","Download","Print"],f=["Layout","Button","Blank","SeparatorLine","Close","Done","Back"],g=[...f,"MainView"],m=["Pagination","RotateLeft","RotateRight","Delete","DeleteCurrent","DeleteAll"],v=[...g,...m,...u,"PerspectiveAll","FullQuad"],_=[...g,...m,...u],b=[...g,"Capture","Flashlight","CameraConvert","CameraResolution","AutoDetect","AutoCapture","ImagePreview"],S=[...g,...m,...u,"Zoom","ZoomIn","ZoomOut","ZoomByPercentage","ThumbnailSwitch","FitMode","DisplayMode","Crop","Filter","Undo","Redo","Pan","FitWidth","FitHeight","FitWindow","ActualSize","SinglePage","ContinuousPage","AnnotationSet","EllipseAnnotation","EraseAnnotation","InkAnnotation","LineAnnotation","PolygonAnnotation","PolylineAnnotation","RectAnnotation","SelectAnnotation","StampIconAnnotation","StampImageAnnotation","TextBoxAnnotation","TextTypewriterAnnotation","BringForward","BringToFront","SendBackward","SendToBack"];let I;switch(l){case"captureViewer":I=b;break;case"editViewer":I=S;break;case"perspectiveViewer":I=v;break;case"customViewer":I=f;break;case"browseViewer":I=_}const k=[];return null!=p&&p.type&&!I.includes(null==p?void 0:p.type)&&k.push(p.type),null!=p&&p.children&&p.children.forEach(O=>{xn(O)&&!I.includes(O)&&k.push(O),Un(O)&&k.push(...wne(O,l))}),k}function Sne(p){const l=[];return null!=p&&p.type&&l.push(p.type),null!=p&&p.children&&p.children.forEach(u=>{xn(u)&&l.push(u),Un(u)&&l.push(...Sne(u))}),[...new Set(l)]}function Tne(p,l){const u=wne(p,l);if(u.length>0){let f="";return u.forEach((g,m)=>{f+=m===u.length-1?`${g}`:`${g} `}),f}return!1}function Pw(p){if(""===p)return!0;const l=document.createElement("div");l.style.border=p;const u=v=>""===v||"initial"===v,{borderWidth:f,borderColor:g,borderStyle:m}=l.style;return!(u(f)||u(g)||u(m))}function Ine(p,l,u){const{left:f,top:g,width:m,height:v}=p;return!(f>l||f+m>l||g>u||g+v>u)}function ML(p,l){return Object.keys(p).filter(u=>p[u]===l)}function OL(p,l){if(p===l)return!0;if(Un(p)&&Un(l)&&Object.keys(p).length===Object.keys(l).length){for(const u in p)if(!Object.prototype.hasOwnProperty.call(l,u)||!OL(p[u],l[u]))return!1}else{if(!Di(p)||!Di(l)||p.length!==l.length)return!1;for(let u=0;u<p.length;u++)if(!OL(p[u],l[u]))return!1}return!0}function Ene(p,l){let u;switch(p){case"canvasStyle":u=function(f,g){const m=[];return m.push(...Dne(f,{border:(null==g?void 0:g.border)||"",background:(null==g?void 0:g.background)||""})),pt(null==g?void 0:g.cursor)||xn(g.cursor)||m.push(`${f}.cursor is invalid`),m}(p,l);break;case"pageNumberStyle":u=function(f,g){const m=[],v=["color","fontSize","fontFamily","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(g).forEach(_=>{-1!==v.indexOf(_)&&(xn(g[_])||m.push(`${f}.${_} is invalid.`)),"border"===_&&xn(g[_])&&!Pw(g[_])&&m.push(`${f}.border is invalid.`),("onPage"===_&&!Ds(g[_])||"opacity"===_&&!Xt(g[_])||"visibility"===_&&-1===["visible","hidden"].indexOf(g[_]))&&m.push(`${f}.${_} is invalid.`)}),m}(p,l);break;case"checkBoxStyle":u=function(f,g){const m=[],v=["checkMarkColor","checkMarkLineWidth","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(g).forEach(_=>{-1!==v.indexOf(_)&&(xn(g[_])||m.push(`${f}.${_} is invalid.`)),"border"===_&&xn(g[_])&&!Pw(g[_])&&m.push(`${f}.border is invalid.`),("opacity"===_&&!Xt(g[_])||"visibility"===_&&-1===["visible","hidden"].indexOf(g[_]))&&m.push(`${f}.${_} is invalid.`)}),m}(p,l);break;case"quadSelectionStyle":u=function(f,g){const m=[],v=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"];return Object.keys(g).forEach(_=>{-1!==v.indexOf(_)&&(xn(g[_])||m.push(`${f}.${_} is invalid`)),"border"!==_&&"ctrlBorder"!==_||!xn(g[_])||Pw(g[_])||m.push(`${f}.${_} is invalid`)}),m}(p,l);break;case"annotationSelectionStyle":u=function(f,g){const m=[],v=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground"];return Object.keys(g).forEach(_=>{-1!==v.indexOf(_)&&(xn(g[_])||m.push(`${f}.${_} is invalid.`)),"border"!==_&&"ctrlBorder"!==_||!xn(g[_])||Pw(g[_])||m.push(`${f}.${_} is invalid.`)}),m}(p,l);break;default:u=Dne(p,l)}return u}function FL(p){return!!Xt(p)&&p>=0}function Dne(p,l){const u=[];return Object.keys(l).forEach(f=>{-1!==["background","border"].indexOf(f)&&(xn(l[f])||u.push(`${p}.${f} is invalid.`),"border"===f&&l[f]&&xn(l[f])&&!Pw(l[f])&&u.push(`${p}.border is invalid.`))}),u}function Ane(p,l){const u=p.flat(2),f=l.flat(2);if(u.length!==f.length)return!1;const g=f[0].x-u[0].x,m=f[1].y-u[1].y;for(let v=1;v<u.length;v++)if(f[v].x-u[v].x!==g||f[v].y-u[v].y!==m)return!1;return!0}class _o{static isLicenseValid(l){if(xn(l)){const u=l.trim();return 0===u.length||u.startsWith("DLS")||(u.startsWith("f")||u.startsWith("t"))&&u.length>50}return!1}static isQuadValid(l,u){const f=[],g=_n("Quad",u);if(pt(l))return f.push(`${g} is missing.`),f;const m=gt.isArrayAndMeetMinLength(l,4),v=gt.formatDetails(g,m);return v.length?(f.push(...v),f):(l.forEach((_,b)=>{const S=_n("Quad",u,`[${b}]`,!0),I=gt.isArrayAndMeetMinLength(_,2),k=gt.formatDetails(_n("Array",S),I);k.length?f.push(...k):_.forEach((O,j)=>{const W=gt.isNumberAndIsInRange(O),J=gt.formatDetails(_n("Array",S,`[${j}]`,!0),W);J.length&&f.push(...J)})}),f)}static isRectValid(l,u){const f=[],g=_n("Rect",u);if(pt(l))return f.push(`${g} is missing.`),f;const m=gt.formatDetails(g,Un(l));return m.length?(f.push(...m),f):(["left","top","width","height"].forEach(v=>{const _=gt.formatDetails(_n("Rect",u,v),gt.isNumberAndIsInRange(l[v]));_.length&&f.push(..._)}),f)}static isSourceValid(l,u,f){const g=[],m="Source",v=gt.formatDetails(_n(m,u),Un(l));if(v.length)return g.push(...v),g;const _=gt.formatDetails(_n(m,u,"fileData"),ul(l.fileData));if(_.length)return g.push(..._),g;if(!pt(l.extraPageData)){const b=gt.formatDetails(_n(m,u,"extraPageData"),gt.isArrayAndMeetMinLength(l.extraPageData));if(b.length)return g.push(...b),g;l.extraPageData.forEach((S,I)=>{const k=this.isExtraPageDataValid(S,_n(m,u,`extraPageData[${I}]`,!0),f);k.length&&g.push(...k)})}return g}static isExtraPageDataValid(l,u,f){const g=[],m="ExtraPageData",v=gt.formatDetails(_n(m,u),Un(l));if(v.length)return g.push(...v),g;const _=gt.formatDetails(_n(m,u,"index"),gt.isNumberAndIsInRange(l.index));if(g.push(..._),!pt(l.rotation)){const b=this.isRotationValid(l.rotation,_n(m,u));g.push(...b)}if(!pt(l.filter)){const b=this.isFilterTypeValid(l.filter,f,_n(m,u));g.push(...b)}return pt(l.perspectiveQuad)||g.push(...this.isQuadValid(l.perspectiveQuad,_n(m,u,"perspectiveQuad"))),g}static isSourcesValid(l,u,f){const g=[],m="Source[]",v=gt.formatDetails(_n(m,u),gt.isArrayAndMeetMinLength(l));return v.length?(g.push(...v),g):(l.forEach((_,b)=>{g.push(...this.isSourceValid(_,_n(m,u,`[${b}]`,!0),f))}),g)}static isLoadSourceOptionsValid(l,u){const f=[],g="LoadSourceOptions",m=gt.formatDetails(_n(g,u),Un(l));if(m.length)return f.push(...m),f;if(!pt(l.insertBeforeIndex)){const v=gt.formatDetails(_n(g,u,"insertBeforeIndex"),gt.isNumberAndIsInRange(l.insertBeforeIndex));f.push(...v)}if(!pt(l.exception)){const v=gt.formatDetails(_n(g,u,"exception"),gt.isStringAndNotEmpty(l.exception,!1));f.push(...v)}return f}static isHandlerTypeValid(l){return{isValid:xn(l)&&["documentBoundariesDetect","imageFilter"].includes(l)}}static isContainerKeyValid(l,u){const f="container";let g;if(y_(l)&&(g=l),xn(l)){const v=document.getElementById(l);y_(v)&&(g=v)}const m=[];return g||m.push(`${_n(f,u,f)}: ${it.CONTAINER_NOT_EXIST.message}`),m}static isContainerParamValid(l){return xn(l)||y_(l)?this.isContainerKeyValid(l).length>0?it.CONTAINER_NOT_EXIST:null:it.PARAM_INVALID}static isUiConfigValid(l,u){const f="UiConfig",g=[],m=gt.formatDetails(_n(f,u),Un(l));if(m.length)return g.push(...m),g;const v=gt.formatDetails(_n(f,u,"type"),gt.isStringAndNotEmpty(l.type,!1));if(g.push(...v),["id","name","flexDirection","tooltip","className","label"].forEach(_=>{if(!pt(l[_])){const b=gt.formatDetails(_n(f,u,_),gt.isStringAndNotEmpty(l[_]));g.push(...b)}}),["style","events"].forEach(_=>{if(!pt(l[_])){const b=gt.formatDetails(_n(f,u,_),Un(l[_]));g.push(...b)}}),!pt(l.children)){const _=gt.formatDetails(_n(f,u,"children"),gt.isArrayAndMeetMinLength(l.children));if(_.length)return g.push(..._),g;l.children.forEach((b,S)=>{if(xn(b)||Un(b)||g.push(`${f}.children[${S}] is invalid.`),Un(b)){const I=this.isUiConfigValid(b,_n(f,u,`children[${S}]`));g.push(...I)}})}return g}static isDocOptionsValid(l,u){const f=[],g=u||"CreateDocumentOptions",m=gt.formatDetails(_n(g,u),Un(l));if(m.length)return f.push(...m),f;if(!pt(l.name)){const v=gt.formatDetails(_n(g,u,"name"),gt.isStringAndNotEmpty(l.name,!1));f.push(...v)}if(!pt(l.author)){const v=gt.formatDetails(_n(g,u,"author"),gt.isStringAndNotEmpty(l.author,!1));f.push(...v)}if(!pt(l.creationDate)){const v=gt.formatDetails(_n(g,u,"creationDate"),gt.isPdfDate(l.creationDate));f.push(...v)}if(!pt(l.deleteOriginal)){const v=gt.formatDetails(_n(g,u,"deleteOriginal"),Ds(l.deleteOriginal));f.push(...v)}return f}static isTransferOptionsValid(l,u,f,g){const m=[],v="TransferOptions",_=gt.formatDetails(_n(v,g),Un(l));if(_.length)return m.push(..._),m;if(!pt(l.sourceIndices)){const b=this.isNumberArrayValid(l.sourceIndices,u,f,_n(v,g,"sourceIndices"));m.push(...b)}if(!pt(l.insertBeforeIndex)){const b=gt.formatDetails(_n(v,g,"insertBeforeIndex"),gt.isNumberAndIsInRange(l.insertBeforeIndex,0));m.push(...b)}return m}static isNumberArrayValid(l,u,f,g){return this.isTypeArrayValid("number",l,u,f,g)}static isStringArrayValid(l,u){return this.isTypeArrayValid("string",l,void 0,void 0,u)}static isBlobArrayValid(l,u){return this.isTypeArrayValid("blob",l,void 0,void 0,u)}static isTypeArrayValid(l,u,f,g,m){const v=[],_=gt.formatDetails(_n("Array",m),gt.isArrayAndMeetMinLength(u));return _.length?(v.push(..._),v):(u.forEach((b,S)=>{let I=null;"blob"===l?I=ul(b):"number"===l?I=gt.isNumberAndIsInRange(b,f,g):"string"===l&&(I=gt.isStringAndNotEmpty(b));const k=gt.formatDetails(_n("Array",m,`[${S}]`,!0),I);v.push(...k)}),v)}static isUpdatePageOptionsValid(l,u,f){const g=[],m="UpdatePageOptions",v=gt.formatDetails(_n(m,f),Un(l));if(v.length)return g.push(...v),g;if(["fileIndex","width","height","pageWidth","pageHeight","resolutionX","resolutionY","bitDepth"].forEach(_=>{const b=l[_];if(!pt(b)){const S=gt.formatDetails(_n(m,f,_),gt.isNumberAndIsInRange(b,0));g.push(...S)}}),!pt(l.rotation)){const _=this.isRotationValid(l.rotation,_n(m,f));g.push(..._)}if(!pt(l.filter)){const _=this.isFilterTypeValid(l.filter,u,_n(m,f));g.push(..._)}return g}static isRotationValid(l,u){const f=[],g=_n("",u,"rotation"),m=gt.formatDetails(g,gt.isNumberAndIsInRange(l));return m.length?(f.push(...m),f):(f.length||l%90==0||f.push(`'${g}' is not supported.`),f)}static isFilterTypeValid(l,u,f){const g=[],m=_n("",f,"filter"),v=gt.formatDetails(m,gt.isStringAndNotEmpty(l,!1));return v.length?(g.push(...v),g):(!g.length&&"none"!==l&&Di(u)&&u.length>0&&!u.includes(l)&&g.push(`'${m}' is not supported.`),g)}static isSaveJpegSettingsValid(l,u){const f=[],g="SaveJpegSettings",m=gt.formatDetails(_n(g,u),Un(l));if(m.length)return f.push(...m),f;if(!pt(l.quality)){const v=gt.formatDetails(_n(g,u,"quality"),gt.isNumberAndIsInRange(l.quality,0,100));f.push(...v)}if(!pt(l.saveAnnotation)){const v=gt.formatDetails(_n(g,u,"saveAnnotation"),Ds(l.saveAnnotation));f.push(...v)}return f}static isSavePngSettingsValid(l,u){const f=[],g="SavePngSettings",m=gt.formatDetails(_n(g,u),Un(l));if(m.length)return f.push(...m),f;if(!pt(l.saveAnnotation)){const v=gt.formatDetails(_n(g,u,"saveAnnotation"),Ds(l.saveAnnotation));f.push(...v)}return f}static isSavePdfSettingsValid(l,u){const f=[],g="SavePdfSettings",m=gt.formatDetails(_n(g,u),Un(l));if(m.length)return f.push(...m),f;if(["author","creator","keyWords","producer","subject","title"].forEach(v=>{const _=l[v];if(!pt(_)){const b=gt.formatDetails(_n(g,u,v),gt.isStringAndNotEmpty(_,!1));f.push(...b)}}),!pt(l.compression)){const v=gt.formatDetails(_n(g,u,"compression"),BO.has(l.compression));f.push(...v)}if(!pt(l.creationDate)){const v=gt.formatDetails(_n(g,u,"creationDate"),gt.isPdfDate(l.creationDate));f.push(...v)}if(!pt(l.modifiedDate)){const v=gt.formatDetails(_n(g,u,"modifiedDate"),gt.isPdfDate(l.modifiedDate));f.push(...v)}if(!pt(l.pageType)){const v=gt.formatDetails(_n(g,u,"pageType"),NO.has(l.pageType));f.push(...v)}if(!pt(l.version)){const v=gt.formatDetails(_n(g,u,"version"),this.isPdfVersionValid(l.version));f.push(...v)}if(!pt(l.mimeType)){const v=gt.formatDetails(_n(g,u,"mimeType"),gt.isStringAndNotEmpty(l.mimeType));f.push(...v)}if(!pt(l.quality)){const v=gt.formatDetails(_n(g,u,"quality"),gt.isNumberAndIsInRange(l.quality,0,100));f.push(...v)}if(!pt(l.password)){const v=gt.formatDetails(_n(g,u,"password"),gt.isStringAndNotEmpty(l.password));f.push(...v),!v.length&&l.password.length>32&&f.push("The specified password exceeds 32 characters.")}if(!pt(l.saveAnnotation)){const v=gt.formatDetails(_n(g,u,"saveAnnotation"),["none","image","annotation","flatten"].includes(l.saveAnnotation));f.push(...v)}if(!pt(l.imageScaleFactor)){const v=gt.formatDetails(_n(g,u,"imageScaleFactor"),gt.isNumberAndIsInRange(l.imageScaleFactor,Number.MIN_VALUE,1));f.push(...v)}return f}static isPdfVersionValid(l){return!!xn(l)&&["1.1","1.2","1.3","1.4","1.5","1.6","1.7"].includes(l.trim())}static isSaveTiffSettingsValid(l,u){const f=[],g="SaveTiffSettings",m=gt.formatDetails(_n(g,u),Un(l));if(m.length)return f.push(...m),f;if(!pt(l.compression)){const v=gt.formatDetails(_n(g,u,"compression"),HE.has(l.compression));f.push(...v)}if(!pt(l.customTag)){const v=gt.formatDetails(_n(g,u,"customTag"),gt.isArrayAndMeetMinLength(l.customTag));f.push(...v),v.length||l.customTag.forEach((_,b)=>{const S=this.isTiffCustomTagValid(_,_n(g,u,`customTag[${b}]`));f.push(...S)})}if(!pt(l.quality)){const v=gt.formatDetails(_n(g,u,"quality"),gt.isNumberAndIsInRange(l.quality,0,100));f.push(...v)}return f}static isTiffCustomTagValid(l,u){const f=[],g="CustomTag",m=gt.formatDetails(_n(g,u),Un(l));if(m.length)return f.push(...m),f;if(!pt(l.content)){const v=gt.formatDetails(_n(g,u,"content"),gt.isStringAndNotEmpty(l.content,!1));f.push(...v)}if(!pt(l.contentIsBase64)){const v=gt.formatDetails(_n(g,u,"contentIsBase64"),Ds(l.contentIsBase64));f.push(...v)}if(!pt(l.id)){const v=gt.formatDetails(_n(g,u,"id"),gt.isNumberAndIsInRange(l.id));f.push(...v)}return f}static isVideoDeviceInfo(l,u){const f=[],g=gt.formatDetails(u,Un(l));f.push(...g);const m=gt.formatDetails(_n(u,void 0,"deviceId"),gt.isStringAndNotEmpty(l.deviceId,!1));f.push(...m);const v=gt.formatDetails(_n(u,void 0,"label"),gt.isStringAndNotEmpty(l.label,!1));return f.push(...v),f}static isVideoConfig(l,u){const f=[],g=gt.formatDetails(u,Un(l));if(g.length)return f.push(...g),f;if(!pt(l.fill)){const m=gt.formatDetails(_n(u,void 0,"fill"),Ds(l.fill));f.push(...m)}if(!pt(l.resolution)){const m=_o.isNumberArrayValid(l.resolution,0,void 0,_n(u,void 0,"resolution"));f.push(...m)}return f}static isZoomOriginValid(l){const u=[],f=gt.formatDetails("zoomOrigin",Un(l));return f.length?(u.push(...f),u):(["x","y"].forEach(g=>{const m=l[g];pt(m)?u.push(`ZoomOrigin.${g} is missing.`):["start","center","end"].includes(m)||u.push(`ZoomOrigin.${g} is valid.`)}),u)}static isAnnotationOptionsValid(l,u,f){const g=[],m=["x","y","rotation"],v=["width","height","borderWidth","opacity","miterLimit","fontSize"],_=["borderColor","background","icon","lineCap","lineJoin","textAlign","content","color","fontFamily","fontWeight","fontStyle"],b=["fontWeight"],S=["fontStyle"],I=["points"],k=["textContents"],O=["startPoint","endPoint"],j=["flags"],W=["underline","lineThrough"],J=["stamp"],K=["lineDash"];if("textTypewriter"===f){const{textContents:oe}=l;if(oe&&(!Di(oe)||!oe.length||oe.find(le=>!Un(le))||oe.every(le=>""===le.content||null==le.content)))return g.push(`${u}.textContents is invalid`),g}const Q=oe=>!!Un(oe)&&!!Xt(null==oe?void 0:oe.x)&&!!Xt(null==oe?void 0:oe.y),ie=oe=>{if(!Di(oe)||oe.length<2)return!1;for(let le=0;le<oe.length;le++)if(!Q(oe[le]))return!1;return!0};return Object.keys(l).forEach(oe=>{const le=l[oe];let he=!0;var _e;(m.includes(oe)&&!Xt(le)||v.includes(oe)&&!FL(le)||_.includes(oe)&&!xn(le)||k.includes(oe)&&!(Ve=>{if(!Di(Ve))return!1;for(let ee=0;ee<Ve.length;ee++){const ke=Ve[ee];if(!Un(ke))return!1;const xe=Object.keys(ke);for(let Le=0;Le<xe.length;Le++){const V=xe[Le],F=ke[V];if(m.includes(V)&&!Xt(F)||v.includes(V)&&!FL(F)||_.includes(V)&&!xn(F)||W.includes(V)&&!Ds(F)||b.includes(V)&&!["normal","bold"].includes(F)||S.includes(V)&&!["normal","italic"].includes(F))return!1}}return!0})(le)||O.includes(oe)&&!Q(le)||j.includes(oe)&&!Un(le)||J.includes(oe)&&![Ri.REJECTED,Ri.ACCEPTED,Ri.INITIAL_HERE,Ri.SIGN_HERE,Ri.WITNESS,Ri.APPROVED,Ri.NOT_APPROVED,Ri.DRAFT,Ri.FINAL,Ri.COMPLETED,Ri.CONFIDENTIAL,Ri.VOID].includes(_e=le)&&!ul(_e)||K.includes(oe)&&!(Ve=>{if(!Di(Ve))return!1;for(let ee=0;ee<Ve.length;ee++)if(!FL(Ve[ee]))return!1;return!0})(le))&&(he=!1),I.includes(oe)&&("ink"===f?(Ve=>{if(!Di(Ve)||!Ve.length)return!1;for(let ee=0;ee<Ve.length;ee++)if(!ie(Ve[ee]))return!1;return!0})(l[oe])||(he=!1):ie(l[oe])||(he=!1)),he||g.push(`${u}.${oe} is invalid`)}),g}}var $s=new WeakMap,nf=new WeakMap,Qd=new WeakSet;class n4e{constructor(l,u){al(this,Qd),bi(this,$s,void 0),bi(this,nf,void 0),Bn($s,this,l),Bn(nf,this,u)}get name(){return Ye(nf,this).name}get uid(){return Ye(nf,this).uid}get pages(){return Ye(nf,this).pages.slice()}get creationDate(){return Ye(nf,this).creationDate}get author(){return Ye(nf,this).author}loadSource(l,u){var f=this;return Fe(function*(){const g="IDocument.loadSource",m="sources";return xi.makeSureLoadLicenseExist(),Cn(l,0,g,m),function(v,_,b,S,I){let k=[];Di(v)?k=ul(v[0])?v.reduce((O,j,W)=>{if(!ul(j)){const J=gt.formatDetails(_n("Array",I,`[${W}]`,!0),!1);O.push(...J)}return O},[]):_o.isSourcesValid(v,void 0,_):ul(v)||(k=_o.isSourceValid(v,void 0,_)),!k.length||gt.output(0,"IDocument.loadSource",I,k)}(l,Ye($s,f).filterService.getSupportedFilters().map(v=>v.type),0,0,m),Un(u)?function(v,_,b,S){const I=_o.isLoadSourceOptionsValid(v,void 0);!I.length||gt.output(0,"IDocument.loadSource","loadSourceOptions",I)}(u):pt(u)||Jd(u,0,g,"index",0),Di(l)||(l=[l]),ul(l[0])&&(l=l.map(v=>({fileData:v}))),Ye($s,f).loadSource(l,f.uid,u).catch(v=>it.reject(v,g))})()}getPageData(l){var u=this;return Fe(function*(){const f="IDocument.getPageData",g="pageUid";Cn(l,0,f,g),ar(l,0,f,g,!1),u.pages.includes(l)||gt.error(f,g,void 0,it.PAGE_NOT_EXIST);const m=yield Ye($s,u).getPageData(l);m.raw&&(m.raw={data:m.raw.data,width:m.raw.width,height:m.raw.height}),m.display&&(m.display={data:m.display.data,width:m.display.width,height:m.display.height}),m.thumbnail&&(m.thumbnail={data:m.thumbnail.data,width:m.thumbnail.width,height:m.thumbnail.height}),m.rotation&&(m.rotation%=360);const{displayResolution:v,dataResolution:_}=Vn;return m.mediaBox=Pne(Kn(m.mediaBox,v,_),2),m.cropBox=Pne(Kn(m.cropBox,v,_),2),m})()}updatePage(l,u,f){var g=this;return Fe(function*(){const m="IDocument.updatePage",v="pageUid";return Cn(l,0,m,v),Cn(u,0,m,"data"),ar(l,0,m,v,!1),yD(g.pages,l,0,m),ul(u)||gt.output(0,"IDocument.updatePage","data",void 0,it.PARAM_INVALID),!pt(f)&&function(b,S,I,k){const O=_o.isUpdatePageOptionsValid(b,S,"updatePageOptions");!O.length||gt.output(0,"IDocument.updatePage","options",O)}(f,Ye($s,g).filterService.getSupportedFilters().map(b=>b.type)),Ye($s,g).updatePage(l,u,f)})()}deletePages(l){const u="IDocument.deletePages",f="indices";if(Cn(l,1,u,f)||!Tp(l,1,u,f,0,Fh(Qd,this,rf)-1))return!1;const g=l.map(m=>Ye(nf,this).pages[m]);return Ye($s,this).deletePages(this.uid,g)}deleteAllPages(){return Ye(nf,this).pages.slice(),Ye($s,this).deleteAllPages(this.uid)}movePages(l,u){const f="IDocument.movePages",g="indices";Cn(l,0,f,g),Tp(l,0,f,g,0,Fh(Qd,this,rf)-1),pt(u)||Jd(u,0,f,"insertBeforeIndex",0),u=u>Fh(Qd,this,rf)-1?void 0:u,Ye($s,this).movePages(this.uid,l,u)}switchPage(l,u){const f="IDocument.switchPage",g="oneIndex",m="anotherIndex";Cn(l,0,f,g),Cn(u,0,f,m),Jd(l,0,f,g,0,Fh(Qd,this,rf)-1),Jd(u,0,f,m,0,Fh(Qd,this,rf)-1),Ye($s,this).documentService.swapPages(this.uid,l,u)}rename(l){const u="IDocument.rename",f="name";return!Cn(l,1,u,f)&&!!ar(l,1,u,f)&&Ye($s,this).documentService.renameDocument(this.uid,l)}setPageCustomData(l,u){const f="IDocument.setPageCustomData",g="pageUid";return Cn(l,0,f,g),Cn(u,0,f,"data"),ar(l,0,f,g,!1),yD(this.pages,l,0,f),Ye($s,this).setCustomData(l,u)}getPageCustomData(l){const u="IDocument.getPageCustomData",f="pageUid";return Cn(l,0,u,f),ar(l,0,u,f,!1),yD(this.pages,l,0,u),Ye($s,this).getCustomData(l)}saveToJpeg(l,u){var f=this;return Fe(function*(){const g="IDocument.saveToJpeg",m="index";Cn(l,0,g,m),Jd(l,0,g,m,0,Fh(Qd,f,rf)-1),pt(u)||function(_,b,S){const I=_o.isSaveJpegSettingsValid(_);!I.length||gt.output(0,"IDocument.saveToJpeg","saveJpegSettings",I)}(u);const v=f.pages[l];return Ye($s,f).fileSaveService.saveToJpeg(v,u).catch(_=>it.reject(_,g))})()}saveToPng(l,u){const f="IDocument.saveToPng",g="index";Cn(l,0,f,g),Jd(l,0,f,g,0,Fh(Qd,this,rf)-1),pt(u)||function(v,_,b){const S=_o.isSavePngSettingsValid(v);S.length&&gt.output(0,"IDocument.saveToPng","savePngSettings",S)}(u);const m=this.pages[l];return Ye($s,this).fileSaveService.saveToPng(m,u).catch(v=>it.reject(v,f))}saveToPdf(l,u){const f="IDocument.saveToPdf";0===this.pages.length&&it.throw(it.DOC_NO_IMAGE),Di(l)?Tp(l,0,f,"indices",0,Fh(Qd,this,rf)-1):(u=l,l=Array.from(Array(this.pages.length).keys())),pt(u)||function(m,v,_){const b=_o.isSavePdfSettingsValid(m);!b.length||gt.output(0,"IDocument.saveToPdf","savePdfSettings",b)}(u);const g=[];l.forEach(m=>{g.push(this.pages[m])});try{!u||"annotation"!==u.saveAnnotation&&"flatten"!==u.saveAnnotation||xi.makeSureAnnotationLicenseExist()}catch(m){return Promise.reject(m)}return Ye($s,this).fileSaveService.saveToPdf(g,u).catch(m=>it.reject(m,f))}saveToTiff(l,u){const f="IDocument.saveToTiff";0===this.pages.length&&it.throw(it.DOC_NO_IMAGE),Di(l)?Tp(l,0,f,"indices",0,Fh(Qd,this,rf)-1):(u=l,l=Array.from(Array(this.pages.length).keys())),pt(u)||function(m,v,_){const b=_o.isSaveTiffSettingsValid(m);!b.length||gt.output(0,"IDocument.saveToTiff","saveTiffSettings",b)}(u);const g=[];return l.forEach(m=>{g.push(this.pages[m])}),Ye($s,this).fileSaveService.saveToTiff(g,u).catch(m=>it.reject(m,f))}print(l,u){const f="IDocument.print";let g,m=u;var v;Di(l)?(Tp(l,0,f,"indices",0,Fh(Qd,this,rf)-1),g=l):m=l,pt(m)||pt(null===(v=m)||void 0===v?void 0:v.printAnnotation)||Ds(m.printAnnotation)||gt.error(f,"setting.printAnnotation",void 0,it.PARAM_INVALID),0===this.pages.length&&it.throw(it.DOC_NO_IMAGE),Ye($s,this).printPages(this.uid,g,m)}insertBlankPage(l,u,f){const g="IDocument.insertBlankPage",m="pageWidth",v="pageHeight";return xi.makeSureLoadLicenseExist(),Cn(l,0,g,m),Cn(u,0,g,v),Jd(l,0,g,m,.72,7200),Jd(u,0,g,v,.72,7200),pt(f)||Jd(f,0,g,"insertBeforeIndex",0),Ye($s,this).insertBlankPage(this.uid,Math.floor(Kn(l,Vn.dataResolution,72))||1,Math.floor(Kn(u,Vn.dataResolution,72))||1,72,72,f)}}function rf(p){return Ye(nf,p).pages.length}function Pne(p,l){let u=!0;const f=Wh(p.left,l),g=Wh(p.top,l),m=Wh(p.width,l),v=Wh(p.height,l),_=1e-7;return(Math.abs(f-p.left)>_||Math.abs(g-p.top)>_||Math.abs(m-p.width)>_||Math.abs(v-p.height)>_)&&(u=!1),u?{left:f,top:g,width:m,height:v}:p}function Rne(p,l,u,f,g){if(!pt(p)){const m="transferOptions",v=_o.isTransferOptionsValid(p,l,u,m);if(v.length)return gt.output(f,g,m,v)}return!0}function kne(p,l,u,f){if(!pt(p)){const g=_o.isDocOptionsValid(p);if(g.length)return gt.output(l,u,f,g)}return!0}function Mne(p,l,u,f,g){const m=l.reduce((v,_,b)=>(p.has(_)||v.push(`${g}[${b}]:The specified document(s) do not exist.`),v),[]);return!m.length||gt.output(u,f,g,m,it.DOC_NOT_EXIST,!0)}const One=["documentCreated","documentDeleted","pagesAdded","pagesDeleted"];var Zd=new WeakMap,ml=new WeakMap,of=new WeakMap;const Fne=new class extends rr{constructor(){super(),bi(this,Zd,void 0),bi(this,ml,void 0),bi(this,of,void 0),Bn(of,this,new Bh),Bn(Zd,this,Br),Bn(ml,this,new Map),Br.onUnload.on(()=>{Ye(ml,this).clear(),Ye(of,this).removeAllEventListeners()},this);const{documentService:p}=Br;p.onDocumentCreated.on(l=>{const u=Ye(Zd,this).getDocument(l.docUid),f=new n4e(Ye(Zd,this),u);Ye(ml,this).set(f.uid,f),Ye(of,this).emit("documentCreated",l)},this),p.onDocumentDeleted.on(l=>{Ye(ml,this).has(l.docUid)&&Ye(ml,this).delete(l.docUid),Ye(of,this).emit("documentDeleted",l)},this),p.onPagesAdded.on(l=>{l.indices.length&&l.pageUids.length&&Ye(of,this).emit("pagesAdded",l)},this),p.onDeletePagesFromDoc.on(l=>{Ye(of,this).emit("pagesDeleted",l)},this),p.onDeleteAllPagesFromDoc.on(l=>{Ye(of,this).emit("pagesDeleted",l)},this)}createDocument(p){kne(p,0,"DocumentManager.createDocument","createDocumentOptions");const l=Ye(Zd,this).createDocument(p);return Ye(ml,this).get(l.uid)}getDocument(p){const l="DocumentManager.getDocument",u="docUid";Cn(p,0,l,u),ar(p,0,l,u);const f=Ye(ml,this).get(p);return f||gt.error(l,u,void 0,it.DOC_NOT_EXIST),f}getAllDocuments(){return Array.from(Ye(ml,this).values())}deleteDocuments(p){const l="DocumentManager.deleteDocuments",u="docUids";return!(Cn(p,1,l,u)||!Dw(p,1,l,u,void 0,!1)||!Mne(Ye(ml,this),p,1,l,u))&&Ye(Zd,this).deleteDocuments([...new Set(p)])}deleteAllDocuments(){const p=Ye(Zd,this).documentService.getAllDocuments();return Ye(Zd,this).deleteDocuments(p.map(l=>l.uid))}copyPagesToDocument(p,l,u){const f="DocumentManager.copyPagesToDocument",g="sourceDocUid",m="targetDocUid";Cn(p,0,f,g),Cn(l,0,f,m),ar(p,0,f,g),ar(l,0,f,m);const v=Ye(ml,this).get(p),_=Ye(ml,this).get(l);return v&&_||it.throw(it.DOC_NOT_EXIST,f),Rne(u,0,v.pages.length-1,0,f),Ye(Zd,this).transferDocument(p,l,Ht(qe({},u),{copy:!0}))}movePagesToDocument(p,l,u){const f="DocumentManager.movePagesToDocument",g="sourceDocUid",m="targetDocUid";Cn(p,0,f,g),Cn(l,0,f,m),ar(p,0,f,g),ar(l,0,f,m);const v=Ye(ml,this).get(p),_=Ye(ml,this).get(l);return v&&_||it.throw(it.DOC_NOT_EXIST,f),Rne(u,0,v.pages.length-1,0,f),Ye(Zd,this).transferDocument(p,l,u)}mergeDocuments(p,l){const u="DocumentManager.mergeDocuments",f="docUids";var m;Cn(p,0,u,f),Dw(p,0,u,f,void 0,!1),m=p,new Set(m).size!==m.length&&gt.error(void 0,void 0,void 0,it.DOC_UID_DUPLICATE),Mne(Ye(ml,this),p,0,u,f),kne(l,0,u,"mergeDocumentOptions");const g=Ye(Zd,this).mergeDocuments(p,l);return Ye(ml,this).get(g.uid)}on(p,l){const u="DocumentManager.on";!Cn(p,1,u,"eventName")&&!Cn(l,1,u,"listener")&&ar(p,1,u,"eventName",!1)&&ef(l,u,"listener",1)&&(One.includes(p)?Ye(of,this).on(p,l):it.warning(it.PARAM_NOT_SUPPORT,u,"eventName"))}off(p,l){const u="DocumentManager.off";!Cn(p,1,u,"eventName")&&ar(p,1,u,"eventName",!1)&&(pt(l)||ef(l,u,"listener",1))&&(One.includes(p)?Ye(of,this).off(p,l):it.warning(it.PARAM_NOT_SUPPORT,u,"eventName"))}},Lne=`${(()=>{if(!bv&&document.currentScript){let{src:p}=document.currentScript;const l=p.indexOf("?");if(-1!==l)p=p.substring(0,l);else{const u=p.indexOf("#");-1!==u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})()}engine`;var ED=new WeakMap,DD=new WeakMap,Rw=new WeakMap;const i4e=new class{constructor(){bi(this,ED,""),bi(this,DD,""),bi(this,Rw,Lne)}get versionInfo(){return{viewer:RZ,engine:gn.version}}set engineResourcePath(p){xn(p)?Bn(Rw,this,p):it.throw(it.PARAM_INVALID,"Core.engineResourcePath","engineResourcePath")}get engineResourcePath(){return Ye(Rw,this)}set license(p){(function(l,u,f,g){const m=gt.formatError({isValid:_o.isLicenseValid(l)});!m||gt.output(0,"Core.license","license",void 0,m)})(p),Bn(DD,this,p)}get license(){return Ye(DD,this)}set deviceFriendlyName(p){xn(p)?Bn(ED,this,p):it.throw(it.PARAM_INVALID,"Core.deviceFriendlyName","deviceFriendlyName")}get deviceFriendlyName(){return Ye(ED,this)}loadWasm(){return function(){var p=Fe(function*(l){let u=l.trim();if(u.endsWith("/")||(u=`${u}/`),gn.resourceDir=u,!(yield gn.isResourceDirValid()))return it.reject(it.RESOURCE_NOT_FOUND,"DDV.Core.loadWasm");yield gn.preloadModule("core");const f=gn.preloadModule("proc"),g=gn.preloadModule("pdf");yield Promise.all([f,g])});return function(l){return p.apply(this,arguments)}}()(Ye(Rw,this))}init(){return function HDe(p){return P5.apply(this,arguments)}({license:Ye(DD,this),engineResourcePath:Ye(Rw,this),deviceFriendlyName:Ye(ED,this)})}};var LL;!function(p){p.NONE="none",p.BLACK_AND_WHITE="blackAndWhite",p.GRAY="gray",p.REMOVE_SHADOW="removeShadow",p.SAVE_INK="saveInk",p.ENHANCE="enhance",p.INVERT="invert"}(LL||(LL={}));const NL=[],Ip={documentManager:Fne,Core:i4e,Elements:Sn,DocumentDetect:_Z,ImageFilter:class{constructor(){al(this,m5)}get defaultFilterType(){return Ys.NONE}applyFilter(p,l,u,f){var g=this;return Fe(function*(){const m=new Ng,v=at(m5,g,mDe).call(g,l,u),_=at(m5,g,vDe).call(g,qe({outputType:p.type},f||{}));let b;try{const S=yield m.initImage({source:p.data,isRGBA:p.type===Tr.RGBA,width:p.width,height:p.height,isBGRA:p.type===Tr.BGRA});let I;S.srcBuffer&&(p.data=S.srcBuffer),l===Ys.NONE?(I=yield m.getImage({jpegQuality:_.jpegQuality,ifDeleteObject:!0,isRGBA:p.type===Tr.RGBA,bitDepth:_.bitDepth,xDpi:_.xdpi,yDpi:_.ydpi,returnBlob:!1,returnType:Bx[_.outputType]}),m.freeReservedData()):I=yield m.filter(bZ.get(l),v,_),b=new Blob([I.imageData],{type:I.blobType})}finally{m.terminate()}return b})()}querySupported(){return[{type:Ys.NONE,label:"Original"},{type:Ys.BLACK_AND_WHITE,label:"B&W"},{type:Ys.GRAY,label:"Grayscale"},{type:Ys.SAVE_INK,label:"Save Toner"}]}destroy(){}},BrowseViewer:class Zke extends nne{constructor(l){super(l,"BrowseViewer")}get currentDocument(){return this.vCommon.getCurrentDocument(this.v)}bindContainer(l){this.vCommon.bindContainer(this.v,l,`${this.errorPrefix}.bindContainer`)}unbindContainer(){this.vCommon.unbindContainer(this.v)}openDocument(l){this.vCommon.openDocument(l,this.uid,`${this.errorPrefix}.openDocument`)}closeDocument(){return this.vCommon.closeDocument(this.v,`${this.errorPrefix}.closeDocument`)}rotate(l,u){return this.vCommon.rotate(this.v,l,u,`${this.errorPrefix}.rotate`)}indexToUid(l){return this.vCommon.indexToUid(this.v,l,`${this.errorPrefix}.indexToUid`)}uidToIndex(l){return this.vCommon.uidToIndex(this.v,l,`${this.errorPrefix}.uidToIndex`)}getCurrentPageUid(){return this.vCommon.getCurrentPageUid(this.v)}getCurrentPageIndex(){return this.vCommon.getCurrentPageIndex(this.v)}getPageCount(){return this.vCommon.getPageCount(this.v)}goToPage(l){return this.vCommon.gotoPage(this.v,l,`${this.errorPrefix}.goToPage`)}saveOperations(){return this.vCommon.saveOperation(this.v)}destroy(){this.vCommon.destroy(this.v)}},CaptureViewer:class xke{constructor(l){var u;al(this,Qte),bi(this,Si,void 0),bi(this,ja,new _D),N(this,"uid",void 0),N(this,"groupUid",void 0),N(this,"postfix",void 0);const f=`new ${Ul}`;xi.makeSureCoreLicenseExist(),xi.makeSureCameraLicenseExist(),pt(l)||Iw(l,"captureViewer",0,f,"option");const g=yo((null==l?void 0:l.viewerConfig)||{},hn(Ht(qe({},bke),{viewerMode:qo.CAPTURE}))),m=ir()?jte:Gte;Bn(Si,this,Br.createViewer(Ht(qe({uiConfig:hn(m)},l),{viewerConfig:g}))),null!=l&&null!==(u=l.viewerConfig)&&void 0!==u&&u.enableAutoDetect&&!Ye(Si,this).context.core.detectorService.enableDetect&&it.warning(it.DOC_DETECT_MISS),this.uid=Ye(Si,this).uid,this.groupUid=Ye(Si,this).groupUid,this.postfix=Ye(Si,this).postfix,at(Qte,this,wke).call(this)}get isVisible(){return Ye(ja,this).getIsVisible(Ye(Si,this))}get isBoundContainer(){return Ye(ja,this).getIsBoundContainer(Ye(Si,this))}get currentDocument(){return Ye(ja,this).getCurrentDocument(Ye(Si,this))}get acceptedPolygonConfidence(){return Ye(Si,this).getCameraConfig().acceptedPolygonConfidence}set acceptedPolygonConfidence(l){const u="acceptedPolygonConfidence";Jd(l,1,`${Ul}.${u}`,u,0,100)&&Ye(Si,this).updateCameraConfig({acceptedPolygonConfidence:l})}get maxFrameNumber(){return Ye(Si,this).getCameraConfig().maxFrameNumber}set maxFrameNumber(l){const u="maxFrameNumber";Jd(l,1,`${Ul}.${u}`,u,1e-6,60)&&Ye(Si,this).updateCameraConfig({maxFrameNumber:l})}get enableAutoDetect(){return Ye(Si,this).getCameraConfig().enableAutoDetect}set enableAutoDetect(l){const u="enableAutoDetect",f=`${Ul}.${u}`;IL(l,f,u,1)&&(l&&!Ye(Si,this).context.core.detectorService.enableDetect&&gt.warning(f,void 0,void 0,it.DOC_DETECT_MISS),Ye(Si,this).updateCameraConfig({enableAutoDetect:l}))}get enableAutoCapture(){return Ye(Si,this).getCameraConfig().enableAutoCapture}set enableAutoCapture(l){const u="enableAutoCapture";IL(l,`${Ul}.${u}`,u,1)&&Ye(Si,this).updateCameraConfig({enableAutoCapture:l})}bindContainer(l){Ye(ja,this).bindContainer(Ye(Si,this),l,`${Ul}.bindContainer`)}unbindContainer(){Ye(ja,this).unbindContainer(Ye(Si,this))}show(){Ye(ja,this).show(Ye(Si,this))}hide(){Ye(ja,this).hide(Ye(Si,this))}getUiConfig(){return Ye(ja,this).getUiConfig(Ye(Si,this))}updateUiConfig(l){return Ye(ja,this).updateUiConfig(Ye(Si,this),l,"captureViewer",`${Ul}.updateUiConfig`)}openDocument(l){Ye(ja,this).openDocument(l,this.uid,`${Ul}.openDocument`)}closeDocument(){return Ye(ja,this).closeDocument(Ye(Si,this),`${Ul}.closeDocument`)}getStyle(l){return Ye(ja,this).getStyle(Ye(Si,this),"capture",l,Jte,`${Ul}.getStyle`)}updateStyle(l,u){return Ye(ja,this).updateStyle(Ye(Si,this),l,u,Jte,`${Ul}.updateStyle`)}capture(){return Ye(Si,this).isVideoPlaying()?Ye(Si,this).context.viewService.isBindContainer?Ye(Si,this).capture():it.reject(it.CONTAINER_NO_BOUND):it.reject(it.CAMERA_NO_VIDEO)}play(l){const u=`${Ul}.play`;if(!pt(l)){const f=function(g,m,v,_){const b=_o.isVideoConfig(g,_);return!b.length||gt.output(2,v,_,b)}(l,0,u,"config");if(!0!==f)return f}return Ye(Si,this).play(l).catch(f=>it.reject(f,u))}stop(){Ye(Si,this).stop()}getCurrentCamera(){return Ye(Si,this).getCurrentCamera()}getAllCameras(){return Ye(Si,this).getAllCameras()}selectCamera(l){const u=`${Ul}.selectCamera`,f="cameraObjectOrDeviceID",g=Cn(l,2,u,f);if(g)return g;if(xn(l)){const m=ar(l,2,u,f,!1);if(!0!==m)return m}else{const m=function(v,_,b,S){const I=_o.isVideoDeviceInfo(v,S);return!I.length||gt.output(2,b,S,I)}(l,0,u,f);if(!0!==m)return m}return Ye(Si,this).selectCamera(l).catch(m=>it.reject(m,u,f))}getCurrentResolution(){return Ye(Si,this).getCurrentResolution()}turnOnTorch(){return Ye(Si,this).turnOnTorch().catch(l=>it.reject(l))}turnOffTorch(){return Ye(Si,this).turnOffTorch().catch(l=>it.reject(l))}on(l,u){Ye(ja,this).on(Ye(Si,this),`${Ul}.on`,l,u)}off(l,u){Ye(ja,this).off(Ye(Si,this),`${Ul}.off`,l,u)}destroy(){Ye(ja,this).destroy(Ye(Si,this))}},CustomViewer:class e4e{constructor(l){al(this,bne),bi(this,qu,void 0),bi(this,Qv,void 0),bi(this,TD,!1),N(this,"uid",void 0),N(this,"isDestroyed",!1),N(this,"postfix",void 0),this.uid=Ai(),this.postfix=`-${this.uid}`,Bn(Qv,this,new Bh),pt(l)||Iw(l,"customViewer",0,"new CustomViewer","option");let u=null==l?void 0:l.uiConfig;(!u||Un(u)&&0===Object.keys(u).length)&&(u={type:"Layout"}),at(bne,this,t4e).call(this),Bn(qu,this,new lc({container:null==l?void 0:l.container,emitter:Ye(Qv,this),postfix:this.uid,uiConfig:u,injection:{viewer:{postfix:this.postfix}}})),null!=l&&l.container&&u&&Ye(qu,this).bindContainer(l.container)}get isBoundContainer(){return Ye(TD,this)}get isVisible(){return"none"!==Ye(qu,this).rootDom.style.display}bindContainer(l){const u="CustomViewer.bindContainer";Cn(l,0,u,"container");const f=_o.isContainerParamValid(l);f&&gt.error(u,"container",void 0,f),Ye(qu,this).bindContainer(l)&&Bn(TD,this,!0)}unbindContainer(){Ye(qu,this).unbindContainer(),Bn(TD,this,!1)}hide(){Ye(qu,this).rootDom.style.display="none"}show(){Ye(qu,this).rootDom.style.display="flex"}getUiConfig(){return Ye(qu,this).uiConfig}updateUiConfig(l){const u="CustomViewer.updateUiConfig",f="uiConfig";return!(Cn(l,1,u,f)||!Kte(l,"customViewer",u,f,1))&&Ye(qu,this).updateUiConfig(l)}on(l,u){const f="CustomViewer.on";!Cn(l,1,f,"eventName")&&!Cn(u,1,f,"listener")&&ar(l,1,f,"eventName",!1)&&ef(u,f,"listener",1)&&Ye(Qv,this).on(l,u)}off(l,u){const f="CustomViewer.off";!Cn(l,1,f,"eventName")&&ar(l,1,f,"eventName",!1)&&(pt(u)||ef(u,f,"listener",1))&&Ye(Qv,this).off(l,u)}destroy(){this.isDestroyed||(Ye(qu,this).dispose(),Ye(Qv,this).destroy(),Bn(qu,this,null),Bn(Qv,this,null)),this.isDestroyed=!0,Object.setPrototypeOf(this,null)}},EditViewer:mne,PerspectiveViewer:class Jke{constructor(l){al(this,Cne),bi(this,di,void 0),bi(this,To,new _D),N(this,"uid",void 0),N(this,"groupUid",void 0),N(this,"postfix",void 0),xi.makeSureCoreLicenseExist(),pt(l)||Iw(l,"perspectiveViewer",0,`new ${Ha}`,"option");const u=yo((null==l?void 0:l.viewerConfig)||{},hn(Ht(qe({},Kke),{viewerMode:qo.PERSPECTIVE,toolMode:"crop"}))),f=ir()?Hte:zte;Bn(di,this,Br.createViewer(Ht(qe({uiConfig:hn(f)},l),{viewerConfig:u}))),this.uid=Ye(di,this).uid,this.groupUid=Ye(di,this).groupUid,this.postfix=Ye(di,this).postfix,at(Cne,this,Qke).call(this)}get isVisible(){return Ye(To,this).getIsVisible(Ye(di,this))}get isBoundContainer(){return Ye(To,this).getIsBoundContainer(Ye(di,this))}get currentDocument(){return Ye(To,this).getCurrentDocument(Ye(di,this))}bindContainer(l){Ye(To,this).bindContainer(Ye(di,this),l,`${Ha}.bindContainer`)}unbindContainer(){Ye(To,this).unbindContainer(Ye(di,this))}show(){Ye(To,this).show(Ye(di,this))}hide(){Ye(To,this).hide(Ye(di,this))}getUiConfig(){return Ye(To,this).getUiConfig(Ye(di,this))}updateUiConfig(l){return Ye(To,this).updateUiConfig(Ye(di,this),l,"perspectiveViewer",`${Ha}.updateUiConfig`)}openDocument(l){Ye(To,this).openDocument(l,this.uid,`${Ha}.openDocument`)}closeDocument(){return Ye(To,this).closeDocument(Ye(di,this),`${Ha}.closeDocument`)}getStyle(l){return Ye(To,this).getStyle(Ye(di,this),"perspective",l,_ne,`${Ha}.getStyle`)}updateStyle(l,u){const f=`${Ha}.updateStyle`;return Ye(To,this).updateStyle(Ye(di,this),l,u,_ne,f)}setQuadSelection(l){const u=`${Ha}.setQuadSelection`,f="quad";if(Cn(l,1,u,f)||!vne(l,1,u,f)||!Qo(Ye(di,this),1)||hc(u,void 0,Ye(di,this),1))return!1;const{width:g,height:m}=Ye(di,this).getRealPixelSize();return!yne(l,1,g,m)&&Ye(di,this).setQuadBox(l)}getQuadSelection(){const l=`${Ha}.getQuadSelection`;return!Qo(Ye(di,this),1)||hc(l,void 0,Ye(di,this),1)?null:Ye(di,this).getQuadBox()}resetQuadSelection(l){const u=`${Ha}.resetQuadSelection`;return!(!Qo(Ye(di,this),1)||hc(u,void 0,Ye(di,this),1)||!pt(l)&&!Tp(l,1,u,"indices",0,Ye(di,this).getPageCounts()-1))&&Ye(di,this).resetQuadBox(l)}applyPerspective(l){const u=`${Ha}.applyPerspective`,f="quad";Cn(l,0,u,f),vne(l,0,u,f),Qo(Ye(di,this),0),hc(u,void 0,Ye(di,this),0);const{width:g,height:m}=Ye(di,this).getRealPixelSize();return yne(l,0,g,m),Ye(di,this).perspectivePage(l)}rotate(l,u){const f=`${Ha}.rotate`;return Ye(To,this).rotate(Ye(di,this),l,u,f)}saveOperations(){return Ye(To,this).saveOperation(Ye(di,this))}goToPage(l){const u=`${Ha}.goToPage`;return Ye(To,this).gotoPage(Ye(di,this),l,u)}indexToUid(l){const u=`${Ha}.indexToUid`;return Ye(To,this).indexToUid(Ye(di,this),l,u)}uidToIndex(l){const u=`${Ha}.uidToIndex`;return Ye(To,this).uidToIndex(Ye(di,this),l,u)}getCurrentPageUid(){return Ye(To,this).getCurrentPageUid(Ye(di,this))}getCurrentPageIndex(){return Ye(To,this).getCurrentPageIndex(Ye(di,this))}getPageCount(){return Ye(To,this).getPageCount(Ye(di,this))}on(l,u){Ye(To,this).on(Ye(di,this),`${Ha}.on`,l,u)}off(l,u){Ye(To,this).off(Ye(di,this),`${Ha}.off`,l,u)}destroy(){Ye(To,this).destroy(Ye(di,this))}},get lastError(){return it.getLastError()},clearLastError(){it.lastError=void 0},Experiments:{get(p,l){switch(p){case"WasmEnv":return gn;case"ImageProcess":return new yDe;case"FileParser.Options":return Br.getFileParserDefaultOptions(l);default:return}},set(p,l){switch(p){case"FileParser.Options":return Br.setFileParserDefaultOptions(l.type,l.options);case"ClearExternalHandler":return Br.clearExternalHandler(l.type);default:return}}},addFonts:p=>Fe(function*(){const l="DDV.addFonts";if(!Cn(p,2,l,"fonts")&&!function(u,f,g,m,v){const _=gt.formatError({isValid:Di(u)});if(_)return gt.output(2,g,m,void 0,_);const b=[];return u.forEach((S,I)=>{const k=gt.formatDetails(_n("Array","font",`[${I}]`,!0),ul(S));b.push(...k)}),!!b.length&&gt.output(2,g,m,b)}(p,0,l,"fonts"))try{for(let u=0;u<p.length;u++){const f=p[u],g=new iQ,m=yield g.getFontInfo(f).catch(v=>{throw g.terminate(),v});g.terminate();for(let v=0;v<m.fontInfo.length;v++){const _=m.fontInfo[v];NL.includes(_.family)||new FontFace(_.family,m.srcBuffer,{style:"normal",weight:"normal",display:"swap"}).load().then(S=>{document.fonts.add(S),NL.push(_.family),Br.getViewers().forEach(I=>{I.addFontToUi(_.family),I.context.render()})}),jE.addPdfFont(`${_.family}${_.isBold?"Blob":""}${_.isItalic?"Italic":""}`,m.srcBuffer)}}}catch(u){return it.reject(it.PARAM_INVALID,l,"fonts")}})(),getDefaultUiConfig(p,l){const u="DDV.getDefaultUiConfig",f="viewerType";if(Cn(p,1,f,u)||!ar(p,1,u,f)||!["editViewer","perspectiveViewer","captureViewer","browseViewer"].includes(p)&&!gt.output(1,"DDV.getDefaultUiConfig","viewerType",void 0,it.PARAM_NOT_SUPPORT))return null;let g=null;return ir()?(g={editViewer:bL,perspectiveViewer:Hte,captureViewer:jte,browseViewer:mD}[p],"editViewer"===p&&null!=l&&l.includeAnnotationSet&&(g=Yte)):(g={editViewer:xL,perspectiveViewer:zte,captureViewer:Gte,browseViewer:mD}[p],"editViewer"===p&&null!=l&&l.includeAnnotationSet&&(g=wL)),hn(g)},setProcessingHandler(p,l){const u="DDV.setProcessingHandler",g="handler";switch(Cn(p,0,u,"type"),Cn(l,0,u,g),function(v,_,b,S){const I=gt.formatError(_o.isHandlerTypeValid(v));I&&gt.output(0,"DDV.setProcessingHandler","type",void 0,I)}(p),p){case"documentBoundariesDetect":("function"!=typeof(m=l).detect||"function"!=typeof m.destroy)&&gt.error(u,g);break;case"imageFilter":"function"==typeof(v=l).querySupported&&"defaultFilterType"in v&&"function"==typeof v.applyFilter&&"function"==typeof v.destroy||gt.error(u,g)}var v,m;try{switch(p){case"documentBoundariesDetect":Br.setDetectHandler(p,l);break;case"imageFilter":Br.setImageFilterHandler(l)}}catch(v){it.throw(v,u)}},setFileParser(p,l){Br.setFileParser(p,l)},unload(){this.Core.deviceFriendlyName="",this.Core.engineResourcePath=Lne,this.Core.license="",Br.unload(),Br.onUnload.emit(),une.clear()},on(p,l){const u="DDV.on";if(Cn(p,1,u,"eventName")||Cn(l,1,u,"listener")||!ar(p,1,u,"eventName",!1)||!ef(l,u,"listener",1))return;const f={error:"error",warning:"warning",verbose:"verbose"}[p];f?it.on(f,l):it.throw(it.PARAM_NOT_SUPPORT,u,"eventName")},off(p,l){const u="DDV.off";if(Cn(p,1,u,"eventName")||!ar(p,1,u,"eventName",!1)||!pt(l)&&!ef(l,u,"listener",1))return;const f={error:"error",warning:"warning",verbose:"verbose"}[p];f?it.off(f,l):it.throw(it.PARAM_NOT_SUPPORT,u,"eventName")},EnumImageDataType:Tr,EnumConvertMode:hl,EnumDocumentDetectionStatus:Ba,EnumImageFilterType:LL,EnumPDFCompressionType:hp,EnumPDFPageType:Lo,EnumTIFFCompressionType:dp,EnumStampIcon:Ri,EnumLineEnding:la,EnumAnnotationRenderMode:Hh,annotationManager:hne};window.Dynamsoft||(window.Dynamsoft={}),window.Dynamsoft.DDV=Ip;var Ie,Ku=self||window||{};(function(p){p.DWT||(p.DWT={}),p.DWT.LTS||(p.DWT.LTS={}),p.Lib||(p.Lib={}),p.Lib.UI||(p.Lib.UI={}),p.Lib.html5||(p.Lib.html5={}),Ku.Dynamsoft=p})(Ie=Ku.Dynamsoft||{}),function(p){if(!p.WeakSet){let v=function(_){this.name="__st"+(1e9*Math.random()>>>0)+l+++"__",_&&_.forEach&&_.forEach(this.add,this)};p.WeakSet=v;var l=Date.now()%1e9,u=v.prototype;u.add=function(_){var b=this.name;return _[b]||Object.defineProperty(_,b,{value:!0,writable:!0}),this},u.delete=function(_){return!!_[this.name]&&(_[this.name]=void 0,!0)},u.has=function(_){return!!_[this.name]}}if(!p.WeakMap){let v=function(_){return Object(_)===_};var f=Object.prototype.hasOwnProperty,g=Object.defineProperty&&function(){try{return 1===Object.defineProperty({},"x",{value:1}).x}catch(_){}}(),m=function(_,b,S){g?Object.defineProperty(_,b,{configurable:!0,writable:!0,value:S}):_[b]=S};p.WeakMap=function(){function _(){if(void 0===this)throw new TypeError("Constructor WeakMap requires 'new'");if(m(this,"_id",S("_WeakMap")),arguments.length>0)throw new TypeError("WeakMap iterable is not supported")}function b(k,O){if(!v(k)||!f.call(k,"_id"))throw new TypeError(O+" method called on incompatible receiver "+typeof k)}function S(k){return k+"_"+I()+"."+I()}function I(){return Math.random().toString().substring(2)}return m(_.prototype,"delete",function(k){if(b(this,"delete"),!v(k))return!1;var O=k[this._id];return!(!O||O[0]!==k||(delete k[this._id],0))}),m(_.prototype,"get",function(k){if(b(this,"get"),v(k)){var O=k[this._id];if(O&&O[0]===k)return O[1]}}),m(_.prototype,"has",function(k){if(b(this,"has"),!v(k))return!1;var O=k[this._id];return!(!O||O[0]!==k)}),m(_.prototype,"set",function(k,O){if(b(this,"set"),!v(k))throw new TypeError("Invalid value used as weak map key");var j=k[this._id];return j&&j[0]===k?(j[1]=O,this):(m(k,this._id,[k,O]),this)}),m(_,"_polyfill",!0),_}()}}(void 0!==Ku?Ku:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0),!Ie.Lib.jsinited&&(Ie.Lib.jsinited=1,function(p){if("object"==typeof exports)module.exports=p();else if("function"==typeof define&&define.amd)define(p);else{var l;try{l=window}catch(u){l=self}l.SparkMD5=p()}}(function(p){var u=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function g(Q,ie){var oe=Q[0],le=Q[1],he=Q[2],_e=Q[3];le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le&he|~le&_e)+ie[0]-680876936|0)<<7|oe>>>25)+le|0)&le|~oe&he)+ie[1]-389564586|0)<<12|_e>>>20)+oe|0)&oe|~_e&le)+ie[2]+606105819|0)<<17|he>>>15)+_e|0)&_e|~he&oe)+ie[3]-1044525330|0)<<22|le>>>10)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le&he|~le&_e)+ie[4]-176418897|0)<<7|oe>>>25)+le|0)&le|~oe&he)+ie[5]+1200080426|0)<<12|_e>>>20)+oe|0)&oe|~_e&le)+ie[6]-1473231341|0)<<17|he>>>15)+_e|0)&_e|~he&oe)+ie[7]-45705983|0)<<22|le>>>10)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le&he|~le&_e)+ie[8]+1770035416|0)<<7|oe>>>25)+le|0)&le|~oe&he)+ie[9]-1958414417|0)<<12|_e>>>20)+oe|0)&oe|~_e&le)+ie[10]-42063|0)<<17|he>>>15)+_e|0)&_e|~he&oe)+ie[11]-1990404162|0)<<22|le>>>10)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le&he|~le&_e)+ie[12]+1804603682|0)<<7|oe>>>25)+le|0)&le|~oe&he)+ie[13]-40341101|0)<<12|_e>>>20)+oe|0)&oe|~_e&le)+ie[14]-1502002290|0)<<17|he>>>15)+_e|0)&_e|~he&oe)+ie[15]+1236535329|0)<<22|le>>>10)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le&_e|he&~_e)+ie[1]-165796510|0)<<5|oe>>>27)+le|0)&he|le&~he)+ie[6]-1069501632|0)<<9|_e>>>23)+oe|0)&le|oe&~le)+ie[11]+643717713|0)<<14|he>>>18)+_e|0)&oe|_e&~oe)+ie[0]-373897302|0)<<20|le>>>12)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le&_e|he&~_e)+ie[5]-701558691|0)<<5|oe>>>27)+le|0)&he|le&~he)+ie[10]+38016083|0)<<9|_e>>>23)+oe|0)&le|oe&~le)+ie[15]-660478335|0)<<14|he>>>18)+_e|0)&oe|_e&~oe)+ie[4]-405537848|0)<<20|le>>>12)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le&_e|he&~_e)+ie[9]+568446438|0)<<5|oe>>>27)+le|0)&he|le&~he)+ie[14]-1019803690|0)<<9|_e>>>23)+oe|0)&le|oe&~le)+ie[3]-187363961|0)<<14|he>>>18)+_e|0)&oe|_e&~oe)+ie[8]+1163531501|0)<<20|le>>>12)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le&_e|he&~_e)+ie[13]-1444681467|0)<<5|oe>>>27)+le|0)&he|le&~he)+ie[2]-51403784|0)<<9|_e>>>23)+oe|0)&le|oe&~le)+ie[7]+1735328473|0)<<14|he>>>18)+_e|0)&oe|_e&~oe)+ie[12]-1926607734|0)<<20|le>>>12)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le^he^_e)+ie[5]-378558|0)<<4|oe>>>28)+le|0)^le^he)+ie[8]-2022574463|0)<<11|_e>>>21)+oe|0)^oe^le)+ie[11]+1839030562|0)<<16|he>>>16)+_e|0)^_e^oe)+ie[14]-35309556|0)<<23|le>>>9)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le^he^_e)+ie[1]-1530992060|0)<<4|oe>>>28)+le|0)^le^he)+ie[4]+1272893353|0)<<11|_e>>>21)+oe|0)^oe^le)+ie[7]-155497632|0)<<16|he>>>16)+_e|0)^_e^oe)+ie[10]-1094730640|0)<<23|le>>>9)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le^he^_e)+ie[13]+681279174|0)<<4|oe>>>28)+le|0)^le^he)+ie[0]-358537222|0)<<11|_e>>>21)+oe|0)^oe^le)+ie[3]-722521979|0)<<16|he>>>16)+_e|0)^_e^oe)+ie[6]+76029189|0)<<23|le>>>9)+he|0,le=((le+=((he=((he+=((_e=((_e+=((oe=((oe+=(le^he^_e)+ie[9]-640364487|0)<<4|oe>>>28)+le|0)^le^he)+ie[12]-421815835|0)<<11|_e>>>21)+oe|0)^oe^le)+ie[15]+530742520|0)<<16|he>>>16)+_e|0)^_e^oe)+ie[2]-995338651|0)<<23|le>>>9)+he|0,le=((le+=((_e=((_e+=(le^((oe=((oe+=(he^(le|~_e))+ie[0]-198630844|0)<<6|oe>>>26)+le|0)|~he))+ie[7]+1126891415|0)<<10|_e>>>22)+oe|0)^((he=((he+=(oe^(_e|~le))+ie[14]-1416354905|0)<<15|he>>>17)+_e|0)|~oe))+ie[5]-57434055|0)<<21|le>>>11)+he|0,le=((le+=((_e=((_e+=(le^((oe=((oe+=(he^(le|~_e))+ie[12]+1700485571|0)<<6|oe>>>26)+le|0)|~he))+ie[3]-1894986606|0)<<10|_e>>>22)+oe|0)^((he=((he+=(oe^(_e|~le))+ie[10]-1051523|0)<<15|he>>>17)+_e|0)|~oe))+ie[1]-2054922799|0)<<21|le>>>11)+he|0,le=((le+=((_e=((_e+=(le^((oe=((oe+=(he^(le|~_e))+ie[8]+1873313359|0)<<6|oe>>>26)+le|0)|~he))+ie[15]-30611744|0)<<10|_e>>>22)+oe|0)^((he=((he+=(oe^(_e|~le))+ie[6]-1560198380|0)<<15|he>>>17)+_e|0)|~oe))+ie[13]+1309151649|0)<<21|le>>>11)+he|0,le=((le+=((_e=((_e+=(le^((oe=((oe+=(he^(le|~_e))+ie[4]-145523070|0)<<6|oe>>>26)+le|0)|~he))+ie[11]-1120210379|0)<<10|_e>>>22)+oe|0)^((he=((he+=(oe^(_e|~le))+ie[2]+718787259|0)<<15|he>>>17)+_e|0)|~oe))+ie[9]-343485551|0)<<21|le>>>11)+he|0,Q[0]=oe+Q[0]|0,Q[1]=le+Q[1]|0,Q[2]=he+Q[2]|0,Q[3]=_e+Q[3]|0}function m(Q){var oe,ie=[];for(oe=0;oe<64;oe+=4)ie[oe>>2]=Q.charCodeAt(oe)+(Q.charCodeAt(oe+1)<<8)+(Q.charCodeAt(oe+2)<<16)+(Q.charCodeAt(oe+3)<<24);return ie}function v(Q){var oe,ie=[];for(oe=0;oe<64;oe+=4)ie[oe>>2]=Q[oe]+(Q[oe+1]<<8)+(Q[oe+2]<<16)+(Q[oe+3]<<24);return ie}function _(Q){var le,he,_e,Ve,ee,ke,ie=Q.length,oe=[1732584193,-271733879,-1732584194,271733878];for(le=64;le<=ie;le+=64)g(oe,m(Q.substring(le-64,le)));for(he=(Q=Q.substring(le-64)).length,_e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],le=0;le<he;le+=1)_e[le>>2]|=Q.charCodeAt(le)<<(le%4<<3);if(_e[le>>2]|=128<<(le%4<<3),le>55)for(g(oe,_e),le=0;le<16;le+=1)_e[le]=0;return Ve=(Ve=8*ie).toString(16).match(/(.*?)(.{0,8})$/),ee=parseInt(Ve[2],16),ke=parseInt(Ve[1],16)||0,_e[14]=ee,_e[15]=ke,g(oe,_e),oe}function S(Q){var oe,ie="";for(oe=0;oe<4;oe+=1)ie+=u[Q>>8*oe+4&15]+u[Q>>8*oe&15];return ie}function I(Q){var ie;for(ie=0;ie<Q.length;ie+=1)Q[ie]=S(Q[ie]);return Q.join("")}function k(Q){return/[\u0080-\uFFFF]/.test(Q)&&(Q=unescape(encodeURIComponent(Q))),Q}function J(Q){var le,ie=[],oe=Q.length;for(le=0;le<oe-1;le+=2)ie.push(parseInt(Q.substr(le,2),16));return String.fromCharCode.apply(String,ie)}function K(){this.reset()}return I(_("hello")),"undefined"!=typeof ArrayBuffer&&!ArrayBuffer.prototype.slice&&function(){function Q(ie,oe){return(ie=0|ie||0)<0?Math.max(ie+oe,0):Math.min(ie,oe)}ArrayBuffer.prototype.slice=function(ie,oe){var Ve,ee,ke,xe,le=this.byteLength,he=Q(ie,le),_e=le;return oe!==p&&(_e=Q(oe,le)),he>_e?new ArrayBuffer(0):(Ve=_e-he,ee=new ArrayBuffer(Ve),ke=new Uint8Array(ee),xe=new Uint8Array(this,he,Ve),ke.set(xe),ee)}}(),K.prototype.append=function(Q){return this.appendBinary(k(Q)),this},K.prototype.appendBinary=function(Q){this._buff+=Q,this._length+=Q.length;var oe,ie=this._buff.length;for(oe=64;oe<=ie;oe+=64)g(this._hash,m(this._buff.substring(oe-64,oe)));return this._buff=this._buff.substring(oe-64),this},K.prototype.end=function(Q){var le,_e,ie=this._buff,oe=ie.length,he=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(le=0;le<oe;le+=1)he[le>>2]|=ie.charCodeAt(le)<<(le%4<<3);return this._finish(he,oe),_e=I(this._hash),Q&&(_e=J(_e)),this.reset(),_e},K.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},K.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},K.prototype.setState=function(Q){return this._buff=Q.buff,this._length=Q.length,this._hash=Q.hash,this},K.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},K.prototype._finish=function(Q,ie){var le,he,_e,oe=ie;if(Q[oe>>2]|=128<<(oe%4<<3),oe>55)for(g(this._hash,Q),oe=0;oe<16;oe+=1)Q[oe]=0;le=(le=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),he=parseInt(le[2],16),_e=parseInt(le[1],16)||0,Q[14]=he,Q[15]=_e,g(this._hash,Q)},K.hash=function(Q,ie){return K.hashBinary(k(Q),ie)},K.hashBinary=function(Q,ie){var le=I(_(Q));return ie?J(le):le},(K.ArrayBuffer=function(){this.reset()}).prototype.append=function(Q){var le,ie=function W(Q,ie,oe){var le=new Uint8Array(Q.byteLength+ie.byteLength);return le.set(new Uint8Array(Q)),le.set(new Uint8Array(ie),Q.byteLength),oe?le:le.buffer}(this._buff.buffer,Q,!0),oe=ie.length;for(this._length+=Q.byteLength,le=64;le<=oe;le+=64)g(this._hash,v(ie.subarray(le-64,le)));return this._buff=le-64<oe?new Uint8Array(ie.buffer.slice(le-64)):new Uint8Array(0),this},K.ArrayBuffer.prototype.end=function(Q){var he,_e,ie=this._buff,oe=ie.length,le=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(he=0;he<oe;he+=1)le[he>>2]|=ie[he]<<(he%4<<3);return this._finish(le,oe),_e=I(this._hash),Q&&(_e=J(_e)),this.reset(),_e},K.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},K.ArrayBuffer.prototype.getState=function(){var Q=K.prototype.getState.call(this);return Q.buff=function j(Q){return String.fromCharCode.apply(null,new Uint8Array(Q))}(Q.buff),Q},K.ArrayBuffer.prototype.setState=function(Q){return Q.buff=function O(Q,ie){var _e,oe=Q.length,le=new ArrayBuffer(oe),he=new Uint8Array(le);for(_e=0;_e<oe;_e+=1)he[_e]=Q.charCodeAt(_e);return ie?he:le}(Q.buff,!0),K.prototype.setState.call(this,Q)},K.ArrayBuffer.prototype.destroy=K.prototype.destroy,K.ArrayBuffer.prototype._finish=K.prototype._finish,K.ArrayBuffer.hash=function(Q,ie){var oe=function b(Q){var le,he,_e,Ve,ee,ke,ie=Q.length,oe=[1732584193,-271733879,-1732584194,271733878];for(le=64;le<=ie;le+=64)g(oe,v(Q.subarray(le-64,le)));for(he=(Q=le-64<ie?Q.subarray(le-64):new Uint8Array(0)).length,_e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],le=0;le<he;le+=1)_e[le>>2]|=Q[le]<<(le%4<<3);if(_e[le>>2]|=128<<(le%4<<3),le>55)for(g(oe,_e),le=0;le<16;le+=1)_e[le]=0;return Ve=(Ve=8*ie).toString(16).match(/(.*?)(.{0,8})$/),ee=parseInt(Ve[2],16),ke=parseInt(Ve[1],16)||0,_e[14]=ee,_e[15]=ke,g(oe,_e),oe}(new Uint8Array(Q)),le=I(oe);return ie?J(le):le},K}),function(){function p(y){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(C){return typeof C}:function(C){return C&&"function"==typeof Symbol&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C})(y)}function l(y,C){if(!(y instanceof C))throw new TypeError("Cannot call a class as a function")}function u(y){var C=function(x,w){if("object"!==p(x)||null===x)return x;var T=x[Symbol.toPrimitive];if(void 0!==T){var A=T.call(x,"string");if("object"!==p(A))return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(x)}(y);return"symbol"===p(C)?C:String(C)}function f(y,C){for(var x=0;x<C.length;x++){var w=C[x];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(y,u(w.key),w)}}function g(y,C,x){return C&&f(y.prototype,C),x&&f(y,x),Object.defineProperty(y,"prototype",{writable:!1}),y}var m=void 0!==Ku?Ku:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function v(y){return y&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y}var _={exports:{}},b={exports:{}};!function(y){function C(x){return y.exports=C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(w){return typeof w}:function(w){return w&&"function"==typeof Symbol&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},y.exports.__esModule=!0,y.exports.default=y.exports,C(x)}y.exports=C,y.exports.__esModule=!0,y.exports.default=y.exports}(b);var S=b.exports;!function(y){var C=S.default;function x(){y.exports=x=function(){return w},y.exports.__esModule=!0,y.exports.default=y.exports;var w={},T=Object.prototype,A=T.hasOwnProperty,D=Object.defineProperty||function(Be,$e,Ge){Be[$e]=Ge.value},M="function"==typeof Symbol?Symbol:{},B=M.iterator||"@@iterator",H=M.asyncIterator||"@@asyncIterator",Y=M.toStringTag||"@@toStringTag";function G(Be,$e,Ge){return Object.defineProperty(Be,$e,{value:Ge,enumerable:!0,configurable:!0,writable:!0}),Be[$e]}try{G({},"")}catch(Be){G=function($e,Ge,_t){return $e[Ge]=_t}}function q(Be,$e,Ge,_t){var Ut=Object.create(($e&&$e.prototype instanceof ce?$e:ce).prototype),Tn=new Se(_t||[]);return D(Ut,"_invoke",{value:ue(Be,Ge,Tn)}),Ut}function re(Be,$e,Ge){try{return{type:"normal",arg:Be.call($e,Ge)}}catch(_t){return{type:"throw",arg:_t}}}w.wrap=q;var se={};function ce(){}function ve(){}function Te(){}var Ue={};G(Ue,B,function(){return this});var je=Object.getPrototypeOf,Ee=je&&je(je(We([])));Ee&&Ee!==T&&A.call(Ee,B)&&(Ue=Ee);var Oe=Te.prototype=ce.prototype=Object.create(Ue);function He(Be){["next","throw","return"].forEach(function($e){G(Be,$e,function(Ge){return this._invoke($e,Ge)})})}function we(Be,$e){function Ge(Ct,Ut,Tn,mn){var bt=re(Be[Ct],Be,Ut);if("throw"!==bt.type){var At=bt.arg,Tt=At.value;return Tt&&"object"==C(Tt)&&A.call(Tt,"__await")?$e.resolve(Tt.__await).then(function(Bt){Ge("next",Bt,Tn,mn)},function(Bt){Ge("throw",Bt,Tn,mn)}):$e.resolve(Tt).then(function(Bt){At.value=Bt,Tn(At)},function(Bt){return Ge("throw",Bt,Tn,mn)})}mn(bt.arg)}var _t;D(this,"_invoke",{value:function(Ct,Ut){function Tn(){return new $e(function(mn,bt){Ge(Ct,Ut,mn,bt)})}return _t=_t?_t.then(Tn,Tn):Tn()}})}function ue(Be,$e,Ge){var _t="suspendedStart";return function(Ct,Ut){if("executing"===_t)throw new Error("Generator is already running");if("completed"===_t){if("throw"===Ct)throw Ut;return{value:void 0,done:!0}}for(Ge.method=Ct,Ge.arg=Ut;;){var Tn=Ge.delegate;if(Tn){var mn=pe(Tn,Ge);if(mn){if(mn===se)continue;return mn}}if("next"===Ge.method)Ge.sent=Ge._sent=Ge.arg;else if("throw"===Ge.method){if("suspendedStart"===_t)throw _t="completed",Ge.arg;Ge.dispatchException(Ge.arg)}else"return"===Ge.method&&Ge.abrupt("return",Ge.arg);_t="executing";var bt=re(Be,$e,Ge);if("normal"===bt.type){if(_t=Ge.done?"completed":"suspendedYield",bt.arg===se)continue;return{value:bt.arg,done:Ge.done}}"throw"===bt.type&&(_t="completed",Ge.method="throw",Ge.arg=bt.arg)}}}function pe(Be,$e){var Ge=$e.method,_t=Be.iterator[Ge];if(void 0===_t)return $e.delegate=null,"throw"===Ge&&Be.iterator.return&&($e.method="return",$e.arg=void 0,pe(Be,$e),"throw"===$e.method)||"return"!==Ge&&($e.method="throw",$e.arg=new TypeError("The iterator does not provide a '"+Ge+"' method")),se;var Ct=re(_t,Be.iterator,$e.arg);if("throw"===Ct.type)return $e.method="throw",$e.arg=Ct.arg,$e.delegate=null,se;var Ut=Ct.arg;return Ut?Ut.done?($e[Be.resultName]=Ut.value,$e.next=Be.nextLoc,"return"!==$e.method&&($e.method="next",$e.arg=void 0),$e.delegate=null,se):Ut:($e.method="throw",$e.arg=new TypeError("iterator result is not an object"),$e.delegate=null,se)}function ye(Be){var $e={tryLoc:Be[0]};1 in Be&&($e.catchLoc=Be[1]),2 in Be&&($e.finallyLoc=Be[2],$e.afterLoc=Be[3]),this.tryEntries.push($e)}function me(Be){var $e=Be.completion||{};$e.type="normal",delete $e.arg,Be.completion=$e}function Se(Be){this.tryEntries=[{tryLoc:"root"}],Be.forEach(ye,this),this.reset(!0)}function We(Be){if(Be){var $e=Be[B];if($e)return $e.call(Be);if("function"==typeof Be.next)return Be;if(!isNaN(Be.length)){var Ge=-1,_t=function Ct(){for(;++Ge<Be.length;)if(A.call(Be,Ge))return Ct.value=Be[Ge],Ct.done=!1,Ct;return Ct.value=void 0,Ct.done=!0,Ct};return _t.next=_t}}return{next:ze}}function ze(){return{value:void 0,done:!0}}return ve.prototype=Te,D(Oe,"constructor",{value:Te,configurable:!0}),D(Te,"constructor",{value:ve,configurable:!0}),ve.displayName=G(Te,Y,"GeneratorFunction"),w.isGeneratorFunction=function(Be){var $e="function"==typeof Be&&Be.constructor;return!!$e&&($e===ve||"GeneratorFunction"===($e.displayName||$e.name))},w.mark=function(Be){return Object.setPrototypeOf?Object.setPrototypeOf(Be,Te):(Be.__proto__=Te,G(Be,Y,"GeneratorFunction")),Be.prototype=Object.create(Oe),Be},w.awrap=function(Be){return{__await:Be}},He(we.prototype),G(we.prototype,H,function(){return this}),w.AsyncIterator=we,w.async=function(Be,$e,Ge,_t,Ct){void 0===Ct&&(Ct=Promise);var Ut=new we(q(Be,$e,Ge,_t),Ct);return w.isGeneratorFunction($e)?Ut:Ut.next().then(function(Tn){return Tn.done?Tn.value:Ut.next()})},He(Oe),G(Oe,Y,"Generator"),G(Oe,B,function(){return this}),G(Oe,"toString",function(){return"[object Generator]"}),w.keys=function(Be){var $e=Object(Be),Ge=[];for(var _t in $e)Ge.push(_t);return Ge.reverse(),function Ct(){for(;Ge.length;){var Ut=Ge.pop();if(Ut in $e)return Ct.value=Ut,Ct.done=!1,Ct}return Ct.done=!0,Ct}},w.values=We,Se.prototype={constructor:Se,reset:function(Be){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(me),!Be)for(var $e in this)"t"===$e.charAt(0)&&A.call(this,$e)&&!isNaN(+$e.slice(1))&&(this[$e]=void 0)},stop:function(){this.done=!0;var Be=this.tryEntries[0].completion;if("throw"===Be.type)throw Be.arg;return this.rval},dispatchException:function(Be){if(this.done)throw Be;var $e=this;function Ge(bt,At){return Ut.type="throw",Ut.arg=Be,$e.next=bt,At&&($e.method="next",$e.arg=void 0),!!At}for(var _t=this.tryEntries.length-1;_t>=0;--_t){var Ct=this.tryEntries[_t],Ut=Ct.completion;if("root"===Ct.tryLoc)return Ge("end");if(Ct.tryLoc<=this.prev){var Tn=A.call(Ct,"catchLoc"),mn=A.call(Ct,"finallyLoc");if(Tn&&mn){if(this.prev<Ct.catchLoc)return Ge(Ct.catchLoc,!0);if(this.prev<Ct.finallyLoc)return Ge(Ct.finallyLoc)}else if(Tn){if(this.prev<Ct.catchLoc)return Ge(Ct.catchLoc,!0)}else{if(!mn)throw new Error("try statement without catch or finally");if(this.prev<Ct.finallyLoc)return Ge(Ct.finallyLoc)}}}},abrupt:function(Be,$e){for(var Ge=this.tryEntries.length-1;Ge>=0;--Ge){var _t=this.tryEntries[Ge];if(_t.tryLoc<=this.prev&&A.call(_t,"finallyLoc")&&this.prev<_t.finallyLoc){var Ct=_t;break}}Ct&&("break"===Be||"continue"===Be)&&Ct.tryLoc<=$e&&$e<=Ct.finallyLoc&&(Ct=null);var Ut=Ct?Ct.completion:{};return Ut.type=Be,Ut.arg=$e,Ct?(this.method="next",this.next=Ct.finallyLoc,se):this.complete(Ut)},complete:function(Be,$e){if("throw"===Be.type)throw Be.arg;return"break"===Be.type||"continue"===Be.type?this.next=Be.arg:"return"===Be.type?(this.rval=this.arg=Be.arg,this.method="return",this.next="end"):"normal"===Be.type&&$e&&(this.next=$e),se},finish:function(Be){for(var $e=this.tryEntries.length-1;$e>=0;--$e){var Ge=this.tryEntries[$e];if(Ge.finallyLoc===Be)return this.complete(Ge.completion,Ge.afterLoc),me(Ge),se}},catch:function(Be){for(var $e=this.tryEntries.length-1;$e>=0;--$e){var Ge=this.tryEntries[$e];if(Ge.tryLoc===Be){var _t=Ge.completion;if("throw"===_t.type){var Ct=_t.arg;me(Ge)}return Ct}}throw new Error("illegal catch attempt")},delegateYield:function(Be,$e,Ge){return this.delegate={iterator:We(Be),resultName:$e,nextLoc:Ge},"next"===this.method&&(this.arg=void 0),se}},w}y.exports=x,y.exports.__esModule=!0,y.exports.default=y.exports}(_);var I=(0,_.exports)(),k=I;try{regeneratorRuntime=I}catch(y){"object"==typeof Ku?Ku.regeneratorRuntime=I:Function("r","regeneratorRuntime = r")(I)}var O,j,W=v(k);function J(y){var C=y?new Date(y):new Date,x="yyyy-MM-dd HH:mm:ss.SSSZ",w={"M+":C.getUTCMonth()+1,"d+":C.getUTCDate(),"H+":C.getUTCHours(),"h+":C.getUTCHours()%12||12,"m+":C.getUTCMinutes(),"s+":C.getUTCSeconds(),"q+":Math.floor((C.getUTCMonth()+3)/3),"S+":C.getUTCMilliseconds()};for(var T in/(y+)/.test(x)&&(x=x.replace(RegExp.$1,(C.getUTCFullYear()+"").substr(4-RegExp.$1.length))),w)new RegExp("("+T+")").test(x)&&(x=x.replace(RegExp.$1,1==RegExp.$1.length?w[T]:("000"+w[T]).substr(("000"+w[T]).length-RegExp.$1.length)));return x}function K(y){return y===j}function Q(y){return y!==j}function ie(y){return null===y}O="object"===("undefined"==typeof window?"undefined":p(window))?window:{};var oe={"[object Function]":"function","[object AsyncFunction]":"function","[object String]":"string","[object Object]":"object","[object Boolean]":"boolean","[object Number]":"number","[object Array]":"array"};function le(y){return ie(y)||K(y)?String(y):oe[{}.toString.call(y)]||"object"}function he(y){return"function"===le(y)}function _e(y){return"string"===le(y)}function Ve(y){return"object"===le(y)}function ee(y){return"boolean"===le(y)}function ke(y){return"number"===le(y)}function xe(y){return Array.isArray?Array.isArray(y):"array"===le(y)}function Le(y){if(null==y)return[];if(xe(y))return y;var C=p(y.length),x=p(y);if("number"!==C||y.alert||"string"===x||"function"===x&&(!("item"in y)||"number"!==C))return[y];for(var w=[],T=0,A=y.length;T<A;T++)w[T]=y[T];return w}var V,F,z={debug:!1,showConsoleError:!1};function $(){return V}function P(y){V=y}function L(y,C,x,w){if(z.debug&&F&&he(F.log)){var T=J((new Date).getTime()),A=Le(arguments);F.log(["[",T,"] ",A].join(""))}}function X(y,C,x,w){if((z.debug||z.showConsoleError)&&F&&he(F.error)){var T=J((new Date).getTime()),A=Le(arguments);F.error(["[",T,"] ",A].join(""))}}function ne(y,C,x,w){if(z.debug&&F&&he(F.warn)){var T=J((new Date).getTime()),A=Le(arguments);F.warn(["[",T,"] ",A].join(""))}}function Z(y,C,x,w){if(z.debug&&F&&he(F.info)){var T=J((new Date).getTime()),A=Le(arguments);F.info(["[",T,"] ",A].join(""))}}O&&Q(O.console)&&(he((F=O.console).log)&&he(F.error)?V={log:L,error:X,info:Z,warn:ne,debug:function(y,C,x,w){if(z.debug&&F&&he(F.debug)){var T=J((new Date).getTime()),A=Le(arguments);F.debug(["[",T,"] ",A].join(""))}}}:(F=!1,V=!1));var te={queue:[],doNextStarted:!1,timer:null,pushToDo:function(y,C,x){te.queue.push({obj:y,method:C,args:x})},doNext:function(){if(te.doNextStarted)if(0!=te.queue.length){var y=te.queue[0],C=y.obj,x=y.method,w=y.args;if(te.queue.splice(0,1),C&&he(C[x])){var T=!1;if(w.length>2){var A=w[w.length-2],D=w[w.length-1];he(A)&&he(D)&&(w[w.length-2]=function(){try{A.apply(C,arguments)}catch(M){}te.timer=setTimeout(te.doNext,0)},w[w.length-1]=function(){try{D.apply(C,arguments)}catch(M){}te.timer=setTimeout(te.doNext,0)},T=!0)}try{C[x].apply(C,w)}catch(M){}T||(te.timer=setTimeout(te.doNext,0))}else if(null===C&&he(x)){try{x.apply(null,w)}catch(M){}te.timer=setTimeout(te.doNext,0)}else L("not invoke a function: "+x),te.timer=setTimeout(te.doNext,0)}else te.stop();else te.stop()},start:function(){te.doNextStarted||(te.doNextStarted=!0,te.timer=setTimeout(te.doNext,0))},stop:function(){clearTimeout(te.timer),te.timer=null,te.doNextStarted=!1,te.queue=[]}},ae=!0,fe=!1;function be(y,C,x){if(y){var w,T,A,D=0,M=y.length;if(x=x||null,K(M)||he(y))for(A=Object.keys(y);D<A.length&&C.call(x,y[w=A[D]],w,y)!==fe;D++);else for(T=y[0];D<M&&C.call(x,T,D,y)!==fe;T=y[++D]);}return y}var Pe={fire:function(y){var C,x=this;x.exec=x.exec||{},y=y.toLowerCase(),C=Array.prototype.slice.call(arguments,1),be(x.exec[y]||[],function(w){var T=w.f,A=w.c||x;try{T.apply(A,C)}catch(D){L(D)}})},on:function(y,C,x){var w=this;w.exec=w.exec||{},y=y.toLowerCase(),w.exec[y]=w.exec[y]||[],w.exec[y].push({f:C,c:x})},off:function(y,C,x){var w=this.exec;if(w)if(y)if(y=y.toLowerCase(),C)for(var T=w[y]||[],A=T.length-1;A>=0;A--)T[A]===C&&T.splice(A,1);else w[y]=null;else this.exec=null}};function De(y){return null!=y&&y==y.window}function Xe(y){y&&/\S/.test(y)&&(O.execScript?O.execScript(y):O.eval.call(O,y))}var Re,de,tt,Ze,et,Qe=navigator,Je=!0;if("userAgentData"in Qe){var st=Qe.userAgentData,mt=[];st.platform&&""!=st.platform&&("brands"in st&&Array.isArray(st.brands)&&st.brands.length>0?mt=st.brands:"uaList"in st&&Array.isArray(st.uaList)&&st.uaList.length>0&&(mt=st.uaList),mt.length>0&&(Je=!1,tt=st.platform.toLowerCase(),de=function(y,C,x){var w,T,A,D,M,B,H,Y,G,q=!1,re=!1,se=!1,ce=y.mobile,ve=!1,Te="",Ue=navigator.maxTouchPoints||0;for(T=C.length,w=0;w<T;w++){var je=C[w].brand.toLowerCase();if(je.indexOf("chrome")>=0){se=!0,Te=C[w].version;break}if(je.indexOf("edge")>=0){q=!0,Te=C[w].version;break}if(je.indexOf("opera")>=0){re=!0,Te=C[w].version;break}}return se||q||re||(se=!0,Te="100"),A=/windows/g.test(x),D=/mac/g.test(x),M=/linux/g.test(x),B=/android/g.test(x),H=/harmony/g.test(x),Y=/(chromeos|chrome\sos)/g.test(x),G=/iphone/g.test(x),A||B||M||G||(ve=/macintel/g.test(x)&&Ue>1),(B||H||G||ve)&&(ce=!0),{bUseUserAgent:!1,bWin:A,bMac:D,bLinux:M,bAndroid:B,bHarmonyOS:H,bChromeOS:Y,bIE:!1,bEdge:q,bUC:!1,bPlaybook:!1,bBlackBerry:!1,bHuaWeiBrowser:!1,bOpera:re,bFirefox:!1,bChrome:se,bJSDom:!1,biPhone:G,biPad:ve,bPad:B&&!y.mobile,bSafari:!1,bMobile:ce,strBrowserVersion:Te,bHTML5Edition:!0,IEVersion:0,IEMode:0}}(st,mt,tt)))}Je&&(Ze||(Ze=Qe.userAgent.toLowerCase()),et||(et=Qe.platform.toLowerCase()),de=function(y,C){var x,w=y.toLowerCase(),T=C.toLowerCase(),A=/harmonyos/g.test(w);"linux"==T&&w.indexOf("windows nt")>=0&&(T="harmonyos",A=!0);var D=!A&&/cros/.test(w),M=!A&&/android/g.test(w)||/android/g.test(T),B=/iphone/g.test(w)||/iphone/g.test(T),H=/macintosh/.test(w),Y=navigator.maxTouchPoints||0,G=/ipad/g.test(w)||(H||"macintel"==T)&&Y>1,q=/ucweb|ucbrowser/g.test(w),re=!q&&/nexus/g.test(w)&&/version\/[\d.]+.*safari\//g.test(w),se=/playbook/g.test(w),ce=/hp-tablet/g.test(w),ve=/blackberry|bb10/g.test(w),Te=/symbian/g.test(w),Ue=/windows phone/g.test(w),je=/mobile/g.test(w),Ee=/arm64|aarch64/g.test(w),Oe=/mips64/g.test(w),He=/huaweibrowser/g.test(w),we=/jsdom/g.test(w),ue=se||G||ce,pe=!ue&&!D&&(B||re||ve||Te||Ue||M||A||je),ye=!pe&&!ue&&!D,me=ye&&/win32|win64|windows/.test(T),Se=me&&/win64|x64/.test(w),We=ye&&/mac68k|macppc|macintosh|macintel/.test(w),ze=ye&&/linux/.test(T),Be="win64"==T||/wow64|x86_64|win64|x64/.test(w)||Ee||Oe,$e=/wow64/g.test(w),Ge=fe,_t=/opera|opr/g.test(w),Ct=/360se/g.test(w),Ut=/maxthon/g.test(w),Tn=/tencenttraveler|qqbrowser/g.test(w),mn=/the world/g.test(w),bt=/metasr/g.test(w),At=/avant/g.test(w),Tt=/firefox|fxios/g.test(w),Bt=/gecko/g.test(w),Qt=!(Tt||He)&&/edge\/|edga\/|edgios\/|edg\//g.test(w),yn=!(ve||se||q||_t||Qt||He||we)&&/chrome|crios/g.test(w),un=!1,Ir="",jn=0,hi=0,jt="";if(me&&!Qt&&!Tt&&!yn){var xs=w.indexOf("msie "),qp=w.indexOf("trident"),Er=w.indexOf("rv:");un=-1!=xs||-1!=qp||-1!=Er}if(!(We||B||G||me||ve||se||re)||q||_t||Qt||un||Tt||(x=w.match(/version\/([\d.]+).*safari\//))&&(ve||se||re||(Ge=ae,yn=fe),jt=x[1]),Qt){var Rr=w.indexOf("edge/");Rr>-1?Rr+=5:(Rr=w.indexOf("edg/"))>-1?Rr+=4:(Rr=w.indexOf("edga/"))>-1?Rr+=5:(Rr=w.indexOf("edgios/"))>-1&&(Rr+=7),Rr>-1&&(x=(jt=w.slice(Rr)).indexOf(" "))>-1&&(jt=jt.slice(0,x))}else if(Tt)if((x=w.indexOf("firefox/"))>-1){var jo=(x=w.slice(x+8)).indexOf(" ");jo>-1&&(x=x.slice(0,jo)),jt=x,(jo=x.indexOf("."))>-1&&(x=jt.slice(0,jo))}else(B||G)&&(x=w.indexOf("fxios/"))>-1&&(jt=x=(x=w.slice(x+6)).slice(0,x.indexOf(" ")));else if(un){var Dm=w.indexOf("msie "),Qa=w.indexOf("trident"),xl=w.indexOf("rv:");-1!=Dm?Ir=x=(x=w.slice(Dm+5)).slice(0,x.indexOf(";")):-1!=xl?Ir=x=(x=(x=w.slice(xl+3)).slice(0,x.indexOf(";"))).slice(0,x.indexOf(")")):-1!=Qa&&(Ir=x=(x=w.slice(Qa+7)).slice(0,x.indexOf(";"))),jt=x}else if(Ge)(x=jt.indexOf("."))>-1&&(x=jt.slice(0,x));else if(q)(x=w.indexOf("ucweb"))>-1?jt=w.slice(x+5):(x=w.indexOf("ucbrowser/"))>-1&&(x=(jt=w.slice(x+10)).indexOf(" "))>-1&&(jt=jt.slice(0,x));else if(_t)(x=w.indexOf("version/"))>-1?jt=w.slice(x+8):(x=w.indexOf("opr/"))>-1&&(jt=w.slice(x+4));else if(Te)(x=w.indexOf("browserng/"))>-1&&(jt=w.slice(x+10));else if(Ue)(x=w.indexOf("iemobile/"))>-1&&(jt=w.slice(x+9));else if(yn){var Sa=w.indexOf("chrome/");Sa>-1?(x=(jt=w.slice(Sa+7)).indexOf(" "))>-1&&(jt=jt.slice(0,x)):(Sa=w.indexOf("crios/"))>-1&&(x=(jt=w.slice(Sa+6)).indexOf(" "))>-1&&(jt=jt.slice(0,x)),(x=jt.indexOf("."))>-1&&(x=jt.slice(0,x))}else if(He){var md=w.indexOf("huaweibrowser");md>-1&&(x=(jt=w.slice(md+14)).indexOf(" "))>-1&&(jt=jt.slice(0,x))}else if(we){var ws=w.indexOf("jsdom");ws>-1&&(x=(jt=w.slice(ws+6)).indexOf(" "))>-1&&(jt=jt.slice(0,x))}if(Qt||un){var Ta=window.document;Ta&&Ta.documentMode?jn=Ta.documentMode:(jn=5,Ta.compatMode&&"CSS1Compat"==Ta.compatMode&&(jn=7)),un&&(hi=parseInt(jt))}(We||ze)&&(Be=!0,We&&(x=w.match(/mac os x (\d+)(_|\.)(\d+)/))&&x.length>3&&(10==x[1]&&x[3]<14||x[1]<10)&&(Be=!1)),me||We||ze||Ee||Oe||(pe=!0);var Ho=!0;if(un)if(""===Ir||parseInt(Ir)>=10){var vd=O.Dynamsoft;vd&&vd.DWT&&vd.DWT.IfUseActiveXForIE10Plus&&(Ho=fe)}else Ho=fe;return{bUseUserAgent:!0,bWin:me,bMac:We,bLinux:ze,bMobile:pe,bPad:ue,bChromeOS:D,bHarmonyOS:A,bArm64:Ee,bMips64:Oe,bEmbed:Ee||Oe,bAndroid:M,biPhone:B,biPad:G,bWin64:Se,bWOW64:$e,bOSx64:Be,bIE:un,bEdge:Qt,bChrome:yn,bFirefox:Tt,bSafari:Ge,bOpera:_t,bNexus:re,bUC:q,b360SE:Ct,bMaxthon:Ut,bTencentTraveler:Tn,bTheWorld:mn,bMetaSr:bt,bAvant:At,bHuaWeiBrowser:He,bJSDom:we,bGecko:Bt,bHTML5Edition:Ho,strBrowserVersion:jt,IEVersion:hi,IEMode:jn}}(Ze,et));var ut=null===(Re=null==document?void 0:document.location)||void 0===Re?void 0:Re.protocol;function Ke(y){return de.bGecko&&"mousewheel"===y?"DOMMouseScroll":y}function nt(y,C,x){var w=Ke(C);y&&y.addEventListener(w,x,!1)}function lt(y,C,x){var w=Ke(C);y&&y.removeEventListener(w,x,!1)}function xt(y){var C=y||O.event;C.preventDefault&&C.preventDefault(),C.stopPropagation&&C.stopPropagation(),C.returnValue=!1,C.cancelBubble=!0}function dt(y,C){var x=O.document.createEvent("HTMLEvents");x.initEvent(y,ae,ae),C.dispatchEvent&&C.dispatchEvent(x)}ut||(ut="https:"),de.protocol=ut,de.bSSL="https:"===ut,de.bFileSystem="https:"!==ut&&"http:"!==ut;var Dt,Rt,Nt,Ot,Vt=O.document,$t=[],on=$t.push,sn=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,bn=function(){Rt()};function ct(y,C,x,w){var T,A,D,M=C&&C.ownerDocument,B=C?C.nodeType:9;if(x=x||[],"string"!=typeof y||!y||1!==B&&9!==B&&11!==B)return x;if(!w&&((C?C.ownerDocument||C:Vt)!==Nt&&Rt(C),C=C||Nt,11!==B&&(D=sn.exec(y))))if(T=D[1]){if(9===B){if(!(A=C.getElementById(T)))return x;if(A.id===T)return x.push(A),x}else if(M&&(A=M.getElementById(T))&&Ot(C,A)&&A.id===T)return x.push(A),x}else{if(D[2])return on.apply(x,C.getElementsByTagName(y)),x;if((T=D[3])&&C.getElementsByClassName)return on.apply(x,C.getElementsByClassName(T)),x}return x}on.apply($t.slice.call(Vt.childNodes),Vt.childNodes),Rt=ct.setDocument=function(y){var C,x=y?y.ownerDocument||y:Vt;return x!==Nt&&9===x.nodeType&&x.documentElement&&(Vt!==(Nt=x)&&(C=Nt.defaultView)&&C.top!==C&&(C.addEventListener?C.addEventListener("unload",bn,!1):C.attachEvent&&C.attachEvent("onunload",bn)),Ot=function(w,T){if(T)for(;T=T.parentNode;)if(T===w)return!0;return!1}),Nt},ct.contains=function(y,C){return(y.ownerDocument||y)!==Nt&&Rt(y),Ot(y,C)},ct.error=function(y){throw new Error("Syntax error: "+y)},Dt=ct.getText=function(y){var C,x="",w=0,T=y.nodeType;if(T){if(1===T||9===T||11===T){if("string"==typeof y.textContent)return y.textContent;for(y=y.firstChild;y;y=y.nextSibling)x+=Dt(y)}else if(3===T||4===T)return y.nodeValue}else for(;C=y[w++];)x+=Dt(C);return x},Rt();var ht={encodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeChars:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1]},Ft={UTF16ToUTF8:function(y){for(var C,x,w=[],T=y.length,A=0;A<T;A++){var D=y.charCodeAt(A);if(D>0&&D<=127)w.push(y.charAt(A));else if(D>=128&&D<=2047)C=192|D>>6&31,x=128|63&D,w.push(String.fromCharCode(C),String.fromCharCode(x));else if(D>=2048&&D<=65535){C=224|D>>12&15,x=128|D>>6&63;var M=128|63&D;w.push(String.fromCharCode(C),String.fromCharCode(x),String.fromCharCode(M))}}return w.join("")},UTF8ToUTF16:function(y){var C,x,w,T,A=[],D=y.length;for(C=0;C<D;C++)(x=y.charCodeAt(C))>>7&255?6==(x>>5&255)?(T=(31&x)<<6|63&(w=y.charCodeAt(++C)),A.push(String.fromCharCode(T))):14==(x>>4&255)&&(T=(255&(x<<4|(w=y.charCodeAt(++C))>>2&15))<<8|(3&w)<<6|63&y.charCodeAt(++C),A.push(String.fromCharCode(T))):A.push(y.charAt(C));return A.join("")},encode:function(y){for(var C,x,w,T=this.UTF16ToUTF8(y),A=[],D=0,M=T.length;D<M;){if(C=255&T.charCodeAt(D++),D==M){A.push(ht.encodeChars.charAt(C>>2)),A.push(ht.encodeChars.charAt((3&C)<<4)),A.push("==");break}if(x=T.charCodeAt(D++),D==M){A.push(ht.encodeChars.charAt(C>>2)),A.push(ht.encodeChars.charAt((3&C)<<4|(240&x)>>4)),A.push(ht.encodeChars.charAt((15&x)<<2)),A.push("=");break}w=T.charCodeAt(D++),A.push(ht.encodeChars.charAt(C>>2)),A.push(ht.encodeChars.charAt((3&C)<<4|(240&x)>>4)),A.push(ht.encodeChars.charAt((15&x)<<2|(192&w)>>6)),A.push(ht.encodeChars.charAt(63&w))}return A.join("")},encodeArray:function(y){for(var C,x,w,T=[],A=0,D=y.length;A<D;){if(C=255&y[A++],A==D){T.push(ht.encodeChars.charAt(C>>2)),T.push(ht.encodeChars.charAt((3&C)<<4)),T.push("==");break}if(x=255&y[A++],A==D){T.push(ht.encodeChars.charAt(C>>2)),T.push(ht.encodeChars.charAt((3&C)<<4|(240&x)>>4)),T.push(ht.encodeChars.charAt((15&x)<<2)),T.push("=");break}w=255&y[A++],T.push(ht.encodeChars.charAt(C>>2)),T.push(ht.encodeChars.charAt((3&C)<<4|(240&x)>>4)),T.push(ht.encodeChars.charAt((15&x)<<2|(192&w)>>6)),T.push(ht.encodeChars.charAt(63&w))}return T.join("")},decode:function(y,C){for(var x,w,T,A,D=this,M=[],B=0,H=y.length;B<H;){do{x=ht.decodeChars[255&y.charCodeAt(B++)]}while(B<H&&-1==x);if(-1==x)break;do{w=ht.decodeChars[255&y.charCodeAt(B++)]}while(B<H&&-1==w);if(-1==w)break;M.push(C?x<<2|(48&w)>>4:String.fromCharCode(x<<2|(48&w)>>4));do{if(61==(T=255&y.charCodeAt(B++)))return C?M:D.UTF8ToUTF16(M.join(""));T=ht.decodeChars[T]}while(B<H&&-1==T);if(-1==T)break;M.push(C?(15&w)<<4|(60&T)>>2:String.fromCharCode((15&w)<<4|(60&T)>>2));do{if(61==(A=255&y.charCodeAt(B++)))return C?M:D.UTF8ToUTF16(M.join(""));A=ht.decodeChars[A]}while(B<H&&-1==A);if(-1==A)break;M.push(C?(3&T)<<6|A:String.fromCharCode((3&T)<<6|A))}return C?M:D.UTF8ToUTF16(M.join(""))}},Wt={fromUTF16:function(y){for(var C,x=[],w=0,T=y.length;w<T;)(C=y.charCodeAt(w))>=1&&C<=127?x.push(y.charAt(w)):C>2047?(x.push(String.fromCharCode(224|C>>12&15)),x.push(String.fromCharCode(128|C>>6&63)),x.push(String.fromCharCode(128|63&C))):(x.push(String.fromCharCode(192|C>>6&31)),x.push(String.fromCharCode(128|63&C))),w++;return x.join("")},toUTF16:function(y){for(var C,x,w,T=[],A=0,D=y.length;A<D;)switch((C=y.charCodeAt(A++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:T.push(y.charAt(A-1));break;case 12:case 13:x=y.charCodeAt(A++),T.push(String.fromCharCode((31&C)<<6|63&x));break;case 14:x=y.charCodeAt(A++),w=y.charCodeAt(A++),T.push(String.fromCharCode((15&C)<<12|(63&x)<<6|63&w))}return T.join("")}},rn="undefined"!=typeof self?self:global,Yn=rn.btoa?function(y){return rn.btoa(y)}:function(y){for(var C,x,w=String(y),T=0,A=ht.encodeChars,D="";w.charAt(0|T)||(A="=",T%1);D+=A.charAt(63&C>>8-T%1*8)){if((x=w.charCodeAt(T+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");C=C<<8|x}return D},ki=rn.atob?function(y){return rn.atob(y)}:function(y){var C=String(y).replace(/[=]+$/,"");if(C.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var x,w,T=0,A=0,D="";w=C.charAt(A++);~w&&(x=T%4?64*x+w:w,T++%4)?D+=String.fromCharCode(255&x>>(-2*T&6)):0)w=ht.encodeChars.indexOf(w);return D};function Hi(y){if(null==y||"object"!=p(y))return y;var C,x,w;if(y instanceof Date)return(C=new Date).setTime(y.getTime()),C;if(y instanceof Array){for(C=[],w=y.length,x=0;x<w;x++)C[x]=Hi(y[x]);return C}if(y instanceof Object){for(x in C={},y)y.hasOwnProperty(x)&&(C[x]=Hi(y[x]));return C}return 0}function Ji(y){return Math.random().toString(16).substring(2,2+y)}function Or(y){var C=[Ji(8),"-",Ji(4),"-",Ji(4),"-",Ji(4),"-",Ji(8)];return y&&C.unshift(y),C.join("")}var Ga=Date.now||function(){return+new Date},ca=function(){return""+Ga()};function Ju(){for(var y,C=Ga()%1e4,x=[],w=0;w<5;w++)y=Math.floor(10*Math.random()),0!=w||0!=y?x.push(y):w=-1;return C<10?x.push("000"):C<100?x.push("00"):C<1e3&&x.push("0"),x.push(C),x.join("")}function eh(y,C){var x;for(x in C)C.hasOwnProperty(x)&&(y[x]=C[x]);return y}var em=!1;"wakeLock"in navigator&&(em=!0);var l1=null;function V4e(){em&&(null==l1?function(){!function kw(y,C,x,w){new(x||(x=Promise))(function(T,A){function D(H){try{B(w.next(H))}catch(Y){A(Y)}}function M(H){try{B(w.throw(H))}catch(Y){A(Y)}}function B(H){var Y;H.done?T(H.value):(Y=H.value,Y instanceof x?Y:new x(function(G){G(Y)})).then(D,M)}B((w=w.apply(y,C||[])).next())})}(this,void 0,void 0,W.mark(function y(){return W.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.prev=0,C.next=3,navigator.wakeLock.request("screen");case 3:l1=C.sent,C.next=9;break;case 6:C.prev=6,C.t0=C.catch(0),l1=null;case 9:case"end":return C.stop()}},y,null,[[0,6]])}))}():l1.release().then(function(){l1=null}))}function j4e(){return l1}var Nne=Array.prototype;function c1(y,C,x){return Nne.filter.call(y,C,x||this)}function H4e(y,C){return Nne.indexOf.call(C,y)}function G4e(y){var C,x,w=[],T=y.length;for(C=0;C<T;C++){for(x=C+1;x<T;x++)y[C]===y[x]&&(x=++C);w.push(y[C])}return w}var VL=/^(\/?)([\s\S]+\/(?!$)|\/)?((?:\.{1,2}$|[\s\S]+?)?(\.[^.\/]*)?)$/;function Bne(y,C){var x,w=[];for(x=0;x<y.length;x++){var T=y[x];T&&"."!==T&&(".."===T?w.length&&".."!==w[w.length-1]?w.pop():C&&w.push(".."):w.push(T))}return w}function jL(y){var C="/"===y.charAt(0),x="/"===y.slice(-1);return(y=Bne(c1(y.split("/"),function(w){return!!w}),!C).join("/"))||C||(y="."),y&&x&&(y+="/"),(C?"/":"")+y}var z4e=function(){function y(){l(this,y)}return g(y,[{key:"resolve",value:function(){var C,x,w="",T=arguments,A=!1;for(C=T.length-1;C>=0&&!A;C--)_e(x=T[C])&&x&&(w=x+"/"+w,A="/"===x.charAt(0));return(A?"/":"")+Bne(c1(w.split("/"),function(D){return!!D}),!A).join("/")||"."}},{key:"join",value:function(){return jL(c1(Le(arguments),function(C){return C&&_e(C)}).join("/"))}},{key:"relative",value:function(C,x){C=jL(C),x=jL(x);var w,T,A=c1(C.split("/"),function(H){return!!H}),D=[],M=c1(x.split("/"),function(H){return!!H}),B=Math.min(A.length,M.length);for(w=0;w<B&&A[w]===M[w];w++);for(T=w;w<A.length;)D.push(".."),w++;return(D=D.concat(M.slice(T))).join("/")}},{key:"basename",value:function(C,x){var w;return w=(C.match(VL)||[])[3]||"",x&&w&&w.slice(-1*x.length)===x&&(w=w.slice(0,-1*x.length)),w}},{key:"dirname",value:function(C){var x=C.match(VL)||[],w=x[1]||"",T=x[2]||"";return w||T?(T&&(T=T.substring(0,T.length-1)),w+T):"."}},{key:"extname",value:function(C){return(C.match(VL)||[])[4]||""}}]),y}(),HL={}.hasOwnProperty;function Y4e(y){if(!y||"object"!==le(y)||y.nodeType||y.window==y)return fe;var C,x;try{if((x=y.constructor)&&!HL(y,"constructor")&&!HL(x.prototype,"isPrototypeOf"))return fe}catch(w){return fe}for(C in y);return K(C)||HL(y,C)}var X4e="object"===("undefined"==typeof HTMLElement?"undefined":p(HTMLElement));function Wne(y){return X4e?y instanceof HTMLElement:y&&"object"===p(y)&&(1===y.nodeType||9===y.nodeType)&&"string"==typeof y.nodeName}function $4e(y){var C=y;if(Wne(y))for(;!C&&C!=document.body;)C=C.parentNode;else C=0;return!!C}function q4e(y,C){return 0===y.lastIndexOf(C,0)}function K4e(y,C){var x=y.length-C.length;return x>=0&&y.indexOf(C,x)===x}function J4e(y){return null==y?"":String.prototype.trim.call(y)}function Q4e(y){var C;if(y)for(C in y)if(!K(C))return!1;return!0}function Z4e(y){return _e(y)?y.replace(/[^\x20-\x7E]/g,""):y}function eMe(y,C,x){return y.replace(new RegExp(C,"gi"),x)}function tMe(y){return y.charAt(0).toUpperCase()+y.substr(1)}var GL="none",nMe={getOffset:function(y,C,x){var w,T;y=y||O.event;for(var A,D,M=x||y.target,B=0,H=0,Y=0,G=0,q=!1,re=O.document;M&&!isNaN(M.offsetLeft)&&!isNaN(M.offsetTop);)D=M.scrollLeft,A=M.scrollTop,"BODY"===M.tagName?q?(D=0,A=0):(D|=null===(w=re.documentElement)||void 0===w?void 0:w.scrollLeft,A|=null===(T=re.documentElement)||void 0===T?void 0:T.scrollTop):"fixed"===M.style.position&&(q=!0),B+=M.offsetLeft-D,H+=M.offsetTop-A,M=M.offsetParent;return C&&(Y=C.Left,G=C.Top),{x:B=y.clientX-B-Y,y:H=y.clientY-H-G}},getElDimensions:function(y,C){var x,w;return y?(x=y.style.display,y.style.display="",w=C?{offsetTop:y.offsetTop,offsetLeft:y.offsetLeft,offsetWidth:y.offsetWidth,offsetHeight:y.offsetHeight}:{clientTop:y.clientTop,clientLeft:y.clientLeft,clientWidth:y.clientWidth?y.clientWidth:parseInt(y.style.width)?parseInt(y.style.width):0,clientHeight:y.clientHeight?y.clientHeight:parseInt(y.style.height)?parseInt(y.style.height):0},y.style.display=x,w):{offsetTop:0,offsetLeft:0,offsetWidth:0,offsetHeight:0}}};function AD(y){return document.getElementById(y)}function iMe(y){var C=_e(y)?AD(y):y;C&&(C.length>0&&(C=C[0]),C.style.display=GL)}function rMe(y){var C=_e(y)?AD(y):y;C&&(C.length>0&&(C=C[0]),C.style.display="")}function oMe(y){var C=_e(y)?AD(y):y;C&&(C.length>0&&(C=C[0]),C.style.display=C.style.display===GL?"":GL)}function sMe(y){if(y)for(;y.firstChild;)y.removeChild(y.firstChild)}function aMe(y){return encodeURIComponent(String(y))}function lMe(y){return decodeURIComponent(y.replace(/\+/g," "))}var u1=document,cMe=u1&&u1.documentElement,d1=u1.getElementsByTagName("head")[0]||cMe,zL=u1.createElement("script").readyState?function(y,C){var x=y.onreadystatechange;y.onreadystatechange=function(){var w=y.readyState;"loaded"===w||"complete"===w?(y.onreadystatechange=null,x&&x(),C.call(this,{type:"load",path:[y]})):"loading"===w||C.call(this,{type:"error",path:[y]})}}:function(y,C){y.addEventListener("load",C,fe),y.addEventListener("error",C,fe)};function uMe(y,C,x){return YL(y,C,!1,x)}function YL(y,C,x,w){var T,A,D=w;if(he(D)||(D=function(){}),_e(y)&&""!=y)return T=u1.createElement("script"),A=["",y].join(""),T.src=A,C&&(T.async=!0),T.charset="utf-8",zL(T,D),x?d1.appendChild(T):d1.insertBefore(T,d1.firstChild),T;D()}function dMe(y,C,x){return Vne(y,C,!1,x)}function Vne(y,C,x,w){var T=w;if(he(T)||(T=function(){}),de.bJSDom)T("ok");else if(xe(y)){var A=y.length,D=function(M){M&&"load"==M.type?A--:(M&&"error"==M.type&&X(["Failed to load resource: ",M.target.src,"."].join("")),T()),A<=0&&T("ok")};A<=0?T("ok"):be(y,function(M){YL(M,C,x,D)})}else T()}function hMe(y,C){return XL(y,!1,C)}function XL(y,C,x){var w,T=x;if(he(T)||(T=!1),_e(y)&&""!=y){if(!de.bJSDom)return(w=u1.createElement("link")).href=y,w.rel="stylesheet",w.async=!0,T&&zL(w,T),C?d1.appendChild(w):d1.insertBefore(w,d1.firstChild),w;T&&T()}else T&&T()}function fMe(y,C){return jne(y,!1,C)}function jne(y,C,x){if(de.bJSDom)x&&x("ok");else if(xe(y)){var w=y.length,T=function(A){A&&"load"==A.type&&w--,A&&"load"!=A.type&&(A&&"error"==A.type&&X(["Failed to load resource: ",A.target.href,"."].join("")),x()),w<=0&&x("ok")};be(y,function(A){XL(A,C,T)})}else x&&x()}function Hne(y){var C,x;if(!de.bJSDom){var w=document;if(w&&_e(x=y.body)&&""!=x){(C=w.createElement("script")).charset="utf-8",de.bIE?C.text=x:C.appendChild(w.createTextNode(x)),C.language=y.language?y.language:"javascript",C.type=y.type?y.type:"text/javascript";var T=w&&w.documentElement,A=w.getElementsByTagName("head")[0]||T;A.insertBefore(C,A.firstChild)}}}function pMe(y){Hne({body:y})}function gMe(y){Hne({body:y,language:"vbscript",type:"text/vbscript"})}var ge,tm,mMe=function(){function y(){l(this,y),this.nil=void 0,this.bNode=!1,this.noop=function(){},this.mix=eh,this.clone=Hi,this.keys=Object.keys,this.now=ca,this.getFormatedNow=J,this.getRandom=Ju,this.guid=Or,this.get=AD,this.show=rMe,this.hide=iMe,this.toggle=oMe,this.empty=sMe,this.stringify=O.JSON.stringify,this.parse=O.JSON.parse,this.isDef=Q,this.isUndef=K,this.isUndefined=K,this.isNull=ie,this.isNaN=isNaN,this.isFunction=he,this.isString=_e,this.isObject=Ve,this.isBoolean=ee,this.isNumber=ke,this.isArray=xe,this.type=le,this.isPlainObject=Y4e,this.isDOM=Wne,this.isDOMInBody=$4e,this.each=be,this.getLogger=$,this.setLogger=P,this.log=L,this.error=X,this.warn=ne,this.info=Z,this.filter=c1,this.indexOf=H4e,this.uniq=G4e,this.startsWith=q4e,this.endsWith=K4e,this.replaceAll=eMe,this.upperCaseFirst=tMe,this.removeNonPrintableChar=Z4e,this.trim=J4e,this.makeArray=Le,this.isEmptyObject=Q4e,this.Path=new z4e,this.DOM=nMe,this.isWindow=De,this.globalEval=Xe,this.obj={customEvent:Pe},this.addEventListener=nt,this.removeEventListener=lt,this.stopPropagation=xt,this.fireEvent=dt,this.base64=Ft,this.utf8=Wt,this.btoa=Yn,this.atob=ki,this.asyncQueue=te,this.sizzle=ct,this.toggleWakeLock=V4e,this.getWakeLock=j4e,this.urlEncode=aMe,this.urlDecode=lMe,this.scriptOnload=zL,this.addAllCss=jne,this.getAllCss=fMe,this.addCss=XL,this.getCss=hMe,this.addScripts=Vne,this.getScripts=dMe,this.addScript=YL,this.getScript=uMe,this.addJS=pMe,this.addVBS=gMe}return g(y,[{key:"debug",get:function(){return z.debug},set:function(C){z.debug=C}},{key:"showConsoleError",get:function(){return z.debug},set:function(C){z.showConsoleError=C}}]),y}(),U=new mMe,zne=!!("object"==("undefined"==typeof global?"undefined":p(global))&&global.process&&global.process.release&&global.process.release.name&&"undefined"==typeof HTMLCanvasElement),$L=zne?global:self||{},Ce=$L.Dynamsoft;function qs(y){return Math.floor(y)}function Eo(y,C){if(!(y instanceof C))throw new TypeError("Cannot call a class as a function")}Ce?Ce.Lib||(Ce.Lib={}):(Ce={Lib:{},DWT:{}},$L&&($L.Dynamsoft=Ce)),ge=U.mix(Ce.Lib,U),(tm=Ce).DWT||(tm.DWT={}),tm.DWT.LTS||(tm.DWT.LTS={}),tm.Lib.UI||(tm.Lib.UI={}),tm.Lib.html5||(tm.Lib.html5={});var Yne={exports:{}},Mw=function(y){return y&&y.Math===Math&&y},Hr=Mw("object"==typeof Ku&&Ku)||Mw("object"==typeof window&&window)||Mw("object"==typeof self&&self)||Mw("object"==typeof m&&m)||Mw("object"==typeof m&&m)||function(){return this}()||Function("return this")(),Cr=function(y){try{return!!y()}catch(C){return!0}},Ow=!Cr(function(){var y=function(){}.bind();return"function"!=typeof y||y.hasOwnProperty("prototype")}),Xne=Function.prototype,$ne=Xne.apply,qne=Xne.call,h1="object"==typeof Reflect&&Reflect.apply||(Ow?qne.bind($ne):function(){return qne.apply($ne,arguments)}),Kne=Ow,Jne=Function.prototype,qL=Jne.call,yMe=Kne&&Jne.bind.bind(qL,qL),Pr=Kne?yMe:function(y){return function(){return qL.apply(y,arguments)}},Qne=Pr,_Me=Qne({}.toString),CMe=Qne("".slice),Ep=function(y){return CMe(_Me(y),8,-1)},bMe=Ep,xMe=Pr,f1=function(y){if("Function"===bMe(y))return xMe(y)},KL="object"==typeof document&&document.all,vs=void 0===KL&&void 0!==KL?function(y){return"function"==typeof y||y===KL}:function(y){return"function"==typeof y},Dp={},es=!Cr(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}),PD=Function.prototype.call,Ps=Ow?PD.bind(PD):function(){return PD.apply(PD,arguments)},Fw={},Zne={}.propertyIsEnumerable,eie=Object.getOwnPropertyDescriptor,SMe=eie&&!Zne.call({1:2},1);Fw.f=SMe?function(y){var C=eie(this,y);return!!C&&C.enumerable}:Zne;var nm,RD,im=function(y,C){return{enumerable:!(1&y),configurable:!(2&y),writable:!(4&y),value:C}},TMe=Cr,IMe=Ep,JL=Object,EMe=Pr("".split),QL=TMe(function(){return!JL("z").propertyIsEnumerable(0)})?function(y){return"String"===IMe(y)?EMe(y,""):JL(y)}:JL,p1=function(y){return null==y},DMe=p1,AMe=TypeError,rm=function(y){if(DMe(y))throw new AMe("Can't call method on "+y);return y},PMe=QL,RMe=rm,th=function(y){return PMe(RMe(y))},kMe=vs,ys=function(y){return"object"==typeof y?null!==y:kMe(y)},Co={},ZL=Co,e8=Hr,MMe=vs,tie=function(y){return MMe(y)?y:void 0},ba=function(y,C){return arguments.length<2?tie(ZL[y])||tie(e8[y]):ZL[y]&&ZL[y][C]||e8[y]&&e8[y][C]},Rs=Pr({}.isPrototypeOf),Lw="undefined"!=typeof navigator&&String(navigator.userAgent)||"",t8=Lw,iie=Hr.process,rie=Hr.Deno,oie=iie&&iie.versions||rie&&rie.version,sie=oie&&oie.v8;sie&&(RD=(nm=sie.split("."))[0]>0&&nm[0]<4?1:+(nm[0]+nm[1])),!RD&&t8&&(!(nm=t8.match(/Edge\/(\d+)/))||nm[1]>=74)&&(nm=t8.match(/Chrome\/(\d+)/))&&(RD=+nm[1]);var kD=RD,aie=kD,FMe=Hr.String,g1=!!Object.getOwnPropertySymbols&&!Cr(function(){var y=Symbol("symbol detection");return!FMe(y)||!(Object(y)instanceof Symbol)||!Symbol.sham&&aie&&aie<41}),lie=g1&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,LMe=ba,NMe=vs,BMe=Rs,WMe=Object,Nw=lie?function(y){return"symbol"==typeof y}:function(y){var C=LMe("Symbol");return NMe(C)&&BMe(C.prototype,WMe(y))},UMe=String,Zv=function(y){try{return UMe(y)}catch(C){return"Object"}},VMe=vs,jMe=Zv,HMe=TypeError,tu=function(y){if(VMe(y))return y;throw new HMe(jMe(y)+" is not a function")},GMe=tu,zMe=p1,n8=function(y,C){var x=y[C];return zMe(x)?void 0:GMe(x)},i8=Ps,r8=vs,o8=ys,YMe=TypeError,cie={exports:{}},uie=Hr,$Me=Object.defineProperty,die="__core-js_shared__",hie=cie.exports=Hr[die]||function(y,C){try{$Me(uie,y,{value:C,configurable:!0,writable:!0})}catch(x){uie[y]=C}return C}(die,{});(hie.versions||(hie.versions=[])).push({version:"3.37.0",mode:"pure",copyright:"\xa9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.0/LICENSE",source:"https://github.com/zloirock/core-js"});var s8=cie.exports,fie=s8,m1=function(y,C){return fie[y]||(fie[y]=C||{})},JMe=rm,QMe=Object,sf=function(y){return QMe(JMe(y))},ZMe=sf,eOe=Pr({}.hasOwnProperty),ks=Object.hasOwn||function(y,C){return eOe(ZMe(y),C)},tOe=Pr,nOe=0,iOe=Math.random(),rOe=tOe(1..toString),MD=function(y){return"Symbol("+(void 0===y?"":y)+")_"+rOe(++nOe+iOe,36)},pie=ks,sOe=MD,aOe=g1,lOe=lie,v1=Hr.Symbol,a8=m1("wks"),cOe=lOe?v1.for||v1:v1&&v1.withoutSetter||sOe,bo=function(y){return pie(a8,y)||(a8[y]=aOe&&pie(v1,y)?v1[y]:cOe("Symbol."+y)),a8[y]},uOe=Ps,gie=ys,mie=Nw,dOe=n8,fOe=TypeError,pOe=bo("toPrimitive"),mOe=Nw,l8=function(y){var C=function(y,C){if(!gie(y)||mie(y))return y;var x,w=dOe(y,pOe);if(w){if(void 0===C&&(C="default"),x=uOe(w,y,C),!gie(x)||mie(x))return x;throw new fOe("Can't convert object to primitive value")}return void 0===C&&(C="number"),function(y,C){var x,w;if("string"===C&&r8(x=y.toString)&&!o8(w=i8(x,y))||r8(x=y.valueOf)&&!o8(w=i8(x,y))||"string"!==C&&r8(x=y.toString)&&!o8(w=i8(x,y)))return w;throw new YMe("Can't convert object to primitive value")}(y,C)}(y,"string");return mOe(C)?C:C+""},vie=ys,c8=Hr.document,vOe=vie(c8)&&vie(c8.createElement),u8=function(y){return vOe?c8.createElement(y):{}},yOe=u8,yie=!es&&!Cr(function(){return 7!==Object.defineProperty(yOe("div"),"a",{get:function(){return 7}}).a}),COe=Ps,bOe=Fw,xOe=im,wOe=th,SOe=l8,TOe=ks,IOe=yie,_ie=Object.getOwnPropertyDescriptor;Dp.f=es?_ie:function(y,C){if(y=wOe(y),C=SOe(C),IOe)try{return _ie(y,C)}catch(x){}if(TOe(y,C))return xOe(!COe(bOe.f,y,C),y[C])};var EOe=Cr,DOe=vs,AOe=/#|\.prototype\./,Bw=function(y,C){var x=ROe[POe(y)];return x===MOe||x!==kOe&&(DOe(C)?EOe(C):!!C)},POe=Bw.normalize=function(y){return String(y).replace(AOe,".").toLowerCase()},ROe=Bw.data={},kOe=Bw.NATIVE="N",MOe=Bw.POLYFILL="P",Cie=Bw,OOe=tu,FOe=Ow,LOe=f1(f1.bind),Ap=function(y,C){return OOe(y),void 0===C?y:FOe?LOe(y,C):function(){return y.apply(C,arguments)}},fc={},bie=es&&Cr(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),NOe=ys,BOe=String,WOe=TypeError,jl=function(y){if(NOe(y))return y;throw new WOe(BOe(y)+" is not an object")},VOe=yie,OD=jl,xie=l8,HOe=TypeError,d8=Object.defineProperty,GOe=Object.getOwnPropertyDescriptor,h8="enumerable",f8="configurable",p8="writable";fc.f=es?bie?function(y,C,x){if(OD(y),C=xie(C),OD(x),"function"==typeof y&&"prototype"===C&&"value"in x&&p8 in x&&!x[p8]){var w=GOe(y,C);w&&w[p8]&&(y[C]=x.value,x={configurable:f8 in x?x[f8]:w[f8],enumerable:h8 in x?x[h8]:w[h8],writable:!1})}return d8(y,C,x)}:d8:function(y,C,x){if(OD(y),C=xie(C),OD(x),VOe)try{return d8(y,C,x)}catch(w){}if("get"in x||"set"in x)throw new HOe("Accessors not supported");return"value"in x&&(y[C]=x.value),y};var zOe=fc,YOe=im,om=es?function(y,C,x){return zOe.f(y,C,YOe(1,x))}:function(y,C,x){return y[C]=x,y},Ww=Hr,XOe=h1,$Oe=f1,qOe=vs,KOe=Dp.f,JOe=Cie,y1=Co,QOe=Ap,_1=om,wie=ks,ZOe=function(y){var C=function(x,w,T){if(this instanceof C){switch(arguments.length){case 0:return new y;case 1:return new y(x);case 2:return new y(x,w)}return new y(x,w,T)}return XOe(y,this,arguments)};return C.prototype=y.prototype,C},An=function(y,C){var x,w,T,A,D,M,B,H,Y,G=y.target,q=y.global,re=y.stat,se=y.proto,ce=q?Ww:re?Ww[G]:Ww[G]&&Ww[G].prototype,ve=q?y1:y1[G]||_1(y1,G,{})[G],Te=ve.prototype;for(A in C)w=!(x=JOe(q?A:G+(re?".":"#")+A,y.forced))&&ce&&wie(ce,A),M=ve[A],w&&(B=y.dontCallGetSet?(Y=KOe(ce,A))&&Y.value:ce[A]),D=w&&B?B:C[A],(x||se||typeof M!=typeof D)&&(H=y.bind&&w?QOe(D,Ww):y.wrap&&w?ZOe(D):se&&qOe(D)?$Oe(D):D,(y.sham||D&&D.sham||M&&M.sham)&&_1(H,"sham",!0),_1(ve,A,H),se&&(wie(y1,T=G+"Prototype")||_1(y1,T,{}),_1(y1[T],A,D),y.real&&Te&&(x||!Te[A])&&_1(Te,A,D)))},Sie=fc.f;An({target:"Object",stat:!0,forced:Object.defineProperty!==Sie,sham:!es},{defineProperty:Sie});var Tie=Co.Object,n5e=Yne.exports=function(y,C,x){return Tie.defineProperty(y,C,x)};Tie.defineProperty.sham&&(n5e.sham=!0);var Iie=Yne.exports,Eie=Iie,FD=v(Eie),i5e=Ep,e0=Array.isArray||function(y){return"Array"===i5e(y)},r5e=Math.ceil,o5e=Math.floor,s5e=Math.trunc||function(y){var C=+y;return(C>0?o5e:r5e)(C)},Uw=function(y){var C=+y;return C!=C||0===C?0:s5e(C)},a5e=Uw,l5e=Math.min,g8=function(y){var C=a5e(y);return C>0?l5e(C,9007199254740991):0},c5e=g8,t0=function(y){return c5e(y.length)},u5e=TypeError,Die=function(y){if(y>9007199254740991)throw u5e("Maximum allowed index exceeded");return y},d5e=es,h5e=fc,f5e=im,Vw=function(y,C,x){d5e?h5e.f(y,C,f5e(0,x)):y[C]=x},Aie={};Aie[bo("toStringTag")]="z";var m8="[object z]"===String(Aie),p5e=m8,g5e=vs,LD=Ep,m5e=bo("toStringTag"),v5e=Object,y5e="Arguments"===LD(function(){return arguments}()),n0=p5e?LD:function(y){var C,x,w;return void 0===y?"Undefined":null===y?"Null":"string"==typeof(x=function(T,A){try{return T[A]}catch(D){}}(C=v5e(y),m5e))?x:y5e?LD(C):"Object"===(w=LD(C))&&g5e(C.callee)?"Arguments":w},_5e=vs,v8=s8,C5e=Pr(Function.toString);_5e(v8.inspectSource)||(v8.inspectSource=function(y){return C5e(y)});var Pie=v8.inspectSource,b5e=Pr,x5e=Cr,Rie=vs,w5e=n0,S5e=Pie,kie=function(){},Mie=ba("Reflect","construct"),y8=/^\s*(?:class|function)\b/,T5e=b5e(y8.exec),I5e=!y8.test(kie),jw=function(y){if(!Rie(y))return!1;try{return Mie(kie,[],y),!0}catch(C){return!1}},Oie=function(y){if(!Rie(y))return!1;switch(w5e(y)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return I5e||!!T5e(y8,S5e(y))}catch(C){return!0}};Oie.sham=!0;var ND=!Mie||x5e(function(){var y;return jw(jw.call)||!jw(Object)||!jw(function(){y=!0})||y})?Oie:jw,Fie=e0,E5e=ND,D5e=ys,A5e=bo("species"),Lie=Array,_8=function(y,C){return new(function(y){var C;return Fie(y)&&(E5e(C=y.constructor)&&(C===Lie||Fie(C.prototype))||D5e(C)&&null===(C=C[A5e]))&&(C=void 0),void 0===C?Lie:C}(y))(0===C?0:C)},R5e=Cr,k5e=kD,M5e=bo("species"),Hw=function(y){return k5e>=51||!R5e(function(){var C=[];return(C.constructor={})[M5e]=function(){return{foo:1}},1!==C[y](Boolean).foo})},O5e=An,F5e=Cr,L5e=e0,N5e=ys,B5e=sf,W5e=t0,Nie=Die,Bie=Vw,U5e=_8,V5e=Hw,j5e=kD,Wie=bo("isConcatSpreadable"),H5e=j5e>=51||!F5e(function(){var y=[];return y[Wie]=!1,y.concat()[0]!==y}),G5e=function(y){if(!N5e(y))return!1;var C=y[Wie];return void 0!==C?!!C:L5e(y)};O5e({target:"Array",proto:!0,arity:1,forced:!H5e||!V5e("concat")},{concat:function(y){var C,x,w,T,A,D=B5e(this),M=U5e(D,0),B=0;for(C=-1,w=arguments.length;C<w;C++)if(G5e(A=-1===C?D:arguments[C]))for(T=W5e(A),Nie(B+T),x=0;x<T;x++,B++)x in A&&Bie(M,B,A[x]);else Nie(B+1),Bie(M,B++,A);return M.length=B,M}});var z5e=n0,Y5e=String,vl=function(y){if("Symbol"===z5e(y))throw new TypeError("Cannot convert a Symbol value to a string");return Y5e(y)},BD={},X5e=Uw,$5e=Math.max,q5e=Math.min,C8=function(y,C){var x=X5e(y);return x<0?$5e(x+C,0):q5e(x,C)},K5e=th,J5e=C8,Q5e=t0,Uie=function(y){return function(C,x,w){var T=K5e(C),A=Q5e(T);if(0===A)return!y&&-1;var D,M=J5e(w,A);if(y&&x!=x){for(;A>M;)if((D=T[M++])!=D)return!0}else for(;A>M;M++)if((y||M in T)&&T[M]===x)return y||M||0;return!y&&-1}},b8={includes:Uie(!0),indexOf:Uie(!1)},Gw={},x8=ks,Z5e=th,eFe=b8.indexOf,tFe=Gw,Vie=Pr([].push),jie=function(y,C){var x,w=Z5e(y),T=0,A=[];for(x in w)!x8(tFe,x)&&x8(w,x)&&Vie(A,x);for(;C.length>T;)x8(w,x=C[T++])&&(~eFe(A,x)||Vie(A,x));return A},w8=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],nFe=jie,iFe=w8,zw=Object.keys||function(y){return nFe(y,iFe)},sFe=fc,aFe=jl,lFe=th,cFe=zw;BD.f=es&&!bie?Object.defineProperties:function(y,C){aFe(y);for(var x,w=lFe(C),T=cFe(C),A=T.length,D=0;A>D;)sFe.f(y,x=T[D++],w[x]);return y};var WD,Hie=ba("document","documentElement"),uFe=MD,Gie=m1("keys"),UD=function(y){return Gie[y]||(Gie[y]=uFe(y))},dFe=jl,hFe=BD,zie=w8,fFe=Gw,pFe=Hie,gFe=u8,S8="prototype",Yie=UD("IE_PROTO"),I8=function(){},Xie=function(y){return"<script>"+y+"<\/script>"},$ie=function(y){y.write(Xie("")),y.close();var C=y.parentWindow.Object;return y=null,C},VD=function(){try{WD=new ActiveXObject("htmlfile")}catch(T){}var y,C;VD="undefined"!=typeof document?document.domain&&WD?$ie(WD):((C=gFe("iframe")).style.display="none",pFe.appendChild(C),C.src=String("javascript:"),(y=C.contentWindow.document).open(),y.write(Xie("document.F=Object")),y.close(),y.F):$ie(WD);for(var w=zie.length;w--;)delete VD[S8][zie[w]];return VD()};fFe[Yie]=!0;var sm=Object.create||function(y,C){var x;return null!==y?(I8[S8]=dFe(y),x=new I8,I8[S8]=null,x[Yie]=y):x=VD(),void 0===C?x:hFe.f(x,C)},Yw={},mFe=jie,vFe=w8.concat("length","prototype");Yw.f=Object.getOwnPropertyNames||function(y){return mFe(y,vFe)};var E8={},Pp=Pr([].slice),yFe=Ep,_Fe=th,qie=Yw.f,CFe=Pp,Kie="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];E8.f=function(y){return Kie&&"Window"===yFe(y)?function(C){try{return qie(C)}catch(x){return CFe(Kie)}}(y):qie(_Fe(y))};var Xw={};Xw.f=Object.getOwnPropertySymbols;var bFe=om,am=function(y,C,x,w){return w&&w.enumerable?y[C]=x:bFe(y,C,x),y},xFe=fc,$w=function(y,C,x){return xFe.f(y,C,x)},qw={};qw.f=bo;var jD,Kw,HD,Jie=Co,SFe=ks,TFe=qw,IFe=fc.f,ts=function(y){var C=Jie.Symbol||(Jie.Symbol={});SFe(C,y)||IFe(C,y,{value:TFe.f(y)})},EFe=Ps,DFe=ba,AFe=bo,PFe=am,Qie=function(){var y=DFe("Symbol"),C=y&&y.prototype,x=C&&C.valueOf,w=AFe("toPrimitive");C&&!C[w]&&PFe(C,w,function(T){return EFe(x,this)},{arity:1})},RFe=n0,MFe=m8,OFe=fc.f,FFe=om,LFe=ks,NFe=m8?{}.toString:function(){return"[object "+RFe(this)+"]"},Zie=bo("toStringTag"),af=function(y,C,x,w){var T=x?y:y&&y.prototype;T&&(LFe(T,Zie)||OFe(T,Zie,{configurable:!0,value:C}),w&&!MFe&&FFe(T,"toString",NFe))},ere=Hr.WeakMap,WFe=vs(ere)&&/native code/.test(String(ere)),UFe=ys,VFe=om,D8=ks,jFe=UD,HFe=Gw,nre="Object already initialized",P8=Hr.TypeError;if(WFe||s8.state){var lf=s8.state||(s8.state=new(0,Hr.WeakMap));lf.get=lf.get,lf.has=lf.has,lf.set=lf.set,jD=function(y,C){if(lf.has(y))throw new P8(nre);return C.facade=y,lf.set(y,C),C},Kw=function(y){return lf.get(y)||{}},HD=function(y){return lf.has(y)}}else{var C1=jFe("state");HFe[C1]=!0,jD=function(y,C){if(D8(y,C1))throw new P8(nre);return C.facade=y,VFe(y,C1,C),C},Kw=function(y){return D8(y,C1)?y[C1]:{}},HD=function(y){return D8(y,C1)}}var cf={set:jD,get:Kw,has:HD,enforce:function(y){return HD(y)?Kw(y):jD(y,{})},getterFor:function(y){return function(C){var x;if(!UFe(C)||(x=Kw(C)).type!==y)throw new P8("Incompatible receiver, "+y+" required");return x}}},zFe=Ap,YFe=QL,XFe=sf,$Fe=t0,qFe=_8,ire=Pr([].push),lm=function(y){var C=1===y,x=2===y,w=3===y,T=4===y,A=6===y,D=7===y,M=5===y||A;return function(B,H,Y,G){for(var q,re,se=XFe(B),ce=YFe(se),ve=$Fe(ce),Te=zFe(H,Y),Ue=0,je=G||qFe,Ee=C?je(B,ve):x||D?je(B,0):void 0;ve>Ue;Ue++)if((M||Ue in ce)&&(re=Te(q=ce[Ue],Ue,se),y))if(C)Ee[Ue]=re;else if(re)switch(y){case 3:return!0;case 5:return q;case 6:return Ue;case 2:ire(Ee,q)}else switch(y){case 4:return!1;case 7:ire(Ee,q)}return A?-1:w||T?T:Ee}},r0={forEach:lm(0),map:lm(1),filter:lm(2),some:lm(3),every:lm(4),find:lm(5),findIndex:lm(6),filterReject:lm(7)},GD=An,Jw=Hr,R8=Ps,KFe=Pr,b1=es,x1=g1,JFe=Cr,xa=ks,QFe=Rs,k8=jl,zD=th,M8=l8,ZFe=vl,O8=im,w1=sm,rre=zw,eLe=Yw,ore=E8,tLe=Xw,sre=Dp,are=fc,nLe=BD,lre=Fw,cre=am,iLe=$w,F8=m1,ure=Gw,dre=MD,rLe=bo,oLe=qw,sLe=ts,aLe=Qie,lLe=af,hre=cf,YD=r0.forEach,pc=UD("hidden"),XD="Symbol",Qw="prototype",cLe=hre.set,fre=hre.getterFor(XD),nh=Object[Qw],o0=Jw.Symbol,$D=o0&&o0[Qw],uLe=Jw.RangeError,dLe=Jw.TypeError,L8=Jw.QObject,pre=sre.f,s0=are.f,gre=ore.f,hLe=lre.f,mre=KFe([].push),Rp=F8("symbols"),Zw=F8("op-symbols"),fLe=F8("wks"),N8=!L8||!L8[Qw]||!L8[Qw].findChild,vre=function(y,C,x){var w=pre(nh,C);w&&delete nh[C],s0(y,C,x),w&&y!==nh&&s0(nh,C,w)},B8=b1&&JFe(function(){return 7!==w1(s0({},"a",{get:function(){return s0(this,"a",{value:7}).a}})).a})?vre:s0,W8=function(y,C){var x=Rp[y]=w1($D);return cLe(x,{type:XD,tag:y,description:C}),b1||(x.description=C),x},qD=function(y,C,x){y===nh&&qD(Zw,C,x),k8(y);var w=M8(C);return k8(x),xa(Rp,w)?(x.enumerable?(xa(y,pc)&&y[pc][w]&&(y[pc][w]=!1),x=w1(x,{enumerable:O8(0,!1)})):(xa(y,pc)||s0(y,pc,O8(1,w1(null))),y[pc][w]=!0),B8(y,w,x)):s0(y,w,x)},U8=function(y,C){k8(y);var x=zD(C),w=rre(x).concat(bre(x));return YD(w,function(T){b1&&!R8(yre,x,T)||qD(y,T,x[T])}),y},yre=function(y){var C=M8(y),x=R8(hLe,this,C);return!(this===nh&&xa(Rp,C)&&!xa(Zw,C))&&(!(x||!xa(this,C)||!xa(Rp,C)||xa(this,pc)&&this[pc][C])||x)},_re=function(y,C){var x=zD(y),w=M8(C);if(x!==nh||!xa(Rp,w)||xa(Zw,w)){var T=pre(x,w);return!T||!xa(Rp,w)||xa(x,pc)&&x[pc][w]||(T.enumerable=!0),T}},Cre=function(y){var C=gre(zD(y)),x=[];return YD(C,function(w){xa(Rp,w)||xa(ure,w)||mre(x,w)}),x},bre=function(y){var C=y===nh,x=gre(C?Zw:zD(y)),w=[];return YD(x,function(T){!xa(Rp,T)||C&&!xa(nh,T)||mre(w,Rp[T])}),w};x1||(o0=function(){if(QFe($D,this))throw new dLe("Symbol is not a constructor");var y=arguments.length&&void 0!==arguments[0]?ZFe(arguments[0]):void 0,C=dre(y),x=function(w){var T=void 0===this?Jw:this;T===nh&&R8(x,Zw,w),xa(T,pc)&&xa(T[pc],C)&&(T[pc][C]=!1);var A=O8(1,w);try{B8(T,C,A)}catch(D){if(!(D instanceof uLe))throw D;vre(T,C,A)}};return b1&&N8&&B8(nh,C,{configurable:!0,set:x}),W8(C,y)},cre($D=o0[Qw],"toString",function(){return fre(this).tag}),cre(o0,"withoutSetter",function(y){return W8(dre(y),y)}),lre.f=yre,are.f=qD,nLe.f=U8,sre.f=_re,eLe.f=ore.f=Cre,tLe.f=bre,oLe.f=function(y){return W8(rLe(y),y)},b1&&iLe($D,"description",{configurable:!0,get:function(){return fre(this).description}})),GD({global:!0,constructor:!0,wrap:!0,forced:!x1,sham:!x1},{Symbol:o0}),YD(rre(fLe),function(y){sLe(y)}),GD({target:XD,stat:!0,forced:!x1},{useSetter:function(){N8=!0},useSimple:function(){N8=!1}}),GD({target:"Object",stat:!0,forced:!x1,sham:!b1},{create:function(y,C){return void 0===C?w1(y):U8(w1(y),C)},defineProperty:qD,defineProperties:U8,getOwnPropertyDescriptor:_re}),GD({target:"Object",stat:!0,forced:!x1},{getOwnPropertyNames:Cre}),aLe(),lLe(o0,XD),ure[pc]=!0;var xre=g1&&!!Symbol.for&&!!Symbol.keyFor,pLe=An,gLe=ba,mLe=ks,vLe=vl,wre=m1,yLe=xre,V8=wre("string-to-symbol-registry"),_Le=wre("symbol-to-string-registry");pLe({target:"Symbol",stat:!0,forced:!yLe},{for:function(y){var C=vLe(y);if(mLe(V8,C))return V8[C];var x=gLe("Symbol")(C);return V8[C]=x,_Le[x]=C,x}});var CLe=An,bLe=ks,xLe=Nw,wLe=Zv,SLe=xre,Sre=m1("symbol-to-string-registry");CLe({target:"Symbol",stat:!0,forced:!SLe},{keyFor:function(y){if(!xLe(y))throw new TypeError(wLe(y)+" is not a symbol");if(bLe(Sre,y))return Sre[y]}});var Tre=e0,TLe=vs,Ire=Ep,ILe=vl,Ere=Pr([].push),ELe=An,Dre=ba,Are=h1,DLe=Ps,eS=Pr,Pre=Cr,Rre=vs,kre=Nw,Mre=Pp,ALe=function(y){if(TLe(y))return y;if(Tre(y)){for(var C=y.length,x=[],w=0;w<C;w++){var T=y[w];"string"==typeof T?Ere(x,T):"number"!=typeof T&&"Number"!==Ire(T)&&"String"!==Ire(T)||Ere(x,ILe(T))}var A=x.length,D=!0;return function(M,B){if(D)return D=!1,B;if(Tre(this))return B;for(var H=0;H<A;H++)if(x[H]===M)return B}}},PLe=g1,RLe=String,cm=Dre("JSON","stringify"),KD=eS(/./.exec),Ore=eS("".charAt),kLe=eS("".charCodeAt),MLe=eS("".replace),OLe=eS(1..toString),FLe=/[\uD800-\uDFFF]/g,Fre=/^[\uD800-\uDBFF]$/,Lre=/^[\uDC00-\uDFFF]$/,Nre=!PLe||Pre(function(){var y=Dre("Symbol")("stringify detection");return"[null]"!==cm([y])||"{}"!==cm({a:y})||"{}"!==cm(Object(y))}),Bre=Pre(function(){return'"\\udf06\\ud834"'!==cm("\udf06\ud834")||'"\\udead"'!==cm("\udead")}),LLe=function(y,C){var x=Mre(arguments),w=ALe(C);if(Rre(w)||void 0!==y&&!kre(y))return x[1]=function(T,A){if(Rre(w)&&(A=DLe(w,this,RLe(T),A)),!kre(A))return A},Are(cm,null,x)},NLe=function(y,C,x){var w=Ore(x,C-1),T=Ore(x,C+1);return KD(Fre,y)&&!KD(Lre,T)||KD(Lre,y)&&!KD(Fre,w)?"\\u"+OLe(kLe(y,0),16):y};cm&&ELe({target:"JSON",stat:!0,arity:3,forced:Nre||Bre},{stringify:function(y,C,x){var w=Mre(arguments),T=Are(Nre?LLe:cm,null,w);return Bre&&"string"==typeof T?MLe(T,FLe,NLe):T}});var Wre=Xw,BLe=sf;An({target:"Object",stat:!0,forced:!g1||Cr(function(){Wre.f(1)})},{getOwnPropertySymbols:function(y){var C=Wre.f;return C?C(BLe(y)):[]}}),ts("asyncIterator"),ts("hasInstance"),ts("isConcatSpreadable"),ts("iterator"),ts("match"),ts("matchAll"),ts("replace"),ts("search"),ts("species"),ts("split");var WLe=Qie;ts("toPrimitive"),WLe();var ULe=ba,VLe=af;ts("toStringTag"),VLe(ULe("Symbol"),"Symbol"),ts("unscopables"),af(Hr.JSON,"JSON",!0);var a0,Ure,Vre,jLe=Co.Symbol,S1={},j8=es,jre=Function.prototype,GLe=j8&&Object.getOwnPropertyDescriptor,H8=ks(jre,"name"),Hre={EXISTS:H8,PROPER:H8&&"something"===function(){}.name,CONFIGURABLE:H8&&(!j8||j8&&GLe(jre,"name").configurable)},Gre=!Cr(function(){function y(){}return y.prototype.constructor=null,Object.getPrototypeOf(new y)!==y.prototype}),zLe=ks,YLe=vs,XLe=sf,$Le=Gre,zre=UD("IE_PROTO"),G8=Object,qLe=G8.prototype,T1=$Le?G8.getPrototypeOf:function(y){var C=XLe(y);if(zLe(C,zre))return C[zre];var x=C.constructor;return YLe(x)&&C instanceof x?x.prototype:C instanceof G8?qLe:null},KLe=Cr,JLe=vs,QLe=ys,ZLe=sm,Yre=T1,e8e=am,z8=bo("iterator"),Xre=!1;[].keys&&("next"in(Vre=[].keys())?(Ure=Yre(Yre(Vre)))!==Object.prototype&&(a0=Ure):Xre=!0);var t8e=!QLe(a0)||KLe(function(){var y={};return a0[z8].call(y)!==y});JLe((a0=t8e?{}:ZLe(a0))[z8])||e8e(a0,z8,function(){return this});var $re={IteratorPrototype:a0,BUGGY_SAFARI_ITERATORS:Xre},n8e=$re.IteratorPrototype,i8e=sm,r8e=im,o8e=af,s8e=S1,a8e=function(){return this},qre=function(y,C,x,w){var T=C+" Iterator";return y.prototype=i8e(n8e,{next:r8e(+!w,x)}),o8e(y,T,!1,!0),s8e[T]=a8e,y},l8e=Pr,c8e=tu,u8e=ys,h8e=String,f8e=TypeError,g8e=ys,m8e=rm,Kre=Object.setPrototypeOf||("__proto__"in{}?function(){var y,C=!1,x={};try{(y=function(y,C,x){try{return l8e(c8e(Object.getOwnPropertyDescriptor(y,"__proto__").set))}catch(w){}}(Object.prototype))(x,[]),C=x instanceof Array}catch(w){}return function(w,T){return m8e(w),function(y){if(function(y){return u8e(y)||null===y}(y))return y;throw new f8e("Can't set "+h8e(y)+" as a prototype")}(T),g8e(w)&&(C?y(w,T):w.__proto__=T),w}}():void 0),y8e=An,_8e=Ps,b8e=qre,x8e=T1,w8e=af,Jre=am,Qre=S1,T8e=Hre.PROPER,JD=$re.BUGGY_SAFARI_ITERATORS,Y8=bo("iterator"),QD="values",I8e=function(){return this},X8=function(y,C,x,w,T,A,D){b8e(x,C,w);var M,B,H,Y=function(Te){if(Te===T&&ce)return ce;if(!JD&&Te&&Te in re)return re[Te];switch(Te){case"keys":case QD:case"entries":return function(){return new x(this,Te)}}return function(){return new x(this)}},G=C+" Iterator",q=!1,re=y.prototype,se=re[Y8]||re["@@iterator"]||T&&re[T],ce=!JD&&se||Y(T),ve="Array"===C&&re.entries||se;if(ve&&(M=x8e(ve.call(new y)))!==Object.prototype&&M.next&&(w8e(M,G,!0,!0),Qre[G]=I8e),T8e&&T===QD&&se&&se.name!==QD&&(q=!0,ce=function(){return _8e(se,this)}),T)if(B={values:Y(QD),keys:A?ce:Y("keys"),entries:Y("entries")},D)for(H in B)(JD||q||!(H in re))&&Jre(re,H,B[H]);else y8e({target:C,proto:!0,forced:JD||q},B);return D&&re[Y8]!==ce&&Jre(re,Y8,ce,{name:T}),Qre[C]=ce,B},ZD=function(y,C){return{value:y,done:C}},E8e=th,toe=S1,D8e=X8,eA=ZD,ioe="Array Iterator",A8e=cf.set,P8e=cf.getterFor(ioe);D8e(Array,"Array",function(y,C){A8e(this,{type:ioe,target:E8e(y),index:0,kind:C})},function(){var y=P8e(this),C=y.target,x=y.index++;if(!C||x>=C.length)return y.target=void 0,eA(void 0,!0);switch(y.kind){case"keys":return eA(x,!1);case"values":return eA(C[x],!1)}return eA([x,C[x]],!1)},"values"),toe.Arguments=toe.Array;var k8e=Hr,M8e=af,roe=S1;for(var $8 in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0})M8e(k8e[$8],$8),roe[$8]=roe.Array;var O8e=jLe,L8e=fc.f,ooe=bo("metadata"),soe=Function.prototype;void 0===soe[ooe]&&L8e(soe,ooe,{value:null}),ts("asyncDispose"),ts("dispose"),ts("metadata");var N8e=O8e,B8e=Pr,q8=ba("Symbol"),W8e=q8.keyFor,U8e=B8e(q8.prototype.valueOf),aoe=q8.isRegisteredSymbol||function(y){try{return void 0!==W8e(U8e(y))}catch(C){return!1}};An({target:"Symbol",stat:!0},{isRegisteredSymbol:aoe});for(var V8e=m1,loe=ba,j8e=Pr,H8e=Nw,G8e=bo,tA=loe("Symbol"),coe=tA.isWellKnownSymbol,uoe=loe("Object","getOwnPropertyNames"),z8e=j8e(tA.prototype.valueOf),doe=V8e("wks"),K8=0,hoe=uoe(tA),Y8e=hoe.length;K8<Y8e;K8++)try{var foe=hoe[K8];H8e(tA[foe])&&G8e(foe)}catch(y){}var poe=function(y){if(coe&&coe(y))return!0;try{for(var C=z8e(y),x=0,w=uoe(doe),T=w.length;x<T;x++)if(doe[w[x]]==C)return!0}catch(A){}return!1};An({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:poe}),ts("customMatcher"),ts("observable"),An({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:aoe}),An({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:poe}),ts("matcher"),ts("metadataKey"),ts("patternMatch"),ts("replaceAll");var J8=N8e,I1=v(J8),Q8=Pr,X8e=Uw,$8e=vl,q8e=rm,K8e=Q8("".charAt),goe=Q8("".charCodeAt),J8e=Q8("".slice),moe=function(y){return function(C,x){var w,T,A=$8e(q8e(C)),D=X8e(x),M=A.length;return D<0||D>=M?y?"":void 0:(w=goe(A,D))<55296||w>56319||D+1===M||(T=goe(A,D+1))<56320||T>57343?y?K8e(A,D):w:y?J8e(A,D,D+2):T-56320+(w-55296<<10)+65536}},voe={codeAt:moe(!1),charAt:moe(!0)},Q8e=voe.charAt,Z8e=vl,eNe=X8,_oe=ZD,Coe="String Iterator",tNe=cf.set,nNe=cf.getterFor(Coe);eNe(String,"String",function(y){tNe(this,{type:Coe,string:Z8e(y),index:0})},function(){var y,C=nNe(this),x=C.string,w=C.index;return w>=x.length?_oe(void 0,!0):(y=Q8e(x,w),C.index+=y.length,_oe(y,!1))});var boe=qw.f("iterator"),iNe=v(boe);function Qu(y){return(Qu="function"==typeof I1&&"symbol"==typeof iNe?function(C){return typeof C}:function(C){return C&&"function"==typeof I1&&C.constructor===I1&&C!==I1.prototype?"symbol":typeof C})(y)}var rNe=v(qw.f("toPrimitive"));function xoe(y){var C=function(x,w){if("object"!==Qu(x)||null===x)return x;var T=x[rNe];if(void 0!==T){var A=T.call(x,"string");if("object"!==Qu(A))return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(x)}(y);return"symbol"===Qu(C)?C:String(C)}function woe(y,C){for(var x=0;x<C.length;x++){var w=C[x];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),FD(y,xoe(w.key),w)}}function Do(y,C,x){return C&&woe(y.prototype,C),x&&woe(y,x),FD(y,"prototype",{writable:!1}),y}var y,nA="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",oNe=rm,sNe=vl,Z8=nA,Soe=Pr("".replace),aNe=RegExp("^["+Z8+"]+"),lNe=RegExp("(^|[^"+Z8+"])["+Z8+"]+$"),eN=function(y){return function(C){var x=sNe(oNe(C));return 1&y&&(x=Soe(x,aNe,"")),2&y&&(x=Soe(x,lNe,"$1")),x}},tN={start:eN(1),end:eN(2),trim:eN(3)},cNe=Hre.PROPER,Toe=nA,dNe=tN.trim;An({target:"String",proto:!0,forced:(y="trim",Cr(function(){return!!Toe[y]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[y]()||cNe&&Toe[y].name!==y}))},{trim:function(){return dNe(this)}});var hNe=Hr,fNe=Co,za=function(y,C){var x=fNe[y+"Prototype"],w=x&&x[C];if(w)return w;var T=hNe[y],A=T&&T.prototype;return A&&A[C]},pNe=za("String","trim"),gNe=Rs,mNe=pNe,nN=String.prototype,tS=v(function(y){var C=y.trim;return"string"==typeof y||y===nN||gNe(nN,y)&&C===nN.trim?mNe:C}),vNe=Cr,Ioe=function(y,C){var x=[][y];return!!x&&vNe(function(){x.call(null,C||function(){return 1},1)})},yNe=An,_Ne=b8.indexOf,CNe=Ioe,iN=f1([].indexOf),Eoe=!!iN&&1/iN([1],1,-0)<0;yNe({target:"Array",proto:!0,forced:Eoe||!CNe("indexOf")},{indexOf:function(y){var C=arguments.length>1?arguments[1]:void 0;return Eoe?iN(this,y,C)||0:_Ne(this,y,C)}});var bNe=za("Array","indexOf"),xNe=Rs,wNe=bNe,rN=Array.prototype,No=v(function(y){var C=y.indexOf;return y===rN||xNe(rN,y)&&C===rN.indexOf?wNe:C}),SNe=za("Array","keys"),TNe=n0,INe=ks,ENe=Rs,DNe=SNe,oN=Array.prototype,ANe={DOMTokenList:!0,NodeList:!0},sN=v(function(y){var C=y.keys;return y===oN||ENe(oN,y)&&C===oN.keys||INe(ANe,TNe(y))?DNe:C}),PNe=An,Doe=e0,RNe=ND,kNe=ys,Aoe=C8,MNe=t0,ONe=th,FNe=Vw,LNe=bo,NNe=Pp,BNe=Hw("slice"),WNe=LNe("species"),aN=Array,UNe=Math.max;PNe({target:"Array",proto:!0,forced:!BNe},{slice:function(y,C){var x,w,T,A=ONe(this),D=MNe(A),M=Aoe(y,D),B=Aoe(void 0===C?D:C,D);if(Doe(A)&&((RNe(x=A.constructor)&&(x===aN||Doe(x.prototype))||kNe(x)&&null===(x=x[WNe]))&&(x=void 0),x===aN||void 0===x))return NNe(A,M,B);for(w=new(void 0===x?aN:x)(UNe(B-M,0)),T=0;M<B;M++,T++)M in A&&FNe(w,T,A[M]);return w.length=T,w}});var VNe=za("Array","slice"),jNe=Rs,HNe=VNe,lN=Array.prototype,Poe=function(y){var C=y.slice;return y===lN||jNe(lN,y)&&C===lN.slice?HNe:C},ih=v(Poe),GNe=Cr,YNe=vl,XNe=tN.trim,koe=nA,nS=Hr.parseInt,Moe=Hr.Symbol,Ooe=Moe&&Moe.iterator,Foe=/^[+-]?0x/i,$Ne=Pr(Foe.exec),Loe=8!==nS(koe+"08")||22!==nS(koe+"0x16")||Ooe&&!GNe(function(){nS(Object(Ooe))})?function(y,C){var x=XNe(YNe(y));return nS(x,C>>>0||($Ne(Foe,x)?16:10))}:nS;An({global:!0,forced:parseInt!==Loe},{parseInt:Loe});var kp=v(Co.parseInt);An({target:"Array",stat:!0},{isArray:e0});var Noe=Co.Array.isArray,iA=v(Noe),qNe="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,KNe=TypeError,E1=function(y,C){if(y<C)throw new KNe("Not enough arguments");return y},Boe=Hr,JNe=h1,QNe=vs,ZNe=qNe,t7e=Pp,n7e=E1,i7e=Boe.Function,r7e=/MSIE .\./.test(Lw)||ZNe&&function(){var y=Boe.Bun.version.split(".");return y.length<3||"0"===y[0]&&(y[1]<3||"3"===y[1]&&"0"===y[2])}(),Woe=function(y,C){var x=C?2:1;return r7e?function(w,T){var A=n7e(arguments.length,1)>x,D=QNe(w)?w:i7e(w),M=A?t7e(arguments,x):[],B=A?function(){JNe(D,this,M)}:D;return C?y(B,T):y(B)}:y},o7e=An,Uoe=Hr,Voe=Woe(Uoe.setInterval,!0);o7e({global:!0,bind:!0,forced:Uoe.setInterval!==Voe},{setInterval:Voe});var s7e=An,joe=Hr,Hoe=Woe(joe.setTimeout,!0);s7e({global:!0,bind:!0,forced:joe.setTimeout!==Hoe},{setTimeout:Hoe});var a7e=v(Co.setTimeout),c7e=e0,u7e=TypeError,d7e=Object.getOwnPropertyDescriptor,h7e=es&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(y){return y instanceof TypeError}}(),Goe=Zv,f7e=TypeError,p7e=An,g7e=sf,m7e=C8,v7e=Uw,y7e=t0,_7e=h7e?function(y,C){if(c7e(y)&&!d7e(y,"length").writable)throw new u7e("Cannot set read only .length");return y.length=C}:function(y,C){return y.length=C},C7e=Die,b7e=_8,x7e=Vw,cN=function(y,C){if(!delete y[C])throw new f7e("Cannot delete property "+Goe(C)+" of "+Goe(y))},w7e=Hw("splice"),S7e=Math.max,T7e=Math.min;p7e({target:"Array",proto:!0,forced:!w7e},{splice:function(y,C){var x,w,T,A,D,M,B=g7e(this),H=y7e(B),Y=m7e(y,H),G=arguments.length;for(0===G?x=w=0:1===G?(x=0,w=H-Y):(x=G-2,w=T7e(S7e(v7e(C),0),H-Y)),C7e(H+x-w),T=b7e(B,w),A=0;A<w;A++)(D=Y+A)in B&&x7e(T,A,B[D]);if(T.length=w,x<w){for(A=Y;A<H-w;A++)M=A+x,(D=A+w)in B?B[M]=B[D]:cN(B,M);for(A=H;A>H-w+x;A--)cN(B,A-1)}else if(x>w)for(A=H-w;A>Y;A--)M=A+x-1,(D=A+w-1)in B?B[M]=B[D]:cN(B,M);for(A=0;A<x;A++)B[A+Y]=arguments[A+2];return _7e(B,H-w+x),T}});var I7e=za("Array","splice"),E7e=Rs,D7e=I7e,uN=Array.prototype,ua=v(function(y){var C=y.splice;return y===uN||E7e(uN,y)&&C===uN.splice?D7e:C}),A7e=ba,P7e=Yw,R7e=Xw,k7e=jl,M7e=Pr([].concat),zoe=A7e("Reflect","ownKeys")||function(y){var C=P7e.f(k7e(y)),x=R7e.f;return x?M7e(C,x(y)):C},Yoe=ks,O7e=zoe,F7e=Dp,L7e=fc,N7e=ys,B7e=om,Xoe=Error,W7e=Pr("".replace),U7e=String(new Xoe("zxcasd").stack),$oe=/\n\s*at [^:]*:[^\n]*/,V7e=$oe.test(U7e),j7e=im,H7e=!Cr(function(){var y=new Error("a");return!("stack"in y)||(Object.defineProperty(y,"stack",j7e(1,7)),7!==y.stack)}),G7e=om,Y7e=H7e,qoe=Error.captureStackTrace,X7e=S1,$7e=bo("iterator"),q7e=Array.prototype,Koe=function(y){return void 0!==y&&(X7e.Array===y||q7e[$7e]===y)},K7e=n0,Joe=n8,J7e=p1,Q7e=S1,Z7e=bo("iterator"),iS=function(y){if(!J7e(y))return Joe(y,Z7e)||Joe(y,"@@iterator")||Q7e[K7e(y)]},eBe=Ps,tBe=tu,nBe=jl,iBe=Zv,rBe=iS,oBe=TypeError,dN=function(y,C){var x=arguments.length<2?rBe(y):C;if(tBe(x))return nBe(eBe(x,y));throw new oBe(iBe(y)+" is not iterable")},sBe=Ps,Qoe=jl,aBe=n8,rA=function(y,C,x){var w,T;Qoe(y);try{if(!(w=aBe(y,"return"))){if("throw"===C)throw x;return x}w=sBe(w,y)}catch(A){T=!0,w=A}if("throw"===C)throw x;if(T)throw w;return Qoe(w),x},lBe=Ap,cBe=Ps,uBe=jl,dBe=Zv,hBe=Koe,fBe=t0,Zoe=Rs,pBe=dN,gBe=iS,ese=rA,mBe=TypeError,oA=function(y,C){this.stopped=y,this.result=C},tse=oA.prototype,l0=function(y,C,x){var w,T,A,D,M,B,H,G=!(!x||!x.AS_ENTRIES),q=!(!x||!x.IS_RECORD),re=!(!x||!x.IS_ITERATOR),se=!(!x||!x.INTERRUPTED),ce=lBe(C,x&&x.that),ve=function(Ue){return w&&ese(w,"normal",Ue),new oA(!0,Ue)},Te=function(Ue){return G?(uBe(Ue),se?ce(Ue[0],Ue[1],ve):ce(Ue[0],Ue[1])):se?ce(Ue,ve):ce(Ue)};if(q)w=y.iterator;else if(re)w=y;else{if(!(T=gBe(y)))throw new mBe(dBe(y)+" is not iterable");if(hBe(T)){for(A=0,D=fBe(y);D>A;A++)if((M=Te(y[A]))&&Zoe(tse,M))return M;return new oA(!1)}w=pBe(y,T)}for(B=q?y.next:w.next;!(H=cBe(B,w)).done;){try{M=Te(H.value)}catch(Ue){ese(w,"throw",Ue)}if("object"==typeof M&&M&&Zoe(tse,M))return M}return new oA(!1)},vBe=vl,yBe=An,_Be=Rs,CBe=T1,sA=Kre,nse=sm,hN=om,fN=im,xBe=function(y,C){N7e(C)&&"cause"in C&&B7e(y,"cause",C.cause)},wBe=function(y,C,x,w){Y7e&&(qoe?qoe(y,C):G7e(y,"stack",function(y,C){if(V7e&&"string"==typeof y&&!Xoe.prepareStackTrace)for(;C--;)y=W7e(y,$oe,"");return y}(x,w)))},SBe=l0,TBe=function(y,C){return void 0===y?arguments.length<2?"":C:vBe(y)},IBe=bo("toStringTag"),aA=Error,EBe=[].push,D1=function(y,C){var x,w=_Be(pN,this);sA?x=sA(new aA,w?CBe(this):pN):(x=w?this:nse(pN),hN(x,IBe,"Error")),void 0!==C&&hN(x,"message",TBe(C)),wBe(x,D1,x.stack,1),arguments.length>2&&xBe(x,arguments[2]);var T=[];return SBe(y,EBe,{that:T}),hN(x,"errors",T),x};sA?sA(D1,aA):function(y,C,x){for(var w=O7e(C),T=L7e.f,A=F7e.f,D=0;D<w.length;D++){var M=w[D];Yoe(y,M)||x&&Yoe(x,M)||T(y,M,A(C,M))}}(D1,aA,{name:!0});var pN=D1.prototype=nse(aA.prototype,{constructor:fN(1,D1),message:fN(1,""),name:fN(1,"AggregateError")});yBe({global:!0,constructor:!0,arity:2},{AggregateError:D1});var rS,A1,ise,gN,lA="process"===Ep(Hr.process),DBe=ba,ABe=$w,PBe=es,rse=bo("species"),ose=function(y){var C=DBe(y);PBe&&C&&!C[rse]&&ABe(C,rse,{configurable:!0,get:function(){return this}})},RBe=Rs,kBe=TypeError,oS=function(y,C){if(RBe(C,y))return y;throw new kBe("Incorrect invocation")},MBe=ND,OBe=Zv,FBe=TypeError,sse=function(y){if(MBe(y))return y;throw new FBe(OBe(y)+" is not a constructor")},ase=jl,LBe=sse,NBe=p1,BBe=bo("species"),lse=function(y,C){var x,w=ase(y).constructor;return void 0===w||NBe(x=ase(w)[BBe])?C:LBe(x)},cse=/(?:ipad|iphone|ipod).*applewebkit/i.test(Lw),nu=Hr,WBe=h1,UBe=Ap,use=vs,VBe=ks,dse=Cr,hse=Hie,jBe=Pp,fse=u8,HBe=E1,GBe=cse,zBe=lA,mN=nu.setImmediate,vN=nu.clearImmediate,YBe=nu.process,yN=nu.Dispatch,XBe=nu.Function,pse=nu.MessageChannel,$Be=nu.String,_N=0,sS={},gse="onreadystatechange";dse(function(){rS=nu.location});var CN=function(y){if(VBe(sS,y)){var C=sS[y];delete sS[y],C()}},bN=function(y){return function(){CN(y)}},mse=function(y){CN(y.data)},vse=function(y){nu.postMessage($Be(y),rS.protocol+"//"+rS.host)};mN&&vN||(mN=function(y){HBe(arguments.length,1);var C=use(y)?y:XBe(y),x=jBe(arguments,1);return sS[++_N]=function(){WBe(C,void 0,x)},A1(_N),_N},vN=function(y){delete sS[y]},zBe?A1=function(y){YBe.nextTick(bN(y))}:yN&&yN.now?A1=function(y){yN.now(bN(y))}:pse&&!GBe?(gN=(ise=new pse).port2,ise.port1.onmessage=mse,A1=UBe(gN.postMessage,gN)):nu.addEventListener&&use(nu.postMessage)&&!nu.importScripts&&rS&&"file:"!==rS.protocol&&!dse(vse)?(A1=vse,nu.addEventListener("message",mse,!1)):A1=gse in fse("script")?function(y){hse.appendChild(fse("script"))[gse]=function(){hse.removeChild(this),CN(y)}}:function(y){setTimeout(bN(y),0)});var yse={set:mN,clear:vN},_se=Hr,qBe=es,KBe=Object.getOwnPropertyDescriptor,Cse=function(y){if(!qBe)return _se[y];var C=KBe(_se,y);return C&&C.value},bse=function(){this.head=null,this.tail=null};bse.prototype={add:function(y){var C={item:y,next:null},x=this.tail;x?x.next=C:this.head=C,this.tail=C},get:function(){var y=this.head;if(y)return null===(this.head=y.next)&&(this.tail=null),y.item}};var P1,xN,wN,SN,xse,wse=bse,JBe=/ipad|iphone|ipod/i.test(Lw)&&"undefined"!=typeof Pebble,QBe=/web0s(?!.*chrome)/i.test(Lw),R1=Hr,Sse=Ap,TN=yse.set,e9e=wse,t9e=cse,n9e=JBe,i9e=QBe,IN=lA,Tse=R1.MutationObserver||R1.WebKitMutationObserver,Ise=R1.document,Ese=R1.process,cA=R1.Promise,EN=Cse("queueMicrotask");if(!EN){var uA=new e9e,dA=function(){var y,C;for(IN&&(y=Ese.domain)&&y.exit();C=uA.get();)try{C()}catch(x){throw uA.head&&P1(),x}y&&y.enter()};t9e||IN||i9e||!Tse||!Ise?!n9e&&cA&&cA.resolve?((SN=cA.resolve(void 0)).constructor=cA,xse=Sse(SN.then,SN),P1=function(){xse(dA)}):IN?P1=function(){Ese.nextTick(dA)}:(TN=Sse(TN,R1),P1=function(){TN(dA)}):(xN=!0,wN=Ise.createTextNode(""),new Tse(dA).observe(wN,{characterData:!0}),P1=function(){wN.data=xN=!xN}),EN=function(y){uA.head||P1(),uA.add(y)}}var r9e=EN,k1=function(y){try{return{error:!1,value:y()}}catch(C){return{error:!0,value:C}}},c0=Hr.Promise,Dse="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,o9e=!Dse&&!lA&&"object"==typeof window&&"object"==typeof document,s9e=Hr,aS=c0,a9e=vs,l9e=Cie,c9e=Pie,d9e=o9e,h9e=Dse,DN=kD,Ase=aS&&aS.prototype,f9e=bo("species"),Pse=!1,Rse=a9e(s9e.PromiseRejectionEvent),p9e=l9e("Promise",function(){var y=c9e(aS),C=y!==String(aS);if(!C&&66===DN||!Ase.catch||!Ase.finally)return!0;if(!DN||DN<51||!/native code/.test(y)){var x=new aS(function(T){T(1)}),w=function(T){T(function(){},function(){})};if((x.constructor={})[f9e]=w,!(Pse=x.then(function(){})instanceof w))return!0}return!C&&(d9e||h9e)&&!Rse}),lS={CONSTRUCTOR:p9e,REJECTION_EVENT:Rse,SUBCLASSING:Pse},uf={},kse=tu,g9e=TypeError,m9e=function(y){var C,x;this.promise=new y(function(w,T){if(void 0!==C||void 0!==x)throw new g9e("Bad Promise constructor");C=w,x=T}),this.resolve=kse(C),this.reject=kse(x)};uf.f=function(y){return new m9e(y)};var AN,Mse,v9e=An,hA=lA,um=Hr,cS=Ps,y9e=am,_9e=af,C9e=ose,b9e=tu,PN=vs,x9e=ys,w9e=oS,S9e=lse,Ose=yse.set,RN=r9e,I9e=k1,E9e=wse,Fse=cf,kN=c0,Nse=uf,fA="Promise",Bse=lS.CONSTRUCTOR,D9e=lS.REJECTION_EVENT,MN=Fse.getterFor(fA),A9e=Fse.set,uS=kN,ON=kN&&kN.prototype,Wse=um.TypeError,FN=um.document,LN=um.process,NN=Nse.f,R9e=NN,k9e=!!(FN&&FN.createEvent&&um.dispatchEvent),Vse=function(y){var C;return!(!x9e(y)||!PN(C=y.then))&&C},jse=function(y,C){var x,w,T,A=C.value,D=1===C.state,M=D?y.ok:y.fail,B=y.resolve,H=y.reject,Y=y.domain;try{M?(D||(2===C.rejection&&O9e(C),C.rejection=1),!0===M?x=A:(Y&&Y.enter(),x=M(A),Y&&(Y.exit(),T=!0)),x===y.promise?H(new Wse("Promise-chain cycle")):(w=Vse(x))?cS(w,x,B,H):B(x)):H(A)}catch(G){Y&&!T&&Y.exit(),H(G)}},Hse=function(y,C){y.notified||(y.notified=!0,RN(function(){for(var x,w=y.reactions;x=w.get();)jse(x,y);y.notified=!1,C&&!y.rejection&&M9e(y)}))},Gse=function(y,C,x){var w,T;k9e?((w=FN.createEvent("Event")).promise=C,w.reason=x,w.initEvent(y,!1,!0),um.dispatchEvent(w)):w={promise:C,reason:x},!D9e&&(T=um["on"+y])&&T(w)},M9e=function(y){cS(Ose,um,function(){var C,x=y.facade,w=y.value;if(zse(y)&&(C=I9e(function(){hA?LN.emit("unhandledRejection",w,x):Gse("unhandledrejection",x,w)}),y.rejection=hA||zse(y)?2:1,C.error))throw C.value})},zse=function(y){return 1!==y.rejection&&!y.parent},O9e=function(y){cS(Ose,um,function(){var C=y.facade;hA?LN.emit("rejectionHandled",C):Gse("rejectionhandled",C,y.value)})},M1=function(y,C,x){return function(w){y(C,w,x)}},O1=function(y,C,x){y.done||(y.done=!0,x&&(y=x),y.value=C,y.state=2,Hse(y,!0))},BN=function(y,C,x){if(!y.done){y.done=!0,x&&(y=x);try{if(y.facade===C)throw new Wse("Promise can't be resolved itself");var w=Vse(C);w?RN(function(){var T={done:!1};try{cS(w,C,M1(BN,T,y),M1(O1,T,y))}catch(A){O1(T,A,y)}}):(y.value=C,y.state=1,Hse(y,!1))}catch(T){O1({done:!1},T,y)}}};Bse&&(ON=(uS=function(y){w9e(this,ON),b9e(y),cS(AN,this);var C=MN(this);try{y(M1(BN,C),M1(O1,C))}catch(x){O1(C,x)}}).prototype,(AN=function(y){A9e(this,{type:fA,done:!1,notified:!1,parent:!1,reactions:new E9e,rejection:!1,state:0,value:void 0})}).prototype=y9e(ON,"then",function(y,C){var x=MN(this),w=NN(S9e(this,uS));return x.parent=!0,w.ok=!PN(y)||y,w.fail=PN(C)&&C,w.domain=hA?LN.domain:void 0,0===x.state?x.reactions.add(w):RN(function(){jse(w,x)}),w.promise}),Mse=function(){var y=new AN,C=MN(y);this.promise=y,this.resolve=M1(BN,C),this.reject=M1(O1,C)},Nse.f=NN=function(y){return y===uS||void 0===y?new Mse(y):R9e(y)}),v9e({global:!0,constructor:!0,wrap:!0,forced:Bse},{Promise:uS}),_9e(uS,fA,!1,!0),C9e(fA);var Yse=bo("iterator"),Xse=!1;try{var F9e=0,$se={next:function(){return{done:!!F9e++}},return:function(){Xse=!0}};$se[Yse]=function(){return this},Array.from($se,function(){throw 2})}catch(y){}var qse=function(y,C){try{if(!C&&!Xse)return!1}catch(T){return!1}var x=!1;try{var w={};w[Yse]=function(){return{next:function(){return{done:x=!0}}}},y(w)}catch(T){}return x},L9e=c0,pA=lS.CONSTRUCTOR||!qse(function(y){L9e.all(y).then(void 0,function(){})}),N9e=Ps,B9e=tu,W9e=uf,U9e=k1,V9e=l0;An({target:"Promise",stat:!0,forced:pA},{all:function(y){var C=this,x=W9e.f(C),w=x.resolve,T=x.reject,A=U9e(function(){var D=B9e(C.resolve),M=[],B=0,H=1;V9e(y,function(Y){var G=B++,q=!1;H++,N9e(D,C,Y).then(function(re){q||(q=!0,M[G]=re,--H||w(M))},T)}),--H||w(M)});return A.error&&T(A.value),x.promise}}),An({target:"Promise",proto:!0,forced:lS.CONSTRUCTOR,real:!0},{catch:function(y){return this.then(void 0,y)}});var G9e=Ps,z9e=tu,Y9e=uf,X9e=k1,$9e=l0;An({target:"Promise",stat:!0,forced:pA},{race:function(y){var C=this,x=Y9e.f(C),w=x.reject,T=X9e(function(){var A=z9e(C.resolve);$9e(y,function(D){G9e(A,C,D).then(x.resolve,w)})});return T.error&&w(T.value),x.promise}});var q9e=uf;An({target:"Promise",stat:!0,forced:lS.CONSTRUCTOR},{reject:function(y){var C=q9e.f(this);return(0,C.reject)(y),C.promise}});var K9e=jl,J9e=ys,Q9e=uf,Kse=function(y,C){if(K9e(y),J9e(C)&&C.constructor===y)return C;var x=Q9e.f(y);return(0,x.resolve)(C),x.promise},Z9e=An,eWe=c0,tWe=lS.CONSTRUCTOR,nWe=Kse,iWe=ba("Promise"),rWe=!tWe;Z9e({target:"Promise",stat:!0,forced:!0},{resolve:function(y){return nWe(rWe&&this===iWe?eWe:this,y)}});var oWe=Ps,sWe=tu,aWe=uf,lWe=k1,cWe=l0;An({target:"Promise",stat:!0,forced:pA},{allSettled:function(y){var C=this,x=aWe.f(C),w=x.resolve,T=x.reject,A=lWe(function(){var D=sWe(C.resolve),M=[],B=0,H=1;cWe(y,function(Y){var G=B++,q=!1;H++,oWe(D,C,Y).then(function(re){q||(q=!0,M[G]={status:"fulfilled",value:re},--H||w(M))},function(re){q||(q=!0,M[G]={status:"rejected",reason:re},--H||w(M))})}),--H||w(M)});return A.error&&T(A.value),x.promise}});var uWe=Ps,dWe=tu,hWe=ba,fWe=uf,pWe=k1,gWe=l0,Jse="No one promise resolved";An({target:"Promise",stat:!0,forced:pA},{any:function(y){var C=this,x=hWe("AggregateError"),w=fWe.f(C),T=w.resolve,A=w.reject,D=pWe(function(){var M=dWe(C.resolve),B=[],H=0,Y=1,G=!1;gWe(y,function(q){var re=H++,se=!1;Y++,uWe(M,C,q).then(function(ce){se||G||(G=!0,T(ce))},function(ce){se||G||(se=!0,B[re]=ce,--Y||A(new x(B,Jse)))})}),--Y||A(new x(B,Jse))});return D.error&&A(D.value),w.promise}});var mWe=uf;An({target:"Promise",stat:!0},{withResolvers:function(){var y=mWe.f(this);return{promise:y.promise,resolve:y.resolve,reject:y.reject}}});var _We=ba,CWe=vs,bWe=lse,Qse=Kse,xWe=c0&&c0.prototype;An({target:"Promise",proto:!0,real:!0,forced:!!c0&&Cr(function(){xWe.finally.call({then:function(){}},function(){})})},{finally:function(y){var C=bWe(this,_We("Promise")),x=CWe(y);return this.then(x?function(w){return Qse(C,y()).then(function(){return w})}:y,x?function(w){return Qse(C,y()).then(function(){throw w})}:y)}});var Zse=Co.Promise,u0=v(Zse),wWe=ys,SWe=Ep,TWe=bo("match"),EWe=TypeError,UN=function(y){if(function(y){var C;return wWe(y)&&(void 0!==(C=y[TWe])?!!C:"RegExp"===SWe(y))}(y))throw new EWe("The method doesn't accept regular expressions");return y},DWe=bo("match"),VN=function(y){var C=/./;try{"/./"[y](C)}catch(x){try{return C[DWe]=!1,"/./"[y](C)}catch(w){}}return!1},AWe=An,RWe=g8,eae=vl,kWe=UN,MWe=rm,OWe=VN,FWe=f1("".slice),LWe=Math.min;AWe({target:"String",proto:!0,forced:!OWe("endsWith")},{endsWith:function(y){var C=eae(MWe(this));kWe(y);var x=arguments.length>1?arguments[1]:void 0,w=C.length,T=void 0===x?w:LWe(RWe(x),w),A=eae(y);return FWe(C,T-A.length,T)===A}});var NWe=za("String","endsWith"),BWe=Rs,WWe=NWe,jN=String.prototype,tae=v(function(y){var C=y.endsWith;return"string"==typeof y||y===jN||BWe(jN,y)&&C===jN.endsWith?WWe:C}),nae=Pr,UWe=tu,VWe=ys,jWe=ks,iae=Pp,HWe=Ow,rae=Function,GWe=nae([].concat),zWe=nae([].join),HN={},oae=HWe?rae.bind:function(y){var C=UWe(this),x=C.prototype,w=iae(arguments,1),T=function(){var A=GWe(w,iae(arguments));return this instanceof T?function(D,M,B){if(!jWe(HN,M)){for(var H=[],Y=0;Y<M;Y++)H[Y]="a["+Y+"]";HN[M]=rae("C,a","return new C("+zWe(H,",")+")")}return HN[M](D,B)}(C,A.length,A):C.apply(y,A)};return VWe(x)&&(T.prototype=x),T};An({target:"Function",proto:!0,forced:Function.bind!==oae},{bind:oae});var YWe=za("Function","bind"),XWe=Rs,$We=YWe,GN=Function.prototype,aae=function(y){var C=y.bind;return y===GN||XWe(GN,y)&&C===GN.bind?$We:C},zN=v(aae),lae=Hr,qWe=Cr,KWe=vl,JWe=tN.trim,ZWe=Pr("".charAt),gA=lae.parseFloat,cae=lae.Symbol,uae=cae&&cae.iterator,dae=1/gA("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff-0")!=-1/0||uae&&!qWe(function(){gA(Object(uae))})?function(y){var C=JWe(KWe(y)),x=gA(C);return 0===x&&"-"===ZWe(C,0)?-0:x}:gA;An({global:!0,forced:parseFloat!==dae},{parseFloat:dae});var YN=v(Co.parseFloat),eUe=An,nUe=g8,hae=vl,iUe=UN,rUe=rm,oUe=VN,sUe=f1("".slice),aUe=Math.min;eUe({target:"String",proto:!0,forced:!oUe("startsWith")},{startsWith:function(y){var C=hae(rUe(this));iUe(y);var x=nUe(aUe(arguments.length>1?arguments[1]:void 0,C.length)),w=hae(y);return sUe(C,x,x+w.length)===w}});var fae,lUe=za("String","startsWith"),cUe=Rs,uUe=lUe,XN=String.prototype,dUe=v(function(y){var C=y.startsWith;return"string"==typeof y||y===XN||cUe(XN,y)&&C===XN.startsWith?uUe:C});function hUe(y){var C,x,w="0x";if(/^(rgb|RGB)/.test(y)){var T=y.replace(/[^\d,.]/g,"").split(",");for(x=0;x<3;++x)1==(C=Number(T[x]).toString(16)).length&&(C="0"+C),w+=C;4==T.length?(1==(C=Math.round(255*Number(T[x])).toString(16)).length&&(C="0"+C),w+=C):w+="ff"}else if("transparent"==y)w+="00000000";else if(/^#[0-9a-fA-f]{6}$/.test(y))w+=y.replace(/#/,"")+"ff";else if(/^#[0-9a-fA-f]{3}$/.test(y)){for(x=0;x<3;++x)w+=y[x]+y[x];w+="ff"}else w="-1";return Number(w)}function fUe(y){if(y>4294967295||y<0)return null;var C;if(de.bHTML5Edition)C="rgba("+Math.floor(y/16777216)+","+Math.floor(y/65536)%256+","+Math.floor(y/256)%256+","+y%256/255+")";else if(y%256==0)C="transparent";else{for(C=Math.floor(y/256).toString(16);6!=C.length;)C="0"+C;C="#"+C}return C}function pUe(y){var C,x=(y=y||window.event).wheelDelta,w=y.detail;return x&&(C=x/120),w&&(C=-(w%3==0?w/3:w)),C}tS(String.prototype)||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),fae={registedClass:[],registedObjs:[]};var d0={LEFT:0,MIDDLE:1,RIGHT:2};function gUe(y){var C=y||window.event;return null==C.which?C.button<2?d0.LEFT:4==C.button?d0.MIDDLE:d0.RIGHT:C.which<2?d0.LEFT:2==C.which?d0.MIDDLE:d0.RIGHT}var $N,qN,mUe=/[\-#$\^*()+\[\]{}|\\,.?\s]/g,KN={"&amp;":"&","&gt;":">","&lt;":"<","&#x60;":"`","&#x2F;":"/","&quot;":'"',"&#x27;":"'"},JN={};function vUe(y){return y.replace(/\\u([a-f\d]{4})/gi,function(C,x){return String.fromCharCode(kp(x,16))})}function yUe(y){return(y+"").replace(function(){if($N)return $N;var C="";return U.each(KN,function(x){C+=x+"|"}),C=ih(C).call(C,0,-1),$N=new RegExp(C,"g")}(),function(C){return JN[C]})}function _Ue(y){return y.replace(mUe,"\\$&")}function CUe(y){return y.replace(function(){if(qN)return qN;var C="";return U.each(JN,function(x){C+=x+"|"}),C+="&#(\\d{1,5});",qN=new RegExp(C,"g")}(),function(C,x){return KN[C]||String.fromCharCode(+x)})}U.each(KN,function(y,C){JN[y]=C});var F1,L1=void 0,N1=function(y){return"function"==typeof y},pae=function(y){return iA?iA(y):y instanceof Array},gae=function(y){return!1===y||y===L1||null===y},QN="undefined",bUe=("undefined"==typeof TypeError?"undefined":Qu(TypeError))===QN?Error:TypeError;if(("undefined"==typeof process?"undefined":Qu(process))!==QN&&process.nextTick)F1=process.nextTick;else if(("undefined"==typeof MessageChannel?"undefined":Qu(MessageChannel))!==QN){var mae=new MessageChannel,ZN=[];mae.port1.onmessage=function(){ZN.length&&ZN.shift()()},F1=function(y){ZN.push(y),mae.port2.postMessage(0)}}else F1=function(y){a7e(y,0)};function xUe(y){F1(function(){throw y})}function wUe(y){return this.then(y,L1)}function vae(y){return this.then(L1,y)}function yae(y,C){return this.then(function(x){return N1(y)?y.apply(null,pae(x)?x:[x]):Ks.onlyFuncs?x:y},C||L1)}function SUe(y){function C(){y()}return this.then(C,C),this}function TUe(y){return this.then(function(C){return N1(y)?y.apply(null,pae(C)?ua(C).call(C,0,0,void 0)&&C:[void 0,C]):Ks.onlyFuncs?C:y},function(C){return y(C)})}function IUe(y){return this.then(L1,y?function(C){throw y(C),C}:xUe)}var Ks=function(){function y(C){Eo(this,y),this.alwaysAsyncFn=null,this.status=0,this.pendings=[],this.promise={then:function(x,w){var T=new y;return this.pendings.push([function(A){try{gae(x)?T.resolve(A):T.resolve(N1(x)?x(A):y.onlyFuncs?A:x)}catch(D){T.reject(D)}},function(A){if((gae(w)||!N1(w)&&y.onlyFuncs)&&T.reject(A),w)try{T.resolve(N1(w)?w(A):w)}catch(D){T.reject(D)}}]),0!==this.status&&this.alwaysAsyncFn(this.execCallbacks),T.promise},success:wUe,error:vae,otherwise:vae,apply:yae,spread:yae,ensure:SUe,nodify:TUe,rethrow:IUe,isPending:function(){return 0===this.status},getStatus:function(){return this.status}},this.alwaysAsyncFn=(L1!==C?C:y.alwaysAsync)?F1:function(x){x()},this.promise.toSource=this.promise.toString=this.promise.valueOf=function(){return void 0===this.value?this:this.value}}return Do(y,[{key:"resolve",value:function(C){var x,w=!1;function T(D){return function(M){return w?void 0:(w=!0,D(M))}}if(this.status)return this;try{var A=!(!(x=C)||!Qu(x).match(/function|object/))&&C.then;if(N1(A)){if(C===this.promise)throw new bUe("Promise can't resolve itself");return A.call(C,T(this.resolve),T(this.reject)),this}}catch(D){return T(this.reject)(D),this}return this.alwaysAsyncFn(function(){this.value=C,this.status=1,this.execCallbacks()}),this}},{key:"reject",value:function(C){return this.status||this.alwaysAsyncFn(function(){try{throw C}catch(x){this.value=x}this.status=-1,this.execCallbacks()}),this}},{key:"execCallbacks",value:function(){if(0!==this.status){var C,x=this.pendings,w=0,T=x.length,A=~this.status?0:1;for(this.pendings=[];w<T;w++)(C=x[w][A])&&C(this.value)}}}]),y}();Ks.deferred=Ks,Ks.defer=Ks,Ks.nextTick=F1,Ks.alwaysAsync=!0,Ks.onlyFuncs=!0,Ks.resolve=function(y){return new Ks(!0).resolve(y).promise},Ks.resolved=Ks.resolve,Ks.fulfilled=Ks.resolve,Ks.reject=function(y){return new Ks(!0).reject(y).promise},Ks.rejected=Ks.reject;var e7,mA,t7,vA=window;function EUe(y){return y.which=null==(y=y||window.event).which?y.button<2?1:4==y.button?2:3:y.which<2?1:2==y.which?2:3,y}function DUe(y,C){return y.currentStyle?y.currentStyle[C]:window.getComputedStyle?document.defaultView.getComputedStyle(y,null)[C]:null}function _ae(y){var C=Qu(y);return null==y||"object"!==C&&"function"!==C}function AUe(y,C,x,w){C=C||"&",x=x||"=",U.isUndefined(w)&&(w=ae);var T=[];return U.each(y,function(A,D){var M=U.urlEncode(D);_ae(A)?(T.push(M),U.isDef(A)&&T.push(x,U.urlEncode(A+"")),T.push(C)):U.isArray(A)&&A.length&&U.each(A,function(B){_ae(B)&&(T.push(M,w?U.urlEncode("[]"):""),U.isDef(B)&&T.push(x,U.urlEncode(B+"")),T.push(C))})}),T.pop(),T.join("")}function PUe(y,C,x){if(!U.isString(y)||!(y=tS(U).call(U,y)))return{};x=x||"=";for(var w,T,A,D={},M=U.urlDecode,B=y.split(C=C||"&"),H=0,Y=B.length;H<Y;++H){if(-1===(w=No(U).call(U,x,B[H])))T=M(B[H]),A=void 0;else{T=M(B[H].substring(0,w)),A=B[H].substring(w+1);try{A=M(A)}catch(G){U.error("decodeURIComponent error : "+A),U.error(G)}tae(U).call(U,T,"[]")&&(T=T.substring(0,T.length-2))}T in D?U.isArray(D[T])?D[T].push(A):D[T]=[D[T],A]:D[T]=A}return D}vA&&U.isFunction(vA.__zone_symbol__Promise)&&(mA=vA.__zone_symbol__Promise),e7=self&&u0||vA&&u0?u0:Ks,mA||(mA=e7),U.each({"&amp;":"&","&gt;":">","&lt;":"<","&#x60;":"`","&#x2F;":"/","&quot;":'"',"&#x27;":"'"},function(y,C){});var Cae="ds-dwt-loaderBar",n7="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjAiIHdpZHRoPSIxMDBweCIgaGVpZ2h0PSIxMDBweCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxjaXJjbGUgY3g9IjE2IiBjeT0iNjQiIHI9IjE2IiBmaWxsPSIjZmU4ZTE0Ii8+PGNpcmNsZSBjeD0iMTYiIGN5PSI2NCIgcj0iMTQuMzQ0IiBmaWxsPSIjZmU4ZTE0IiB0cmFuc2Zvcm09InJvdGF0ZSg0NSA2NCA2NCkiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjY0IiByPSIxMi41MzEiIGZpbGw9IiNmZThlMTQiIHRyYW5zZm9ybT0icm90YXRlKDkwIDY0IDY0KSIvPjxjaXJjbGUgY3g9IjE2IiBjeT0iNjQiIHI9IjEwLjc1IiBmaWxsPSIjZmU4ZTE0IiB0cmFuc2Zvcm09InJvdGF0ZSgxMzUgNjQgNjQpIi8+PGNpcmNsZSBjeD0iMTYiIGN5PSI2NCIgcj0iMTAuMDYzIiBmaWxsPSIjZmU4ZTE0IiB0cmFuc2Zvcm09InJvdGF0ZSgxODAgNjQgNjQpIi8+PGNpcmNsZSBjeD0iMTYiIGN5PSI2NCIgcj0iOC4wNjMiIGZpbGw9IiNmZThlMTQiIHRyYW5zZm9ybT0icm90YXRlKDIyNSA2NCA2NCkiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjY0IiByPSI2LjQzOCIgZmlsbD0iI2ZlOGUxNCIgdHJhbnNmb3JtPSJyb3RhdGUoMjcwIDY0IDY0KSIvPjxjaXJjbGUgY3g9IjE2IiBjeT0iNjQiIHI9IjUuMzc1IiBmaWxsPSIjZmU4ZTE0IiB0cmFuc2Zvcm09InJvdGF0ZSgzMTUgNjQgNjQpIi8+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJyb3RhdGUiIHZhbHVlcz0iNDUgNjQgNjQ7OTAgNjQgNjQ7MTM1IDY0IDY0OzE4MCA2NCA2NDsyMjUgNjQgNjQ7MjcwIDY0IDY0OzMxNSA2NCA2NDswIDY0IDY0IiBjYWxjTW9kZT0iZGlzY3JldGUiIGR1cj0iNzIwbXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9nPjwvc3ZnPg==";function bae(y){var C,x,w,T="",A="230px",D="240px",M="",B="";return y&&(y.background&&(T=";background:"+y.background),y.width&&(A=y.width),y.height&&(D=y.height),y.imageSource&&(C=y.imageSource)),C||(C=n7),w=kp(A)/2,U.isNumber(w)&&w>0&&(B=";width:"+w+"px"),x=kp(D)/2,U.isNumber(x)&&x>0&&(M=";height:"+x+"px"),['<div align="center" ','class="',Cae,'" ','style="margin:0 auto;max-width:',A,";max-height:",D,";line-height:",D,T,'"><img style="user-select:none',M,B,';max-width:230px;max-height:240px;vertical-align:middle" src="',C,'" draggable="false" /></div>'].join("")}var iu,dS=window,_s=document;function RUe(y,C){for(var x=0;x<y.length;++x)if(y[x]==C)return ae;return fe}function xae(y){var C=_s.createEvent("MouseEvents");return null==C||C.initMouseEvent(y.type,y.bubbles,y.cancelable,dS,y.detail,y.screenX,y.screenY,y.clientX,y.clientY,y.ctrlKey,y.altKey,y.shiftKey,y.metaKey,y.button,y.relatedTarget),C}function wae(y){var C;null===(C=_s.body)||void 0===C||C.dispatchEvent(xae(y))}function Sae(y,C){if(iu){var x=iu.style;x.backgroundColor=["rgba(",C,",",C,",",C,",",y,")"].join(""),x.filter=["alpha(opacity=",100*y,")"].join(""),x.opacity=x.MozOpacity=y}}var r7,yl,dm={pendingDialogStack:[],pendingDialogTopmostStack:[],opacity:.1,grayHex:128,_updateStacking:function(y){var C,x;0!=(C=this.pendingDialogStack).length?(1!=y&&function MUe(y,C){iu===t7?function(x,w){if(iu=_s.createElement("div")){var T=iu.style;T.position="fixed",T.display="block",T.left=T.top=T.margin=T.padding=0,Sae(x,w),T.zIndex=5e5,T.width=T.height="100%",de.bIE&&de.IEVersion<10&&(iu.innerHTML='<iframe src="javascript:\'\'" style="background:none;margin:0px auto;border:0;width:100%;height:100%;position:relative;z-index:9999;"></iframe>'),_s.createEvent&&U.addEventListener(iu,"click",wae)}}(y,C):Sae(y,C),_s.body&&!_s.body.contains(iu)&&_s.body.appendChild(iu)}(dm.opacity,dm.grayHex),x=5e5,U.each(C,function(w){x++,w._dlgInfo.mask&&(w._dlgInfo.mask.style.zIndex=x++),w.style.zIndex=x})):iu!==t7&&(U.removeEventListener(iu,"click",wae),_s&&_s.body&&_s.body.removeChild(iu),iu=t7)},pushDialog:function(y,C){var x,w,T=this;if(y.getBoundingClientRect(),(w=y.bTopmost?T.pendingDialogTopmostStack:T.pendingDialogStack).length>=1e3)U.error("Too many modal dialogs.");else{if((x=_s.createElement("div")).style.zIndex="10000",x.className="dynamsoft-backdrop",1==C?(x.style.left=0,x.style.top=0,x.style.position="absolute"):(x.style.left=0,x.style.top=0,x.style.width="100%",x.style.height="100%",x.style.position="fixed"),_s.createEvent&&U.addEventListener(x,"click",function(D){if(y.dispatchEvent){var M=xae(D);y.dispatchEvent(M)}}),y.parentNode.insertBefore(x,y.nextSibling),y._dlgInfo.mask=x,y.bTopmost){var A=501e3;y._dlgInfo.mask&&(y._dlgInfo.mask.style.zIndex=A),y.style.zIndex=A+1}w.push(y),T._updateStacking(C)}},removeDialog:function(y){var C,x,w,T=this;-1!=(C=U.isArray(w=y.bTopmost?T.pendingDialogTopmostStack:T.pendingDialogStack)?No(U).call(U,y,w):-1)&&(ua(w).call(w,C,1),(x=y._dlgInfo.mask).parentNode&&x.parentNode.removeChild(x),y._dlgInfo.mask=null,T._updateStacking())}};function yA(y,C){var x,q,re,se,ce,ve,Te,w=this,T=!0,A=1==C?"absolute":"fixed",D="50%",M="50%",B="",H="",Y=null;if(w._dlgInfo&&w._dlgInfo.styleConfig){var G=w._dlgInfo.styleConfig;U.isString(G.style)?(x=G.style,T=!1):(U.isString(G.position)&&(A=G.position,T=!1),(U.isString(G.left)||U.isNumber(G.left))&&(M=G.left,T=!1),(U.isString(G.top)||U.isNumber(G.top))&&(D=G.top,T=!1),(U.isString(G.width)||U.isNumber(G.width))&&(B=G.width,T=!1),(U.isString(G.height)||U.isNumber(G.height))&&(H=G.height,T=!1),U.isString(G.transform)&&(Y=G.transform,T=!1))}w.open?U.error("showDialog called on open dialog."):(w.open=ae,w.removeAttribute("closed"),w.setAttribute("open","open"),x?w.setAttribute("style",x):(T?q=de.bIE&&"fixed"==A?["display:block;position:fixed;top:35%;margin:0 auto;left:0;right:0"]:["display:block;position:",A,";left:50%;top:50%;transform:translate(-50%,-50%)"]:(q=["display:block;position:",A,";left:",M,";top:",D,";width:",B,";height:",H],Y&&(q.push(";transform:"),q.push(Y))),q.push("DIALOG"==w.tagName?";margin:0;border-radius:6px;box-shadow:2px 2px 0 0 rgba(0,0,0,.05);-webkit-box-sizing:border-box;box-sizing:border-box;":";border:0;margin:0;-webkit-box-sizing:border-box;box-sizing:border-box;"),w.setAttribute("style",q.join(""))),function kUe(y){var C;return dS.getComputedStyle?C=dS.getComputedStyle(y):y.currentStyle&&(C=y.currentStyle),C&&"absolute"!=C.position||"auto"!=y.style.top&&""!=y.style.top||"auto"!=y.style.bottom&&""!=y.style.bottom?fe:!function(x){for(var w=0;w<_s.styleSheets.length;++w){var T=_s.styleSheets[w],A=void 0,D=void 0,M=void 0,B=void 0;try{A=T.cssRules,D=_s.querySelectorAll}catch(q){}if(A&&D)for(var H=0;H<A.length;++H){M=A[H],B=fe;try{B=D(M.selectorText)}catch(q){}if(B&&RUe(B,x)){var Y=M.style.getPropertyValue("top"),G=M.style.getPropertyValue("bottom");if(Y&&"auto"!=Y||G&&"auto"!=G)return ae}}}return fe}(y)}(w)&&(Te=((null===(se=_s.body)||void 0===se?void 0:se.scrollTop)||(null===(ce=_s.documentElement)||void 0===ce?void 0:ce.scrollTop)||0)+((dS.innerHeight?dS.innerHeight:null===(ve=_s.documentElement)||void 0===ve?void 0:ve.clientHeight)-(re=w).offsetHeight)/2,re.style.top=Te+"px",re._dlgInfo.isTopOverridden=ae),y&&(w._dlgInfo.modal=ae,dm.pushDialog(w,C)))}function Tae(y){var C=this;return C.open||U.error("closeDialog called on closed dialog."),C.open=fe,C.removeAttribute("open"),C.setAttribute("closed","closed"),C.style.display="none",void 0!==y&&(C.returnValue=y),C._dlgInfo.isTopOverridden&&(C.style.top="auto"),C._dlgInfo.modal&&dm.removeDialog(C),C.returnValue}function Iae(y){dm.opacity=U.isNumber(y.opacity)?y.opacity:.1,dm.grayHex=U.isNumber(y.grayHex)?y.grayHex:128}function OUe(y){var C,x,w,T,A;if(!yl.dlgMask){var D,M,B,H,Y=!1;if(y&&(H={},y.style?H.style=y.style:((U.isString(y.top)||U.isNumber(y.top))&&(H.top=y.top),(U.isString(y.left)||U.isNumber(y.left))&&(H.left=y.left),U.isString(y.position)&&(H.position=y.position)),y.confined&&(document.getElementsByClassName("dwt-viewer-imageEditor-fullScreen")[0]||(Y=y.confined)),(U.isString(y.width)||U.isNumber(y.width))&&(x=y.width),(U.isString(y.height)||U.isNumber(y.height))&&(w=y.height),U.isString(y.background)&&(T=y.background),U.isString(y.imageSource)&&(A=y.imageSource),Iae(y),Y&&y.wrapperEl&&U.isString(M=y.wrapperEl)&&(M=_s.getElementById(M))),!A){var G;if(window&&window.Dynamsoft){var q=window.Dynamsoft.DWT;q&&q.CustomizableDisplayInfo&&(G=q.CustomizableDisplayInfo)}G?(de.bIE&&U.isString(G.loaderBarSourceIE)&&""!=G.loaderBarSourceIE&&(A=G.loaderBarSourceIE),!A&&U.isString(G.loaderBarSource)&&""!=G.loaderBarSource&&(A=G.loaderBarSource)):A=n7}M&&(B=M.getBoundingClientRect(),M.style.position="relative"),(D=_s.createElement("div"))&&(D.className="dynamsoft-dialog-wrap",D.innerHTML=bae({width:x,height:w,backgroundColor:T,imageSource:A}),M?(M.appendChild(D),D.style.position="absolute",D.style.top="50%",D.style.left="50%",D.style.transform="translate(-50%, -50%)"):null===(C=_s.body)||void 0===C||C.appendChild(D),Y&&B&&(yl.preOnresize=!!window.onresize&&window.onresize,yl.preOnscroll=!!window.onscroll&&window.onscroll),yl.dlgMask=D,r7.setup(D,Y),H&&(D._dlgInfo.styleConfig=H),M&&(D._dlgInfo.wrapperEl=M),D.showModal())}}function FUe(){var y,C=yl.dlgMask;C&&(C.close(),C._dlgInfo&&C._dlgInfo.wrapperEl?(C._dlgInfo.wrapperEl.removeChild(C),C._dlgInfo.wrapperEl=null):null===(y=_s.body)||void 0===y||y.removeChild(C),yl.dlgMask=!1),window.onresize=yl.preOnresize?yl.preOnresize:null,yl.preOnresize=!1,window.onscroll=yl.preOnscroll?yl.preOnscroll:null,yl.preOnscroll=!1}r7={setup:function(y,C){y.show=zN(yA).call(yA,y,fe,C),y.showModal=zN(yA).call(yA,y,ae,C),y.close=zN(Tae).call(Tae,y),y._dlgInfo={}}},yl={dlgMask:!1,preOnresize:!1,preOnscroll:!1};var B1,_A,LUe=function(){function y(C){Eo(this,y);var x=C.createElement("div"),w=C.createElement("div");w.style&&(this.div=w,this.container=x,this.docElem=C.documentElement,w.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",this.leadingWhitespace=3===w.firstChild.nodeType,this.tbody=!w.getElementsByTagName("tbody").length,this.htmlSerialize=!!w.getElementsByTagName("link").length,w.style.cssText="float:left;opacity:.5",this.opacity="0.5"===w.style.opacity,this.cssFloat=!!w.style.cssFloat,w.style.backgroundClip="content-box",w.cloneNode(!0).style.backgroundClip="",this.clearCloneStyle="content-box"===w.style.backgroundClip,(x=document.createElement("div")).style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",w.innerHTML="",x.appendChild(w),this.boxSizing=""===w.style.boxSizing||""===w.style.MozBoxSizing||""===w.style.WebkitBoxSizing)}return Do(y,[{key:"reliableHiddenOffsets",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.reliableHiddenOffsetsVal}},{key:"boxSizingReliable",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.boxSizingReliableVal}},{key:"pixelMarginRight",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.pixelMarginRightVal}},{key:"pixelPosition",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.pixelPositionVal}},{key:"reliableMarginRight",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.reliableMarginRightVal}},{key:"reliableMarginLeft",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.reliableMarginLeftVal}},{key:"computeStyleTests",value:function(){var C,x,w=this.div;this.docElem&&this.docElem.appendChild(this.container),w.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",this.pixelPositionVal=this.boxSizingReliableVal=this.reliableMarginLeftVal=!1,this.pixelMarginRightVal=this.reliableMarginRightVal=!0,window.getComputedStyle&&(x=window.getComputedStyle(w),this.pixelPositionVal="1%"!==(x||{}).top,this.reliableMarginLeftVal="2px"===(x||{}).marginLeft,this.boxSizingReliableVal="4px"===(x||{width:"4px"}).width,w.style.marginRight="50%",this.pixelMarginRightVal="4px"===(x||{marginRight:"4px"}).marginRight,(C=w.appendChild(document.createElement("div"))).style.cssText=w.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",C.style.marginRight=C.style.width="0",w.style.width="1px",this.reliableMarginRightVal=!YN((window.getComputedStyle(C)||{}).marginRight),w&&w.removeChild(C)),w.style.display="none",this.reliableHiddenOffsetsVal=0===w.getClientRects().length,this.reliableHiddenOffsetsVal&&(w.style.display="",w.innerHTML="<table><tr><td></td><td>t</td></tr></table>",w.childNodes[0].style.borderCollapse="separate",(C=w.getElementsByTagName("td"))[0].style.cssText="margin:0;border:0;padding:0;display:none",this.reliableHiddenOffsetsVal=0===C[0].offsetHeight,this.reliableHiddenOffsetsVal&&(C[0].style.display="",C[1].style.display="none",this.reliableHiddenOffsetsVal=0===C[0].offsetHeight)),this.docElem&&this.docElem.removeChild(this.container)}}]),y}(),Zu=new LUe(document),Eae=Zu.docElem,Dae=U.sizzle,NUe=/^margin/,BUe=/^(top|right|bottom|left)$/,o7=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,s7=new RegExp("^("+o7+")(?!px)[a-z%]+$","i"),WUe=new RegExp("^("+o7+")(.*)$","i");window.getComputedStyle?(B1=function(y){var C,x;return(x=(C=U.isFunction(y.getEL)?y.getEL():y).ownerDocument.defaultView)&&x.opener||(x=window),x.getComputedStyle(C)},_A=function(y,C,x){var w,T,A,D,M=y.style;return""!==(D=(x=x||B1(y))?x.getPropertyValue(C)||x[C]:void 0)&&void 0!==D||Dae.contains(y.ownerDocument,y)||(D=fS(y,C)),x&&!Zu.pixelMarginRight()&&s7.test(D)&&NUe.test(C)&&(w=M.width,T=M.minWidth,A=M.maxWidth,M.minWidth=M.maxWidth=M.width=D,D=x.width,M.width=w,M.minWidth=T,M.maxWidth=A),void 0===D?D:D+""}):Eae&&Eae.currentStyle&&(B1=function(y){return y.currentStyle},_A=function(y,C,x){var w,T,A,D,M=y.style;return null==(D=(x=x||B1(y))?x[C]:void 0)&&M&&M[C]&&(D=M[C]),s7.test(D)&&!BUe.test(C)&&(w=M.left,(A=(T=y.runtimeStyle)&&T.left)&&(T.left=y.currentStyle.left),M.left="fontSize"===C?"1em":D,D=M.pixelLeft+"px",M.left=w,A&&(T.left=A)),void 0===D?D:D+""||"auto"});var a7,UUe=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,VUe=/<([\w:-]+)/,Aae=/^\s+/,jUe=/<|&#?\w+;/,Pae=/<tbody/i,HUe=/^-ms-/,GUe=/-([\da-z])/gi,zUe=/^(none|table(?!-c[ea]).+)/,YUe=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,XUe={position:"absolute",visibility:"hidden",display:"block"},Rae={letterSpacing:"0",fontWeight:"400"},hS=["Top","Right","Bottom","Left"],kae={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:Zu.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Mae=["Webkit","O","Moz","ms"],Oae=document.createElement("div");a7=Oae.style,Zu.cssFloat=!!Oae.style.cssFloat;var qUe=function(y,C){return C.toUpperCase()},Js={cssHooks:{},htmlPrefilter:function(y){return y.replace(UUe,"<$1></$2>")},nodeName:function(y,C){return y.nodeName&&y.nodeName.toLowerCase()===C.toLowerCase()},merge:function(y,C){for(var x=+C.length,w=0,T=y.length;w<x;)y[T++]=C[w++];if(x!=x)for(;void 0!==C[w];)y[T++]=C[w++];return y.length=T,y},camelCase:function(y){return y.replace(HUe,"ms-").replace(GUe,qUe)},cssProps:{},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0}},KUe=["flo","at"].join("");function Fae(y){if(y in a7)return y;for(var C=y.charAt(0).toUpperCase()+ih(y).call(y,1),x=Mae.length;x--;)if((y=Mae[x]+C)in a7)return y}function Lae(y,C,x,w,T){for(var A=x===(w?"border":"content")?4:"width"===C?1:0,D=0;A<4;A+=2)"margin"===x&&(D+=rh(y,x+hS[A],!0,T)),w?("content"===x&&(D-=rh(y,"padding"+hS[A],!0,T)),"margin"!==x&&(D-=rh(y,"border"+hS[A]+"Width",!0,T))):(D+=rh(y,"padding"+hS[A],!0,T),"padding"!==x&&(D+=rh(y,"border"+hS[A]+"Width",!0,T)));return D}function Nae(y,C,x){var w=!0,T="width"===C?y.offsetWidth:y.offsetHeight,A=B1(y),D=Zu.boxSizing&&"border-box"===rh(y,"boxSizing",!1,A);if(T<=0||null==T){if(((T=_A(y,C,A))<0||null==T)&&(T=y.style[C]),s7.test(T))return T;w=D&&(Zu.boxSizingReliable()||T===y.style[C]),T=YN(T)||0}return T+Lae(y,C,x||(D?"border":"content"),w,A)}function Bae(y){return new RegExp("^(?:([+-])=|)("+o7+")([a-z%]*)$","i").exec(y)}function fS(y,C,x,w){if(y&&3!==y.nodeType&&8!==y.nodeType&&y.style){var T,A,D,M=Js.camelCase(C),B=y.style;if(C=Js.cssProps[M]||(Js.cssProps[M]=Fae(M)||M),D=Js.cssHooks[C]||Js.cssHooks[M],void 0===x)return D&&"get"in D&&void 0!==(T=D.get(y,!1,w))?T:B[C]+"";"string"===(A=Qu(x))&&(T=Bae(x))&&T[1]&&(x=function(H,Y,G,q){var re,se=1,ce=20,ve=function(){return rh(H,Y,"")},Te=ve(),Ue=G&&G[3]||(Js.cssNumber[Y]?"":"px"),je=(Js.cssNumber[Y]||"px"!==Ue&&+Te)&&Bae(rh(H,Y));if(je&&je[3]!==Ue){Ue=Ue||je[3],G=G||[],je=+Te||1;do{fS(H,Y,(je/=se=se||".5")+Ue)}while(se!==(se=ve()/Te)&&1!==se&&--ce)}return G&&(je=+je||+Te||0,re=G[1]?je+(G[1]+1)*G[2]:+G[2]),re}(y,C,T),A="number"),null!=x&&x==x&&("number"===A&&(x+=T&&T[3]||(Js.cssNumber[M]?"":"px")),Zu.clearCloneStyle||""!==x||0!==No(C).call(C,"background")||(B[C]="inherit"),D&&"set"in D&&void 0===(x=D.set(y,x,w))||(B[C]=x))}}function rh(y,C,x,w){var T,A,D,M=Js.camelCase(C);return C=Js.cssProps[M]||(Js.cssProps[M]=Fae(M)||M),(D=Js.cssHooks[C]||Js.cssHooks[M])&&"get"in D&&(A=D.get(y,!0,x)),void 0===A&&(A=_A(y,C,w)),"normal"===A&&C in Rae&&(A=Rae[C]),""===x||x?(T=YN(A),!0===x||isFinite(T)?T||0:A):A}function CA(y,C){if(!y||"string"!=typeof y)return[];"boolean"==typeof C&&(C=!1),C=C||document;var x=YUe.exec(y);return x?[C.createElement(x[1])]:(x=function JUe(y,C){for(var x,w,T,A,D,M,B=y.length,H=function(re){var se="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video".split("|"),ce=re.createDocumentFragment();if(ce.createElement)for(;se.length;)ce.createElement(se.pop());return ce}(C),Y=[],G=0;G<B;G++)if((w=y[G])||0===w)if("object"===U.type(w))Js.merge(Y,w.nodeType?[w]:w);else if(jUe.test(w)){if(T=T||H.appendChild(C.createElement("div"))){for(A=(VUe.exec(w)||["",""])[1].toLowerCase(),T.innerHTML=(M=kae[A]||kae._default)[1]+Js.htmlPrefilter(w)+M[2],x=M[0];x--;)T=T.lastChild;if(!Zu.leadingWhitespace&&Aae.test(w)){var q=Aae.exec(w);q&&q.length>0&&Y.push(C.createTextNode(q[0]))}if(!Zu.tbody&&(x=(w="table"!==A||Pae.test(w)?"<table>"!==M[1]||Pae.test(w)?0:T:T.firstChild)&&w.childNodes.length,w))for(;x--;)Js.nodeName(D=w.childNodes[x],"tbody")&&!D.childNodes.length&&w.removeChild(D);for(Js.merge(Y,T.childNodes),T.textContent="";T.firstChild;)T.removeChild(T.firstChild);T=H.lastChild}}else Y.push(C.createTextNode(w));for(T&&H&&H.removeChild(T),G=0;w=Y[G++];)"SCRIPT"!==w.tagName&&(Dae.contains(w.ownerDocument,w),H.appendChild(w));return T=null,H}([y],C),Js.merge([],x.childNodes))}Js.cssProps[KUe]=Zu.cssFloat?"cssFloat":"styleFloat",U.each(["height","width"],function(y,C){Js.cssHooks[y]={get:function(x,w,T){if(w)return zUe.test(rh(x,"display"))&&0===x.offsetWidth?(A=x,Y={},U.each(D=XUe,function(G,q){Y[q]=A.style[q],A.style[q]=D[q]}),H=function(){return Nae(x,y,T)}.apply(A,[]),U.each(D,function(G,q){A.style[q]=Y[q]}),H):Nae(x,y,T);var A,D,H,Y},set:function(x,w,T){var M,B,H,A=T&&B1(x);return M=w,B=T?Lae(x,y,T,Zu.boxSizing&&"border-box"===rh(x,"boxSizing",!1,A),A):0,(H=WUe.exec(M))?Math.max(0,kp(H[1])-(B||0))+(H[2]||"px"):M}}});var Wae,Uae=ih(Array.prototype),gc=" ",ZUe=de.bIE&&de.IEMode<10,Vae=/[\n\t\r\.]/g,l7=function(){function y(C,x,w){Eo(this,y),this.isNodeList=!0,this.length=0;var T=this;return!C||U.isString(C)?T:U.isArray(C)||C.isNodeList?(Array.prototype.push.apply(T,U.makeArray(C)),T):(T[0]=C,T.length=1,T)}return Do(y,[{key:"item",value:function(C){return U.isNumber(C)?C>=this.length?null:new y(this[C]):new y(C)}},{key:"slice",value:function(){return new y(Uae.apply(this,arguments))}},{key:"getDOMNodes",value:function(){return Uae.call(this)}},{key:"each",value:function(C,x){var w=this;return U.each(w,function(T,A){return T=new y(T),C.call(x||T,T,A,w)}),w}},{key:"getEL",value:function(){return this.length>0?this[0]:void 0}},{key:"all",value:function(C){return this.length>0?h7(C,this):new y}},{key:"one",value:function(C){var x=this.all(C);return x.length?ih(x).call(x,0,1):x}},{key:"attr",value:function(C,x){var w=this.getEL();if(w){if(U.isUndefined(x))return"readonly"===C?w.readOnly?"readonly":"":("style"!==C&&ZUe?w=w[C]:(w=w.attributes[C])&&(w=w.value),w);"class"==C?w.className=x:w[C]=x}}},{key:"addClass",value:function(C){var x=this.getEL();x&&function(w,T){var A,D,M,B,H=w.className,Y=T.length;if(H){for(A=u7(H),D=H,M=0;M<Y;M++)B=d7(T[M]),No(A).call(A,gc+B+gc)<0&&(D+=gc+B);D=tS(U).call(U,D)}else D=T.join(" ");w.className=D}(x,C.split(gc))}},{key:"removeClass",value:function(C){var x=this.getEL();x&&function(w,T){var A,D,M,B=w.className,H=T.length;if(B&&H){for(A=u7(B),D=0;D<H;D++)for(M=gc+d7(T[D])+gc;No(A).call(A,M)>=0;)A=A.replace(M,gc);w.className=tS(U).call(U,A)}}(x,C.split(gc))}},{key:"hasClass",value:function(C){var x=this.getEL();if(x)return function(w,T){var A,D,M,B=w.className,H=T.length;if(B&&H){for(A=u7(B),D=0;D<H;D++)if(M=gc+d7(T[D])+gc,No(A).call(A,M)<0)return fe;return ae}return fe}(x,C.split(gc))}},{key:"parent",value:function(){var C=this.getEL();return C&&(C=C.parentNode),new y(C)}},{key:"remove",value:function(){var C=this.getEL();C&&C.parentNode&&C.parentNode.removeChild(C)}},{key:"offset",value:function(){var C=this.getEL();return U.DOM.getElDimensions(C,ae)}},{key:"before",value:function(C){var x=this.getEL(),w=[C];x&&(c7(C)&&(w=CA(C)),U.each(w,function(T){x.insertBefore(T,x.childNodes[0])}))}},{key:"append",value:function(C){var x=this.getEL(),w=[C];x&&(c7(C)&&(w=CA(C)),U.each(w,function(T){x.appendChild(T)}))}},{key:"html",value:function(C){var T,x=this.getEL();if(x){if(U.isUndefined(C))return T=x.innerHTML,document.all?(T=T.replace(/(\s+\w+)\s*=\s*([^<>"\s]+)(?=[^<>]*\/>)/gi,'$1="$2"').replace(/"'([^'"]*)'"/gi,'"$1"')).replace(/<(\/?)(\w+)([^>]*)>/g,function(M,B,H,Y){return B?"</"+H.toLowerCase()+">":("<"+H.toLowerCase()+Y+">").replace(/=(("[^"]*?")|('[^']*?')|([\w\-\.]+))([\s>])/g,function(G,q,re,se,ce,ve,Te,Ue){return ce?'="'+ce+'"'+ve:G})}).replace(/<\/?([^>]+)>/g,function(M){return M}):T;x.innerHTML="",U.each(CA(C),function(w){x.appendChild(w)})}}},{key:"style",value:function(C,x){var w=this.getEL();if(w)return fS(w,C,x)}},{key:"css",value:function(C){U.each(this,function(x){U.each(C,function(w,T){fS(x,T,w)})})}}]),y}();function c7(y){return U.isString(y)&&(y=tS(U).call(U,y))&&y.length>=3&&dUe(U).call(U,y,"<")&&tae(U).call(U,y,">")}function u7(y){return(gc+y+gc).replace(Vae,gc)}function d7(y){return y.replace(Vae,"")}function h7(y,C){var x=C;return x&&x.isNodeList&&(x=x.getEL()),U.isString(y)?(c7(y)&&U.error("Err 4002."),new l7(U.sizzle(y,x))):y.isNodeList?y:new l7(y)}function eVe(y,C){var x=h7(y,C);return x.length?ih(x).call(x,0,1):x}function tVe(y){return y instanceof l7}(Wae=self||{}).Map||(Wae.Map=function(){this.keys=[],this.data={},this.set=function(y,C){var x;null==this.data[y]&&-1==No(x=sN(this)).call(x,y)&&sN(this).push(y),this.data[y]=C},this.get=function(y){return this.data[y]}});var ft=new(Do(function y(){Eo(this,y),this.__ver=20230516,this.Events=fae,this.EnumMouseButton=d0,this.detectButton=gUe,this.getWheelDelta=pUe,this.fromUnicode=vUe,this.escapeHtml=yUe,this.escapeRegExp=_Ue,this.unEscapeHtml=CUe,this.param=AUe,this.unparam=PUe,this.colorStrToInt=hUe,this.IntToColorStr=fUe,this.currentStyle=DUe,this.parseHTML=CA,this.css=rh,this.style=fS,this.support=Zu,this.all=h7,this.one=eVe,this.isNodeList=tVe,this.Promise=e7,this.nativePromise=mA,this.loaderBarClassName=Cae,this.loaderBarSource=n7,this.createShowMaskContent=bae,this.switchEvent=EUe,this.setBackOpacity=Iae,this.showMask=OUe,this.hideMask=FUe,this.dialog=r7,this.mask=yl})),ed={getHex:function(y){var C=Number(y).toString(16).toUpperCase();return 1==C.length&&(C=["0",C].join("")),C},getColor:function(y){var C,x;return x=(65280&y)>>8,C=255&y,["#",ed.getHex(y>>16),ed.getHex(x),ed.getHex(C)].join("")},RGB2BGR:function(y){return(255&y)<<16|65280&y|y>>16}};function Dn(y,C,x){return(C=u(C))in y?Object.defineProperty(y,C,{value:x,enumerable:!0,configurable:!0,writable:!0}):y[C]=x,y}ed.BGR2RGB=ed.RGB2BGR;var vt=!1,Lt=!0,jae=/[#\/\?@]/g,nVe=/[#\?]/g,Hae={scheme:1,userInfo:2,hostname:3,port:4,path:5},iVe=new RegExp("^(?:([\\w\\d+.-]+):)?(?://(?:([^/?#@]*)@)?([\\w\\d\\-\\u0100-\\uffff.+%]*|\\[[^\\]]+\\])(?::([0-9]+))?)?(.+)?$");function f7(y,C){return U.isString(y)&&U.isString(C)?y.toLowerCase()===C.toLowerCase():y===C}function p7(y,C){return encodeURI(y).replace(C,function(x){return"%"+(1===(w=x.charCodeAt(0).toString(16)).length?"0"+w:w);var w})}var g7=function(){function y(C){if(l(this,y),Dn(this,"scheme",""),Dn(this,"userInfo",""),Dn(this,"hostname",""),Dn(this,"port",""),Dn(this,"path",""),C instanceof y)return U.clone(C);y.getComponents(C,this)}return g(y,[{key:"clone",value:function(){var C=new y,x=this;return U.each(Hae,function(w,T){C[T]=x[T]}),C}},{key:"getScheme",value:function(){return this.scheme}},{key:"setScheme",value:function(C){return this.scheme=C,this}},{key:"getHostname",value:function(){return this.hostname}},{key:"setHostname",value:function(C){return this.hostname=C,this}},{key:"setUserInfo",value:function(C){return this.userInfo=C,this}},{key:"getUserInfo",value:function(){return this.userInfo}},{key:"setPort",value:function(C){return this.port=C,this}},{key:"getPort",value:function(){return this.port}},{key:"setPath",value:function(C){return this.path=C,this}},{key:"getPath",value:function(){return this.path}},{key:"isSameOriginAs",value:function(C){var x=this;return f7(x.hostname,C.hostname)&&f7(x.scheme,C.scheme)&&f7(x.port,C.port)}},{key:"toString",value:function(C){var x,w,T,A,D,M=[],B=this;return(x=B.scheme)&&(M.push(p7(x,jae)),M.push(":")),(w=B.hostname)&&(M.push("//"),(D=B.userInfo)&&(M.push(p7(D,jae)),M.push("@")),M.push(encodeURIComponent(w)),(A=B.port)&&(M.push(":"),M.push(A))),(T=B.path)&&(w&&!U.startsWith(T,"/")&&(T="/"+T),M.push(p7(T,nVe))),M.join("")}}],[{key:"getComponents",value:function(C,x){var w=(C=C||"").match(iVe)||[],T=x||{};return U.each(Hae,function(A,D){T[D]=w[A]}),T}}])}(),bA=U.each,df=U.error,m7=U.isFunction,v7=U.isString,y7=de.bIE&&de.IEVersion<=9,rVe=de.bIE&&de.IEVersion<=10,hm=window,_7=new g7(location.href),zae=_7&&/^(?:about|app|app\-storage|.+\-extension|file|widget)$/.test(_7.getScheme()),C7=function(){try{return new hm.XMLHttpRequest}catch(y){}},Yae=function(){try{var y=vt;return bA(["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.3.0","Msxml3.XMLHTTP"],function(C){try{if(!y)return y=new hm.ActiveXObject(C),vt}catch(x){df("new xhr error: "+x.message)}}),y}catch(C){}},sVe=!(zae||!hm.XMLHttpRequest)&&"withCredentials"in(C7()||[]),aVe=hm.ActiveXObject?function(y){return y7?Yae():!zae&&C7()||Yae()}:C7,lVe=/^(?:GET|HEAD)$/,cVe=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,b7={xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},x7=void 0;rVe&&(x7=U.noop);var uVe=function(){function y(){l(this,y),Dn(this,"url",!1),Dn(this,"onSuccess",!1),Dn(this,"onError",!1),Dn(this,"onComplete",!1),Dn(this,"method","GET"),Dn(this,"async",!0),Dn(this,"xhrFields",!1),Dn(this,"mimeType",!1),Dn(this,"username",!1),Dn(this,"password",!1),Dn(this,"data",!1),Dn(this,"dataType","text"),Dn(this,"headers",!1),Dn(this,"contentType","application/x-www-form-urlencoded; charset=UTF-8"),Dn(this,"beforeSend",!1),Dn(this,"afterSend",!1),Dn(this,"timeout",0),Dn(this,"cache",!0),Dn(this,"crossDomain",!1),Dn(this,"retry",0)}return g(y,[{key:"setRequestHeader",value:function(C,x){this.headers[C]=x}},{key:"getAllResponseHeaders",value:function(){return 2===this.state?this.responseHeadersString:null}},{key:"getNativeXhr",value:function(){return this.nativeXhr}},{key:"getResponseHeader",value:function(C){var x,w;if(C=C.toLowerCase(),2===this.state){if(!(w=this.responseHeaders))for(w=this.responseHeaders={};x=cVe.exec(this.responseHeadersString);)w[x[1].toLowerCase()]=x[2];x=w[C]}return void 0===x?null:x}},{key:"overrideMimeType",value:function(C){return this.state||(this.mimeType=C),this}},{key:"abort",value:function(C){return this.state=3,this.status=0,this.statusText=null!=C?C:"abort",this.nativeXhr&&this.nativeXhr.abort(),this._callback(),this}},{key:"_ioReady",value:function(C,x){var w=!1,T=this;if(2!==this.state&&3!==this.state){1===this.state&&(this.state=2),this.readyState=4,C>=200&&C<300||304===C?304===C?(x="not modified",w=!0):(x="success",w=!0):C<0&&(C=0);try{C>=200&&this.handleResponseData()}catch(A){df(A,"error"),x=A.message||"parser error"}return(C<200||!w)&&this.retry>0?(this.retry=this.retry-1,void setTimeout(function(){T.sendInternal()},200)):(this.status=C,this.statusText=x,this._callback(w),w)}}},{key:"_callback",value:function(C){var x=this,w=this.timeoutTimer;w&&(clearTimeout(w),this.timeoutTimer=0),bA([C?this.onSuccess:this.onError,this.onComplete],function(T){m7(T)&&T.apply(x.context,[x.responseData,x.statusText,x])}),this.responseData=null}},{key:"handleResponseData",value:function(){var C,x=this.dataType,w=this.nativeXhr;if("blob"===x||"arraybuffer"===x)if(y7){var T,A,D;if("responseBody"in w)A=hm.dsVbsBinGetLength(T=w.responseBody),C=new hm.VBArray(hm.dsVbsBinGetBytes(T,0,A)).toArray();else for(C=[],A=(T=w.responseText).length,D=0;D<A;++D)C.push(255&T.charCodeAt(D));T=null}else C=hm.Blob?w.response:"responseBody"in w?w.responseBody:w.responseText;else if("json"==x)C=w.responseType&&"json"==w.responseType.toLowerCase()?w.response:U.parse(w.responseText?w.responseText:w.response);else if("user-defined"===x)C=void 0!==w.response?w.response:w.responseText;else{this.responseText=C=w.responseText||"";try{var M=w.responseXML;M&&M.documentElement&&(this.responseXML=M)}catch(B){}}this.responseData=C}},{key:"sendInternal",value:function(C){var x,w,T,A,D,M,B,H,Y,G,q,re=this;if(w=(x=this._setup(C)).method,v7(w)&&(w=w.toUpperCase()),D=x.contentType,A=x.dataType,H=x.mimeType,v7(T=x.url)&&(this.nativeXhr=M=aVe(x.crossDomain),M)){try{if(this.state=1,x.username?M.open(w,T,x.async,x.username,x.password):M.open(w,T,x.async),(x.async||de.bIE)&&A&&"user-defined"!=A&&"responseType"in M)try{M.responseType=A}catch(se){}}catch(se){return void(this.state<2?(df(se,"error"),this._ioReady(-1,"open error: "+(U.isNumber(se.number)?"("+se.number+")":"")+(se.message||""))):df(se))}"withCredentials"in(B=x.xhrFields||{})&&(sVe||delete B.withCredentials),bA(B,function(se,ce){try{M[ce]=se}catch(ve){df(ve)}}),H&&M.overrideMimeType&&M.overrideMimeType(H),!1===(Y=x.headers||{})["X-Requested-With"]&&delete Y["X-Requested-With"],"setRequestHeader"in M&&(D&&M.setRequestHeader("Content-Type",x.contentType),M.setRequestHeader("Accept",A&&b7[A]?b7[A]+("*"===A?"":", */*; q=0.01"):b7["*"]),bA(Y,function(se,ce){M.setRequestHeader(ce,se)})),"GET"!=w||x.cache||(M.setRequestHeader("If-Modified-Since","0"),M.setRequestHeader("Cache-Control","no-cache")),q=(G=!lVe.test(x.method))&&x.data||null,G&&y7&&(q=x.data),x.async&&x.timeout>0&&(x.timeout<300&&(x.timeout=300),this.timeoutTimer=setTimeout(function(){re.abort("timeout")},x.timeout));try{if(this.state=1,m7(this.beforeSend)&&!1===this.beforeSend(M,re))return void this.abort("cancel");M.send(q),q=null,x.data=null,m7(this.afterSend)&&this.afterSend(re)}catch(se){this.state<2?(df(se,"error"),this._ioReady(-1,"send error: "+(se.message||""))):df(se)}if(!x.async||4===M.readyState)return re._xhrCallback();M.onreadystatechange=function(){re._xhrCallback()}}}},{key:"_xhrCallback",value:function(C,x){var w,T=this.nativeXhr;try{if(4===T.readyState||x)if(T.onreadystatechange=x7,x)4!==T.readyState&&T.abort();else{this.responseHeadersString=T.getAllResponseHeaders();var A,D=T.status;try{A=T.statusText}catch(M){df("xhr statusText error: "),df(M),A=""}w=this._ioReady(D,A)}}catch(M){df(M,"error"),T.onreadystatechange=x7,x||this._ioReady(-1,M.message||"process error")}return w}},{key:"_setup",value:function(C){var x,w,T,A,D;if(C){for(w in this.context=C.context,delete C.context,C instanceof y&&(C=C.config),this.config=C,U.startsWith(A=C.url,"//")&&(C.url=A="http:"+A),(U.startsWith(A,"http://")||U.startsWith(A,"https://"))&&(D=new g7(A)),x=C.dataType?C.dataType.toLowerCase():"text",C.dataType=x,C.method=C.method?C.method.toUpperCase():"GET",D&&!("crossDomain"in C)&&(C.crossDomain=!D.isSameOriginAs(_7)),T=C.headers)void 0===T[w]&&delete T[w];U.mix(this,C)}return this.state=1,this}},{key:"dispose",value:function(){this.responseHeaders=null,this.responseHeadersString=null,this.responseData=null,this.responseText=null,this.responseXML=null,this.context=null,this.config=null,this.onSuccess=null,this.onError=null,this.onComplete=null,this.xhrFields=null,this.data=null,this.headers=null,this.beforeSend=null,this.afterSend=null}}])}();function ru(y){if(y&&v7(y.url)){var C=new uVe;return y.async?(y.async=!0,C.sendInternal(y),C):(y.async=!1,C.sendInternal(y))}U.log("the url is error.")}var hf,Rn,td="18",xA="5",fm="0312",w7="5",S7="0",wA="".concat(td,",").concat(xA,",").concat("0",",").concat(fm),hVe="".concat(td,",").concat(w7,",").concat(S7,",").concat("0312"),T7=parseInt(td),I7=parseInt(xA),E7=parseInt("0"),$ae=[T7,I7,E7,fm],qae=[T7,I7,E7,fm],Kae=[T7,I7,E7,fm],Jae=[1,8,5,fm],Qae=[1,8,5,fm],Zae=[1,8,5,fm];function ele(){if(!de.bWin){if(de.bMac)return qae;if(de.bLinux)return Kae}return $ae}function D7(){if(!de.bWin){if(de.bMac)return Qae;if(de.bLinux)return Zae}return Jae}function SA(){return"dcp/dwasm2_"+U1()}function U1(){return ele().join("")}function pS(){var y=Ce.DWT.ServiceInstallerLocation;return U.isString(y)&&y.length>0?("/"!=y[y.length-1]&&(y+="/"),y):(U.isString(y=Ce.DWT.ResourcesPath)&&y.length>0?"/"!=y[y.length-1]&&(y+="/"):y="Resources/",y+"dist/")}(function(y){y.enumUnknown=-1,y.enumChrome=1,y.enumFirefox=2,y.enumEdge=3,y.enumSafari=4,y.enumIE=5,y.enumOpera=6,y.enumHuaWeiBrowser=7})(hf||(hf={})),function(y){y.enumUnknown=-1,y.enumWindow=0,y.enumMac=1,y.enumLinux=2,y.enumEmbed=3,y.enumChromeOS=4,y.enumHarmonyOS=5,y.enumAndroid=6,y.enumiOS=7}(Rn||(Rn={}));var ou,Hl={getDSPath:function(y){var C=pS(),x=y;return x||(x=de.bWin?".msi":de.bMac?".pkg":Ce.navInfo.bArm64?"-arm64.deb":Ce.navInfo.bMips64?"-mips64el.deb":Ce.navInfo.bAndroid?".apk":de.bLinux||de.bChromeOS||de.bHarmonyOS?".deb":".msi"),[C,"DynamsoftServiceSetup",x].join("")},getLinuxHTML5DebPath:function(){return Hl.getDSPath(".deb")},getLinuxHTML5RpmPath:function(){return Hl.getDSPath(".rpm")},getEnumPlatform:function(){return de.bAndroid?Rn.enumAndroid:de.bMac?Rn.enumMac:de.bChromeOS?Rn.enumChromeOS:de.bHarmonyOS?Rn.enumHarmonyOS:Ce.navInfo.bEmbed?Rn.enumEmbed:de.bLinux?Rn.enumLinux:de.biPhone||de.biPad?Rn.enumiOS:Rn.enumWindow},getEnumBrowser:function(){return de.bEdge?hf.enumEdge:de.bChrome?hf.enumChrome:de.bFirefox?hf.enumFirefox:de.bIE?hf.enumIE:de.bSafari?hf.enumSafari:de.bHuaWeiBrowser?hf.enumHuaWeiBrowser:de.bOpera?hf.enumOpera:hf.enumUnknown}};!function(y){y.NONE=0,y.TRACE=1,y.DEBUG=2,y.INFO=4,y.WARN=8,y.ERROR=16}(ou||(ou={}));var gS=U.getLogger(),V1=g(function y(){l(this,y)},null,[{key:"LogLevel",get:function(){return this._logLevel},set:function(y){this._logLevel=y}},{key:"LogFunc",set:function(y){this._logFunc=y}},{key:"all",value:function(y,C){if((this._logLevel&y)==y)if(this._logFunc)this._logFunc(C,y);else switch(y){case ou.DEBUG:gS.debug(C);break;case ou.ERROR:gS.error(C);break;case ou.INFO:gS.info(C);break;case ou.WARN:gS.warn(C);break;case ou.TRACE:gS.trace(C)}}},{key:"trace",value:function(y){this.all(ou.TRACE,y)}},{key:"debug",value:function(y){this.all(ou.DEBUG,y)}},{key:"info",value:function(y){this.all(ou.INFO,y)}},{key:"warn",value:function(y){this.all(ou.WARN,y)}},{key:"error",value:function(y){this.all(ou.ERROR,y)}}]);function Fr(y){var C;window.console&&(y instanceof Error||U.isString(y)?(C=y,Ce.navInfoSync.bIE&&(C=U.stringify(y))):C=U.stringify(y),window.console.error(C))}Dn(V1,"_logLevel",ou.ERROR),Dn(V1,"_logFunc",void 0);var tle,j1="127.0.0.1";de.bIE&&de.bSSL?j1="localhost":de.bAndroid&&(j1="local.dynamsoft.com"),tle="0"==S7.toLowerCase()?"Dynamic Web TWAIN "+[td,w7].join("."):"Dynamic Web TWAIN "+[td,w7,S7].join(".");var su={JSVersion:hVe,ServerVersionInfo:wA,ServerLinuxVersionInfo:wA,ServerMacVersionInfo:wA,ServerAndroidVersionInfo:wA,ActiveXVersion:"18,0,0,1025",ActiveXPdfVersion:"11.5.2.0312",PdfVersion:"11.5.2.0312",PdfLinuxVersion:"11.5.2.0312",PdfMacVersion:"11.5.2.0312"},fVe={ProductName:tle,Containers:void 0,ContainerMap:{},WebTwainIdMap:{},RemoteScanIdMap:{},Trial:!1,ResourcesPath:"Resources",Debug:!1,IfUpdateService:!1,AutoLoad:!0,ReConnectToService:!0,OnWebTwainReady:!1,OnWebTwainError:function(y){Fr(y)},OnWebTwainNotFound:!1,OnWebTwainOldPluginNotAllowed:!1,OnWebTwainNeedUpgrade:!1,OnWebTwainNeedUpgradeWebJavascript:!1,OnWebTwainInitMessage:!1,ViewerJSIntegerited:!0,ActiveXInstallWithCAB:!1,IfUseActiveXForIE10Plus:!1,IfUseEmbeddedDownloadNoticeForActiveX:!1,IfCheckDCP:!1,IfDisableDefaultSettings:!1,OnWebTwainWillInit:!1,IfAddMD5InUploadHeader:!1,IfAlwaysFocusOnPopupWindow:!0,IfConfineMaskWithinTheViewer:!1,fetchOptions:{mode:"cors",credentials:"same-origin"},HideTrialMessage:!1,CheckCertExpired:!0,ConnectWithSocket:!1,SSLPort:18623,Port:18622,showLoadingMsgDialog:!0,licenseServer:void 0,sessionPassword:void 0,organizationID:void 0,handshakeCode:void 0,UseDefaultViewer:!0,Host:j1,DeviceFriendlyName:"",LocalHosts:["127.0.0.1","localhost","local.dynamsoftwebtwain.com","local.dynamsoft.com"],IfCheckCORS:!1,IfCheckCert:!0};function Ya(){var y=Ce.DWT.Host;return U.isString(y)&&""!=y||(Ce.DWT.Host=y=j1),y}function pVe(){var y=300,C=Ce.DWT.RemoteScanConfig;return C&&U.isNumber(C.sessionTimeout)&&C.sessionTimeout>0&&(y=C.sessionTimeout),y}var A7={URL:"",UpdateDaysBeforeExpired:30},pm=de.bHTML5Edition,R7=0,IA=!1;de.bIE&&(""===(R7=de.IEVersion)||R7>=10?Ce.DWT.IfUseActiveXForIE10Plus?(IA=!0,de.bHTML5Edition=pm=!1):pm=!0:(pm=!1,R7>=9&&(IA=!0))),IA||pm||(pm=!0);var Qs,Xn,k7,mS,$n={SSLPort:18626,Port:18625,bEnhancedMode:!1,oldDWASMVerStr:"dwasm_13000404",oldDWASMVer:[13,0,0,"0404"],wsProtocol:"dwt_command",managerVersion:$ae,managerVersionMac:qae,managerVersionLinux:Kae,serviceVersion:Jae,serviceVersionMac:Qae,serviceVersionLinux:Zae,detect:{dcpStatus:0,ddmPort:0,dwtPort:0,dwtSSLPort:0,bConnected:!1,connectedResult:"",MaxManagerModuleConnectCount:1,EnumDCP_DetectStatus:{Init:0,Connected:1,CheckingManagerVer:15,CheckingServiceVer:16,NotInstalled:17,CheckedService:5,VerifyingZip:6,VerifiedZip:7,UpdatingService:8,UpdateSucceed:9,UpdateFailed:10,UpdateSkipped:11}},strSID:"",b64bit:!0,objEnhancedPorts:{}},St={name:"Dynamic Web TWAIN",bHTML5Edition:pm,bActiveXEdition:IA,_iImageCaptureDriverType:3,_iBrokerProcessType:1,getChromeEditionPath:Hl.getDSPath,getPKGPath:function(){return pS()+"DynamicWebTWAINMacEdition.pkg"},getMSIPath:function(){return pS()+"DynamicWebTWAINPlugIn.msi"},getActiveXCABx86Path:function(){return pS()+"DynamicWebTWAIN.cab"},getActiveXCABx64Path:function(){return pS()+"DynamicWebTWAINx64.cab"},onlineResources:"https://demo.dynamsoft.com/DWT/Resources/",strMIMEType:"Application/DynamicWebTwain-Plugin",strFullClassID:"E7DA7F8D-27AB-4EE9-8FC0-3FEC9ECFE758",scripts:{},dwtConfigLoaded:!1,dwtConfigLoading:!1,getServerVersionInfo:function(y){var C=su.ServerVersionInfo;return de.bWin||(de.bMac?C=su.ServerMacVersionInfo:de.bAndroid?C=su.ServerAndroidVersionInfo:(de.bLinux||de.bChromeOS||de.bHarmonyOS)&&(C=su.ServerLinuxVersionInfo)),y?C:U.replaceAll(C,",","")},getDWTPrefix:function(){return!0===Ce.DWT.CustomMode?"dwtc_":"dwt_"},loadResourcePath:!1,loadingResourcePath:!1,handshakeCode:void 0,organizationID:void 0,licenseServer:void 0,sessionPassword:"",bPublicLTS:!0,refProductKey:void 0,ltsDebug:!1,bDWTLoading:!1,bDWTUnloading:!1,bAndroidConnected:!1,unloadQueue:[],appendBrowserLicenseWhenServiceMode:function(){},bDCPChecked:!1,bDWTChecked:!1,bChromeEdition:pm},xo={bFullEdition:!1,getVersionStrForCheck:function(){return"".concat(td,"000000")},versionInfoFromServer:"",hostForCheckCert:j1,RemoteReconnectMaxTimes:200,RemoteReconnectTimeSpan:5e3,LocalReconnectMaxTimes:60,LocaleReconnectTimeSpan:3e3},vS=de.bSSL?3e3:1e3,M7=de.bSSL?1e3:600;function Xa(){return U.isString(St.handshakeCode)||U.isString(St.organizationID)||St.bPublicLTS||U.isString(Ce.DWT.ProductKey)&&U.startsWith(Ce.DWT.ProductKey,"DLS2")}function mc(y){if(void 0===y)return!0;var C;if(y)for(C=0;C<Ce.DWT.LocalHosts.length;C++)if(y===Ce.DWT.LocalHosts[C])return!0;return!1}function wt(y,C,x){y._errorCode=C,y._errorString=x}function Ao(y){var C=Ce.DWT.licenseException;C.code=y._errorCode,C.message=y._errorString,C.fromLTS=!1}function Zs(){return Ce.DWT.bChromeExtension?"":"Please contact the site administrator."}function Jn(y){wt(y,-1033,"Invalid index.")}function da(y){wt(y,-1034,"Invalid value.")}function ea(y){wt(y,-1035,"There is no image.")}function nle(y){wt(y,-1110,"Unrecognized file extension.")}function ile(y){wt(y,-2007,"The system is busy, some operations are not completed. Please try later.")}function H1(y,C){var x=C?["[",C,"]"].join(""):"your device";wt(y,Xn.MustUpgrade,"The Dynamsoft Service installed on "+x+" is outdated and no longer works with the JavaScript code on the website.")}function yS(y){wt(y,-2209,"The HTML5 edition does not support this method or property.")}function O7(y){wt(y,-2300,"Http upload error: the HTTP Server name/ip cannot be empty.")}function EA(y){wt(y,-2301,"Network error.")}function F7(y){wt(y,-2302,"The result format is invalid.")}function L7(y,C,x,w){if(C)lu(y);else if(y._errorCode=-2003,w&&w>0||x){var T=["HTTP process error: "];x&&(x.indexOf("HTTP process error: ")>=0&&(T=[""]),T.push(x)),w&&w>0&&T.push(" ("+w+")");var A=T.toString().lastIndexOf(".");y._errorString=A>=0&&A==T.toString().length-1?T.join(""):T.join("")+"."}else y._errorString="HTTP process error."}function rle(y){wt(y,-2304,"Http download error: the url is invalid.")}function ole(y,C,x,w){if(C)wt(y,-2305,"User cancelled the operation.");else if(y._errorCode=-2003,w&&w>0||x){var T=["HTTP put error: "];x&&(x.indexOf("HTTP put error: ")>=0&&(T=[""]),T.push(x));var A=T.toString().lastIndexOf(".");y._errorString=A>=0&&A==T.toString().length-1?T.join(""):T.join("")+"."}else y._errorString="HTTP put error."}function N7(y,C,x,w){if(C)wt(y,-2305,"User cancelled the operation.");else if(y._errorCode=-2003,w&&w>0||x){var T=["HTTP process error: "];x&&(x.indexOf("HTTP process error: ")>=0&&(T=[""]),T.push(x));var A=T.toString().lastIndexOf(".");y._errorString=A>=0&&A==T.toString().length-1?T.join(""):T.join("")+"."}else y._errorString="HTTP process error."}function ns(y){wt(y,-2306,"Upload Error: the upload file cannot be empty.")}function sle(y){wt(y,-2307,"The width or height you entered is invalid.")}function ff(y){wt(y,-2313,"The size of the images you are about to upload has exceeded the limit.")}function _l(y){wt(y,-2314,"The parameter cannot be empty.")}function h0(y){wt(y,-2320,"Invalid file.")}function au(y){wt(y,Qs.LicenseInvalid,Xa()?"The license is invalid.":"The current product key is empty or invalid."),Ao(y)}function ale(y,C){y._errorCode=Qs.LicenseExpired;var w,T,A,D,x="";C&&""!=C&&(-1==C.indexOf("on")&&(x=" on "+C),y.__licenseInfo&&(y.__licenseInfo.ExpireDate=C)),Xa()?(w=Ce.DWT.EnumInstance.dwt_desktop,T=y._bRemoteMode&&null!==(A=null===(D=y._dmService)||void 0===D||null===(D=D.attrs)||void 0===D?void 0:D.UUID)&&void 0!==A?A:"",y._errorString="The license has expired"+x+". Please contact the application developer.",Ce.DWT.lcexp(w,T).then(function(){y._errorString=Ce.DWT.licenseException.message})):(y._errorString="The current product key has expired"+x+". Please contact the application developer.",Ao(y))}function _S(y,C){Xa()?111==C?(y._errorCode=Qs.LicenseExpiredForDLS,y._errorString="The license for v"+td+" Service Core Module has expired."):(y._errorCode=Qs.LicenseNoCoreForDLS,y._errorString="The license for v"+td+" Service Core Module is not found."):(y._errorCode=Qs.LicenseNoCore,y._errorString="The current product key is missing the Service Core license. "+Zs()),Ao(y)}function G1(y){y._errorCode=-2339,y._errorString=Xa()?"The license for the module pdf rasterizer is not found or has expired.":"The current product key does not support pdf rasterizer. "+Zs(),Ao(y)}function z1(y){wt(y,-2351,"You cannot upload more than one image when the format is BMP, JPG or PNG")}function lle(y){wt(y,-2352,"The indices are out of range.")}function gVe(y){wt(y,-2353,"The header name being used is a protected keyword and is not allowed.")}function Y1(y){wt(y,-2358,"The type of the parameter indices must be an Array.")}function kt(y){wt(y,-2359,"The index is out of range.")}function cle(y){wt(y,-2360,"The index is null or undefined.")}function Gl(y){wt(y,-2362,"The image type is not supported.")}function ule(y){wt(y,-2363,"The data format is not supported.")}function CS(y){wt(y,-2365,"The url is invalid.")}function B7(y){wt(y,-2376,"The generate url failed.")}function DA(y){wt(y,-2377,"Failed to set Image Capture Driver Type.")}function dle(y){wt(y,-2391,"Invalid event name.")}function hle(y){wt(y,-2393,"Failed to convert the data to blob.")}function fle(y){wt(y,-2399,"Invalid imageId.")}function Wi(y){wt(y,-2416,"Invalid parameter.")}function mVe(y){wt(y,-2426,"You have used a full license with a trial license which is not permitted. Please check and update Dynamsoft.DWT.ProductKey.")}function ple(y){wt(y,-2510,"The callback is not a function.")}function gle(y){wt(y,-2513,"The WebTwain instance has been destroyed and can not be used anymore.")}function W7(y){wt(y,-2530,"Document name cannot be empty.")}function bS(y){wt(y,-2531,"Document name is not a string.")}function AA(y){wt(y,-2548,"You cannot call this function when Dynamsoft.DWT.UseDefaultViewer is set to false.")}function U7(y){wt(y,-2549,"You cannot call this function when there is no ui binding.")}function is(y){wt(y,0,"")}function mle(y){var C=y;return C||(C="[]"),{code:-2601,message:"Failed to connect to the Dynamsoft Service on "+C+". Please make sure Dynamsoft Service is running or the certificate is valid."}}function vle(y){var C;return y._bRemoteMode?mle(null===(C=y._dmService)||void 0===C||null===(C=C.attrs)||void 0===C?void 0:C.name).message:"The Dynamsoft Service has been stopped."}function yle(y){wt(y,-2607,"The device selected was not found under the current service object.")}function V7(y){wt(y,-2608,"IfShowFileDialog cannot be set to true when Object is created by CreateRemoteScanObjectAsync.")}function f0(y,C){U.isString(C)&&""!=C?wt(y,Xn.RemoteDynamsoftServiceStopped,"The Dynamsoft Service on ["+C+"] has been stopped."):wt(y,-2308,"The Dynamsoft Service has been stopped.")}function lu(y){wt(y,-2615,"User cancelled the operation.")}function vVe(y){wt(y,-2616,"Invalid image format type.")}function yVe(y){wt(y,-2618,"Only single index selection is allowed when enumImageType is set to BMP, JPG or PNG.")}function vc(y){wt(y,-2620,"The RemoteScan object has been disposed.")}function _le(y){wt(y,-2621,"Dynamsoft.DWT.Containers was not set.")}function Cle(y){wt(y,-2622,'Please do not set enumImageType to "IT_MULTIPAGE_PDF", "IT_MULTIPAGE_TIF" or "IT_ALL".')}function _Ve(y){wt(y,-2624,"The element within Dynamsoft.DWT.Containers should be a valid object.")}function xS(y){wt(y,-2800,"Please make sure the Dynamsoft Service has been installed.")}function zl(y){wt(y,Xn.ResponseDataTypeError,"Invalid response data was returned from the Dynamsoft Service.")}function ble(y){return{code:-2807,message:'Error: The element specified by the id "'+y+"\" doesn't exist."}}function CVe(y,C){wt(y,-2811,C)}function xle(y){wt(y,-2812,"Error: Duplicate WebTwainId detected while creating a Dynamic Web TWAIN object.")}function wle(y){wt(y,-2815,"Error: Duplicate ContainerId detected while creating a Dynamic Web TWAIN object.")}function Sle(y,C,x){wt(y,-2816,["HTTP process error: ",x," (",C,")."].join(""))}function Tle(){return{code:Xn.HTSTError,message:"The Connection from the insecure (HTTP) web page failed for HTST."}}function j7(){return{code:Xn.DWTPortNotReady,message:"The Dynamsoft Service is not ready, please try again later."}}function bVe(y){return{code:-2826,message:"Failed to connect the Dynamsoft Service on ["+y+"]."}}function H7(y){wt(y,-2828,"Invalid PDF Convert Mode Value.")}function xVe(y){wt(y,-2848,"The capability value is out of range.")}function Ile(y){wt(y,-2854,"The imageId does not exist.")}function wVe(y){wt(y,-2855,"The blob cannot be empty.")}function SVe(y){wt(y,-2856,"Invalid blob value.")}function PA(y){wt(y,-2901,"Source document does not exist. Please check the document name or create the document before performing this operation.")}function RA(y){wt(y,-2902,"Target document does not exist. Please check the document name or create the document before performing this operation.")}(function(y){y.LicenseInvalid=-2325,y.LicenseExpired=-2326,y.LicenseParseFailed=-2546,y.LicenseExpiredForDLS=-2808,y.LicenseNoCoreForDLS=-2809,y.LicenseNoCore=-2810,y.LicenseIsFuture=-2396,y.LicenseVersionNotCurrent=-2539})(Qs||(Qs={})),Ce.DWT.EnumDWT_LicenseErrorCode=Qs,function(y){y.UserCancelled=-1032,y.CORSErrorFromService=-2137,y.CommonError=-2201,y.ModuleNotExists=-2371,y.MustUpgrade=-2207,y.RemoteDynamsoftServiceStopped=-2613,y.ResponseDataTypeError=-2801,y.HTSTError=-2817,y.SSLCertExpired=-2818,y.SSLCertInvalid=-2819,y.CORSError=-2820,y.DWTPortNotReady=-2821,y.HTTPRedirected=-2823,y.BboError=-2827}(Xn||(Xn={}));var Ele=de.bIE&&de.IEVersion<=9;k7=self&&self.fetch?self.fetch:window.fetch;var kA=0;function G7(y,C){var x,w=!1;return kA=C,k7?x=function(T,A){var D=!1,M="text",B=!1;if(A&&(A.dataType&&(M=A.dataType),A.fetchRaw&&(B=!0),A.timeout)){var H=A.timeout;H<300&&(H=300);var Y=new AbortController;A.signal=Y.signal,setTimeout(function(){D||Y.abort()},H)}w=!1;var G=k7(T,A).then(function(q){if(q.ok){var re,se;if(D=!0,!y)return q;if(y.__clickCancel)return y.__clickCancel=!1,y.__cancelBeforObjectCreated=!1,w=!0,q;y.IfShowCancelDialogWhenImageTransfer?(Mp(!0),se=y.on("cancel",function(){w=!0})):Mp(!1);var ce=q.headers.get("Content-Length"),ve=0;y._onPercent&&kA==C&&y._onPercent({loaded:ve,total:ce});var Te=null==q||null===(re=q.body)||void 0===re?void 0:re.getReader(),Ue=new ReadableStream({start:function(Oe){Te?setTimeout(function He(){return Te.read().then(function(we){if(we.done||w)return w?Te.cancel():se&&y.off("cancel",se),Oe.close(),void(se=null);var ue=we.value;ve+=ue.length,y._onPercent&&kA==C&&y._onPercent({loaded:ve,total:ce});try{return Oe.enqueue(ue),He()}catch(pe){U.error(pe)}})},0):Oe.close()}}),je=q.headers.get("Content-Type");return je&&""!=je||(je="application/octet-stream"),new Response(Ue,{headers:{"Content-Type":je}})}if("opaqueredirect"==q.type)throw{code:Xn.HTTPRedirected,message:"The http url redirected."};var Ee;throw Sle(Ee={},q.status,q.statusText),{code:Ee._errorCode,message:Ee._errorString,httpCode:q.status}});return B?G:(G=G.then("blob"==M?function(q){var re=q.headers.get("content-type");return"text/json"==re?q.json():de.bLinux?q.arrayBuffer().then(function(se){return new Blob([se],{type:re})}):q.blob()}:"json"==M?function(q){return q.json()}:"arraybuffer"==M?function(q){return"text/json"==q.headers.get("content-type")?q.json():q.arrayBuffer()}:function(q){return q.text()})).then(function(q){var re;if(w)throw lu(re={}),{code:re._errorCode,message:re._errorString};return q})}:(Ele&&U.addVBS(["Function dsVbsBinGetAt(strBinary,iOffset)\r\n"," dsVbsBinGetAt=AscB(MidB(strBinary,iOffset+1,1))\r\n","End Function\r\n","Function dsVbsBinGetBytes(strBinary,iOffset,iLength)\r\n"," Dim aBytes()\r\n"," ReDim aBytes(iLength-1)\r\n"," For i=0 To iLength-1\r\n","  aBytes(i)=dsVbsBinGetAt(strBinary,iOffset+i)\r\n"," Next\r\n"," dsVbsBinGetBytes=aBytes\r\n","End Function\r\n","Function dsVbsBinGetLength(strBinary)\r\n"," dsVbsBinGetLength=LenB(strBinary)\r\n","End Function"].join("")),x=function(T,A){return new(ge.nativePromise||window.Promise)(function(D,M){var B,H=!1;B={url:T,async:!0,onSuccess:function(G,q,re){var se=!1;if(re.responseHeadersString&&-1!=re.responseHeadersString.indexOf("text/json")&&(U.isArray(G)||G instanceof ArrayBuffer)&&(se=!0),se){var ce=G;G instanceof ArrayBuffer&&(ce=new Uint8Array(G));var ve=String.fromCharCode.apply(null,ce);D(ve)}else D(G)},onError:function(G,q,re){var se;Sle(se={},re.status,q),M({code:se._errorCode,message:se._errorString,httpCode:re.status})},dataType:"text",method:mS,data:mS,headers:mS,contentType:mS,mimeType:mS},A&&(A.method&&(B.method=A.method),A.body&&(B.data=A.body),A.headers&&(B.headers||(B.headers={}),U.each(A.headers,function(G,q){"content-type"==q.toLowerCase()&&(H=!0),B.headers[q]=G})),A.dataType&&(B.dataType=A.dataType),A.contentType&&(B.contentType=A.contentType),U.isNumber(A.timeout)&&A.timeout>0&&(B.timeout=A.timeout)),H&&(B.contentType=!1),"blob"==B.dataType&&Ele&&(B.mimeType="text/plain; charset=x-user-defined"),y&&(y._onPercent&&(B.beforeSend=function(G,q,re){G.upload.addEventListener("progress",function(se){y._onPercent&&kA==C&&y._onPercent(se)},!1)}),Mp(!!y.IfShowCancelDialogWhenImageTransfer));var Y=ru(B);y&&y.IfShowCancelDialogWhenImageTransfer&&y.on("cancel",function(){Y.abort()})})}),x}var X1=G7(null,0);function Mp(y){var C=U.sizzle(".dynamsoft-btnCancel");C.length>0&&(C[0].style.display=y?"":"none")}function Dle(y,C,x,w,T,A,D){try{var M=y[A](D),B=M.value}catch(H){return void x(H)}M.done?C(B):Promise.resolve(B).then(w,T)}function yt(y){return function(){var C=this,x=arguments;return new Promise(function(w,T){var A=y.apply(C,x);function D(B){Dle(A,w,T,D,M,"next",B)}function M(B){Dle(A,w,T,D,M,"throw",B)}D(void 0)})}}String.prototype.startsWith||(String.prototype.startsWith=function(y){return 0==this.indexOf(y)});var cu,p0,Ale=function(y){var C,x=y,w=x._license||"",T=JSON.parse(JSON.stringify(x._licenseServer)),A=x._sessionPassword,D=0;if(w.startsWith("t")||w.startsWith("f"))D=0;else if(0===w.length||w.startsWith("P")||w.startsWith("L")||w.startsWith("Y")||w.startsWith("A"))D=1;else{D=2;var M=w.indexOf(":");if(-1!=M&&(w=w.substring(M+1)),w.startsWith("DLS2")){var B;try{var H=w.substring(4);H=Ie.Lib.atob(H),B=JSON.parse(H)}catch(G){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if("number"==typeof(w=B.handshakeCode?B.handshakeCode:B.organizationID?B.organizationID:"")&&(w=JSON.stringify(w)),0===T.length){var Y=[];B.mainServerURL&&(Y[0]=B.mainServerURL),B.standbyServerURL&&(Y[1]=B.standbyServerURL),T=function(G){if(null==G)G=[];else{G instanceof Array||(G=[G]);for(var q=0;q<G.length;++q){if(document&&document.createElement){var re=document.createElement("a");re.href=G[q],G[q]=re.href}G[q].lastIndexOf("/")!=G[q].length-1&&(G[q]+="/")}}return G}(Y)}!A&&B.sessionPassword&&(A=B.sessionPassword),C=B.remark}("200001"===w||w.startsWith("200001-"))&&(T&&T.length||(w="")),w||(D=1)}return 1===D&&(w=""),{lt:D,l:w,ls:T,sp:A,rmk:C}},g0=g(function y(C,x,w,T,A){l(this,y),this.server=C,this.port=x,this.ssl=w,this.useWS=T,this.protocol=A});function Ple(y,C){return(null==y?void 0:y.port)==(null==C?void 0:C.port)&&(null==y?void 0:y.protocol)==(null==C?void 0:C.protocol)&&(null==y?void 0:y.server)==(null==C?void 0:C.server)&&(null==y?void 0:y.ssl)==(null==C?void 0:C.ssl)&&(null==y?void 0:y.useWS)==(null==C?void 0:C.useWS)}function $a(y,C){if(C&&("object"===p(C)||"function"==typeof C))return C;if(void 0!==C)throw new TypeError("Derived constructors may only return object or undefined");return function(x){if(void 0===x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return x}(y)}function qn(y){return(qn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(C){return C.__proto__||Object.getPrototypeOf(C)})(y)}function z7(y,C){return(z7=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,w){return x.__proto__=w,x})(y,C)}function qa(y,C){if("function"!=typeof C&&null!==C)throw new TypeError("Super expression must either be null or a function");y.prototype=Object.create(C&&C.prototype,{constructor:{value:y,writable:!0,configurable:!0}}),Object.defineProperty(y,"prototype",{writable:!1}),C&&z7(y,C)}(function(y){y.OK=0,y.Custom=-1,y.NWB=-4200,y.WS_DISCONN=-4201,y.CB=-5e3,y.JSON_REQUIRED=-5001,y.OBJECT_DISPOSED=-5002,y.INVALID_TASK=-5003,y.OBJECT_DISPOSING=-5004})(cu||(cu={})),function(y){y.WS_DISCONN="The Web Socket connection failed.",y.JSON_REQUIRED="The input is not a JSON object or JSON styled string.",y.OBJECT_DISPOSED="The object has been disposed.",y.INVALID_TASK="The task is invalid.",y.OBJECT_DISPOSING="The object need to be disposed."}(p0||(p0={}));var Y7=g(function y(){l(this,y)},null,[{key:"message",value:function(y){return this._errorMessage[y]}},{key:"init",value:function(){this._errorMessage[cu.OK]="Successful.",this._errorMessage[cu.WS_DISCONN]=p0.WS_DISCONN,this._errorMessage[cu.JSON_REQUIRED]=p0.JSON_REQUIRED,this._errorMessage[cu.OBJECT_DISPOSED]=p0.OBJECT_DISPOSED,this._errorMessage[cu.INVALID_TASK]=p0.INVALID_TASK,this._errorMessage[cu.OBJECT_DISPOSING]=p0.OBJECT_DISPOSING}}]);Dn(Y7,"_errorMessage",Object.create(null)),Y7.init();var Jr,uu=g(function y(C,x){l(this,y),Dn(this,"_code",cu.OK),this.name="DSError",this.message=null!=x?x:"string"==typeof C?C:Y7.message(C),this._code="string"==typeof C?cu.Custom:C},[{key:"code",get:function(){return this._code}}]);function Qi(y){return{code:y._errorCode,message:y._errorString}}function yc(y){return"exception"in y&&"description"in y&&0!=y.exception&&""!=y.description}function Rle(y){return-1416==y}!function(y){y.GET_TASKID=0,y.GET_EVENT_TASKID=1,y.ONMESSAGE_PROCESS_DATA=2,y.ONMESSAGE_GET_TASKID=3,y.ONMESSAGE_GET_EVENT_TASKID=4,y.HANDLE_RAW_MESSAGE=5,y.HANDLE_PROCESSED_MESSAGE=6}(Jr||(Jr={}));var kle=function(){return g(function T(A){l(this,T),Dn(this,"_serverInfo",void 0),Dn(this,"_disposed",!1),this._serverInfo=A,this._ref=1},[{key:"serverInfo",get:function(){return this._serverInfo}},{key:"requestSync",value:function(T,A){V1.error("requestSync should be implemented in child class")}},{key:"request",value:(T=yt(W.mark(function A(D,M,B,H){return W.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return V1.error("request should be implemented in child class"),Y.abrupt("return",null);case 2:case"end":return Y.stop()}},A)})),function(A,D,M,B){return T.apply(this,arguments)})},{key:"send",value:(w=yt(W.mark(function T(A,D,M){return W.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:V1.error("reqsenduestSync should be implemented in child class");case 1:case"end":return B.stop()}},T)})),function(T,A,D){return w.apply(this,arguments)})},{key:"testConnection",value:(x=yt(W.mark(function T(A,D,M,B){return W.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return V1.error("testConnection should be implemented in child class"),H.abrupt("return");case 2:case"end":return H.stop()}},T)})),function(T,A,D,M){return x.apply(this,arguments)})},{key:"disposed",get:function(){return this._disposed}},{key:"dispose",value:(C=yt(W.mark(function T(){return W.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this._ref--,!(this._ref>0)){A.next=3;break}return A.abrupt("return",!1);case 3:return this._disposed=!0,A.next=6,this._terminate();case 6:case"end":return A.stop()}},T,this)})),function(){return C.apply(this,arguments)})},{key:"_terminate",value:(y=yt(W.mark(function T(){return W.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:case"end":return A.stop()}},T)})),function(){return y.apply(this,arguments)})},{key:"addRef",value:function(){this._ref++}}]);var T,y,C,x,w}();function Mle(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function X7(y,C,x){return C.has(y),x}var MA,Ole=U.getLogger(),Fle=new WeakSet,$7=new WeakSet,TVe=function(y){function C(){var T,B,H,Y;l(this,C);for(var A=arguments.length,D=new Array(A),M=0;M<A;M++)D[M]=arguments[M];return B=this,H=C,Y=[].concat(D),H=qn(H),Mle(T=$a(B,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(G){return!1}}()?Reflect.construct(H,Y||[],qn(B).constructor):H.apply(B,Y)),$7),Mle(T,Fle),T}return qa(C,y),g(C,[{key:"send",value:(w=yt(W.mark(function T(A,D,M){return W.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:Ole.error("HTTP Client send not supported");case 1:case"end":return B.stop()}},T)})),function(T,A,D){return w.apply(this,arguments)})},{key:"requestSync",value:function(T,A,D){}},{key:"request",value:function(T,A,D,M){return X7(this,$7,Lle).call(this,T,A,D,void 0,void 0,M)}},{key:"testConnection",value:(x=yt(W.mark(function T(A,D,M,B){return W.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",X7(this,$7,Lle).call(this,void 0,void 0,A,D,M,B));case 1:case"end":return H.stop()}},T,this)})),function(T,A,D,M){return x.apply(this,arguments)})}]);var x,w}(kle);function IVe(y){var C=this.serverInfo,x="";return x=C.ssl?"https://":"http://",x+=C.server,C.port&&(x+=":",x+=C.port),y&&(U.startsWith(y,"/")||U.endsWith(x,"/")||(x+="/"),U.endsWith(y,"/")?x+=y.slice(0,-1):x+=y),x}function Lle(y,C,x,w,T,A){return q7.apply(this,arguments)}function q7(){return q7=yt(W.mark(function y(C,x,w,T,A,D){var M,B;return W.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.prev=0,M=null!=w?w:{},C&&(M.body=C),M.method||(M.method="POST"),D&&(M.timeout=D),B=X7(this,Fle,IVe).call(this,x),Ole.debug("HTTP URL: "+B),H.next=9,X1(B,M);case 9:return H.abrupt("return",H.sent);case 12:if(H.prev=12,H.t0=H.catch(0),!(H.t0 instanceof uu||H.t0&&H.t0.code&&H.t0.message)){H.next=18;break}throw H.t0;case 18:if(!H.t0.message){H.next=20;break}throw new uu(H.t0.message);case 20:case"end":return H.stop()}},y,this,[[0,12]])})),q7.apply(this,arguments)}function EVe(y){try{return"object"===p(y)?y:(y="string"!=typeof y?U.stringify(y):y,U.parse(y))}catch(C){throw C instanceof uu?C:new uu(cu.JSON_REQUIRED)}}function wS(y){return Math.random().toString(16).substring(2,2+y)}function m0(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function pf(y,C,x){return C.has(y),x}var OA,Nle,Ka=U.getLogger(),Ble=new WeakSet,Wle=new WeakSet,Ule=new WeakSet,Vle=new WeakSet,FA=new WeakSet,K7=new WeakSet,jle=new WeakSet,J7=function(y){function C(A){var D,M,B,H;return l(this,C),M=this,H=[A],B=qn(B=C),m0(D=$a(M,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Y){return!1}}()?Reflect.construct(B,H||[],qn(M).constructor):B.apply(M,H)),jle),m0(D,K7),m0(D,FA),m0(D,Vle),m0(D,Ule),m0(D,Wle),m0(D,Ble),Dn(D,"_defaultRetries",1),Dn(D,"_ws",OA),Dn(D,"_events",{}),Dn(D,"_bHeartBeatStarted",!1),Dn(D,"_heartBeatTicks",6e4),D._ws=OA,D.bUseParentWS=!1,D._tasks=Object.create(null),D.bReady=!1,D._blob_callbacks=[],D._processing_blob=!1,D}return qa(C,y),g(C,[{key:"ws",get:function(){return this._ws}},{key:"requestSync",value:function(A,D,M){Ka.error("WebSocket Client requestSync not supported")}},{key:"send",value:(T=yt(W.mark(function A(D,M,B){var H,Y,G,q;return W.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(H=B.client,re.prev=1,void 0!==(Y=B.taskId)){re.next=7;break}return re.next=6,M(D,Jr.GET_TASKID,H._requestTaskId,B);case 6:Y=re.sent;case 7:if(G=H._tasks[Y]){re.next=11;break}throw Ka.error("invalid task id: "+Y),new uu(cu.INVALID_TASK);case 11:return re.next=13,pf(H,FA,eB).call(H,!1);case 13:return re.next=15,pf(H,K7,Hle).call(H,D,M,B,G);case 15:Ka.debug("begin to send data "+Y),H.disposed||H._ws.send(D),D=null,Ka.debug("end to send data "+Y),re.next=27;break;case 21:re.prev=21,re.t0=re.catch(1),Ka.debug("failed to send data."),Ka.error(re.t0),delete H._tasks[Y],null===(q=G)||void 0===q||null===(q=q.resolver)||void 0===q||q.reject(re.t0.message);case 27:case"end":return re.stop()}},A,null,[[1,21]])})),function(A,D,M){return T.apply(this,arguments)})},{key:"request",value:function(A,D,M,B){var H=this._defaultRetries,Y=null!=D?D:pf(this,Vle,kVe),G=null!=M?M:{client:this,userData:this};return pf(this,jle,MVe).call(this,A,Y,G,H,!1,void 0,B)}},{key:"connected",get:function(){var A;return(null===(A=this._ws)||void 0===A?void 0:A.readyState)==WebSocket.OPEN}},{key:"testConnection",value:function(A,D,M,B){return pf(this,FA,eB).call(this,!0,null!=D?D:0,M,B)}},{key:"_terminate",value:(w=yt(W.mark(function A(){var D,M;return W.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:for(M in Ka.debug("terminate WSClient"),this.fireEvent("disposed"),D=!1,this._tasks)void 0!==this._tasks[M]&&this._tasks[M].resolver&&(D=!0);if(this._lic_callback=OA,this._blob_callbacks=[],this._processing_blob=!1,this._ws&&(this._ws.onopen=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.onclose=null,this._ws.close()),this._ws=OA,this._tasks=Object.create(null),!D){B.next=12;break}throw new uu(cu.OBJECT_DISPOSING);case 12:case"end":return B.stop()}},A,this)})),function(){return w.apply(this,arguments)})},{key:"setRetry",value:function(A){this._defaultRetries=null!=A?A:1}},{key:"addEvent",value:function(A,D,M){var B=this._events[A];B||(this._events[A]={},B=this._events[A]),U.isString(D)&&U.isFunction(M)&&(B[D]=M)}},{key:"removeEvent",value:function(A,D){var M=this._events[A];M&&U.isString(D)&&delete M[D]}},{key:"clearEvent",value:function(A){this._events[A]&&(this._events[A]={})}},{key:"fireEvent",value:function(A){var D,M=this._events[A];if(M){var B=Object.keys(M);for(D=0;D<B.length;D++)U.isFunction(M[B[D]])&&M[B[D]]()}}},{key:"getRequestTaskId",value:function(){return this._requestTaskId?this._requestTaskId:0}}],[{key:"_waitForPreBlob",value:(x=yt(W.mark(function A(D){return W.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(!D._processing_blob){M.next=3;break}return setTimeout(function(){C._waitForPreBlob(D)},500),M.abrupt("return");case 3:C._preBlobResolv&&C._preBlobResolv();case 4:case"end":return M.stop()}},A)})),function(A){return x.apply(this,arguments)})}]);var x,w,T}(kle);function AVe(y){var C="";return C=y.ssl?"wss://":"ws://",C+=y.server,y.port&&(C+=":",C+=y.port),C}function PVe(y,C,x,w){var T=this;return new ge.Promise(function(A,D){try{var M,B,H=D,Y=A;if(w&&(B=setTimeout(function(){var se=new uu("createWebSocket timed out.");Ka.debug(se.message),H&&(H(se),H=null,Y=null),B&&clearTimeout(B),M&&M.close()},w)),y.bUseParentWS){var G=window,q=parent,re=G.WebSocket;try{for(;G!=q&&q&&q.WebSocket;)re=q.WebSocket,G=q.window,q=q.parent}catch(se){re=window.WebSocket}M=x?new re(C,x):new re(C)}else M=x?new WebSocket(C,x):new WebSocket(C);M.onopen=function(){B&&clearTimeout(B),y._ws=M,Y&&(Y(M),H=null,Y=null)},M.onerror=function(se){M.close(),y.bReady=!1,B&&clearTimeout(B),T.fireEvent("error"),H&&(H(new uu("websocket error")),H=null,Y=null)},M.onmessage=function(se){pf(y,Ule,RVe).call(y,y,se.data)},M.onclose=function(se){y.bReady=!1,B&&clearTimeout(B),T.fireEvent("close"),H&&(H(se&&1006==se.code?new uu("websocket error"):se),H=null,Y=null)}}catch(se){if(se instanceof uu||se&&se.code&&se.message)throw se;if(se.message)throw new uu(se.message)}})}function RVe(y,C){return Q7.apply(this,arguments)}function Q7(){return Q7=yt(W.mark(function y(C,x){var w,T,A,D,M,B,H,Y,G;return W.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(w=C,q.prev=1,D={client:w,userData:void 0},"object"!==p(x)){q.next=17;break}if(!(w._blob_callbacks.length>0)){q.next=17;break}if(!w._processing_blob){q.next=9;break}return q.next=8,new ge.Promise(function(re){MA._preBlobResolv=re,MA._waitForPreBlob(w)});case 8:MA._preBlobResolv=null;case 9:return w._processing_blob=!0,M=w._blob_callbacks.shift(),q.next=13,M(x);case 13:return w._processing_blob=!1,q.abrupt("return");case 17:if(!(w.bReady&&U.isString(x)&&(x.indexOf("Function not found")>0||x.indexOf("Version not found")>0))){q.next=19;break}return q.abrupt("return");case 19:if(w._cbToGetTaskId){q.next=21;break}return q.abrupt("return");case 21:return q.next=23,w._cbToGetTaskId(x,Jr.ONMESSAGE_PROCESS_DATA,w._requestTaskId,D);case 23:return B=q.sent,H=!1,q.next=27,w._cbToGetTaskId(B,Jr.ONMESSAGE_GET_TASKID,w._requestTaskId,D);case 27:if(A=q.sent){q.next=36;break}if(!B.Detail||!B.Domain){q.next=32;break}return w._lic_callback&&w._lic_callback(B),q.abrupt("return");case 32:return q.next=34,w._cbToGetTaskId(B,Jr.ONMESSAGE_GET_EVENT_TASKID,w._requestTaskId,D);case 34:(A=q.sent)&&(H=!0);case 36:if(T=w._tasks[A]){q.next=46;break}if(!H){q.next=42;break}T={},q.next=44;break;case 42:return""!=A&&Ka.log("invalid task id: "+A),q.abrupt("return");case 44:q.next=48;break;case 46:if(!T.timedout){q.next=48;break}return q.abrupt("return");case 48:return q.next=50,w._cbToGetTaskId(x,Jr.HANDLE_RAW_MESSAGE,w._requestTaskId,T.ctx);case 50:if(void 0!==(Y=q.sent)){q.next=55;break}return q.next=54,w._cbToGetTaskId(B,Jr.HANDLE_PROCESSED_MESSAGE,w._requestTaskId,T.ctx);case 54:Y=q.sent;case 55:Y&&!H&&(T.tmid&&clearTimeout(T.tmid),delete w._tasks[A],T.resolver&&T.resolver.resolve(Y)),q.next=64;break;case 58:q.prev=58,q.t0=q.catch(1),Ka.debug("failed to handle message."),q.t0 instanceof Error?Ka.error(q.t0):Ka.error(U.stringify(q.t0)),delete w._tasks[A],null===(G=T)||void 0===G||null===(G=G.resolver)||void 0===G||G.reject(q.t0.message);case 64:case"end":return q.stop()}},y,null,[[1,58]])})),Q7.apply(this,arguments)}function kVe(y,C,x){return Z7.apply(this,arguments)}function Z7(){return Z7=yt(W.mark(function y(C,x,w){var T,A;return W.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:D.t0=x,D.next=D.t0===Jr.GET_TASKID?3:D.t0===Jr.HANDLE_RAW_MESSAGE?7:9;break;case 3:return(A=EVe(C)).cmdId=null!==(T=A.cmdId)&&void 0!==T?T:[wS(8),"-",wS(4),"-",wS(4),"-",wS(4),"-",wS(8)].join(""),ge.Promise.resolve(["cmdId"]),D.abrupt("break",9);case 7:return ge.Promise.resolve(C),D.abrupt("break",9);case 9:case"end":return D.stop()}},y)})),Z7.apply(this,arguments)}function eB(y,C,x,w){return tB.apply(this,arguments)}function tB(){return tB=yt(W.mark(function y(C,x,w,T){var A,D,M,B;return W.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(!this.connected&&!this.disposed){H.next=2;break}return H.abrupt("return");case 2:if(!(M=this)._connectPromise){H.next=7;break}return H.next=6,M._connectPromise;case 6:return H.abrupt("return");case 7:return x=null!==(A=x)&&void 0!==A?A:this._defaultRetries,w=null!==(D=w)&&void 0!==D?D:100,B=pf(M,Ble,AVe).call(M,M.serverInfo),Ka.debug("WebSocket URL: "+B+", try to create websocket "+x+"/"+w),M._connectPromise=new ge.Promise(function(Y,G){var q=function(se){pf(M,Wle,PVe).call(M,M,B,M.serverInfo.protocol,T).then(function(ce){Y(ce)}).catch(function(ce){Ka.debug("create websocket failed: "+ce.message),se<x?function re(se,ce,ve){setTimeout(function(){q(++se)},w)}(se):G(ce)})};q(0)}),H.prev=12,H.next=15,M._connectPromise;case 15:H.next=20;break;case 17:throw H.prev=17,H.t0=H.catch(12),H.t0;case 20:return H.prev=20,M._connectPromise=null,H.finish(20);case 23:case"end":return H.stop()}},y,this,[[12,17,20,23]])})),tB.apply(this,arguments)}function Hle(y,C,x,w){return nB.apply(this,arguments)}function nB(){return nB=yt(W.mark(function y(C,x,w,T){var A,D,M,B;return W.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(A=this,M=w.lastEventTaskId,void 0!==(D=w.eventTaskId)){H.next=7;break}return H.next=6,x(C,Jr.GET_EVENT_TASKID,A._requestTaskId,w);case 6:D=H.sent;case 7:D&&(A._tasks[D]?w&&w.userData&&w.userData.command&&((B=A._tasks[D]).ctx=w,M&&((B=A._tasks[M]).ctx=w)):(A._tasks[D]=B={id:T.id,resolver:null,ctx:w,timedout:!1},M&&(A._tasks[M]=B)));case 8:case"end":return H.stop()}},y,this)})),nB.apply(this,arguments)}function MVe(y,C,x,w,T,A,D){return iB.apply(this,arguments)}function iB(){return iB=yt(W.mark(function y(C,x,w,T,A,D,M){var B,H,Y,G;return W.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return B=this,q.prev=1,w.client=B,q.next=5,pf(B,FA,eB).call(B,A,T,D,M);case 5:if("0"!=(H=w.taskId)){q.next=12;break}return B.disposed||B._ws.send(C),C=null,q.abrupt("return");case 12:if(void 0!==H){q.next=16;break}return q.next=15,x(C,Jr.GET_TASKID,null,w);case 15:H=q.sent;case 16:return void 0===H&&Ka.debug("websocket send: task id is invalid."),(Y={}).promise=new ge.Promise(function(re,se){Y.resolve=re,Y.reject=se}),B._tasks[H]=G={id:H,resolver:Y,ctx:w,timedout:!1},B._requestTaskId=H,q.next=24,pf(B,K7,Hle).call(B,C,x,w,G);case 24:return B._cbToGetTaskId=x,M&&(G.tmid=setTimeout(function(){Ka.debug("ws request time out."),G.timedout=!0,G.resolver.reject("request timed out.")},M)),B.disposed||B._ws.send(C),Ka.debug("end to send task "+H),C=null,q.abrupt("return",Y.promise);case 32:if(q.prev=32,q.t0=q.catch(1),H&&delete B._tasks[H],!(q.t0 instanceof uu||q.t0&&q.t0.code&&q.t0.message)){q.next=39;break}throw q.t0;case 39:if(!q.t0.message){q.next=41;break}throw new uu(q.t0.message);case 41:return q.prev=41,C=null,q.finish(41);case 44:case"end":return q.stop()}},y,this,[[1,32,41,44]])})),iB.apply(this,arguments)}function Gle(y,C){var x="undefined"!=typeof Symbol&&y[Symbol.iterator]||y["@@iterator"];if(!x){if(Array.isArray(y)||(x=function(B,H){if(B){if("string"==typeof B)return zle(B,H);var Y=Object.prototype.toString.call(B).slice(8,-1);if("Object"===Y&&B.constructor&&(Y=B.constructor.name),"Map"===Y||"Set"===Y)return Array.from(B);if("Arguments"===Y||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Y))return zle(B,H)}}(y))||C&&y&&"number"==typeof y.length){x&&(y=x);var w=0,T=function(){};return{s:T,n:function(){return w>=y.length?{done:!0}:{done:!1,value:y[w++]}},e:function(B){throw B},f:T}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var A,D=!0,M=!1;return{s:function(){x=x.call(y)},n:function(){var B=x.next();return D=B.done,B},e:function(B){M=!0,A=B},f:function(){try{D||null==x.return||x.return()}finally{if(M)throw A}}}}function zle(y,C){(null==C||C>y.length)&&(C=y.length);for(var x=0,w=new Array(C);x<C;x++)w[x]=y[x];return w}function Yle(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function Xle(y,C,x){return C.has(y),x}MA=J7;var $le=new WeakSet,qle=new WeakSet,gf=function(){function y(){l(this,y),Yle(this,qle),Yle(this,$le),Dn(this,"_maxWebSocketCon",10),Dn(this,"_wsClients",[])}return g(y,[{key:"removeTerminatedWSClient",value:function(){this._wsClients=this._wsClients.filter(function(x){return!x.disposed})}},{key:"getClient",value:function(x,w){return x.useWS?Xle(this,qle,FVe).call(this,x,w):new TVe(x)}},{key:"closeClient",value:(C=yt(W.mark(function x(w){var A,D,M;return W.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:A=Gle(this._wsClients),B.prev=2,A.s();case 4:if((D=A.n()).done){B.next=12;break}if(!Ple((M=D.value).serverInfo,w)){B.next=10;break}if(M.disposed){B.next=10;break}return B.next=10,M.dispose();case 10:B.next=4;break;case 12:B.next=17;break;case 14:B.prev=14,B.t0=B.catch(2),A.e(B.t0);case 17:return B.prev=17,A.f(),B.finish(17);case 20:this.removeTerminatedWSClient();case 21:case"end":return B.stop()}},x,this,[[2,14,17,20]])})),function(x){return C.apply(this,arguments)})},{key:"terminate",value:function(){var x=this._wsClients.slice();this._wsClients=[],x.forEach(function(w){w.dispose()})}}],[{key:"Instance",get:function(){return this._gClientPool||(this._gClientPool=new y),this._gClientPool}}]);var C}();function OVe(y){this.removeTerminatedWSClient();var C,x=Gle(this._wsClients);try{for(x.s();!(C=x.n()).done;){var w=C.value;if(Ple(w.serverInfo,y)&&!w.disposed)return w.addRef(),w}}catch(T){x.e(T)}finally{x.f()}return null}function FVe(y,C){var x;return C||(x=Xle(this,$le,OVe).call(this,y)),x||(this._wsClients.length<this._maxWebSocketCon?((x=new J7(y)).addEvent("disposed","1",function(){Nle.Instance.removeTerminatedWSClient()}),this._wsClients.push(x),x):null)}Nle=gf,Dn(gf,"_gClientPool",null);var Op=function(){function y(){l(this,y)}return g(y,null,[{key:"getHttpClientForDcp",value:function(C,x){var w,T=Ce.dcp,A=ge.detect.ssl;if(x||!de.bSSL?(w=T.Port,A=!1):(w=T.SSLPort,A=!0),U.isString(C)){var D=new g0;return U.startsWith(C,"https://")?(D.ssl=!0,D.server=C.substring(8)):U.startsWith(C,"http://")?(D.ssl=!1,D.server=C.substring(7)):(D.ssl=ge.detect.ssl,D.server=C),gf.Instance.getClient(D)}return y.getHttpClient(null,w,A)}},{key:"getHttpClient",value:function(C,x,w){var T=w?"https":"http",A=new g0(C||Ya(),x,w,!1,T);return gf.Instance.getClient(A)}},{key:"getWsClient",value:function(C,x,w,T){var A=new g0(C||Ya(),x,w,!0,$n.wsProtocol);return gf.Instance.getClient(A,T)}},{key:"closeWsClient",value:function(C,x,w){var T=new g0(C||Ya(),x,w,!0,$n.wsProtocol);return gf.Instance.closeClient(T)}}])}();ge.ClientPool=gf;var SS,LVe=parseInt(td),NVe=parseInt(xA),BVe=parseInt("0"),Kle="ddm/",Fp="ddm_"+[LVe,NVe,BVe,fm].join("");function Jle(){return Kle+Fp}function WVe(y){return Qle.apply(this,arguments)}function Qle(){return(Qle=yt(W.mark(function y(C){var x,w,T,A;return W.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return x=vS,w=[Jle(),"/VersionInfo?","ts=",U.now()].join(""),T=['{"id":"',U.guid(),'","method":"VersionInfo"}'].join(""),A=Op.getHttpClientForDcp(C),D.abrupt("return",A.request(T,w,{dataType:"json"},x));case 4:case"end":return D.stop()}},y)}))).apply(this,arguments)}function rB(){var y=window.Dynamsoft.Lib.Promise;if(SS)return y.resolve(SS);var x,w=navigator;if(w&&"userAgentData"in w){var T=navigator.userAgentData;if(T.platform&&""!=T.platform){var A=[];if("brands"in T&&U.isArray(T.brands)&&T.brands.length>0?A=T.brands:"uaList"in T&&U.isArray(T.uaList)&&T.uaList.length>0&&(A=T.uaList),A.length>0)return(x=function(D){var M=de,B=D.architecture.toLowerCase(),H="64"==D.bitness,Y=B.indexOf("arm")>-1,G=B.indexOf("mips")>-1;return{bUseUserAgent:!1,bWin:M.bWin,bMac:M.bMac,bLinux:M.bLinux,bAndroid:M.bAndroid,bMobile:M.bMobile,bPad:M.bPad,bChromeOS:M.bChromeOS,bHarmonyOS:M.bHarmonyOS,bArm64:Y,bMips64:G,bEmbed:Y||G,bOSx64:H,bIE:!1,bEdge:M.bEdge,bChrome:M.bChrome,bFirefox:M.bFirefox,bSafari:M.bSafari,bOpera:M.bOpera,bGecko:!0,bHuaWeiBrowser:!1,bHTML5Edition:!0,strBrowserVersion:M.strBrowserVersion,IEMode:0}},navigator.userAgentData.getHighEntropyValues(["platform","platformVersion","architecture","bitness"]).then(x)).then(function(D){return SS=D,D})}}return y.resolve(SS=de)}ge.install={_divDWTNonInstallContainerID:"dwt-NonInstallContainerID",_divDWTemessageContainer:"",_dlgInstall:!1},ge.install._strNonInstallDIV=['<div style="text-align:center;" id="',ge.install._divDWTNonInstallContainerID,'"></div>'].join("");var oB=0,sB=[],aB=!(!document||!document.addEventListener),Zle="DOMContentLoaded",ece="readystatechange",lB=aB?function(y,C,x){y.addEventListener(C,x,!1)}:function(y,C,x){y.attachEvent("on"+C,x)},cB=aB?function(y,C,x){y.removeEventListener(C,x,!1)}:function(y,C,x){y.detachEvent("on"+C,x)};function $1(){oB||(oB=1,rB().then(function(){document&&cB(window,"load",$1),function(){for(var y=function(){try{sB[C]()}catch(x){U.log(x,"error"),setTimeout(function(){throw x},0)}},C=0;C<sB.length;C++)y()}()}))}function q1(y){if(oB)try{y()}catch(C){U.log(C,"error"),setTimeout(function(){throw C},0)}else sB.push(y);return this}function lo(y){U.log(y)}q1(function(){var y=document.createElement("style"),C=["dialog[open]{display:block}dialog[closed]{display:none}.dynamsoft-backdrop{position:fixed;background:rgba(128,128,128,0.1);top:0;bottom:0;left:0;right:0;z-index:-99999999;}.dynamsoft-dwt-dialogProgress{width:330px;background:#FFF}.dynamsoft-finalMessage{margin:0;color:#3a3a3a;font:20px Arial,sans-serif}.dynamsoft-desc{margin:7px 0;color:#3a3a3a;font:14px Arial,sans-serif}.dynamsoft-status{color:#555;font:14px/22px Arial,sans-serif;margin-bottom:5px}.dynamsoft-progressBar{-webkit-appearance:none;width:280px;margin-bottom:20px;height:14px}.dynamsoft-progressBar,.dynamsoft-progressBar::-webkit-progress-bar{background-color:#e7e7e7;border-radius:7px}.dynamsoft-progressBar::-webkit-progress-value,.dynamsoft-progressBar::-moz-progress-bar{background-color:#50a8e1;border-radius:7px}.dynamsoft-loadingMsg{width:290px;height:290px;margin:auto;color:#CCC;border-width:1px;background:#FFF}.dynamsoft-loadingMsg-msg{margin:0 0 15px 25px;color:#3a3a3a;font:20px Arial,sans-serif}.dynamsoft-loadingMsg-desc{text-align:center;margin:0 0 15px 0;color:#3a3a3a;font:14px Arial,sans-serif}.ds-dwt-loaderBar-noserver-parent{height:100%;}.ds-dwt-loaderBar-noserver{margin: 0 auto;padding-top: 50px;text-align: center;}.ds-dwt-loaderBar-noserver img{height: 100px}"].join("");y.type="text/css";try{y.appendChild(document.createTextNode(C))}catch(x){y.styleSheet.cssText=C}document.body.appendChild(y)}),ge._zdgb_xkz_dhk=function(){var y=ge.install._dlgInstall;if(y){var C=U.sizzle(".dynamsoft-dialog-closeTimer",y);if(C.length>0){var x=C[0],w=parseInt(x.style.width);(w-=1)<=0?Ce.DWT.CloseDialog():(x.style.width=w+"%",setTimeout(ge._zdgb_xkz_dhk,100))}}},ge.ShowLicenseDialog=Ce.DWT.ShowMessage,ge.createLoadingBarContent=function(){};var gr,ice="All scripts and css loaded.",VVe="Checking Product Key format...",jVe="Initializing the service...",HVe="Checking the service enhanced module...",rce="Getting the WebTwain port...",GVe="Checking the WebTwain module...",zVe="Checking the WebTwain version...",YVe="Check the WebTwain version successfully.",oce="The WebTwain version not compatible.",XVe="Getting Machine ID.",$Ve="Creating WebTwain from Dynamsoft.DWT.Containers...",sce="Decoding the license...",ace="Checking the license...";function Lp(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function _c(y,C,x){return C.has(y),x}!function(y){y.CM_RENDERALL=1,y.CM_IMAGEONLY=2,y.CM_AUTO=3,y.CM_RENDERALLWITHANNOTATION=4}(gr||(gr={}));var lce=td+".",qVe=parseInt(td);function K1(y){return U.isString(y)?U.trim(y):y}var uB=new WeakSet,cce=new WeakSet,dB=new WeakSet,uce=new WeakSet,dce=new WeakSet,hce=new WeakSet,LA=new WeakSet,fce=new WeakSet,hB=new WeakSet,KVe=g(function y(){l(this,y),Lp(this,hB),Lp(this,fce),Lp(this,LA),Lp(this,hce),Lp(this,dce),Lp(this,uce),Lp(this,dB),Lp(this,cce),Lp(this,uB),Dn(this,"isLTS",Xa)},[{key:"isLongKey",value:function(y){if(U.isString(y)&&y.length>0){var C=y.charAt(0);if("f"==C||"t"==C)return!0;if(U.startsWith(y,"DLS")||U.isNumber(y))return!1;var x=parseInt(y)+"-";return!U.startsWith(y,x)}return!1}},{key:"isLicenseMixed",value:function(y,C){var x,D,w=!1,T=y||Ce.DWT.ProductKey;if(Ce.DWT.lclex(),C&&(K1(Ce.DWT.organizationID)||K1(Ce.DWT.handshakeCode))&&T&&(w=!0,wt(x={},-2444,"A license can only be specified once and has already been set using the ProductKey API.")),!w&&U.isString(T)&&(T=U.trim(T),!U.startsWith(T,"f")&&!U.startsWith(T,"t"))&&""!=T)if(U.startsWith(T,"DLS2"))try{_c(this,cce,JVe).call(this,T)}catch(D){w=!0,wt(x={},-2440,""),x._errorString=D.message}else _c(this,uB,pce).call(this,T).LTS||(w=!0,wt(D=x={},Qs.LicenseParseFailed,"The license is invalid."));return w&&x&&(Ao(x),U.error(Ce.DWT.licenseException.message)),w}},{key:"reparseProductKey",value:function(y){y&&lo("Parsing Product Key...");var C=K1(Ce.DWT.organizationID),x=K1(Ce.DWT.handshakeCode),w=C||x,T=U.trim(Ce.DWT.ProductKey);if(!w){var A=_c(this,uB,pce).call(this,T);A.LTS&&(x=K1(A.handshakeCode),w=(C=K1(A.organizationID))||x)}if(w)return this._innerResetLicense(),U.isNumber(T)&&(C=T),St.handshakeCode=x,St.organizationID=C,St.licenseServer=Ce.DWT.licenseServer,St.sessionPassword=Ce.DWT.sessionPassword,void(St.bPublicLTS=_c(this,dB,gce).call(this,St.licenseServer,w));var D=!1;if(St.refProductKey!==T&&(this._innerResetLicense(),U.isString(T)&&T.length>0&&(St.refProductKey=T,D=!0)),D)if(this.isLongKey(St.refProductKey))St.bPublicLTS=!1;else{var M,B={_pLoad:{isEmpty:Lt},_license:St.refProductKey,_licenseServer:[]};try{M=Ale(B)}catch(Y){U.error(Y),M=!1}if(M&&U.isString(M.l)){var H=U.trim(M.l);""==H?St.organizationID=H:-1!=H.indexOf("-")?St.handshakeCode=H:St.organizationID=H,U.isArray(M.ls)&&M.ls.length>0&&(St.licenseServer=M.ls),St.bPublicLTS=_c(this,dB,gce).call(this,St.licenseServer,H),St.sessionPassword=M.sp}else St.bPublicLTS=!1}}},{key:"_innerResetLicense",value:function(){St.refProductKey="",St.handshakeCode=void 0,St.organizationID=void 0,St.licenseServer=void 0,St.sessionPassword="",St.bPublicLTS=!0}},{key:"checkOSForAllowCore",value:function(y,C,x){return St.bHTML5Edition?y?_c(this,hB,mce).call(this,C):this.isOSOK(C,x._bRemoteMode,x.__serverPlatform):Lt}},{key:"checkLocalPlatformForRemoteService",value:function(y){var C,x,w,M,T=y.__licenseInfo,A=Hl.getEnumPlatform(),D=!1;for(C=0;C<T.Detail.length&&(x=T.Detail[C],!((w=_c(this,LA,fB).call(this,x.EnumLicenseType,x.LicenseType)).Core&&U.isString(x.Version)&&0==x.Version.indexOf(lce)&&((D=_c(this,hB,mce).call(this,x.OS))||(D=this.isOSOK(x.OS,!0,A))||!y._blts&&y._bScanForProxyRemote&&w.RemoteScan)));C++);return D||(A==Rn.enumWindow?(wt(M=y,-2344,"The current product key does not support Windows OS. "+Zs()),Ao(M)):A==Rn.enumLinux?function(M){wt(M,-2346,"The current product key does not support Linux OS. "+Zs()),Ao(M)}(y):A==Rn.enumMac?function(M){wt(M,-2345,"The current product key does not support MAC OS. "+Zs()),Ao(M)}(y):function(M){wt(M,-2347,"The current product key does not support your OS. "+Zs()),Ao(M)}(y)),D}},{key:"checkProductKey",value:function(y,C,x){var w,T=Ce.DWT.licenseException;return!C.Camera&&(y.__licenseInfo||(y.__licenseInfo={}),(w=_c(this,dce,ZVe).call(this,y,y.__licenseInfo,vt,C,x))||(T.code=y._errorCode,T.message=y._getErrorString(),T.fromLTS=!1),w)}},{key:"isBindDomainOK",value:function(y){if(U.isUndefined(y)||null==y||""==y||"*"==y||"*.*"==y)return Lt;var C=location.hostname,x=vt;if(""==C)return Lt;for(var w=C.toLowerCase().split("."),T=w.length,A=y.toLowerCase().split(";"),D=0;D<A.length;D++){var M=A[D];if("*.*"==M){x=Lt;break}var B=M.split("."),H=B.length;if(H>0&&H-1<=T){for(var Y=Lt,G=H-1;G>0;G--){if(B[G].indexOf("*")>-1){x=Lt;break}if(G+T-H>=0){if(w[G+T-H]!=B[G]){Y=vt;break}}else if("*"!=B[G]){Y=vt;break}}if(Y&&("*"==B[0]||T>=H&&w[T-H]==B[0])){x=Lt;break}}}return x}},{key:"isExpiredOrFuture",value:function(y,C){if(""==y)return vt;if(!C){var x=y.length;if(x>2&&"/"==y[x-2]&&"0"==y[x-1])return vt}var w=J1(y),T=(new Date).getTime(),A=T+5184e6;return w.getTime()<T||C&&w.getTime()>A?Lt:vt}},{key:"willTrialExpire",value:function(y){if(""==y)return vt;var C=J1(y),x=(new Date).getTime();return C.getTime()<x+432e6&&C.getTime()>x?Lt:vt}},{key:"isOSOK",value:function(y,C,x){var w=!1,T=!1,A=!1,D=!1,M=!1,B=!1,H=!1,Y=!1;return""==y||"0"==y?Lt:(C?x==Rn.enumWindow?A=!0:x==Rn.enumLinux?T=!0:x==Rn.enumMac?w=!0:x==Rn.enumEmbed?M=!0:x==Rn.enumChromeOS?B=!0:x==Rn.enumAndroid?H=!0:x==Rn.enumHarmonyOS?Y=!0:x==Rn.enumiOS&&(D=!0):(w=de.bMac,T=de.bLinux,A=de.bWin,D=de.biPhone||de.biPad,B=de.bChromeOS,M=Ce.navInfo.bEmbed,H=de.bAndroid,Y=de.bHarmonyOS),(y=y.toLowerCase()).indexOf("windows")>-1&&A||y.indexOf("mac")>-1&&w||y.indexOf("linux")>-1&&(T||B||Y)||y.indexOf("android")>-1&&H||y.indexOf("ios")>-1&&D||y.indexOf("embed")>-1&&M?Lt:vt)}},{key:"isBrowserOK",value:function(y){if(U.isString(y)){if(""==y||"0"==y)return Lt;var C=(y=y.toLowerCase()).split(";"),x=vt;return U.each(C,function(w){("chrome"==U.trim(w)&&(de.bChrome||de.bSafari||de.bOpera||de.bEdge)||"ie"==U.trim(w)&&de.bIE||"firefox"==U.trim(w)&&de.bFirefox)&&(x=Lt)}),x}return vt}},{key:"isAllowLicenseType",value:function(y,C){return C.Core?y.Core:C.PDFRasterizer?y.PDFRasterizer:C.Webcam||C.Camera?y.Webcam:C.barcode1D?y.barcode1D:C.QR?y.QR:C.PDF417?y.PDF417:C.DataMatrix?y.DataMatrix:C.OCR?y.OCR:C.OCRPro?y.OCRPro:y.Core}},{key:"setNoAllowedLicenseTypeError",value:function(y,C,x){var w;x.Core?_S(y):x.Webcam||x.Camera?C||x.Camera?((w=y)._errorCode=-2431,Xa()?w._errorString="The license for the Camera Addon is not found or has expired.":wt(w,-2431,"The current product key does not support Camera Addon. "+Zs()),Ao(w)):function(w){w._errorCode=-2338,w._errorString=Xa()?"The license for the module direct show is not found or has expired.":"The current product key does not support Webcam. "+Zs(),Ao(w)}(y):x.PDFRasterizer?C?function(w){w._errorCode=-2370,w._errorString=Xa()?"The license for the module pdf rasterizer is not found or has expired.":"The current product key does not support Pdf Rasterizer Wasm. "+Zs(),Ao(w)}(y):G1(y):x.OCR?function(w){w._errorCode=-2340,w._errorString=Xa()?"The license for the module ocr is not found or has expired.":"The current product key does not support OCR. "+Zs(),Ao(w)}(y):x.OCRPro?function(w){w._errorCode=-2341,w._errorString=Xa()?"The license for the module ocr pro is not found or has expired.":"The current product key does not support OCR pro. "+Zs(),Ao(w)}(y):au(y)}},{key:"getLicenseDateString",value:function(y){var C,x=y.getFullYear();return[(C=y.getMonth()+1)>=10?""+C:"0"+C,"/",y.getDate()>=10?""+y.getDate():"0"+y.getDate(),"/",x].join("")}},{key:"hasPDFRProductKey",value:function(y){return!!this.checkProductKey(y,{PDFRasterizer:!0},!0)||(y._resetErr(),!1)}},{key:"checkPDFProductKeyWhenNeeds",value:function(y,C){var x;return C!=Ce.DWT.EnumDWT_ImageType.IT_PDF&&C!=Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF||(St.bHTML5Edition?y.__addon&&y.__addon.PDF&&(x=y._getConvertMode()):y.Addon&&y.Addon.PDF&&(x=y._getConvertMode()),x!=gr.CM_RENDERALL&&x!=gr.CM_RENDERALLWITHANNOTATION)?Lt:this.checkProductKey(y,{PDFRasterizer:!0},!0)}},{key:"getPublicLicenseContent",value:function(y){var C=[],x=y;if(!U.isString(x)){if(U.isUndefined(x))return"";x=x instanceof Error||"message"in x?x.message:""+x}var w=x.indexOf("["),T=x.indexOf("]",w),A=x.indexOf("(",T),D=x.indexOf(")",A);if(-1==w||-1==T||-1==A||-1==D)return x;w>0&&C.push(x.substring(0,w));var M=x.substring(w+1,T),B=x.substring(A+1,D);return C.push(['<a href="',B,'" target="_blank" class="dynamsoft-major-color">',M,"</a>"].join("")),C.push(x.substring(D+1)),C.join("")}},{key:"getLTSLicense",value:function(){return St.bPublicLTS?"":St.handshakeCode||St.organizationID}}]);function pce(y){var C,x,w=y,T=y.indexOf("-"),A=-1!=T;return x={},A&&(w=y.substring(0,T)),C=Number(w),isNaN(C)||String(Number(C))!==w||(A?x.handshakeCode=y:x.organizationID=y,x.LTS=Lt),x}function JVe(y){Ale({_pLoad:{isEmpty:Lt},_license:y,_licenseServer:[]})}function gce(y,C){var x=!0;if(U.isArray(y)&&y.length>0){var w=y[0];U.isString(w)&&""!=w&&-1==w.indexOf("https://mlts.dynamsoft.com")&&(x=!1)}return x&&(!C||"200001"===C||U.startsWith(C,"200001-"))}function QVe(y,C,x){return this.checkOSForAllowCore(y,C,x)}function ZVe(y,C,x,w,T){var A,D=!1;if(St.bHTML5Edition&&U.isFunction(y._needCheckProxyRemoteScanLicense)&&(D=y._needCheckProxyRemoteScanLicense()),C&&C.LTS){if(!C||!U.isArray(C.Detail)||0==C.Detail.length)return this.isLTS()?_S(y):au(y),vt}else if(!C||!U.isArray(C.Detail)||0==C.Detail.length)return this.isLTS()?_S(y):au(y),vt;var M,B,H,Y,Be,G=0,q=0,re=[],se=[],ce=vt,ve=vt,Te=vt,Ue=vt,je=vt;if(!this.isBindDomainOK(C.Domain))return wt(Be=y,-2342,"The domain of your current site does not match the domain bound in the current product key. "+Zs()),Ao(Be),vt;for(C.Detail.length>0&&(A="FALSE"!=(H=C.Detail[0]).Trial),B=1;B<C.Detail.length;B++)if("FALSE"==(H=C.Detail[B]).Trial&&A||"TRUE"==H.Trial&&!A)return mVe(y),vt;if(C.bTrial=A,w.Core||w.Webcam){var Ee=[],Oe=!1;for(B=0;B<C.Detail.length;B++)if(H=C.Detail[B],Y=_c(this,LA,fB).call(this,H.EnumLicenseType,H.LicenseType),w.Core&&Y.Core&&this.checkOSForAllowCore(x,H.OS,y)||w.Core&&Y.Core&&St.bActiveXEdition&&Y.ActiveX||w.Webcam&&Y.Webcam&&!x){if(!(C.LTS||U.isString(H.Version)&&0==H.Version.indexOf(lce))){Ee.push(H);continue}if(St.bHTML5Edition){if(Y.ActiveX&&!Y.Html5||D&&!Y.RemoteScan)continue;se.push(H)}else{if(!Y.ActiveX&&Y.Html5)continue;se.push(H)}Oe=!0}if(!Oe&&Ee.length>0)return Ee.splice(0),function(Be,$e){var Ge=Zs();wt(Be,Qs.LicenseVersionNotCurrent,"The current product key is not for version ".concat($e,". ").concat(Ge)),Ao(Be)}(y,[td,xA].join(".")),!1;Ee.splice(0)}else se=C.Detail;for(B=0;B<se.length;B++){var He=Lt;if(H=se[B],Y=_c(this,LA,fB).call(this,H.EnumLicenseType,H.LicenseType),w.Core&&Y.Core||this.isAllowLicenseType(Y,w)){M=H.ExpireDate.replace(/-/g,"/");var we="FALSE"!=H.Trial;if(this.isExpiredOrFuture(M,we))re.push(M);else if(we&&Y.Core&&this.willTrialExpire(M)&&(C.ExpireDate=M),C.LTS||Y.Core&&St.bHTML5Edition&&parseInt(H.Version)>=qVe||Y.Core&&St.bActiveXEdition||!Y.Core){var ue=!1;if(Y.Core)(this.checkOSForAllowCore(x,H.OS,y)||St.bActiveXEdition&&Y.ActiveX)&&(ue=!0);else{var pe=x;w.Camera&&(pe=!0),_c(this,uce,QVe).call(this,pe,H.OS,y)&&(ue=!0)}ue?this.isBrowserOK(H.Browser)||T?(G++,He=vt):ve=Lt:w.Core?ce=Lt:w.PDFRasterizer?Ue=Lt:(w.Webcam||w.Camera)&&(je=Lt)}else Te=Lt;He&&q++}}if(G>0)return Lt;if(0==q)return this.setNoAllowedLicenseTypeError(y,x,w),vt;if(re.length>0){var ye,me=0,Se=1e20,We="",ze=(new Date).getTime();for(M="",B=0;B<re.length;B++)(ye=J1(re[B])).getTime()<ze&&ye.getTime()>me?(me=ye.getTime(),M=re[B]):ye.getTime()>ze&&ye.getTime()<Se&&(Se=ye.getTime(),We=re[B]);return""!=M?(ye=J1(M),ale(y,M=this.getLicenseDateString(ye))):""!=We?(ye=J1(We),We=this.getLicenseDateString(ye),function(Be,$e){wt(Be,Qs.LicenseIsFuture,"The current product key is invalid. "+Zs()),Ao(Be)}(y)):ale(y,""),vt}return Te?(function(Be){wt(Be,-2348,"The current product key is invalid because it's generated with the licenses of a different major version."),Ao(Be)}(y),vt):ve?(de.bEdge?function(Be){wt(Be,-2330,"The current product key does not support Edge. "+Zs()),Ao(Be)}(y):de.bChrome?function(Be){wt(Be,-2327,"The current product key does not support Chrome. "+Zs()),Ao(Be)}(y):de.bFirefox?function(Be){wt(Be,-2328,"The current product key does not support Firefox. "+Zs()),Ao(Be)}(y):de.bIE?function(Be){wt(Be,-2329,"The current product key does not support IE. "+Zs()),Ao(Be)}(y):de.bSafari?function(Be){wt(Be,-2392,"The current product key does not support Safari. "+Zs()),Ao(Be)}(y):function(Be){wt(Be,-2343,"The current product key does not support your browser. "+Zs()),Ao(Be)}(y),vt):ce?(this.setNoAllowedLicenseTypeError(y,x,{Core:!0}),vt):Ue?(this.setNoAllowedLicenseTypeError(y,x,{PDFRasterizer:!0}),vt):je?(this.setNoAllowedLicenseTypeError(y,x,{Webcam:!0}),vt):(au(y),vt)}function eje(y){var C=vt,x=vt,w=vt,T=vt,A=vt,D=vt,M=vt,B=vt,H=vt;return U.isString(y)&&""!=y&&U.each(y.split(";"),function(Y){var G=1*Y;2==G||3==G||0==G||1==G?C=Lt:4==G?x=Lt:50==G?w=Lt:51==G?T=Lt:52==G?A=Lt:7==G?D=Lt:8==G?M=Lt:9==G?B=Lt:10==G&&(H=Lt)}),{Core:C,PDFRasterizer:B,Webcam:M,barcode1D:x,QR:w,PDF417:T,DataMatrix:A,OCR:D,OCRPro:H}}function fB(y,C){var x=_c(this,hce,eje).call(this,y),w=_c(this,fce,tje).call(this,C);return U.each(["Core","Html5","RemoteScan","LocalScan","ActiveX","PDFRasterizer","Webcam","barcode1D","QR","PDF417","DataMatrix","OCR","OCRPro"],function(T){x[T]=x[T]||w[T]}),x}function tje(y){var C=vt,x=vt,w=vt,T=vt,A=vt,D=vt,M=vt,B=vt,H=vt,Y=vt,G=vt,q=vt,re=vt;return y&&""!=y&&((y=y.toLowerCase()).indexOf("html5")>-1||"win=(aph) or mac=(ph) or linux(h)"==y?(C=Lt,y.indexOf("html5;activex;oldie")>-1?T=Lt:y.indexOf("html5;activex")>-1?(x=Lt,re=Lt,T=Lt):(x=Lt,re=Lt),y.indexOf(";remotescan")>-1&&(x=Lt,q=Lt,y.indexOf(";onlyremote")>-1&&(re=vt))):"1d barcode reader"==y?w=Lt:"2d barcode reader(qrcode)"==y?A=Lt:"2d barcode reader(pdf417)"==y?D=Lt:"2d barcode reader(data matrix)"==y?M=Lt:"ocr"==y?B=Lt:"webcam"==y?H=Lt:"pdf rasterizer"==y?Y=Lt:"proocr"==y&&(G=Lt)),{Core:C,Html5:x,RemoteScan:q,LocalScan:re,ActiveX:T,PDFRasterizer:Y,Webcam:H,barcode1D:w,QR:A,PDF417:D,DataMatrix:M,OCR:B,OCRPro:G}}function mce(y){var C=y.toLowerCase();return C.indexOf("wasm")>-1||C.indexOf("mobile")>-1}var pn=new KVe;function vce(y,C){return yce.apply(this,arguments)}function yce(){return(yce=yt(W.mark(function y(C,x){var w;return W.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(Xa()){T.next=2;break}return T.abrupt("return");case 2:if(T.prev=2,Ce.DWT.li({instanceMode:Ce.DWT.EnumInstance.dwt_desktop},"")){T.next=17;break}return x&&lo(XVe),T.prev=6,T.next=9,WVe();case 9:return w=T.sent,T.next=12,nje(w);case 12:T.next=17;break;case 14:T.prev=14,T.t0=T.catch(6),U.log(T.t0);case 17:T.next=22;break;case 19:T.prev=19,T.t1=T.catch(2),U.log(T.t1);case 22:case"end":return T.stop()}},y,null,[[2,19],[6,14]])}))).apply(this,arguments)}function nje(y){return _ce.apply(this,arguments)}function _ce(){return(_ce=yt(W.mark(function y(C){var x;return W.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!C){w.next=7;break}if(!(U.isArray(C.result)&&C.result.length>3)){w.next=5;break}x=C.result[3],w.next=7;break;case 5:if(!C.description){w.next=7;break}return w.abrupt("return",{code:C.exception,message:C.description});case 7:U.isString(x)&&""!=x&&(Ce.DWT.lsmid(x,""),Ce.DWT.lsmid2b(x));case 8:case"end":return w.stop()}},y)}))).apply(this,arguments)}function J1(y){var C,x=y;return x=x.replace(/-/g,"/"),C=Date.parse(x),isNaN(C)&&(C=0),(C=new Date(C)).setHours(23,59,59,999),C}function Cce(y){if(""==y)return 65536;var C=J1(y),x=(new Date).getTime(),w=(C.getTime()-x)/864e5;return C.getTime()<x?0:Math.ceil(w)}Ce.DWT.isPublicLicense=function(){return St.bPublicLTS};var Cl,bce=g(function y(){l(this,y),Dn(this,"_exec",{})},[{key:"fire",value:function(y,C){var x,w=this;y=y.toLowerCase(),x=Array.prototype.slice.call(arguments,1),U.each(w._exec[y]||[],function(T){var A=T.f,D=T.c||w;try{A.apply(D,x)}catch(M){U.error(M)}})}},{key:"on",value:function(y,C,x){y=y.toLowerCase(),this._exec[y]=this._exec[y]||[],this._exec[y].push({f:C,c:x})}},{key:"off",value:function(y,C,x){if(y&&C){y=y.toLowerCase();for(var w=this._exec[y]||[],T=w.length-1;T>=0;T--)w[T]===C&&w.splice(T,1)}else this._exec={}}}]);function gm(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function mf(y,C,x){return C.has(y),x}var id,NA="[bio]: ",xce=window,BA=xce&&xce.FormData,wce=new WeakSet,Sce=new WeakSet,pB=new WeakSet,gB=new WeakSet,mB=new WeakSet,ije=new WeakSet,rje=new WeakSet,vB=new WeakSet,Np=function(y){function C(x){var w,T,A;return l(this,C),T=this,A=qn(A=C),gm(w=$a(T,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(M){return!1}}()?Reflect.construct(A,[],qn(T).constructor):A.apply(T,undefined)),vB),gm(w,rje),gm(w,ije),gm(w,mB),gm(w,gB),gm(w,pB),gm(w,Sce),gm(w,wce),Dn(w,"_attrs",{}),U.mix(w._attrs,{action:"",data:{},bChunkedSendData:Lt,ajaxConfig:{value:{},type:"post",processData:vt,cache:vt,dataType:"text",async:Lt,contentType:vt,retry:0,headers:{"X-Requested-With":vt}},ajax:"",formData:"",CORS:vt,bOnlyResponseEmptyIsOK:Lt}),U.mix(w._attrs,x),mf(w,wce,oje).call(w),w}return qa(C,y),g(C,[{key:"get",value:function(x){return x in this._attrs?this._attrs[x]:""}},{key:"set",value:function(x,w){x in this._attrs&&(this._attrs[x]=w)}},{key:"uploadFilesToServer",value:function(x){return mf(this,Sce,sje).call(this,x)}},{key:"uploadToServer",value:function(x){var w=this,T=w.get("ajaxConfig");mf(w,pB,Tce).call(w),x&&x.size>0&&(mf(w,gB,Ice).call(w,x),w.name=U.isString(x.name)&&""!=x.name?x.name:x.fileName,x=null),U.mix(T,{data:w.get(C.PROP.formData),url:w.get(C.PROP.action),beforeSend:function(M,B,H){M.upload.addEventListener("progress",function(Y){w.fire(C.event.PROGRESS,{loaded:Y.loaded,total:Y.total,name:w.name})},!1)}});var A=w.get("async");if(U.mix(T,{method:"POST",async:A,onSuccess:function(M){WA(w.get(C.PROP.data)),WA(w.get(C.PROP.formData));var B=w.get(C.PROP.ajax);U.isFunction(B.dispose)&&B.dispose(),w.set(C.PROP.data,null),w.set(C.PROP.formData,null),w.set(C.PROP.ajax,null);var H=mf(w,vB,Dce).call(w,M);w.fire(C.event.SUCCESS,H)},onError:function(M,B,H){WA(w.get(C.PROP.data)),WA(w.get(C.PROP.formData));var Y,G,q=w.get(C.PROP.ajax);U.isFunction(q.dispose)&&q.dispose(),w.set(C.PROP.data,null),w.set(C.PROP.formData,null),w.set(C.PROP.ajax,null),M&&U.isArray(M)&&M.length>2?(Y=M[1],G=M[2]):(Y=B,G=H),mf(w,mB,Ece).call(w,G,Y)}}),A){var D=ru(T);return w.set(C.PROP.ajax,D),!0}return ru(T)}},{key:"abort",value:function(){var x=this,w=x.get("ajax");return U.isObject(w)?(w.abort(),x.set("ajax",!1),x):(U.log(NA+"abort(), the value of io invalid!"),x)}},{key:"setRequestHeader",value:function(x,w){var T=this.get("ajaxConfig");return T.headers[x]=w,this.set("ajaxConfig",T),T=null,w}}])}(bce);function oje(){this.get("CORS");var y=this.get("ajaxConfig");return U.mix(y,{xhrFields:{withCredentials:!1}}),y}function sje(y){var C=this,x=C.get(Cl.PROP.ajaxConfig),w=[];if(mf(C,pB,Tce).call(C),U.each(y,function(D){D&&D.size>0?(mf(C,gB,Ice).call(C,D),U.isString(D.name)&&""!=D.name?w.push(D.name):w.push(D.fileName)):w.push("")}),U.mix(x,{data:C.get(Cl.PROP.formData),url:C.get(Cl.PROP.action),beforeSend:function(D,M,B){D.upload.addEventListener("progress",function(H){C.fire(Cl.event.PROGRESS,{loaded:H.loaded,total:H.total,name:""})},!1)}}),U.mix(x,{method:"POST",async:C.get("async"),onSuccess:function(D){var M="";w=[],D&&(D&&U.isArray(D)&&D.length>1?M=D[0]:U.isString(D)&&(M=D)),M=mf(C,vB,Dce).call(C,M),C.fire(Cl.event.SUCCESS,M)},onError:function(D,M,B){var H,Y;w=[],D&&U.isArray(D)&&D.length>2?(H=D[1],Y=D[2]):(H=M,Y=B),mf(C,mB,Ece).call(C,Y,H)}}),C.name="",C.get("async")){var T=ru(x);return C.set(Cl.PROP.formData,null),C.set(Cl.PROP.ajax,T),!0}var A=ru(x);return C.set(Cl.PROP.formData,null),A}function Tce(){var y,C=this,x=C.get("data");if(BA)if(x instanceof BA)C.set(Cl.PROP.formData,x);else{y=new BA;try{U.each(x,function(w,T){y.append(T,w)}),C.set(Cl.PROP.formData,y)}catch(w){U.log(NA+"something error when reset FormData.")}}else U.log(NA+"the browser does not support ajax.")}function Ice(y){if(!U.isObject(y))return U.log(NA+"_addFileData(), file parameter invalid!"),!1;var C=this.get(Cl.PROP.formData),w=y.remoteFilename;return w||(w="RemoteFile"),C.append(w,y,y.name),this.set(Cl.PROP.formData,C),y=null,C}function Ece(y,C){var x=Cl.status.ERROR,w={status:x,msg:C,response:!1,name:this.name};y&&(w.httpStatus=y.status,w.response=y.responseText),this.fire(x,w)}function Dce(y){var C,x,w,T=!1,A=this.name,D=Cl.status.SUCCESS,M=Cl.event.ERROR;if(U.log("Response from server: "+y),!this.get("bOnlyResponseEmptyIsOK"))return{status:D,msg:!1,json:!1,response:y,name:A};if(U.isUndefined(y)||""===y)C={status:D,msg:!1,json:!1,response:"",name:A};else if(U.isString(y)){try{for(x=0;x<y.length&&!(x>10);x++){if("{"==(w=y[x])){T=!0;break}if(" "!=w&&"\r"!=w&&"\n"!=w&&"\t"!=w)break}if(T){var B=U.parse(y);C=1==B.status?{status:D,msg:!1,json:B,response:y,name:A}:{status:M,msg:!1,json:B,response:y,name:A}}}catch(Y){T=!1,U.log(Y)}if(!T){var H=String(y);C=""==(H=H.replace(/( |\t|\r|\n)/g,""))?{status:D,msg:!1,json:!1,response:y,name:A}:{status:M,msg:!1,json:!1,response:y,name:A}}}else C={status:D,msg:!1,json:!1,response:"",name:A};return C}function WA(y){y&&y instanceof BA&&y.forEach&&y.forEach(function(C,x){x&&y.delete(x)})}function UA(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function TS(y,C,x){return C.has(y),x}Cl=Np,Dn(Np,"event",{SUCCESS:"success",ERROR:"error",PROGRESS:"progress"}),Dn(Np,"status",{SUCCESS:"success",ERROR:"error"}),Dn(Np,"PROP",{action:"action",data:"data",bChunkedSendData:"bChunkedSendData",ajaxConfig:"ajaxConfig",ajax:"ajax",formData:"formData",CORS:"CORS",bOnlyResponseEmptyIsOK:"bOnlyResponseEmptyIsOK"});var Ace=new WeakSet,Pce=new WeakSet,Rce=new WeakSet,yB=new WeakSet,mm=function(y){function C(x){var w,T,A;return l(this,C),T=this,A=qn(A=C),UA(w=$a(T,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(M){return!1}}()?Reflect.construct(A,[],qn(T).constructor):A.apply(T,undefined)),yB),UA(w,Rce),UA(w,Pce),UA(w,Ace),w._attrs={action:"",retry:0,timeout:0,CORS:vt,async:Lt,dataType:"text",fileStatus:"",data:{},bOnlyResponseEmptyIsOK:Lt},U.mix(w._attrs,x),TS(w,Pce,lje).call(w),w}return qa(C,y),g(C,[{key:"get",value:function(x){return x in this._attrs?this._attrs[x]:""}},{key:"set",value:function(x,w){x in this._attrs&&(this._attrs[x]=w)}},{key:"upload",value:function(x){var w;if(x){if(U.isArray(x))return w=this._uploadType.uploadFilesToServer(x),x=null,w;if(U.isObject(x)){var T=x;return T.size?(T.id||(T.id=U.guid("file-")),T.size&&(T.textSize=TS(this,Ace,aje).call(this,T.size))):T.size=0,w=this._uploadType.uploadToServer(T),T=null,x=null,w}}return w=this._uploadType.uploadToServer(x),x=null,w}},{key:"abort",value:function(x){return this._uploadType&&this._uploadType.abort(),!0}},{key:"setRequestHeader",value:function(x,w){this._uploadType.setRequestHeader(x,w)}}])}(bce);function aje(y){var C=-1;do{y/=1024,C++}while(y>99&&C<4);return Math.max(y,.1).toFixed(1)+["KB","MB","GB","TB"][C]}function lje(){var y=this,C={async:y.get(id.PROP.async),action:y.get(id.PROP.action),data:y.get(id.PROP.data),CORS:y.get(id.PROP.CORS),bOnlyResponseEmptyIsOK:y.get(id.PROP.bOnlyResponseEmptyIsOK)};this._uploadType=new Np(C);var x=this._uploadType.get(Np.PROP.ajaxConfig);return x&&(x.dataType=y.get(id.PROP.dataType),x.async=y.get(id.PROP.async),x.retry=y.get(id.PROP.retry)),this._uploadType.on(Np.event.SUCCESS,TS(y,yB,kce),y),this._uploadType.on(Np.event.ERROR,TS(y,yB,kce),y),this._uploadType.on(Np.event.PROGRESS,TS(y,Rce,cje),y),this._uploadType}function cje(y){this.fire(id.event.PROGRESS,y)}function kce(y){var C=this,x=y.status,w=y.msg,T=C.get("file");U.mix(y,{file:T}),"success"===x?C.fire(id.event.SUCCESS,y):(!1===w||("abort"===w?U.mix(y,{canceled:!0}):"timeout"===w&&U.mix(y,{timeout:!0})),C.fire(id.event.ERROR,y))}id=mm,Dn(mm,"event",{SUCCESS:"success",ERROR:"error",PROGRESS:"progress"}),Dn(mm,"PROP",{action:"action",retry:"retry",timeout:"timeout",CORS:"CORS",async:"async",dataType:"dataType",fileStatus:"fileStatus",data:"data",bOnlyResponseEmptyIsOK:"bOnlyResponseEmptyIsOK"});var Lr={Loading:"Processing...",LoadingTiff:"Processing tiff...",LoadingPdf:"Processing pdf...",Encoding:"Processing...",ConvertingToBlob:"Converting to blob...",ConvertingToBase64:"Converting to base64...",SavingPdf:"Saving pdf...",SavingTiff:"Saving tiff...",Downloading:"Downloading...",Uploading:"Uploading...",Transfer:"Transferring...",CanvasLoading:"Loading ...",Err_ServiceModeNotSupportMobile:"Service Mode does not support your Operating System. Please contact the site administrator."};function _B(y,C){ge.detect.bMaskShow=!0,Ce.DWT.ScanDirectly||U.isFunction(Ce.DWT.OnWebTwainPreExecute)&&Ce.DWT.OnWebTwainPreExecute(y,C)}function CB(){ge.detect.bMaskShow=!1,Ce.DWT.ScanDirectly||U.isFunction(Ce.DWT.OnWebTwainPostExecute)&&Ce.DWT.OnWebTwainPostExecute()}var Mce=de.bWin,uje=de.bMac,dje=de.bLinux,hje=de.bSafari,fje=de.bFirefox,pje=de.bChrome,gje=location.hostname,oh=location.pathname,bB=0,VA=de.bMobile,Oce=parseFloat(de.strBrowserVersion);if(de.bWin||de.bMac||de.bLinux||de.bChromeOS){if(Ce.navInfo){var jA=Ce.navInfo;VA=VA||jA.bAndroid||jA.bPad||jA.biPhone||jA.biPad}}else VA=!0;""===gje?Mce&&oh.lastIndexOf("\\")>1?oh=oh.substring(1,oh.lastIndexOf("\\")).replace(/%20/g," "):(bB=1,oh=oh.substring(1,oh.lastIndexOf("/")).replace(/%20/g," ")):(bB=1,oh=oh.substring(0,oh.lastIndexOf("/")));var Po={bChrome:pje,bFirefox:fje,bSafari:hje,bIE:de.bIE,bEdge:de.bEdge,bWin:Mce,bMac:uje,bLinux:dje,iPluginLength:0,bFileSystem:de.bFileSystem,bMobile:VA,strIEVersion:de.IEVersion,strChromeVersion:de.bChrome?Oce:"",strFirefoxVersion:de.bFirefox?Oce:"",basePath:oh,pathType:bB,isDesktopViewer:function(){return de.bWin||de.bLinux||de.bChromeOS||de.bMac},isPadViewer:function(){return de.bPad||de.biPad},isMobileViewer:function(){return de.bMobile||de.biPhone||de.bAndroid||de.bHarmonyOS},WSVersion:"18.5.0",WSSession:(new Date).getTime(),bDiscardBlankImage:vt},lr={getImageUrl:function(y,C,x,w,T){var A,D=[y];if(U.isNumber(C)&&C<0)return"";if(null!=C&&(D.push("&index="),D.push(C)),D.push("&width="),D.push(x),D.push("&height="),D.push(w),Po.bMobile&&D.push("&type=1&quality=85"),D.push("&ticks="),D.push(T||Date.now()),A=D.join(""),de.bFileSystem&&A.indexOf("dwt://")<0){var M=new Image;M.crossOrigin="anonymous",M.src=A,M=null}return A},getUrlByAct:function(y,C,x){var w=[y];return null!=C&&(w.push("&index="),w.push(C)),x&&(w.push("&act="),w.push(x)),w.push("&ticks="),w.push(Date.now()),w.join("")},output:function(y,C){U.debug&&U.log(C)},print:function(y){var x=850,w=1120,T=0,A=0,D=0,M="";for(St.bHTML5Edition&&(de.bIE&&(w=1160),de.bFirefox&&(w=1150),Ce.navInfoSync.bMac&&Ce.navInfoSync.bSafari&&(w=900)),T=0;T<y.length;T++){var B=w,H=y[T],Y=H.Width,G=H.Height,q=H.Url;Y<=0&&(Y=x),G<=0&&(G=B);var re=x/Y,se=B/G;re<se?B=Math.floor(G*re):re>se&&(x=Math.floor(Y*se)),A+=Y,D+=G,M=M+'<div style="width:'+x+"px;height:"+B+'px"><img id="D_img'+T+'" src="'+q+'" style="position:relative;left:0px;top:0px;width: '+x+"px;height: "+B+'px" referrerpolicy="strict-origin-when-cross-origin" /></div>'}var ce,ve=["alwaysRaised=yes,z-look=yes,top=0,left=0,toolbar=no,menubar=no,location=no,status=no,width=",A,",height=",D].join(""),Te=window.open("about:blank","_blank",ve);Te&&(Te.document.write('<html><body id="D_body">'+M+"</body></html>"),Te.document.close(),Te.focus(),(ce=Te.document.getElementById("D_body"))?ce.onload=function(){Te&&Te.print(),U.log("print image...ok")}:U.log("cannot find image"))}};ge.html5.Funs2=lr;var Zt,mje=U.isString,vje=U.isArray,yje=U.each;function IS(y,C){if(mje(C))y.push('"'),y.push(C),y.push('"');else if(vje(C)){var x=Lt;y.push("["),yje(C,function(w){x?x=vt:y.push(","),IS(y,w)}),y.push("]")}else y.push(void 0===C?'""':C)}function It(){for(var y=[],C=arguments.length,x=new Array(C),w=0;w<C;w++)x[w]=arguments[w];if(x.length>0)if(1===x.length){var T=x[0];y.push("["),IS(y,T),y.push("]")}else if(2===x.length){var A=x[0],D=x[1];y.push("["),IS(y,A),y.push(","),IS(y,D),y.push("]")}else IS(y,Array.prototype.slice.call(x));return y.join("")}function Bp(y){return y instanceof ArrayBuffer||y instanceof Uint8Array||y instanceof Uint16Array||y instanceof Uint32Array||y instanceof Int8Array||y instanceof Int16Array||y instanceof Int32Array||window.Uint8ClampedArray&&y instanceof window.Uint8ClampedArray||y instanceof Float32Array||y instanceof Float64Array}!function(y){y.TWAINSCANNER=16,y.WIASCANNER=32,y.TWAINX64SCANNER=64,y.ICASCANNER=128,y.SANESCANNER=256,y.ESCLSCANNER=512,y.WIFIDIRECTSCANNER=1024,y.WIATWAINSCANNER=2048}(Zt||(Zt={}));var _je=Zt.TWAINSCANNER|Zt.WIASCANNER|Zt.TWAINX64SCANNER|Zt.ICASCANNER|Zt.SANESCANNER|Zt.ESCLSCANNER|Zt.WIFIDIRECTSCANNER|Zt.WIATWAINSCANNER,ES=Zt.TWAINSCANNER|Zt.WIASCANNER|Zt.TWAINX64SCANNER|Zt.ICASCANNER|Zt.SANESCANNER,Cje=Zt.TWAINSCANNER|Zt.WIATWAINSCANNER|Zt.TWAINX64SCANNER|Zt.ICASCANNER|Zt.SANESCANNER,xB=Zt.ESCLSCANNER|Zt.WIFIDIRECTSCANNER,Q1=Zt.TWAINSCANNER|Zt.WIATWAINSCANNER,bje=1;function DS(){return(++bje).toString()}function Fce(){return["dwt_",U.getRandom()].join("")}var vf=0;function Bo(y,C,x){if(U.log("showMask:"+y+"--"+vf),0==vf)if(C){_B(C);var w=ge.mask.dlgMask;if(w){w.style.zIndex="10000";var T=U.sizzle(".dynamsoft-backdrop",w.parentNode);T&&T.length>0&&(T[0].style.zIndex="10000")}}else _B(x||{});vf++}function Gr(y){U.log("hideMask:"+y+"--"+vf),vf>1?vf--:vf<=1&&(CB(),vf=0)}var Lce=g(function y(C,x){l(this,y),Dn(this,"m_server",""),Dn(this,"m_iUsingTime",0),Dn(this,"m_countMap",{}),Dn(this,"m_newConsum",!1),Dn(this,"m_mapSavedToDb",!1),this.clearData(),this.m_enumInstance=C,C==Ce.DWT.EnumInstance.dwt_desktop?(this.m_deploymentType="desktop",this.m_server=x):C==Ce.DWT.EnumInstance.dbr&&(this.m_deploymentType="browser",this.m_server="")},[{key:"clearData",value:function(){this.m_iUsingTime=0,this.m_jvUsingTime=U.nil,this.m_countMap={},this.m_newConsum=!1,this.m_mapSavedToDb=!1,this.m_minExpiredTime=U.nil,this.m_maxExpiredTime=U.nil,this.m_cu=U.nil,this.m_ar=U.nil,this.m_ltsInstance=U.nil}},{key:"set_cu",value:function(y){this.m_cu=y}},{key:"get_cu",value:function(){return this.m_cu}},{key:"set_ar",value:function(y){this.m_ar=y}},{key:"get_ar",value:function(){return this.m_ar}},{key:"get_ltsInstance",value:function(y){return this.m_ltsInstance||(this.m_ltsInstance=y(this.m_enumInstance)),this.m_ltsInstance}},{key:"inited_ltsInstance",value:function(){return!!this.m_ltsInstance}},{key:"set_maxExpiredTime",value:function(y){this.m_maxExpiredTime=y}},{key:"get_maxExpiredTime",value:function(){return this.m_maxExpiredTime}},{key:"set_minExpiredTime",value:function(y){this.m_minExpiredTime=y}},{key:"get_minExpiredTime",value:function(){return this.m_minExpiredTime}},{key:"get_deploymentType",value:function(){return this.m_deploymentType}},{key:"get_enumDeploymentType",value:function(){return this.m_enumInstance}}]),Pt=Ce.DWT;Pt.LTS=Pt.LTS||{},Pt.licenseException={code:0,message:"",fromLTS:!1},Pt.bLTSOnline=!0,Pt.axInstance=void 0,Pt.lOnUpdateDWObj=[],Pt.EnumInstance={dwt_desktop:0,dwt_browser:1,dbr:2};var Wp,bl=0,sh={},AS=!1,Z1=!1,PS=!1,wB=!1,RS=!1;function Nce(){var y=St.handshakeCode;return U.isString(y)||(y=""),y}function Bce(){var y=St.organizationID;return U.isNumber(y)?y=""+y:U.isString(y)||(y=""),y}function SB(){return U.replaceAll(su.JSVersion,",",".")}function Cs(y,C){var x=y;return x===U.nil&&(x=Pt.EnumInstance.dwt_desktop),x==Pt.EnumInstance.dbr?(Pt._dbrLicense||(Pt._dbrLicense=new Lce(x,"")),Pt._dbrLicense):(Pt._dwtDLicense||(Pt._dwtDLicense=new Lce(x,"")),Pt._dwtDLicense)}Pt.lupverfy=function(){Cs(Pt.EnumInstance.dwt_desktop).get_ltsInstance(yf),Cs(Pt.EnumInstance.dbr).get_ltsInstance(yf)},Pt.lsmid=function(y,C){Cs(Pt.EnumInstance.dwt_desktop).set_cu(y)},Pt.lsar=function(y,C){Cs(Pt.EnumInstance.dwt_desktop).set_ar(y)},Pt.lsmid2b=function(y){Cs(Pt.EnumInstance.dwt_desktop).set_cu(y)},Pt.lgar=function(y,C){Cs(y).get_ar()},Pt.laddDWTObj=function(y){var C=!1;U.each(Pt.lOnUpdateDWObj,function(x){if(x==y)return C=!0,!1}),C||Pt.lOnUpdateDWObj.push(y)},Pt.lremoveDWTObj=function(y){U.each(Pt.lOnUpdateDWObj,function(C,x){if(C==y)return Pt.lOnUpdateDWObj.splice(x,1),!1})},Pt.lsendUpdateEvt=function(y,C){var x=[];if(U.each(Pt.lOnUpdateDWObj,function(A){y==Pt.EnumInstance.dwt_desktop&&x.push(A)}),0==x.length)return ge.Promise.resolve();var w,T=x[0];return T._bAx?(U.each(x,function(A){A.SetLTSInfo(Cs(y).get_ar(),Cs(y).get_cu())}),T.GetLicenseInfo().then(function(A){A&&U.isArray(A.Detail)&&A.Detail.length>0&&Pt.lsexp(y,A.Detail[0].ExpireDate,C)})):(w=T.SetLTSLicenseAsync(Cs(y).get_ar()).then(function(A){A&&U.isArray(A.Detail)&&A.Detail.length>0&&Pt.lsexp(y,A.Detail[0].ExpireDate,C)}),U.each(x,function(A,D){0!=D&&A.SetLTSLicenseAsync(Cs(y).get_ar())}),w)},Pt.lgcb=function(){var y=[];return de.bChrome?y.push("Chrome"):de.bFirefox?y.push("Firefox"):de.bEdge?y.push("Edge"):de.bIE?y.push("IE"):de.bSafari?y.push("Safari"):de.bOpera?y.push("Opera"):de.b360SE?y.push("360SE"):de.bTencentTraveler?y.push("TencentTraveler"):de.bMaxthon?y.push("Maxthon"):de.bMetaSr?y.push("MetaSr"):de.bTheWorld?y.push("TheWorld"):de.bUC?y.push("UC"):de.bHuaWeiBrowser&&y.push("HuaWeiBrowser"),y.push(de.strBrowserVersion),de.bWin?y.push("Windows"):de.bMac?y.push("Mac"):de.bLinux?y.push("Linux"):de.bAndroid?y.push("Android"):de.bChromeOS?y.push("ChromeOS"):de.bHarmonyOS?y.push("HarmonyOS"):Po.bMobile?y.push("Mobile OS"):Ce.navInfo.bEmbed&&y.push("Embed OS"),y.join(" ")};function yf(y){var C,x,w=St.licenseServer;if(w&&w.length>0)for(C=0;C<w.length;C++)U.endsWith(x=w[C],"/")||(w[C]=x+"/");var T={dm:location.origin?U.startsWith(location.origin,"http")?location.origin:"https://localhost":U.startsWith(location.href,"http")?location.href:"https://localhost",lf:ge.localforage,btoa:U.btoa,atob:U.atob,sutlcb:function(){U.isFunction(Pt.lonsend)&&Pt.lonsend()},fol:Pt.OnFirstOffline,dwt:!0};if(T.feab=y==Pt.EnumInstance.dwt_browser||y==Pt.EnumInstance.dbr?Pt.lfeab_wasm:Pt.lfeab_ax,!de.bIE&&St.ltsDebug&&(T.debugLog=console.log),Ce.LTS&&Ce.LTS._)return Ce.LTS._.createLtsInstance(T);var A={},D=function(){return ge.Promise.reject({code:-2446,message:"The dynamsoft.lts.js load failed."})};return A.i=D,A.s=D,A.u=D,A.caret=D,A}function HA(y,C){var x=null!=C?C:"",w=Cs(y),T=w.get_enumDeploymentType();if(Pt.lclex(),w.get_ar()&&w.get_cu())return ge.Promise.resolve({ar:w.get_ar(),cu:w.get_cu()});var A={pd:Pt.lgpd(y),v:SB(),os:Pt.lgcb(),fn:Pt.DeviceFriendlyName||"",ls:St.licenseServer,sp:St.sessionPassword,l:pn.getLTSLicense(),mnet:function(){return w.get_maxExpiredTime()},mxet:function(){return w.get_minExpiredTime()},fol:Pt.OnFirstOffline};if(A.dt=w.get_deploymentType(),T==Pt.EnumInstance.dwt_desktop){var D;if(""==w.get_cu())return au(D={}),ge.Promise.reject({code:D._errorCode,message:D._errorString});A.lsu=w.get_cu()}else T==Pt.EnumInstance.dbr||(A.dwt=!0,""!=w.get_cu()&&(A.lsu=w.get_cu()),A.updateLicense=function(M){w.set_ar(M.ar),w.get_cu()||w.set_cu(M.cu),Pt.lsendUpdateEvt(T,x)});return w.get_ltsInstance(yf).i(A).then(function(M){return w.get_ar()||w.set_ar(M.ar),w.get_cu()||w.set_cu(M.cu),M},function(M){throw w.clearData(),M})}function vm(){return Date.now()}function y0(y){var C=y?new Date(y):new Date,x="yyyy-MM-ddTHH:mm:ss.SSSZ",w={"M+":C.getUTCMonth()+1,"d+":C.getUTCDate(),"H+":C.getUTCHours(),"h+":C.getUTCHours()%12||12,"m+":C.getUTCMinutes(),"s+":C.getUTCSeconds(),"q+":Math.floor((C.getUTCMonth()+3)/3),"S+":C.getUTCMilliseconds()};for(var T in/(y+)/.test(x)&&(x=x.replace(RegExp.$1,(C.getUTCFullYear()+"").substr(4-RegExp.$1.length))),w)new RegExp("("+T+")").test(x)&&(x=x.replace(RegExp.$1,1==RegExp.$1.length?w[T]:("000"+w[T]).substr(("000"+w[T]).length-RegExp.$1.length)));return x}function TB(y,C){var x;y.__licenseInfo=C,(x=y).__calic||(x.__calic=x.__licenseInfo)}function GA(y){var C=Ce.DWT.licenseException;C.code=y.code,C.message=y.message,y&&(Wce(y),y instanceof Error?U.error(y):U.error(U.stringify(y)))}function Wce(y){U.isFunction(Ce.DWT.OnWebTwainError)?Ce.DWT.OnWebTwainError(y):U.isFunction(window.Dynamsoft_OnError)&&window.Dynamsoft_OnError(y)}function zA(y){return y==Qs.LicenseExpiredForDLS||y==Qs.LicenseNoCoreForDLS||y==Qs.LicenseNoCore||y==Qs.LicenseInvalid||y==Qs.LicenseExpired||y==Qs.LicenseParseFailed||y==Qs.LicenseIsFuture||y==Qs.LicenseVersionNotCurrent}function Uce(y){return y==Qs.LicenseExpired}function IB(y){var w,T,C=0,x=y.message;U.isNumber(y.code)?C=y.code:U.isString(x)&&(C=-1),0!=C&&(w=C,T=x,U.isFunction(Ce.OnLicenseError)&&Ce.OnLicenseError(T,w))}function Vce(y){IB(Qi(y))}Pt.lgpd=function(y){return de.bWin&&y==Pt.EnumInstance.dwt_desktop?"dwt|dbr":"dwt"},Pt.lglic=HA,Pt.lgbuuid=function(){return""},Pt.lshow=function(){return{t:Wp,t2:bl,m:U.stringify(sh)}},Pt.lgct=function(y){switch(y){case 0:return"3011";case 1:return"3012";case 2:return"3014";case 3:return"3013";case 4:return"3015";case 14:return"3016";case 3001:return"3001";case 3002:return"3002";case 3003:return"3003";case 3004:return"3004";case 3005:return"3005";case 3006:return"3006";case 3007:return"3007";case 3008:return"3008";case 3009:return"3009";case 5001:return"5001";case 4001:return"4001";case 4002:return"4002";case 4003:return"4003"}return""},Pt.lcvrf=function(y){y&&(y._canConsume&&!y._canConsume()||setTimeout(function(){Pt.lcvrf_(y)},1))},Pt.lcvrf_=function(y){var C;C=Pt.EnumInstance.dwt_desktop;var x,w=Pt.DeviceFriendlyName||"",T=Pt.lgcb(),A=Cs(C),D={hs:Nce(),og:Bce(),cu:A.get_cu(),fn:w,cw:"",os:T,v:SB(),dt:A.get_deploymentType(),ed:"js"},M=function(G,q){var re,se,ce=0;if(U.isString(G)&&""!=G&&"{}"!=G&&q&&U.isArray(q)&&!(q.length<1)){if(se=Cs(q[0]),re=U.parse(G),Pt.lclex(),0==bl){var ve=vm(),Te="";bl=ve,Wp=y0(ve),sh={},ce=0,U.each(re,function(Ue,je){(je<ce||0==ce)&&(ce=je,Te=Ue)}),ce>0&&se.get_ltsInstance(yf).s(St.licenseServer,Te,ce,!0).then(function(){},function(Ue){})}U.each(re,function(Ue,je){var Ee=!1,Oe=parseInt(je);Oe>0&&Oe!=ce&&(Oe+18e4<vm()&&(Ee=!0),se.get_ltsInstance(yf).s(St.licenseServer,Ue,je,Ee).then(function(){},function(He){}))})}};if(D.pd=Pt.lgpd(C),x=U.stringify(D),!y._bAx){var B="GetBuffer",H=It(U.replaceAll(x,'"','\\"')),Y={cmd:B,cmdId:DS(),sFun:M,fFun:function(){},params:[C]};return y._innerSendByWS(B,H,Y,null,!0)}M(y.GetBuffer(x),[C,""])},Pt.lavrf=function(y,C,x,w){var T=1;if(""!=y){C>1&&(T=C);var A=vm();if(bl>0&&bl+18e4<A){Z1?(sh={},Pt.lavrf__unload()):Pt.lavrf__(!0,x,w);var D=vm()+1;bl=D,Wp=y0(D),sh={}}AS=!0,Z1=!1,sh[y]?sh[y]+=T:sh[y]=T,0==bl&&Pt.lavrf__(!0,x,w)}},Pt.lavrf_=function(y,C,x){if(AS){var w=1;y&&(w=y),setTimeout(function(){Pt.lavrf__(!1,C,x)},w)}},Pt.lavrf__=function(y,C,x){var w,A,D=vm(),M=!1,B=!!y,H=0,Y=C;U.isUndefined(Y)&&(Y=Pt.EnumInstance.dwt_desktop),A=Cs(Y),AS=!1,0==bl&&(M=!0,bl=D,Wp=y0(D)),w=bl;var G={};G.ut=Wp;var q={};if(U.each(sh,function(Ue,je){q[je]=Ue,Ue>0&&H++}),G.cts=q,B||w+18e4<D){B=!0;var re=vm()+1;if(bl=re,Wp=y0(re),sh={},Z1=!1,0==H)return}else{if(0==H)return;Z1=!0}G.dur=M?1:180;var se,ce=Pt.DeviceFriendlyName||"",ve=Pt.lgcb(),Te={hs:Nce(),og:Bce(),cu:A.get_cu(),fn:ce,cw:"",os:ve,v:SB(),dt:A.get_deploymentType(),ed:"js",rcs:[G]};Te.product=Pt.lgpd(C),se=U.stringify(Te),St.ltsDebug&&y0(),Pt.lclex(),A.get_ltsInstance(yf).s(St.licenseServer,se,""+w,B).then(function(){},function(Ue){})},Pt.lavrf__unload=yt(W.mark(function y(){var C,x,w,T,A,D,M;return W.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(C=vm(),x=!0,T=!1,A=Cs(Pt.EnumInstance.dwt_desktop),D=Cs(Pt.EnumInstance.dbr),AS=!1,0==bl&&(bl=C,Wp=y0(C)),w=bl,M=vm()+1,bl=M,Wp=y0(M),sh={},Z1=!1,w+=1,Pt.lclex(),!A.inited_ltsInstance()){B.next=20;break}return B.prev=13,B.next=16,A.get_ltsInstance(yf).s(St.licenseServer,T,""+w,x);case 16:B.next=20;break;case 18:B.prev=18,B.t0=B.catch(13);case 20:if(!D.inited_ltsInstance()){B.next=28;break}return B.prev=21,B.next=24,D.get_ltsInstance(yf).s(St.licenseServer,T,""+w,x);case 24:B.next=28;break;case 26:B.prev=26,B.t1=B.catch(21);case 28:case"end":return B.stop()}},y,null,[[13,18],[21,26]])})),Pt.lclex=function(){var y=Pt.licenseException;y.code=0,y.message="",y.httpResponse="",y.fromLTS=!1},Pt.li=function(y,C){var x;return y.axInstance&&(Pt.axInstance=y.axInstance,Pt.axInstance)?(x=Pt.axInstance.GetUUID(),St.ltsDebug&&U.log("ActiveX cu: "+x),Cs(y.instanceMode).set_cu(x),x):Cs(y.instanceMode).get_cu()},Pt.lfeab_ax=function(y){return new ge.Promise(function(C,x){var w="";if(Pt.axInstance)try{w=Pt.axInstance.Encrypt(y,0)}catch(T){}C(w)})},Pt.lfeab_wasm=function(y){return ge.Promise.resolve("")},Pt.lwsproc=function(y,C){try{y=U.parse(y)}catch(x){return void(C.fFun&&C.fFun(x))}"GetBuffer"==y.method?C.sFun(C.sFun&&y.result.length>0?y.result[0]:"",C.params):C.sFun&&C.sFun(y)},Pt.lsexp=function(y,C,x){var w,T=C;if(3==(w=(T=U.replaceAll(T,"/","-")).split("-")).length){var A=w[0],D=w[1],M=w[2];D.length<2&&(D=(D="00"+D).substr(D.length-2)),M.length<2&&(M=(M="00"+M).substr(M.length-2)),T=[A,D,M].join("-")}var B=[T,"T23:59:59.999Z"].join("");Cs(y).set_minExpiredTime(B),Cs(y).set_maxExpiredTime(B)},Pt.lunload=yt(W.mark(function y(){return W.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,Pt.lavrf__unload();case 2:bl=0,Wp=U.nil,sh={},Z1=!1,AS=!1,PS=!1,wB=!1,RS=!1,Pt.lclex(),Pt.bLTSOnline=!0,Pt.axInstance=U.nil,Pt.lOnUpdateDWObj=[];case 14:case"end":return C.stop()}},y)})),Pt.lcexp=function(y,C){return Cs(y).get_ltsInstance(yf).caret().then(function(){return!1},function(x){var w=Pt.licenseException,T="";return x instanceof Error||"message"in x?T=x.message:U.isString(x)&&(T=x),Pt.lsetException(-2445,T,!1),wB||(wB=!0,U.error(T),Ce.OnLTSLicenseError&&Ce.OnLTSLicenseError(pn.getPublicLicenseContent(w.message),w.code)),!0})},Pt.OnLicenseException=function(){var y=Pt.licenseException,C=y.message;if(U.isString(C)&&(C.indexOf("Error Code")>-1?C=U.replaceAll(C,"Error Code","error code"):C.indexOf("Error code")>-1&&(C=U.replaceAll(C,"Error code","error code"))),C.indexOf("(https://www.dynamsoft.com/purchase-center/)")>-1&&(C=C.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamic-web-twain/)"),y.message=C),C.indexOf("error code:")>-1){var x=C.substr(0,C.indexOf("message")),w=C.substr(C.indexOf("message"));x.indexOf("{")>-1&&(x=x.substr(x.indexOf("{")+1)),w.indexOf("}")>-1&&(w=w.substr(0,w.indexOf("}"))),x=U.replaceAll(x,"error code:",""),w=U.replaceAll(w,"message: ",""),Pt.lsetException(parseInt(x),w,!0),U.error(w),Ce.OnLTSLicenseError&&Ce.OnLTSLicenseError(pn.getPublicLicenseContent(C),y.code)}else{if(!y.code){var T=-2440;C.indexOf("timed out")>-1||C.indexOf("timeout")>-1?T=-2441:(C.indexOf("access-control-allow-origin")>-1||C.indexOf("cors")>-1)&&(T=-2443),Pt.lsetException(T,C,!0)}if(U.error(y.message),-2446==y.code)return;Ce.OnLTSLicenseError&&Ce.OnLTSLicenseError(pn.getPublicLicenseContent(y.message),y.code)}},Pt.lol=function(){return Pt.bLTSOnline},Pt.OnFirstOffline=function(y){Pt.bLTSOnline=!1},Pt.lpubdlg=function(y,C){if(U.isString(y)&&""!=y){if(y=U.atob(y),1==C)return PS||(PS=!0,Ce.OnLTSPublicLicenseWarning&&Ce.OnLTSPublicLicenseWarning(pn.getPublicLicenseContent(y))),!0;2==C&&(PS||(PS=!0))}return!1},Pt.lcheckLic=function(y,C,x){var w=!1;if(C){if(U.isArray(C.Detail)&&C.Detail.length>0)return Pt.lsexp(y,C.Detail[0].ExpireDate,x),Pt.lcexp(y,x).then(function(A){var D=!1;A?D=!0:1!=C.Trial&&2!=C.Trial||(D=Pt.lpubdlg(C.Message,C.Trial)),D||Pt.bLTSOnline||RS||(RS=!0,Ce.OnLTSConnectionWarning&&Ce.OnLTSConnectionWarning())});1!=C.Trial&&2!=C.Trial||(w=Pt.lpubdlg(C.Message,C.Trial))}return w||Pt.bLTSOnline||RS||(RS=!0,Ce.OnLTSConnectionWarning&&Ce.OnLTSConnectionWarning()),ge.Promise.resolve()},Pt.lisValidID=function(y){if(U.isString(y)&&""!=y)return!0;var x=Pt.licenseException;return Pt.lsetException(-2447,"Failed to generate an ID for your device to license it: not enough permission.",!0),U.error(x.message),Ce.OnLTSLicenseError&&Ce.OnLTSLicenseError(x.message,x.code),!1},Pt.lsetException=function(y,C,x){var w=Pt.licenseException;w.code=y,w.message=C,U.isUndefined(x)||(w.fromLTS=x)},Pt.lgcuid=function(y){var C=Ce.DWT.li({instanceMode:y},"");return C?ge.Promise.resolve(C):Cs(y).get_ltsInstance(yf).u().then(function(x){return Ce.DWT.lsmid(x,""),Ce.DWT.lsmid2b(x),x})};var rd,EB=g(function y(){l(this,y)});function DB(y){var C=new EB;return C.server=y.server,C.normal=!0,y.attrs&&(C.attrs=U.clone(y.attrs)),C}function AB(y,C,x){if(U.isString(y)&&(y.indexOf("Function not found")>0||y.indexOf("Version not found")>0))C&&C(y);else{var w=y.data;if("object"===p(w))return w=null,y=null,void(x&&x());var T=w.replace(/\0/g,"");try{C&&C(T)}catch(A){U.log(w),x&&x()}w=null,y=null}}function PB(y,C){y&&y.readyState!=rd.CLOSING&&y.readyState!=rd.CLOSED?y.readyState==rd.CONNECTING?(y.onerror=function(x){x&&U.log("websocket error: "+x),y._reject&&(y._reject(x),y._reject=null),y.close()},y.onclose=function(x){y.onclose=null,y.onerror=null,y.onmessage=null,y.onopen=null,y._reject=null},y.onopen=function(){y.readyState==rd.OPEN?(y.onopen=null,y.send(C)):y.readyState==rd.CONNECTING&&(y.onopen?setTimeout(y.onopen,100):y._reject&&(y._reject(),y._reject=null))}):y.readyState==rd.OPEN&&(y.onopen=null,y.send(C)):y._reject&&(y._reject({closed:!0}),y._reject=null)}function jce(y,C,x){var w,T=x;return T||(Ce.DWT.ConnectWithSocket?U.startsWith(y,"wss://")||U.startsWith(y,"ws://")||(T=de.bSSL?"wss://":"ws://"):U.startsWith(y,"https://")||U.startsWith(y,"http://")||(T=de.bSSL?"https://":"http://")),C?(U.endsWith(y,"/")&&(y=y.substring(0,y.length-1)),w=":"+C+"/"):U.endsWith(y,"/")||(w="/"),[T,y,w].join("")}!function(y){y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3}(rd||(rd={}));var Ja,Up=function(){function y(){l(this,y)}return g(y,null,[{key:"postStringDataByWS",value:function(C,x){return new ge.Promise(function(w,T){C.onmessage=function(A){AB(A,function(D){w(D),C.close(),C=null},function(){T(),C.close(),C=null})},C._reject=T,PB(C,x)})}},{key:"postStringDataByWSUrl",value:function(C,x){var w=new ge.Promise(function(T,A){var D=y.newWebsocket(C,!1);D.onmessage=function(M){AB(M,function(B){T(B),D.close(),D=null},function(B){A(B),D.close(),D=null})},D._reject=A,PB(D,x)});return de.bEdge&&w.catch(function(){return new ge.Promise(function(T,A){var D=y.newWebsocket(C,!0);D.onmessage=function(M){AB(M,function(B){T(B),D.close(),D=null},function(B){A(B),D.close(),D=null})},D._reject=A,PB(D,x)})}),w}},{key:"newWebsocket",value:function(C,x){var w,T=$n.wsProtocol,A=window.MozWebSocket;if(void 0!==A)w=T?new A(C,T):new A(C);else{var D=window.WebSocket;if(x){var M=window,B=parent;try{for(;M!=B&&B.WebSocket;)D=B.WebSocket,M=B.window,B=B.parent}catch(H){D=window.WebSocket}}w=T?new D(C,T):new D(C)}return w}},{key:"getWsUrl",value:function(C,x,w){var T=w;return void 0===T&&(T=de.bSSL),jce(C,x,T?"wss://":"ws://")}},{key:"getDDMUrl",value:function(C,x,w){var T,A,D="/";return U.startsWith(C,"https://")?T=!0:U.startsWith(C,"http://")?T=!1:C=(T=ge.detect.ssl)?"https://"+C:"http://"+C,A=T?"18626/":"18625/",U.endsWith(C,"/")&&(D=""),x?[C,D,"ddm/",A,w].join(""):[C,D,w].join("")}},{key:"getModuleUrl",value:function(C){var x;return x=jce(Ya(),de.bSSL?Ce.DWT.SSLPort:Ce.DWT.Port),C?x+C:x}}])}();Ce.DWT.NetManager=Up,function(y){y.ST_UNKNOWN=0,y.ST_TWAIN_DIRECT=1,y.ST_DYNAMSOFT_SERVICE=2,y.ST_ESCL=3,y.ST_WIFI_DIRECT=4}(Ja||(Ja={}));var _0,Ti,C0,xje=g(function y(C){l(this,y);var x=this;if(x._id=C.id,x._clientId=U.getRandom(),x._uuidForActiveUI=null,x._bReady=vt,x._destroy=vt,x._bMustUpgradeService=vt,x._wsClient=null,x._wsRetry=0,x._wsFailedTimes=0,x._bConnecting=vt,x._bNoMask=vt,x._bNotShowMessage=vt,x.__serverPlatform=Rn.enumWindow,x.__productKey="",x.__licenseInfo=null,x._reconnectTimeSpan=xo.RemoteReconnectTimeSpan,x._reconnectShortSpan=300,x._reconnectShortSpanTimes=5,x._bIfShowProgressBar=Lt,x.__IfShowCancelDialogWhenImageTransfer=Lt,x._bLicenseErrorDispose=!0,C.dmService){var w,T,A,D,M,B,H=DB(C.dmService),Y="/",G="";T=H.server;var q=new g7(C.dmService.server),re=q.scheme;re&&(re=re.toLowerCase()),"https"==re?(w=!0,A=T.substring(8)):"http"==re?(w=!1,A=T.substring(7)):"wss"==re?(w=!0,A=T,T=U.replaceAll(T,"wss://","")):"ws"==re?(w=!1,A=T,T=U.replaceAll(T,"ws://","")):(A=T,T=(w=ge.detect.ssl)?"https://"+T:"http://"+T),x._bRemoteMode=mc(q.hostname||q.scheme)?vt:Lt,U.endsWith(T,"/")&&(Y="");var se=H.attrs;if(se){var ce,ve;D=(null===(ce=se)||void 0===ce?void 0:ce.UUID)||"";var Ue,Te=(null===(ve=se.modules)||void 0===ve?void 0:ve.length)||0;""!=D&&Te>0&&(w?Te>1&&Te>1+(Ue=se.modules[1])+2&&(M=se.modules[1+Ue+2]):Te>2&&(M=se.modules[2]),U.endsWith(M,"/")&&(Y=""),G=[D,"/",M,"/"].join(""))}else se={UUID:"",service_type:Ja.ST_DYNAMSOFT_SERVICE};B=[T,Y,G].join(""),se.url=B,x._serverInfo=new g0([A,Y,G].join(""),null,w,!0,$n.wsProtocol),x._httpUrl=B,x._dmService=H}else{var je,Ee=ge.detect.ssl,Oe=C.port,He=C.sslPort;x._bRemoteMode=!mc(je=C.host?C.host:Ya()),Oe||(Oe=Ce.DWT.Port),He||(He=Ce.DWT.SSLPort),x._serverInfo=new g0(je,Ee?He:Oe,Ee,!0,$n.wsProtocol),x._httpUrl=function(we){var ue=we.server;if(ue){if(U.startsWith(ue,"wss://")||U.startsWith(ue,"ws://"))return ue}else ue=Ya();return we.ssl?["https://",ue,":",we.port,"/"].join(""):["http://",ue,":",we.port,"/"].join("")}(x._serverInfo),x._dmService={server:x._httpUrl,attrs:{url:x._httpUrl,UUID:"",service_type:Ja.ST_DYNAMSOFT_SERVICE},normal:!0}}},[{key:"_resetErr",value:function(){this._errorCode=0,this._errorString="";var y=Ce.DWT.licenseException;y.code=0,y.message=""}},{key:"dispose",value:function(){this._bReady=vt,this._destroy=Lt}},{key:"isDestroy",get:function(){return this._destroy}}]),od=g(function y(){l(this,y)});function Hce(y,C){var x,w=[],T=C;if(U.isString(T)&&(T=U.parse(T)),U.isArray(T))for(x=0;x<T.length;x++){var A=Tje(T[x]);w.push(A)}for(x=0;x<w.length;x++){var D=w[x],M=D.deviceType;D.name&&(D.name=U.base64.decode(D.name)),M&_je&&D.deviceInfo&&Sje(D.deviceInfo),D.serviceInfo=null==y?void 0:y._dmService,wje(D,null==y?void 0:y._dmService),U.isBoolean(D.isSystemDefaultPrinter)||(D.isSystemDefaultPrinter=!1)}return w}function wje(y,C){var x,w=y.name,T="",A=y.deviceType;A==Zt.TWAINSCANNER?x="":A==Zt.TWAINX64SCANNER?x="Twain64-":A==Zt.WIASCANNER?x="WIA-":A==Zt.WIATWAINSCANNER?(w=U.replaceAll(w,"WIA-",""),x="WIATWAIN-"):x=A==Zt.ICASCANNER?"ICA-":A==Zt.SANESCANNER?"Sane-":A==Zt.ESCLSCANNER?"eSCL-":"",C&&C.attrs&&C.attrs.ty&&(T=" on ["+C.attrs.ty+"]"),y.displayName=[x,w,T].join("")}function Sje(y){y.ProductName&&(y.ProductName=U.base64.decode(y.ProductName)),y.ProductFamily&&(y.ProductFamily=U.base64.decode(y.ProductFamily)),y.Manufacturer&&(y.Manufacturer=U.base64.decode(y.Manufacturer)),y.Version&&y.Version.Info&&(y.Version.Info=U.base64.decode(y.Version.Info))}function Tje(y){var C=new od;return C.strDevice=U.stringify(y),y.deviceInfo&&(C.deviceInfo=U.clone(y.deviceInfo)),y.deviceType&&(C.deviceType=U.clone(y.deviceType)),y.displayName&&(C.displayName=U.clone(y.displayName)),y.name&&(C.name=U.clone(y.name)),y.serviceInfo&&(C.serviceInfo=DB(y.serviceInfo)),C.isSystemDefaultPrinter=!!U.isBoolean(y.isSystemDefaultPrinter)&&y.isSystemDefaultPrinter,C}function Ije(y){var C=y||{};C.basePath&&(Po.basePath=C.basePath),C.pathType&&(Po.pathType=C.pathType),U.isUndefined(C.bDiscardBlankImage)||(Po.bDiscardBlankImage=C.bDiscardBlankImage),C.detectType&&(ge.detect.detectType=C.detectType),C.tryTimes&&(ge.detect.tryTimes=C.tryTimes);var x=Ce.DWT.RemoteScanConfig;x||(Ce.DWT.RemoteScanConfig=x={sessionTimeout:300,keepAwake:!0}),void 0===x.keepAwake&&(x.keepAwake=!0)}function Gce(){return!!U.getWakeLock()}function YA(y){return zce.apply(this,arguments)}function zce(){return(zce=yt(W.mark(function y(C){var x;return W.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(x=U.getWakeLock(),!C){w.next=7;break}if(null!=x){w.next=5;break}return w.next=5,U.toggleWakeLock();case 5:w.next=10;break;case 7:if(!x){w.next=10;break}return w.next=10,U.toggleWakeLock();case 10:case"end":return w.stop()}},y)}))).apply(this,arguments)}function Eje(){for(var y,C,x,w=["dynamsoft.webtwain.install.js","dynamsoft.webtwain.viewer.js","dynamsoft.lts.js","dynamsoft.webtwain.viewer.css","dynamsoft.webtwain.css"],T=document.head.childNodes,A=T.length-1;A>=0;A--)if("LINK"==(C=T[A]).tagName?x=C.href:"SCRIPT"==C.tagName&&(x=C.src),x)for(y=0;y<w.length;y++)x.indexOf(w[y])>=0&&C.remove();ge.detect.cssLoaded=!1}function Yce(y){return Xce.apply(this,arguments)}function Xce(){return(Xce=yt(W.mark(function y(C){var x;return W.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:C&&((x=document.createElement("style")).innerHTML=['@import url("',Ce.DWT.ResourcesPath,"/src/dynamsoft.webtwain.viewer.css",ge.timestamp,'")'].join(""),C.appendChild(x));case 1:case"end":return w.stop()}},y)}))).apply(this,arguments)}function $ce(y,C){var x;for(x=0;x<y.length;x++)if(y[x]==C)return!0;return!1}function RB(y){var C="application/octet-stream";switch(y){case Ti.IT_BMP:C="image/bmp";break;case Ti.IT_JPG:C="image/jpeg";break;case Ti.IT_TIF:C="image/tiff";break;case Ti.IT_PNG:C="image/png";break;case Ti.IT_PDF:C="application/pdf";break;case Ti.IT_J2K:C="image/jp2"}return C}(function(y){y.SMF_NAME=1,y.SMF_TWAINVERSION=2,y.SMF_TWAINPROTOCOL=4,y.SMF_ICAUUID=8,y.SMF_ICAMODULEVERSION=16,y.SMF_ICALOCATIONTYPE=32})(_0||(_0={})),function(y){y.IT_BMP=0,y.IT_JPG=1,y.IT_TIF=2,y.IT_PNG=3,y.IT_PDF=4,y.IT_ALL=5,y.IT_MULTIPAGE_PDF=7,y.IT_MULTIPAGE_TIF=8,y.IT_J2K=14}(Ti||(Ti={})),function(y){y.RGBA=15,y.Auto=16}(C0||(C0={}));var sd={isSupportLS:function(){var y=!1;if(!de.bEdge||!de.bFileSystem)try{y=!!window.localStorage}catch(C){}return y},item:function(y,C,x){var w=null;return this.isSupportLS()?(C?(localStorage.setItem(y,C),w=C):w=localStorage.getItem(y),null===w?x:w):x},removeItem:function(y){return!!this.isSupportLS()&&(localStorage.removeItem(y),!0)}};function Dje(y){if(U.isUndefined(y))return!1;var C,x,w,A=(w=y.toString().toLowerCase().toLowerCase().replace(St.name.toLowerCase()+" ",""),(w=U.replaceAll(w,"[.]",",")).split(","));C=St.bActiveXEdition?su.ActiveXVersion:St.getServerVersionInfo(!0),x=(C=U.replaceAll(String(C),"[.]",",")).split(",");for(var D=A.length>x.length?A.length:x.length,M=0;M<D;M++){if(null==A[M]&&(A[M]=0),null==x[M]&&(x[M]=0),parseInt(A[M])<parseInt(x[M]))return!1;if(parseInt(A[M])>parseInt(x[M]))return!0}return!0}function Jce(y,C){var x=y.split(","),w=C.split(",");return x.length>3&&U.trim(x[0])==w[0]&&(U.trim(x[1])>w[1]||U.trim(x[1])==w[1]&&U.trim(x[2])>w[2]||U.trim(x[1])==w[1]&&U.trim(x[2])==w[2]&&parseInt(U.trim(x[3]))>=parseInt(w[3]))}function Qce(y,C){ge.detect.urls.splice(0),ge.detect.urls.push({port:y,ssl:de.bSSL}),ge.detect.ports=[{port:y,ssl:de.bSSL}],ge.detect.cUrlIndex=0,$n.detect.dwtPort=y,$n.detect.dwtSSLPort=C,Ce.DWT.Port=y,Ce.DWT.SSLPort=C}function kB(y,C,x){return MB.apply(this,arguments)}function MB(){return MB=yt(W.mark(function y(C,x,w){var T,A,D;return W.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(!St.bDCPChecked){M.next=2;break}return M.abrupt("return",{host:C,port:Ce.DWT.Port,sslPort:Ce.DWT.SSLPort});case 2:return lo(jVe),M.prev=3,M.next=6,Zce(C);case 6:T=M.sent,M.next=13;break;case 9:throw M.prev=9,M.t0=M.catch(3),U.log(M.t0),j7();case 13:if(!$n.bEnhancedMode){M.next=27;break}if(lo(HVe),D=500,(A=ge.install._dlgInstall)&&A.open||(D=0),!(T.port<=0||T.sslPort<=0)){M.next=25;break}if(!(D>0)){M.next=21;break}return M.next=21,new ge.Promise(function(B,H){setTimeout(function(){B()},D)});case 21:return lo(rce),M.next=24,Pje(C);case 24:T=M.sent;case 25:M.next=28;break;case 27:T={host:C,port:x,sslPort:w};case 28:return St.bDCPChecked=!0,M.abrupt("return",T);case 30:case"end":return M.stop()}},y,null,[[3,9]])})),MB.apply(this,arguments)}function Pje(y){return OB.apply(this,arguments)}function OB(){return OB=yt(W.mark(function y(C){var x,w,T,A;return W.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:w=5,T=1500,A={host:C,port:0,sslPort:0},x=0;case 3:if(!(x<w)){D.next=22;break}return x>2&&(T=3e3),lo(rce),D.prev=6,D.next=9,Rje(C);case 9:A=D.sent,D.next=14;break;case 12:D.prev=12,D.t0=D.catch(6);case 14:if(!(U.isNumber(A.port)&&A.port>0&&U.isNumber(A.sslPort)&&A.sslPort>0)){D.next=17;break}return Qce(A.port,A.sslPort),D.abrupt("return",A);case 17:return D.next=19,new ge.Promise(function(M,B){setTimeout(function(){M()},T)});case 19:x++,D.next=3;break;case 22:throw ge.detect.dcpStatus=3,j7();case 25:case"end":return D.stop()}},y,null,[[6,12]])})),OB.apply(this,arguments)}function Rje(y){return FB.apply(this,arguments)}function FB(){return FB=yt(W.mark(function y(C){var x,w,T,D,M,B,H,Y;return W.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return x=St.refProductKey,T=U.startsWith(C,"wss://")||U.startsWith(C,"ws://")?C:Up.getWsUrl(C,de.bSSL?$n.SSLPort:$n.Port,de.bSSL),D={id:U.guid(),method:"GetPorts",version:"dwasm2_"+U1(),parameter:[$n.strSID]},pn.isLongKey(x)&&(D.productKey=x),G.next=6,Up.postStringDataByWSUrl(T,U.stringify(D));case 6:if(!U.isString(M=G.sent)){G.next=19;break}if(G.prev=8,(B=U.parse(M))&&"result"in B&&(w=B.result),!(U.isArray(w)&&w.length>1&&w[1])){G.next=15;break}if(!(H=w[1]).dwt){G.next=15;break}return G.abrupt("return",{host:C,port:H.dwt.port,sslPort:H.dwt.sslPort});case 15:G.next=19;break;case 17:G.prev=17,G.t0=G.catch(8);case 19:throw zl(Y={}),Qi(Y);case 22:case"end":return G.stop()}},y,null,[[8,17]])})),FB.apply(this,arguments)}function Zce(y){return eue.apply(this,arguments)}function eue(){return(eue=yt(W.mark(function y(C){var x,w;return W.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return $n.detect.bConnected=!1,T.prev=1,T.next=4,kje(C);case 4:return Mje(T.sent),$n.detect.bConnected=!0,T.abrupt("return",{host:C,port:$n.detect.dwtPort,sslPort:$n.detect.dwtSSLPort});case 10:if(T.prev=10,T.t0=T.catch(1),!T.t0){T.next=21;break}if(!U.isNumber(x=T.t0.code)){T.next=21;break}if(x!=Xn.ResponseDataTypeError&&x!=Xn.HTSTError&&x!=Xn.CORSError&&x!=Xn.CORSErrorFromService&&x!=Xn.SSLCertExpired&&x!=Xn.SSLCertInvalid){T.next=19;break}throw T.t0;case 19:if(x!=Xn.MustUpgrade){T.next=21;break}throw T.t0;case 21:throw $n.detect.dcpStatus=$n.detect.EnumDCP_DetectStatus.NotInstalled,Ce.dcp._sendStatusEvent(),xS(w={}),{code:w._errorCode,message:w._errorString};case 26:case"end":return T.stop()}},y,null,[[1,10]])}))).apply(this,arguments)}function kje(y){return LB.apply(this,arguments)}function LB(){return LB=yt(W.mark(function y(C){var x,w,T,D,M,B,H,Y;return W.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return x=St.refProductKey,T=U.startsWith(C,"wss://")||U.startsWith(C,"ws://")?C:Up.getWsUrl(C,de.bSSL?$n.SSLPort:$n.Port,de.bSSL),D={id:U.guid(),method:"VersionInfo",version:"dwasm2_"+xo.getVersionStrForCheck(),parameter:[]},pn.isLongKey(x)&&(D.productKey=x),G.next=6,Up.postStringDataByWSUrl(T,U.stringify(D));case 6:if(U.isString(M=G.sent))try{(B=U.parse(M))&&"result"in B&&(w=B.result)}catch(q){}if(H={},!(U.isArray(w)&&w.length>0&&w[0])){G.next=23;break}if(!U.isString(Y=w[0])||""==Y){G.next=23;break}if(!Jce(Y,St.getServerVersionInfo(!0))){G.next=18;break}return $n.detect.dcpStatus=$n.detect.EnumDCP_DetectStatus.UpdateSkipped,Ce.dcp._sendStatusEvent(),G.abrupt("return",w);case 18:throw lo(oce),H1(H),Qi(H);case 21:G.next=23;break;case 23:throw zl(H),Qi(H);case 25:case"end":return G.stop()}},y)})),LB.apply(this,arguments)}function Mje(y){var C="",x=!1,w=!1,T={};if(y.length>4&&(C=U.isString(y[2])?y[2]:"",x=U.isString(y[3])&&"true"===y[3],w=U.isString(y[4])&&"64"===y[4]),y.length>5&&(T=y[5]),$n.detect.connectedResult=y,$n.strSID=C,$n.bEnhancedMode=x,$n.b64bit=w,$n.objEnhancedPorts=T,x&&T){if(T.dcp){var A=T.dcp;$n.SSLPort=A.sslPort,$n.Port=A.port}if(T.ddm){var D=T.ddm;$n.detect.ddmPort=D?de.bSSL?D.sslPort:D.port:0}if(Ce.DWT.Port=0,Ce.DWT.SSLPort=0,T.dwt){var M=T.dwt;M&&M.port>0&&M.sslPort>0&&Qce(M.port,M.sslPort)}}}function tue(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function NB(y,C,x){return C.has(y),x}Ce.DWT.NetManager.checkModuleManager=function(y,C){Zce(Ya()).then(y,C)};var nue=new WeakSet,BB=new WeakSet,Yl=function(y){function C(we){var ue,ye,me;return l(this,C),me=[we],ye=qn(ye=C),tue(ue=$a(this,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Se){return!1}}()?Reflect.construct(ye,me||[],qn(this).constructor):ye.apply(this,me)),BB),tue(ue,nue),ue._acquireDivEL=null,ue.__serverId="",ue.__bAcquireImageNow=vt,ue._blts=Xa(),ue._bltsCopyImage=!1,ue._b64bit=$n.b64bit,ue._logLevel=0,ue._bServerAlwaysFocusOnPopupWindow=Lt,ue._bPageFocus=Lt,ue.__bOpenFileNow=vt,ue._bScanForProxyRemote=vt,ue}return qa(C,y),g(C,[{key:"_isValid",value:function(){return!this._destroy||(gle(this),!1)}},{key:"_connnect",value:(He=yt(W.mark(function we(){var ue;return W.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return ue=this,pe.abrupt("return",new ge.Promise(function(ye,me){Ce.DWT.CheckConnectToTheService(ue._serverInfo.server,ue._serverInfo.port,ye,me)}));case 2:case"end":return pe.stop()}},we,this)})),function(){return He.apply(this,arguments)})},{key:"_waitForConnect",value:function(){var we=this;return we._wsRetry=0,we._bReady?ge.Promise.resolve():new ge.Promise(function(ue,pe){we._wsCheckResolve=ue,we._wsCheckReject=pe,oue(we)})}},{key:"_getWSCallback",value:function(){return Fje}},{key:"_getWSContextData",value:function(){return{}}},{key:"_additionalWSCallback",value:function(we,ue,pe,ye){"ConvertToBlob"==we&&ue._blob_callbacks.push(function(me){return pe(me,Jr.HANDLE_RAW_MESSAGE,"0",ye)})}},{key:"_innerSendBlobByWS",value:function(we,ue,pe,ye,me){var Se={cmd:we,cmdId:DS(),sFun:function(We){U.isFunction(ye)&&ye(We)},fFun:me,contextData:{document:pe.currentFileName,tag:pe.currentTagName,bNeedClearTag:pe.bNeedClearCurrentTagName,bNeedRefresh:"UpdateImage"==we},rawData:!0};return this._innerSendByWS(we,ue,Se,pe,!0)}},{key:"_innerSendByWS",value:function(we,ue,pe,ye,me){var Se,We,ze,Be,$e=this,Ge=this._getWSCallback();pe&&pe.cmdId?(ze=WB($e._clientId,Se=pe.cmdId),Be=WB($e._clientId,"")):(Se=0,ze=0,Be=0);var _t=b0($e._clientId,we,ue,Se,$e._bScanForProxyRemote),Ct=$e._wsClient;We={client:Ct,userData:{stwain:$e,command:pe},taskId:Se,eventTaskId:ze,lastEventTaskId:Be};var Ut,Tn,mn,bt,At,Tt,Bt,Qt,yn=0;if(!me){try{Ct.request(_t,Ge,We)}catch(Ir){U.log(Ir)}return vt}for(mn=new ArrayBuffer(12),ye&&(yn=ye instanceof Blob?ye.size:ye instanceof ArrayBuffer||ye instanceof Uint8Array?ye.byteLength:ye instanceof Array?ye.length:ye.size||ye.byteLength||ye.length),Tn=(Ut=(Bt=new Blob([_t])).size)+yn,bt=new DataView(mn),Tt=0;Tt<8&&Tn;Tt++)bt.setUint8(Tt,Tn%256),Tn=Math.floor(Tn/256);for(Tt=0;Tt<4&&Ut;Tt++)bt.setUint8(8+Tt,Ut%256),Ut=Math.floor(Ut/256);return At=new Blob([mn,Bt]),Qt=Ct.request(At,Ge,We),this._additionalWSCallback(we,Ct,Ge,We),yn>0&&(Qt=Ct.request(ye,Ge,We)),mn=null,Bt=null,At=null,bt=null,ye=null,Qt}},{key:"_sendDataConnectWithSocket",value:function(we,ue,pe,ye){var me=this;return new ge.Promise(function(Se,We){me._sendData(we,ue,!0,function(ze){var Be=!1;try{Be=U.isString(ze)?U.parse(ze):ze}catch($e){}if(me._resetErr(),Be){if(Be instanceof Blob||Bp(Be))return void Se(Be);yc(Be)&&(me._errorCode=Be.exception,me._errorString=Be.description)}Se(ye?Be:Be.result)},function(ze){We({code:me._errorCode,message:me._getErrorString()})})})}},{key:"_sendDataByHttpAsync",value:function(we,ue,pe,ye,me){var Se,We=this;if(We._resetErr(),!We._isValid())return ge.Promise.reject({code:We._errorCode,message:We._getErrorString()});if(C.isServerInvalid(We))return me?ge.Promise.reject({code:We._errorCode,message:We._getErrorString()}):We._waitForConnect().then(function(){return We._sendDataByHttpAsync(we,ue,pe)});if(Ce.DWT.ConnectWithSocket)return We._sendDataConnectWithSocket(we,ue,pe,ye);Se={method:"post",async:!0,body:b0(We._clientId,we,ue,0,We._bScanForProxyRemote),dataType:null!=pe?pe:"text"};var ze=null,Be=U.guid();return We._bIfShowProgressBar&&(ze=ge.progressContext),G7(ze,Be)([We._httpUrl,"fa/",we].join(""),Se).then(function($e){var Ge=!1;try{Ge=U.isString($e)?U.parse($e):$e}catch(_t){}if(Ge){if(Ge instanceof Blob||Bp(Ge))return Ge;if(!yc(Ge))return We._resetErr(),ye?Ge:Ge.result;We._errorCode=Ge.exception,We._errorString=Ge.description}else F7(We);throw{code:We._errorCode,message:We._getErrorString()}},function($e){if(We._errorCode=$e.code,We._errorString=$e.message,!ge.page.bUnload)throw $e})}},{key:"_sendData",value:function(we,ue,pe,ye,me){var Se=this,We=null,ze=null,Be=!1,$e=!0;if(!Se._destroy){if("ActiveUI"==we?$e=!1:Be=C.isServerInvalid(Se),Be)return Se._waitForConnect().then(function(){Se._sendData(we,ue,pe,ye,me)}).catch(function(Ut){U.isFunction(me)&&me(Ut.code,Ut.message)});var Ge;U.isFunction(ye)&&(ze=ye),U.isFunction(me)&&(We=me),Ge="ConvertToBlob"==we||"Heartbeat"==we?0:DS();var _t=this._getWSContextData();return Se._innerSendByWS(we,ue,{cmd:we,cmdId:Ge,sFun:ze,fFun:We,contextData:_t,rawData:null!=pe&&pe},null,$e)}}},{key:"_innerFunV2",value:(Oe=yt(W.mark(function we(ue,pe,ye){var me,Se,We;return W.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(me=this,!(We=ye)&&!U.isUndefined(We)){ze.next=7;break}return ze.next=4,me._sendDataConnectWithSocket(ue,pe,"json",!0);case 4:Se=ze.sent,ze.next=10;break;case 7:return ze.next=9,me._sendDataByHttpAsync(ue,pe,"json",!0);case 9:Se=ze.sent;case 10:if(!(Se&&U.isArray(Se)&&Se.length>0)){ze.next=12;break}return ze.abrupt("return",Se[0]);case 12:if(!(Se&&U.isArray(Se.result)&&Se.result.length>0)){ze.next=14;break}return ze.abrupt("return",Se.result[0]);case 14:return ze.abrupt("return",Se);case 15:case"end":return ze.stop()}},we,this)})),function(we,ue,pe){return Oe.apply(this,arguments)})},{key:"_OnReady",value:(Ee=yt(W.mark(function we(){var ue,pe;return W.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if((ue=this)._wsRetry=0,ue._wsFailedTimes=0,ge.detect.starting=!1,ue._bRemoteMode||(ge.detect.bOK=!0),ue._bReady=!0,null!==(pe=ue._wsClient.ws)){ye.next=9;break}return ye.abrupt("return");case 9:pe.onopen=null,ue._wsClient.addEvent("close",ue._clientId,function(me){me&&U.log("websocket close: "+me),ue.__bAcquireImageNow=!1,ue._OnWSClose(me)}),ue._wsClient.addEvent("error",ue._clientId,function(me){me&&U.log("websocket error: "+me),ue.__bAcquireImageNow=!1,ue._OnWSError(me)}),ue._wsClient.addEvent("timeout",ue._clientId,function(me){me&&U.log("websocket timeout: "+me),ue._OnWSTimeout(me)});case 13:case"end":return ye.stop()}},we,this)})),function(){return Ee.apply(this,arguments)})},{key:"getServiceInfo",value:function(){return this._dmService}},{key:"_OnWSClose",value:function(we){var ue,pe,ye,me=this;if(me._bReady=!1,me._wsRetry=0,me._bRemoteMode&&(ue=null!==(pe=null===(ye=me.getServiceInfo())||void 0===ye||null===(ye=ye.attrs)||void 0===ye?void 0:ye.name)&&void 0!==pe?pe:""),f0(me,ue),me.__closeRemoteScanUI(!0),me._heartBeatTimer&&(clearTimeout(me._heartBeatTimer),me._heartBeatTimer=null),me._bNoMask||(U.log("hideMask:websocket close--"+vf),CB(),vf=0),me.__OnWSClose&&me.__OnWSClose(),me._wsFailedTimes<(me._bRemoteMode?xo.RemoteReconnectMaxTimes:xo.LocalReconnectMaxTimes)){var We=me._reconnectTimeSpan;me._wsFailedTimes<me._reconnectShortSpanTimes&&(We=me._reconnectShortSpan),me._heartBeatTimer=setTimeout(function(){C.startDWTReconnect(me)},We)}}},{key:"_OnWSError",value:function(we){this._bReady=!1,this.__OnWSError&&this.__OnWSError()}},{key:"_OnWSTimeout",value:function(we){var ue,pe,ye,me=this;if(me._bReady=!1,me._wsRetry=0,me._bRemoteMode&&(ue=null!==(pe=null===(ye=me.getServiceInfo())||void 0===ye||null===(ye=ye.attrs)||void 0===ye?void 0:ye.name)&&void 0!==pe?pe:""),f0(me,ue),me.__closeRemoteScanUI(!0),me._heartBeatTimer&&(clearTimeout(me._heartBeatTimer),me._heartBeatTimer=null),me._wsFailedTimes<(me._bRemoteMode?xo.RemoteReconnectMaxTimes:xo.LocalReconnectMaxTimes)){var We=me._reconnectTimeSpan;me._wsFailedTimes<me._reconnectShortSpanTimes&&(We=me._reconnectShortSpan),me._heartBeatTimer=setTimeout(function(){C.startDWTReconnect(me)},We)}}},{key:"__OnRecieveMsg",value:function(we,ue){var pe=this;if(we.event)return pe._handleEvent(we,ue.contextData);if(yc(we)?(pe._errorCode=we.exception,pe._errorString=we.description):(pe._errorCode=0,pe._errorString=""),Ce.DWT.ConnectWithSocket){var ye=we,me=null==ue?void 0:ue.cmd;return"ActiveUI"==me||"VersionInfo"==me||"ConvertToBase64"==me||"SaveSelectedImagesToBase64Binary"==me||"ConvertToBlob"==me?ue.sFun&&U.isArray(we.result)&&we.result.length>0?(ue.sFun(we.result),!0):(ue.fFun&&ue.fFun(we.result),!1):(0!=pe._errorCode&&ue.fFun&&ue.fFun(pe._errorString),"BeginSaveMem"==me||"CreateLocalStorage"==me||"LocalStorageExist"==me||"SaveToLocalStorage"==me||"LoadFromLocalStorage"==me||"RemoveLocalStorage"==me?ue.sFun&&U.isArray(we.result)&&we.result.length>0?(ue.sFun(we.result),!0):(ue.fFun&&ue.fFun(we.result),!1):(ye=ue.rawData?we:U.isArray(we.result)&&we.result.length>0?we.result[0]:we.result,ue.sFun?ue.sFun(ye):ue.fFun&&ue.fFun(ye),we=null,!0))}if(0==pe._errorCode)return ue.sFun&&U.isArray(we.result)&&we.result.length>0?(ue.sFun(we.result),!0):(ue.fFun(we.result),!0);var Se=!1;ue.fFun&&(Se=ue.fFun(pe._errorString)),!Se&&we.exception&&we.exception<0&&-2115!=we.exception&&U.isFunction(pe.__OnPrintMsg)&&pe.__OnPrintMsg(pe._errorString)}},{key:"_handleOnBitmapChangedEvent",value:function(we,ue){try{var pe,ye,me,Se,We,ze,$e,Ge,_t,Ct,Ut,Tn,mn,bt,At,Tt=we.result[0],Bt=we.result[1];if(U.isString(Bt)){var Qt=JSON.parse(Bt);pe=U.isArray(Qt)?Qt:[Qt]}else U.isArray(Bt)&&(pe=Bt);if(U.isArray(pe))for(At=ue||{},mn=0;mn<pe.length;mn++)if(U.isArray((bt=pe[mn]).images))if(ye=bt.consumeType,me=bt.curImageId,We=bt.images.length,(Se=bt.type)!=rs.enumBCAppend&&Se!=rs.enumBCInsert||(!At.document&&bt.document&&(At.document=bt.document),!At.tag&&bt.tag&&(At.tag=bt.tag)),Se==rs.enumBCRemove){var yn=[];for(ze=0;ze<We;ze++)yn.push(bt.images[ze].id);var un=[Tt,yn.join(","),Se,me,We,null,null,null,null,null,null,$e];this._OnBitmapChanged(un,we,At)}else for(ze=0;ze<We;ze++){_t=bt.images[ze].width,Ct=bt.images[ze].height,Ge=bt.images[ze].depth,Ut=bt.images[ze].xdpi,Tn=bt.images[ze].ydpi,$e=bt.images[ze].uid;var Ir=[Tt,bt.images[ze].id.toString(),Se,me,We,_t,Ct,Ge,Ut,Tn,ye,$e];this._OnBitmapChanged(Ir,we,At)}}catch(jn){Fr(jn)}return Lt}},{key:"_handleEvent",value:function(we,ue){var pe=this,ye=we.result[0],me=vt;return"OnBitmapChanged"==we.event?pe._handleOnBitmapChangedEvent(we,ue):(U.each(Lje,function(Se,We){if(we.event===Se){var ze=["_",Se].join("");return me=Lt,U.isFunction(pe[ze])&&pe[ze](we.result,we),vt}}),me?(U.log("handled event:"+we.event),U.each(Nje,function(Se,We){if(we.event===Se)return U.log("sendback event:"+we.event),pe._innerSendByWS(we.event,It(ye),null,null,Lt),vt})):(U.each(ge.Addon_Events,function(Se,We){if(we.event===Se){var ze=["_",Se].join("");return me=Lt,U.isFunction(pe[ze])&&pe[ze](we.result),vt}}),me&&(U.log("handled addon event:"+we.event),U.each(ge.Addon_Sendback_Events,function(Se,We){if(we.event===Se)return U.log("sendback addon event:"+we.event),pe._innerSendByWS(we.event,It(ye),null,null,Lt),vt}))),me)}},{key:"_setProductKeyAsync",value:function(we){var ue=this,pe=we;return ue._resetErr(),ue._isValid()?U.isString(pe)?pn.isLicenseMixed(pe,!1)?ge.Promise.reject(Ce.DWT.licenseException):pn.isLongKey(pe)?NB(ue,nue,Oje).call(ue,pe).then(function(ye){var me=ye;if(!me||me.message)throw au(ue),me&&me.message&&(ue._errorString=me.message),{code:ue._errorCode,message:ue._getErrorString()};return TB(ue,me),me}):(au(ue),ge.Promise.reject({code:ue._errorCode,message:ue._getErrorString()})):(au(ue),ge.Promise.reject({code:ue._errorCode,message:ue._getErrorString()})):ge.Promise.reject({code:ue._errorCode,message:ue._getErrorString()})}},{key:"_setLTSLic",value:function(we){var ue=this,pe=we;return ue._resetErr(),!!ue._isValid()&&(U.isString(pe)?ue._sendDataByHttpAsync("LTSLicense",It(pe),null,!0).then(function(ye){if(ye){if(yc(ye))throw ue._errorCode=ye.exception,ue._errorString=ye.description,{code:ue._errorCode,message:ue._getErrorString()};return ue._innerFunV2("GetLicenseInfo",It(0))}throw au(ue),{code:ue._errorCode,message:ue._getErrorString()}}):(au(ue),ge.Promise.reject({code:ue._errorCode,message:ue._getErrorString()})))}},{key:"_setLTSLicenseAsync",value:function(we){var ue=this;return ue._resetErr(),ue._isValid()?U.isString(we)?ue._setLTSLic(we).then(function(pe){var ye=pe;if(!ye||ye.message)throw au(ue),ye&&ye.message&&(ue._errorString=ye.message),{code:ue._errorCode,message:ue._getErrorString()};return TB(ue,ye),ue.__licenseInfo&&(ue.__licenseInfo.LTS=!0),ye}):(au(ue),ge.Promise.reject({code:ue._errorCode,message:ue._getErrorString()})):ge.Promise.reject({code:ue._errorCode,message:ue._getErrorString()})}},{key:"_innerActiveUI",value:(je=yt(W.mark(function we(ue){var pe,ye,me,Se;return W.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return pe=this,ye=ge.detect.ssl,me=pVe(),pe._bRemoteMode||(me=5),Se="",pe._blts&&(Se=null!=ue?ue:""),ze.next=6,new ge.Promise(function(Be,$e){pe._sendData("ActiveUI",It(Po.WSVersion,Po.WSSession,1,Se,ye,1,me),!1,Be,$e)});case 6:return pe=null,ze.abrupt("return",ze.sent);case 9:case"end":return ze.stop()}},we,this)})),function(we){return je.apply(this,arguments)})},{key:"_reconnected",value:(Ue=yt(W.mark(function we(ue){var pe,ye,me,Se,We,ze,Be,$e;return W.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:return(pe=this)._wsFailedTimes=0,Ge.next=4,pe._innerActiveUI(pe._uuidForActiveUI);case 4:if(me=!1,(ye=Ge.sent)&&(ye.length>12?(pe.__serverId=ye[1],me=ye[12]):ye.length>8?(pe.__serverId=ye[1],me=ye[8]):ye.length>=2&&(pe.__serverId=ye[1])),pe._bReady=!0,pe._bRemoteMode||(ge.detect.bOK=!0),ge.detect.starting=!1,!me){Ge.next=20;break}return Ge.prev=11,Ge.next=14,pe._removeAllImagesAsync("ActiveUI",!1);case 14:Ge.next=19;break;case 16:Ge.prev=16,Ge.t0=Ge.catch(11),pe._resetErr();case 19:wt(pe,-2614,"The Dynamsoft Service has been restarted.");case 20:if(Ge.prev=20,!pe._blts){Ge.next=30;break}return Se=pe._bRemoteMode&&null!==(We=null===(ze=pe._dmService)||void 0===ze||null===(ze=ze.attrs)||void 0===ze?void 0:ze.UUID)&&void 0!==We?We:"",Ge.next=25,HA(Ce.DWT.EnumInstance.dwt_desktop,Se);case 25:return Be=Ge.sent,Ge.next=28,pe._setLTSLicenseAsync(Be.ar);case 28:Ge.next=33;break;case 30:return $e=St.refProductKey,Ge.next=33,pe._setProductKeyAsync($e);case 33:return Ge.next=35,pe._OnReconnected();case 35:Ge.next=41;break;case 37:throw Ge.prev=37,Ge.t1=Ge.catch(20),pe._bRemoteMode&&_S(pe),{code:pe._errorCode,message:pe._errorString};case 41:return Ge.prev=41,pe._bRemoteMode&&C.startHeartBeat(pe),Ge.finish(41);case 44:case"end":return Ge.stop()}},we,this,[[11,16],[20,37,41,44]])})),function(we){return Ue.apply(this,arguments)})},{key:"_OnReconnected",value:(Te=yt(W.mark(function we(){return W.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:case"end":return ue.stop()}},we)})),function(){return Te.apply(this,arguments)})},{key:"_initRemoteDiv",value:function(){if(!this._acquireDivEL){var we=document.createElement("div");we.style.position="fixed",we.style.zIndex="510000",we.style.left="0",we.style.top="0";var ue=document.createElement("img");ue.className="ds-img-screen",we.appendChild(ue),document.body.appendChild(we),this._acquireDivEL=we}}},{key:"getHeartBeatData",value:function(we){var ue,pe=b0(this._clientId,we.cmd,null,we.cmdId,this._bScanForProxyRemote),ye=pe.length,me=ye,Se=new ArrayBuffer(12+me),We=new DataView(Se);for(ue=0;ue<8&&me;ue++)We.setUint8(ue,me%256),me=Math.floor(me/256);for(ue=0;ue<4&&ye;ue++)We.setUint8(8+ue,ye%256),ye=Math.floor(ye/256);for(ue=0;ue<pe.length;ue++)We.setUint8(12+ue,pe.charCodeAt(ue));return Se}},{key:"__closeRemoteScanUI",value:function(we){var ue=this;if(ue._acquireDivEL){var pe=U.sizzle(".ds-img-screen");ue._acquireDivEL.evtFun?(pe&&pe.length>0&&U.removeEventListener(pe[0],"mouseup",ue._acquireDivEL.evtFun),ue._acquireDivEL.evtFun=null):pe&&pe.length>0&&U.removeEventListener(pe[0],"mouseup"),pe&&pe.length>0&&(pe[0].src=""),we&&(document.body.removeChild(ue._acquireDivEL),ue._acquireDivEL=null)}}},{key:"_removeImageByIdAsync",value:(ve=yt(W.mark(function we(ue){var pe;return W.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if((pe=this)._resetErr(),pe._isValid()){ye.next=4;break}throw{code:pe._errorCode,message:pe._errorString};case 4:return ye.next=6,pe._innerFunV2("RemoveAllImages",It(ue));case 6:return ye.abrupt("return",ye.sent);case 7:case"end":return ye.stop()}},we,this)})),function(we){return ve.apply(this,arguments)})},{key:"_removeAllImagesAsync",value:(ce=yt(W.mark(function we(ue,pe){var ye;return W.wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if((ye=this)._resetErr(),ye._isValid()){me.next=4;break}throw{code:ye._errorCode,message:ye._getErrorString()};case 4:return me.next=6,ye._innerFunV2("RemoveAllImages");case 6:return me.abrupt("return",me.sent);case 7:case"end":return me.stop()}},we,this)})),function(we,ue){return ce.apply(this,arguments)})},{key:"_LicensePromptExpired",value:function(){}},{key:"_OnActiveUI",value:(se=yt(W.mark(function we(ue){var pe,ye,me,Se,We,ze,Be,$e,Ge,_t,Ct,Ut,Tn,mn,bt,At,Tt;return W.wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:if(pe=this,me=!1,ue&&ue.length>=6?(ye=ue[5],Se=!1,We=!1,ze=0,ue.length>12?(pe._b64bit="64"==ue[7],Se=ue[9],We=ue[10],ze=ue[11]):ue.length>8&&(Se=ue[6],We=ue[7],ze=ue[8]),Se?We&&ze&&(pe._bRemoteMode=!0):pe._bRemoteMode=!0,U.isString(ye)&&("win"==ye?pe.__serverPlatform=Rn.enumWindow:"linux"==ye?pe.__serverPlatform=Rn.enumLinux:"mac"==ye?pe.__serverPlatform=Rn.enumMac:"embed"==ye?pe.__serverPlatform=Rn.enumEmbed:"chromeos"==ye&&(pe.__serverPlatform=Rn.enumChromeOS))):me=!0,pe._bMustUpgradeService=me,me){Bt.next=67;break}if(lo("Activating the WebTwain instance..."),Be=!1,!pe._blts){Bt.next=44;break}return Ge=pe._bRemoteMode&&null!==(_t=null===(Ct=pe._dmService)||void 0===Ct||null===(Ct=Ct.attrs)||void 0===Ct?void 0:Ct.UUID)&&void 0!==_t?_t:"",Bt.prev=10,Bt.next=13,HA(Ce.DWT.EnumInstance.dwt_desktop,Ge);case 13:$e=Bt.sent,Bt.next=27;break;case 16:if(Bt.prev=16,Bt.t0=Bt.catch(10),sue(pe,Bt.t0),Ut=Uce(pe._errorCode),!pe._bLicenseErrorDispose){Bt.next=25;break}throw pe._bRemoteMode||(Ut?this._LicensePromptExpired():Vce(pe)),{code:pe._errorCode,message:pe._errorString};case 25:Ut||U.warn(pe._errorString),$e=null;case 27:if(lo(sce),!$e){Bt.next=41;break}return Bt.next=31,pe._setLTSLicenseAsync($e.ar);case 31:return Tn=Bt.sent,Ce.DWT.laddDWTObj(pe),Ge="",pe._bRemoteMode&&(Ge=null!==(mn=null===(bt=pe._dmService)||void 0===bt||null===(bt=bt.attrs)||void 0===bt?void 0:bt.UUID)&&void 0!==mn?mn:""),lo(ace),Bt.next=38,Ce.DWT.lcheckLic(Ce.DWT.EnumInstance.dwt_desktop,Tn,Ge);case 38:Be=0==Ce.DWT.licenseException.code,Bt.next=42;break;case 41:Be=!1;case 42:Bt.next=62;break;case 44:return lo(sce),At=St.refProductKey,Bt.prev=46,Bt.next=49,pe._setProductKeyAsync(At);case 49:Bt.sent&&(Be=!0),Bt.next=62;break;case 53:if(Bt.prev=53,Bt.t1=Bt.catch(46),!pe._bLicenseErrorDispose){Bt.next=60;break}throw pe._bRemoteMode||zA(Bt.t1.code)&&IB(Bt.t1),Bt.t1;case 60:U.warn(Bt.t1.message);case 61:Be=!1;case 62:if(Be&&(lo(ace),pn.checkProductKey(pe,{Core:!0})||(Tt={code:pe._errorCode,message:pe._getErrorString()},pe._resetErr(),Ce.DWT.lclex(),de.bWin&&pn.checkProductKey(pe,{Webcam:!0},!0)||(pe._errorCode=Tt.code,pe._errorString=Tt.message))),0==pe._errorCode){Bt.next=67;break}if(pe._bRemoteMode||(Uce(pe._errorCode)?this._LicensePromptExpired():Vce(pe)),!pe._bLicenseErrorDispose){Bt.next=67;break}throw{code:pe._errorCode,message:pe._getErrorString()};case 67:pe._bRemoteMode&&C.startHeartBeat(pe);case 68:case"end":return Bt.stop()}},we,this,[[10,16],[46,53]])})),function(we){return se.apply(this,arguments)})},{key:"_innerConvertToArrayBufferAsync",value:(re=yt(W.mark(function we(ue,pe,ye,me){var Se,We,ze,Be,$e;return W.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:return Se=this,ze=null!=me?me:"arraybuffer",Be=",",U.isString(We=ye)&&""!=We||(We="",Be=""),$e=["[",ue,',"',pe.join(","),'"',Be,We,"]"].join(""),Ge.next=6,Se._sendDataByHttpAsync("ConvertToBlob",$e,ze,!0);case 6:return Ge.abrupt("return",Ge.sent);case 7:case"end":return Ge.stop()}},we,this)})),function(we,ue,pe,ye){return re.apply(this,arguments)})},{key:"_getImageByServerId",value:(q=yt(W.mark(function we(ue){var pe,ye,me;return W.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return pe=Ti.IT_PNG,Se.next=3,this._innerConvertToArrayBufferAsync(pe,[ue],void 0,void 0);case 3:return ye=Se.sent,me=RB(pe),Se.abrupt("return",new Blob([ye],{type:me}));case 6:case"end":return Se.stop()}},we,this)})),function(we){return q.apply(this,arguments)})},{key:"_getSourcesAsync",value:(G=yt(W.mark(function we(ue,pe,ye){var me;return W.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:return me=this,We.next=3,me._innerFunV2("GetSources",It(ue,null!=pe&&pe,null!=ye&&ye));case 3:return We.abrupt("return",Hce(this,We.sent));case 5:case"end":return We.stop()}},we,this)})),function(we,ue,pe){return G.apply(this,arguments)})},{key:"_getDevices",value:(Y=yt(W.mark(function we(ue,pe,ye){var me,Se,We,ze,Be,$e;return W.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:if(Se=[],We="getDevices",ze=(me=this)._bRemoteMode?ES:de.bAndroid?xB:ES,Be=null!=ue?ue:ze,me._resetErr(),me._isValid()){Ge.next=5;break}return Ge.abrupt("return",ge.Promise.reject({code:me._errorCode,message:me._getErrorString()}));case 5:return me._bNoMask||Bo(We,me),Ge.prev=6,Ge.next=9,me._getSourcesAsync(Be,pe,ye);case 9:U.isArray($e=Ge.sent)&&$e.length>0&&(Se=Se.concat($e)),Ge.next=16;break;case 13:throw Ge.prev=13,Ge.t0=Ge.catch(6),Ge.t0;case 16:return Ge.prev=16,me._bNoMask||Gr(We),Ge.finish(16);case 19:return Ge.abrupt("return",Se);case 20:case"end":return Ge.stop()}},we,this,[[6,13,16,19]])})),function(we,ue,pe){return Y.apply(this,arguments)})},{key:"_innerAcquireImageFromService",value:function(we,ue,pe){var ye,me,Se=this;if(me=U.clone(we),!pn.checkProductKey(Se,{Core:!0}))return U.isFunction(pe)&&pe(Se._errorCode,Se._getErrorString()),!1;var We=Se._bRemoteMode?Lt:vt;me.RemoteScan=We?1:0,Se._bRemoteMode&&(U.isFunction(Se.__OnRemoteScanStatusAsync)||(Se.__OnRemoteScanStatusAsync=function(){}),U.isFunction(Se.__OnSourceUIClose)||(Se.__OnSourceUIClose=function(){}));for(var Be=0,$e=0;$e<XA.length;$e++){var Ge=["__",XA[$e]].join("");U.isFunction(Se[Ge])&&(Be|=1<<$e)}return me.EnableEvents=Be,We&&(Se._isBindViewer()||!1)&&Se._initRemoteDiv(),Se._bRemoteMode||(Se._bPageFocus&&Ce.DWT.IfAlwaysFocusOnPopupWindow?Se._bServerAlwaysFocusOnPopupWindow||Se._OnPageFocus(!0):Se._bServerAlwaysFocusOnPopupWindow&&Se._OnPageBlur(!0)),ye=["[",U.stringify(me),"]"].join(""),Se._sendData("AcquireImage",ye,!0,function(_t){ue(_t)},function(_t){pe(Se._errorCode,Se._getErrorString())}),!0}},{key:"_canConsume",value:function(){return this._blts&&!this._bltsCopyImage}},{key:"_acquireImageFromServiceAsync",value:function(we){var ue=this;return new ge.Promise(function(pe,ye){return ue._innerAcquireImageFromService(we,function(){ue._canConsume()&&Ce.DWT.lcvrf(ue),pe(!0)},function(me,Se){ye({code:me,message:Se})})})}},{key:"_acquireImage",value:(H=yt(W.mark(function we(ue,pe){var ye,me,Se,We,ze;return W.wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:if(ye=this,me=pe?U.clone(pe):{},Se="acuqireImage",ye._resetErr(),ye._isValid()){Be.next=4;break}throw{code:ye._errorCode,message:ye._getErrorString()};case 4:if(pn.checkProductKey(ye,{Core:!0})&&ye._isValid()){Be.next=6;break}throw{code:ye._errorCode,message:ye._getErrorString()};case 6:if(!ye.__bAcquireImageNow){Be.next=9;break}throw ile(ye),{code:ye._errorCode,message:ye._getErrorString()};case 9:return ye.__bAcquireImageNow=!0,ye._bNoMask||Bo(Se,ye),We=Ce.DWT.RemoteScanConfig,ze=Gce(),Be.prev=12,aue(me),We&&YA(We.keepAwake),null!=ue&&(me.Device=ue.strDevice,me.DeviceMatchField=_0.SMF_NAME),Be.next=18,ye._acquireImageFromServiceAsync(me);case 18:Be.next=23;break;case 20:throw Be.prev=20,Be.t0=Be.catch(12),Be.t0;case 23:return Be.prev=23,ye.__bAcquireImageNow=!1,ye._bNoMask||Gr(Se),YA(ze),Be.finish(23);case 28:return Be.abrupt("return",!0);case 29:case"end":return Be.stop()}},we,this,[[12,20,23,28]])})),function(we,ue){return H.apply(this,arguments)})},{key:"_getCapabilities",value:(B=yt(W.mark(function we(ue,pe,ye){var me,Se,We,ze,Be;return W.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return Se=null,NB(me=this,BB,iue).call(me,ue),me._initRemoteDiv(),$e.next=5,me._innerSelectDeviceAsync(ue);case 5:return U.isArray(ye)&&(Se=It(ye)),$e.next=8,me._sendDataByHttpAsync("GetCapabilities",Se);case 8:if(We=$e.sent,$e.prev=9,We.length>0&&(Be=We[0]),!U.isString(Be)){$e.next=22;break}if(Be=ge.removeNonPrintableChar(Be),Be=U.replaceAll(Be,"\\\\","\\\\"),0!=(ze=JSON.parse(Be)).errorCode){$e.next=17;break}return $e.abrupt("return",ze.response);case 17:throw me._errorCode=ze.errorCode,me._errorString=ze.errorString,{code:me._errorCode,message:me._getErrorString()};case 22:throw zl(me),{code:me._errorCode,message:me._getErrorString()};case 24:$e.next=31;break;case 26:throw $e.prev=26,$e.t0=$e.catch(9),me._errorCode=-2302,me._errorString=$e.t0,{code:me._errorCode,message:me._getErrorString()};case 31:case"end":return $e.stop()}},we,this,[[9,26]])})),function(we,ue,pe){return B.apply(this,arguments)})},{key:"_setCapabilities",value:(M=yt(W.mark(function we(ue,pe,ye){var me,Se;return W.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if(NB(me=this,BB,iue).call(me,ue),U.isObject(pe)&&!U.isArray(pe)){We.next=5;break}throw Wi(me),{code:me._errorCode,message:me._getErrorString()};case 5:return me._initRemoteDiv(),We.next=8,me._innerSelectDeviceAsync(ue);case 8:return Se=["[",U.stringify(pe),"]"].join(""),We.next=11,me._sendDataByHttpAsync("SetCapabilities",Se);case 11:return We.abrupt("return",We.sent);case 12:case"end":return We.stop()}},we,this)})),function(we,ue,pe){return M.apply(this,arguments)})},{key:"_closeSource",value:(D=yt(W.mark(function we(){var ue;return W.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return ue=this,pe.next=3,ue._innerFunV2("CloseSource");case 3:case"end":return pe.stop()}},we,this)})),function(){return D.apply(this,arguments)})},{key:"_innerSelectDeviceAsync",value:(A=yt(W.mark(function we(ue,pe){var ye,me,Se,We,ze,Be,Ge;return W.wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:if(me=this,ue&&ue instanceof od){_t.next=4;break}throw Wi(me),{code:me._errorCode,message:me._errorString};case 4:if(!(Se=null===(ye=this._dmService.attrs)||void 0===ye?void 0:ye.UUID)){_t.next=15;break}if((null===(We=ue.serviceInfo.attrs)||void 0===We?void 0:We.UUID)!=Se){_t.next=9;break}_t.next=15;break;case 9:if(!((Be=(null===(ze=ue.serviceInfo.attrs)||void 0===ze?void 0:ze.url)||ue.serviceInfo.server)&&Be.indexOf(Se)>-1)){_t.next=13;break}_t.next=15;break;case 13:throw yle(me),{code:me._errorCode,message:me._errorString};case 15:return Ge=["[",ue.strDevice,",",null!=pe?pe:_0.SMF_NAME,"]"].join(""),_t.next=18,me._innerFunV2("SelectSourceEx",Ge);case 18:return _t.abrupt("return",_t.sent);case 19:case"end":return _t.stop()}},we,this)})),function(we,ue){return A.apply(this,arguments)})},{key:"registerEvent",value:function(we,ue){return!!this._registerEvent(we,ue)}},{key:"unregisterEvent",value:function(we,ue){return this._unregisterEvent(we,ue)}},{key:"_registerEvent",value:function(we,ue){return this._resetErr(),!!this._isValid()&&(this[["__",we].join("")]=ue,!0)}},{key:"_unregisterEvent",value:function(we,ue){return this._resetErr(),!!this._isValid()&&(this[["__",we].join("")]=null,Lt)}},{key:"_OnPageFocus",value:function(we){var ue=this;if(ue._bPageFocus=!0,ue._bReady&&de.bWin&&Ce.DWT.IfAlwaysFocusOnPopupWindow){var pe=U.stringify({sequence:0,wnds:0,wnd:"0",type:3,x:0,y:0});if(ue.__bAcquireImageNow||we||ue.__bOpenFileNow){ue._bServerAlwaysFocusOnPopupWindow=!0;try{ue._isValid()&&ue._sendDataByHttpAsync("SendEventToScannerUI",["[",pe,"]"].join(""))}catch(ye){}}}}},{key:"_OnPageBlur",value:function(we){var ue=this;if(de.bWin&&ue._bReady){var pe=U.stringify({sequence:0,wnds:0,wnd:"0",type:4,x:0,y:0});if((0!=ue._bPageFocus||we)&&(ue._bPageFocus=!1,ue.__bAcquireImageNow||we||ue.__bOpenFileNow)){ue._bServerAlwaysFocusOnPopupWindow=!1;try{ue._isValid()&&ue._sendDataByHttpAsync("SendEventToScannerUI",["[",pe,"]"].join(""))}catch(ye){}}}}},{key:"_OnRemoteScanStatusAsync",value:function(we){var ue,ye,me,Se,We,ze,Be=this;if(we&&we.length>=2){try{var $e=new String(we[1]);ue=U.parse($e)}catch(_t){U.error(_t.message),U.log("parse json failed: "+we[1])}ue||(ue={sequence:0,screen:[]})}if(ue&&ue.sequence)if(ue.sequence>0&&ue.screen&&ue.screen.length>0){if(me=ue.sequence,We=ue.wnds,ze=(ye=ue.screen[0]).img,U.isString(ze)&&""!=ze&&(Se=ye.wnd),me&&Se){var Ge=U.sizzle(".ds-img-screen");Ge&&Ge.length>0&&Be._acquireDivEL&&(Be._acquireDivEL.evtFun&&(U.removeEventListener(Ge[0],"mouseup",Be._acquireDivEL.evtFun),Be._acquireDivEL.evtFun=null),Ge[0].src=ze,Be._acquireDivEL.evtFun=function(_t){We||(We="0");var Ct=U.stringify({sequence:me,wnds:We,wnd:Se+"",type:2,x:_t.offsetX,y:_t.offsetY});Be._sendDataByHttpAsync("SendEventToScannerUI",["[",Ct,"]"].join(""))},U.addEventListener(Ge[0],"mouseup",Be._acquireDivEL.evtFun))}}else Be.__closeRemoteScanUI(!1);return U.isFunction(Be.__OnRemoteScanStatusAsync)&&Be.__OnRemoteScanStatusAsync(ue),!0}},{key:"_OnBitmapChanged",value:function(we,ue,pe){var ye=this,Be=we[2],$e=we[3],Ge=-1;if("c1"!=we[0]&&"c2"!=we[0]&&"m1"!=we[0]){if(we.length>10&&(Ge=we[10]),Ge>-1&&ye._canConsume()&&(Be==rs.enumBCAppend||Be==rs.enumBCInsert)){var _t=Ce.DWT.lgct(Ge);U.isFunction(ye.__OnLtsverify)&&ye.__OnLtsverify(_t,1)}Be!=rs.enumBCAppend&&Be!=rs.enumBCInsert||!U.isFunction(ye.__OnBufferChanged)||ye.__OnBufferChanged({action:"add",currentId:$e,imageIds:[],selectedIds:[]})}}},{key:"_OnPostTransferAsync",value:function(we,ue,pe){var ye;if(we&&we.length>=2)try{var Se=String(we[1]).replace(/\\/g,"\\\\");ye=U.parse(Se)}catch(ze){U.error(ze)}ye||(ye={imageId:""});var We=!1;if(U.isFunction(this.__OnPostTransferAsync))try{We=this.__OnPostTransferAsync(ye)}catch(ze){Fr(ze)}if(U.isFunction(this.__OnPostTransferAsync2))try{this.__OnPostTransferAsync2(ye)}catch(ze){Fr(ze)}return We}},{key:"_getErrorCode",value:function(){return this._errorCode}},{key:"_getErrorString",value:function(){return 0!=this._errorCode?this._errorString:"Successful."}},{key:"_isBindViewer",value:function(){return!1}},{key:"_isNoViewer",value:function(){return!0}},{key:"_isMobileMode",value:function(){return!1}},{key:"_needCheckProxyRemoteScanLicense",value:function(){if(!this._blts&&this._bScanForProxyRemote){if(""==this._strRemoteServiceVer)return!0;if(pe=this._strRemoteServiceVer.split(","),ye=[18,3],U.trim(pe[0])>ye[0]||pe.length>1&&U.trim(pe[0])==ye[0]&&U.trim(pe[1])>=ye[1])return!0}var pe,ye;return!1}}],[{key:"isServerInvalid",value:function(we){var ue,pe,ye,me,Se;return pe=we._bMustUpgradeService,(ue=!we._bReady||null===we._wsClient)?(we._bRemoteMode&&(ye=null!==(me=null===(Se=we._dmService)||void 0===Se||null===(Se=Se.attrs)||void 0===Se?void 0:Se.name)&&void 0!==me?me:""),f0(we,ye)):pe?H1(we):we.isDestroy&&gle(we),ue||pe||-2208==we._errorCode||we.isDestroy}},{key:"STwainConnectToServer",value:(T=yt(W.mark(function we(ue){var ye;return W.wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(!Ce.DWT.WebTwainIdMap[ue._id]){me.next=5;break}return me.next=4,ue._OnReady();case 4:return me.abrupt("return");case 5:if(!ue._bReady&&!ue._destroy){me.next=7;break}return me.abrupt("return");case 7:return ue._bConnecting=!0,(ye=gf.Instance.getClient(ue._serverInfo)).setRetry(0),ue._bNoMask||Bo("",ue),me.prev=11,me.next=14,vce(ue._bRemoteMode);case 14:return me.next=17,ye.testConnection(void 0,0,void 0,1e4);case 17:if(ue._wsClient=ye,ue._wsClient.bReady=!0,ge.detect.bFirst&&(Bje(),ge.detect.bFirst=!1),ue._bReady){me.next=24;break}return ue._bReady=!0,me.next=24,ue._OnReady();case 24:me.next=30;break;case 26:throw me.prev=26,me.t0=me.catch(11),ue._bReady=!1,{code:ue._errorCode,message:ue._getErrorString()};case 30:return me.prev=30,ue._bConnecting=!1,ue._bNoMask||Gr(""),me.finish(30);case 34:case"end":return me.stop()}},we,null,[[11,26,30,34]])})),function(we){return T.apply(this,arguments)})},{key:"_innerSendHeartBeat",value:(w=yt(W.mark(function we(ue,pe){var ye,me,We;return W.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(ze.prev=0,!ue.__bAcquireImageNow){ze.next=4;break}ze.next=14;break;case 4:if(ye={client:null,userData:null,taskId:"0",eventTaskId:"0",lastEventTaskId:"0"},me=DS(),We=ue.getHeartBeatData({cmd:"Heartbeat",cmdId:me,sFun:null,fFun:null,contextData:null,rawData:!0}),!ue._wsClient){ze.next=12;break}return ue._wsClient.setRetry(0),ze.next=12,ue._wsClient.request(We,null,ye);case 12:We=null;case 14:ze.next=18;break;case 16:ze.prev=16,ze.t0=ze.catch(0);case 18:ue._wsClient&&ue._wsClient.connected&&pe&&setTimeout(function(){C._innerSendHeartBeat(ue,pe)},ue._wsClient._heartBeatTicks);case 19:case"end":return ze.stop()}},we,null,[[0,16]])})),function(we,ue){return w.apply(this,arguments)})},{key:"startDWTReconnect",value:(x=yt(W.mark(function we(ue){var pe,ye,Se,We;return W.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(ze.prev=0,!ue._destroy){ze.next=3;break}return ze.abrupt("return");case 3:if(pe=ue._serverInfo,!($n.bEnhancedMode&&pe&&pe.port)){ze.next=24;break}return St.bDCPChecked=!1,ze.prev=6,ze.next=9,kB(Ya(),Ce.DWT.Port,Ce.DWT.SSLPort);case 9:if(!(ye=ze.sent)){ze.next=14;break}ue._serverInfo.port=de.bSSL?ye.sslPort:ye.port,ze.next=16;break;case 14:throw zl(ue),Qi(ue);case 16:ze.next=24;break;case 18:return ze.prev=18,ze.t0=ze.catch(6),ue._wsFailedTimes++,ue._wsFailedTimes<(ue._bRemoteMode?xo.RemoteReconnectMaxTimes:xo.LocalReconnectMaxTimes)&&(Se=ue._reconnectTimeSpan,ue._wsFailedTimes<ue._reconnectShortSpanTimes&&(Se=ue._reconnectShortSpan),ue._heartBeatTimer=setTimeout(function(){C.startDWTReconnect(ue)},Se)),ze.abrupt("return");case 24:return ue._bConnecting=!0,(We=gf.Instance.getClient(ue._serverInfo)).setRetry(0),ze.next=30,We.testConnection(void 0,0,void 0,3e4);case 30:return ue._wsClient=We,ue._wsClient.bReady=!0,ue._wsRetry=0,ze.next=35,ue._reconnected(We);case 35:ze.next=40;break;case 37:ze.prev=37,ze.t1=ze.catch(0),ue._wsFailedTimes++;case 40:return ze.prev=40,ue._bConnecting=!1,ze.finish(40);case 43:case"end":return ze.stop()}},we,null,[[0,37,40,43],[6,18]])})),function(we){return x.apply(this,arguments)})},{key:"startHeartBeat",value:function(we){var ue=we._wsClient;ue&&ue.connected&&!ue._bHeartBeatStarted&&(ue._bHeartBeatStarted=!0,setTimeout(function(){C._innerSendHeartBeat(we,!0)},ue._heartBeatTicks))}},{key:"getServerImageUrlPrefix",value:function(we){var ue,pe=we._httpUrl;return ue=we._bScanForProxyRemote?xo.getVersionStrForCheck():St.getServerVersionInfo(),[pe,"dwt/",St.getDWTPrefix(),ue,"/img?id=",we._clientId].join("")}}]);var x,w,T,A,D,M,B,H,Y,G,q,re,se,ce,ve,Te,Ue,je,Ee,Oe,He}(xje);function Oje(y){var C,x=this,w=y;return x._resetErr(),x._isValid()?(w=U.isString(w)?U.trim(w):"",C=x._sendDataConnectWithSocket("ProductKey",It(w),"json",!0),x.__productKey=w,C=C.then(function(T){if(U.isArray(T)&&T.length>0){if(0!=x._errorCode)throw x.__productKey="",{code:x._errorCode,message:x._getErrorString()};return Ce.DWT.ProductKey=x.__productKey,pn.reparseProductKey(),x._innerFunV2("GetLicenseInfo",It(0))}throw au(x),C.context=null,{code:x._errorCode,message:x._getErrorString()}})):ge.Promise.reject({code:x._errorCode,message:x._getErrorString()})}function iue(y){return rue.apply(this,arguments)}function rue(){return(rue=yt(W.mark(function y(C){var x;return W.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if((x=this)._resetErr(),x._isValid()){w.next=4;break}return w.abrupt("return",ge.Promise.reject({code:x._errorCode,message:x._errorString}));case 4:if(C&&C instanceof od){w.next=7;break}throw Wi(x),{code:x._errorCode,message:x._errorString};case 7:case"end":return w.stop()}},y,this)}))).apply(this,arguments)}function b0(y,C,x,w,T){var A,D=[];return D.push("{"),D.push('"id":"'),D.push(y),D.push('"'),w&&(D.push(',"cmdId":"'),D.push(w),D.push('"')),D.push(',"method":"'),D.push(C),D.push('"'),D.push(',"module":"dwt","version":"'),A=T?[St.getDWTPrefix(),xo.getVersionStrForCheck()].join(""):[St.getDWTPrefix(),St.getServerVersionInfo()].join(""),D.push(A),D.push('"'),null!=x&&(D.push(',"parameter":'),U.isArray(x)?D.push(U.stringify(x)):D.push(x)),D.push("}"),D.join("")}function WB(y,C){return["evt",y,C].join("_")}function oue(y){if(y._bReady)y._wsCheckResolve();else{if(Ce.DWT.bConnectCanceled)return U.asyncQueue.stop(),lu(y),void y._wsCheckReject({code:y._errorCode,message:y._getErrorString()});if(y._wsRetry>10)return vle(y),void y._wsCheckReject({code:y._errorCode,message:y._getErrorString()});y._wsRetry++,setTimeout(function(){oue(y)},1100)}}function Fje(y,C,x,w){return UB.apply(this,arguments)}function UB(){return UB=yt(W.mark(function y(C,x,w,T){var A,D,M,B,H,Y,G;return W.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(x!=Jr.GET_TASKID){q.next=4;break}return q.abrupt("return",T.taskId);case 4:if(x!=Jr.GET_EVENT_TASKID){q.next=8;break}return q.abrupt("return",T.eventTaskId);case 8:if(x!=Jr.ONMESSAGE_PROCESS_DATA){q.next=17;break}if("object"!==p(C)){q.next=11;break}return q.abrupt("return",C);case 11:if(!((B=C).indexOf("Version not found")>=0||B.indexOf("Function not found")>=0)){q.next=14;break}return q.abrupt("return",{cmdId:null!=w?w:0});case 14:return q.abrupt("return",U.parse(C));case 17:if(x!=Jr.ONMESSAGE_GET_TASKID){q.next=25;break}if(!C){q.next=22;break}if(!C.event){q.next=21;break}return q.abrupt("return",0);case 21:return q.abrupt("return",C.cmdId);case 22:return q.abrupt("return",C);case 25:if(x!=Jr.ONMESSAGE_GET_EVENT_TASKID){q.next=31;break}if(!C||!C.event){q.next=28;break}return q.abrupt("return",WB(C.id,C.cmdId));case 28:return q.abrupt("return",0);case 31:if(x!=Jr.HANDLE_RAW_MESSAGE){q.next=59;break}if(A=null==T?void 0:T.userData){q.next=35;break}return q.abrupt("return",!1);case 35:if(D=A.stwain,M=A.command){q.next=39;break}return q.abrupt("return",!1);case 39:if(D&&U.isFunction(D.__OnWSMessage)&&D.__OnWSMessage(C),"object"!==p(C)){q.next=44;break}if(!Ce.DWT.ConnectWithSocket){q.next=44;break}return"ConvertToBlob"!=M.cmd&&"GetImageByIndex"!=M.cmd||M.sFun(C),q.abrupt("return",!0);case 44:if(!((H=C.replace(/\0/g,"")).indexOf('"method" : "Heartbeat"')>=0)){q.next=47;break}return q.abrupt("return",!0);case 47:if(!(H.indexOf('"method" : "EnableBuffer"')>=0||H.indexOf('"method" : "GetBuffer"')>=0)){q.next=50;break}return Ce.DWT.lwsproc(H,M),q.abrupt("return",!0);case 50:if(!(H.indexOf("Exception:")>=0||0==H.indexOf("Error"))){q.next=57;break}return G=!1,U.log((Y=C)+"@"+M.cmd),M.fFun&&(G=M.fFun(Y)),!G&&D&&U.isFunction(D.__OnPrintMsg)&&D.__OnPrintMsg(Y),q.abrupt("return",!0);case 57:q.next=70;break;case 59:if(x!=Jr.HANDLE_PROCESSED_MESSAGE){q.next=70;break}if(A=null==T?void 0:T.userData){q.next=63;break}return q.abrupt("return",!1);case 63:if(D=A.stwain){q.next=66;break}return q.abrupt("return",!1);case 66:if(M=A.command){q.next=69;break}return q.abrupt("return",!1);case 69:return q.abrupt("return",D.__OnRecieveMsg(C,M));case 70:case"end":return q.stop()}},y)})),UB.apply(this,arguments)}function sue(y,C){if(C){var x=C.code||C.ltsErrorCode,w=C.message;111==x||106==x||108==x?(_S(y,x),y._errorString=w):(y._errorCode=x,y._errorString=w),Ce.DWT.lsetException(y._errorCode,y._errorString,!0)}}function aue(y){void 0!==y.Resolution&&(y.Resolution=parseInt(y.Resolution)),void 0!==y.PixelType&&(y.PixelType=parseInt(y.PixelType)),void 0!==y.SelectSourceByIndex&&(y.SelectSourceByIndex=parseInt(y.SelectSourceByIndex))}var rs,XA=["OnPreAllTransfers","OnPreTransfer","OnPostTransfer","OnPostTransferAsync"];!function(y){y.enumBCAppend=1,y.enumBCInsert=2,y.enumBCRemove=3,y.enumBCEdit=4,y.enumBCIndexChange=5,y.enumBCUpdate=6}(rs||(rs={}));var kS,Mi,Lje=["OnPostAllTransfers","OnPostTransfer","OnPostLoad","OnPreTransfer","OnPreAllTransfers","OnResult","OnTransferCancelled","OnTransferError","OnSourceUIClose","OnGetFilePath","OnPercentDone","OnPostTransferAsync","OnPreAllTransfersAsync","OnRemoteScanStatusAsync","OnConsumed","OnDiskExceedLimit"],Nje=["OnPreAllTransfers","OnPreTransfer","OnPostTransfer","OnGetFilePath","OnPostLoad"],VB=U.each;function Bje(){var y,C=sd.item("DWT_port"),x=sd.item("DWT_ssl");if($n.bEnhancedMode)return!0;ge.detect.urls.splice(0),ge.detect.cUrlIndex=0,C!==kS&&x!==kS&&(y={port:C,ssl:"true"==x});var w=function(T){return!y||!(!T||T.port==y.port&&T.ssl==y.ssl)};1===ge.detect.detectType?(y!==kS&&y.ssl&&ge.detect.urls.push(y),VB(ge.detect.ports,function(T){T.ssl&&w(T)&&ge.detect.urls.push(T)})):0===ge.detect.detectType?(y===kS||y.ssl||ge.detect.urls.push(y),VB(ge.detect.ports,function(T){!1===T.ssl&&w(T)&&ge.detect.urls.push(T)})):(y!==kS&&ge.detect.urls.push(y),VB(ge.detect.ports,function(T){w(T)&&ge.detect.urls.push(T)}))}!function(y){y.TWAIN=0,y.ICA=3,y.SANE=3,y.TWAIN_AND_ICA=4,y.TWAIN_AND_TWAIN64=4,y.TWAIN64=5}(Mi||(Mi={}));var zn={notSupportProperty:function(y){},notSupportMethod:function(y){},refreshImageAfterInvokeFun:function(y,C,x){return 1==x},loadHttpBlob:function(y,C,x,w,T,A,D,M){var B,H,Y=vt;if(H={method:C,dataType:"blob"},M&&(H.headers=M),""!=y.HTTPUserName&&(H.username=y.HTTPUserName,H.password=y.HTTPPassword),y.__HTTPPostResponseString="",w){if("get"==C){var G=U.guid();return ge.progressContext&&(ge.progressContext._onPercent=D),void G7(ge.progressContext,G)(x,H).then(function(ce){var ve=ce.type;if("text/plain"==ve||"text/html"==ve||"text/json"==ve){var Te=new FileReader;Te.readAsText(ce),Te.onload=function(){y.__HTTPPostResponseString=Te.result,T(ce)},Te.onerror=function(){T(ce)}}else T(ce)},function(ce){ce&&ce.code?(y._errorCode=ce.code,y._errorString=ce.message):ce&&ce.httpCode?N7(y,!1,ce.message,ce.httpCode):rle(y),U.isFunction(A)&&A({code:y._errorCode,message:y._errorString})})}H.onSuccess=function(ce,ve,Te){if((Te?Te.getResponseHeader("content-type"):"").indexOf("text/")>=0){var Ue=new FileReader;Ue.readAsText(ce),Ue.onload=function(){y.__HTTPPostResponseString=Ue.result,T(ce)},Ue.onerror=function(){T(ce)}}else T(ce)},U.isFunction(D)&&(H.beforeSend=function(ce){ce.addEventListener("progress",function(ve){!de.bSafari&&ve&&(delete ve.totalSize,delete ve.position),D(ve)},vt)})}else de.bIE?(H.dataType="arraybuffer",H.onSuccess=function(ce,ve,Te){var Ue,je;(Ue=ce||Te.responseData)&&(je=new Uint8Array(Ue)),y.__HTTPPostResponseString=Te.responseText,y._errorCode=0,y._errorString="",T(je),je=null,Y=Lt}):(H.dataType="text",H.contentType="text/plain; charset=x-user-defined",H.mimeType="text/plain; charset=x-user-defined",H.onSuccess=function(ce,ve,Te){var Ue,je,Ee;y.__HTTPPostResponseString=Ue=Te.responseText,je=Ue.length,Ee=new Uint8Array(je);for(var Oe=0;Oe<je;Oe++)Ee[Oe]=Ue.charCodeAt(Oe);y._errorCode=0,y._errorString="",T(Ee),Ee=null,Y=Lt}),H.headers?U.mix(H.headers,{"X-Requested-With":vt}):H.headers={"X-Requested-With":vt};if("post"==C){var q,re=y.httpFormFields;if(re)try{q=new FormData,U.each(re,function(ce,ve){ce instanceof Blob?q.append(ve,ce,ce.name):q.append(ve,ce)}),U.mix(H,{data:q,processData:vt,contentType:vt})}catch(ce){}}B=function(ce,ve,Te){var Ue,je;ce&&U.isArray(ce)&&ce.length>2?(Ue=ce[1],je=ce[2]):(Ue=ve,je=Te),2!=je.state&&3!=je.state||0!=je.status?N7(y,vt,Ue,je.status):"abort"===je.statusText?N7(y,Lt):rle(y),U.isFunction(A)&&A()},H.url=x,H.async=w,H.onError=B,H.onComplete=function(){y._cancelableObj=null};var se=ru(H);if(!w)return Y;ge.progressContext&&(ge.progressContext._onPercent=D,y.IfShowCancelDialogWhenImageTransfer&&ge.progressContext.on("cancel",function(){se.abort()}))},combineUrl:function(y,C,x){var w=[],T=C;return void 0===T||void 0===x?void 0:(U.isString(T)||(T=String(C)),0==T.indexOf("http://")?(T=T.replace("http://",""),w.push("http://")):0==T.indexOf("https://")?(T=T.replace("https://",""),w.push("https://")):(0==T.indexOf("//")&&(T=T.replace("//","")),w.push(y.IfSSL?"https://":"http://")),w.push(T),T.indexOf(":")<0&&(y.HTTPPort||(y.HTTPPort=ge.detect.ssl?443:80),(!ge.detect.ssl&&80!=y.HTTPPort||ge.detect.ssl&&443!=y.HTTPPort)&&(w.push(":"),w.push(y.HTTPPort))),0!==x.indexOf("/")&&w.push("/"),w.push(x),w.join(""))},httpPutImage:function(y,C,x,w,T,A,D){var M=Lt,B={method:"PUT",url:C,hasContent:Lt,processData:vt,async:w,data:x,onSuccess:T,onError:function(Y,G,q){var re,se;M=vt,Y&&U.isArray(Y)&&Y.length>2?(re=Y[1],se=Y[2]):(re=G,se=q),2!=se.state&&3!=se.state||0!=se.status?ole(y,vt,re,se.status):"abort"===se.statusText?ole(y,Lt):wt(y,-2304,"Http put error: the url is invalid."),U.isFunction(A)&&A()},onComplete:function(){y._cancelableObj=null},beforeSend:function(Y){U.isFunction(D)&&Y.upload.addEventListener("progress",function(G){!de.bSafari&&G&&(delete G.totalSize,delete G.position),D(G)},vt)}};""!=y.HTTPUserName&&(B.username=y.HTTPUserName,B.password=y.HTTPPassword),w||U.mix(B,{headers:{"X-Requested-With":vt}});var H=ru(B);return ge.progressContext&&(ge.progressContext._onPercent=D,ge.progressContext._onCancel=function(){H.abort()}),M},GetImageInfo:function(y,C){var x=y._ImgManager.convertClientIndexToServerId(C);return-1==x?(kt(y),!1):y._innerFun("GetImageInfo",It(x))},getBlobTypeByImageType:RB,callbacks:[],pushCallback:function(y,C,x){zn.callbacks.push({method:y,callback:C,ticks:x})},refreshUIRef:0,isServerInvalid:function(y){Yl.isServerInvalid(y)},replaceLocalFilename:function(y){var C;return void 0===y?"":(C=(y=String(y)).replace(/\\/g,"\\\\"),de.bFileSystem&&(C=decodeURI(C)),C)},getImageType:function(y){if(void 0===y||y.length<4)return-1;var C=y.lastIndexOf(".");if(-1===C)return-1;var x=y.slice(C).toLowerCase();return".bmp"===x||".dib"===x?Ce.DWT.EnumDWT_ImageType.IT_BMP:".jpg"===x||".jpe"===x||".jpeg"===x||".jfif"===x?Ce.DWT.EnumDWT_ImageType.IT_JPG:".tif"===x||".tiff"===x?Ce.DWT.EnumDWT_ImageType.IT_TIF:".png"===x?Ce.DWT.EnumDWT_ImageType.IT_PNG:".pdf"===x?Ce.DWT.EnumDWT_ImageType.IT_PDF:".jp2"===x||".j2k"===x||".j2c"===x?Ce.DWT.EnumDWT_ImageType.IT_J2K:-1},makeParams:It,showMask:Bo,hideMask:Gr};function $A(y,C,x,w,T){var A=0;return y==Mi.TWAIN&&(A=Q1),y==Mi.TWAIN64?A=Zt.TWAINX64SCANNER:y==Mi.ICA?x?A=Zt.SANESCANNER:w?A=Zt.ICASCANNER:(C||T)&&(A=Q1):y==Mi.TWAIN_AND_TWAIN64&&(x?A=Q1|Zt.SANESCANNER:w?A=Q1|Zt.ICASCANNER:C?A=Q1|Zt.TWAINX64SCANNER:T&&(A=Q1)),A}function qA(y,C){for(var x=y.HowManyImagesInBuffer,w=0;w<x;w++)C.push(y._ImgManager.convertClientIndexToServerId(w))}function jB(y,C){return 0!=y._ImgManager.count()||(ea(y),U.isFunction(C)&&C(y._errorCode,y._getErrorString()),!1)}function ym(y,C,x){return!(!jB(y,x)||(isNaN(C)||!U.isNumber(C)||C<0||C>=y._ImgManager.count())&&(kt(y),U.isFunction(x)&&x(y._errorCode,y._getErrorString()),1))}function eC(y){var C,x,w,T=[];return y._ImgManager.count()<=0||((x=y._ImgManager.getCurrentImageIndex())>=0&&(C=y._ImgManager.convertClientIndexToServerId(x)),w=y._ImgManager.getSelectedClientIndexArray(),U.isArray(w)&&U.each(w,function(A){var D=y._ImgManager.convertClientIndexToServerId(A);-1!=D&&T.push(D)}),-1!=C&&0==T.length&&T.push(C)),T}function lue(y){var C,x=[];return y._ImgManager.count()<=0||(C=y._ImgManager.getCurrentImageIndex(),x=y._ImgManager.getSelectedClientIndexArray(),-1!=C&&0==x.length&&x.push(C)),x}function ta(y,C,x){return y._resetErr(),!!y._isValid()&&(isNaN(C)?(Jn(y),U.isFunction(x)&&x(y._errorCode,y.ErrorString),vt):C<0||C>=y._ImgManager.count()?(kt(y),U.isFunction(x)&&x(y._errorCode,y.ErrorString),vt):Lt)}function Wje(y){var C,x=[],w=y.HowManyImagesInBuffer;for(C=0;C<w;C++)x.push(C);return y._imageBufferWrapper.convertIndicesToServerIds(x)}function _m(y,C){return y._imageBufferWrapper.convertIndicesToServerIds(C)}function bs(y,C,x,w,T){try{y(C,x,w,T)}catch(A){}C=x=w=T=null}function nn(y,C,x){try{y(C._errorCode,C._getErrorString(),x)}catch(w){}C=x=null}function ha(y,C,x,w,T,A){try{y(C._errorCode,C._getErrorString(),x,w,T,A)}catch(D){}C=x=w=T=A=null}function fa(){return fa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(y,C,x){var w=function(A,D){for(;!Object.prototype.hasOwnProperty.call(A,D)&&null!==(A=qn(A)););return A}(y,C);if(w){var T=Object.getOwnPropertyDescriptor(w,C);return T.get?T.get.call(arguments.length<3?y:x):T.value}},fa.apply(this,arguments)}function cue(y,C){(null==C||C>y.length)&&(C=y.length);for(var x=0,w=new Array(C);x<C;x++)w[x]=y[x];return w}function HB(y,C){return function(x){if(Array.isArray(x))return x}(y)||function(x,w){var T=null==x?null:"undefined"!=typeof Symbol&&x[Symbol.iterator]||x["@@iterator"];if(null!=T){var A,D,M,B,H=[],Y=!0,G=!1;try{if(M=(T=T.call(x)).next,0===w){if(Object(T)!==T)return;Y=!1}else for(;!(Y=(A=M.call(T)).done)&&(H.push(A.value),H.length!==w);Y=!0);}catch(q){G=!0,D=q}finally{try{if(!Y&&null!=T.return&&(B=T.return(),Object(B)!==B))return}finally{if(G)throw D}}return H}}(y,C)||function(x,w){if(x){if("string"==typeof x)return cue(x,w);var T=Object.prototype.toString.call(x).slice(8,-1);return"Object"===T&&x.constructor&&(T=x.constructor.name),"Map"===T||"Set"===T?Array.from(x):"Arguments"===T||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(T)?cue(x,w):void 0}}(y,C)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}ge.html5.Funs=zn;var KA=g(function y(){l(this,y),Dn(this,"bIsDirty",!1),Dn(this,"imageWidth",0),Dn(this,"imageHeight",0),Dn(this,"iImageControlWidth",0),Dn(this,"iImageControlHeight",0),Dn(this,"imageUrl",""),Dn(this,"minImageUrl",""),Dn(this,"uuid",-1),Dn(this,"serverId",-1),Dn(this,"uidFromServer",""),Dn(this,"aryOverlayRectangleData",[]),Dn(this,"ticks",Date.now())},[{key:"Clear",value:function(){this.imageUrl="",this.minImageUrl="",this.serverId=-1,this.uuid=-1,this.uidFromServer="",this.aryOverlayRectangleData=[]}}]),Uje=An,GB=h1,Vje=oae,uue=sse,jje=jl,due=ys,Hje=sm,hue=Cr,zB=ba("Reflect","construct"),Gje=Object.prototype,zje=[].push,fue=hue(function(){function y(){}return!(zB(function(){},[],y)instanceof y)}),pue=!hue(function(){zB(function(){})}),gue=fue||pue;Uje({target:"Reflect",stat:!0,forced:gue,sham:gue},{construct:function(y,C){uue(y),jje(C);var x=arguments.length<3?y:uue(arguments[2]);if(pue&&!fue)return zB(y,C,x);if(y===x){switch(C.length){case 0:return new y;case 1:return new y(C[0]);case 2:return new y(C[0],C[1]);case 3:return new y(C[0],C[1],C[2]);case 4:return new y(C[0],C[1],C[2],C[3])}var w=[null];return GB(zje,w,C),new(GB(Vje,y,w))}var T=x.prototype,A=Hje(due(T)?T:Gje),D=GB(y,A,C);return due(D)?D:A}});var JA=v(Co.Reflect.construct),mue=v(Co.Object.getOwnPropertySymbols),vue={exports:{}},$je=th,yue=Dp.f,_ue=es;An({target:"Object",stat:!0,forced:!_ue||Cr(function(){yue(1)}),sham:!_ue},{getOwnPropertyDescriptor:function(y,C){return yue($je(y),C)}});var Cue=Co.Object,qje=vue.exports=function(y,C){return Cue.getOwnPropertyDescriptor(y,C)};Cue.getOwnPropertyDescriptor.sham&&(qje.sham=!0);var bue=vue.exports,xue=v(bue),Kje=zoe,Jje=th,Qje=Dp,Zje=Vw;An({target:"Object",stat:!0,sham:!es},{getOwnPropertyDescriptors:function(y){for(var C,x,w=Jje(y),T=Qje.f,A=Kje(w),D={},M=0;A.length>M;)void 0!==(x=T(w,C=A[M++]))&&Zje(D,C,x);return D}});var wue=v(Co.Object.getOwnPropertyDescriptors),Sue={exports:{}},Tue=BD.f;An({target:"Object",stat:!0,forced:Object.defineProperties!==Tue,sham:!es},{defineProperties:Tue});var Iue=Co.Object,nHe=Sue.exports=function(y,C){return Iue.defineProperties(y,C)};Iue.defineProperties.sham&&(nHe.sham=!0);var iHe=v(Sue.exports),rHe=Zse,oHe=h1,sHe=Pp,aHe=uf,lHe=tu,cHe=k1;An({target:"Promise",stat:!0,forced:!0},{try:function(y){var C=sHe(arguments,1),x=aHe.f(this),w=cHe(function(){return oHe(lHe(y),void 0,C)});return(w.error?x.reject:x.resolve)(w.value),x.promise}});var Eue=rHe,Due=v(Eue);function Aue(y,C,x,w,T,A,D){try{var M=y[A](D),B=M.value}catch(H){return void x(H)}M.done?C(B):Due.resolve(B).then(w,T)}function Pue(y){return function(){var C=this,x=arguments;return new Due(function(w,T){var A=y.apply(C,x);function D(B){Aue(A,w,T,D,M,"next",B)}function M(B){Aue(A,w,T,D,M,"throw",B)}D(void 0)})}}function Wo(y){if(void 0===y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}var Rue=ks,uHe=Ps,dHe=ys,hHe=jl,fHe=function(y){return void 0!==y&&(Rue(y,"value")||Rue(y,"writable"))},pHe=Dp,gHe=T1;An({target:"Reflect",stat:!0},{get:function y(C,x){var w,T,A=arguments.length<3?C:arguments[2];return hHe(C)===A?C[x]:(w=pHe.f(C,x))?fHe(w)?w.value:void 0===w.get?void 0:uHe(w.get,A):dHe(T=gHe(C))?y(T,x,A):void 0}});var kue=v(Co.Reflect.get),YB=v(aae),mHe=v(bue);An({target:"Object",stat:!0},{setPrototypeOf:Kre});var Mue=Co.Object.setPrototypeOf,XB=v(Mue),vHe=sf,Oue=T1,yHe=Gre;An({target:"Object",stat:!0,forced:Cr(function(){Oue(1)}),sham:!yHe},{getPrototypeOf:function(y){return Oue(vHe(y))}});var Fue=Co.Object.getPrototypeOf,Lue=v(Fue);function tC(y){var C;return(tC=XB?YB(C=Lue).call(C):function(x){return x.__proto__||Lue(x)})(y)}function QA(){var y;return QA="undefined"!=typeof Reflect&&kue?YB(y=kue).call(y):function(C,x,w){var T=function(D,M){for(;!Object.prototype.hasOwnProperty.call(D,M)&&null!==(D=tC(D)););return D}(C,x);if(T){var A=mHe(T,x);return A.get?A.get.call(arguments.length<3?C:w):A.value}},QA.apply(this,arguments)}An({target:"Object",stat:!0,sham:!es},{create:sm});var _He=Co.Object,Nue=function(y,C){return _He.create(y,C)},CHe=v(Nue);function $B(y,C){var x;return($B=XB?YB(x=XB).call(x):function(w,T){return w.__proto__=T,w})(y,C)}function ZA(y,C){if("function"!=typeof C&&null!==C)throw new TypeError("Super expression must either be null or a function");y.prototype=CHe(C&&C.prototype,{constructor:{value:y,writable:!0,configurable:!0}}),FD(y,"prototype",{writable:!1}),C&&$B(y,C)}var Bue=v(Noe),Wue=v(iS),Uue=Poe,bHe=v(Uue),xHe=jl,wHe=rA,SHe=Ap,THe=Ps,IHe=sf,EHe=function(y,C,x,w){try{return w?C(xHe(x)[0],x[1]):C(x)}catch(T){wHe(y,"throw",T)}},DHe=Koe,AHe=ND,PHe=t0,Vue=Vw,RHe=dN,kHe=iS,jue=Array,Hue=function(y){var C=IHe(y),x=AHe(this),w=arguments.length,T=w>1?arguments[1]:void 0,A=void 0!==T;A&&(T=SHe(T,w>2?arguments[2]:void 0));var D,M,B,H,Y,G,q=kHe(C),re=0;if(!q||this===jue&&DHe(q))for(D=PHe(C),M=x?new this(D):jue(D);D>re;re++)G=A?T(C[re],re):C[re],Vue(M,re,G);else for(M=x?new this:[],Y=(H=RHe(C,q)).next;!(B=THe(Y,H)).done;re++)G=A?EHe(H,T,[B.value,re],!0):B.value,Vue(M,re,G);return M.length=re,M},MHe=Hue;An({target:"Array",stat:!0,forced:!qse(function(y){Array.from(y)})},{from:MHe});var Gue=Co.Array.from,zue=v(Gue);function qB(y,C){(null==C||C>y.length)&&(C=y.length);for(var x=0,w=new Array(C);x<C;x++)w[x]=y[x];return w}function Yue(y,C){var x;if(y){if("string"==typeof y)return qB(y,C);var w=bHe(x=Object.prototype.toString.call(y)).call(x,8,-1);return"Object"===w&&y.constructor&&(w=y.constructor.name),"Map"===w||"Set"===w?zue(y):"Arguments"===w||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?qB(y,C):void 0}}function nC(y,C){return function(x){if(Bue(x))return x}(y)||function(x,w){var T=null==x?null:void 0!==I1&&Wue(x)||x["@@iterator"];if(null!=T){var A,D,M,B,H=[],Y=!0,G=!1;try{if(M=(T=T.call(x)).next,0===w){if(Object(T)!==T)return;Y=!1}else for(;!(Y=(A=M.call(T)).done)&&(H.push(A.value),H.length!==w);Y=!0);}catch(q){G=!0,D=q}finally{try{if(!Y&&null!=T.return&&(B=T.return(),Object(B)!==B))return}finally{if(G)throw D}}return H}}(y,C)||Yue(y,C)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MS(y){return function(C){if(Bue(C))return qB(C)}(y)||function(C){if(void 0!==I1&&null!=Wue(C)||null!=C["@@iterator"])return zue(C)}(y)||Yue(y)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tn(y,C,x){return(C=xoe(C))in y?FD(y,C,{value:x,enumerable:!0,configurable:!0,writable:!0}):y[C]=x,y}var Xue={exports:{}},$ue={exports:{}};!function(y){var C=J8,x=boe;function w(T){return y.exports=w="function"==typeof C&&"symbol"==typeof x?function(A){return typeof A}:function(A){return A&&"function"==typeof C&&A.constructor===C&&A!==C.prototype?"symbol":typeof A},y.exports.__esModule=!0,y.exports.default=y.exports,w(T)}y.exports=w,y.exports.__esModule=!0,y.exports.default=y.exports}($ue);var OHe=$ue.exports,FHe=r0.forEach,que=Ioe("forEach")?[].forEach:function(y){return FHe(this,y,arguments.length>1?arguments[1]:void 0)};An({target:"Array",proto:!0,forced:[].forEach!==que},{forEach:que});var LHe=za("Array","forEach"),NHe=n0,BHe=ks,WHe=Rs,UHe=LHe,KB=Array.prototype,VHe={DOMTokenList:!0,NodeList:!0},Kue=function(y){var C=y.forEach;return y===KB||WHe(KB,y)&&C===KB.forEach||BHe(VHe,NHe(y))?UHe:C},jHe=Kue,HHe=An,GHe=e0,zHe=Pr([].reverse),Jue=[1,2];HHe({target:"Array",proto:!0,forced:String(Jue)===String(Jue.reverse())},{reverse:function(){return GHe(this)&&(this.length=this.length),zHe(this)}});var YHe=za("Array","reverse"),XHe=Rs,$He=YHe,JB=Array.prototype,qHe=function(y){var C=y.reverse;return y===JB||XHe(JB,y)&&C===JB.reverse?$He:C};!function(y){var C=OHe.default,x=Eie,w=J8,T=Nue,A=Fue,D=jHe,M=Mue,B=Eue,H=qHe,Y=Uue;function G(){y.exports=G=function(){return q},y.exports.__esModule=!0,y.exports.default=y.exports;var q={},re=Object.prototype,se=re.hasOwnProperty,ce=x||function(bt,At,Tt){bt[At]=Tt.value},ve="function"==typeof w?w:{},Te=ve.iterator||"@@iterator",Ue=ve.asyncIterator||"@@asyncIterator",je=ve.toStringTag||"@@toStringTag";function Ee(bt,At,Tt){return x(bt,At,{value:Tt,enumerable:!0,configurable:!0,writable:!0}),bt[At]}try{Ee({},"")}catch(bt){Ee=function(At,Tt,Bt){return At[Tt]=Bt}}function Oe(bt,At,Tt,Bt){var yn=T((At&&At.prototype instanceof ue?At:ue).prototype),un=new Ut(Bt||[]);return ce(yn,"_invoke",{value:$e(bt,Tt,un)}),yn}function He(bt,At,Tt){try{return{type:"normal",arg:bt.call(At,Tt)}}catch(Bt){return{type:"throw",arg:Bt}}}q.wrap=Oe;var we={};function ue(){}function pe(){}function ye(){}var me={};Ee(me,Te,function(){return this});var Se=A&&A(A(Tn([])));Se&&Se!==re&&se.call(Se,Te)&&(me=Se);var We=ye.prototype=ue.prototype=T(me);function ze(bt){var At;D(At=["next","throw","return"]).call(At,function(Tt){Ee(bt,Tt,function(Bt){return this._invoke(Tt,Bt)})})}function Be(bt,At){function Tt(Qt,yn,un,Ir){var jn=He(bt[Qt],bt,yn);if("throw"!==jn.type){var hi=jn.arg,jt=hi.value;return jt&&"object"==C(jt)&&se.call(jt,"__await")?At.resolve(jt.__await).then(function(xs){Tt("next",xs,un,Ir)},function(xs){Tt("throw",xs,un,Ir)}):At.resolve(jt).then(function(xs){hi.value=xs,un(hi)},function(xs){return Tt("throw",xs,un,Ir)})}Ir(jn.arg)}var Bt;ce(this,"_invoke",{value:function(Qt,yn){function un(){return new At(function(Ir,jn){Tt(Qt,yn,Ir,jn)})}return Bt=Bt?Bt.then(un,un):un()}})}function $e(bt,At,Tt){var Bt="suspendedStart";return function(Qt,yn){if("executing"===Bt)throw new Error("Generator is already running");if("completed"===Bt){if("throw"===Qt)throw yn;return{value:void 0,done:!0}}for(Tt.method=Qt,Tt.arg=yn;;){var un=Tt.delegate;if(un){var Ir=Ge(un,Tt);if(Ir){if(Ir===we)continue;return Ir}}if("next"===Tt.method)Tt.sent=Tt._sent=Tt.arg;else if("throw"===Tt.method){if("suspendedStart"===Bt)throw Bt="completed",Tt.arg;Tt.dispatchException(Tt.arg)}else"return"===Tt.method&&Tt.abrupt("return",Tt.arg);Bt="executing";var jn=He(bt,At,Tt);if("normal"===jn.type){if(Bt=Tt.done?"completed":"suspendedYield",jn.arg===we)continue;return{value:jn.arg,done:Tt.done}}"throw"===jn.type&&(Bt="completed",Tt.method="throw",Tt.arg=jn.arg)}}}function Ge(bt,At){var Tt=At.method,Bt=bt.iterator[Tt];if(void 0===Bt)return At.delegate=null,"throw"===Tt&&bt.iterator.return&&(At.method="return",At.arg=void 0,Ge(bt,At),"throw"===At.method)||"return"!==Tt&&(At.method="throw",At.arg=new TypeError("The iterator does not provide a '"+Tt+"' method")),we;var Qt=He(Bt,bt.iterator,At.arg);if("throw"===Qt.type)return At.method="throw",At.arg=Qt.arg,At.delegate=null,we;var yn=Qt.arg;return yn?yn.done?(At[bt.resultName]=yn.value,At.next=bt.nextLoc,"return"!==At.method&&(At.method="next",At.arg=void 0),At.delegate=null,we):yn:(At.method="throw",At.arg=new TypeError("iterator result is not an object"),At.delegate=null,we)}function _t(bt){var At={tryLoc:bt[0]};1 in bt&&(At.catchLoc=bt[1]),2 in bt&&(At.finallyLoc=bt[2],At.afterLoc=bt[3]),this.tryEntries.push(At)}function Ct(bt){var At=bt.completion||{};At.type="normal",delete At.arg,bt.completion=At}function Ut(bt){this.tryEntries=[{tryLoc:"root"}],D(bt).call(bt,_t,this),this.reset(!0)}function Tn(bt){if(bt){var At=bt[Te];if(At)return At.call(bt);if("function"==typeof bt.next)return bt;if(!isNaN(bt.length)){var Tt=-1,Bt=function Qt(){for(;++Tt<bt.length;)if(se.call(bt,Tt))return Qt.value=bt[Tt],Qt.done=!1,Qt;return Qt.value=void 0,Qt.done=!0,Qt};return Bt.next=Bt}}return{next:mn}}function mn(){return{value:void 0,done:!0}}return pe.prototype=ye,ce(We,"constructor",{value:ye,configurable:!0}),ce(ye,"constructor",{value:pe,configurable:!0}),pe.displayName=Ee(ye,je,"GeneratorFunction"),q.isGeneratorFunction=function(bt){var At="function"==typeof bt&&bt.constructor;return!!At&&(At===pe||"GeneratorFunction"===(At.displayName||At.name))},q.mark=function(bt){return M?M(bt,ye):(bt.__proto__=ye,Ee(bt,je,"GeneratorFunction")),bt.prototype=T(We),bt},q.awrap=function(bt){return{__await:bt}},ze(Be.prototype),Ee(Be.prototype,Ue,function(){return this}),q.AsyncIterator=Be,q.async=function(bt,At,Tt,Bt,Qt){void 0===Qt&&(Qt=B);var yn=new Be(Oe(bt,At,Tt,Bt),Qt);return q.isGeneratorFunction(At)?yn:yn.next().then(function(un){return un.done?un.value:yn.next()})},ze(We),Ee(We,je,"Generator"),Ee(We,Te,function(){return this}),Ee(We,"toString",function(){return"[object Generator]"}),q.keys=function(bt){var At=Object(bt),Tt=[];for(var Bt in At)Tt.push(Bt);return H(Tt).call(Tt),function Qt(){for(;Tt.length;){var yn=Tt.pop();if(yn in At)return Qt.value=yn,Qt.done=!1,Qt}return Qt.done=!0,Qt}},q.values=Tn,Ut.prototype={constructor:Ut,reset:function(bt){var At;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,D(At=this.tryEntries).call(At,Ct),!bt)for(var Tt in this)"t"===Tt.charAt(0)&&se.call(this,Tt)&&!isNaN(+Y(Tt).call(Tt,1))&&(this[Tt]=void 0)},stop:function(){this.done=!0;var bt=this.tryEntries[0].completion;if("throw"===bt.type)throw bt.arg;return this.rval},dispatchException:function(bt){if(this.done)throw bt;var At=this;function Tt(jn,hi){return yn.type="throw",yn.arg=bt,At.next=jn,hi&&(At.method="next",At.arg=void 0),!!hi}for(var Bt=this.tryEntries.length-1;Bt>=0;--Bt){var Qt=this.tryEntries[Bt],yn=Qt.completion;if("root"===Qt.tryLoc)return Tt("end");if(Qt.tryLoc<=this.prev){var un=se.call(Qt,"catchLoc"),Ir=se.call(Qt,"finallyLoc");if(un&&Ir){if(this.prev<Qt.catchLoc)return Tt(Qt.catchLoc,!0);if(this.prev<Qt.finallyLoc)return Tt(Qt.finallyLoc)}else if(un){if(this.prev<Qt.catchLoc)return Tt(Qt.catchLoc,!0)}else{if(!Ir)throw new Error("try statement without catch or finally");if(this.prev<Qt.finallyLoc)return Tt(Qt.finallyLoc)}}}},abrupt:function(bt,At){for(var Tt=this.tryEntries.length-1;Tt>=0;--Tt){var Bt=this.tryEntries[Tt];if(Bt.tryLoc<=this.prev&&se.call(Bt,"finallyLoc")&&this.prev<Bt.finallyLoc){var Qt=Bt;break}}Qt&&("break"===bt||"continue"===bt)&&Qt.tryLoc<=At&&At<=Qt.finallyLoc&&(Qt=null);var yn=Qt?Qt.completion:{};return yn.type=bt,yn.arg=At,Qt?(this.method="next",this.next=Qt.finallyLoc,we):this.complete(yn)},complete:function(bt,At){if("throw"===bt.type)throw bt.arg;return"break"===bt.type||"continue"===bt.type?this.next=bt.arg:"return"===bt.type?(this.rval=this.arg=bt.arg,this.method="return",this.next="end"):"normal"===bt.type&&At&&(this.next=At),we},finish:function(bt){for(var At=this.tryEntries.length-1;At>=0;--At){var Tt=this.tryEntries[At];if(Tt.finallyLoc===bt)return this.complete(Tt.completion,Tt.afterLoc),Ct(Tt),we}},catch:function(bt){for(var At=this.tryEntries.length-1;At>=0;--At){var Tt=this.tryEntries[At];if(Tt.tryLoc===bt){var Bt=Tt.completion;if("throw"===Bt.type){var Qt=Bt.arg;Ct(Tt)}return Qt}}throw new Error("illegal catch attempt")},delegateYield:function(bt,At,Tt){return this.delegate={iterator:Tn(bt),resultName:At,nextLoc:Tt},"next"===this.method&&(this.arg=void 0),we}},q}y.exports=G,y.exports.__esModule=!0,y.exports.default=y.exports}(Xue);var eP=(0,Xue.exports)(),KHe=eP;try{regeneratorRuntime=eP}catch(y){"object"==typeof Ku?Ku.regeneratorRuntime=eP:Function("r","regeneratorRuntime = r")(eP)}var tP=v(KHe),yi=v(Kue),JHe=sf,Que=zw;An({target:"Object",stat:!0,forced:Cr(function(){Que(1)})},{keys:function(y){return Que(JHe(y))}});var Zue=v(Co.Object.keys);An({target:"Number",stat:!0},{isNaN:function(y){return y!=y}});var iC=v(Co.Number.isNaN),QHe=za("Array","concat"),ZHe=Rs,eGe=QHe,QB=Array.prototype,Cm=v(function(y){var C=y.concat;return y===QB||ZHe(QB,y)&&C===QB.concat?eGe:C}),tGe=Cr,iGe=bo("iterator"),ZB=!tGe(function(){var y=new URL("b?a=1&b=2&c=3","http://a"),C=y.searchParams,x=new URLSearchParams("a=1&a=2&b=3"),w="";return y.pathname="c%20d",C.forEach(function(T,A){C.delete("b"),w+=A+T}),x.delete("a",2),x.delete("b",void 0),!y.toJSON||!x.has("a",1)||x.has("a",2)||!x.has("a",void 0)||x.has("b")||!C.size&&!0||!C.sort||"http://a/c%20d?a=1&c=3"!==y.href||"3"!==C.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!C[iGe]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==w||"x"!==new URL("http://x",void 0).host}),rGe=am,ede=function(y,C,x){for(var w in C)x&&x.unsafe&&y[w]?y[w]=C[w]:rGe(y,w,C[w],x);return y},tde=Pp,oGe=Math.floor,e9=function(y,C){var x=y.length;if(x<8)for(var w,T,A=1;A<x;){for(T=A,w=y[A];T&&C(y[T-1],w)>0;)y[T]=y[--T];T!==A++&&(y[T]=w)}else for(var D=oGe(x/2),M=e9(tde(y,0,D),C),B=e9(tde(y,D),C),H=M.length,Y=B.length,G=0,q=0;G<H||q<Y;)y[G+q]=G<H&&q<Y?C(M[G],B[q])<=0?M[G++]:B[q++]:G<H?M[G++]:B[q++];return y},t9=An,nP=Hr,n9=Cse,iP=Ps,_f=Pr,OS=es,nde=ZB,ide=am,sGe=$w,aGe=ede,lGe=af,cGe=qre,i9=cf,rde=oS,r9=vs,uGe=ks,dGe=Ap,hGe=n0,fGe=jl,ode=ys,Xl=vl,pGe=sm,sde=im,ade=dN,gGe=iS,rP=ZD,rC=E1,mGe=e9,vGe=bo("iterator"),oC="URLSearchParams",lde=oC+"Iterator",cde=i9.set,ad=i9.getterFor(oC),yGe=i9.getterFor(lde),ude=n9("fetch"),oP=n9("Request"),FS=n9("Headers"),o9=oP&&oP.prototype,dde=FS&&FS.prototype,_Ge=nP.RegExp,CGe=nP.TypeError,hde=nP.decodeURIComponent,bGe=nP.encodeURIComponent,xGe=_f("".charAt),fde=_f([].join),x0=_f([].push),s9=_f("".replace),wGe=_f([].shift),pde=_f([].splice),gde=_f("".split),SGe=_f("".slice),TGe=/\+/g,mde=Array(4),IGe=function(y){return mde[y-1]||(mde[y-1]=_Ge("((?:%[\\da-f]{2}){"+y+"})","gi"))},EGe=function(y){try{return hde(y)}catch(C){return y}},vde=function(y){var C=s9(y,TGe," "),x=4;try{return hde(C)}catch(w){for(;x;)C=s9(C,IGe(x--),EGe);return C}},DGe=/[!'()~]|%20/g,AGe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},PGe=function(y){return AGe[y]},yde=function(y){return s9(bGe(y),DGe,PGe)},a9=cGe(function(y,C){cde(this,{type:lde,target:ad(y).entries,index:0,kind:C})},oC,function(){var y=yGe(this),C=y.target,x=y.index++;if(!C||x>=C.length)return y.target=void 0,rP(void 0,!0);var w=C[x];switch(y.kind){case"keys":return rP(w.key,!1);case"values":return rP(w.value,!1)}return rP([w.key,w.value],!1)},!0),_de=function(y){this.entries=[],this.url=null,void 0!==y&&(ode(y)?this.parseObject(y):this.parseQuery("string"==typeof y?"?"===xGe(y,0)?SGe(y,1):y:Xl(y)))};_de.prototype={type:oC,bindURL:function(y){this.url=y,this.update()},parseObject:function(y){var C,x,w,T,A,D,M,B=this.entries,H=gGe(y);if(H)for(x=(C=ade(y,H)).next;!(w=iP(x,C)).done;){if(A=(T=ade(fGe(w.value))).next,(D=iP(A,T)).done||(M=iP(A,T)).done||!iP(A,T).done)throw new CGe("Expected sequence with length 2");x0(B,{key:Xl(D.value),value:Xl(M.value)})}else for(var Y in y)uGe(y,Y)&&x0(B,{key:Y,value:Xl(y[Y])})},parseQuery:function(y){if(y)for(var C,x,w=this.entries,T=gde(y,"&"),A=0;A<T.length;)(C=T[A++]).length&&(x=gde(C,"="),x0(w,{key:vde(wGe(x)),value:vde(fde(x,"="))}))},serialize:function(){for(var y,C=this.entries,x=[],w=0;w<C.length;)y=C[w++],x0(x,yde(y.key)+"="+yde(y.value));return fde(x,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var sP=function(){rde(this,sC);var y=arguments.length>0?arguments[0]:void 0,C=cde(this,new _de(y));OS||(this.size=C.entries.length)},sC=sP.prototype;if(aGe(sC,{append:function(y,C){var x=ad(this);rC(arguments.length,2),x0(x.entries,{key:Xl(y),value:Xl(C)}),OS||this.length++,x.updateURL()},delete:function(y){for(var C=ad(this),x=rC(arguments.length,1),w=C.entries,T=Xl(y),A=x<2?void 0:arguments[1],D=void 0===A?A:Xl(A),M=0;M<w.length;){var B=w[M];if(B.key!==T||void 0!==D&&B.value!==D)M++;else if(pde(w,M,1),void 0!==D)break}OS||(this.size=w.length),C.updateURL()},get:function(y){var C=ad(this).entries;rC(arguments.length,1);for(var x=Xl(y),w=0;w<C.length;w++)if(C[w].key===x)return C[w].value;return null},getAll:function(y){var C=ad(this).entries;rC(arguments.length,1);for(var x=Xl(y),w=[],T=0;T<C.length;T++)C[T].key===x&&x0(w,C[T].value);return w},has:function(y){for(var C=ad(this).entries,x=rC(arguments.length,1),w=Xl(y),T=x<2?void 0:arguments[1],A=void 0===T?T:Xl(T),D=0;D<C.length;){var M=C[D++];if(M.key===w&&(void 0===A||M.value===A))return!0}return!1},set:function(y,C){var x=ad(this);rC(arguments.length,1);for(var w,T=x.entries,A=!1,D=Xl(y),M=Xl(C),B=0;B<T.length;B++)(w=T[B]).key===D&&(A?pde(T,B--,1):(A=!0,w.value=M));A||x0(T,{key:D,value:M}),OS||(this.size=T.length),x.updateURL()},sort:function(){var y=ad(this);mGe(y.entries,function(C,x){return C.key>x.key?1:-1}),y.updateURL()},forEach:function(y){for(var C,x=ad(this).entries,w=dGe(y,arguments.length>1?arguments[1]:void 0),T=0;T<x.length;)w((C=x[T++]).value,C.key,this)},keys:function(){return new a9(this,"keys")},values:function(){return new a9(this,"values")},entries:function(){return new a9(this,"entries")}},{enumerable:!0}),ide(sC,vGe,sC.entries,{name:"entries"}),ide(sC,"toString",function(){return ad(this).serialize()},{enumerable:!0}),OS&&sGe(sC,"size",{get:function(){return ad(this).entries.length},configurable:!0,enumerable:!0}),lGe(sP,oC),t9({global:!0,constructor:!0,forced:!nde},{URLSearchParams:sP}),!nde&&r9(FS)){var RGe=_f(dde.has),kGe=_f(dde.set),Cde=function(y){if(ode(y)){var C,x=y.body;if(hGe(x)===oC)return C=y.headers?new FS(y.headers):new FS,RGe(C,"content-type")||kGe(C,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),pGe(y,{body:sde(0,Xl(x)),headers:sde(0,C)})}return y};if(r9(ude)&&t9({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(y){return ude(y,arguments.length>1?Cde(arguments[1]):{})}}),r9(oP)){var l9=function(y){return rde(this,o9),new oP(y,arguments.length>1?Cde(arguments[1]):{})};o9.constructor=l9,l9.prototype=o9,t9({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:l9})}}var ld,MGe={URLSearchParams:sP,getState:ad},bde=es,FGe=Ps,LGe=Cr,c9=zw,NGe=Xw,BGe=Fw,WGe=sf,UGe=QL,aC=Object.assign,xde=Object.defineProperty,VGe=Pr([].concat),jGe=!aC||LGe(function(){if(bde&&1!==aC({b:1},aC(xde({},"a",{enumerable:!0,get:function(){xde(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var y={},C={},x=Symbol("assign detection"),w="abcdefghijklmnopqrst";return y[x]=7,w.split("").forEach(function(T){C[T]=T}),7!==aC({},y)[x]||c9(aC({},C)).join("")!==w})?function(y,C){for(var x=WGe(y),w=arguments.length,T=1,A=NGe.f,D=BGe.f;w>T;)for(var M,B=UGe(arguments[T++]),H=A?VGe(c9(B),A(B)):c9(B),Y=H.length,G=0;Y>G;)M=H[G++],bde&&!FGe(D,B,M)||(x[M]=B[M]);return x}:aC,w0=Pr,u9=2147483647,HGe=/[^\0-\u007E]/,wde=/[.\u3002\uFF0E\uFF61]/g,Sde="Overflow: input needs wider integers to process",Tde=RangeError,GGe=w0(wde.exec),lC=Math.floor,d9=String.fromCharCode,Ide=w0("".charCodeAt),Ede=w0([].join),bm=w0([].push),zGe=w0("".replace),YGe=w0("".split),XGe=w0("".toLowerCase),Dde=function(y){return y+22+75*(y<26)},$Ge=function(y,C,x){var w=0;for(y=x?lC(y/700):y>>1,y+=lC(y/C);y>455;)y=lC(y/35),w+=36;return lC(w+36*y/(y+38))},qGe=function(y){var x,w,C=[],T=(y=function(Te){for(var Ue=[],je=0,Ee=Te.length;je<Ee;){var Oe=Ide(Te,je++);if(Oe>=55296&&Oe<=56319&&je<Ee){var He=Ide(Te,je++);56320==(64512&He)?bm(Ue,((1023&Oe)<<10)+(1023&He)+65536):(bm(Ue,Oe),je--)}else bm(Ue,Oe)}return Ue}(y)).length,A=128,D=0,M=72;for(x=0;x<y.length;x++)(w=y[x])<128&&bm(C,d9(w));var B=C.length,H=B;for(B&&bm(C,"-");H<T;){var Y=u9;for(x=0;x<y.length;x++)(w=y[x])>=A&&w<Y&&(Y=w);var G=H+1;if(Y-A>lC((u9-D)/G))throw new Tde(Sde);for(D+=(Y-A)*G,A=Y,x=0;x<y.length;x++){if((w=y[x])<A&&++D>u9)throw new Tde(Sde);if(w===A){for(var q=D,re=36;;){var se=re<=M?1:re>=M+26?26:re-M;if(q<se)break;var ce=q-se,ve=36-se;bm(C,d9(Dde(se+ce%ve))),q=lC(ce/ve),re+=36}bm(C,d9(Dde(q))),M=$Ge(D,G,H===B),D=0,H++}}D++,A++}return Ede(C,"")},KGe=An,h9=es,JGe=ZB,f9=Hr,Ade=Ap,cd=Pr,aP=am,ud=$w,QGe=oS,p9=ks,g9=jGe,cC=Hue,ah=Pp,ZGe=voe.codeAt,Vp=vl,tze=af,nze=E1,Pde=MGe,ize=cf.set,lP=cf.getterFor("URL"),rze=Pde.URLSearchParams,oze=Pde.getState,LS=f9.URL,m9=f9.TypeError,cP=f9.parseInt,sze=Math.floor,kde=Math.pow,dd=cd("".charAt),lh=cd(/./.exec),NS=cd([].join),aze=cd(1..toString),lze=cd([].pop),uC=cd([].push),v9=cd("".replace),cze=cd([].shift),uze=cd("".split),BS=cd("".slice),uP=cd("".toLowerCase),dze=cd([].unshift),y9="Invalid scheme",S0="Invalid host",Mde="Invalid port",Ode=/[a-z]/i,hze=/[\d+-.a-z]/i,_9=/\d/,fze=/^0x/i,pze=/^[0-7]+$/,gze=/^\d+$/,Fde=/^[\da-f]+$/i,mze=/[\0\t\n\r #%/:<>?@[\\\]^|]/,vze=/[\0\t\n\r #/:<>?@[\\\]^|]/,yze=/^[\u0000-\u0020]+/,_ze=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Cze=/[\t\n\r]/g,WS=function(y){var C,x,w,T;if("number"==typeof y){for(C=[],x=0;x<4;x++)dze(C,y%256),y=sze(y/256);return NS(C,".")}if("object"==typeof y){for(C="",w=function(A){for(var D=null,M=1,B=null,H=0,Y=0;Y<8;Y++)0!==A[Y]?(H>M&&(D=B,M=H),B=null,H=0):(null===B&&(B=Y),++H);return H>M&&(D=B,M=H),D}(y),x=0;x<8;x++)T&&0===y[x]||(T&&(T=!1),w===x?(C+=x?":":"::",T=!0):(C+=aze(y[x],16),x<7&&(C+=":")));return"["+C+"]"}return y},dP={},Lde=g9({},dP,{" ":1,'"':1,"<":1,">":1,"`":1}),Nde=g9({},Lde,{"#":1,"?":1,"{":1,"}":1}),C9=g9({},Nde,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),xm=function(y,C){var x=ZGe(y,0);return x>32&&x<127&&!p9(C,y)?y:encodeURIComponent(y)},hP={ftp:21,file:null,http:80,https:443,ws:80,wss:443},US=function(y,C){var x;return 2===y.length&&lh(Ode,dd(y,0))&&(":"===(x=dd(y,1))||!C&&"|"===x)},Bde=function(y){var C;return y.length>1&&US(BS(y,0,2))&&(2===y.length||"/"===(C=dd(y,2))||"\\"===C||"?"===C||"#"===C)},bze=function(y){return"."===y||"%2e"===uP(y)},b9={},Wde={},x9={},Ude={},Vde={},w9={},jde={},Hde={},fP={},pP={},S9={},T9={},I9={},E9={},Gde={},D9={},dC={},Cf={},zde={},T0={},jp={},A9=function(y,C,x){var w,T,A,D=Vp(y);if(C){if(T=this.parse(D))throw new m9(T);this.searchParams=null}else{if(void 0!==x&&(w=new A9(x,!0)),T=this.parse(D,null,w))throw new m9(T);(A=oze(new rze)).bindURL(this),this.searchParams=A}};A9.prototype={type:"URL",parse:function(y,C,x){var w,T,A,D,M,B=this,H=C||b9,Y=0,G="",q=!1,re=!1,se=!1;for(y=Vp(y),C||(B.scheme="",B.username="",B.password="",B.host=null,B.port=null,B.path=[],B.query=null,B.fragment=null,B.cannotBeABaseURL=!1,y=v9(y,yze,""),y=v9(y,_ze,"$1")),y=v9(y,Cze,""),w=cC(y);Y<=w.length;){switch(T=w[Y],H){case b9:if(!T||!lh(Ode,T)){if(C)return y9;H=x9;continue}G+=uP(T),H=Wde;break;case Wde:if(T&&(lh(hze,T)||"+"===T||"-"===T||"."===T))G+=uP(T);else{if(":"!==T){if(C)return y9;G="",H=x9,Y=0;continue}if(C&&(B.isSpecial()!==p9(hP,G)||"file"===G&&(B.includesCredentials()||null!==B.port)||"file"===B.scheme&&!B.host))return;if(B.scheme=G,C)return void(B.isSpecial()&&hP[B.scheme]===B.port&&(B.port=null));G="","file"===B.scheme?H=E9:B.isSpecial()&&x&&x.scheme===B.scheme?H=Ude:B.isSpecial()?H=Hde:"/"===w[Y+1]?(H=Vde,Y++):(B.cannotBeABaseURL=!0,uC(B.path,""),H=zde)}break;case x9:if(!x||x.cannotBeABaseURL&&"#"!==T)return y9;if(x.cannotBeABaseURL&&"#"===T){B.scheme=x.scheme,B.path=ah(x.path),B.query=x.query,B.fragment="",B.cannotBeABaseURL=!0,H=jp;break}H="file"===x.scheme?E9:w9;continue;case Ude:if("/"!==T||"/"!==w[Y+1]){H=w9;continue}H=fP,Y++;break;case Vde:if("/"===T){H=pP;break}H=Cf;continue;case w9:if(B.scheme=x.scheme,T===ld)B.username=x.username,B.password=x.password,B.host=x.host,B.port=x.port,B.path=ah(x.path),B.query=x.query;else if("/"===T||"\\"===T&&B.isSpecial())H=jde;else if("?"===T)B.username=x.username,B.password=x.password,B.host=x.host,B.port=x.port,B.path=ah(x.path),B.query="",H=T0;else{if("#"!==T){B.username=x.username,B.password=x.password,B.host=x.host,B.port=x.port,B.path=ah(x.path),B.path.length--,H=Cf;continue}B.username=x.username,B.password=x.password,B.host=x.host,B.port=x.port,B.path=ah(x.path),B.query=x.query,B.fragment="",H=jp}break;case jde:if(!B.isSpecial()||"/"!==T&&"\\"!==T){if("/"!==T){B.username=x.username,B.password=x.password,B.host=x.host,B.port=x.port,H=Cf;continue}H=pP}else H=fP;break;case Hde:if(H=fP,"/"!==T||"/"!==dd(G,Y+1))continue;Y++;break;case fP:if("/"!==T&&"\\"!==T){H=pP;continue}break;case pP:if("@"===T){q&&(G="%40"+G),q=!0,A=cC(G);for(var ce=0;ce<A.length;ce++){var ve=A[ce];if(":"!==ve||se){var Te=xm(ve,C9);se?B.password+=Te:B.username+=Te}else se=!0}G=""}else if(T===ld||"/"===T||"?"===T||"#"===T||"\\"===T&&B.isSpecial()){if(q&&""===G)return"Invalid authority";Y-=cC(G).length+1,G="",H=S9}else G+=T;break;case S9:case T9:if(C&&"file"===B.scheme){H=D9;continue}if(":"!==T||re){if(T===ld||"/"===T||"?"===T||"#"===T||"\\"===T&&B.isSpecial()){if(B.isSpecial()&&""===G)return S0;if(C&&""===G&&(B.includesCredentials()||null!==B.port))return;if(D=B.parseHost(G))return D;if(G="",H=dC,C)return;continue}"["===T?re=!0:"]"===T&&(re=!1),G+=T}else{if(""===G)return S0;if(D=B.parseHost(G))return D;if(G="",H=I9,C===T9)return}break;case I9:if(!lh(_9,T)){if(T===ld||"/"===T||"?"===T||"#"===T||"\\"===T&&B.isSpecial()||C){if(""!==G){var Ue=cP(G,10);if(Ue>65535)return Mde;B.port=B.isSpecial()&&Ue===hP[B.scheme]?null:Ue,G=""}if(C)return;H=dC;continue}return Mde}G+=T;break;case E9:if(B.scheme="file","/"===T||"\\"===T)H=Gde;else{if(!x||"file"!==x.scheme){H=Cf;continue}switch(T){case ld:B.host=x.host,B.path=ah(x.path),B.query=x.query;break;case"?":B.host=x.host,B.path=ah(x.path),B.query="",H=T0;break;case"#":B.host=x.host,B.path=ah(x.path),B.query=x.query,B.fragment="",H=jp;break;default:Bde(NS(ah(w,Y),""))||(B.host=x.host,B.path=ah(x.path),B.shortenPath()),H=Cf;continue}}break;case Gde:if("/"===T||"\\"===T){H=D9;break}x&&"file"===x.scheme&&!Bde(NS(ah(w,Y),""))&&(US(x.path[0],!0)?uC(B.path,x.path[0]):B.host=x.host),H=Cf;continue;case D9:if(T===ld||"/"===T||"\\"===T||"?"===T||"#"===T){if(!C&&US(G))H=Cf;else if(""===G){if(B.host="",C)return;H=dC}else{if(D=B.parseHost(G))return D;if("localhost"===B.host&&(B.host=""),C)return;G="",H=dC}continue}G+=T;break;case dC:if(B.isSpecial()){if(H=Cf,"/"!==T&&"\\"!==T)continue}else if(C||"?"!==T)if(C||"#"!==T){if(T!==ld&&(H=Cf,"/"!==T))continue}else B.fragment="",H=jp;else B.query="",H=T0;break;case Cf:if(T===ld||"/"===T||"\\"===T&&B.isSpecial()||!C&&("?"===T||"#"===T)){if(".."===(M=uP(M=G))||"%2e."===M||".%2e"===M||"%2e%2e"===M?(B.shortenPath(),"/"===T||"\\"===T&&B.isSpecial()||uC(B.path,"")):bze(G)?"/"===T||"\\"===T&&B.isSpecial()||uC(B.path,""):("file"===B.scheme&&!B.path.length&&US(G)&&(B.host&&(B.host=""),G=dd(G,0)+":"),uC(B.path,G)),G="","file"===B.scheme&&(T===ld||"?"===T||"#"===T))for(;B.path.length>1&&""===B.path[0];)cze(B.path);"?"===T?(B.query="",H=T0):"#"===T&&(B.fragment="",H=jp)}else G+=xm(T,Nde);break;case zde:"?"===T?(B.query="",H=T0):"#"===T?(B.fragment="",H=jp):T!==ld&&(B.path[0]+=xm(T,dP));break;case T0:C||"#"!==T?T!==ld&&("'"===T&&B.isSpecial()?B.query+="%27":B.query+="#"===T?"%23":xm(T,dP)):(B.fragment="",H=jp);break;case jp:T!==ld&&(B.fragment+=xm(T,Lde))}Y++}},parseHost:function(y){var C,x,w;if("["===dd(y,0)){if("]"!==dd(y,y.length-1)||!(C=function(T){var A,D,M,B,H,Y,G,q=[0,0,0,0,0,0,0,0],re=0,se=null,ce=0,ve=function(){return dd(T,ce)};if(":"===ve()){if(":"!==dd(T,1))return;ce+=2,se=++re}for(;ve();){if(8===re)return;if(":"!==ve()){for(A=D=0;D<4&&lh(Fde,ve());)A=16*A+cP(ve(),16),ce++,D++;if("."===ve()){if(0===D||(ce-=D,re>6))return;for(M=0;ve();){if(B=null,M>0){if(!("."===ve()&&M<4))return;ce++}if(!lh(_9,ve()))return;for(;lh(_9,ve());){if(H=cP(ve(),10),null===B)B=H;else{if(0===B)return;B=10*B+H}if(B>255)return;ce++}q[re]=256*q[re]+B,2!=++M&&4!==M||re++}if(4!==M)return;break}if(":"===ve()){if(ce++,!ve())return}else if(ve())return;q[re++]=A}else{if(null!==se)return;ce++,se=++re}}if(null!==se)for(Y=re-se,re=7;0!==re&&Y>0;)G=q[re],q[re--]=q[se+Y-1],q[se+--Y]=G;else if(8!==re)return;return q}(BS(y,1,-1))))return S0;this.host=C}else if(this.isSpecial()){if(y=function(y){var C,x,w=[],T=YGe(zGe(XGe(y),wde,"."),".");for(C=0;C<T.length;C++)bm(w,GGe(HGe,x=T[C])?"xn--"+qGe(x):x);return Ede(w,".")}(y),lh(mze,y)||null===(C=function(T){var A,D,M,B,H,Y,G,q=uze(T,".");if(q.length&&""===q[q.length-1]&&q.length--,(A=q.length)>4)return T;for(D=[],M=0;M<A;M++){if(""===(B=q[M]))return T;if(H=10,B.length>1&&"0"===dd(B,0)&&(H=lh(fze,B)?16:8,B=BS(B,8===H?1:2)),""===B)Y=0;else{if(!lh(10===H?gze:8===H?pze:Fde,B))return T;Y=cP(B,H)}uC(D,Y)}for(M=0;M<A;M++)if(Y=D[M],M===A-1){if(Y>=kde(256,5-A))return null}else if(Y>255)return null;for(G=lze(D),M=0;M<D.length;M++)G+=D[M]*kde(256,3-M);return G}(y)))return S0;this.host=C}else{if(lh(vze,y))return S0;for(C="",x=cC(y),w=0;w<x.length;w++)C+=xm(x[w],dP);this.host=C}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return p9(hP,this.scheme)},shortenPath:function(){var y=this.path,C=y.length;!C||"file"===this.scheme&&1===C&&US(y[0],!0)||y.length--},serialize:function(){var y=this,C=y.scheme,x=y.username,w=y.password,T=y.host,A=y.port,D=y.path,M=y.query,B=y.fragment,H=C+":";return null!==T?(H+="//",y.includesCredentials()&&(H+=x+(w?":"+w:"")+"@"),H+=WS(T),null!==A&&(H+=":"+A)):"file"===C&&(H+="//"),H+=y.cannotBeABaseURL?D[0]:D.length?"/"+NS(D,"/"):"",null!==M&&(H+="?"+M),null!==B&&(H+="#"+B),H},setHref:function(y){var C=this.parse(y);if(C)throw new m9(C);this.searchParams.update()},getOrigin:function(){var y=this.scheme,C=this.port;if("blob"===y)try{return new hC(y.path[0]).origin}catch(x){return"null"}return"file"!==y&&this.isSpecial()?y+"://"+WS(this.host)+(null!==C?":"+C:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(y){this.parse(Vp(y)+":",b9)},getUsername:function(){return this.username},setUsername:function(y){var C=cC(Vp(y));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var x=0;x<C.length;x++)this.username+=xm(C[x],C9)}},getPassword:function(){return this.password},setPassword:function(y){var C=cC(Vp(y));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var x=0;x<C.length;x++)this.password+=xm(C[x],C9)}},getHost:function(){var y=this.host,C=this.port;return null===y?"":null===C?WS(y):WS(y)+":"+C},setHost:function(y){this.cannotBeABaseURL||this.parse(y,S9)},getHostname:function(){var y=this.host;return null===y?"":WS(y)},setHostname:function(y){this.cannotBeABaseURL||this.parse(y,T9)},getPort:function(){var y=this.port;return null===y?"":Vp(y)},setPort:function(y){this.cannotHaveUsernamePasswordPort()||(""===(y=Vp(y))?this.port=null:this.parse(y,I9))},getPathname:function(){var y=this.path;return this.cannotBeABaseURL?y[0]:y.length?"/"+NS(y,"/"):""},setPathname:function(y){this.cannotBeABaseURL||(this.path=[],this.parse(y,dC))},getSearch:function(){var y=this.query;return y?"?"+y:""},setSearch:function(y){""===(y=Vp(y))?this.query=null:("?"===dd(y,0)&&(y=BS(y,1)),this.query="",this.parse(y,T0)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var y=this.fragment;return y?"#"+y:""},setHash:function(y){""!==(y=Vp(y))?("#"===dd(y,0)&&(y=BS(y,1)),this.fragment="",this.parse(y,jp)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var hC=function(y){var C=QGe(this,$l),x=nze(arguments.length,1)>1?arguments[1]:void 0,w=ize(C,new A9(y,!1,x));h9||(C.href=w.serialize(),C.origin=w.getOrigin(),C.protocol=w.getProtocol(),C.username=w.getUsername(),C.password=w.getPassword(),C.host=w.getHost(),C.hostname=w.getHostname(),C.port=w.getPort(),C.pathname=w.getPathname(),C.search=w.getSearch(),C.searchParams=w.getSearchParams(),C.hash=w.getHash())},$l=hC.prototype,hd=function(y,C){return{get:function(){return lP(this)[y]()},set:C&&function(x){return lP(this)[C](x)},configurable:!0,enumerable:!0}};if(h9&&(ud($l,"href",hd("serialize","setHref")),ud($l,"origin",hd("getOrigin")),ud($l,"protocol",hd("getProtocol","setProtocol")),ud($l,"username",hd("getUsername","setUsername")),ud($l,"password",hd("getPassword","setPassword")),ud($l,"host",hd("getHost","setHost")),ud($l,"hostname",hd("getHostname","setHostname")),ud($l,"port",hd("getPort","setPort")),ud($l,"pathname",hd("getPathname","setPathname")),ud($l,"search",hd("getSearch","setSearch")),ud($l,"searchParams",hd("getSearchParams")),ud($l,"hash",hd("getHash","setHash"))),aP($l,"toJSON",function(){return lP(this).serialize()},{enumerable:!0}),aP($l,"toString",function(){return lP(this).serialize()},{enumerable:!0}),LS){var Yde=LS.createObjectURL,Xde=LS.revokeObjectURL;Yde&&aP(hC,"createObjectURL",Ade(Yde,LS)),Xde&&aP(hC,"revokeObjectURL",Ade(Xde,LS))}tze(hC,"URL"),KGe({global:!0,constructor:!0,forced:!JGe,sham:!h9},{URL:hC});var xze=An,$de=Cr,wze=E1,qde=vl,Sze=ZB,P9=ba("URL"),Tze=Sze&&$de(function(){P9.canParse()}),Ize=$de(function(){return 1!==P9.canParse.length});xze({target:"URL",stat:!0,forced:!Tze||Ize},{canParse:function(y){var C=wze(arguments.length,1),x=qde(y),w=C<2||void 0===arguments[1]?void 0:qde(arguments[1]);try{return!!new P9(x,w)}catch(T){return!1}}});var Eze=An,Dze=E1,Kde=vl,Aze=ba("URL");Eze({target:"URL",stat:!0},{parse:function(y){var C=Dze(arguments.length,1),x=Kde(y),w=C<2||void 0===arguments[1]?void 0:Kde(arguments[1]);try{return new Aze(x,w)}catch(T){return null}}});var Pze=v(Co.URL),Rze=An,kze=r0.findIndex,Qde=!0;"findIndex"in[]&&Array(1).findIndex(function(){Qde=!1}),Rze({target:"Array",proto:!0,forced:Qde},{findIndex:function(y){return kze(this,y,arguments.length>1?arguments[1]:void 0)}});var Mze=za("Array","findIndex"),Oze=Rs,Fze=Mze,R9=Array.prototype,Zde=v(function(y){var C=y.findIndex;return y===R9||Oze(R9,y)&&C===R9.findIndex?Fze:C}),ehe=es,Lze=Cr,the=Pr,Nze=T1,Bze=zw,Wze=th,nhe=the(Fw.f),Uze=the([].push),Vze=ehe&&Lze(function(){var y=Object.create(null);return y[2]=2,!nhe(y,2)}),ihe=function(y){return function(C){for(var x,w=Wze(C),T=Bze(w),A=Vze&&null===Nze(w),D=T.length,M=0,B=[];D>M;)x=T[M++],ehe&&!(A?x in w:nhe(w,x))||Uze(B,y?[x,w[x]]:w[x]);return B}},jze=[ihe(!0),ihe(!1)][0];An({target:"Object",stat:!0},{entries:function(y){return jze(y)}});var gP=v(Co.Object.entries),Hze=An,Gze=r0.find,ohe=!0;"find"in[]&&Array(1).find(function(){ohe=!1}),Hze({target:"Array",proto:!0,forced:ohe},{find:function(y){return Gze(this,y,arguments.length>1?arguments[1]:void 0)}});var zze=za("Array","find"),Yze=Rs,Xze=zze,k9=Array.prototype,VS=v(function(y){var C=y.find;return y===k9||Yze(k9,y)&&C===k9.find?Xze:C}),$ze=r0.filter;An({target:"Array",proto:!0,forced:!Hw("filter")},{filter:function(y){return $ze(this,y,arguments.length>1?arguments[1]:void 0)}});var qze=za("Array","filter"),Kze=Rs,Jze=qze,M9=Array.prototype,she=v(function(y){var C=y.filter;return y===M9||Kze(M9,y)&&C===M9.filter?Jze:C}),Qze=r0.map;An({target:"Array",proto:!0,forced:!Hw("map")},{map:function(y){return Qze(this,y,arguments.length>1?arguments[1]:void 0)}});var Zze=za("Array","map"),eYe=Rs,tYe=Zze,O9=Array.prototype,jS=v(function(y){var C=y.map;return y===O9||eYe(O9,y)&&C===O9.map?tYe:C}),nYe=b8.includes;An({target:"Array",proto:!0,forced:Cr(function(){return!Array(1).includes()})},{includes:function(y){return nYe(this,y,arguments.length>1?arguments[1]:void 0)}});var iYe=za("Array","includes"),rYe=An,oYe=UN,sYe=rm,ahe=vl,aYe=VN,lYe=Pr("".indexOf);rYe({target:"String",proto:!0,forced:!aYe("includes")},{includes:function(y){return!!~lYe(ahe(sYe(this)),ahe(oYe(y)),arguments.length>1?arguments[1]:void 0)}});var cYe=za("String","includes"),lhe=Rs,uYe=iYe,dYe=cYe,F9=Array.prototype,L9=String.prototype,hYe=v(function(y){var C=y.includes;return y===F9||lhe(F9,y)&&C===F9.includes?uYe:"string"==typeof y||y===L9||lhe(L9,y)&&C===L9.includes?dYe:C}),fYe=v(Gue),che={exports:{}},pYe=Cr(function(){if("function"==typeof ArrayBuffer){var y=new ArrayBuffer(8);Object.isExtensible(y)&&Object.defineProperty(y,"a",{value:8})}}),mYe=ys,vYe=Ep,uhe=pYe,mP=Object.isExtensible,yYe=Cr(function(){mP(1)})||uhe?function(y){return!!mYe(y)&&(!uhe||"ArrayBuffer"!==vYe(y))&&(!mP||mP(y))}:mP,_Ye=!Cr(function(){return Object.isExtensible(Object.preventExtensions({}))}),CYe=An,bYe=Pr,xYe=Gw,wYe=ys,N9=ks,SYe=fc.f,dhe=Yw,TYe=E8,B9=yYe,IYe=_Ye,hhe=!1,Hp=MD("meta"),EYe=0,W9=function(y){SYe(y,Hp,{value:{objectID:"O"+EYe++,weakData:{}}})},DYe=che.exports={enable:function(){DYe.enable=function(){},hhe=!0;var y=dhe.f,C=bYe([].splice),x={};x[Hp]=1,y(x).length&&(dhe.f=function(w){for(var T=y(w),A=0,D=T.length;A<D;A++)if(T[A]===Hp){C(T,A,1);break}return T},CYe({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:TYe.f}))},fastKey:function(y,C){if(!wYe(y))return"symbol"==typeof y?y:("string"==typeof y?"S":"P")+y;if(!N9(y,Hp)){if(!B9(y))return"F";if(!C)return"E";W9(y)}return y[Hp].objectID},getWeakData:function(y,C){if(!N9(y,Hp)){if(!B9(y))return!0;if(!C)return!1;W9(y)}return y[Hp].weakData},onFreeze:function(y){return IYe&&hhe&&B9(y)&&!N9(y,Hp)&&W9(y),y}};xYe[Hp]=!0;var fhe=che.exports,AYe=An,PYe=Hr,RYe=fhe,kYe=Cr,MYe=om,OYe=l0,FYe=oS,LYe=vs,NYe=ys,BYe=p1,WYe=af,UYe=fc.f,VYe=r0.forEach,jYe=es,HYe=cf.set,GYe=cf.getterFor,phe=sm,zYe=$w,ghe=ede,YYe=Ap,XYe=oS,$Ye=p1,qYe=l0,KYe=X8,mhe=ZD,JYe=ose,HS=es,vhe=fhe.fastKey,yhe=cf.set,U9=cf.getterFor,QYe={getConstructor:function(y,C,x,w){var T=y(function(H,Y){XYe(H,A),yhe(H,{type:C,index:phe(null),first:void 0,last:void 0,size:0}),HS||(H.size=0),$Ye(Y)||qYe(Y,H[w],{that:H,AS_ENTRIES:x})}),A=T.prototype,D=U9(C),M=function(H,Y,G){var q,re,se=D(H),ce=B(H,Y);return ce?ce.value=G:(se.last=ce={index:re=vhe(Y,!0),key:Y,value:G,previous:q=se.last,next:void 0,removed:!1},se.first||(se.first=ce),q&&(q.next=ce),HS?se.size++:H.size++,"F"!==re&&(se.index[re]=ce)),H},B=function(H,Y){var G,q=D(H),re=vhe(Y);if("F"!==re)return q.index[re];for(G=q.first;G;G=G.next)if(G.key===Y)return G};return ghe(A,{clear:function(){for(var H=D(this),Y=H.first;Y;)Y.removed=!0,Y.previous&&(Y.previous=Y.previous.next=void 0),Y=Y.next;H.first=H.last=void 0,H.index=phe(null),HS?H.size=0:this.size=0},delete:function(H){var Y=this,G=D(Y),q=B(Y,H);if(q){var re=q.next,se=q.previous;delete G.index[q.index],q.removed=!0,se&&(se.next=re),re&&(re.previous=se),G.first===q&&(G.first=re),G.last===q&&(G.last=se),HS?G.size--:Y.size--}return!!q},forEach:function(H){for(var Y,G=D(this),q=YYe(H,arguments.length>1?arguments[1]:void 0);Y=Y?Y.next:G.first;)for(q(Y.value,Y.key,this);Y&&Y.removed;)Y=Y.previous},has:function(H){return!!B(this,H)}}),ghe(A,x?{get:function(H){var Y=B(this,H);return Y&&Y.value},set:function(H,Y){return M(this,0===H?0:H,Y)}}:{add:function(H){return M(this,H=0===H?0:H,H)}}),HS&&zYe(A,"size",{configurable:!0,get:function(){return D(this).size}}),T},setStrong:function(y,C,x){var w=C+" Iterator",T=U9(C),A=U9(w);KYe(y,C,function(D,M){yhe(this,{type:w,target:D,state:T(D),kind:M,last:void 0})},function(){for(var D=A(this),M=D.kind,B=D.last;B&&B.removed;)B=B.previous;return D.target&&(D.last=B=B?B.next:D.state.first)?mhe("keys"===M?B.key:"values"===M?B.value:[B.key,B.value],!1):(D.target=void 0,mhe(void 0,!0))},x?"entries":"values",!x,!0),JYe(C)}};!function(y,C,x){var w,T=-1!==y.indexOf("Map"),A=-1!==y.indexOf("Weak"),D=T?"set":"add",M=PYe[y],B=M&&M.prototype,H={};if(jYe&&LYe(M)&&(A||B.forEach&&!kYe(function(){(new M).entries().next()}))){var Y=(w=C(function(q,re){HYe(FYe(q,Y),{type:y,collection:new M}),BYe(re)||OYe(re,q[D],{that:q,AS_ENTRIES:T})})).prototype,G=GYe(y);VYe(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(q){var re="add"===q||"set"===q;!(q in B)||A&&"clear"===q||MYe(Y,q,function(se,ce){var ve=G(this).collection;if(!re&&A&&!NYe(se))return"get"===q&&void 0;var Te=ve[q](0===se?0:se,ce);return re?this:Te})}),A||UYe(Y,"size",{configurable:!0,get:function(){return G(this).collection.size}})}else w=x.getConstructor(C,y,T,D),RYe.enable();WYe(w,y,!1,!0),H[y]=w,AYe({global:!0,forced:!0},H),A||x.setStrong(w,y,T)}("Set",function(y){return function(){return y(this,arguments.length?arguments[0]:void 0)}},QYe);var eXe=Zv,tXe=TypeError,I0=function(y){if("object"==typeof y&&"size"in y&&"has"in y&&"add"in y&&"delete"in y&&"keys"in y)return y;throw new tXe(eXe(y)+" is not a set")},V9=function(y,C){return 1===C?function(x,w){return x[y](w)}:function(x,w,T){return x[y](w,T)}},_he=ba("Set"),nXe=_he.prototype,du={Set:_he,add:V9("add",1),has:V9("has",1),remove:V9("delete",1),proto:nXe},iXe=Ps,E0=function(y,C,x){for(var w,T,A=x?y:y.iterator,D=y.next;!(w=iXe(D,A)).done;)if(void 0!==(T=C(w.value)))return T},rXe=E0,GS=function(y,C,x){return x?rXe(y.keys(),C,!0):y.forEach(C)},oXe=GS,sXe=du.Set,aXe=du.add,j9=function(y){var C=new sXe;return oXe(y,function(x){aXe(C,x)}),C},zS=function(y){return y.size},Che=tu,bhe=jl,xhe=Ps,lXe=Uw,whe="Invalid size",uXe=RangeError,dXe=TypeError,hXe=Math.max,She=function(y,C){this.set=y,this.size=hXe(C,0),this.has=Che(y.has),this.keys=Che(y.keys)};She.prototype={getIterator:function(){return function(y){return{iterator:y,next:y.next,done:!1}}(bhe(xhe(this.keys,this.set)))},includes:function(y){return xhe(this.has,this.set,y)}};var D0=function(y){bhe(y);var C=+y.size;if(C!=C)throw new dXe(whe);var x=lXe(C);if(x<0)throw new uXe(whe);return new She(y,x)},fXe=I0,pXe=j9,gXe=zS,mXe=D0,vXe=GS,yXe=E0,_Xe=du.has,The=du.remove;An({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(y){var C=fXe(this),x=mXe(y),w=pXe(C);return gXe(C)<=x.size?vXe(C,function(T){x.includes(T)&&The(w,T)}):yXe(x.getIterator(),function(T){_Xe(C,T)&&The(w,T)}),w}});var bXe=I0,xXe=zS,wXe=D0,SXe=GS,TXe=E0,IXe=du.Set,Ihe=du.add,EXe=du.has;An({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(y){var C=bXe(this),x=wXe(y),w=new IXe;return xXe(C)>x.size?TXe(x.getIterator(),function(T){EXe(C,T)&&Ihe(w,T)}):SXe(C,function(T){x.includes(T)&&Ihe(w,T)}),w}});var AXe=I0,PXe=du.has,RXe=zS,kXe=D0,MXe=GS,OXe=E0,FXe=rA;An({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(y){var C=AXe(this),x=kXe(y);if(RXe(C)<=x.size)return!1!==MXe(C,function(T){if(x.includes(T))return!1},!0);var w=x.getIterator();return!1!==OXe(w,function(T){if(PXe(C,T))return FXe(w,"normal",!1)})}});var NXe=I0,BXe=zS,WXe=GS,UXe=D0;An({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(y){var C=NXe(this),x=UXe(y);return!(BXe(C)>x.size)&&!1!==WXe(C,function(w){if(!x.includes(w))return!1},!0)}});var jXe=I0,HXe=du.has,GXe=zS,zXe=D0,YXe=E0,XXe=rA;An({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(y){var C=jXe(this),x=zXe(y);if(GXe(C)<x.size)return!1;var w=x.getIterator();return!1!==YXe(w,function(T){if(!HXe(C,T))return XXe(w,"normal",!1)})}});var qXe=I0,KXe=j9,JXe=D0,QXe=E0,ZXe=du.add,e$e=du.has,t$e=du.remove;An({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(y){var C=qXe(this),x=JXe(y).getIterator(),w=KXe(C);return QXe(x,function(T){e$e(C,T)?t$e(w,T):ZXe(w,T)}),w}});var i$e=I0,r$e=du.add,o$e=j9,s$e=D0,a$e=E0;An({target:"Set",proto:!0,real:!0,forced:!0},{union:function(y){var C=i$e(this),x=s$e(y).getIterator(),w=o$e(C);return a$e(x,function(T){r$e(w,T)}),w}});var c$e=v(Co.Set),Ehe=v(Iie);function Dhe(y,C){var x=Zue(y);if(mue){var w=mue(y);C&&(w=she(w).call(w,function(T){return xue(y,T).enumerable})),x.push.apply(x,w)}return x}function fC(y){for(var C=1;C<arguments.length;C++){var x,w,T=null!=arguments[C]?arguments[C]:{};C%2?yi(x=Dhe(Object(T),!0)).call(x,function(A){tn(y,A,T[A])}):wue?iHe(y,wue(T)):yi(w=Dhe(Object(T))).call(w,function(A){Ehe(y,A,xue(T,A))})}return y}function vP(y){var C=function(){if("undefined"==typeof Reflect||!JA||JA.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(JA(Boolean,[],function(){})),!0}catch(x){return!1}}();return function(){var x,w=tC(y);if(C){var T=tC(this).constructor;x=JA(w,arguments,T)}else x=w.apply(this,arguments);return function(A,D){if(D&&("object"===Qu(D)||"function"==typeof D))return D;if(void 0!==D)throw new TypeError("Derived constructors may only return object or undefined");return Wo(A)}(this,x)}}var Gp=function(y){return iA?iA(y):"[object Array]"===Object.prototype.toString.call(y)},wa=function(y){return void 0===y},Ahe=function(y,C){var x,w;y=null!==(x=y)&&void 0!==x?x:"yyyy-MM-dd hh:mm:ss";var T=wa(C)?new Date:new Date(C),A={"M+":(T.getMonth()+1).toString(),"d+":T.getDate().toString(),"h+":T.getHours().toString(),"m+":T.getMinutes().toString(),"s+":T.getSeconds().toString(),"q+":Math.floor((T.getMonth()+3)/3).toString(),S:T.getMilliseconds().toString()};return/(y+)/.test(y)&&(y=y.replace(RegExp.$1,"".concat(T.getFullYear()).substring(4-RegExp.$1.length))),yi(w=Zue(A)).call(w,function(D){new RegExp("(".concat(D,")")).test(y)&&(y=y.replace(RegExp.$1,1===RegExp.$1.length?A[D]:"00".concat(A[D]).substring("".concat(A[D]).length)))}),y},Uo=function(y){return"string"==typeof y},wm=function(y){return"number"==typeof y&&!iC(y)},pC=function(y){return"function"==typeof y},Phe=0,Sm=function(){var y;return Phe+=1,Cm(y="".concat((new Date).getTime().toString(36))).call(y,Phe.toString(36))},yP=function(y){var C=Pze||window.webkitURL;/^blob:/.test(y)&&C.revokeObjectURL(y)},Rhe=function(){function y(){var C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Eo(this,y),tn(this,"prefix",void 0),tn(this,"postfix",void 0),tn(this,"isDestroyed",!1),tn(this,"uid",Sm()),tn(this,"cacheEvents",void 0),tn(this,"events",void 0),tn(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=C,this.postfix=x}return Do(y,[{key:"save",value:function(){this.isCached=!0}},{key:"restore",value:function(){var C,x=this;this.isCached=!1,yi(C=this.cacheEvents).call(C,function(w){var T,D=w.param;x.emit.apply(x,Cm(T=[w.eventName]).call(T,MS(D)))}),this.cacheEvents.length=0}},{key:"destroy",value:function(){var C=this;if(!this.isDestroyed){for(var x in this.events)if(Object.prototype.hasOwnProperty.call(this.events,x)){var w,T=this.events[x];T&&yi(w=ih(T).call(T)).call(w,function(A){C.off(A.name,A.fn,A.context,A.once)})}this.events={},this.isDestroyed=!0}}},{key:"on",value:function(C,x,w){var T,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],D=this.events,M={name:C=this.format(C),uid:Sm(),context:w,once:A,fn:x};return D[C]||(D[C]=[]),No(T=D[C]).call(T,M)<0&&D[C].push(M),M}},{key:"once",value:function(C,x,w){return this.on(C,x,w,!0)}},{key:"emit",value:function(C){for(var x,w,T=this,A=arguments.length,D=new Array(A>1?A-1:0),M=1;M<A;M++)D[M-1]=arguments[M];if(this.isCached)return this.cacheEvents.push({eventName:C,param:D}),!0;var B=this.events[C=this.format(C)];return!(!B||!B.length||(yi(x=ih(B).call(B)).call(x,function(H){var Y,G=H.fn;G.call.apply(G,Cm(Y=[H.context||null]).call(Y,D))}),yi(w=ih(B).call(B)).call(w,function(H){var q=H.once;q&&T.off(C,H.fn,H.context,q)}),0))}},{key:"off",value:function(C,x,w,T){var A=this.events[C=this.format(C)];if(!A)return!1;if(!arguments.length)return A.length=0,!0;for(var D=A.length-1;D>=0;D--){var M=A[D];x&&M.fn!==x||w&&M.context!==w||T&&M.once!==T||ua(A).call(A,D,1)}return!0}},{key:"removeAllEventListeners",value:function(C){if(C){var x,w;C=this.format(C);var T=Zde(x=this.cacheEvents).call(x,function(A){return A.eventName===C});T>-1&&ua(w=this.cacheEvents).call(w,T,1),this.events[C]&&delete this.events[C]}else this.cacheEvents=[],this.events={}}},{key:"getAllEvents",value:function(){return this.events}},{key:"format",value:function(C){var x,w;return Cm(x=Cm(w="".concat(this.prefix||"")).call(w,C)).call(x,this.postfix||"")}}],[{key:"create",value:function(C,x){return new y(C,x)}}]),y}(),H9="default",mr=function(){function y(){Eo(this,y),tn(this,"emitter",new Rhe)}return Do(y,[{key:"on",value:function(C){this.emitter.on(H9,C)}},{key:"emit",value:function(){for(var C,x,w=arguments.length,T=new Array(w),A=0;A<w;A++)T[A]=arguments[A];(C=this.emitter).emit.apply(C,Cm(x=[H9]).call(x,T))}},{key:"off",value:function(C){this.emitter.off(H9,C)}}],[{key:"create",value:function(){return new y}}]),y}(),YS=function(){function y(C){Eo(this,y),tn(this,"uid",void 0),tn(this,"children",void 0),this.uid=C.uid,this.children=C.children||[]}return Do(y,[{key:"append",value:function(C){var x=this.children;return No(x).call(x,C)<0&&(x.push(C),!0)}},{key:"insert",value:function(C,x){var w=this.children;return!(x<0||(x>w.length&&(x=w.length),ua(w).call(w,x,0,C),0))}},{key:"remove",value:function(C){var x=this.children,w=No(x).call(x,C);return!(w<0||(ua(x).call(x,w,1),0))}},{key:"clear",value:function(){return this.children=[],!0}},{key:"move",value:function(C,x){if(C===x)return!0;var w=this.children,T=nC(ua(w).call(w,C,1),1)[0];return ua(w).call(w,x,0,T),!0}},{key:"switch",value:function(C,x){if(C===x)return!0;var w=this.children,T=w[C];return w[C]=w[x],w[x]=T,!0}},{key:"reorder",value:function(C){var x=this.children,w=C.length,T=[],A=0;if(x.length!==w||0===w)return!1;for(var D=0;D<w;D++)C[D]===D&&(A+=1);if(A===w)return!0;for(var M=0;M<w;M++)T[M]=x[C[M]];for(var B=0;B<w;B++)x[B]=T[B];return!0}}]),y}(),khe=function(){function y(C,x){Eo(this,y),tn(this,"isDestroyed",!1),tn(this,"data",void 0),tn(this,"table",["database","table","item"]),tn(this,"dbName",void 0),tn(this,"tableName",void 0),this.data={},this.dbName=C,this.tableName=x,this.createDatabase(C,x)}return Do(y,[{key:"destroy",value:function(){if(!this.isDestroyed){for(var C=0,x=gP(this.data);C<x.length;C++){var w=nC(x[C],2);this.data[w[0]]=null}this.data=null,this.isDestroyed=!0}}},{key:"createDatabase",value:function(C,x){this.data[C]={},this.data[C][x]={}}},{key:"set",value:function(C,x){var w=this,T=this.dbName,A=this.tableName;return new u0(function(D,M){w.checkId(C)?M(new Error("The ".concat(C," already exists."))):(w.data[T][A][C]=x,D("Save ".concat(C," to database successful.")))})}},{key:"get",value:function(C){var x=this,w=this.dbName,T=this.tableName;return new u0(function(A,D){x.checkId(C)?A(x.data[w][T][C]):D(x.erMsg(2,C))})}},{key:"remove",value:function(C){var x=this,w=this.dbName,T=this.tableName;return new u0(function(A,D){delete x.data[w][T][C],A("Remove ".concat(C," successful."))})}},{key:"update",value:function(C,x){var w=this,T=this.dbName,A=this.tableName;return new u0(function(D,M){w.checkId(C)?(w.data[T][A][C]=x,D("Update ".concat(C," successful."))):M(w.erMsg(2,C))})}},{key:"checkId",value:function(C){return void 0!==this.data[this.dbName][this.tableName][C]}},{key:"erMsg",value:function(C,x){var w;return Cm(w="The ".concat(this.table[C]," ")).call(w,x," does not exist.")}}]),y}(),_P=function(){function y(){Eo(this,y),tn(this,"isDestroyed",!1),tn(this,"data",void 0),this.data={}}return Do(y,[{key:"destroy",value:function(){if(!this.isDestroyed){for(var C=0,x=gP(this.data);C<x.length;C++){var w,A=nC(x[C],2)[0];null!==(w=this.data[A])&&void 0!==w&&w.destroy(),this.data[A]=null}this.data=null,this.isDestroyed=!0}}},{key:"set",value:function(C,x){return!this.check(C)&&(this.data[C]=x,!0)}},{key:"get",value:function(C){return this.data[C]}},{key:"remove",value:function(C){return!!this.check(C)&&(delete this.data[C],!0)}},{key:"update",value:function(C,x){return!!this.check(C)&&(this.data[C]=x,!0)}},{key:"check",value:function(C){return void 0!==this.data[C]}}]),y}(),Mhe=function(y){ZA(x,y);var C=vP(x);function x(w){var T;return Eo(this,x),tn(Wo(T=C.call(this,w)),"name",void 0),tn(Wo(T),"type",void 0),tn(Wo(T),"fileType",void 0),tn(Wo(T),"createdDate",void 0),tn(Wo(T),"modifiedDate",void 0),tn(Wo(T),"parent",void 0),tn(Wo(T),"isRoot",!1),T.name=w.name,T.type=w.type,T.fileType=w.fileType,T.parent=w.parent||null,T.isRoot=w.isRoot||!1,T.createdDate=Ahe(),T.modifiedDate=T.createdDate,T}return Do(x,[{key:"updateDate",value:function(){this.modifiedDate=Ahe()}},{key:"setName",value:function(w){this.name=w}},{key:"reorder",value:function(w){var T=this.type;return("file"===T||"default"===T)&&QA(tC(x.prototype),"reorder",this).call(this,w)}}]),x}(YS),u$e=function(){function y(){Eo(this,y),tn(this,"root",void 0),tn(this,"currentNode",void 0),tn(this,"selectedUid",void 0),tn(this,"defaultNode",void 0),tn(this,"hooks",{fileChanged:mr.create(),beforeRemoveFile:mr.create(),removeFile:mr.create(),afterRemoveFile:mr.create(),afterRenameFile:mr.create(),destroy:mr.create()}),this.root=new Mhe({uid:Sm(),children:[],name:"root",type:"file",fileType:"folder",parent:void 0,isRoot:!0}),this.defaultNode=this.root,this.currentNode=this.root}return Do(y,[{key:"appendChildrenToFile",value:function(C,x,w){var T=w,A=Ohe(this.defaultNode,C);return A||(A=this.createFile(C),this.hooks.fileChanged.emit(this.defaultNode)),yi(x).call(x,function(D){wa(T)?A.append(D):(A.insert(D,T),T+=1)}),A}},{key:"removeChildFromFile",value:function(C,x){Uo(x)&&(x=[x]);var w=this.getFileByUid(C);w&&yi(x).call(x,function(T){w.remove(T)})}},{key:"findChild",value:function(C,x){var w;return VS(w=C.children).call(w,function(T){return T.name===x})}},{key:"createFile",value:function(C){var x=this.defaultNode;x||(x=this.root);var w=Ohe(x,C);return w&&"file"===w.type||(w=new Mhe({uid:Sm(),children:[],name:C,type:"file",fileType:"file",parent:x,isRoot:!1}),this.currentNode.append(w),this.hooks.fileChanged.emit(this.currentNode.children)),w}},{key:"removeFile",value:function(C){for(var x=this.defaultNode.children,w=0;w<x.length;w++){var T=x[w];if(T.name===C)return this.hooks.beforeRemoveFile.emit(T),ua(x).call(x,w,1),this.hooks.afterRemoveFile.emit(T),this.hooks.fileChanged.emit(T),!0}return!1}},{key:"renameFile",value:function(C,x){var w=this.findChild(this.defaultNode,C),T=this.findChild(this.defaultNode,x);return!!w&&!T&&(w.name=x,this.hooks.afterRenameFile.emit(w),this.hooks.fileChanged.emit(this.currentNode.children),!0)}},{key:"getFile",value:function(C){return this.findChild(this.defaultNode,C)}},{key:"getFileByUid",value:function(C){return VS(this).call(this,C,this.root)}},{key:"getCurrentFileList",value:function(){return this.currentNode.children}},{key:"isFileExist",value:function(C){return!!this.findChild(this.defaultNode,C)}},{key:"createFolder",value:function(){}},{key:"find",value:function(C,x){for(var w=x.children,T=w.length,A=0;A<T;A++){if(w[A].uid===C)return w[A];if(w[A].children){var D=VS(this).call(this,C,w[A]);if(D)return D}}return null}}]),y}();function Ohe(y,C){var x,w=she(x=y.children).call(x,function(T){return T.name===C});return 0===w.length?null:w[0]}var Fhe,CP,Lhe=function(y){ZA(x,y);var C=vP(x);function x(w){var T;return Eo(this,x),tn(Wo(T=C.call(this,w)),"name",void 0),tn(Wo(T),"type","tag"),T.name=w.name,T.uid=w.uid||Sm(),T.type="tag",T}return Do(x)}(YS),d$e=function(){function y(){Eo(this,y),tn(this,"tags",void 0),tn(this,"defaultName",void 0),tn(this,"defaultUid",void 0),tn(this,"selectedUid",void 0),tn(this,"emptyItem",void 0),tn(this,"hooks",{beforeRemoveTag:mr.create(),afterRenameTag:mr.create(),destroy:mr.create(),load:mr.create()}),this.tags=[],this.defaultName=null,this.defaultUid=null,this.selectedUid=null,this.emptyItem=new Lhe({name:"defaultTag",children:[]})}return Do(y,[{key:"appendChildToTag",value:function(C,x){var w=this.createTag(C);Uo(x)&&(x=[x]);var T=!1;return yi(x).call(x,function(A){w.append(A)&&(T=!0)}),T}},{key:"removeChildFromTag",value:function(C,x){var w=this.getTag(C);return!!w&&(Uo(x)&&(x=[x]),yi(x).call(x,function(T){w.remove(T)}),!0)}},{key:"createTag",value:function(C){var x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],w=this.getTag(C);return w||(w=new Lhe({name:C,children:x}),this.tags.push(w)),w}},{key:"removeTag",value:function(C){var x,w,T=this.getTag(C);if(!T)return!1;this.hooks.beforeRemoveTag.emit(T);var A=Zde(x=this.tags).call(x,function(D){return D.name===C});return C===this.defaultName&&(this.defaultName=null,this.selectedUid=null),ua(w=this.tags).call(w,A,1),!0}},{key:"renameTag",value:function(C,x){if(!Uo(C)||!Uo(x))return!1;var w=this.isTagExisted(x),T=this.getTag(C);return!(!T||w||(T.name=x,this.hooks.afterRenameTag.emit(T),0))}},{key:"getTag",value:function(C){var x;return VS(x=this.tags).call(x,function(w){return w.name===C})}},{key:"getTagByUid",value:function(C){var x;return VS(x=this.tags).call(x,function(w){return w.uid===C})}},{key:"getTagList",value:function(){var C;return ih(C=this.tags).call(C)}},{key:"setDefaultTag",value:function(C){if(!C)return this.defaultName=null,this.defaultUid=null,!0;var x=this.getTag(C);return!!x&&(this.defaultName=C,this.defaultUid=x.uid,!0)}},{key:"getDefaultTag",value:function(){return this.defaultName}},{key:"isTagExisted",value:function(C){return!!this.getTag(C)}}]),y}(),h$e=function(){function y(){Eo(this,y)}return Do(y,[{key:"apply",value:function(C){var x=C.hooks,w={beforeStatus:null,afterStatus:null,operation:null,docUid:null},T=function(D){w.beforeStatus={uids:[],selectedUids:[],currentUid:"",modifiedUid:D.modifiedUid,removedUids:D.removedUids}},A=function(D){w.afterStatus={uids:[],selectedUids:[],currentUid:"",modifiedUid:D.modifiedUid,removedUids:D.removedUids},w.docUid="",w.operation=D.operation,C.emit("bufferChanged",fC({},w)),w={beforeStatus:null,afterStatus:null,operation:null,docUid:null}};x.beforeBufferChanged.on(T),x.afterBufferChanged.on(A),x.destroy.on(function(){x.beforeBufferChanged.off(T),x.afterBufferChanged.off(A)})}}]),y}(),f$e=function(){function y(){Eo(this,y)}return Do(y,[{key:"apply",value:function(C){var x=C.hooks;C.customStore=new _P;var w=function(D){var M=D.data;yi(M).call(M,function(B){var H=B.customData;H||(H={}),C.customStore.set(B.uid,H)})},T=function(D){var M=D.removedUids;yi(M).call(M,function(B){C.customStore.remove(B)})},A=function(D){var M=D.data.customData;M&&C.customStore.update(D.modifiedUid,M)};x.loadSource.on(w),x.removeSource.on(T),x.updateSource.on(A),x.destroy.on(function(){x.loadSource.off(w),x.removeSource.off(T),x.updateSource.off(A)})}}]),y}(),p$e=function(y){ZA(x,y);var C=vP(x);function x(){var w;return Eo(this,x),tn(Wo(w=C.call(this,{uid:Sm(),children:[]})),"name","dvs-default"),tn(Wo(w),"isDestroyed",!1),tn(Wo(w),"type",void 0),w}return Do(x,[{key:"destroy",value:function(){this.isDestroyed||(this.isDestroyed=!0)}}]),x}(YS),g$e=function(){function y(){Eo(this,y)}return Do(y,[{key:"apply",value:function(C){C.defaultFile=new p$e;var x=C.hooks,w=function(A){var D,M,B,Y=A.index,G=A.data;if(wa(A.filename)){var q=jS(G).call(G,function(se){return se.uid});void 0===Y?(D=C.defaultFile.children).push.apply(D,MS(q)):ua(M=C.defaultFile.children).apply(M,Cm(B=[Y,0]).call(B,MS(q))),C.hooks.loadToDoc.emit({docUid:C.defaultFile.uid,sourceUids:q,type:"default",index:Y})}},T=function(A){var D=A.removedUids,M=[];yi(D).call(D,function(B){var H=C.statusStore.get(B);H&&H.ownerDefaultFile&&(C.defaultFile.remove(B),M.push(B))}),M.length&&C.hooks.removeFromDoc.emit({docUid:C.defaultFile.uid,sourceUids:D,type:"default"})};x.loadSource.on(w),x.removeSource.on(T),x.destroy.on(function(){x.loadSource.off(w),x.removeSource.off(T)})}}]),y}(),m$e=function(){function y(){Eo(this,y)}return Do(y,[{key:"apply",value:function(C){C.dir=new u$e,this.listenDirectoryHooks(C),this.listenSpaceHooks(C)}},{key:"listenDirectoryHooks",value:function(C){var x=C.dir.hooks,w=function(A){var D;yi(D=A.children).call(D,function(M){var B=C.statusStore.get(M);B&&B.ownerFiles.remove(A.uid)}),C.hooks.removeDoc.emit(A)},T=function(A){C.hooks.renameDoc.emit(A)};x.beforeRemoveFile.on(w),x.afterRenameFile.on(T),x.destroy.on(function(){x.beforeRemoveFile.off(w),x.afterRenameFile.off(T)})}},{key:"listenSpaceHooks",value:function(C){var x=C.hooks,w=function(A){var D=A.data,M=A.filename,B=A.index;if(!wa(M)){var H=jS(D).call(D,function(G){return G.uid}),Y={docUid:C.dir.appendChildrenToFile(M,H,B).uid,sourceUids:H,type:"file",index:B};C.hooks.loadToDoc.emit(Y)}},T=function(A){var D=A.removedUids,M={};yi(D).call(D,function(re){var se,ce,ve=C.statusStore.get(re);ve&&yi(se=ih(ce=ve.ownerFiles.children).call(ce)).call(se,function(Te){M[Te]||(M[Te]=[]),M[Te].push(re)})});for(var B=0,H=gP(M);B<H.length;B++){var Y=nC(H[B],2),G=Y[0],q=Y[1];C.dir.removeChildFromFile(G,q),C.hooks.removeFromDoc.emit({docUid:G,sourceUids:q})}};x.loadSource.on(w),x.removeSource.on(T),x.destroy.on(function(){x.loadSource.off(w),x.removeSource.off(T)})}}]),y}(),v$e=function(){function y(){Eo(this,y)}return Do(y,[{key:"apply",value:function(C){var x=C.hooks;C.metadataStore=new _P;var w=function(D){var M=D.data;yi(M).call(M,function(B){var H=B.metadata;H||(H={width:void 0,height:void 0}),C.metadataStore.set(B.uid,H)})},T=function(D){var M=D.removedUids;yi(M).call(M,function(B){C.metadataStore.remove(B)})},A=function(D){var M=D.data.metadata;M&&C.metadataStore.update(D.modifiedUid,M)};x.loadSource.on(w),x.removeSource.on(T),x.updateSource.on(A),x.destroy.on(function(){x.loadSource.off(w),x.removeSource.off(T),x.updateSource.off(A)})}}]),y}(),y$e=function(){function y(C){Eo(this,y),tn(this,"uid",null),tn(this,"minData",null),tn(this,"oriData",null),tn(this,"customData",{}),tn(this,"activeOri",!1),tn(this,"activeMin",!1),tn(this,"minTask",null),tn(this,"oriTask",null),tn(this,"load",!1),tn(this,"preload",[]),tn(this,"visible",[]),tn(this,"overlays",[]),tn(this,"img",null),tn(this,"minImg",null),tn(this,"imageScale",1),tn(this,"owners",[]),tn(this,"oriType",null),tn(this,"minType",null),tn(this,"metadata",null),tn(this,"realTimeWidth",0),tn(this,"realTimeHeight",0),tn(this,"isFromFile",!1),tn(this,"isCached",!1),tn(this,"isDestroyed",!1),tn(this,"isLoading",!1),tn(this,"isMinLoading",!1),tn(this,"isSaving",!1),tn(this,"annotations",void 0),tn(this,"ownerFiles",new YS({children:[]})),tn(this,"ownerTags",new YS({children:[]})),tn(this,"ownerDefaultFile",void 0),tn(this,"operations",[]),tn(this,"useFillColor",!1),this.uid=C.uid,this.metadata=fC({},C.metadata),this.setRealTimeSize(this.metadata.width,this.metadata.height)}return Do(y,[{key:"setRealTimeSize",value:function(C,x){this.realTimeWidth=C,this.realTimeHeight=x}},{key:"destroy",value:function(){this.isDestroyed||(this.customData=null,this.img=null,this.owners=null,this.metadata=null,this.isDestroyed=!0)}},{key:"addOwner",value:function(C){var x=this.owners;No(x).call(x,C)<0&&x.push(C)}},{key:"removeOwner",value:function(C){var x=this.owners,w=No(x).call(x,C);w>-1&&ua(x).call(x,w,1)}},{key:"removeViewer",value:function(C){var x=this.owners,w=No(x).call(x,C);w>-1&&ua(x).call(x,w,1)}},{key:"setVisible",value:function(C){var x;No(x=this.visible).call(x,C)<0&&this.visible.push(C)}},{key:"cancelVisible",value:function(C){var x,w,T=No(x=this.visible).call(x,C);T>-1&&ua(w=this.visible).call(w,T,1)}},{key:"setPreload",value:function(C){var x;No(x=this.preload).call(x,C)<0&&this.preload.push(C)}},{key:"cancelPreload",value:function(C){var x,w,T=No(x=this.preload).call(x,C);T>-1&&ua(w=this.preload).call(w,T,1)}},{key:"reset",value:function(){this.minData=null,this.oriData=null,this.img=null,this.activeOri=!1,this.activeMin=!1,this.minTask=null,this.oriTask=null,this.operations=[]}}]),y}(),_$e=function(){function y(){Eo(this,y)}return Do(y,[{key:"apply",value:function(C){var x=C.hooks;C.statusStore=new _P;var w=function(H){var Y=H.data;yi(Y).call(Y,function(G){var q=new y$e(G);C.statusStore.set(G.uid,q)})},T=function(H){var Y=H.removedUids;yi(Y).call(Y,function(G){var q,re,se=C.statusStore.get(G);se&&(yP(se.minData),yP(se.oriData),se.ownerFiles.clear(),se.ownerTags.clear(),se.ownerDefaultFile=!1,null!==(q=se.img)&&void 0!==q&&q.src&&(se.img.src=""),null!==(re=se.minImg)&&void 0!==re&&re.src&&(se.minImg.src=""),se.img=null,se.minImg=null),C.statusStore.remove(G)})},A=function(H){var Y=H.modifiedUid,G=H.data,q=H.revoke,re=C.statusStore.get(Y);if(re){re.img=null,re.minImg=null;var se=G.metadata;se&&(re.metadata=fC({},se),re.setRealTimeSize(se.width,se.height)),q&&(yP(re.oriData),yP(re.minData)),re.reset(),C.statusStore.update(Y,re)}},D=function(H){var Y;yi(Y=H.children).call(Y,function(G){var q=C.statusStore.get(G);q&&("file"===H.type?q.ownerFiles.remove(H.uid):"tag"===H.type&&q.ownerTags.remove(H.uid))})},M=function(H){var Y=H.docUid,G=H.sourceUids,q=H.type;yi(G).call(G,function(re){var se=C.statusStore.get(re);se&&("file"===q?se.ownerFiles.append(Y):"tag"===q?se.ownerTags.append(Y):"default"===q&&(se.ownerDefaultFile=!0))})},B=function(H){var Y=H.docUid,G=H.sourceUids,q=H.type;yi(G).call(G,function(re){var se=C.statusStore.get(re);se&&("file"===q?se.ownerFiles.remove(Y):"tag"===q?se.ownerTags.remove(Y):"default"===q&&(se.ownerDefaultFile=!0))})};x.loadSource.on(w),x.afterRemoveSource.on(T),x.updateSource.on(A),x.removeDoc.on(D),x.loadToDoc.on(M),x.removeFromDoc.on(B),x.destroy.on(function(){x.loadSource.off(w),x.afterRemoveSource.off(T),x.updateSource.off(A),x.removeDoc.off(D),x.loadToDoc.off(M),x.removeFromDoc.off(B)})}}]),y}(),C$e=function(){function y(){Eo(this,y)}return Do(y,[{key:"apply",value:function(C){var x=C.hooks;C.store=new khe("space_db","space_doc");var w=function(D){var M=D.data;M&&yi(M).call(M,function(B){C.store.set(B.uid,B)})},T=function(D){var M;yi(M=D.removedUids).call(M,function(B){C.store.remove(B)})},A=function(D){C.store.update(D.modifiedUid,D.data)};x.loadSource.on(w),x.removeSource.on(T),x.updateSource.on(A),x.destroy.on(function(){x.loadSource.off(w),x.removeSource.off(T),x.updateSource.off(A)})}}]),y}(),b$e=function(){function y(){Eo(this,y)}return Do(y,[{key:"apply",value:function(C){C.tag=new d$e,this.listenSpaceHooks(C),this.listenTagHooks(C)}},{key:"listenTagHooks",value:function(C){var x=C.tag.hooks,w=function(A){var D;yi(D=A.children).call(D,function(M){var B=C.statusStore.get(M);B&&B.ownerFiles.remove(A.uid)}),C.hooks.removeDoc.emit(A)},T=function(A){C.hooks.renameDoc.emit(A)};x.beforeRemoveTag.on(w),x.afterRenameTag.on(T),x.destroy.on(function(){x.beforeRemoveTag.off(w),x.afterRenameTag.off(T)})}},{key:"listenSpaceHooks",value:function(C){var x=C.hooks,w=function(H){var Y=H.data,G=C.tag.defaultName;yi(Y).call(Y,function(q){var re;q.tags||(q.tags=[]),G&&No(re=q.tags).call(re,G)<0&&q.tags.push(G)})},T=function(H){var Y=H.data;yi(Y).call(Y,function(G){var q;null!==(q=G.tags)&&void 0!==q&&yi(q).call(q,function(re){C.tag.appendChildToTag(re,G.uid);var se={docUid:C.tag.getTag(re).uid,sourceUids:[G.uid],type:"tag"};C.hooks.loadToDoc.emit(se)}),G.tags.length=0})},A=function(H){var Y=H.removedUids,G={};yi(Y).call(Y,function(Ue){var je,Ee,Oe=C.statusStore.get(Ue);Oe&&yi(je=ih(Ee=Oe.ownerTags.children).call(Ee)).call(je,function(He){G[He]||(G[He]=[]),G[He].push(Ue)})});for(var q=0,re=gP(G);q<re.length;q++){var se=nC(re[q],2),ce=se[0],ve=se[1],Te=C.tag.getTagByUid(ce);Te&&C.tag.removeChildFromTag(Te.name,ve),C.hooks.removeFromDoc.emit({docUid:ce,sourceUids:ve,type:"tag"})}},D=function(H){"tag"!==H.type&&A({removedUids:H.children})},M=function(H){var re,G=H.sourceUids;if("tag"===H.type){var q=C.tag.getTagByUid(H.docUid);q&&yi(G).call(G,(re=Pue(tP.mark(function se(ce){var ve,Te;return tP.wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return Ue.prev=0,Ue.next=3,C.store.get(ce);case 3:if(Ue.t0=(Te=Ue.sent)&&No(ve=Te.tags).call(ve,q.name)<0,!Ue.t0){Ue.next=9;break}return Te.tags.push(q.name),Ue.next=9,C.store.update(ce,Te);case 9:Ue.next=14;break;case 11:Ue.prev=11,Ue.t1=Ue.catch(0);case 14:case"end":return Ue.stop()}},se,null,[[0,11]])})),function(se){return re.apply(this,arguments)}))}},B=function(H){var re,G=H.sourceUids;if("tag"===H.type){var q=C.tag.getTagByUid(H.docUid);q&&yi(G).call(G,(re=Pue(tP.mark(function se(ce){var ve,Te,Ue,je;return tP.wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:return Ee.prev=0,Ee.next=3,C.store.get(ce);case 3:if(!(ve=Ee.sent)){Ee.next=9;break}return(je=No(Te=ve.tags).call(Te,q.name))>-1&&ua(Ue=ve.tags).call(Ue,je,1),Ee.next=9,C.store.update(ce,ve);case 9:Ee.next=14;break;case 11:Ee.prev=11,Ee.t0=Ee.catch(0);case 14:case"end":return Ee.stop()}},se,null,[[0,11]])})),function(se){return re.apply(this,arguments)}))}};x.beforeLoadSource.on(w),x.loadSource.on(T),x.removeSource.on(A),x.removeDoc.on(D),x.loadToDoc.on(M),x.removeFromDoc.on(B),x.destroy.on(function(){x.beforeLoadSource.off(w),x.loadSource.off(T),x.removeSource.off(A),x.removeDoc.off(D),x.loadToDoc.off(M),x.removeFromDoc.off(B)})}}]),y}(),x$e=function(y){ZA(x,y);var C=vP(x);function x(){var w;return Eo(this,x),tn(Wo(w=C.call(this)),"uid",Sm()),tn(Wo(w),"hooks",{init:mr.create(),destroy:mr.create(),beforeLoadSource:mr.create(),loadSource:mr.create(),afterLoadSource:mr.create(),beforeRemoveSource:mr.create(),removeSource:mr.create(),afterRemoveSource:mr.create(),beforeUpdateSource:mr.create(),updateSource:mr.create(),afterUpdateSource:mr.create(),beforeBufferChanged:mr.create(),afterBufferChanged:mr.create(),directoryChanged:mr.create(),tagChanged:mr.create(),openDoc:mr.create(),loadToDoc:mr.create(),removeFromDoc:mr.create(),removeDoc:mr.create(),renameDoc:mr.create(),move:mr.create(),afterMove:mr.create(),switch:mr.create(),afterSwitch:mr.create(),reorder:mr.create(),afterReorder:mr.create()}),tn(Wo(w),"dir",void 0),tn(Wo(w),"tag",void 0),tn(Wo(w),"store",void 0),tn(Wo(w),"customStore",void 0),tn(Wo(w),"metadataStore",void 0),tn(Wo(w),"statusStore",void 0),tn(Wo(w),"defaultFile",void 0),tn(Wo(w),"plugins",[]),tn(Wo(w),"imageLoader",void 0),w.initPlugins(),w.hooks.init.emit(),w}return Do(x,[{key:"destroy",value:function(){this.hooks.destroy.emit()}},{key:"initPlugins",value:function(){(new C$e).apply(this),(new _$e).apply(this),(new f$e).apply(this),(new v$e).apply(this),(new h$e).apply(this),(new g$e).apply(this),(new m$e).apply(this),(new b$e).apply(this)}},{key:"setImageLoader",value:function(w){this.imageLoader=w}},{key:"getCustomData",value:function(w){return this.customStore.get(w)}},{key:"setCustomData",value:function(w,T){return this.customStore.set(w,T)}},{key:"getMetadata",value:function(w){return this.metadataStore.get(w)}},{key:"setMetadata",value:function(w,T){return this.metadataStore.set(w,T)}},{key:"createStore",value:function(w){var T=w.type,D=w.tableName,M=w.dbName;return"sync"===(void 0===T?"sync":T)?new _P:M&&D?new khe(M,D):null}},{key:"loadSource",value:function(w,T){if(wa(w))return[];var A=w.data;if(!Gp(A))return[];var D=[];return yi(A).call(A,function(M){M.uid=Sm(),D.push(M.uid)}),pC(T)&&T(D),this.hooks.beforeBufferChanged.emit(w),this.hooks.beforeLoadSource.emit(w),this.hooks.loadSource.emit(w),this.hooks.afterLoadSource.emit(w),this.hooks.afterBufferChanged.emit(w),D}},{key:"removeSource",value:function(w){var T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Uo(w)&&(w=[w]);var A={removedUids:w,docUid:"",trigger:this.uid,operation:"remove"};return this.hooks.beforeRemoveSource.emit(A),this.hooks.beforeBufferChanged.emit(A),this.hooks.removeSource.emit(A),T&&this.hooks.afterRemoveSource.emit(A),this.hooks.afterBufferChanged.emit(A),!0}},{key:"updateSource",value:function(w,T){var A={modifiedUid:w,data:T,revoke:!(arguments.length>2&&void 0!==arguments[2])||arguments[2],operation:"modify"};return this.hooks.beforeUpdateSource.emit(A),this.hooks.beforeBufferChanged.emit(A),this.hooks.updateSource.emit(A),this.hooks.afterUpdateSource.emit(A),this.hooks.afterBufferChanged.emit(A),!0}},{key:"getSource",value:function(w){return this.store.get(w)}},{key:"openDefault",value:function(w){this.hooks.openDoc.emit({node:this.defaultFile,type:"default",config:w})}},{key:"createFile",value:function(w){return this.dir.createFile(w)}},{key:"removeFile",value:function(w){return this.dir.removeFile(w)}},{key:"renameFile",value:function(w,T){return this.dir.renameFile(w,T)}},{key:"openFile",value:function(w,T){var A=this.getFile(w);return!!A&&(this.hooks.openDoc.emit({node:A,type:"file",config:T}),!0)}},{key:"movePagesToFile",value:function(w,T,A,D){var M=this,B=this.getFile(w),H=this.getFile(A);if(!B||!H)return!1;for(var Y=0;Y<T.length;Y++)if(T[Y]<0||T[Y]>=B.children.length)return!1;if(D<0)return!1;var G=jS(T).call(T,function(se){return B.children[se]});yi(G).call(G,function(se){var ce=M.statusStore.get(se);ce&&ce.ownerFiles.remove(B.uid)}),this.dir.removeChildFromFile(B.uid,G),this.hooks.removeFromDoc.emit({docUid:B.uid,sourceUids:G}),D>H.children.length&&(D=H.children.length);var q=this.dir.appendChildrenToFile(A,G,D),re={docUid:q.uid,sourceUids:G,type:"file",index:D};return yi(G).call(G,function(se){var ce=M.statusStore.get(se);ce&&ce.ownerFiles.append(q.uid)}),this.hooks.loadToDoc.emit(re),!0}},{key:"getFile",value:function(w){return this.dir.getFile(w)}},{key:"getFileList",value:function(){return this.dir.getCurrentFileList()}},{key:"isFileExisted",value:function(w){return this.dir.isFileExist(w)}},{key:"createTag",value:function(w){return this.tag.createTag(w)}},{key:"removeTag",value:function(w){for(var T=this.getTag(w).children||[],A=0;A<T.length;A++)this.store.get(T[A]).then(function(D){var M,B,H=No(M=(null==D?void 0:D.tags)||[]).call(M,w);-1!==H&&ua(B=D.tags).call(B,H,1)});return this.tag.removeTag(w)}},{key:"renameTag",value:function(w,T){var A=this.getTag(w).children||[],D=this.tag.renameTag(w,T);if(D)for(var M=0;M<A.length;M++)this.store.get(A[M]).then(function(B){var H,Y,G=No(H=(null==B?void 0:B.tags)||[]).call(H,w);-1!==G&&ua(Y=B.tags).call(Y,G,1,T)});return D}},{key:"openTag",value:function(w,T){var A=this.getTag(w);return!!A&&(this.hooks.openDoc.emit({node:A,type:"tag",config:T}),!0)}},{key:"getTag",value:function(w){return this.tag.getTag(w)}},{key:"getTagList",value:function(){return this.tag.getTagList()}},{key:"setDefaultTag",value:function(w){return this.tag.setDefaultTag(w)}},{key:"getDefaultTag",value:function(){return this.tag.getDefaultTag()}},{key:"isTagExisted",value:function(w){return this.tag.isTagExisted(w)}},{key:"addTagToSource",value:function(w,T){if(this.statusStore.get(w)){Uo(T)&&(T=[T]);for(var A=0;A<T.length;A++)if(!this.addSourceToTag(T[A],w))return!1;return!0}return!1}},{key:"removeTagFromSource",value:function(w,T){if(this.statusStore.get(w)){var A;wa(T)?T=jS(A=this.tag.tags).call(A,function(M){return M.name}):Uo(T)&&(T=[T]);for(var D=0;D<T.length;D++)if(!this.removeSourceFromTag(T[D],w))return!1;return!0}return!1}},{key:"addSourceToTag",value:function(w,T){var A=this.tag.getTag(w);if(A&&this.tag.appendChildToTag(w,T)){Uo(T)&&(T=[T]);for(var D=0;D<T.length;D++)this.store.get(T[D]).then(function(B){var H;B&&(Gp(B.tags)||(B.tags=[]),hYe(H=B.tags).call(H,w)||B.tags.push(w))});return this.hooks.loadToDoc.emit({sourceUids:T,docUid:A.uid,type:"tag"}),!0}return!1}},{key:"removeSourceFromTag",value:function(w,T){var A=this.tag.getTag(w);if(A){this.tag.removeChildFromTag(w,T),Uo(T)&&(T=[T]);for(var D=0;D<T.length;D++)this.store.get(T[D]).then(function(B){var H,Y,G=No(H=(null==B?void 0:B.tags)||[]).call(H,w);-1!==G&&ua(Y=B.tags).call(Y,G,1)});return this.hooks.removeFromDoc.emit({docUid:A.uid,sourceUids:T,type:"tag"}),!0}return!1}},{key:"getSourceTags",value:function(w){var T,A=this,D=this.statusStore.get(w);return D?jS(T=D.ownerTags.children).call(T,function(M){return A.tag.getTagByUid(M).name}):[]}},{key:"switch",value:function(w){var T=w.one,A=w.other,M=w.docUid,B=w.emit,H=this.getDocNode(M,w.type);return!!H&&(H.switch(T,A),(B||wa(B))&&this.hooks.switch.emit({one:T,other:A,docUid:M,type:H.type,trigger:this.uid,operation:"shift"}),!0)}},{key:"move",value:function(w){var T=w.from,A=w.to,M=w.docUid,B=w.emit,H=this.getDocNode(M,w.type);return!!H&&(H.move(T,A),(B||wa(B))&&this.hooks.move.emit({from:T,to:A,docUid:M,type:H.type,trigger:this.uid,operation:"shift"}),!0)}},{key:"reorder",value:function(w){var T=w.indexes,D=w.docUid,M=w.emit,B=this.getDocNode(D,w.type);B&&(B.reorder(T),M||wa(M))&&this.hooks.move.emit({indexes:T,docUid:D,type:B.type,trigger:this.uid,operation:"shift"})}},{key:"getDocNode",value:function(w,T){switch(T){case"default":return this.defaultFile;case"file":return this.dir.getFileByUid(w);case"tag":return this.tag.getTagByUid(w);default:return w===this.defaultFile.uid?this.defaultFile:this.tag.getTagByUid(w)||this.dir.getFileByUid(w)||null}}}]),x}(Rhe),w$e={Successful:{errorCode:0,errorString:"Successful."},InvalidIndex:{errorCode:-1033,errorString:"Invalid index."},InvalidValue:{errorCode:-1034,errorString:"Invalid value."},NoImage:{errorCode:-1035,errorString:"There is no image."},UnBindViewer:{errorCode:-2210,errorString:"You cannot call this method on this WebTwain instance because it does not use the default viewer."},AlReadyBindViewer:{errorCode:-2211,errorString:"The element is already bound to the viewer."},ParameterCannotEmpty:{errorCode:-2314,errorString:"The parameter cannot be empty."},IndicesNotArray:{errorCode:-2358,errorString:"The type of the parameter indices must be an Array."},IndexOutOfRange:{errorCode:-2359,errorString:"The index is out of range."},InvalidTagName:{errorCode:-2394,errorString:"Invalid tag name."},InvalidLeftOrTopOrRightOrBottom:{errorCode:-2417,errorString:"The left or top or right or bottom you entered is invalid."},InvalidWidth:{errorCode:-2418,errorString:"The width you entered is invalid."},InvalidHeight:{errorCode:-2419,errorString:"The height you entered is invalid."},WidthOrHeightOutOfImageSize:{errorCode:-2420,errorString:"The width or height is out of image size."},MobileServer_InvalidIndex:{errorCode:-2423,errorString:"The index is invalid."},ImageEditorExist:{errorCode:-2500,errorString:"An ImageEditor already exists."},ThumbnailViewerExist:{errorCode:-2501,errorString:"A ThumbnailViewer already exists."},CustomElementExist:{errorCode:-2502,errorString:"A CustomElement already exists."},ImageEditorDispose:{errorCode:-2504,errorString:"The ImageEditor object has been disposed."},ThumbnailViewerNotExist:{errorCode:-2505,errorString:"This ThumbnailViewer doesn't exist."},ThumbnailViewerDispose:{errorCode:-2506,errorString:"The ThumbnailViewer object has been disposed."},CallbackNotAFunction:{errorCode:-2510,errorString:"The callback is not a function."},ElementRequired:{errorCode:-2511,errorString:"Parameter 'element' is required."},ElementNotExist:{errorCode:-2512,errorString:"Parameter 'element' doesn't instanceof HTMLDivElement."},InvalidPropertyValue:{errorCode:-2514,errorString:"Invalid property value."},CursorInvalidMode:{errorCode:-2519,errorString:"The current mode does not support setting the cursor to zoom."},OldTagNameRequired:{errorCode:-2517,errorString:"Old tag name is required."},NewTagNameRequired:{errorCode:-2518,errorString:"New tag name is required."},FileNameCannotEmpty:{errorCode:-2530,errorString:"Document name cannot be empty."},FileNameNotString:{errorCode:-2531,errorString:"Document name is not a string."},FileNotExist:{errorCode:-2540,errorString:"The document does not exist."},FileExist:{errorCode:-2541,errorString:"The document already exists."},CustomElementDispose:{errorCode:-2508,errorString:"The CustomElement object has been disposed."},CustomElementNotExist:{errorCode:-2507,errorString:"This CustomElement doesn't exist."},ParameterOutRange:{errorCode:80002,errorString:"The parameter is out of range."},TagNotExist:{errorCode:80009,errorString:"Tag does not exist."},TagExist:{errorCode:80010,errorString:"The tag already exists."},OperationError:{errorCode:80022,errorString:"The operation mode is wrong."}};(CP=Fhe||(Fhe={}))[CP.Normal=0]="Normal",CP[CP.Balance=1]="Balance";var S$e=function(){function y(C){Eo(this,y),tn(this,"space",void 0),tn(this,"webViewer",void 0),tn(this,"isActiveFile",!1),tn(this,"isActiveTag",!1),tn(this,"currentFileName",""),tn(this,"currentTagName",""),tn(this,"bufferConfig",null),tn(this,"currentSelected",[]),this.space=new x$e,C&&(this.bufferConfig=C)}return Do(y,[{key:"e",value:function(){this.setError("Successful")}},{key:"IsFileNameExist",value:function(C){var x=this.space.getFileList();if("dynamsoft-default-document"===C)return!0;if(x)for(var w=0;w<x.length;w++)if(x[w].name===C)return!0;return!1}},{key:"getCurrentDataSet",value:function(){if(this.webViewer){var C=this.webViewer.myViewer.getCurrentTab();if(void 0===C)return!1;var x=C.type;this.isActiveFile="file"===x,this.isActiveTag="tag"===x}if(this.isActiveFile){var w=this.getCurrentFileName(),T=this.space.getFile(w);if(T)return T}if(this.isActiveTag){var A=this.space.getTag(this.currentTagName);if(A)return A}return!1}},{key:"setError",value:function(C){var x;if("Default"!==C){if(this.webViewer)this.webViewer.setError(C);else if(this.bufferConfig&&this.bufferConfig.viewerError){var w=w$e[C];this.bufferConfig.viewerError.setError(w.errorCode,w.errorString)}}else null==this||null===(x=this.webViewer)||void 0===x||x.setDefaultError()}},{key:"emitViewerEvent",value:function(){var C,x;this.webViewer&&0===this.getHowManyImagesInBuffer()&&(null===(C=this.webViewer)||void 0===C||null===(x=C.myViewer)||void 0===x||x.emit("pageRendered",-1))}},{key:"bindViewer",value:function(C){this.webViewer=C}},{key:"getCurrentTag",value:function(){return this.currentTagName}},{key:"getCurrentDocument",value:function(){return this.currentFileName}},{key:"getCurrentFileName",value:function(){var C=this,x=this.space.getFileList(),w="";return x&&yi(x).call(x,function(T){T.name===C.currentFileName&&(w=C.currentFileName)}),w}},{key:"getCurrentIndex",value:function(){if(this.webViewer)return this.webViewer.getCurrentIndex();var C=this.getSelectedImagesIndices().length;if(C<=0){var x=this.getCurrentDataSet();return!!x&&x.children.length-1}return this.getSelectedImagesIndices()[C-1]}},{key:"getHowManyImagesInBuffer",value:function(){if(this.webViewer)return this.webViewer.getHowManyImagesInBuffer();var C=this.getCurrentDataSet();return C?C.children.length:0}},{key:"getSelectedImagesIndices",value:function(){return this.webViewer?this.webViewer.getSelectedImagesIndices():this.currentSelected}},{key:"getIndexByUid",value:function(C){if(!Uo(C)||!C)return this.setError("InvalidValue"),!1;if(this.webViewer)return this.webViewer.myViewer.getIndexByUid(C);var x=this.getCurrentDataSet(),w=x.children;return!!(x&&w&&Gp(w))&&No(w).call(w,C)}},{key:"getUidByIndex",value:function(C){if(C<0||C>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;if(this.webViewer)return this.webViewer.myViewer.getUidByIndex(C);var x=this.getCurrentDataSet().children;return!(x&&x.length<C)&&x[C]}},{key:"getDataByUid",value:function(C){return this.space.getSource(C)}},{key:"updateDataByUid",value:function(C,x){return this.space.store.set(C,x)}},{key:"setCustomDataByUid",value:function(C,x){return Uo(C)&&""!==C?this.space.setCustomData(C,x):(this.setError("InvalidValue"),!1)}},{key:"getCustomDataByUid",value:function(C){return this.space.getCustomData(C)}},{key:"setMetadataByUid",value:function(C,x){return Uo(C)&&""!==C?this.space.setMetadata(C,x):(this.setError("InvalidValue"),!1)}},{key:"getMetadataByUid",value:function(C){return this.space.getMetadata(C)}},{key:"addImage",value:function(C,x,w){var T,A,D={},M=this.currentFileName,B="";!wa(w)&&Uo(w)?(this.IsFileNameExist(w)||this.createDocument(w),B=w):wa(M)||""===M?(this.space.isFileExisted("dynamsoft-default-document")||this.createDocument("dynamsoft-default-document"),this.webViewer&&(this.webViewer.bEmitBufferChanged=!1),this.openDocument("dynamsoft-default-document"),this.webViewer&&(this.webViewer.bEmitBufferChanged=!0),B="dynamsoft-default-document"):B=M,x&&(delete(A=fC({},x)).oriBlobData,x.oriBlobData&&(T=x.oriBlobData));var H=C.imageUrl,Y=C.minImageUrl,G=C.imageId,q=C.serverId,re=C.uidFromServer,se=C.index;if(T&&(D=fC({},T)),G&&(D.imageId=G),q&&(D.serverId=q),re&&(D.uidFromServer=re),!wa(se)&&wm(se)){var ce=this.getDocumentContents(B).length;se>=ce&&(se=ce)}var ve=this.space.loadSource({data:[{oriData:H,minData:Y,metadata:A,customData:D}],filename:B,index:se},function(Ue){var je=nC(Ue,1)[0];C.uuid=je});if(this.isActiveTag){var Te=this.getHowManyImagesInBuffer();this.currentSelected=Te>0?[Te-1]:[]}else this.currentSelected=!wa(se)&&wm(se)?[se]:[];return ve}},{key:"insertImage",value:function(C,x,w){var T;return w&&w>=0?(T=this.space.loadSource({data:[C],filename:x,index:w}))[0]&&(this.currentSelected=[w]):(T=this.space.loadSource({data:[C],filename:x}),this.currentSelected=[]),T[0]}},{key:"updateImage",value:function(C,x){var w=C.imageUrl,T=C.minImageUrl,A=C.imageId,D=C.serverId,M=C.uidFromServer,B=C.uuid,H=fC({},x);return B&&""!==B&&-1!==B?(this.space.updateSource(B,{oriData:w,minData:T,metadata:H,customData:{imageId:A,serverId:D,uidFromServer:M}}),B):(this.setError("IndexOutOfRange"),!1)}},{key:"removeImageByUid",value:function(C){if(this.e(),this.webViewer){var x=this.webViewer.removePageByUid(C);return this.webViewer.resized(),this.emitViewerEvent(),x}return this.space.removeSource(C)}},{key:"removeImageByIndex",value:function(C){if(this.e(),C<0||C>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;var x=this.getCurrentIndex(),w=!1;if(this.webViewer)w=this.webViewer.removePageByIndexes(C),this.webViewer.resized(),this.emitViewerEvent();else{var T=this.getCurrentDataSet();if(!T)return!1;w=this.space.removeSource(T.children[C])}return w||this.setError("Default"),this.currentSelected=C===x&&0===C?this.getHowManyImagesInBuffer()>0?[0]:[]:C<=x?[x-1]:[x],w}},{key:"removeSelectedImages",value:function(C){this.e();var x=this.getSelectedImagesIndices();Gp(C)&&C.length>0&&(x=C);var w=!1;if(this.webViewer)w=this.webViewer.removePageByIndexes(x),this.webViewer.resized(),this.emitViewerEvent();else{var T=[],A=this.getCurrentDataSet();if(!A)return!1;yi(x).call(x,function(D){A.children[D]&&A.children[D]&&T.push(A.children[D])}),w=this.space.removeSource(T)}return w||this.setError("Default"),w}},{key:"removeImageByIndexArr",value:function(C){if(this.e(),!Gp(C))return!1;var x=this.getCurrentDataSet();if(!x)return!1;var w,T=[];return yi(C).call(C,function(A){var D=x.children[A];D&&T.push(D)}),(w=this.space.removeSource(T))||this.setError("Default"),this.webViewer&&(this.webViewer.resized(),this.emitViewerEvent()),this.currentSelected=[],w}},{key:"removeAllImages",value:function(){this.e();var C=!1;if(this.webViewer)C=this.webViewer.removeAllPages(),this.webViewer.resized(),this.emitViewerEvent();else{var x=this.getCurrentDataSet();x&&(C=this.space.removeSource(MS(x.children)))}return C||this.setError("Default"),this.currentSelected=[],C}},{key:"tagImages",value:function(C,x){this.e();var w=this.getHowManyImagesInBuffer();if(!Gp(C))return this.setError("IndicesNotArray"),!1;if(!Uo(x)||""===x)return this.setError("InvalidTagName"),!1;for(var T=0;T<w;T++){var A=C[T];if(iC(A)||A<0||A>=w)return this.setError("IndexOutOfRange"),!1}this.space.createTag(x);for(var D=0;D<C.length;D++){var M=C[D];if(M>=0){var B=this.getUidByIndex(M);B&&""!==B&&-1!==kp(B,10)&&this.space.addTagToSource(B,x)}}return!0}},{key:"removeImageTag",value:function(C,x){if(this.e(),!wm(C))return this.setError("InvalidValue"),!1;if(C<0||C>this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;var w=this.getUidByIndex(C),T=!1;return w&&""!==w&&-1!==w&&(T=this.space.removeTagFromSource(w,x)),T||this.setError("Default"),T}},{key:"getDefaultTag",value:function(){return this.space.getDefaultTag()}},{key:"setDefaultTag",value:function(C){return this.e(),Uo(C)?""===C?(this.space.setDefaultTag(null),!0):(this.space.createTag(C),(x=this.space.setDefaultTag(C))||this.setError("Default"),x):(this.setError("InvalidValue"),!1);var x}},{key:"removeTag",value:function(C,x){var w=this;if(this.e(),!Uo(C))return this.setError("InvalidValue"),!1;if(!wa(x)&&!Gp(x))return this.setError("IndicesNotArray"),!1;if(!this.space.isTagExisted(C))return this.setError("TagNotExist"),!1;var T=this.currentTagName,A=!1,D=!1;if(T&&(A=T===C),wa(x))D=this.space.removeTag(C),A&&this.clearFilter();else{var M=[];yi(x).call(x,function(H){var Y=w.getUidByIndex(H);-1!==Y&&M.push(Y)});for(var B=0;B<(null==M?void 0:M.length);B++)if(!(D=this.space.removeTagFromSource(M[B],C)))return!1}return D||this.webViewer.setDefaultError(),D}},{key:"renameTag",value:function(C,x){return this.e(),wa(C)||""===C?(this.setError("OldTagNameRequired"),!1):wa(x)||""===x?(this.setError("NewTagNameRequired"),!1):this.space.isTagExisted(C)?this.space.isTagExisted(x)?(this.setError("TagExist"),!1):(C===this.currentTagName&&(this.currentTagName=x),(w=this.space.renameTag(C,x))?this.space.setDefaultTag(x):this.setError("Default"),w):(this.setError("TagNotExist"),!1);var w}},{key:"getTagContents",value:function(C){return this.e(),C&&Uo(C)&&""!==C?this.space.getTag(C).children:[]}},{key:"getTagList",value:function(){var C=this;this.e();var x=this.space.getTagList(),w=[];return x?yi(x).call(x,function(T){var A,D=[];yi(A=T.children).call(A,function(M){var B=C.getCustomDataByUid(M);B&&D.push(B.uidFromServer)}),w.push({name:T.name,imageIds:D})}):w=[],w}},{key:"getTagListByIndex",value:function(C){if(!wm(C))return!1;var x=this.getUidByIndex(C);return this.space.getSourceTags(x)}},{key:"clearFilter",value:function(){this.e(),this.currentTagName="",this.space.setDefaultTag(null);var C,x=this.getCurrentFileName();return""===x&&(x="dynamsoft-default-document"),(C=this.openDocument(x))||this.setError("Default"),C}},{key:"filterImagesByTag",value:function(C,x,w){this.e();var T=!1;if(wa(C)||null===C||""===C){this.currentTagName="";var A=this.getCurrentFileName();""===A&&(A="dynamsoft-default-document"),(T=this.openDocument(A))?pC(x)&&x():(this.setError("Default"),pC(w)&&w())}else{var D,M;if(!this.space.isTagExisted(C))return this.setError("TagNotExist"),pC(w)&&w(),!1;if(this.isActiveTag=!0,this.isActiveFile=!1,this.currentTagName=C,this.setDefaultTag(C),T=this.space.openTag(C,null==this||null===(D=this.webViewer)||void 0===D||null===(M=D.myViewer)||void 0===M?void 0:M.uid)){var B=this.space.getTag(C);if(B){var H,Y=(null==B||null===(H=B.children)||void 0===H?void 0:H.length)||0;this.currentSelected=Y>0?[Y-1]:[]}pC(x)&&x()}else this.setError("Default"),pC(w)&&w()}return this.webViewer&&this.webViewer.render(),T}},{key:"createDocument",value:function(C){if(this.e(),!C||""===C){var x=wm(C)?"FileNameNotString":"FileNameCannotEmpty";return this.setError(x),!1}return Uo(C)?this.space.isFileExisted(C)?(this.setError("FileExist"),!1):!!this.space.createFile(C)||(this.setError("Default"),!1):(this.setError("FileNameNotString"),!1)}},{key:"openDocument",value:function(C,x){var w,T;if(this.e(),!C||""===C){var A=wm(C)?"FileNameNotString":"FileNameCannotEmpty";return this.setError(A),!1}if(!Uo(C))return this.setError("FileNameNotString"),!1;if(!this.space.isFileExisted(C))return this.setError("FileNotExist"),!1;var D=x&&""!==x?x:null==this||null===(w=this.webViewer)||void 0===w||null===(T=w.myViewer)||void 0===T?void 0:T.uid;if(!this.space.openFile(C,{viewerUid:D}))return this.setError("Default"),!1;this.currentFileName=C,this.isActiveFile=!0,this.isActiveTag=!1;var M=this.space.getFile(C);if(M){var B,H=null==M||null===(B=M.children)||void 0===B?void 0:B.length;this.currentSelected=H>0?[H-1]:[]}return!0}},{key:"getDocumentContents",value:function(C){return this.e(),C&&Uo(C)&&""!==C?this.space.getFile(C).children:[]}},{key:"renameDocument",value:function(C,x){return this.e(),Uo(C)&&Uo(x)?(C&&""!==C&&x&&""!==x||this.setError("FileNameCannotEmpty"),this.space.isFileExisted(C)?this.space.isFileExisted(x)?(this.setError("FileExist"),!1):this.space.renameFile(C,x)?(this.currentFileName===C&&(this.currentFileName=x),!0):(this.setError("Default"),!1):(this.setError("FileNotExist"),!1)):(this.setError("FileNameNotString"),!1)}},{key:"removeDocument",value:function(C){if(this.e(),!C||!Uo(C))return this.setError("FileNameNotString"),!1;if(!this.space.isFileExisted(C))return this.setError("FileNotExist"),!1;var x=this.space.removeFile(C);return x?(x&&this.webViewer&&this.webViewer.resized(),this.currentFileName===C&&(this.currentFileName=""),!0):(this.setError("Default"),!1)}},{key:"getDocumentInfoList",value:function(){var C=this;this.e();var x=this.space.getFileList(),w=[];return x?(yi(x).call(x,function(T){if(T.children){for(var A=[],D=0;D<T.children.length;D++){var B=C.getCustomDataByUid(T.children[D]);B&&A.push(B.uidFromServer)}w.push({imageIds:A,name:T.name})}}),w):[]}},{key:"getDocumentInfo",value:function(C){this.e();var x=this.space.getFile(C);if(!x)return{imageIds:[],length:0};for(var w=[],T=0;T<x.children.length;T++){var D=this.getCustomDataByUid(x.children[T]);D&&w.push(D.uidFromServer)}return{imageIds:w,length:w.length}}},{key:"selectImages",value:function(C){this.e();var x=!0;if(!C||!Gp(C))return!1;if(this.webViewer){var w=this.webViewer.getIfAutoScroll();!1===w&&this.webViewer.setIfAutoScroll(!0),x=this.webViewer.selectPages(C),!1===w&&this.webViewer.setIfAutoScroll(!1)}else{for(var T=this.getHowManyImagesInBuffer(),A=0;A<C.length;A++)if(!wm(C[A])||C[A]<0||C[A]>=T)return this.setError("ParameterOutRange"),!1;x=!0}return x?this.currentSelected=C:this.setError("Default"),x}},{key:"selectAllImages",value:function(){this.e();var C=!0;if(this.webViewer)C=this.webViewer.myViewer.selectAll(),this.currentSelected=this.webViewer.getSelectedImagesIndices();else{var x,w=this.getCurrentDataSet();this.currentSelected=fYe(sN(x=new Array(w.children.length)).call(x))}return C||this.setError("Default"),C}},{key:"moveImage",value:function(C,x){this.e();var w=kp(C,10),T=kp(x,10);if(iC(C)||iC(x))return this.setError("InvalidIndex"),!1;var A=this.getHowManyImagesInBuffer();if(w<0||w>=A||T<0||T>A)return this.setError("IndexOutOfRange"),!1;var D=!1;if(this.webViewer)D=this.webViewer.myViewer.movePage(C,x);else{var M=this.getCurrentDataSet();if(!M)return!1;D=this.space.move({docUid:M.uid,type:M.type,from:C,to:x})}return D||this.setError("Default"),this.currentSelected=[x],D}},{key:"switchImage",value:function(C,x){this.e();var w=kp(C,10),T=kp(x,10);if(iC(C)||iC(x))return this.setError("InvalidIndex"),!1;var A=this.getHowManyImagesInBuffer(),D=this.getCurrentIndex();if(w<0||w>=A||T<0||T>A)return this.setError("IndexOutOfRange"),!1;var M=!1;if(this.webViewer)M=this.webViewer.myViewer.switchPage(C,x);else{var B=this.getCurrentDataSet();if(!B)return!1;M=this.space.switch({docUid:B.uid,type:B.type,one:C,other:x})}M||this.setError("Default");var H=D;return w===D?H=T:T===D&&(H=w),this.currentSelected=[H],M}},{key:"moveImageToFile",value:function(C,x,w,T){if(!this.space.isFileExisted(C)||!this.space.isFileExisted(w))return this.setError("FileNotExist"),!1;x=MS(new c$e(x));var A=this.getDocumentInfo(C).length;if(!Gp(x)||x.length>A)return this.setError("ParameterOutRange"),!1;var D=this.getDocumentInfo(w).length,M=this.space.movePagesToFile(C,x,w,T);if(!this.webViewer&&this.isActiveFile){var B=this.getHowManyImagesInBuffer();C===this.currentFileName&&(this.currentSelected=B>0?[B-1]:[]),w===this.currentFileName&&(this.currentSelected=wm(T)&&T<D&&T>=0?[T+x.length-1]:B>0?[B-1]:[])}return M}}]),y}();HTMLCanvasElement.prototype.toBlob||Ehe(HTMLCanvasElement.prototype,"toBlob",{value:function(y,C,x){for(var w=atob(this.toDataURL(C,x).split(",")[1]),T=w.length,A=new Uint8Array(T),D=0;D<T;D++)A[D]=w.charCodeAt(D);y(new Blob([A],{type:C||"image/png"}))}});var hu,Zn,gC=g(function y(C){if(l(this,y),C)this._baseUrl=C._baseUrl,this._buffer=C._buffer,this._serverIdMap=C._serverIdMap,this._uidMap=C._uidMap;else{var x={viewerError:{setError:function(w,T){U.log(w,T),this._error={code:w,message:T}}}};this._baseUrl="",this._buffer=new S$e(x),this._serverIdMap={},this._uidMap={}}},[{key:"getError",value:function(){return this._error}},{key:"BaseUrl",get:function(){return this._baseUrl}},{key:"getImageUrl",value:function(y){var C=this.convertClientIndexToServerId(y),x=Date.now();return lr.getImageUrl(this._baseUrl,C,-1,-1,x)}},{key:"getMinImageUrl",value:function(y,C,x){var w=this.convertClientIndexToServerId(y),T=Date.now();return w&&C&&x?lr.getImageUrl(this._baseUrl,w,parseInt(C),parseInt(x),T):""}},{key:"append",value:function(y,C,x,w,T){var A,D,M,B,H=Date.now(),Y=C,G=x;if(A={imageId:Y,serverId:C,uidFromServer:G,imageUrl:M=lr.getImageUrl(this._baseUrl,Y,-1,-1,H),minImageUrl:D=w&&w.controlWidth&&w.controlWidth>0&&w.controlHeight&&w.controlHeight>0?Ce.navInfoSync.bMobile?lr.getImageUrl(this._baseUrl,Y,Math.round(w.controlWidth*devicePixelRatio),Math.round(w.controlHeight*devicePixelRatio),H):lr.getImageUrl(this._baseUrl,Y,parseInt(w.controlWidth),parseInt(w.controlHeight),H):M},B=w.currentFileName.length>0?this._buffer.addImage(A,w,w.currentFileName):this._buffer.addImage(A,w)){var q=HB(B,1)[0],re=this._buffer.getCustomDataByUid(q);return re.serverId=Y,re.uidFromServer=G,this._innerInsertModel(Y,G,q,M,D),q}return!1}},{key:"insertBefore",value:function(y,C,x,w,T){var A,D,M,B=Date.now(),H=x,Y=w;A={index:y,imageId:H,serverId:H,uidFromServer:Y,imageUrl:M=lr.getImageUrl(this._baseUrl,H,-1,-1,B),minImageUrl:D=T&&T.controlWidth&&T.controlWidth>0&&T.controlHeight&&T.controlHeight>0?Ce.navInfoSync.bMobile?lr.getImageUrl(this._baseUrl,H,Math.round(T.controlWidth*devicePixelRatio),Math.round(T.controlHeight*devicePixelRatio),B):lr.getImageUrl(this._baseUrl,H,parseInt(T.controlWidth),parseInt(T.controlHeight),B):M};var G=this._buffer.addImage(A);if(G){var q=HB(G,1)[0],re=this._buffer.getCustomDataByUid(q);return re.serverId=H,re.uidFromServer=Y,this._innerInsertModel(H,Y,q,M,D),this._buffer.openDocument(this.getCurrentFileName()),q}return!1}},{key:"_innerInsertModel",value:function(y,C,x,w,T){var A=new KA;A.serverId=y,A.uidFromServer=C,A.uuid=x,A.imageUrl=w,A.minImageUrl=T,this._serverIdMap[y]=A,this._uidMap[C]=A}},{key:"refresh",value:function(y,C,x,w){var T=1*y;if(x){var A=this.count();if(T<0||T>A)return!1;this._setDataImageControl(T,w)}return!0}},{key:"refreshByImageId",value:function(y,C,x){return C&&this._setDataImageControl(y,x,!0),!0}},{key:"_setDataImageControl",value:function(y,C,x){var w,T,A,D,M,B,H=this,Y=H._baseUrl;if(x)M=y;else if(M=(D=H.getCustomDataByIndex(y)).serverId,B=D.uidFromServer,M<=0)return!1;if((w=H.getImageIdMap(M))||((w=new KA).serverId=M,w.uidFromServer=B,H._serverIdMap[M]=w,H._uidMap[B]=w),Y){null!=w&&(w.ticks=Date.now()),T=lr.getImageUrl(Y,M,-1,-1,w.ticks),A=C&&C.controlWidth&&C.controlWidth>0&&C.controlHeight&&C.controlHeight>0?Ce.navInfoSync.bMobile?lr.getImageUrl(Y,M,Math.round(C.controlWidth*devicePixelRatio),Math.round(C.controlHeight*devicePixelRatio),w.ticks):lr.getImageUrl(Y,M,parseInt(C.controlWidth),parseInt(C.controlHeight),w.ticks):T,w.imageUrl=T,w.minImageUrl=A;var G=U.clone(w);G.imageId=M,H._buffer.updateImage(G,C)}return!0}},{key:"convertIndicesToServerIds",value:function(y){var C,x=y.length,w=[];for(C=0;C<x;C++){var T=this.convertClientIndexToServerId(y[C]);-1!=T&&w.push(T)}return w}},{key:"removeImagesByServerId",value:function(y,C){var x=this,w=null!=C?C:this._buffer.getCurrentDocument(),T=[];return U.each(y,function(A,D){var B,M=parseInt(A);return x._removeMapModelImageControlByServerId(M),B=x._buffer.isActiveFile?x._convertServerIdToIndexInFile(w,M):x._convertServerIdToIndex(M),!isNaN(B)&&!(B<0||B>=x.count())&&void T.push(B)}),T.length>0&&x._buffer.removeImageByIndexArr(T)}},{key:"removeByServerId",value:function(y,C,x){var A,w=this,T=null!=x?x:this._buffer.getCurrentDocument();return w._removeMapModelImageControlByServerId(y),A=this._buffer.isActiveFile?this._convertServerIdToIndexInFile(T,y):C,!isNaN(A)&&!(A<0||A>=w.count())&&w._buffer.removeImageByIndex(A)}},{key:"exists",value:function(y){if(this._serverIdMap[y])return!0;var C=-1;if(this._buffer.isActiveFile){var x=this.getCurrentFileName();C=this._convertServerIdToIndexInFile(x,y)}else C=this._convertServerIdToIndex(y);return C>-1}},{key:"removeImages",value:function(y){var C,x,w;for(w=y.length,C=0;C<w;C++)x=this.convertClientIndexToServerId(y[C]),this._removeMapModelImageControlByServerId(x);return this._buffer.removeSelectedImages(y)}},{key:"clear",value:function(){var y,C,x,w=this;for(x=w.count(),y=0;y<x;y++)C=w.convertClientIndexToServerId(y),this._removeMapModelImageControlByServerId(C);return x==Object.keys(w._serverIdMap).length&&(w._serverIdMap={},w._uidMap={}),w._buffer.removeAllImages()}},{key:"_uidFromServer2index",value:function(y){var C,x,w,T=this;if((w=T._uidMap[y])&&(x=w.uuid),x&&-1!=x)C=T._buffer.getIndexByUid(x);else if(T._buffer.isActiveFile){var A=this.getCurrentFileName();C=this._convertUidFromServerToIndexInFile(A,y)}else C=this._convertUidFromServerToIndex(y);return U.isNumber(C)||(C=-1),C}},{key:"_serverId2uidFromServer",value:function(y){if(y&&y>0){var C,x,w;if((w=this._serverIdMap[y])&&(x=w.uidFromServer))return x;if((C=this.convertServerIdToClientIndex(y))>=0)return this._index2uidFromServer(C)}return-1}},{key:"_uidFromServer2ServerId",value:function(y){if(y){var C,x,w;if((w=this._uidMap[y])&&(x=w.serverId))return x;if((C=this._uidFromServer2index(y))>=0)return this.convertClientIndexToServerId(C)}return-1}},{key:"_index2uidFromServer",value:function(y){var C=this.getCustomDataByIndex(y);return C?C.uidFromServer:-1}},{key:"convertServerIdToClientIndex",value:function(y){var C,x,w,T=this;if((w=T._serverIdMap[y])&&(x=w.uuid),x&&-1!=x)C=T._buffer.getIndexByUid(x);else if(T._buffer.isActiveFile){var A=this.getCurrentFileName();C=this._convertServerIdToIndexInFile(A,y)}else C=this._convertServerIdToIndex(y);return U.isNumber(C)||(C=-1),C}},{key:"getIndexByUid",value:function(y){var C;return!1===(C=this._buffer.getIndexByUid(y))?-1:C}},{key:"getUidByIndex",value:function(y){return this._buffer.getUidByIndex(y)}},{key:"convertClientIndexToServerId",value:function(y){var C=this.getCustomDataByIndex(y);return C?C.serverId:-1}},{key:"getCurrentImageIndex",value:function(){return this._buffer.getCurrentIndex()}},{key:"setCurrentImageIndex",value:function(y){return this._buffer.selectImages([y])}},{key:"getCurrentFileName",value:function(){return this._buffer.getCurrentFileName()}},{key:"setDefaultTag",value:function(y){return this._buffer.setDefaultTag(y)}},{key:"getDefaultTag",value:function(){return this._buffer.getDefaultTag()}},{key:"count",value:function(){return this._buffer.getHowManyImagesInBuffer()}},{key:"getCountByDocumentName",value:function(y){return this._buffer.getDocumentInfo(y).length}},{key:"dispose",value:function(){this.clear()}},{key:"getImageData",value:function(y){var C=this._buffer.getUidByIndex(y);return C?this._buffer.getDataByUid(C):ge.Promise.resolve(null)}},{key:"getCustomDataByIndex",value:function(y){return this._buffer.getCustomDataByUid(this._buffer.getUidByIndex(y))}},{key:"getMetadataByIndex",value:function(y){return this._buffer.getMetadataByUid(this._buffer.getUidByIndex(y))}},{key:"setCustomData",value:function(y,C){var x=this._buffer.getUidByIndex(y);return!(!x||!C)&&this._buffer.setCustomDataByUid(x,C)}},{key:"openDocument",value:function(y){return this._buffer.openDocument(y)}},{key:"createDocument",value:function(y){return this._buffer.createDocument(y)}},{key:"getImageIdMap",value:function(y){return this._serverIdMap[y]}},{key:"_removeMapModelImageControlByServerId",value:function(y){var C=this;if(y>0&&C._serverIdMap[y]){var x=C._serverIdMap[y],w=x.uidFromServer;x.Clear(),delete C._serverIdMap[y],delete C._uidMap[w]}}},{key:"_convertServerIdToIndexInFile",value:function(y,C){var x,w,T=-1;for(x=this._buffer.getDocumentContents(y),w=0;w<x.length;w++){var A=x[w];if(A){var D=this._buffer.getCustomDataByUid(A);if(D&&D.serverId==C){T=w;break}}}return T}},{key:"_convertServerIdToIndex",value:function(y){var C,x=-1;for(C=0;C<this.count();C++){var w=this._buffer.getUidByIndex(C);if(w){var T=this._buffer.getCustomDataByUid(w);if(T&&T.serverId==y){x=C;break}}}return x}},{key:"_convertUidFromServerToIndexInFile",value:function(y,C){var x,w,T=-1;for(x=this._buffer.getDocumentContents(y),w=0;w<x.length;w++){var A=x[w];if(A){var D=this._buffer.getCustomDataByUid(A);if(D&&D.uidFromServer==C){T=w;break}}}return T}},{key:"_convertUidFromServerToIndex",value:function(y){var C,x=-1;for(C=0;C<this.count();C++){var w=this._buffer.getUidByIndex(C);if(w){var T=this._buffer.getCustomDataByUid(w);if(T&&T.uidFromServer==y){x=C;break}}}return x}},{key:"convertUUIDToServerId",value:function(y){var C=this._buffer.getCustomDataByUid(y);return C&&-1!=C.serverId?C.serverId:-1}},{key:"UpdateImage",value:function(y,C){return this._buffer.updateImage(y,C),!0}}],[{key:"_setBaseUrl",value:function(y,C){y._baseUrl=C}},{key:"_getBuffer",value:function(y){return y._buffer}}]),T$e=function(y){function C(T){var A,D,M,B;l(this,C),D=this,B=[T],M=qn(M=C),(A=$a(D,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Y){return!1}}()?Reflect.construct(M,B||[],qn(D).constructor):M.apply(D,B))).__IfAppendImage=Lt,A.__maxImagesInBuffer=32767,A.__insertingIndex=-1,A._aryBitmapCache=[],A._imageBufferWrapper=new gC;var H=Yl.getServerImageUrlPrefix(A);return gC._setBaseUrl(A._imageBufferWrapper,H),A}return qa(C,y),g(C,[{key:"_registerMultiEvent",value:function(T,A){var D=this;if(D._resetErr(),!D._isValid())return!1;var M=["_$",T].join("");D[M]||(D[M]={});var B=D[M],H=U.guid();return B[H]=A,H}},{key:"_unregisterMultiEvent",value:function(T,A){var D=this;if(D._resetErr(),!D._isValid())return!1;var M=["_$",T].join(""),B=D[M];if(A){var H;if(U.isString(A))return delete B[A],Lt;if(U.isFunction(A))for(H=0;H<B.length;H++)if(A==B[H])return B.splice(H,1),Lt}return D[M]=null,Lt}},{key:"_getMetadata",value:function(T){return this._imageBufferWrapper.getMetadataByIndex(T)}},{key:"_updateImage",value:function(T,A,D){var M,B,H,Y,G=C0.Auto,q=this;return D&&(null!=D.width&&(H=parseInt(D.width)),null!=D.height&&(Y=parseInt(D.height)),G=U.isNumber(H)&&U.isNumber(Y)&&A.byteLength===H*Y*4?C0.RGBA:C0.Auto),M={imageId:T,serverId:T,bufferLen:A.byteLength,imageType:G},D&&G==C0.RGBA&&(M.width=H,M.height=Y,null!=D.bitDepth&&(M.bit=D.bitDepth),null!=D.resolutionX&&(M.xres=parseInt(D.resolutionX)),null!=D.resolutionY&&(M.yres=parseInt(D.resolutionY)),null!=D.uid&&(M.uidFromServer=D.uid)),B=U.stringify([U.stringify(M)]),new ge.Promise(function(re,se){q._innerSendBlobByWS("UpdateImage",B,A,function(ce){U.log("UpdateImage success."),re(ce)},function(ce){U.log("UpdateImage failed."),U.error(ce),se({code:q._errorCode,message:q._errorString})})})}},{key:"_removeImages",value:function(T){return this._imageBufferWrapper.removeImages(T)}},{key:"_getCurrentDocumentName",value:function(){var T="";return this._imageBufferWrapper&&(T=this._imageBufferWrapper.getCurrentFileName()),T}},{key:"_getCurrentDefaultTagName",value:function(){var T="";return this._imageBufferWrapper&&(T=this._imageBufferWrapper.getDefaultTag()||""),T}},{key:"_innerRefreshUI",value:function(T,A,D,M,B){var H=this;return D&&H._imageBufferWrapper.refresh(T,H._imageBufferWrapper.count(),!0,M),U.isFunction(H.__OnRefreshUI)&&H.__OnRefreshUI(H._imageBufferWrapper.getCurrentImageIndex(),H._imageBufferWrapper.count()),!0}},{key:"_innerRefreshUIByImageId",value:function(T,A,D,M){var B=this;return A&&B._imageBufferWrapper.refreshByImageId(T,!0,D),U.isFunction(B.__OnRefreshUI)&&B.__OnRefreshUI(B._imageBufferWrapper.getCurrentImageIndex(),B._imageBufferWrapper.count()),!0}},{key:"_getHowManyImagesInBuffer",value:function(){return this._isValid()?this._imageBufferWrapper.count():0}},{key:"_OnBitmapChanged",value:function(T,A,D){var M,B,H,Y=this,G="m1"==T[0],re="c2"==T[0],se="c1"==T[0]||re||G,ce=T[1].split(","),ve=T[2],Te=T[3],Ue=Y.__maxImagesInBuffer,je=-1,Ee=!1,Oe=[];if(D&&(M=D.document,B=D.tag,D.bNeedClearTag&&(H=D.bNeedClearTag)),U.log("_OnBitmapChanged.currentFileName="+M+", tag="+B),M?M!=Y._getCurrentDocumentName()&&(Ee=!0):M=Y._getCurrentDocumentName(),Y._imageBufferWrapper&&(B?(Y._imageBufferWrapper.setDefaultTag(B),U.log("metaDataObj.currentTag="+B)):H&&(Y._imageBufferWrapper.setDefaultTag(""),U.log("metaDataObj.currentTag=''"))),!G)if(re)T.length>5&&(Oe=T[5]),U.isArray(Oe)||(Oe=[]);else{var He={};if(T.length>5&&(He.width=T[5]),T.length>6&&(He.height=T[6]),T.length>7&&(He.bitDepth=T[7]),T.length>8&&(He.resolutionX=T[8]),T.length>9&&(He.resolutionY=T[9]),T.length>10&&(je=T[10]),T.length>11&&U.isString(T[11])&&(He.uidFromServer=T[11]),Oe.push(He),je>-1&&Y._canConsume()&&(ve==rs.enumBCAppend||ve==rs.enumBCInsert)){var we=Ce.DWT.lgct(je);U.isFunction(Y.__OnLtsverify)&&Y.__OnLtsverify(we,1)}}if(U.log("OnBitmapChanged:"+T),ve==rs.enumBCInsert||ve==rs.enumBCAppend&&!Y.__IfAppendImage)U.each(ce,function(ze,Be){var $e,Ge,_t=parseInt(ze),Ct=Y._imageBufferWrapper.getCurrentImageIndex();if(Be<Oe.length&&Oe[Be]?($e=(Ge=Oe[Be]).uidFromServer,delete Ge.uidFromServer):Ge={},Ge.currentFileName=M,isNaN(_t)||_t<0)return!0;if(se)Y._aryBitmapCache.push(_t);else for(var Ut=0;Ut<Y._aryBitmapCache.length;Ut++)if(Y._aryBitmapCache[Ut]==_t)return Y._aryBitmapCache.splice(Ut,1),!0;if(Y._imageBufferWrapper.exists(_t))return!0;Y.__insertingIndex>-1&&(Ct=Y.__insertingIndex),Ge.controlWidth=400,Ge.controlHeight=400,Y._controlWidth&&Y._controlWidth>400&&(Ge.controlWidth=Y._controlWidth),Y._controlHeight&&Y._controlHeight>400&&(Ge.controlHeight=Y._controlHeight),-1==Ct&&(Ct=0),Y._imageBufferWrapper.insertBefore(Ct,Ue,_t,$e,Ge),Y.__insertingIndex>-1&&(Y.__insertingIndex=Y.__insertingIndex+1)}),U.isFunction(Y.__OnRefreshUI)&&Y.__OnRefreshUI(Y._imageBufferWrapper.getCurrentImageIndex(),Y._imageBufferWrapper.count());else if(ve==rs.enumBCAppend&&Y.__IfAppendImage)U.each(ce,function(ze,Be){var $e,Ge,_t=parseInt(ze);if(isNaN(_t)||_t<0)return!0;if(Be<Oe.length&&Oe[Be]?($e=(Ge=Oe[Be]).uidFromServer,delete Ge.uidFromServer):Ge={},Ge.currentFileName=M,U.log("metaDataObj.currentFileName="+M),se)Y._aryBitmapCache.push(_t);else for(var Ct=0;Ct<Y._aryBitmapCache.length;Ct++)if(Y._aryBitmapCache[Ct]==_t)return Y._aryBitmapCache.splice(Ct,1),!0;if(Y._imageBufferWrapper.exists(_t))return!0;Ge.controlWidth=400,Ge.controlHeight=400,Y._controlWidth&&Y._controlWidth>400&&(Ge.controlWidth=Y._controlWidth),Y._controlHeight&&Y._controlHeight>400&&(Ge.controlHeight=Y._controlHeight),Ee?Y._imageBufferWrapper.append(Ue,_t,$e,Ge,M):Y._imageBufferWrapper.append(Ue,_t,$e,Ge)}),U.isFunction(Y.__OnRefreshUI)&&Y.__OnRefreshUI(Y._imageBufferWrapper.getCurrentImageIndex(),Y._imageBufferWrapper.count());else if(ve==rs.enumBCRemove&&se){var ue=!1;if(1==ce.length&&-1==ce[0]&&(ue=!0),ue)Y._imageBufferWrapper.clear();else{var pe=[];U.each(ce,function(ze,Be){var $e=parseInt(ze);if(isNaN($e)||$e<0)return!0;pe.push($e)}),Y._imageBufferWrapper.removeImagesByServerId(pe,M)}U.isFunction(Y.__OnRefreshUI)&&Y.__OnRefreshUI(Y._imageBufferWrapper.getCurrentImageIndex(),Y._imageBufferWrapper.count())}else if(ve==rs.enumBCEdit||ve==rs.enumBCUpdate)U.each(ce,function(ze,Be){var $e,Ge=parseInt(ze);if(isNaN(Ge)||Ge<0)return!0;if(Be<Oe.length&&Oe[Be]?delete($e=Oe[Be]).uidFromServer:$e={},$e.currentFileName=M,Ge>=0&&!Y.__bLoadingImage){var _t=Y._imageBufferWrapper.convertServerIdToClientIndex(Ge);_t>-1?Y._innerRefreshUI(_t,Y._imageBufferWrapper.count(),!0,$e,ve):D.bNeedRefresh&&Y._innerRefreshUIByImageId(Ge,!0,$e,ve)}});else if(ve==rs.enumBCIndexChange){var ye;Te>=0&&!Y.__bLoadingImage&&((ye=0<Oe.length&&Oe[0]?Oe[0]:{}).currentFileName=M,0==Y.__IfAppendImage&&Y._innerRefreshUI(Te,Y._imageBufferWrapper.count(),!0,ye,ve),Y._imageBufferWrapper.refresh(Te,Y._imageBufferWrapper.count(),!1,ye))}if(U.isFunction(Y.__OnBitmapChanged)){if(!G)if(se){if(ve!=rs.enumBCRemove&&!de.bFirefox&&se)return!0}else if(ve==rs.enumBCRemove||de.bFirefox&&!se)return!0;var me=[];U.each(ce,function(ze){var Be,$e=parseInt(ze);if(isNaN($e)||$e<0)return!0;(Be=Y._imageBufferWrapper.convertServerIdToClientIndex($e))>-1&&me.push(Be)});var Se=Y._imageBufferWrapper.getCurrentImageIndex(),We=ve;ve==rs.enumBCAppend&&(We=Y.__IfAppendImage?rs.enumBCAppend:rs.enumBCInsert),Y.__OnBitmapChanged(me,We,Se,Y._imageBufferWrapper.count())}}},{key:"_removeImageAsync",value:(w=yt(W.mark(function T(A,D){var M,B,H;return W.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(M=this,B=parseInt(D),ta(M,B)){Y.next=4;break}return Y.abrupt("return",!1);case 4:return H=M._imageBufferWrapper.convertClientIndexToServerId(B),Y.next=7,M._removeImageByIdAsync(H);case 7:return Y.abrupt("return",Y.sent);case 8:case"end":return Y.stop()}},T,this)})),function(T,A){return w.apply(this,arguments)})},{key:"_removeImageByIdAsync",value:(x=yt(W.mark(function T(A){var D,M;return W.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(D=this,-1!=A){B.next=4;break}return kt(D),B.abrupt("return",!1);case 4:return B.next=6,D._innerFunV2("RemoveImage",It(A));case 6:return((M=B.sent)||-1033==D._errorCode)&&D._OnBitmapChanged(["c1",""+A,3,D._imageBufferWrapper.getCurrentImageIndex(),D._imageBufferWrapper.count()]),B.abrupt("return",M);case 9:case"end":return B.stop()}},T,this)})),function(T){return x.apply(this,arguments)})}]);var x,w}(Yl);(function(y){y.Text=0,y.Blob=1,y.ArrayBuffer=2,y.XML=3,y.JSON=4,y.UserDefined=5})(hu||(hu={})),function(y){y.Other=0,y.HTTPUpload=1,y.HTTPDownload=2,y.FTPUpload=3,y.FTPDownload=4,y.Scan=5,y.LoadImage=6,y.ConvertToBlob=7,y.HTTPPut=8}(Zn||(Zn={}));var fu={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function I$e(y,C){if(U.isFunction("_".repeat))return y.repeat(C);for(var x=0,w=[];x<C;x++)w.push(y);return w.join("")}var Nhe,G9=Object.create?Object.create(null):{};function z9(y,C,x,w){return function(T,A){var D,M,B,H,Y,G,q,re,se,ce=1,ve=T.length,Te="";for(M=0;M<ve;M++)if("string"==typeof T[M])Te+=T[M];else if("object"===p(T[M])){if((H=T[M]).keys)for(D=A[ce],B=0;B<H.keys.length;B++){if(null==D)throw new Error(z9('[sprintf] Cannot access property "%s" of undefined value "%s"',H.keys[B],H.keys[B-1]));D=D[H.keys[B]]}else D=H.param_no?A[H.param_no]:A[ce++];if(fu.not_type.test(H.type)&&fu.not_primitive.test(H.type)&&D instanceof Function&&(D=D()),fu.numeric_arg.test(H.type)&&"number"!=typeof D&&isNaN(D))throw new TypeError(z9("[sprintf] expecting number but found %T",D));switch(fu.number.test(H.type)&&(re=D>=0),H.type){case"b":D=parseInt(D,10).toString(2);break;case"c":D=String.fromCharCode(parseInt(D,10));break;case"d":case"i":D=parseInt(D,10);break;case"j":D=U.stringify(D,null,H.width?parseInt(H.width):0);break;case"e":D=H.precision?parseFloat(D).toExponential(H.precision):parseFloat(D).toExponential();break;case"f":D=H.precision?parseFloat(D).toFixed(H.precision):parseFloat(D);break;case"g":D=H.precision?String(Number(D.toPrecision(H.precision))):parseFloat(D);break;case"o":D=(parseInt(D,10)>>>0).toString(8);break;case"s":D=String(D),D=H.precision?D.substring(0,H.precision):D;break;case"t":D=String(!!D),D=H.precision?D.substring(0,H.precision):D;break;case"T":D=Object.prototype.toString.call(D).slice(8,-1).toLowerCase(),D=H.precision?D.substring(0,H.precision):D;break;case"u":D=parseInt(D,10)>>>0;break;case"v":D=D.valueOf(),D=H.precision?D.substring(0,H.precision):D;break;case"x":D=(parseInt(D,10)>>>0).toString(16);break;case"X":D=(parseInt(D,10)>>>0).toString(16).toUpperCase()}fu.json.test(H.type)?Te+=D:(!fu.number.test(H.type)||re&&!H.sign?se="":(se=re?"+":"-",D=D.toString().replace(fu.sign,"")),G=H.pad_char?"0"===H.pad_char?"0":H.pad_char.charAt(1):" ",q=H.width-(se+D).length,Y=H.width&&q>0?I$e(G,q):"",Te+=H.align?se+D+Y:"0"===G?se+Y+D:Y+se+D)}return Te}(function(T){if(G9[T])return G9[T];for(var A,D=T,M=[],B=0;D;){if(null!==(A=fu.text.exec(D)))M.push(A[0]);else if(null!==(A=fu.modulo.exec(D)))M.push("%");else{if(null===(A=fu.placeholder.exec(D)))throw new SyntaxError("[sprintf] unexpected placeholder");if(A[2]){B|=1;var H=[],Y=A[2],G=[];if(null===(G=fu.key.exec(Y)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(H.push(G[1]);""!==(Y=Y.substring(G[0].length));)if(null!==(G=fu.key_access.exec(Y)))H.push(G[1]);else{if(null===(G=fu.index_access.exec(Y)))throw new SyntaxError("[sprintf] failed to parse named argument key");H.push(G[1])}A[2]=H}else B|=2;if(3===B)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");M.push({placeholder:A[0],param_no:A[1],keys:A[2],sign:A[3],pad_char:A[4],align:A[5],width:A[6],precision:A[7],type:A[8]})}D=D.substring(A[0].length)}return G9[T]=M,M}(y),arguments)}function Cc(y,C){if(U.isString(y)){var x,w,T,A,D,M=y.indexOf("<%");if(-1==M||(w=y.substring(0,M),!(M+2<(x=y.indexOf(">",w)))))return y;T=y.substring(M+1,x),A=y.substring(x+1);try{D=z9(T,C)}catch(B){D=""}return[w,D,A].join("")}return""}function bP(y,C){var x,w=y.substring(y.lastIndexOf(".")).toLowerCase();if(C==Ce.DWT.EnumDWT_ImageType.IT_BMP){if(".bmp"==w||".dib"==w)return y;x=[y,".bmp"].join("")}else if(C==Ce.DWT.EnumDWT_ImageType.IT_JPG){if(".jpg"==w||".jpe"==w||".jpeg"==w||".jfif"==w)return y;x=[y,".jpg"].join("")}else if(C==Ce.DWT.EnumDWT_ImageType.IT_PNG){if(".png"==w)return y;x=[y,".png"].join("")}else if(C==Ce.DWT.EnumDWT_ImageType.IT_TIF){if(".tif"==w||".tiff"==w)return y;x=[y,".tif"].join("")}else if(C==Ce.DWT.EnumDWT_ImageType.IT_PDF){if(".pdf"==w)return y;x=[y,".pdf"].join("")}else if(C==Ce.DWT.EnumDWT_ImageType.IT_J2K){if(".jp2"==w)return y;x=[y,".jp2"].join("")}return x}function Bhe(y,C,x,w){var T,A,D,M,B=C.url,H=C.headers,Y=C.retry,G=C.httpFormData,q=C.bOnlyResponseEmptyIsOK,re=C.bAsync,se=(A=C.responseType)==hu.Text?"text":A==hu.JSON?"json":A==hu.Blob?"blob":A==hu.ArrayBuffer?"arraybuffer":A==hu.XML?"xml":5==A?"user-defined":"text",ce=y.IfShowProgressBar,ve=y.IfShowCancelDialogWhenImageTransfer,Te=y.objUploadStatus;(T=C.content)&&(T.remoteFilename||(T.remoteFilename=C.remoteFilename),T.fileName||(T.fileName=C.fileName||T.name),T.name||(T.name=C.fileName||T.fileName));var Ue,je=new mm({action:B,data:G,async:re,retry:Y,bOnlyResponseEmptyIsOK:q,dataType:se});if(ve&&ge.progressContext&&(Ue=ge.progressContext.on("cancel",function(){je.abort(),je=null})),(D=je._uploadType)&&(M=D.get("ajaxConfig"),H&&M&&M.headers&&H&&U.mix(M.headers,H),y.HTTPRequestswithCredentials&&U.mix(M.xhrFields,{withCredentials:!0}),M=null),je.on(mm.event.SUCCESS,function(we){C.content=null,je=null,Ue&&ge.progressContext.off("cancel",Ue),y.HTTPPostResponse=we?we.response:C.responseType==hu.ArrayBuffer?[]:C.responseType==hu.Blob?new Blob([]):C.responseType==hu.JSON?{}:"",U.isFunction(y.onHttpUploadStatus)&&y.onHttpUploadStatus({fileName:we.name,percentage:100,statusCode:200,responseString:y.HTTPPostResponse}),U.isFunction(x)&&x(y.HTTPPostResponse)}),je.on(mm.event.ERROR,function(we){C.content=null,je=null;var ue=we&&we.canceled,pe="",ye=0;Ue&&ge.progressContext.off("cancel",Ue),y.HTTPPostResponse=we&&U.isString(we.response)?we.response:"",ue||(we&&we.msg&&(pe=we.msg),we&&we.httpStatus&&(ye=we.httpStatus));var Se={};L7(Se,ue,pe,ye),U.isFunction(y.onHttpUploadStatus)&&y.onHttpUploadStatus({fileName:we.name,percentage:100,statusCode:ye,responseString:y.HTTPPostResponse}),U.isFunction(w)&&w(Se._errorCode,Se._errorString,y.HTTPPostResponse)}),(ce||U.isFunction(y.onHttpUploadStatus))&&(je.on(mm.event.PROGRESS,function(we){!de.bSafari&&we&&(delete we.totalSize,delete we.position);var ue=0===we.total?100:Math.round(100*we.loaded/we.total);[we.loaded," / ",we.total].join(""),U.isFunction(y.onHttpUploadStatus)&&y.onHttpUploadStatus({fileName:we.name,percentage:ue,statusCode:0,responseString:""}),y.onPercent([0,ue,"","http",we.name])}),y.onPercent([0,-1,Lr.Uploading,"http"]),U.isFunction(y.onHttpUploadStatus))){var Ee="";U.isArray(T)&&T.length>0||(T&&T.name&&""!=T.name?Ee=T.name:T&&T.fileName&&(Ee=T.fileName)),!Ee&&C.fileName&&(Ee=C.fileName),y.onHttpUploadStatus({fileName:Ee,percentage:0,statusCode:0,responseString:""})}if(Te&&Te.bCancel){Te.st=2;var Oe={};return lu(Oe),C.content=null,U.isFunction(w)&&w(Oe._errorCode,Oe._errorString),!1}var He=je.upload(T);return T=null,He}function Whe(y,C,x,w){var T,A,D=y.MaxUploadImageSize,M=0,B=C.content;if(!B||!U.isArray(B)||B.length<=0){C.content=null;var H={};return ns(H),U.isFunction(w)&&w(H._errorCode,H._errorString),vt}for(T=0;T<B.length;T++){var Y=B[T];if(!Y||Y.size<=0){var G={};return ns(G),U.isFunction(w)&&w(G._errorCode,G._errorString),vt}var q=Y.size,re=Y.type;if(M+=q,""===re||re&&re!=C.contentType){var ce=Y.name,ve=(Y.slice||Y.webkitSlice||Y.mozSlice).call(Y,0,q,C.contentType);U.isString(ce)&&""!=ce||(ce=Y.fileName),ve.name=Cc(ce,T+1),B[T]=ve}B[T].remoteFilename=Cc(C.remoteFilename,T+1),Y=null}if(M>D&&-1!=D){var Te={};return ff(Te),U.isFunction(w)&&w(Te._errorCode,Te._errorString),vt}for(ge.cancelFrom=Zn.HTTPUpload,A=Bhe(y,C,x,w),C=null,T=0;T<B.length;T++)B[T]=null;return B=null,A}function zp(y){ge.dlgRef<=0||0==ge.dialogShowStatus||Mp(y)}(function(y){y.Init=-1,y.OK=0,y.Failed=1,y.Cancelled=2})(Nhe||(Nhe={})),ge.setBtnCancelVisibleForProgress=Mp;var bf,xf=g(function y(){l(this,y)},[{key:"_onProgress",value:function(y,C,x){var w=0===x.total?100:Math.round(100*x.loaded/x.total);[x.loaded," / ",x.total].join(""),y.onPercent([0,w,"","http",C])}},{key:"_uploadBlobFragment",value:function(y,C,x,w){var M,B,H,T=C.fileName,A=C.blockSize,D=0,Y=C.offset,G=this,q=function(Ue,je){C.content=null,U.isFunction(w)&&w(Ue,je)};if((M=C.content).size<=0){var re={};return ns(re),q(re._errorCode,re._errorString),vt}if((B=(D=M.size)-Y)>0){var se;if(B>=A&&A>0?(B-=A,H=A):(H=B,B=0),!(se=0==Y&&H==D?M:M.slice(Y,Y+H))){var ce={};ns(ce),q(ce._errorCode,ce._errorString)}if(!y.IfShowProgressBar||y.IfShowProgressBar&&ge.dlgRef>0){se.name=T,zp(y.IfShowCancelDialogWhenImageTransfer),C.headers["Content-Range"]=["bytes ",Y,"-",Y+se.size-1,"/",D].join(""),G._onProgress(y,T,{total:D,loaded:Y});var ve=U.clone(C);return ve.content=se,ve.offset=0,G.httpPostUpload(y,ve,function(Ue){0==B&&(ge.needShowTwiceShowDialog=!1),G._onProgress(y,T,{total:D,loaded:Y+H}),0==B?(C.content=null,U.isFunction(x)&&bs(x,Ue)):(C.offset=C.offset+H,setTimeout(function(){G._uploadBlobFragment(y,C,x,q)},100))},q),!0}var Te={};return lu(Te),q(Te._errorCode,Te._errorString),!1}return ge.needShowTwiceShowDialog=!1,C.content=null,U.isFunction(x)&&x(""),!0}},{key:"httpPostUploadFragment",value:function(y,C,x,w){var T;if(!(T=C.content)){var A={};return ns(A),U.isFunction(w)&&w(A._errorCode,A._errorString),vt}if(U.isString(T)){if(""==T){var D={};return ns(D),U.isFunction(w)&&w(D._errorCode,D._errorString),vt}var M=new Blob([T],{type:"text/plain"});M.name=C.fileName,C.content=M,M=null}return ge.cancelFrom=Zn.HTTPUpload,this._uploadBlobFragment(y,C,x,w)}},{key:"httpPostUpload",value:function(y,C,x,w){var T,A,D=C.bAsync,M=function(Oe,He){var we;return C.content=null,C=null,U.isFunction(w)&&w(Oe,He,null!==(we=null==y?void 0:y.HTTPPostResponse)&&void 0!==we?we:""),!1};if(!(T=C.content)){var B={};return ns(B),M(B._errorCode,B._errorString),!!D&&void 0}if(U.isString(T)){var H,Y=C.fileName;if(""==T){var G={};return ns(G),M(G._errorCode,G._errorString),!!D&&void 0}if(T.length>(H=y.MaxUploadImageSize)&&-1!=H){var q={};return ff(q),M(q._errorCode,q._errorString),!!D&&void 0}(A=new Blob([T],{type:"text/plain"})).name=Y,T=null}else if(T instanceof Blob&&(A=T,T=null,A.size<=0)){var re={};return ns(re),M(re._errorCode,re._errorString),!!D&&void 0}if(A){var se,ve=y.MaxUploadImageSize,Te=A.size,Ue=A.type;if(Te>ve&&-1!=ve){var je={};return ff(je),M(je._errorCode,je._errorString),!!D&&void 0}""===Ue||Ue&&Ue!=C.contentType?se.name=(se=(A.slice||A.webkitSlice||A.mozSlice).call(A,0,Te,C.contentType))instanceof File?se.fileName:A.name||A.fileName:se=A,A=null,se&&(C.content=se),se=null}zp(y.IfShowCancelDialogWhenImageTransfer),ge.cancelFrom=Zn.HTTPUpload;var Ee=Bhe(y,C,function(Oe){return C.content=null,C=null,U.isFunction(x)&&x(Oe),Oe=null,!0},M);return D?void 0:!!Ee}}]),fd=g(function y(){l(this,y),this.method="",this.httpMethod="POST",this.contentType="application/octet-stream",this.remoteFilename="RemoteFile",this.blockSize=0,this.offset=0,this.retry=0,this.bOnlyResponseEmptyIsOK=!0,this.bAsync=!0,this.responseType=hu.Text}),Uhe=g(function y(){l(this,y),this.IfShowProgressBar=!1,this.IfShowCancelDialogWhenImageTransfer=!0});!function(y){y.URL=0,y.Blob=1,y.Base64=2}(bf||(bf={}));var xP=window.SparkMD5,Y9=g(function y(C,x,w,T){l(this,y);var A=this;A._md5=w,A._length=x,A._content=T},[{key:"getLength",value:function(){return this._length}},{key:"getMD5",value:function(){return this._md5}},{key:"getData",value:function(y,C){var x=this,w=C;return U.isNumber(y)&&U.isNumber(C)?y<0||C<=0?"":0==y&&w==x._length?x._content:(y+w>x._length&&(w=x._length-y),x._content.substr(y,w)):""}}]);ge.html5.Base64Result=Y9;var Vhe=function(y){function C(Ee){var Oe,we,ue;return l(this,C),ue=[Ee],we=qn(we=C),(Oe=$a(this,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(pe){return!1}}()?Reflect.construct(we,ue||[],qn(this).constructor):we.apply(this,ue))).__maxUploadImageSize=-1,Oe._strHttpContentTypeFieldValue="application/octet-stream",Oe}return qa(C,y),g(C,[{key:"_saveBlob",value:(je=yt(W.mark(function Ee(Oe,He){var we,ue;return W.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(we=this,!Ce.navInfo.bIE){pe.next=7;break}return pe.next=5,we._innerSaveLocal(Oe,He);case 5:pe.next=11;break;case 7:return ue=URL.createObjectURL(Oe),pe.next=10,we._innerSaveLocal(ue,He);case 10:URL.revokeObjectURL(ue);case 11:Oe=null;case 12:case"end":return pe.stop()}},Ee,this)})),function(Ee,Oe){return je.apply(this,arguments)})},{key:"_saveImages",value:(Ue=yt(W.mark(function Ee(Oe,He,we,ue){var pe,ye,me,Se,We,ze;return W.wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return pe=this,ye=bP(He,ue),me=_m(pe,we),ge.cancelFrom=Zn.Other,Be.next=5,pe._innerConvertToArrayBufferWithUIAsync(Oe,ue,me);case 5:return Se=Be.sent,We=zn.getBlobTypeByImageType(ue),ze=new Blob([Se],{type:We}),Be.next=10,pe._saveBlob(ze,ye);case 10:ze=null;case 11:case"end":return Be.stop()}},Ee,this)})),function(Ee,Oe,He,we){return Ue.apply(this,arguments)})},{key:"_innerSaveLocal",value:(Te=yt(W.mark(function Ee(Oe,He){return W.wrap(function(we){for(;;)switch(we.prev=we.next){case 0:return we.abrupt("return",new ge.Promise(function(ue,pe){var ye=window,me=Ce.navInfo;if(!me.biPad&&!me.biPhone||ye.requestFileSystem||ye.webkitRequestFileSystem||ye.mozRequestFileSystem||!(de.bSafari&&parseFloat(de.strBrowserVersion)<13)&&de.bSafari){var We=document.createElementNS("http://www.w3.org/1999/xhtml","a");if(We.href=Oe,We.download=He,We.target="_blank",document.body.appendChild(We),me.bEdge)We.click(),Oe=null,We.href=null;else if(me.bIE){var ze;(ze=window.navigator)&&"msSaveOrOpenBlob"in ze&&ze.msSaveOrOpenBlob(Oe,He)}else{var Be=document.createEvent("MouseEvents");Be.initMouseEvent("click",!0,!1),We.dispatchEvent(Be)}setTimeout(function(){document.body.removeChild(We),We=null,ue()},6e3)}else{var $e=ye.open(Oe,"","",!1);setTimeout(function(){$e.document.title=He,ue()},6e3)}}));case 2:case"end":return we.stop()}},Ee,this)})),function(Ee,Oe){return Te.apply(this,arguments)})},{key:"_OnPostTransferAsync",value:function(Ee,Oe,He){var we,ue=this;if(Ee&&Ee.length>=2)try{var pe=String(Ee[1]).replace(/\\/g,"\\\\");we=U.parse(pe),!He&&we.imageId&&(we.imageId=ue._serverId2uidFromServer(we.imageId))}catch(me){U.log(Ee)}we||(we={imageId:""});var ye=!1;if(U.isFunction(ue.__OnPostTransferAsync))try{ye=ue.__OnPostTransferAsync(we)}catch(me){Fr(me)}if(U.isFunction(ue.__OnPostTransferAsync2))try{ue.__OnPostTransferAsync2(we)}catch(me){Fr(me)}return ye}},{key:"_checkIndices",value:function(Ee,Oe){return Hhe(Ee,!U.isUndefined(Oe)&&Oe>=0?Oe:this._imageBufferWrapper.count(),this)}},{key:"_acquireImageForSendTo",value:(ve=yt(W.mark(function Ee(Oe,He,we,ue){var pe,ye,me,Se,We,ze,Be,$e;return W.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:if(pe=this,ye=we?U.clone(we):{},Se=me=ue,pe._resetErr(),pe._isValid()){Ge.next=4;break}throw{code:pe._errorCode,message:pe._errorString};case 4:if(U.isString(me._id)){Ge.next=6;break}throw{code:-2602,message:'The parameter "SendTo" is invalid.'};case 6:if(!pe.__bAcquireImageNow){Ge.next=9;break}throw ile(pe),{code:pe._errorCode,message:pe._getErrorString()};case 9:if(pe.__bAcquireImageNow=!0,Bo(Oe,Se),We=ge.Promise.resolve(),ze=Ce.DWT.RemoteScanConfig,Be=Gce(),Ge.prev=13,aue(ye),ze&&YA(ze.keepAwake),pn.checkProductKey(pe,{Core:!0})&&pe._isValid()){Ge.next=18;break}throw{code:pe._errorCode,message:pe._errorString};case 18:return Yl._innerSendHeartBeat(me,!1),$e=function(){var _t=yt(W.mark(function Ct(Ut){return W.wrap(function(Tn){for(;;)switch(Tn.prev=Tn.next){case 0:We=We.then(function(){return new ge.Promise(function(mn,bt){var At=[pe._uidFromServer2ServerId(Ut.imageId)],Tt=Ce.DWT.EnumDWT_ImageType.IT_PNG;ge.cancelFrom=Zn.Scan,pe._innerConvertToArrayBufferAsync(Tt,At).then(function(Bt){var Qt;me._bltsCopyImage=!0,me.__LoadImageFromBytesV2(Bt,Tt,"",!0,0,0,!1,0,(Qt=yt(W.mark(function yn(un,Ir){var jn;return W.wrap(function(hi){for(;;)switch(hi.prev=hi.next){case 0:return jn=pe._uidFromServer2ServerId(Ut.imageId),Ir?(U.log("LoadImageFromBinary success"),me._bltsCopyImage=!1,Ut.imageId=me._uidFromServer2ServerId(Ir.ids),U.isFunction(me._OnPostTransferAsync)&&me._OnPostTransferAsync([!0,U.stringify(Ut)],null,!0)):U.log("LoadImageFromBinary return null."),mn(),hi.next=5,pe._removeImageByIdAsync(jn);case 5:case"end":return hi.stop()}},yn)})),function(yn,un){return Qt.apply(this,arguments)}),function(Qt,yn){U.log(yn),me._bltsCopyImage=!1,bt({code:Qt,message:yn})})},function(Bt){Bt&&Bt.message&&U.log(Bt.message),bt(Bt)})})});case 1:case"end":return Tn.stop()}},Ct)}));return function(Ct){return _t.apply(this,arguments)}}(),pe._registerEvent("OnPostTransferAsync2",$e),null!=He&&(ye.Device=He.strDevice,ye.DeviceMatchField=_0.SMF_NAME),Ge.next=24,pe._acquireImageFromServiceAsync(ye);case 24:Ge.next=29;break;case 26:throw Ge.prev=26,Ge.t0=Ge.catch(13),Ge.t0;case 29:return Ge.prev=29,Ge.prev=30,Ge.next=33,We;case 33:Ge.next=37;break;case 35:Ge.prev=35,Ge.t1=Ge.catch(30);case 37:return pe._unregisterEvent("OnPostTransferAsync2"),pe.__bAcquireImageNow=!1,Gr(Oe),YA(Be),Ge.finish(29);case 42:case"end":return Ge.stop()}},Ee,this,[[13,26,29,42],[30,35]])})),function(Ee,Oe,He,we){return ve.apply(this,arguments)})},{key:"_uidFromServer2index",value:function(Ee){var Oe,He=this;return He._resetErr(),!!He._isValid()&&(U.isString(Ee)?(-1==(Oe=He._imageBufferWrapper._uidFromServer2index(Ee))&&Ile(He),Oe):(fle(He),-1))}},{key:"_index2uidFromServer",value:function(Ee){var Oe=this;if(Oe._resetErr(),!Oe._isValid())return!1;var He=parseInt(Ee);return isNaN(He)?(Jn(Oe),""):He<0||He>=this._imageBufferWrapper.count()?(kt(Oe),""):Oe._imageBufferWrapper._index2uidFromServer(Ee)}},{key:"__LoadImageFromBytesV2",value:function(Ee,Oe,He,we,ue,pe,ye,me,Se,We){var ze,Be=this,$e=Oe||3,Ge=0,_t=Ee.name,Ct=!0,Ut=1;Ee&&(Ge=Ee instanceof Blob?Ee.size:Bp(Ee)?Ee.byteLength:Ee instanceof Array?Ee.length:Ee.size||Ee.byteLength||Ee.length),!isNaN(ue)&&ue>=0&&!isNaN(pe)&&pe>0?Ut=0:(ue=0,pe=0),ze=["[",Ge,",",0,",",$e,',"',He,'",',ue,",",pe,",",me,",",Ut,",",ye?"true":"false","]"].join("");var mn=function(){if(Be.__bLoadingImage=!1,Ct){var bt=Be._imageBufferWrapper.getCurrentImageIndex();bt>=0&&Be._innerRefreshUI(bt)}return U.isFunction(We)&&We(Be._errorCode,Be._getErrorString(),_t),!1};return pn.checkProductKey(Be,{Core:!0})||de.bWin&&pn.checkProductKey(Be,{Webcam:!0},!0)?pn.checkPDFProductKeyWhenNeeds(Be,Oe)?0===Ge?(wt(Be,-2312,"The file length is empty."),Ct=!1,mn()):this._innerSendBlob("LoadImageFromBytes",ze,Ee,we,Ut,function(bt){if(Be.__bLoadingImage=!1,Be._isBindViewer()){var At=Be._imageBufferWrapper.getCurrentImageIndex();we&&At>=0&&Be._innerRefreshUI(At)}if(U.isFunction(Se)){var Tt=bt;if(U.isArray(Tt)&&(Tt=Tt.length>0?Tt[0]:{}),we)setTimeout(function(){Se(_t,Tt)},30);else try{Se(_t,Tt)}catch(Bt){U.error(Bt.message)}}return Be._canConsume()&&Ce.DWT.lcvrf(Be),!0},mn):(Ct=!1,mn()):(pn.checkProductKey(Be,{Core:!0},!1),Ct=!1,mn())}},{key:"_innerSendBlob",value:function(Ee,Oe,He,we,ue,pe,ye){var Se,We,ze,Be,me=this;return Yl.isServerInvalid(me)?me._waitForConnect().then(function(){me._innerSendBlob(Ee,Oe,He,we,ue,pe,ye)}):we?(me._innerSendBlobByWS(Ee,Oe,He,pe,ye),!0):(me._resetErr(),!!me._isValid()&&(We=[me._httpUrl,"f/",Ee].join(""),ze=b0(me._clientId,Ee,Oe,0,me._bScanForProxyRemote),ze+="\r\n\r\n",Be={method:"POST",url:We,processData:!1,data:ze+=U.base64.encodeArray(He),async:!1,onSuccess:function($e,Ge,_t){var Ct=!1,Ut=!1;try{Ct=U.isString($e)&&"text/json"===_t.getResponseHeader("content-type")?U.parse($e):$e}catch(At){}if(null!=Ct&&(yc(Ct)?(me._errorCode=Ct.exception,me._errorString=Ct.description):me._resetErr(),(Se=Ct.result)&&U.isArray(Se)&&Se.length>=1))if(ue){var Tn,mn=Se[0];mn&&U.isObject(mn)&&(Tn=mn.imageInfos,0==me._errorCode&&U.isString(Tn)&&me._handleOnBitmapChangedEvent({result:["c1",Tn]},{document:He.currentFileName,tag:He.currentTagName}),Ut=!0)}else{var bt=Se.join(",");0==me._errorCode&&bt.length>0&&me._OnBitmapChanged(["c1",bt,1,me._imageBufferWrapper.getCurrentImageIndex(),me._imageBufferWrapper.count()],null,{document:He.currentFileName,tag:He.currentTagName}),Ut=!0}Ut||(F7(me),Se="")},onError:function(){EA(me),Se=""}},U.mix(Be,{headers:{"X-Requested-With":!1}}),de.bFileSystem&&(Be.crossDomain=!1),ru(Be),0==me._errorCode?U.isFunction(pe)&&pe():U.isFunction(ye)&&ye(),Se))}},{key:"_convertToBase64ByServerIdsWithUI",value:function(Ee,Oe,He,we,ue,pe,ye){this._convertToBase64ByServerIdsWithUIAsync(Ee,He,Oe,we).then(function(me){U.isFunction(pe)&&bs(pe,me)},function(){U.isFunction(ye)&&ye()})}},{key:"_OnPercentDone",value:function(Ee){var Oe,He,we,ue,pe,ye=this,me=!1,Se=!1,We=0;U.isArray(Ee)&&Ee.length>2&&(He=Ee[0],we=Ee[2],Ee.length>3&&(ue=Ee[3]),Ee.length>4&&(pe=Ee[4]),Oe=We=Ee[1],We<0?Oe=0:We>100&&(Oe=100),Oe=Math.floor(Oe),ge.cancelFrom!=Zn.HTTPUpload&&ge.cancelFrom!=Zn.HTTPDownload&&ge.cancelFrom!=Zn.Scan&&ge.cancelFrom!=Zn.HTTPPut||(Se=pe)),(ye._bServerPercentDone||0==He)&&((We>0||0==We)&&(ge.cancelFrom!=Zn.HTTPUpload&&ge.cancelFrom!=Zn.HTTPDownload&&ge.cancelFrom!=Zn.FTPUpload&&ge.cancelFrom!=Zn.FTPDownload&&ge.cancelFrom!=Zn.HTTPPut||(me=!0)),ye.IfShowProgressBar&&ge.progressBarOnPercentDone(We,we,ue,Oe,Se,this._containerElement),1==me&&(U.isFunction(ye.__OnInternetTransferPercentage)&&ye.__OnInternetTransferPercentage(Oe,!1),U.isFunction(ye.__OnInternetTransferPercentageEx)&&ye.__OnInternetTransferPercentageEx(Oe,!1)),U.isFunction(ye.__OnPercentDone)&&ye.__OnPercentDone())}},{key:"IfShowProgressBar",get:function(){return this._bIfShowProgressBar},set:function(Ee){this._resetErr(),U.isBoolean(Ee)?this._bIfShowProgressBar=Ee:da(this)}},{key:"IfShowCancelDialogWhenImageTransfer",get:function(){return this.__IfShowCancelDialogWhenImageTransfer},set:function(Ee){this._resetErr(),U.isBoolean(Ee)?this.__IfShowCancelDialogWhenImageTransfer=Ee:da(this)}},{key:"_getLogLevel",value:function(){return this._logLevel}},{key:"_setLogLevel",value:(ce=yt(W.mark(function Ee(Oe){return W.wrap(function(He){for(;;)switch(He.prev=He.next){case 0:return this._logLevel=Oe,He.next=3,this._innerFunV2("LogLevel",It(Oe));case 3:case"end":return He.stop()}},Ee,this)})),function(Ee){return ce.apply(this,arguments)})},{key:"MaxUploadImageSize",get:function(){return this.__maxUploadImageSize},set:function(Ee){this._resetErr();var He=1*Ee;!U.isNumber(He)||isNaN(He)?da(this):this.__maxUploadImageSize=He}},{key:"HTTPRequestswithCredentials",get:function(){return this._resetErr(),this._bWithCredentials},set:function(Ee){this._resetErr(),U.isBoolean(Ee)?this._bWithCredentials=Ee:da(this)}},{key:"cancelableObj",get:function(){return this._cancelableObj},set:function(Ee){this._cancelableObj=Ee}},{key:"_getProfile",value:(se=yt(W.mark(function Ee(Oe){var He,we;return W.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if((He=this)._resetErr(),He._isValid()){ue.next=4;break}throw{code:He._errorCode,message:He._errorString};case 4:return Oe&&(we=U.stringify([Oe.strDevice])),ue.abrupt("return",He._innerFunV2("GetCustomDSDataEx",we));case 6:case"end":return ue.stop()}},Ee,this)})),function(Ee){return se.apply(this,arguments)})},{key:"_setProfile",value:(re=yt(W.mark(function Ee(Oe,He){var we,ue;return W.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if((we=this)._resetErr(),we._isValid()){pe.next=4;break}throw{code:we._errorCode,message:we._errorString};case 4:return ue=Oe?U.stringify([He,Oe.strDevice]):It(He),pe.abrupt("return",this._innerFunV2("SetCustomDSDataEx",ue));case 6:case"end":return pe.stop()}},Ee,this)})),function(Ee,Oe){return re.apply(this,arguments)})},{key:"_removeAllImagesAsync",value:(q=yt(W.mark(function Ee(Oe,He){var we,ue,pe,ye,me,Se;return W.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if((we=this)._resetErr(),we._isValid()){We.next=4;break}throw{code:we._errorCode,message:we._errorString};case 4:for(pe=[],me=we._getHowManyImagesInBuffer(),ye=me-1;ye>=0;ye--)(Se=we._imageBufferWrapper.convertClientIndexToServerId(ye))>-1&&pe.push(Se);if(0!=pe.length){We.next=13;break}return We.next=10,we._innerFunV2("RemoveAllImages");case 10:ue=We.sent,We.next=23;break;case 13:if(!He){We.next=19;break}return We.next=16,we._innerFunV2("RemoveAllImages",It(pe.join(",")));case 16:ue=We.sent,We.next=22;break;case 19:return We.next=21,we._innerFunV2("RemoveAllImages");case 21:ue=We.sent;case 22:(ue||-1033==we._errorCode)&&we._OnBitmapChanged(["c1",pe.join(","),3,we._imageBufferWrapper.getCurrentImageIndex(),we._imageBufferWrapper.count()]);case 23:return We.abrupt("return",ue);case 24:case"end":return We.stop()}},Ee,this)})),function(Ee,Oe){return q.apply(this,arguments)})},{key:"__OnRecieveMsg",value:function(Ee,Oe){var He=this,we=null==Oe?void 0:Oe.cmd;if(Ee.event)return fa(qn(C.prototype),"__OnRecieveMsg",this).call(this,Ee,Oe);if(yc(Ee)?(He._errorCode=Ee.exception,He._errorString=Ee.description):"StartScan"!=we&&"GetAddOnVersion"!=we&&(He._errorCode=0,He._errorString=""),"ReadBarcode"==we||"OCRRecognize"==we||Ee.request&&"OCRProRecognize"==Ee.request.method)return Oe.sFun?(Oe.sFun(Ee),!0):(Oe.fFun&&Oe.fFun(Ee),!0);if("SetCapabilities"==we||"GetSkewAngleFromBinary"==we||"UpdateImage"==we)return"exception"in Ee&&"0"!=Ee.exception?(Ee.result.errorCode&&Ee.result.errorString?(He._errorCode=Ee.result.errorCode,He._errorString=Ee.result.errorString):(He._errorCode=Ee.exception,He._errorString=Ee.description),Oe.fFun&&Oe.fFun(Ee.result),Ee=null,!0):(Oe.sFun&&Oe.sFun(Ee.result),Ee=null,!0);if(Ee.result&&Ee.result.length&&("1"==Ee.result[0]||1==Ee.result[0]||"ok"==Ee.result[0]))return(Oe.sFun||Oe.sFun)&&Oe.sFun(Ee.result),!0;if(!Ee.exception)return Oe.sFun&&Oe.sFun(Ee.result),Ee=null,!0;var ue=!1;return Oe.fFun&&(ue=Oe.fFun(He._errorString)),!ue&&Ee.exception&&Ee.exception<0&&-2115!=Ee.exception&&U.isFunction(He.__OnPrintMsg)&&He.__OnPrintMsg(He._errorString),!0}},{key:"_convertServerIdToGuid",value:function(Ee){return this._serverId2uidFromServer(Ee)}},{key:"_convertGuidToServerId",value:function(Ee){return this._uidFromServer2ServerId(Ee)}},{key:"_serverId2uidFromServer",value:function(Ee){return this._imageBufferWrapper._serverId2uidFromServer(Ee)}},{key:"_uidFromServer2ServerId",value:function(Ee){return this._imageBufferWrapper._uidFromServer2ServerId(Ee)}},{key:"_innerConvertToBlobWithUI",value:function(Ee,Oe,He,we,ue,pe){var ye=this,me=arguments,Se=function(We){if(ge.needShowTwiceShowDialog=!1,U.isFunction(pe)){var ze=[];U.isArray(He)&&U.each(He,function(Be){var $e=ye._imageBufferWrapper.convertServerIdToClientIndex(Be);$e>-1&&ze.push($e)}),We&&(ye._errorCode=We.code,ye._errorString=We.message),pe(ze)}return!1};ye._innerConvertToArrayBufferWithUIAsync(Ee,Oe,He,we).then(function(We){if(!We||We.byteLength<=0)return hle(ye),Se();var ze=ye.__maxUploadImageSize;if(We.byteLength>ze&&-1!=ze)return ff(ye),Se();if(ge.needShowTwiceShowDialog=!1,U.isFunction(ue)){var Be=[];U.isArray(He)&&U.each(He,function(_t){var Ct=ye._imageBufferWrapper.convertServerIdToClientIndex(_t);Ct>-1&&Be.push(Ct)});var $e=zn.getBlobTypeByImageType(Oe),Ge=new Blob([We],{type:$e});try{ue(Ge,Be,me)}catch(_t){}Ge=null}return!0},Se)}},{key:"convertToBlob",value:(G=yt(W.mark(function Ee(Oe,He,we){var ue,pe,ye,me;return W.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return pe=_m(ue=this,He),ge.cancelFrom=Zn.ConvertToBlob,Se.next=4,ue._innerConvertToArrayBufferWithUIAsync("convertToBlob",Oe,pe,we);case 4:return ye=Se.sent,me=zn.getBlobTypeByImageType(Oe),Se.abrupt("return",new Blob([ye],{type:me}));case 7:case"end":return Se.stop()}},Ee,this)})),function(Ee,Oe,He){return G.apply(this,arguments)})},{key:"_innerConvertToArrayBufferWithUIAsync",value:(Y=yt(W.mark(function Ee(Oe,He,we,ue,pe){var ye,me,Se,We;return W.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return me=this,We=null===(ye=ge.progressContext)||void 0===ye?void 0:ye.IfShowCancelDialogWhenImageTransfer,ze.prev=2,me.IfShowProgressBar?ge.showProgress(me,Oe,!1):ge.hideProgress(),me._OnPercentDone([0,-1,Lr.Encoding]),ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=!1),ze.next=8,this._innerConvertToArrayBufferAsync(He,we,ue,pe);case 8:Se=ze.sent;case 9:return ze.prev=9,ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=We),me.IfShowProgressBar&&ge.closeProgress(null,Oe),ze.finish(9);case 13:return ze.abrupt("return",Se);case 14:case"end":return ze.stop()}},Ee,this,[[2,,9,13]])})),function(Ee,Oe,He,we,ue){return Y.apply(this,arguments)})},{key:"_innerConvertToBase64Async",value:(H=yt(W.mark(function Ee(Oe,He,we){var ue,pe,ye,me,Be,$e;return W.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:return ue=this,U.isString(pe=we)&&""!=pe||(pe="{}"),ye=["[",Oe,',"',He.join(","),'",',pe,",1]"].join(""),Ge.next=5,ue._sendDataByHttpAsync("ConvertToBase64",ye,"text",!0);case 5:if(Be=(me=Ge.sent)&&me.result,0==ue._errorCode){Ge.next=9;break}throw{code:ue._errorCode,message:ue._errorString};case 9:if(!Be||!U.isArray(Be)||3!=Be.length){Ge.next=17;break}return $e=new Y9(null,Be[1],Be[2],Be[0]),Ge.abrupt("return",$e);case 17:throw wt(ue,-2366,"Converting images to a base64 string failed."),{code:ue._errorCode,message:ue._errorString};case 19:case"end":return Ge.stop()}},Ee,this)})),function(Ee,Oe,He){return H.apply(this,arguments)})},{key:"_convertToBase64ByServerIdsWithUIAsync",value:(B=yt(W.mark(function Ee(Oe,He,we,ue){var pe,ye,me;return W.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return ye=this,me=null===(pe=ge.progressContext)||void 0===pe?void 0:pe.IfShowCancelDialogWhenImageTransfer,Se.prev=2,ye.IfShowProgressBar?ge.showProgress(ye,Oe,!1):ge.hideProgress(),ye._OnPercentDone([0,-1,Lr.Encoding]),ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=ye.IfShowCancelDialogWhenImageTransfer),Se.next=8,this._innerConvertToBase64Async(He,we,ue);case 8:return Se.abrupt("return",Se.sent);case 9:return Se.prev=9,ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=me),ye.IfShowProgressBar&&ge.closeProgress(null,Oe),Se.finish(9);case 13:case"end":return Se.stop()}},Ee,this,[[2,,9,13]])})),function(Ee,Oe,He,we){return B.apply(this,arguments)})},{key:"_convertToBlobForUpload",value:function(Ee,Oe,He,we,ue,pe,ye){var me=this,Se=arguments;if(Ce.DWT.ConnectWithSocket){var We=He,ze=",";U.isString(We)&&""!=We||(We="",ze="");var Be=["[",Ee,',"',Oe.join(","),'"',ze,We,"]"].join("");return ge.cancelFrom=Zn.ConvertToBlob,ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=!1),me._sendData("ConvertToBlob",Be,!0,function($e){me._resetErr();var Ge=$e;if(Ge){if(Ge instanceof Blob||Bp(Ge))return void ue(Ge,"",Se);yc(Ge)&&(me._errorCode=Ge.exception,me._errorString=Ge.description)}},function($e){me._errorCode=$e.code,me._errorString=$e.message,pe($e)}),!0}me._innerConvertToArrayBufferAsync(Ee,Oe,He,"arraybuffer").then(function($e){var _t=new Blob([$e],{type:me._strHttpContentTypeFieldValue});if(Ce.DWT.IfAddMD5InUploadHeader){var Ct=new xP.ArrayBuffer;Ct.append($e),U.isFunction(ue)&&ue(_t,Ct.end(),Se)}else U.isFunction(ue)&&ue(_t,"",Se);_t=null},function($e){pe($e.code,$e.message)})}},{key:"dispose",value:function(){return this.__unload()}},{key:"_innerDisposeWSClient",value:function(){return this._isValid()?this._sendData("dispose",null,!0,function(){},function(){}):ge.Promise.reject()}},{key:"__unload",value:(M=yt(W.mark(function Ee(){var Oe,He;return W.wrap(function(we){for(;;)switch(we.prev=we.next){case 0:if(!(Oe=this)._bReady||ge.page.bUnload){we.next=10;break}if(!Oe._wsClient){we.next=10;break}return we.prev=3,we.next=6,Oe._innerDisposeWSClient();case 6:we.next=10;break;case 8:we.prev=8,we.t0=we.catch(3);case 10:if(!Oe._wsClient){we.next=24;break}return Oe._wsClient.removeEvent("close",Oe._clientId),Oe._wsClient.removeEvent("error",Oe._clientId),Oe._wsClient.removeEvent("timeout",Oe._clientId),we.prev=14,we.next=17,Oe._wsClient.dispose();case 17:we.next=22;break;case 19:we.prev=19,we.t1=we.catch(14),He=we.t1;case 22:delete Oe._wsClient,Oe._wsClient=null;case 24:if(this._imageBufferWrapper.dispose(),this._bReady=vt,this._destroy=Lt,!He){we.next=29;break}throw He;case 29:case"end":return we.stop()}},Ee,this,[[3,8],[14,19]])})),function(){return M.apply(this,arguments)})},{key:"_getImages",value:(D=yt(W.mark(function Ee(Oe,He,we,ue){var pe,ye,me,Se;return W.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if((pe=this)._checkIndices(He)){We.next=3;break}throw{code:this._errorCode,message:this._errorString};case 3:if(ue!=bf.URL){We.next=9;break}if(!(He.length>1)){We.next=7;break}throw wt(this,-2619,"Only single index selection is allowed when enumImageFormatType is set to url."),{code:this._errorCode,message:this._errorString};case 7:We.next=13;break;case 9:if(we!=Ce.DWT.EnumDWT_ImageType.IT_BMP&&we!=Ce.DWT.EnumDWT_ImageType.IT_JPG&&we!=Ce.DWT.EnumDWT_ImageType.IT_PNG){We.next=13;break}if(!(He.length>1)){We.next=13;break}throw yVe(this),{code:this._errorCode,message:this._errorString};case 13:if(ue!=bf.URL){We.next=17;break}return We.abrupt("return",this._imageBufferWrapper.getImageUrl(He[0]));case 17:if(ge.cancelFrom=Zn.Other,ye=_m(pe,He),ue!=bf.Blob){We.next=27;break}return We.next=22,this._innerConvertToArrayBufferWithUIAsync(Oe,we,ye);case 22:return me=We.sent,Se=zn.getBlobTypeByImageType(we),We.abrupt("return",new Blob([me],{type:Se}));case 27:if(ue!=bf.Base64){We.next=31;break}return We.next=30,this._convertToBase64ByServerIdsWithUIAsync(Oe,we,ye);case 30:return We.abrupt("return",We.sent);case 31:throw vVe(this),{code:this._errorCode,message:this._errorString};case 33:case"end":return We.stop()}},Ee,this)})),function(Ee,Oe,He,we){return D.apply(this,arguments)})},{key:"_LicensePromptExpired",value:function(){var Ee=this,Oe=Ee.__licenseInfo.bTrial,He="";Ee.__licenseInfo&&Ee.__licenseInfo.ExpireDate&&(He=Ee.__licenseInfo.ExpireDate);var we=Cce(He);we<=0&&(Oe||Fr(Ee._getErrorString()),U.isFunction(Ce.OnLicenseExpiredWarning)&&Ce.OnLicenseExpiredWarning(He,we,Oe))}},{key:"__saveToViewerAfterUpdate",value:function(Ee,Oe){var He=this,we=this._imageBufferWrapper.getIndexByUid(Ee),ue=this._imageBufferWrapper.convertClientIndexToServerId(we),pe=lr.getUrlByAct(this._imageBufferWrapper.BaseUrl,ue,2);return new ge.Promise(function(ye,me){ru({method:"GET",xhrFields:{withCredentials:!0},url:pe,onSuccess:function(Se){var We,ze=He._imageBufferWrapper.getMetadataByIndex(we);ze||(ze={}),ze.width=Oe.width,ze.height=Oe.height,We=Ce.navInfoSync.bMobile?He._imageBufferWrapper.getMinImageUrl(we,Math.round(ze.controlWidth*devicePixelRatio),Math.round(ze.controlHeight*devicePixelRatio)):He._imageBufferWrapper.getMinImageUrl(we,ze.controlWidth,ze.controlHeight);var Be=He._imageBufferWrapper.getImageIdMap(ue);if(Be){Be.ticks=Date.now(),Be.imageUrl=He._imageBufferWrapper.getImageUrl(we),Be.minImageUrl=We,Be.width=Oe.width,Be.height=Oe.height;var $e=U.clone(Be);$e.imageId=ue,He._imageBufferWrapper.UpdateImage($e,ze)}ye()},onError:function(){ye(),Gr("save")}})})}},{key:"RunCommandAsync",value:(A=yt(W.mark(function Ee(Oe){var He,we,ue,pe,ye;return W.wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(He=this,Oe&&U.isString(Oe.command)&&Oe.parameter){me.next=4;break}throw Wi(He),{code:He._errorCode,message:He._errorString};case 4:if("Invert"!=Oe.command){me.next=6;break}return me.abrupt("return",He._invert(Oe.parameter.index));case 6:if(!U.isNumber(we=Oe.parameter.index)){me.next=13;break}if(!(isNaN(we)||!U.isNumber(we)||we<0||we>=He._imageBufferWrapper.count())){me.next=11;break}throw kt(He),{code:He._errorCode,message:He._errorString};case 11:me.next=15;break;case 13:throw Jn(He),{code:He._errorCode,message:He._errorString};case 15:return ue=He._imageBufferWrapper.convertClientIndexToServerId(we),Oe.parameter.index=ue,pe=["[",U.stringify(Oe),"]"].join(""),me.next=20,He._innerFunRawV3("runCommand",pe);case 20:if(ye=me.sent,!de.bIE){me.next=25;break}if(!U.isString(ye)){me.next=24;break}return me.abrupt("return",U.parse(ye));case 24:return me.abrupt("return",ye);case 25:return me.next=27,ye.json();case 27:return me.abrupt("return",me.sent);case 28:case"end":return me.stop()}},Ee,this)})),function(Ee){return A.apply(this,arguments)})},{key:"_innerFunRawV3",value:(T=yt(W.mark(function Ee(Oe,He){var we,ue,pe;return W.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(pe="fa/",(we=this)._resetErr(),we._isValid()){ye.next=4;break}throw{code:we._errorCode,message:we._errorString};case 4:if(!Yl.isServerInvalid(we)){ye.next=7;break}return ye.abrupt("return",we._waitForConnect().then(function(){return we._innerFunRawV3(Oe,He)}));case 7:return ue={method:"post",body:b0(we._clientId,Oe,He,0,we._bScanForProxyRemote),fetchRaw:!0},ye.next=10,X1([we._httpUrl,pe,Oe].join(""),ue);case 10:return ye.abrupt("return",ye.sent);case 11:case"end":return ye.stop()}},Ee,this)})),function(Ee,Oe){return T.apply(this,arguments)})},{key:"_invert",value:(w=yt(W.mark(function Ee(Oe){var He,we,ue,ye;return W.wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(He=this,we=parseInt(Oe),He._resetErr(),He._isValid()){me.next=4;break}throw{code:He._errorCode,message:He._errorString};case 4:if(!isNaN(we)){me.next=7;break}throw Jn(He),{code:He._errorCode,message:He._errorString};case 7:if(!(we<0||we>=He._imageBufferWrapper.count())){me.next=10;break}throw kt(He),{code:He._errorCode,message:He._errorString};case 10:if(-1!=(ue=He._imageBufferWrapper.convertClientIndexToServerId(we))){me.next=14;break}throw kt(He),{code:He._errorCode,message:He._errorString};case 14:return me.next=16,He._innerFunV2("Invert",It(ue),!0);case 16:if(!(ye=1==me.sent)){me.next=22;break}zn.refreshImageAfterInvokeFun(He,we),me.next=23;break;case 22:throw{code:He._errorCode,message:He._errorString};case 23:return me.abrupt("return",ye);case 24:case"end":return me.stop()}},Ee,this)})),function(Ee){return w.apply(this,arguments)})}],[{key:"create",value:(x=yt(W.mark(function Ee(Oe){var He;return W.wrap(function(we){for(;;)switch(we.prev=we.next){case 0:return He=new C(Oe),we.next=3,Yl.STwainConnectToServer(He);case 3:return we.abrupt("return",He);case 4:case"end":return we.stop()}},Ee)})),function(Ee){return x.apply(this,arguments)})}]);var x,w,T,A,D,M,B,H,Y,G,q,re,se,ce,ve,Te,Ue,je}(T$e);function jhe(y){var x="",w=!1;if(y.__licenseInfo&&(y.__licenseInfo.ExpireDate&&(x=y.__licenseInfo.ExpireDate),w=y.__licenseInfo.bTrial),w&&!Ce.DWT.HideTrialMessage){var T=Cce(x);T<=5&&(U.isFunction(Ce.OnLicenseExpiredWarning)&&Ce.OnLicenseExpiredWarning(x,T,!0),Ce.DWT.HideTrialMessage=!0)}}function Hhe(y,C,x){var w;if(!U.isArray(y))return Y1(x),!1;if(0==y.length)return wt(x,-2350,"The indices cannot be empty."),!1;if(Ce.DWT.ConnectWithSocket)return!0;for(w=0;w<y.length;w++){var T=y[w];if(U.isUndefined(T)||null===T)return cle(x),!1;if(T=parseInt(T),isNaN(T))return Jn(x),!1;if(T<0||T>=C)return lle(x),!1}return!0}var ch={changeImageUISize:function(y,C,x){var w,T,A,D,M=C,B=x,H=vt;w=ft.one(y._containerElement),U.isString(C)&&C.indexOf("%")>=0?(0==(A=ft.css(w,"width"))&&(w[0].style.width="100%"),A=ft.css(w,"width")*parseInt(C)/100,H=Lt):M=[(A=parseInt(C))+2,"px"].join(""),U.isString(x)&&x.indexOf("%")>=0?(0==(D=ft.css(w,"height"))&&(w[0].style.height="100%"),D=ft.css(w,"height")*parseInt(x)/100,H=Lt):B=[(D=parseInt(x))+2,"px"].join(""),w&&(T=ft.one(".dynamsoft-dwt-container-box",w))&&T.getEL()&&(T.style("width",M),T.style("height",B)),H?(y.__funResize||(y.__funResize=function(){if(y._ImgManager&&y._containerElement){var G=ch.__innerGetUIViewRealSize(y._containerElement,y._width,y._height);return y._UIView.ChangeSize(G.width,G.height)}return Lt}),U.removeEventListener(window,"resize",y.__funResize),U.addEventListener(window,"resize",y.__funResize)):y.__funResize&&(U.removeEventListener(window,"resize",y.__funResize),y.__funResize=vt);var Y=ch.__innerGetUIViewRealSize(y._containerElement,A,D);return y._ImgManager?y._UIView.ChangeSize(Y.width,Y.height):Lt},__innerGetUIViewRealSize:function(y,C,x){var w,T=-1,A=-1;return w=ft.one(y),U.isString(C)&&C.indexOf("%")>=0&&(T=ft.css(w,"width")*parseInt(C)/100),T<0&&C&&(T=parseInt(C)),U.isString(x)&&x.indexOf("%")>=0&&(A=ft.css(w,"height")*parseInt(x)/100),A<0&&x&&(A=parseInt(x)),{width:T,height:A}},bindUIViewEvents:function(y,C){var x=y;C.onSelected=function(w){if(!x._isNoViewer()){var T,A=w.length;A>0&&(x._ImgManager.SetSelectedImageCount(A),T=w[A-1],U.isFunction(x.__OnRefreshUI)&&x.__OnRefreshUI(T))}},C.onRefreshUI=function(w){x._isNoViewer()||ch.__innerRefreshFromUIView(x,w)},C.onResetCurrentIndex=function(w){if(!x._isNoViewer()){var T=x._ImgManager.getCurrentImageIndex();if(w>=0&&w<x._ImgManager.count()&&T!=w&&U.isFunction(x.__OnIndexChangeDuringDragDrop))try{x.__OnIndexChangeDuringDragDrop(T,w)}catch(A){Fr(A)}}},C.onMouseMove=function(w){if(!x._isNoViewer()){var T=w.index;if(w){var D=w.y;x.__MouseX=w.x,x.__MouseY=D}if(U.isFunction(x.__OnMouseMove))try{x.__OnMouseMove(T)}catch(M){Fr(M)}}},C.onMouseClick=function(w){if(!x._isNoViewer()){var T=w.index;if(w){var D=w.y;x.__MouseX=w.x,x.__MouseY=D}if(U.isFunction(x.__OnMouseClick))try{x.__OnMouseClick(T)}catch(M){Fr(M)}}},C.onMouseDoubleClick=function(w){if(!x._isNoViewer()){var T=w.index;if(U.isFunction(x.__OnMouseDoubleClick))try{x.__OnMouseDoubleClick(T)}catch(A){Fr(A)}}},C.onMouseRightClick=function(w){if(!x._isNoViewer()){var T=w.index;if(w){var D=w.y;x.__MouseX=w.x,x.__MouseY=D}if(U.isFunction(x.__OnMouseRightClick))try{return x.__OnMouseRightClick(T)}catch(M){Fr(M)}return Lt}},C.onImageAreaSelected=function(w){if(!x._isNoViewer()&&U.isFunction(x.__OnImageAreaSelected))try{x.__OnImageAreaSelected(w.index,w.left,w.top,w.right,w.bottom,w.areaIndex)}catch(T){Fr(T)}},C.onImageAreaDeSelected=function(w){if(!x._isNoViewer()&&U.isFunction(x.__OnImageAreaDeSelected))try{x.__OnImageAreaDeSelected(w)}catch(T){Fr(T)}},C.onBufferChanged=function(w){if(U.isFunction(x.__OnBufferChanged))try{x.__OnBufferChanged(w)}catch(T){Fr(T)}}},__innerRefreshFromUIView:function(y,C){var x=y;U.isFunction(x.__OnRefreshUI)&&x.__OnRefreshUI(C)}};function Ui(y,C,x){C in y||Object.defineProperty(y,C,x)}var E$e=g(function y(C){l(this,y);var x=this;x._parent=C,Ui(x,"width",{get:function(){return this._parent._width},set:function(w){this.SetSize(w,!1)}}),Ui(x,"height",{get:function(){return this._parent._height},set:function(w){this.SetSize(!1,w)}})},[{key:"SetSize",value:function(y,C){var x,w=this._parent,T=!1,A=!1;return!!w._isBindViewer()&&(U.isString(y)&&y.length>0&&"%"===y.charAt(y.length-1)&&(T=y),!T&&y&&(x=parseInt(y))&&(T=x+"px"),U.isString(C)&&C.length>0&&"%"===C.charAt(C.length-1)&&(A=C),!A&&C&&(x=parseInt(C))&&(A=x+"px"),T&&(w._width=T),A&&(w._height=A),ch.changeImageUISize(w,T,A))}}]);function Ghe(y){var C,x,T,A=y._config;ge.dlgProgress||ge.initProgress(y),A.bNoViewer?y._containerElement=null:(A.container?y._containerElement=A.container:A.containerId&&(y._containerElement=U.get(A.containerId)),y._width=A.width,y._height=A.height,C=ft.one(y._containerElement)),function(D,M){var B={Stwain:D},H=vt;if(M){var Y,G=D._width,q=D._height;Y=ft.one(D._containerElement),U.isString(G)&&G.indexOf("%")>=0?(G=ft.css(Y,"width")*parseInt(G)/100,H=Lt):G=parseInt(G),U.isString(q)&&q.indexOf("%")>=0?(q=ft.css(Y,"height")*parseInt(q)/100,H=Lt):q=parseInt(q),B={Stwain:D,Container:M,Width:G,Height:q}}ch.bindUIViewEvents(D,B),D._UIView?D._UIView._Init(B):D._UIView=new ge.UI.ImageUIView(D,B),D.Width<=0&&(D.Width=270),D.Height<=0&&(D.Height=350),H&&ch.changeImageUISize(D,D._width,D._height)}(y,C),y._isBindViewer()&&((x=y).__OnImageAreaDeSelected=(T=y._config||{}).onImageAreaDeSelected||"",x.__OnImageAreaSelected=T.onImageAreaSelected||"",x.__OnMouseClick=T.onMouseClick||"",x.__OnMouseDoubleClick=T.onMouseDoubleClick||"",x.__OnMouseMove=T.onMouseMove||"",x.__OnMouseRightClick=T.onMouseRightClick||"",x.__OnTopImageInTheViewChanged=T.onTopImageInTheViewChanged||"",x.__OnBufferChanged=T.onBufferChanged||"",y.__OnMouseClick=A.onMouseClick||"",y.__OnThumbnailMouseClick="",y.__OnKeyDown=A.onKeyDown||"",y.__OnMouseWheel=A.onMouseWheel||"",y.__OnMouseDoubleClick=A.onMouseDoubleClick||"",y.__OnMouseRightClick=A.onMouseRightClick||"",y.__OnMouseMove=A.onMouseMove||"",y.__OnImageAreaSelected=A.onImageAreaSelected||"",y.__OnImageAreaDeSelected=A.onImageAreaDeSelected||"",y.__OnRefreshUI=A.onRefreshUI||"",y.__OnBufferChanged=A.onBufferChanged||"",y.__MouseX=0,y.__MouseY=0,y.__style=new E$e(y),y.__fSelectionRectAspectRatio=0)}function wP(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function XS(y,C,x){return C.has(y),x}var zhe=new WeakSet,D$e=new WeakSet,X9=new WeakSet,$9=new WeakSet,A$e=function(y){function C(G){var q,se,ce;return l(this,C),ce=[G],se=qn(se=C),wP(q=$a(this,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(ve){return!1}}()?Reflect.construct(se,ce||[],qn(this).constructor):se.apply(this,ce)),$9),wP(q,X9),wP(q,D$e),wP(q,zhe),q}return qa(C,y),g(C,[{key:"_getWSContextData",value:function(){return{document:this._getCurrentDocumentName(),tag:this._getCurrentDefaultTagName(),bNeedClearTag:!1}}},{key:"_getErrorString",value:function(){var G=this;return-2207==G._errorCode&&G._bMustUpgradeService&&H1(G),0!=G._errorCode?G._errorString:"Successful."}},{key:"_getWebTwainId",value:function(){return this._id}},{key:"_isTwainServiceType",value:function(){return!0}},{key:"_isPC",value:function(){return de.bWin||de.bMac||de.bLinux}},{key:"_serviceSyncMethodNotSupport",value:function(G){var q=this;return wt(q,-2605,'The synchronized method "'+G+'" is not supported under the current settings.'),{code:q._errorCode,message:q._getErrorString()}}},{key:"_serviceAsyncMethodNotSupport",value:function(G){var q=this;return wt(q,-2606,'The asynchronized method "'+G+'" is not supported under the current settings.'),{code:q._errorCode,message:q._getErrorString()}}},{key:"_serviceNotSupportAsync",value:function(G){var q=this;return wt(q,-2397,G+" doesn't work under current settings."),ft.Promise.reject({code:q._errorCode,message:q._getErrorString()})}},{key:"_nouiNotSupport",value:function(G,q){return wt(this,-2210,"You cannot call this method on this WebTwain instance because it does not use the default viewer."),U.isFunction(q)&&q(this._errorCode,this._getErrorString()),!1}},{key:"_innerFunRaw",value:function(G,q,re,se,ce,ve,Te){var Ue,je,Ee,Oe,He=this,we="f/",ue=re;if(ue&&(we="fa/"),Ce.DWT.ConnectWithSocket)this._sendData(G,q,!1,ve,Te);else{if(He._resetErr(),!He._isValid())return!!ue&&void 0;var pe=Yl.isServerInvalid(He);if(ue&&pe)return He._waitForConnect().then(function(){return He._innerFunRaw(G,q,ue,se,ce,ve,Te)});if(!ue&&pe)return vle(He),!1;if(Ee={method:"POST",url:Ue=[He._httpUrl,we,G].join(""),data:je=b0(He._clientId,G,q,0,He._bScanForProxyRemote),async:ue,onSuccess:function(me,Se,We){var ze=!1;try{ze=U.isString(me)&&"text/json"===We.getResponseHeader("content-type")?U.parse(me):me}catch(Be){}ze?(yc(ze)?(He._errorCode=ze.exception,He._errorString=ze.description):He._resetErr(),Oe=ce?ze:ze.result):(F7(He),Oe=""),U.isFunction(ve)&&ve(Oe),ue&&(Oe=null)},onError:function(){EA(He),Oe="",!ge.page.bUnload&&U.isFunction(Te)&&Te()}},!ue&&se)de.bIE?(Ee.dataType="arraybuffer",Ee.onSuccess=function(me,Se,We){var ze,Be,$e,Ge=!1;if(We.responseHeadersString&&-1!=We.responseHeadersString.indexOf("text/json")&&(Ge=!0),ze=We.responseData,He._resetErr(),Oe=!1,ze&&(Be=new Uint8Array(ze),Ge?ze=String.fromCharCode.apply(null,Be):(Oe=new Blob([Be],{type:He._strHttpContentTypeFieldValue}),($e=new xP.ArrayBuffer).append(Be),Oe.md5=$e.end())),!ze||Ge){var _t,Ct=!1;if((_t=Ge?ze:We.responseText).length>0){if("{"==_t.charAt(0))try{Ct=U.parse(_t),Ge=!0}catch(Ut){U.log(_t)}Ge?yc(Ct)?(He._errorCode=Ct.exception,He._errorString=Ct.description,Oe=!1):Oe=!0:(Be=new Uint8Array(_t),Oe=new Blob([Be],{type:He._strHttpContentTypeFieldValue}),($e=new xP.ArrayBuffer).append(Be),Oe.md5=$e.end())}}U.isFunction(ve)&&ve(Oe)}):(ue||(Ee.dataType="text",Ee.contentType="text/plain; charset=x-user-defined",Ee.mimeType="text/plain; charset=x-user-defined"),Ee.onSuccess=function(me,Se,We){var ze,Be,$e;if(He._resetErr(),(Be=(ze=We.responseText).length)>0){var Ge,_t=!1;if("{"==ze.charAt(0))try{Ge=U.parse(ze),_t=!0}catch(Tn){U.log(ze)}if(_t)yc(Ge)?(He._errorCode=Ge.exception,He._errorString=Ge.description,Oe=!1):Oe=!0;else{$e=new Uint8Array(Be);for(var Ct=0;Ct<Be;Ct++)$e[Ct]=ze.charCodeAt(Ct);Oe=new Blob([$e],{type:He._strHttpContentTypeFieldValue});var Ut=new xP.ArrayBuffer;Ut.append($e),Oe.md5=Ut.end()}}else Oe="";U.isFunction(ve)&&ve(Oe)});else if(ue&&se){Ee={method:"POST",body:je},de.bIE?Ee.dataType="arraybuffer":Ee.fetchRaw=!0;var ye=X1(Ue,Ee);return de.bIE||(ye=ye.then(function(me){var Se=me.headers.get("content-type");return Se.indexOf("image/")>=0||Se.indexOf("application/octet-stream")>=0?me.arrayBuffer():me.json()})),ye=ye.then(function(me){if(He._resetErr(),Bp(me))return U.isFunction(ve)&&ve(me),void(me=null);if(U.isObject(me)){var Se=me;if(yc(Se))He._errorCode=Se.exception,He._errorString=Se.description,U.isFunction(Te)&&Te();else{var We="";Se.result&&(We=Se.result),U.isFunction(ve)&&ve(We)}}else EA(He),!ge.page.bUnload&&U.isFunction(Te)&&Te()},function(me){EA(He),!ge.page.bUnload&&U.isFunction(Te)&&Te()}),!0}if(ue||U.mix(Ee,{headers:{"X-Requested-With":!1}}),de.bFileSystem&&(Ee.crossDomain=!1),ru(Ee),!ue)return Oe}}},{key:"_innerSendCmd",value:function(G,q){this._innerFunRaw(G,q,!0,!1,!0)}},{key:"_innerFun",value:function(G,q){var re;return re=this._innerFunRaw(G,q,!1,!1,!1),U.isArray(re)?re[0]:re}},{key:"__OnRecieveMsg",value:function(G,q){var re=this,se=null==q?void 0:q.cmd;if(G.event)return fa(qn(C.prototype),"__OnRecieveMsg",this).call(this,G,q);if(Ce.DWT.ConnectWithSocket)return fa(qn(C.prototype),"__OnRecieveMsg",this).call(this,G,q);if(yc(G)?(re._errorCode=G.exception,re._errorString=G.description):"StartScan"!=se&&"GetAddOnVersion"!=se&&(re._errorCode=0,re._errorString=""),"ReadBarcode"==se||"OCRRecognize"==se||G.request&&"OCRProRecognize"==G.request.method)return q.sFun?q.sFun(G):q.fFun&&q.fFun(G),!0;if("ActiveUI"==se||"VersionInfo"==se||"ConvertToBase64"==se||"SaveSelectedImagesToBase64Binary"==se||"ConvertToBlob"==se||"BeginSaveMem"==se)return q.sFun&&U.isArray(G.result)&&G.result.length>0?q.sFun(G.result):q.fFun&&q.fFun(G.result),!0;if("ShowFileDialog"==se||"SplitTiff"==se||"SplitPDF"==se||"EncodeAsBase64"==se||"ProductKey"==se||"GetSourceNames"==se||"GetSkewAngle"==se||"GetImageInfo"==se||"GetSkewAngleFromBinary"==se)return q.sFun?q.sFun(G.result):q.fFun&&q.fFun(G.result),!0;if("SetCapabilities"==se)return fa(qn(C.prototype),"__OnRecieveMsg",this).call(this,G,q);if(G.result&&G.result.length&&("1"==G.result[0]||1==G.result[0]||"ok"==G.result[0]))(q.sFun||q.sFun)&&q.sFun(q.rawData?G:G.result);else{if(!G.exception)return q.sFun&&q.sFun(G.result),G=null,!0;var ce=!1;q.fFun&&(ce=q.fFun(re._errorString)),!ce&&G.exception&&G.exception<0&&-2115!=G.exception&&U.isFunction(re.__OnPrintMsg)&&re.__OnPrintMsg(re._errorString)}return!0}},{key:"OnRefreshUI",value:function(G,q,re,se){return this._innerRefreshUI(G,q,re,se)}},{key:"GetCurrentDocumentName",value:function(){return this._resetErr(),!!this._isValid()&&this._getCurrentDocumentName()}},{key:"RegisterEvent",value:function(G,q){return!!this.registerEvent(G,q)}},{key:"UnregisterEvent",value:function(G,q){return this.unregisterEvent(G,q)}},{key:"onEvent",value:function(G,q){this.registerEvent(G,q)}},{key:"on",value:function(G,q){this.registerEvent(G,q)}},{key:"_OnConsumed",value:function(G){}},{key:"_OnPostLoad",value:function(G,q){var re,se,ce,ve,Te=this;void 0!==q&&void 0!==q.exception&&void 0!==q.description&&(Te._errorCode=q.exception,Te._errorString=q.description),U.log("OnPostLoad Results:"),se=G[1].split(","),re=U.base64.decode(se[0]),ce=U.base64.decode(se[1]),U.log(re),U.log(ce),U.log(se[2]),$he(Te,"On PostLoad"),(ve=Te._ImgManager.getCurrentImageIndex())>=0&&Te._innerRefreshUI(ve),U.isFunction(Te.__OnPostLoad)&&Te.__OnPostLoad(re,ce,se[2])}},{key:"_OnPostTransfer",value:function(G){var q=this;if(U.log("On PostTransfer Results:"+G),$he(q,"On PostTransfer"),U.isFunction(q.__OnPostTransfer))try{q.__OnPostTransfer()}catch(re){Fr(re)}}},{key:"_OnPreAllTransfersAsync",value:function(G){var q=this;if(U.isFunction(q.__OnPreAllTransfersAsync)){var re={event:"beforeAcquire",result:{}};try{U.isArray(G)&&G.length>1&&(re=U.parse(G[1]))}catch(se){}setTimeout(function(){try{q.__OnPreAllTransfersAsync(re)}catch(se){Fr(se)}},10)}}},{key:"_OnPostAllTransfers",value:function(G){var q=this;if(G.length>=2&&0==q._errorCode&&(q._errorCode=G[1],q._errorString=G[2]),U.log("On PostAllTransfers Results:"+G),q.__bLoadingImage=!1,q.__bAcquireImageNow=!1,q.__closeRemoteScanUI(!0),U.isFunction(q.__OnPostAllTransfers))try{q.__OnPostAllTransfers()}catch(re){Fr(re)}}},{key:"_OnResult",value:function(G){var q=G[1];if(U.isFunction(this.__OnResult))try{this.__OnResult(q)}catch(re){Fr(re)}}},{key:"_OnTransferCancelled",value:function(G){var q=this;if(q._ImgManager.getCurrentImageIndex(),q._ImgManager.count(),q.__bLoadingImage=!1,q.__bAcquireImageNow=!1,U.isFunction(q.__OnTransferCancelled))try{q.__OnTransferCancelled()}catch(re){Fr(re)}}},{key:"_OnTransferError",value:function(G){if(U.isFunction(this.__OnTransferError))try{this.__OnTransferError()}catch(q){Fr(q)}}},{key:"_OnSourceUIClose",value:function(G){var q=this;if(q.__closeRemoteScanUI(!0),U.isFunction(q.__OnSourceUIClose))try{q.__OnSourceUIClose()}catch(re){Fr(re)}}},{key:"_OnPreTransfer",value:function(G){if(U.isFunction(this.__OnPreTransfer))try{this.__OnPreTransfer()}catch(q){Fr(q)}}},{key:"_OnPreAllTransfers",value:function(G){if(U.isFunction(this.__OnPreAllTransfers))try{this.__OnPreAllTransfers()}catch(q){Fr(q)}}},{key:"_OnGetFilePath",value:function(G){var q,re,se;if(q=G[1].split(","),U.log("On GetFilePath Results:"+G),re=U.base64.decode(q[3]),se=U.base64.decode(q[4]),"-1032"==q[2]&&(q[2]="-1",re=se=""),U.isFunction(this.__OnGetFilePath))try{this.__OnGetFilePath(1*q[0]>0,1*q[1],1*q[2],re,se)}catch(ve){Fr(ve)}this.__bOpenFileNow=!1}},{key:"_OnDiskExceedLimit",value:function(){U.isFunction(this.__OnDiskExceedLimit)&&this.__OnDiskExceedLimit()}},{key:"__GetLoadEventsNum",value:function(){var G=0;return U.isFunction(this.__OnPostLoad)&&(G|=1),U.isFunction(this.__OnGetFilePath)&&(G|=2),G}},{key:"_innerSend",value:function(G,q,re,se,ce){if(Ce.DWT.ConnectWithSocket||"SaveSelectedImagesToBytes"!=G&&"ConvertToBlob"!=G)return this._sendData(G,q,re,se,ce);var Te=DS(),Ue=b0(this._clientId,G,q,Te,this._bScanForProxyRemote);return this._innerFunRaw(G,Ue,!0,!0,!0,se,ce),ft.Promise.resolve(!0)}},{key:"_convertToBlobByIndices",value:function(G,q,re,se,ce,ve){var Te=this,Ue=!1,je=function(He){U.isFunction(ve)&&ha(ve,Te,He,q,se),He=null};if(U.isFunction(ce)&&(Ue=!0),Te._resetErr(),!Te._isValid())return je(G),!!Ue&&void 0;var Ee=parseInt(q);if(!pn.checkProductKey(Te,{Core:!0})||!Te._checkIndices(G))return je(G),!!Ue&&void 0;if(Ee==Ce.DWT.EnumDWT_ImageType.IT_BMP||Ee==Ce.DWT.EnumDWT_ImageType.IT_JPG||Ee==Ce.DWT.EnumDWT_ImageType.IT_PNG||Ee==Ce.DWT.EnumDWT_ImageType.IT_J2K){if(G.length>1)return wt(Te,-2372,"You cannot convert more than one image to binary when the format is BMP, JPG or PNG."),je(G),!!Ue&&void 0}else if(Ee!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&Ee!=Ce.DWT.EnumDWT_ImageType.IT_PDF)return Gl(Te),je(G),!!Ue&&void 0;var Oe=_m(Te,G);return 0==Oe.length?(Jn(Te),je(G),!!Ue&&void 0):Ue?(ge.cancelFrom=Zn.ConvertToBlob,void Te._innerConvertToBlobWithUI("ConvertToBlob",Ee,Oe,re,function(He,we){U.isFunction(ce)&&bs(ce,He,we,q,se),He=we=null},je)):XS(Te,zhe,P$e).call(Te,Oe,Ee,re)}},{key:"_getDefaultDevice",value:function(){var G=this;if(G._resetErr(),!G._isValid())return null;var q="",re=Zt.TWAINSCANNER,se=G._innerFun("GetDefaultSourceName");if(se.length>0)try{var ce=JSON.parse(se);re=ce.type,q=U.base64.decode(ce.ProductName)}catch(Te){q=""}var ve=new od;return ve.name=q,ve.deviceType=re,ve.isSystemDefaultPrinter=!1,ve.displayName=re==Zt.TWAINX64SCANNER&&q.length>0?"Twain64-"+q:re==Zt.WIASCANNER&&q.length>0?"WIA-"+q:re==Zt.ESCLSCANNER&&q.length>0?"ESCL-"+q:re==Zt.ICASCANNER&&G.__serverPlatform==Rn.enumMac&&q.length>0?"ICA-"+q:q,ve}},{key:"_getDefaultDeviceAsync",value:(Y=yt(W.mark(function G(){var q,re,se,ce,ve,Te;return W.wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:if((q=this)._resetErr(),q._isValid()){Ue.next=4;break}return Ue.abrupt("return",null);case 4:return re="",se=Zt.TWAINSCANNER,Ue.next=8,q._sendDataByHttpAsync("GetDefaultSourceName");case 8:if((ce=Ue.sent).length>0)try{ve=JSON.parse(ce),se=ve.type,re=U.base64.decode(ve.ProductName)}catch(je){re=""}return(Te=new od).name=re,Te.deviceType=se,Te.isSystemDefaultPrinter=!1,Te.displayName=se==Zt.TWAINX64SCANNER&&re.length>0?"Twain64-"+re:se==Zt.ICASCANNER&&q.__serverPlatform==Rn.enumMac&&re.length>0?"ICA-"+re:re,Ue.abrupt("return",Te);case 16:case"end":return Ue.stop()}},G,this)})),function(){return Y.apply(this,arguments)})},{key:"_getSources",value:function(G,q,re){return Hce(this,this._innerFun("GetSources",It(G,null!=q&&q,null!=re&&re)))}},{key:"_getSourceCountAsync",value:(H=yt(W.mark(function G(q){var re,se,ce,ve,Te,Ue,je;return W.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if((re=this)._resetErr(),re._isValid()){Oe.next=4;break}return Oe.abrupt("return",ft.Promise.reject({code:re._errorCode,message:re._errorString}));case 4:return XS(re,X9,Yhe).call(re),Bo("GetSourceCountAsync",re),se=[],Oe.prev=7,q&&(re._driverType=q),ce=vt,ve=vt,Te=vt,Ue=vt,re._bRemoteMode?re.__serverPlatform==Rn.enumWindow?Te=!0:re.__serverPlatform==Rn.enumLinux?ve=!0:re.__serverPlatform==Rn.enumMac?ce=!0:re.__serverPlatform==Rn.enumAndroid&&(Ue=!0):(ce=de.bMac,ve=de.bLinux,Te=de.bWin,Ue=de.bAndroid),je=$A(re._driverType,Te,ve,ce,Ue),Oe.next=15,this._getDevices(je,!0,void 0);case 15:se=Oe.sent,Oe.next=21;break;case 18:throw Oe.prev=18,Oe.t0=Oe.catch(7),Oe.t0;case 21:return Oe.prev=21,Gr("GetSourceCountAsync"),Oe.finish(21);case 24:return Oe.abrupt("return",re._setDevices(se));case 25:case"end":return Oe.stop()}},G,this,[[7,18,21,24]])})),function(G){return H.apply(this,arguments)})},{key:"_setDevices",value:function(G){var q;return this.__devices=G,this.__sourceCount=q=G.length,q<=0?(this.__defaultSourceName="",this.__sourceCount=0,0):q}},{key:"_getSourceNameByIndex",value:function(G){return G<0||G>=this.__devices.length?"":this.__devices[G].displayName}},{key:"_dwtConvertToBlobSync",value:function(G,q,re,se,ce,ve){var Ue=re,je=",";U.isString(Ue)&&""!=Ue||(Ue="",je="");var Ee=["[",G,',"',q.join(","),'"',je,Ue,"]"].join(""),Oe=this._innerFunRaw("ConvertToBlob",Ee,!1,!0,!1),He="";if(0==this._errorCode){Oe&&"md5"in Oe&&(He=Oe.md5);var we=!0;return U.isFunction(se)&&(we=se(Oe,He,ve)),we}return U.isFunction(ce)&&nn(ce,this),!1}},{key:"_getSourceCountSync",value:function(){var G,q=this,re=vt,se=vt,ce=vt,ve=vt;if(q._bRemoteMode?q.__serverPlatform==Rn.enumWindow?ce=!0:q.__serverPlatform==Rn.enumLinux?se=!0:q.__serverPlatform==Rn.enumMac?re=!0:q.__serverPlatform==Rn.enumAndroid&&(ve=!0):(re=de.bMac,se=de.bLinux,ce=de.bWin,ve=de.bAndroid),G=$A(this._driverType,ce,se,re,ve),q._resetErr(),!q._isValid()||!pn.checkProductKey(q,{Core:!0}))return 0;XS(q,X9,Yhe).call(q);var Ue=q._getSources(G,!0,void 0);return q._setDevices(Ue)}},{key:"_OnActiveUI",value:(B=yt(W.mark(function G(q){var re;return W.wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return re=this,q&&q.length>2&&(re.__strProductName=q[2]),se.next=4,fa(qn(C.prototype),"_OnActiveUI",this).call(this,q);case 4:return se.next=6,re._setConvertModeAsync(re._pdfConvertMode).catch(function(){});case 6:case"end":return se.stop()}},G,this)})),function(G){return B.apply(this,arguments)})},{key:"_OnReady",value:(M=yt(W.mark(function G(){var q,se,ce,ve;return W.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return mc((q=this)._serverInfo.server)&&(sd.item("DWT_port",q._serverInfo.port),sd.item("DWT_ssl",q._serverInfo.ssl?"true":"false")),q._bNoMask||Bo("OnReady",q),Te.prev=3,Te.next=6,fa(qn(C.prototype),"_OnReady",this).call(this);case 6:if(!Xa()){Te.next=12;break}if(q._uuidForActiveUI){Te.next=12;break}return Te.next=10,Ce.DWT.lgcuid(Ce.DWT.EnumInstance.dwt_desktop,"");case 10:q._uuidForActiveUI=Te.sent;case 12:return Te.next=14,q._innerActiveUI(q._uuidForActiveUI);case 14:return se=Te.sent,Te.next=17,q._OnActiveUI(se);case 17:if(lo("Changing Map..."),(ce=q._id)&&!Ce.DWT.WebTwainIdMap[ce]&&(Ce.DWT.WebTwainIdMap[ce]=q),Ghe(q),ve=!1,q._bRemoteMode||(ve=ge.attachAddon(q)),Ce.DWT.IfDisableDefaultSettings){Te.next=29;break}return lo("Configuring the WebTwain instance..."),Te.next=27,R$e(q);case 27:Te.next=32;break;case 29:if(!ve){Te.next=32;break}return Te.next=32,new ft.Promise(function(Ue){setTimeout(Ue,300)});case 32:Te.next=39;break;case 34:throw Te.prev=34,Te.t0=Te.catch(3),Te.t0&&(q._errorCode=Te.t0.code,q._errorString=Te.t0.message),q.dispose(),Te.t0;case 39:return Te.prev=39,q._bNoMask||Gr("OnReady"),Te.finish(39);case 42:case"end":return Te.stop()}},G,this,[[3,34,39,42]])})),function(){return M.apply(this,arguments)})},{key:"_OnWSClose",value:function(G){fa(qn(C.prototype),"_OnWSClose",this).call(this,G),ge.detect.bOK=!1,this.__bAcquireImageNow=!1}},{key:"_OnWSTimeout",value:function(G){fa(qn(C.prototype),"_OnWSTimeout",this).call(this,G),ge.detect.bOK=!1}},{key:"_setConvertModeAsync",value:function(G){var q,re=this,se=1*G;return isNaN(se)?(H7(re),ft.Promise.reject({code:re._errorCode,message:re._errorString})):re._checkConvertModeInner(se)?(q=this._mixSavedPdfReaderOptions({convertMode:se,renderOptions:{renderAnnotations:!!re._pdfOptions.renderOptions.renderAnnotations}}),re._resetPdfOptionsWhenSetConvertMode(q),XS(re,$9,Xhe).call(re,q,se)):ft.Promise.reject({code:re._errorCode,message:re._errorString})}},{key:"_OnReconnected",value:(D=yt(W.mark(function G(){var q;return W.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return q=this,re.next=3,XS(q,$9,Xhe).call(q,q._pdfOptions);case 3:case"end":return re.stop()}},G,this)})),function(){return D.apply(this,arguments)})},{key:"_getConvertMode",value:function(){return this._pdfConvertMode}},{key:"_setConvertMode",value:function(G){var q,re=this,se=1*G;if(isNaN(se))return H7(re),!1;if(!re._checkConvertModeInner(se))return!1;q=this._mixSavedPdfReaderOptions({convertMode:se,renderOptions:{renderAnnotations:!!re._pdfOptions.renderOptions.renderAnnotations}}),re._resetPdfOptionsWhenSetConvertMode(q);var ce=re._setReaderOptions(q,!1);return ce&&(re._pdfConvertMode=se,re._pdfOptions.convertMode=q.convertMode,re._pdfOptions.renderOptions.renderAnnotations=q.renderOptions.renderAnnotations,re._pdfOptions.convertMode==gr.CM_IMAGEONLY&&re._pdfConvertMode==gr.CM_RENDERALL||re._pdfOptions.convertMode==gr.CM_IMAGEONLY&&re._pdfConvertMode==gr.CM_RENDERALLWITHANNOTATION)?(re._pdfConvertMode=gr.CM_IMAGEONLY,G1(re),!1):ce}},{key:"_checkConvertModeInner",value:function(G){var q=this;return!(!pn.checkProductKey(q,{Core:!0})||(q._resetErr(),!q._isValid()||G!=gr.CM_RENDERALL&&G!=gr.CM_IMAGEONLY&&G!=gr.CM_AUTO&&G!=gr.CM_RENDERALLWITHANNOTATION&&(H7(q),1)))}},{key:"_resetPdfOptionsWhenSetConvertMode",value:function(G){var q=G.convertMode;G.convertMode=q==gr.CM_IMAGEONLY||pn.hasPDFRProductKey(this)?q:gr.CM_IMAGEONLY,G.convertMode==gr.CM_IMAGEONLY||G.convertMode==gr.CM_RENDERALL?G.renderOptions.renderAnnotations=!1:G.convertMode==gr.CM_RENDERALLWITHANNOTATION&&(G.renderOptions.renderAnnotations=!0)}},{key:"_checkPDFPasswordValue",value:function(G){if(!U.isUndefined(G)){if(!U.isString(G))return wt(this,-2852,"The password is not a string."),!1;if(G.length>32)return wt(this,-2851,"The password must not exceed 32 characters in length."),!1}return!0}},{key:"_mixSavedPdfReaderOptions",value:function(G){var q;return q=U.clone(this._pdfOptions),G||(G={}),G.convertMode&&(q.convertMode=G.convertMode),U.isString(G.password)?q.password=G.password:U.isNumber(G.password)&&(q.password=""+G.password),G.renderOptions&&(q.renderOptions=U.mix(this._pdfOptions.renderOptions,G.renderOptions)),q}},{key:"_setReaderOptions",value:function(G,q){var re,se,ce=this,ve=-1;if(ce._resetErr(),G&&G.renderOptions){var Te=G.renderOptions.resolution,Ue=G.renderOptions.maxWidth,je=G.renderOptions.maxHeight,Ee=G.renderOptions.renderGrayscale;if(!U.isUndefined(Te)&&(!Ce.Lib.isNumber(Te)||Te<=0))return wt(ce,-2830,"The PDF resolution must be a positive number."),!1;if(!U.isUndefined(Ue)&&(!Ce.Lib.isNumber(Ue)||Ue<0))return wt(ce,-2831,"The PDF max width must be a positive number."),!1;if(!U.isUndefined(je)&&(!Ce.Lib.isNumber(je)||je<0))return wt(ce,-2832,"The PDF max height must be a positive number."),!1;if(!U.isUndefined(Ee)&&!Ce.Lib.isBoolean(Ee))return function(pe){wt(pe,-2833,"The PDF render grayscale must be a boolean.")}(ce),!1}if(q){G||(G={}),(re={}).convertMode=G.convertMode?G.convertMode:gr.CM_AUTO,ve=re.convertMode,re.password=U.isString(G.password)?G.password:U.isNumber(G.password)?""+G.password:"",re.renderOptions=U.mix({renderAnnotations:!1,resolution:200,maxWidth:0,maxHeight:0,renderGrayscale:!1},G.renderOptions);var Oe=re.renderOptions.renderAnnotations;U.isBoolean(Oe)||U.isString(Oe)&&(re.renderOptions.renderAnnotations="true"==Oe.toLowerCase());var He=re.renderOptions.renderGrayscale;if(U.isBoolean(He)||U.isString(He)&&(re.renderOptions.renderGrayscale="true"==He.toLowerCase()),U.isNumber(re.convertMode)){if(!ce._checkConvertModeInner(re.convertMode))return!1;pn.hasPDFRProductKey(ce)||(re.convertMode=gr.CM_IMAGEONLY),re.convertMode==gr.CM_IMAGEONLY?re.renderOptions.renderAnnotations=!1:re.convertMode==gr.CM_RENDERALLWITHANNOTATION&&(re.renderOptions.renderAnnotations=!0)}}else{if(U.isUndefined(G))return function(pe){wt(pe,-2834,"The PDF reader options is invalid.")}(ce),!1;if(re=G,!U.isString(G.password)&&!U.isUndefined(G.password)){if(!U.isNumber(G.password))return function(pe){wt(pe,-2829,"The type of the PDF password must be a string.")}(ce),!1;G.password=""+G.password}}var we=ce._getPdfDllname();se=["[",U.stringify(re),',"',we,'"',"]"].join("");var ue=ce._innerFun("SetPDFReaderOptions",se);return ue&&q&&(ce._pdfOptions=U.clone(re),U.isNumber(re.convertMode)&&(re.convertMode==gr.CM_RENDERALL&&re.renderOptions.renderAnnotations&&(re.convertMode=gr.CM_RENDERALLWITHANNOTATION),ce._pdfConvertMode=re.convertMode,ce._pdfOptions.convertMode==gr.CM_IMAGEONLY&&ve==gr.CM_RENDERALL||ce._pdfOptions.convertMode==gr.CM_IMAGEONLY&&ve==gr.CM_RENDERALLWITHANNOTATION))?(ce._pdfConvertMode=gr.CM_IMAGEONLY,G1(ce),!1):ue}},{key:"_getPdfDllname",value:function(){var G=this,q=!1,re=!1;return G._bRemoteMode?G.__serverPlatform==Rn.enumWindow||(G.__serverPlatform==Rn.enumLinux?re=!0:G.__serverPlatform==Rn.enumMac&&(q=!0)):(q=de.bMac,re=de.bLinux),q?G._b64bit?"libDynamicPdfCorex64_"+su.PdfVersion+".dylib":"libDynamicPdfCore_"+su.PdfVersion+".dylib":re?"libDynamicPdfCore_"+su.PdfVersion+".so":G._b64bit?"DynamicPdfCorex64_"+su.PdfVersion+".dll":"DynamicPdfCore_"+su.PdfVersion+".dll"}},{key:"_unload_viewer",value:function(){}},{key:"__innerDeleteInMap",value:function(){return delete Ce.DWT.WebTwainIdMap[this._id],Lt}},{key:"__unload",value:(A=yt(W.mark(function G(){var q,re,se,ce;return W.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(q=this,re=U.clone(Ce.DWT.licenseException),q.__closeRemoteScanUI(!0),!q._destroy&&!q._destroying){ve.next=5;break}return ve.abrupt("return");case 5:if(q._destroying=!0,this.__innerDeleteInMap(),q.__addon&&q.__addon.Camera&&q.__addon.Camera._viewer&&(""!=q.__addon.Camera.getStatus()&&q.__addon.Camera.closeSource().catch(function(){}),q.__addon.Camera._viewer.dispose(),q.__addon.Camera._viewer=null),q._unload_viewer(),q._containerElement=null,q._ImgManager&&q._ImgManager.clear(),!q._bReady||ge.page.bUnload){ve.next=20;break}if(!q._wsClient){ve.next=20;break}return ve.prev=13,ve.next=16,q._innerDisposeWSClient();case 16:ve.next=20;break;case 18:ve.prev=18,ve.t0=ve.catch(13);case 20:if(!q._wsClient){ve.next=34;break}return q._wsClient.removeEvent("close",q._clientId),q._wsClient.removeEvent("error",q._clientId),q._wsClient.removeEvent("timeout",q._clientId),ve.prev=24,ve.next=27,q._wsClient.dispose();case 27:ve.next=32;break;case 29:ve.prev=29,ve.t1=ve.catch(24),se=ve.t1;case 32:delete q._wsClient,q._wsClient=null;case 34:if(q._bReady=!1,Ce.DWT.lremoveDWTObj(q),q.__bAcquireImageNow=!1,q._destroying=!1,q._destroy=!0,(ce=Ce.DWT.licenseException).code=re.code,ce.message=re.message,ce.fromLTS=re.fromLTS,!se){ve.next=45;break}throw se;case 45:case"end":return ve.stop()}},G,this,[[13,18],[24,29]])})),function(){return A.apply(this,arguments)})},{key:"_setIfShowUI",value:function(G){this._resetErr(),this._isValid()&&(U.isBoolean(G)?this._innerFun("IfShowUI",It(G)):da(self))}},{key:"_setIfShowFileDialog",value:function(G){this._resetErr(),this._isValid()&&(U.isBoolean(G)?this._innerFun("IfShowFileDialog",It(G)):da(self))}},{key:"_getDevicesAsync",value:(T=yt(W.mark(function G(q,re,se,ce){var ve,Te,Ue,je,Ee;return W.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if(ve=this,Te=[],!re||U.isNumber(re)){Oe.next=4;break}return Wi(ve),Oe.abrupt("return",ft.Promise.reject({code:ve._errorCode,message:ve._errorString}));case 4:if(Ue=ve._bRemoteMode?ES:de.bAndroid?xB:ES,je=null!=re?re:Ue,ve._resetErr(),ve._isValid()){Oe.next=8;break}return Oe.abrupt("return",ft.Promise.reject({code:ve._errorCode,message:ve._errorString}));case 8:return Bo(q,ve),Oe.prev=9,Oe.next=12,ve._getDevices(je,se,ce);case 12:U.isArray(Ee=Oe.sent)&&Ee.length>0&&(Te=Te.concat(Ee)),Oe.next=19;break;case 16:throw Oe.prev=16,Oe.t0=Oe.catch(9),Oe.t0;case 19:return Oe.prev=19,Gr(q),Oe.finish(19);case 22:return Te.length>0&&this._setDevices(Te),Oe.abrupt("return",Te);case 24:case"end":return Oe.stop()}},G,this,[[9,16,19,22]])})),function(G,q,re,se){return T.apply(this,arguments)})},{key:"_openSourceAsync",value:function(G){var q=this;return q._resetErr(),q._isValid()?(q._bRemoteMode&&q._initRemoteDiv(),q._innerFunV2("OpenSource").then(function(re){return q.__closeRemoteScanUI(!0),re},function(re){return q.__closeRemoteScanUI(!0),ft.Promise.reject(re)})):ft.Promise.reject({code:q._errorCode,message:q._errorString})}},{key:"_closeSourceAsync",value:function(G){var q=this;return q._resetErr(),q._isValid()?q._innerFunV2("CloseSource").then(function(){return q._curDevice=null,!0}):ft.Promise.reject({code:q._errorCode,message:q._errorString})}},{key:"_selectSourceAsync",value:function(G,q,re){var se=this;return se._resetErr(),se._isValid()?se._getDevicesAsync(G,q).then(function(ce){var ve,Te,Ue=document,je=ce?ce.length:0;ft.dialog.selectsourcedlg&&(ft.dialog.selectsourcedlg.close(),document.body.removeChild(ft.dialog.selectsourcedlg),ft.dialog.selectsourcedlg=!1);var Ee,Oe,He,we,ue=-1;for((Te=Ue.createElement("dialog")).className="dynamsoft-dialog-selectsource",de.bIE&&(Te.style.width="300px"),Te.setAttribute("closed","closed"),(Ee=[]).push('<ul id="dynamsoft-dialog-selectsource-sourcelist-ul">'),ve=0;ve<je;ve++){var pe="",ye=se._getSourceNameByIndex(ve);(""==se.__defaultSourceName&&0==ve||se.__defaultSourceName==ye)&&(pe=" dynamsoft-dialog-selectsource-sourcelist-li-selected",ue=ve),Ee.push('<li class="dynamsoft-dialog-selectsource-item'+pe+'" sourceindex='+ve+">"+ye+"</li>")}Ee.push("</ul>"),Ee=Ee.join(""),U.isArray(re)&&re.length>=3?(Oe=re[0],He=re[1],we=re[2]):(Oe="Select Source:",He="Select",we="Cancel");var me=["<p>",Oe,"</p>",'<div id="dynamsoft-dialog-selectsource-sourcelist">',Ee,"</div>",'<div><input type="button" value="',He,'" class="dynamsoft-dialog-selectsource-button-select">','<input type="button" value="',we,'" class="dynamsoft-dialog-selectsource-button-cancel"></div>'].join("");return Te.innerHTML=me,ft.dialog.selectsourcedlg=Te,Ue.body.appendChild(ft.dialog.selectsourcedlg),U.each(U.sizzle(".dynamsoft-dialog-selectsource-item"),function(Se,We){U.addEventListener(Se,"click",function(ze){for(var Be=ze.target,$e=Be.attributes.sourceindex.value,Ge=Be.parentElement.children,_t=0;_t<Ge.length;_t++)Ge[_t].className="dynamsoft-dialog-selectsource-item";Be.className="dynamsoft-dialog-selectsource-item dynamsoft-dialog-selectsource-sourcelist-li-selected",U.get("dynamsoft-dialog-selectsource-sourcelist-ul").setAttribute("selectedSourceIndex",$e)})}),U.get("dynamsoft-dialog-selectsource-sourcelist-ul").setAttribute("selectedSourceIndex",ue.toString()),ft.dialog.setup(ft.dialog.selectsourcedlg),ft.dialog.selectsourcedlg&&ft.dialog.selectsourcedlg.showModal(),new ft.Promise(function(Se,We){U.removeEventListener(ft.one(".dynamsoft-dialog-selectsource-button-select")[0],"click"),U.removeEventListener(ft.one(".dynamsoft-dialog-selectsource-button-cancel")[0],"click"),je>0&&U.addEventListener(ft.one(".dynamsoft-dialog-selectsource-button-select")[0],"click",function(){var ze=parseInt(U.get("dynamsoft-dialog-selectsource-sourcelist-ul").getAttribute("selectedSourceIndex"));ze<0||se._selectSourceByIndexAsync(G,ze).then(function(){ft.dialog.selectsourcedlg&&(ft.dialog.selectsourcedlg.close(),document.body.removeChild(ft.dialog.selectsourcedlg),ft.dialog.selectsourcedlg=!1),Se(ze)})}),U.addEventListener(ft.one(".dynamsoft-dialog-selectsource-button-cancel")[0],"click",function(){ft.dialog.selectsourcedlg&&(ft.dialog.selectsourcedlg.close(),document.body.removeChild(ft.dialog.selectsourcedlg),ft.dialog.selectsourcedlg=!1);var ze={};lu(ze),We({code:ze._errorCode,message:ze._errorString})})})}):ft.Promise.reject({code:se._errorCode,message:se._errorString})}},{key:"_dwtGetCapabilities",value:function(G,q,re){var se=this,ce=null,ve=function(){U.isFunction(re)&&re(se._errorCode,se._errorString)};if(G){if(!U.isArray(G))return Wi(se),void ve();if(0==G.length)return void(U.isFunction(q)&&q([]));if(!1===function(Te,Ue){var je,Ee,Oe,He;for(He=0;He<Ue.length;He++){if(Ee=!1,Oe=!1,U.isString(je=Ue[He])){var we=je;je=parseInt(je),(U.isNaN(je)||je!=we)&&(Ee=!0)}if(0==Ee&&U.isNumber(je)?(je<1||je>65535)&&(Oe=!0):Ee=!0,Ee)return Wi(Te),!1;if(Oe)return xVe(Te),!1}return!0}(se,G))return void ve();ce=It(G)}se._sendDataByHttpAsync("GetCapabilities",ce).then(function(Te){try{var Ue,je;Te.length>0&&(je=Te[0]),U.isString(je)?(je=ge.removeNonPrintableChar(je),je=U.replaceAll(je,"\\\\","\\\\"),0==(Ue=JSON.parse(je)).errorCode?U.isFunction(q)&&q(Ue.response):(se._errorCode=Ue.errorCode,se._errorString=Ue.errorString,ve())):(zl(se),ve())}catch(Ee){se._errorCode=-2302,se._errorString=Ee,ve()}},ve)}},{key:"_dwtSetCapabilities",value:function(G,q,re){if(!U.isObject(G)||U.isArray(G))return Wi(this),U.isFunction(re)&&re(this._errorCode,this._getErrorString()),!1;var ce=["[",U.stringify(G),"]"].join("");return this._innerSend("SetCapabilities",ce,0,function(ve){U.isFunction(q)&&q(ve)},re),!0}},{key:"_selectDeviceAsync",value:(w=yt(W.mark(function G(q,re,se){var ce,ve;return W.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return ce=this,Bo(q,this),Te.prev=2,Te.next=5,fa(qn(C.prototype),"_innerSelectDeviceAsync",this).call(this,re,se);case 5:(ve=Te.sent)&&(ce._curDevice=re,ce._bSelectedSourceByServer=!1),Te.next=12;break;case 9:throw Te.prev=9,Te.t0=Te.catch(2),Te.t0;case 12:return Te.prev=12,Gr(q),Te.finish(12);case 15:return Te.abrupt("return",ve);case 16:case"end":return Te.stop()}},G,this,[[2,9,12,15]])})),function(G,q,re){return w.apply(this,arguments)})},{key:"_selectSourceByIndexAsync",value:(x=yt(W.mark(function G(q,re){var se,ce;return W.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:if(ce=1*re,(se=this)._resetErr(),se._isValid()){Te.next=4;break}return Te.abrupt("return",ft.Promise.reject({code:se._errorCode,message:se._errorString}));case 4:if(!U.isNaN(ce)){Te.next=7;break}return Jn(se),Te.abrupt("return",ft.Promise.reject({code:se._errorCode,message:se._errorString}));case 7:if(se.__devices){Te.next=10;break}return Te.next=10,se._getDevicesAsync(q,null);case 10:if(!(ce<0||ce>=se.__devices.length)){Te.next=13;break}return kt(se),Te.abrupt("return",ft.Promise.reject({code:se._errorCode,message:se._errorString}));case 13:return Te.abrupt("return",se._selectDeviceAsync(q,se.__devices[ce]));case 15:case"end":return Te.stop()}},G,this)})),function(G,q){return x.apply(this,arguments)})},{key:"_removeAllImages",value:function(G){var q=this,re=!0;if(q._resetErr(),!q._isValid())return!1;var se,ce=[];for(se=q._getHowManyImagesInBuffer()-1;se>=0;se--){var ve=q._imageBufferWrapper.convertClientIndexToServerId(se);ve>-1&&ce.push(ve)}if(ce.length>0){if(q._OnBitmapChanged(["c1",ce.join(","),3,q._ImgManager.getCurrentImageIndex(),q._ImgManager.count()]),re=q._innerFunRaw("RemoveAllImages",It(ce.join(",")),!1,!1,!1,function(){},function(){}),U.isArray(re))return re[0]}else re=!0;return re}},{key:"_removeImage",value:function(G,q){var re,se=this,ce=parseInt(q);if(!ta(se,ce))return!1;var ve=se._ImgManager.convertClientIndexToServerId(ce);return-1==ve?(kt(se),!1):(((re=se._innerFun("RemoveImage",It(ve)))||-1033==se._errorCode)&&se._OnBitmapChanged(["c1",""+ve,3,se._ImgManager.getCurrentImageIndex(),se._ImgManager.count()]),re)}},{key:"__innerAcquireOrLoadImageAsync",value:function(G,q,re,se){var ce=this;return new ft.Promise(function(ve,Te){var Ue="LoadImage"==G||"LoadImageEx"==G||"GenerateURLForUploadData"==G,je=Ue||"LoadDibFromClipboard"==G;Ue?ge.showProgress(ce,G,!1):Bo(G,ce),ce._innerSend(G,q,!0,function(Ee){if(ce.__bLoadingImage=!1,ce.__bOpenFileNow=!1,ce.__closeRemoteScanUI(!0),Ue){if(ge.closeProgress(null,G),ce._isBindViewer()){var Oe=ce._ImgManager.getCurrentImageIndex();Oe>=0&&ce._innerRefreshUI(Oe)}}else Gr(G);je&&ce._canConsume()&&Ce.DWT.lcvrf(ce),U.isFunction(ve)&&ve(Ee)},function(Ee){Ue?ge.closeProgress(null,""):Gr(G),ce.__bLoadingImage=!1,ce.__bAcquireImageNow=!1,ce.__bOpenFileNow=!1,ce.__closeRemoteScanUI(!0);var Oe=ce._ImgManager.getCurrentImageIndex();Oe>=0&&ce._innerRefreshUI(Oe),Rle(ce._errorCode)&&G1(ce),U.isFunction(Te)&&Te({code:ce._errorCode,message:ce._getErrorString()}),Ue?ge.closeProgress(null,G):Gr(G),Ee&&U.error(Ee)})})}},{key:"_innerLoadImageFromBinary",value:function(G,q,re,se,ce,ve){var Te,Ue,je=this,Ee=q;if(!pn.checkProductKey(je,{Core:!0}))return U.isFunction(ve)&&ve(je._errorCode,je._getErrorString()),!1;if(!G||""==G)return _l(je),U.isFunction(ve)&&ve(je._errorCode,je._getErrorString()),!1;if(U.isString(G))return Wi(je),U.isFunction(ve)&&ve(je._errorCode,je._getErrorString()),!1;if(!(Ue=G instanceof Blob?G.size:Bp(G)?G.byteLength:G instanceof Array?G.length:G.size||G.byteLength||G.length)||""==Ue)return Wi(je),U.isFunction(ve)&&ve(je._errorCode,je._getErrorString()),!1;var He=G.currentFileName;He||(He=je._getCurrentDocumentName());var we,ue=G.currentTagName;if(ue||!U.isUndefined(G.bNeedClearCurrentTagName)&&G.bNeedClearCurrentTagName||(ue=je._getCurrentDefaultTagName()),G instanceof FileList){if(1==G.length)return G[0].currentFileName=He,G[0].currentTagName=ue,je._innerLoadImageFromBinary(G[0],Ee,re,ce,ve);if(G.length>1){var pe;for(U.asyncQueue.stop(),pe=0;pe<G.length;pe++)G[pe].currentFileName=He,G[pe].currentTagName=ue,U.asyncQueue.pushToDo(je,"_innerLoadImageFromBinary",pe==G.length-1?[G[pe],Ee,re,ce,ve]:[G[pe],Ee,re,null,ve]);return U.asyncQueue.start(),!0}return _l(je),U.isFunction(ve)&&ve(je._errorCode,je._getErrorString()),!1}if(window.ReadableStream&&G instanceof ReadableStream?Te=new Response(G):window.Response&&G instanceof Response&&(Te=G),Te)Te.arrayBuffer().then(function(Be){var $e;($e=new Blob([Be])).currentFileName=G.currentFileName,$e.currentTagName=G.currentTagName;var Ge=se,_t=0;re&&(_t=je.__GetLoadEventsNum()),je.__LoadImageFromBytesV1($e,-1,"",_t,Ge,ce,ve)});else{var ye=G;se&&Bp(ye)&&((ye=new Blob([G])).currentFileName=G.currentFileName,ye.currentTagName=G.currentTagName);var me=-1,Se=se,We=Ce.DWT.EnumDWT_ImageType;U.isString(ye.type)&&("application/pdf"==ye.type?me=We.IT_PDF:"image/png"==ye.type?me=We.IT_PNG:"image/jpeg"==ye.type||"image/jpg"==ye.type?me=We.IT_JPG:"image/bmp"==ye.type?me=We.IT_BMP:"image/tiff"==ye.type||"image/tif"==ye.type?me=We.IT_TIF:"image/jp2"==ye.type&&(me=We.IT_J2K));var ze=0;re&&(ze=je.__GetLoadEventsNum()),we=je.__LoadImageFromBytesV1(ye,me,"",ze,Se,ce,ve)}return!!se||we}},{key:"__LoadImageFromBytes",value:function(G,q,re,se,ce,ve,Te,Ue){var je=this.__LoadImageFromBytesV2(G,q,re,se,Te,Ue,!1,0,ce,ve);return se?je:0==this._errorCode}},{key:"__LoadImageFromBytesV1",value:function(G,q,re,se,ce,ve,Te){var Ue=this.__LoadImageFromBytesV2(G,q,re,ce,0,0,!1,se,ve,Te);return ce?Ue:0==this._errorCode}},{key:"_isMobileMode",value:function(){return!1}},{key:"ErrorCode",get:function(){return this._errorCode}},{key:"ErrorString",get:function(){return this._getErrorString()}},{key:"HowManyImagesInBuffer",get:function(){return this._getHowManyImagesInBuffer()}}]);var x,w,T,A,D,M,B,H,Y}(Vhe);function P$e(y,C,x){var w=this;return w._dwtConvertToBlobSync(C,y,x,function(T){if(!T||T.size<=0)return hle(w),!1;var A=w.__maxUploadImageSize;return T.size>A&&-1!=A?(ff(w),!1):T},function(T){return!1})}function Yhe(){this.__defaultSourceName="",this.__sourceCount=0}function Xhe(y,C){var x=this,w=x._getPdfDllname(),T=["[",U.stringify(y),',"',w,'"',"]"].join("");return x._innerFunV2("SetPDFReaderOptions",T).then(function(){if(U.isNumber(C)&&(x._pdfConvertMode=C),x._pdfOptions.convertMode=y.convertMode,x._pdfOptions.renderOptions.renderAnnotations=y.renderOptions.renderAnnotations,x._pdfOptions.convertMode==gr.CM_IMAGEONLY&&x._pdfConvertMode==gr.CM_RENDERALL||x._pdfOptions.convertMode==gr.CM_IMAGEONLY&&x._pdfConvertMode==gr.CM_RENDERALLWITHANNOTATION)throw x._pdfConvertMode=gr.CM_IMAGEONLY,G1(x),{code:x._errorCode,message:x._errorString};return!0})}var $he=function(y,C){if(Po.bDiscardBlankImage){var x=y._ImgManager.getCurrentImageIndex();y.IsBlankImage(x)&&y.RemoveImage(x);var w=["Blank Discard (",C,"): ",y.ErrorString].join("");U.isFunction(y.__OnPrintMsg)&&y.__OnPrintMsg(w)}};function R$e(y){return qhe.apply(this,arguments)}function qhe(){return(qhe=yt(W.mark(function y(C){var x,w,T,A;return W.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(x=C,!Ce.DWT.ConnectWithSocket){D.next=6;break}return D.next=4,new ft.Promise(function(M,B){x._sendData("IfDisableSourceAfterAcquire","[1]",!1,M,B)});case 4:D.next=8;break;case 6:return D.next=8,C._innerFunV2("IfDisableSourceAfterAcquire","[1]");case 8:w=Mi.TWAIN,T=!1,A=!1,x._bRemoteMode?x.__serverPlatform==Rn.enumWindow||(x.__serverPlatform==Rn.enumLinux?A=!0:x.__serverPlatform==Rn.enumMac&&(T=!0)):(T=de.bMac,A=de.bLinux),T?w=Mi.TWAIN_AND_ICA:A&&(w=Mi.SANE),C._driverType=w,C._bRemoteMode&&(C._setIfShowUI(!1),C._setIfShowFileDialog(!1));case 13:case"end":return D.stop()}},y)}))).apply(this,arguments)}function $S(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function pu(y,C,x){return C.has(y),x}var P0=new WeakSet,q9=new WeakSet,Khe=new WeakSet,K9=new WeakSet,J9=new WeakSet,k$e=function(y){function C(){var w,M,B,H;l(this,C);for(var T=arguments.length,A=new Array(T),D=0;D<T;D++)A[D]=arguments[D];return M=this,B=C,H=[].concat(A),B=qn(B),$S(w=$a(M,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Y){return!1}}()?Reflect.construct(B,H||[],qn(M).constructor):B.apply(M,H)),J9),$S(w,K9),$S(w,Khe),$S(w,q9),$S(w,P0),w}return qa(C,y),g(C,[{key:"SaveAsGIF",value:function(w,T,A,D){var M=this,B=!1;if(U.isFunction(A)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!(pn.checkProductKey(M,{Core:!0})||de.bWin&&pn.checkProductKey(M,{Webcam:!0},!0)))return pn.checkProductKey(M,{Core:!0},!1),U.isFunction(D)&&D(M._errorCode,M._getErrorString()),!!B&&void 0;var H,Y=zn.replaceLocalFilename(w);if(!ym(M,T,D))return!!B&&void 0;if(-1==(H=M._ImgManager.convertClientIndexToServerId(T)))return kt(M),U.isFunction(D)&&nn(D,M),!!B&&void 0;var G=M.__GetLoadEventsNum(),q=M.__innerSaveImage("SaveAsGIF",It(Y,H,G),A,D);return B?void 0:q}},{key:"SaveSelectedImagesToBase64Binary",value:function(w,T){var A=this,D=!1;if(U.isFunction(w)&&(D=!0),A._resetErr(),!A._isValid())return U.isFunction(T)&&nn(T,A),!!D&&void 0;if(!(pn.checkProductKey(A,{Core:!0})||de.bWin&&pn.checkProductKey(A,{Webcam:!0},!0)))return pn.checkProductKey(A,{Core:!0},!1),U.isFunction(T)&&T(A._errorCode,A._getErrorString()),!!D&&void 0;var M=eC(A);return 0==M.length?(ea(A),U.isFunction(T)&&nn(T,A),!!D&&void 0):D?void A._innerSend("SaveSelectedImagesToBase64Binary",It(M.join(",")),!0,w,T):A._innerFun("SaveSelectedImagesToBase64Binary",It(M.join(",")))}},{key:"ShowFileDialog",value:function(w,T,A,D,M,B,H,Y){var G=this;if(G._resetErr(),!G._isValid())return!1;var q,re=zn.replaceLocalFilename(M);return q=G.__GetLoadEventsNum(),G._innerSend("ShowFileDialog",It(w,T,A,D,re,B,H,Y,q),!0),!0}},{key:"FTPDownload",value:function(w,T,A,D){var M=this,B=!1;if(U.isFunction(A)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!w)return Wi(M),U.isFunction(D)&&nn(D,M),!!B&&void 0;var H=zn.getImageType(T);return pu(M,J9,Zhe).call(M,"FTPDownload",It(w,T),H,A,D)}},{key:"FTPDownloadEx",value:function(w,T,A,D,M){var B=this,H=!1;return U.isFunction(D)&&(H=!0),B._resetErr(),B._isValid()?w?pu(B,J9,Zhe).call(B,"FTPDownloadEx",It(w,T,A),A,D,M):(Wi(B),U.isFunction(M)&&nn(M,B),!!H&&void 0):(U.isFunction(M)&&nn(M,B),!!H&&void 0)}},{key:"FTPUpload",value:function(w,T,A,D,M){var B=this,H=!1;if(U.isFunction(D)&&(H=!0),B._resetErr(),!B._isValid())return U.isFunction(M)&&nn(M,B),!!H&&void 0;var Y=B._ImgManager.convertClientIndexToServerId(T);if(!ym(B,T,M))return!!H&&void 0;if(-1==Y)return kt(B),U.isFunction(M)&&nn(M,B),!!H&&void 0;var G=B.__innerFTPUpload("FTPUpload",It(w,Y,A),D,M);return H?void 0:G}},{key:"FTPUploadEx",value:function(w,T,A,D,M,B){var H,Y=this,G=!1;if(U.isFunction(M)&&(G=!0),Y._resetErr(),!Y._isValid())return U.isFunction(B)&&nn(B,Y),!!G&&void 0;if(!ym(Y,T,B))return!!G&&void 0;if(-1==(H=Y._ImgManager.convertClientIndexToServerId(T)))return kt(Y),U.isFunction(B)&&nn(B,Y),!!G&&void 0;var q=Y.__innerFTPUpload("FTPUploadEx",It(w,H,A,D),M,B);return G?void 0:q}},{key:"FTPUploadAllAsMultiPageTIFF",value:function(w,T,A,D){var M=this,B=!1;if(U.isFunction(A)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;var H=[];qA(M,H);var Y=M.__innerFTPUpload("FTPUploadAsMultiPageTIFF",It(w,T,H.join(",")),A,D);return B?void 0:Y}},{key:"FTPUploadAllAsPDF",value:function(w,T,A,D){var M=this,B=!1;if(U.isFunction(A)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;var H=[];qA(M,H);var Y=M.__innerFTPUpload("FTPUploadAsMultiPagePDF",It(w,T,H.join(",")),A,D);return B?void 0:Y}},{key:"FTPUploadAsMultiPagePDF",value:function(w,T,A,D){var M=this,B=!1;if(U.isFunction(A)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;var H=eC(M),Y=M.__innerFTPUpload("FTPUploadAsMultiPagePDF",It(w,T,H.join(",")),A,D);return B?void 0:Y}},{key:"FTPUploadAsMultiPageTIFF",value:function(w,T,A,D){var M=this,B=!1;if(U.isFunction(A)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;var H=eC(M),Y=M.__innerFTPUpload("FTPUploadAsMultiPageTIFF",It(w,T,H.join(",")),A,D);return B?void 0:Y}},{key:"HTTPDownloadDirectly",value:function(w,T,A,D,M){var B,H=this,Y=!1;if(U.isFunction(D)&&(Y=!0),H._resetErr(),!H._isValid()||!pn.checkProductKey(H,{Core:!0}))return U.isFunction(M)&&nn(M,H),!!Y&&void 0;var G,q,re=H._GetHttpHeadersAndClear(),se=zn.combineUrl(H,w,T);if(void 0===se)return _l(H),U.isFunction(M)&&nn(M,H),!!Y&&void 0;if(!A||""==A)return wt(H,-2309,"The LocalFile is empty in the name HTTPDownloadDirectly Function."),U.isFunction(M)&&nn(M,H),!!Y&&void 0;if(G=zn.getImageType(A),!pn.checkPDFProductKeyWhenNeeds(H,G))return U.isFunction(M)&&nn(M,H),!!Y&&void 0;ge.cancelFrom=Zn.HTTPDownload,q=zn.replaceLocalFilename(A),H.IfShowProgressBar?ge.showProgress(H,"HTTPDownloadDirectly",!1):ge.hideProgress();var ce=null===(B=ge.progressContext)||void 0===B?void 0:B.IfShowCancelDialogWhenImageTransfer,ve=function(){return H.IfShowProgressBar&&ge.closeProgress(null,"HTTPDownloadDirectly"),U.isFunction(D)&&D(),!0},Te=function(){return ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=ce),H.IfShowProgressBar&&ge.closeProgress(null,"HTTPDownloadDirectly"),U.isFunction(M)&&nn(M,H),!1};H._OnPercentDone([0,-1,Lr.Downloading,"http"]),ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=!0);var Ue=zn.loadHttpBlob(H,"get",se,Y,function(je){ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=ce),H._OnPercentDone([0,-1,Lr.Loading]);var Ee=H.__GetLoadEventsNum();return H.__LoadImageFromBytesV1(je,3,q,Ee,Y,ve,Te)},Te,function(je){var Ee=0===je.total?100:Math.round(100*je.loaded/je.total);[je.loaded," / ",je.total].join(""),Ee>=100&&je.loaded<je.total&&(Ee=99),H._OnPercentDone([0,Ee,"","http"])},re);return Y?void 0:!!Ue}},{key:"HTTPUploadThroughPostDirectly",value:function(w,T,A,D,M,B){var H=this,Y=!1,G=function(){U.isFunction(B)&&nn(B,H,H.__HTTPPostResponseString)};if(U.isFunction(M)&&(Y=!0),H._resetErr(),H.__HTTPPostResponseString="",!H._isValid())return G(),!!Y&&void 0;var q=zn.combineUrl(H,w,A);return T?w?H._innerUploadDirectly(q,T,D,this.IfShowProgressBar,!1,0,!0,!1,M,G):(O7(H),G(),!!Y&&void 0):(h0(H),G(),!!Y&&void 0)}},{key:"_innerUploadDirectly",value:function(w,T,A,D,M,B,H,Y,G,q){var re,se,ce=this,ve=ce._GetHttpHeadersAndClear(),Te="HTTPUploadThroughPostDirectly",Ue=!1;if(U.isFunction(G)&&(Ue=!0),void 0===w||!1===w||""===w)return _l(ce),U.isFunction(q)&&nn(q,ce),!!Ue&&void 0;if(!pn.checkProductKey(ce,{Core:!0}))return U.isFunction(q)&&nn(q,ce),!!Ue&&void 0;ge.cancelFrom=Zn.HTTPUpload;var je=function(Ee,Oe,He){return 0!=Ee&&Oe&&(ce._errorCode=Ee,ce._errorString=Oe),He&&(ce.__HTTPPostResponseString=He),ge.needShowTwiceShowDialog=!1,D&&ge.closeProgress(null,Te),U.isFunction(q)&&nn(q,ce),!1};return ge.needShowTwiceShowDialog=!0,D?ge.showProgress(ce,Te,!1):ge.hideProgress(),(re=zn.replaceLocalFilename(T))&&""!=re?Y&&Y.bCancel?(Y.st=2,lu(ce),je(ce._errorCode,ce._errorString),!!Ue&&void 0):(se=pu(ce,q9,Jhe).call(ce,re,Ue,M,function(Ee){if(ge.needShowTwiceShowDialog=!1,Y&&Y.bCancel)return Y.st=2,lu(ce),je(ce._errorCode,ce._errorString),!1;if(Ee&&(!D||D&&ge.dlgRef>0||0==Ue)){Ee instanceof File?Ee.fileName=A:Ee.name=A,D&&zp(ce.__IfShowCancelDialogWhenImageTransfer);var Oe=new xf,He=ce._createHttpUploaderConfig(),we=new fd;return ce.__remoteFilename&&""!=ce.__remoteFilename&&(we.remoteFilename=ce.__remoteFilename),He.objUploadStatus=Y,we.url=w,we.method=Te,we.content=Ee,Ee=null,we.contentType=ce._strHttpContentTypeFieldValue,we.headers=ve,we.bAsync=Ue,we.httpFormData=Tm(ce.httpFormFields),we.retry=B,we.bOnlyResponseEmptyIsOK=H,we.blockSize=ce._moduleSize,Oe.httpPostUpload(He,we,function(ue){return D&&ge.closeProgress(null,Te),U.isFunction(G)&&bs(G,ue),!0},je)}return h0(ce),je(ce._errorCode,ce._errorString),!1},je),Ue?void 0:!!se):(h0(ce),je(ce._errorCode,ce._errorString),!!Ue&&void 0)}},{key:"_innerUploadFilesDirectly",value:function(w,T,A,D,M,B,H,Y,G){var q,re=this,se=re._GetHttpHeadersAndClear(),ce="HTTPUploadThroughPostDirectly",ve=!1,Te=[];if(U.isFunction(Y)&&(ve=!0),!1===w||""===w)return _l(re),U.isFunction(G)&&G({code:re._errorCode,message:re._getErrorString(),files:T}),!1;if(!pn.checkProductKey(re,{Core:!0}))return U.isFunction(G)&&G({code:re._errorCode,message:re._getErrorString(),files:T}),!1;ge.cancelFrom=Zn.HTTPUpload;var Ue=function(He,we,ue){return 0!=He&&we&&(re._errorCode=He,re._errorString=we),ue&&(re.__HTTPPostResponseString=ue),ge.needShowTwiceShowDialog=!1,D&&ge.closeProgress(null,ce),U.isFunction(G)&&G({code:re._errorCode,message:re._errorString,response:ue,files:T}),!1};ge.needShowTwiceShowDialog=!0,D?ge.showProgress(re,ce,!1):ge.hideProgress(),U.each(T,function(He){var we=zn.replaceLocalFilename(He);if(!we||""==we)return h0(re),Ue(re._errorCode,re._errorString),!1;Te.push(we)});var je=[],Ee=Te.length,Oe=0;return U.each(Te,function(He,we){q=pu(re,q9,Jhe).call(re,He,ve,M,function(ue){if(ge.needShowTwiceShowDialog=!1,!ue||D&&!(D&&ge.dlgRef>0)&&0!=ve)return D&&ge.closeProgress(null,ce),L7(re),U.isFunction(Ue)&&Ue(re._errorCode,re._errorString),!1;var pe=Cc(A,we+1);if(ue instanceof File?ue.fileName=pe:ue.name=pe,je[we]=ue,ue=null,++Oe==Ee){D&&zp(re.__IfShowCancelDialogWhenImageTransfer);var ye=re._createHttpUploaderConfig(),me=new fd;re.__remoteFilename&&""!=re.__remoteFilename&&(me.remoteFilename=re.__remoteFilename),me.url=w,me.method=ce,me.content=je,je=null,me.contentType=re._strHttpContentTypeFieldValue,me.headers=se,me.bAsync=ve,me.httpFormData=Tm(re.httpFormFields),me.retry=B,me.bOnlyResponseEmptyIsOK=H,me.blockSize=re._moduleSize;var Se=Whe(ye,me,function(We){return D&&ge.closeProgress(null,ce),U.isFunction(Y)&&bs(Y,We),!0},function(We,ze,Be){return D&&ge.closeProgress(null,ce),U.isFunction(Ue)&&Ue(We,ze,Be),!1});return ve?void 0:Se}},function(){return D&&ge.closeProgress(null,ce),U.isFunction(Ue)&&Ue(),!1})}),ve?void 0:!!q}},{key:"_createHttpUploaderConfig",value:function(){var w=this,T=new Uhe;return T.IfShowProgressBar=w.IfShowProgressBar,T.IfShowCancelDialogWhenImageTransfer=w.__IfShowCancelDialogWhenImageTransfer,T.MaxUploadImageSize=w.MaxUploadImageSize,T.HTTPRequestswithCredentials=w.HTTPRequestswithCredentials,T.onPercent=function(A){w._OnPercentDone(A)},T.onHttpUploadStatus=function(A){U.isFunction(w.__OnHttpUploadStatus)&&w.__OnHttpUploadStatus(A)},T}},{key:"SetUploadSegment",value:function(w,T){var D,A=this;return A._resetErr(),!(!A._isValid()||(!U.isNumber(w)||w<0?(wt(A,-2367,"Invalid value for the parameter segmentUploadThreshold."),1):!U.isNumber(T)||T<=0?(D=A,wt(D,-2368,"Invalid value for the parameter moduleSize."),1):(A._segementUploadThreshold=1024*w*1024,A._moduleSize=1024*T,0)))}},{key:"ConvertToBase64",value:function(w,T,A,D){var M,B=this,H=arguments,Y=!1;if(U.isFunction(A)&&(Y=!0),B._resetErr(),!B._isValid())return U.isFunction(D)&&ha(D,B,w,T,H),!!Y&&void 0;var G=parseInt(T);if(!pn.checkProductKey(B,{Core:!0})||!B._checkIndices(w))return U.isFunction(D)&&ha(D,B,w,T,H),!!Y&&void 0;if(G==Ce.DWT.EnumDWT_ImageType.IT_BMP||G==Ce.DWT.EnumDWT_ImageType.IT_JPG||G==Ce.DWT.EnumDWT_ImageType.IT_PNG){if(w.length>1)return wt(B,-2361,"You cannot convert more than one image to base64 string when the format is BMP, JPG or PNG."),U.isFunction(D)&&ha(D,B,w,T,H),!!Y&&void 0}else if(G!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&G!=Ce.DWT.EnumDWT_ImageType.IT_PDF)return Gl(B),U.isFunction(D)&&ha(D,B,w,T,H),!!Y&&void 0;if(0==(M=_m(B,w)).length)return Jn(B),U.isFunction(D)&&ha(D,B,w,T,H),!!Y&&void 0;ge.cancelFrom=Zn.ConvertToBlob,B._convertToBase64ByServerIdsWithUI("ConvertToBase64",M,G,!1,3,function(q){var re=[];U.isArray(M)&&U.each(M,function(se){var ce=B._ImgManager.convertServerIdToClientIndex(se);ce>-1&&re.push(ce)}),U.isFunction(A)&&bs(A,q,re,T,H)},function(){var q=[];U.isArray(M)&&U.each(M,function(re){var se=B._ImgManager.convertServerIdToClientIndex(re);se>-1&&q.push(se)}),U.isFunction(D)&&ha(D,B,q,T,H)})}},{key:"ClearAllHTTPFormField",value:function(){var w=this;return w._resetErr(),!!w._isValid()&&(w.httpFormFields={},!0)}},{key:"SetHTTPFormField",value:function(w,T,A){var D=this;if(D._resetErr(),!D._isValid())return!1;var M=w;return U.isString(M)||(M=""+M),T instanceof Blob&&(T.name=A),D.httpFormFields[M]=T,!0}},{key:"HTTPDownloadThroughPost",value:function(w,T,A,D,M,B){var H,Y,G=this,q=G._GetHttpHeadersAndClear(),re=zn.combineUrl(G,w,T),se=!1;if(U.isFunction(D)&&(se=!0),void 0===re)return _l(G),U.isFunction(M)&&nn(M,G,""),!!se&&void 0;if(!pn.checkProductKey(G,{Core:!0})||!pn.checkPDFProductKeyWhenNeeds(G,A))return U.isFunction(M)&&nn(M,G,""),!!se&&void 0;ge.cancelFrom=Zn.HTTPDownload,G.IfShowProgressBar?ge.showProgress(G,"HttpDownloadThroughPost",!1):ge.hideProgress(),G._OnPercentDone([0,-1,Lr.Downloading,"http"]);var ce=null===(H=ge.progressContext)||void 0===H?void 0:H.IfShowCancelDialogWhenImageTransfer,ve=function(){return G.IfShowProgressBar&&ge.closeProgress(null,"HttpDownloadThroughPost"),U.isFunction(D)&&D(),!0},Te=function(){return ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=ce),G.IfShowProgressBar&&ge.closeProgress(null,"HttpDownloadThroughPost"),U.isFunction(M)&&nn(M,G,G.__HTTPPostResponseString),!1};return ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=!0),Y=zn.loadHttpBlob(G,"post",re,se,function(Ue){ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=ce),G._OnPercentDone([0,-1,Lr.Loading]);var je=A;je!=Ce.DWT.EnumDWT_ImageType.IT_BMP&&je!=Ce.DWT.EnumDWT_ImageType.IT_JPG&&je!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&je!=Ce.DWT.EnumDWT_ImageType.IT_PNG&&je!=Ce.DWT.EnumDWT_ImageType.IT_PDF&&je!=Ce.DWT.EnumDWT_ImageType.IT_J2K&&(je=-1);var Ee=G.__GetLoadEventsNum();return G.__LoadImageFromBytesV1(Ue,je,"",Ee,se,ve,Te)},Te,function(Ue){var je=0===Ue.total?100:Math.round(100*Ue.loaded/Ue.total);[Ue.loaded," / ",Ue.total].join(""),je>=100&&Ue.loaded<Ue.total&&(je=99),G._OnPercentDone([0,je,"","http"])},q),se?void 0:!!Y}},{key:"HTTPDownloadThroughGet",value:function(w,T,A,D,M){return this._innerHTTPDownloadThroughGet("HTTPDownload",w,T,A,D,M)}},{key:"HTTPUploadThroughPut",value:function(w,T,A,D,M){var B=zn.getImageType(A);return this.HTTPUploadThroughPutEx(w,T,A,B,D,M)}},{key:"HTTPUploadThroughPutEx",value:function(w,T,A,D,M,B){var H=this,Y=H._GetHttpHeadersAndClear(),G="HTTPUploadThroughPutEx",q=zn.combineUrl(H,w,A),re=!1,se=[],ce=!1,ve=this.IfShowProgressBar;if(U.isFunction(M)&&(re=!0),void 0===q)return _l(H),U.isFunction(B)&&ha(B,H,"",[T],A,D),!!re&&void 0;ge.cancelFrom=Zn.HTTPPut;var Te,Ue=function(){ge.needShowTwiceShowDialog=!1,ve&&ge.closeProgress(null,G),U.isFunction(B)&&ha(B,H,H.__HTTPPostResponseString,se,A,D)};switch(ge.needShowTwiceShowDialog=!0,ve?ge.showProgress(H,G,!1):ge.hideProgress(),T){case-1:for(var je=0;je<H._ImgManager.count();je++)se.push(je);break;case-2:se=H._ImgManager.getSelectedClientIndexArray();break;default:if(se.push(T),!(T>=0))return kt(H),Ue(),!!re&&void 0}if(""===w)return O7(H),Ue(),!!re&&void 0;var Ee=[];U.isArray(se)&&U.each(se,function(we){var ue=H._ImgManager.convertClientIndexToServerId(we);-1!=ue&&Ee.push(ue)}),H._OnPercentDone([0,-1,Lr.Encoding,"http"]);var He=function(we,ue,pe){if(Ce.DWT.IfAddMD5InUploadHeader&&ue&&""!=ue&&(Y["dwt-md5"]=ue),ge.needShowTwiceShowDialog=!1,we&&(!ve||ve&&ge.dlgRef>0||0==re)){var ye=H.__maxUploadImageSize;return we.size>ye&&-1!=ye?(ff(H),Ue(),!!re&&void 0):(Te=function(me){var Se=0===me.total?100:Math.round(100*me.loaded/me.total);[me.loaded," / ",me.total].join(""),Se>=100&&me.loaded<me.total&&(Se=99),H._OnPercentDone([0,Se,"","http"])},H._OnPercentDone([0,-1,Lr.Uploading,"http"]),ve&&zp(H.__IfShowCancelDialogWhenImageTransfer),ge.cancelFrom=Zn.HTTPPut,ce=zn.httpPutImage(H,q,we,re,function(me){if(me&&(H.__HTTPPostResponseString=me),ve&&ge.closeProgress(null,G),U.isFunction(M)){var Se=[];U.isArray(Ee)&&U.each(Ee,function(We){var ze=H._ImgManager.convertServerIdToClientIndex(We);ze>-1&&Se.push(ze)}),bs(M,H.__HTTPPostResponseString,Se,A,D)}return!0},Ue,Te),we=null,re?void 0:!!ce)}return we=null,ve&&ge.closeProgress(null,G),!!re&&void 0};if(!re)return H._dwtConvertToBlobSync(D,Ee,!1,He,Ue);H._convertToBlobForUpload(D,Ee,!1,4,He,Ue)}},{key:"HTTPUploadAllThroughPutAsMultiPageTIFF",value:function(w,T,A,D){return this.HTTPUploadThroughPutEx(w,-1,T,2,A,D)}},{key:"HTTPUploadThroughPutAsMultiPageTIFF",value:function(w,T,A,D){return this.HTTPUploadThroughPutEx(w,-2,T,2,A,D)}},{key:"HTTPUploadAllThroughPutAsPDF",value:function(w,T,A,D){return this.HTTPUploadThroughPutEx(w,-1,T,4,A,D)}},{key:"HTTPUploadThroughPutAsMultiPagePDF",value:function(w,T,A,D){return this.HTTPUploadThroughPutEx(w,-2,T,4,A,D)}},{key:"GetSelectedImagesSize",value:function(w){var T=this;if(T._resetErr(),!T._isValid())return!1;var A=eC(T);return T._innerFun("GetSelectedImagesSize",It(w,A.join(",")))}},{key:"SetHTTPHeader",value:function(w,T){var A=this;if(A._resetErr(),!A._isValid())return!1;var D,M,B=w;if(A.__httpHeaderMap||(A.__httpHeaderMap={}),!B||!U.isString(B))return U.isUndefined(B)?wt(A,-2356,"The header name cannot be undefined."):""===B?wt(A,-2354,"The header name cannot be empty."):null===B?wt(A,-2355,"The header name cannot be null."):function(H){wt(H,-2357,"The header name you entered is invalid.")}(A),!1;for(D=["if-none-match","if-range","range","accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],B=B.toLowerCase(),M=0;M<D.length;M++)if(D[M]==B)return gVe(A),!1;return U.isUndefined(T)||null===T||""===T?(w in A.__httpHeaderMap&&delete A.__httpHeaderMap[w],!0):(U.isNumber(T)&&(T=""+T),A.__httpHeaderMap[w]=T,!0)}},{key:"ConvertToBlob",value:function(w,T,A,D,M){var B=arguments;return this._convertToBlobByIndices(w,T,!1,B,A,D)}},{key:"_asyncUploadFilesCmd",value:function(w,T,A,D,M,B,H,Y,G,q,re,se){var ce=this,ve=parseInt(M),Te="HTTPUpload",Ue=w,je=[];ce.__HTTPPostResponseString="",ge.cancelFrom=Zn.HTTPUpload;var Ee=function(pe,ye,me){var Se=[];if(U.isArray(T)&&U.each(T,function(We){var ze=ce._ImgManager.convertServerIdToClientIndex(We);ze>-1&&Se.push(ze)}),0!=pe&&ye&&(ce._errorCode=pe,ce._errorString=ye),me&&(ce.__HTTPPostResponseString=me),ce._bServerPercentDone=!0,ge.needShowTwiceShowDialog=!1,Y&&ge.closeProgress(null,Te),je.slice(0),je=null,U.isFunction(se))try{se({code:ce._errorCode,message:ce._errorString,response:me,indices:Se})}catch(We){}};ge.needShowTwiceShowDialog=!0,Y?ge.showProgress(ce,Te,!1):ge.hideProgress();var Oe=T.length,He=0,we=0,ue="";ce._bServerPercentDone=!1,ce._OnPercentDone([0,-1,Lr.Encoding,"http"]),U.each(T,function(pe,ye){ce._convertToBlobForUpload(ve,[pe],H,4,function(me,Se,We){if(!me||me.size<=0)return ns(ce),Ee(ce._errorCode,ce._errorString);var ze=ce.__maxUploadImageSize;if(me.size>ze&&-1!=ze)return ff(ce),Ee(ce._errorCode,ce._errorString);var Be=Cc(B,ye+1);if(we=(He+1)/Oe*100,ue=[He+1,"/",Oe].join(""),ce._OnPercentDone([0,we,ue,"http",Be]),me.name=Be,je.push(me),++He>=Oe){Ce.DWT.IfAddMD5InUploadHeader&&Se&&""!=Se&&(A["dwt-md5"]=Se);var $e=ce._createHttpUploaderConfig(),Ge=new fd;ce.__remoteFilename&&""!=ce.__remoteFilename&&(Ge.remoteFilename=ce.__remoteFilename),Ge.url=Ue,Ge.method=Te,Ge.content=je,Ge.contentType=ce._strHttpContentTypeFieldValue,Ge.headers=A,Ge.httpFormData=D,Ge.retry=G,Ge.bOnlyResponseEmptyIsOK=q,Ge.blockSize=ce._moduleSize,Whe($e,Ge,function(_t){ce.__HTTPPostResponseString=$e.HTTPPostResponse,function(Ct){if(ce._bServerPercentDone=!0,ge.needShowTwiceShowDialog=!1,Y&&ge.closeProgress(null,Te),je.slice(0),je=null,U.isFunction(re)){var Ut=[];U.isArray(T)&&U.each(T,function(Tn){var mn=ce._ImgManager.convertServerIdToClientIndex(Tn);mn>-1&&Ut.push(mn)}),bs(re,Ct,Ut)}}(_t)},Ee)}me=null},Ee,[pe,ye])})}},{key:"_getVersionInfoAsync",value:function(){return xo.versionInfoFromServer?ft.Promise.resolve(xo.versionInfoFromServer):this._innerFunV2("VersionInfo")}},{key:"__innerLoadImage",value:function(w,T,A,D,M,B,H){var Y=this,G=!1;if((U.isFunction(B)||Ce.DWT.ConnectWithSocket)&&(G=!0),!pn.checkProductKey(Y,{Core:!0}))return U.isFunction(H)&&H({code:Y._errorCode,message:Y._getErrorString()}),!!G&&void 0;if(!pn.checkPDFProductKeyWhenNeeds(Y,A))return U.isFunction(H)&&H({code:Y._errorCode,message:Y._getErrorString()}),!!G&&void 0;if(G){if(Y._bRemoteMode&&Y._getIfShowFileDialog())return V7(Y),void(U.isFunction(H)&&H({code:Y._errorCode,message:Y._getErrorString()}));var q=Y.IfShowCancelDialogWhenImageTransfer;return Y.IfShowCancelDialogWhenImageTransfer=!1,void Y.__innerAcquireOrLoadImageAsync(w,T,D,!0).then(function(){Y.IfShowCancelDialogWhenImageTransfer=q,U.isFunction(B)&&B()},function(ce){Y.IfShowCancelDialogWhenImageTransfer=q,Y._errorCode=ce.code,Y._errorString=ce.message,U.isFunction(H)&&H(ce)})}if(Y._bRemoteMode&&Y._getIfShowFileDialog())return V7(Y),!1;var re=Y._getCurrentDocumentName(),se=Y._getCurrentDefaultTagName();return Y.__innerLoadImageFun(w,T,M,re,se)}},{key:"__innerLoadImageFun",value:function(w,T,A,D,M){var B,H=this,Y=!0;if(B=H._innerFunRaw(w,T,!1,!1,!0),H.__bOpenFileNow=!1,0!=H._errorCode)return!1;if(U.isArray(B.result)&&B.result.length>0){if(A){var G;if("FTPDownload"==w||"FTPDownloadEx"==w)G=JSON.stringify(B.result);else{var q=B.result[0];U.isObject(q)?G=q.imageInfos:-1!=q||"LoadImage"!=w&&"LoadImageEx"!=w&&"LoadImageFromBase64Binary"!=w&&"LoadDibFromClipboard"!=w||(Y=!1)}U.isString(G)&&H._handleOnBitmapChangedEvent({result:["c1",G]},{document:D,tag:M})}else{var re=B.result.join(",");H._OnBitmapChanged(["c1",re,1,H._ImgManager.getCurrentImageIndex(),H._ImgManager.count()],null,{document:D,tag:M})}if(Y)return H._canConsume()&&Ce.DWT.lcvrf(H),!0}return Rle(H._errorCode)&&G1(H),!1}},{key:"__innerSaveImage",value:function(w,T,A,D){var M,B=this,H=!1;if(U.isFunction(A)&&(H=!0),H&&B._OnPercentDone([0,-1,Lr.Encoding]),B._bRemoteMode||(Ce.DWT.IfAlwaysFocusOnPopupWindow?B._OnPageFocus(!0):B._OnPageBlur(!0)),0==H)return B._bRemoteMode?B._serviceSyncMethodNotSupport(w):this._innerFun(w,T);if(B._bRemoteMode&&B._getIfShowFileDialog())return V7(B),void(U.isFunction(D)&&D(B._errorCode,B._getErrorString()));var Y=null===(M=ge.progressContext)||void 0===M?void 0:M.IfShowCancelDialogWhenImageTransfer;B.IfShowProgressBar?ge.showProgress(B,w,!1):ge.hideProgress(),ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=!1),B._innerSend(w,T,!0,function(){ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=Y),ge.closeProgress(null,w),U.isFunction(A)&&A()},function(G){return ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=Y),U.isFunction(D)&&D(B._errorCode,B._getErrorString()),ge.closeProgress(null,w),G&&U.error(G),!1})}},{key:"__captureImage",value:function(w,T,A,D){var M=this.__GetLoadEventsNum();return this.__LoadImageFromBytesV2(w,T,"",!0,0,0,!0,M,A,D)}},{key:"_getIfShowFileDialog",value:function(){return this._resetErr(),this._isValid()?this._innerFun("IfShowFileDialog"):vt}},{key:"SaveAsBMP",value:function(w,T,A,D){var M=this,B=!1;if((U.isFunction(A)||de.bAndroid)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!(pn.checkProductKey(M,{Core:!0})||de.bWin&&pn.checkProductKey(M,{Webcam:!0},!0)))return pn.checkProductKey(M,{Core:!0},!1),U.isFunction(D)&&nn(D,M),!!B&&void 0;var H,Y=zn.replaceLocalFilename(w);if(!ym(M,T,D))return!!B&&void 0;if(de.bAndroid){if(0==M._ImgManager.count())return ea(M),void(U.isFunction(D)&&nn(D,M));var G=[];return G.push(T),void M._saveImages("SaveAsBMP",Y,G,Ti.IT_BMP).then(function(){U.isFunction(A)&&A()}).catch(function(se){U.isFunction(D)&&D(se.code,se.message)})}if(-1==(H=M._ImgManager.convertClientIndexToServerId(T)))return kt(M),U.isFunction(D)&&nn(D,M),!!B&&void 0;var q=M.__GetLoadEventsNum(),re=M.__innerSaveImage("SaveAsBMP",It(Y,H,q),A,D);return B?void 0:re}},{key:"SaveAsJPEG",value:function(w,T,A,D){var M=this,B=!1;if((U.isFunction(A)||de.bAndroid)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!(pn.checkProductKey(M,{Core:!0})||de.bWin&&pn.checkProductKey(M,{Webcam:!0},!0)))return pn.checkProductKey(M,{Core:!0},!1),U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!ym(M,T,D))return!!B&&void 0;var H,Y=zn.replaceLocalFilename(w);if(de.bAndroid){if(0==M._ImgManager.count())return ea(M),void(U.isFunction(D)&&nn(D,M));var G=[];return G.push(T),void M._saveImages("SaveAsJPEG",Y,G,Ti.IT_JPG).then(function(){U.isFunction(A)&&A()}).catch(function(se){U.isFunction(D)&&D(se.code,se.message)})}if(-1==(H=M._ImgManager.convertClientIndexToServerId(T)))return kt(M),U.isFunction(D)&&nn(D,M),!!B&&void 0;var q=M.__GetLoadEventsNum(),re=M.__innerSaveImage("SaveAsJPEG",It(Y,H,q),A,D);return B?void 0:re}},{key:"SaveAsPDF",value:function(w,T,A,D){var M=this,B=!1;if((U.isFunction(A)||de.bAndroid)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!(pn.checkProductKey(M,{Core:!0})||de.bWin&&pn.checkProductKey(M,{Webcam:!0},!0)))return pn.checkProductKey(M,{Core:!0},!1),U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!ym(M,T,D))return!!B&&void 0;var H,Y=zn.replaceLocalFilename(w);if(de.bAndroid){if(0==M._ImgManager.count())return ea(M),void(U.isFunction(D)&&nn(D,M));var G=[];return G.push(T),void M._saveImages("SaveAsPDF",Y,G,Ti.IT_PDF).then(function(){U.isFunction(A)&&A()}).catch(function(se){U.isFunction(D)&&D(se.code,se.message)})}if(-1==(H=M._ImgManager.convertClientIndexToServerId(T)))return kt(M),U.isFunction(D)&&nn(D,M),!!B&&void 0;var q=M.__GetLoadEventsNum(),re=M.__innerSaveImage("SaveAsPDF",It(Y,H,q),A,D);return B?void 0:re}},{key:"SaveAsPNG",value:function(w,T,A,D){var M=this,B=!1;if((U.isFunction(A)||de.bAndroid)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!(pn.checkProductKey(M,{Core:!0})||de.bWin&&pn.checkProductKey(M,{Webcam:!0},!0)))return pn.checkProductKey(M,{Core:!0},!1),U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!ym(M,T,D))return!!B&&void 0;var H,Y=zn.replaceLocalFilename(w);if(de.bAndroid){if(0==M._ImgManager.count())return ea(M),void(U.isFunction(D)&&nn(D,M));var G=[];return G.push(T),void M._saveImages("SaveAsPNG",Y,G,Ti.IT_PNG).then(function(){U.isFunction(A)&&A()}).catch(function(se){U.isFunction(D)&&D(se.code,se.message)})}if(-1==(H=M._ImgManager.convertClientIndexToServerId(T)))return kt(M),U.isFunction(D)&&nn(D,M),!!B&&void 0;var q=M.__GetLoadEventsNum(),re=M.__innerSaveImage("SaveAsPNG",It(Y,H,q),A,D);return B?void 0:re}},{key:"SaveAsTIFF",value:function(w,T,A,D){var M=this,B=!1;if((U.isFunction(A)||de.bAndroid)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!(pn.checkProductKey(M,{Core:!0})||de.bWin&&pn.checkProductKey(M,{Webcam:!0},!0)))return pn.checkProductKey(M,{Core:!0},!1),U.isFunction(D)&&nn(D,M),!!B&&void 0;if(!ym(M,T,D))return!!B&&void 0;var H,Y=zn.replaceLocalFilename(w);if(de.bAndroid){if(0==M._ImgManager.count())return ea(M),void(U.isFunction(D)&&nn(D,M));var G=[];return G.push(T),void M._saveImages("SaveAsTIFF",Y,G,Ti.IT_TIF).then(function(){U.isFunction(A)&&A()}).catch(function(se){U.isFunction(D)&&D(se.code,se.message)})}if(-1==(H=M._ImgManager.convertClientIndexToServerId(T)))return kt(M),U.isFunction(D)&&nn(D,M),!!B&&void 0;var q=M.__GetLoadEventsNum(),re=M.__innerSaveImage("SaveAsTIFF",It(Y,H,q),A,D);return B?void 0:re}},{key:"SaveSelectedImagesAsMultiPagePDF",value:function(w,T,A){var D=this,M=!1;if((U.isFunction(T)||de.bAndroid)&&(M=!0),D._resetErr(),!D._isValid())return U.isFunction(A)&&nn(A,D),!!M&&void 0;if(!(pn.checkProductKey(D,{Core:!0})||de.bWin&&pn.checkProductKey(D,{Webcam:!0},!0)))return pn.checkProductKey(D,{Core:!0},!1),U.isFunction(A)&&nn(A,D),!!M&&void 0;var B=zn.replaceLocalFilename(w);if(!de.bAndroid){var H=eC(D);if(0==H.length)return ea(D),U.isFunction(A)&&nn(A,D),!!M&&void 0;var Y=D.__GetLoadEventsNum(),G=D.__innerSaveImage("SaveSelectedImagesAsMultiPagePDF",It(B,H.join(","),Y),T,A);return M?void 0:G}if(0==D._ImgManager.count())return ea(D),void(U.isFunction(A)&&nn(A,D));var q=lue(D);D._saveImages("SaveSelectedImagesAsMultiPagePDF",B,q,Ti.IT_PDF).then(function(){U.isFunction(T)&&T()}).catch(function(re){U.isFunction(A)&&A(re.code,re.message)})}},{key:"SaveSelectedImagesAsMultiPageTIFF",value:function(w,T,A){var D=this,M=!1;if((U.isFunction(T)||de.bAndroid)&&(M=!0),D._resetErr(),!D._isValid())return U.isFunction(A)&&nn(A,D),!!M&&void 0;if(!(pn.checkProductKey(D,{Core:!0})||de.bWin&&pn.checkProductKey(D,{Webcam:!0},!0)))return pn.checkProductKey(D,{Core:!0},!1),U.isFunction(A)&&nn(A,D),!!M&&void 0;var B=zn.replaceLocalFilename(w);if(!de.bAndroid){var H=eC(D);if(0==H.length)return ea(D),U.isFunction(A)&&nn(A,D),!!M&&void 0;var Y=D.__GetLoadEventsNum(),G=D.__innerSaveImage("SaveSelectedImagesAsMultiPageTIFF",It(B,H.join(","),Y),T,A);return M?void 0:G}if(0==D._ImgManager.count())return ea(D),void(U.isFunction(A)&&nn(A,D));var q=lue(D);D._saveImages("SaveSelectedImagesAsMultiPageTIFF",B,q,Ti.IT_TIF).then(function(){U.isFunction(T)&&T()}).catch(function(re){U.isFunction(A)&&A(re.code,re.message)})}},{key:"SaveAllAsMultiPageTIFF",value:function(w,T,A){var D=this,M=!1;if((U.isFunction(T)||de.bAndroid)&&(M=!0),D._resetErr(),!D._isValid())return U.isFunction(A)&&nn(A,D),!!M&&void 0;if(!(pn.checkProductKey(D,{Core:!0})||de.bWin&&pn.checkProductKey(D,{Webcam:!0},!0)))return pn.checkProductKey(D,{Core:!0},!1),U.isFunction(A)&&nn(A,D),!!M&&void 0;if(!jB(D,A))return!!M&&void 0;var B=[],H=zn.replaceLocalFilename(w);if(!de.bAndroid){if(qA(D,B),0==B.length)return ea(D),U.isFunction(A)&&nn(A,D),!!M&&void 0;var Y=D.__GetLoadEventsNum(),G=D.__innerSaveImage("SaveSelectedImagesAsMultiPageTIFF",It(H,B.join(","),Y),T,A);return M?void 0:G}if(0==D._ImgManager.count())return ea(D),void(U.isFunction(A)&&nn(A,D));for(var q=[],re=0;re<this._ImgManager.count();re++)q.push(re);D._saveImages("SaveAllAsMultiPageTIFF",H,q,Ti.IT_TIF).then(function(){U.isFunction(T)&&T()}).catch(function(se){U.isFunction(A)&&A(se.code,se.message)})}},{key:"SaveAllAsPDF",value:function(w,T,A){var D=this,M=!1;if((U.isFunction(T)||de.bAndroid)&&(M=!0),D._resetErr(),!D._isValid())return U.isFunction(A)&&nn(A,D),!!M&&void 0;if(!(pn.checkProductKey(D,{Core:!0})||de.bWin&&pn.checkProductKey(D,{Webcam:!0},!0)))return pn.checkProductKey(D,{Core:!0},!1),U.isFunction(A)&&nn(A,D),!!M&&void 0;if(!jB(D,A))return!!M&&void 0;var B=[],H=zn.replaceLocalFilename(w);if(!de.bAndroid){if(qA(D,B),0==B.length)return ea(D),U.isFunction(A)&&nn(A,D),!!M&&void 0;var Y=D.__GetLoadEventsNum(),G=D.__innerSaveImage("SaveSelectedImagesAsMultiPagePDF",It(H,B.join(","),Y),T,A);return M?void 0:G}if(0==D._ImgManager.count())return ea(D),void(U.isFunction(A)&&nn(A,D));for(var q=[],re=0;re<this._ImgManager.count();re++)q.push(re);D._saveImages("SaveAllAsPDF",H,q,Ti.IT_PDF).then(function(){U.isFunction(T)&&T()}).catch(function(se){U.isFunction(A)&&A(se.code,se.message)})}},{key:"HTTPUpload",value:function(w,T,A,D,M,B,H){var Y=this,G=null!=M?M:"RemoteFile",q=Y._GetHttpHeadersAndClear(),re=B,se=H;if(Y._resetErr(),arguments.length<=3)this._innerFormFieldHTTPUpload(w,q,re=T,se=A);else if(U.isFunction(arguments[4])&&U.isFunction(arguments[5])&&(G="RemoteFile",re=arguments[4],arguments.length>5&&(se=arguments[5])),Y._isValid()){var ce,ve=arguments,Te=function(je){U.isFunction(se)&&ha(se,Y,Y.__HTTPPostResponseString,je,ve)};if(U.isUndefined(w)||""===w)return _l(Y),void(Te&&Te(T));if(!U.isString(w))return CS(Y),void(Te&&Te(T));if(Y._checkIndices(T)){var Ue=_m(Y,T);if(0==Ue.length)return Jn(Y),void(Te&&Te(T));if(U.isUndefined(A))return Gl(Y),void(Te&&Te(T));if(A==Ce.DWT.EnumDWT_ImageType.IT_BMP||A==Ce.DWT.EnumDWT_ImageType.IT_JPG||A==Ce.DWT.EnumDWT_ImageType.IT_PNG){if(Ue.length>1)return z1(Y),void Te(T)}else if(A!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&A!=Ce.DWT.EnumDWT_ImageType.IT_PDF)return Gl(Y),void Te(T);if(U.isUndefined(D)||D!=Ce.DWT.EnumDWT_UploadDataFormat.Binary&&D!=Ce.DWT.EnumDWT_UploadDataFormat.Base64)return ule(Y),void Te(T);ce={method:"HTTPUpload",url:w,serverIds:Ue,headers:q,formData:Tm(Y.httpFormFields),enumImageType:A,saveSetup:!1,dataFormat:D,fileName:G,retry:0,bOnlyResponseEmptyIsOK:!0,objUploadFileStatus:!1,asyncSuccessFunc:function(je,Ee){U.isFunction(re)&&bs(re,Y.__HTTPPostResponseString,Ee,ve)},asyncFailureFunc:Te},this._asyncUploadCmd(ce)}else Te&&Te(T)}else U.isFunction(se)&&nn(se,Y,"")}},{key:"_innerFormFieldHTTPUpload",value:function(w,T,A,D){var M,B=this,H="HTTPUpload",Y=w,G=B.IfShowProgressBar;if(B._isValid()){if(U.isUndefined(Y)||""===Y)return _l(B),void(U.isFunction(D)&&nn(D,B,""));if(!U.isString(Y))return CS(B),void(U.isFunction(D)&&nn(D,B,""));0!=Y.indexOf("http://")&&0!=Y.indexOf("https://")&&(Y=ge.detect.ssl?"https://"+Y:"http://"+Y),B.__HTTPPostResponseString="",ge.cancelFrom=Zn.HTTPUpload,M=function(se,ce,ve){0!=se&&ce&&(B._errorCode=se,B._errorString=ce),ve&&(B.__HTTPPostResponseString=ve),ge.needShowTwiceShowDialog=!1,ge.closeProgress(null,H),U.isFunction(D)&&nn(D,B,B.__HTTPPostResponseString)},G?ge.showProgress(B,H,!1):ge.hideProgress(),ge.needShowTwiceShowDialog=!0,B._OnPercentDone([0,-1,Lr.Uploading,"http"]);var q=B._createHttpUploaderConfig(),re=new fd;B.__remoteFilename&&""!=B.__remoteFilename&&(re.remoteFilename=B.__remoteFilename),re.url=Y,re.method=H,re.content=[],re.headers=T,re.httpFormData=Tm(B.httpFormFields),re.blockSize=B._moduleSize,(new xf).httpPostUpload(q,re,function(se){ge.needShowTwiceShowDialog=!1,ge.closeProgress(null,H),U.isFunction(A)&&bs(A,se,w,[w,A,D])},M)}else U.isFunction(D)&&nn(D,B,"")}},{key:"HTTPUploadThroughPost",value:function(w,T,A,D,M,B,H){var Y=this,G=!1;if(U.isFunction(M)&&(G=!0),Y._resetErr(),!Y._isValid())return!!G&&void 0;var q=zn.getImageType(D),re=arguments,se=!1,ce=function(ve){return U.isFunction(B)&&ha(B,Y,Y.__HTTPPostResponseString,ve,re),!1};return U.isString(D)&&""!=D?(M&&U.isFunction(M)&&(se=function(ve,Te){return bs(M,Y.__HTTPPostResponseString,Te,re),!0}),efe(Y,T,q,ce)?pu(Y,P0,mC).call(Y,w,T,A,D,q,se,ce,H):!!G&&void 0):(ns(Y),ce(),!!G&&void 0)}},{key:"HTTPUploadThroughPostEx",value:function(w,T,A,D,M,B,H,Y){var G=this,q=!1;if(U.isFunction(B)&&(q=!0),G._resetErr(),!G._isValid())return U.isFunction(H)&&ha(H,G,""),!!q&&void 0;var re=arguments,se=!1,ce=function(ve){U.isFunction(H)&&ha(H,G,G.__HTTPPostResponseString,ve,re)};return U.isString(D)&&""!=D?(B&&U.isFunction(B)&&(se=function(ve,Te){bs(B,G.__HTTPPostResponseString,Te,re)}),efe(G,T,M,ce)?pu(G,P0,mC).call(G,w,T,A,D,M,se,ce,Y):!!q&&void 0):(ns(G),ce(),!!q&&void 0)}},{key:"HTTPUploadAllThroughPostAsMultiPageTIFF",value:function(w,T,A,D,M,B){var H=this,Y=!1;if(U.isFunction(D)&&(Y=!0),H._resetErr(),!H._isValid())return U.isFunction(M)&&ha(M,H,""),!!Y&&void 0;var G=arguments,q=!1,re=function(se){U.isFunction(M)&&ha(M,H,H.__HTTPPostResponseString,se,G)};return U.isString(A)&&""!=A?(Y&&(q=function(se,ce){bs(D,H.__HTTPPostResponseString,ce,G)}),pu(H,P0,mC).call(H,w,-1,T,A,2,q,re,B)):(ns(H),re(),!!Y&&void 0)}},{key:"HTTPUploadAllThroughPostAsPDF",value:function(w,T,A,D,M,B){var H=this,Y=!1;if(U.isFunction(D)&&(Y=!0),H._resetErr(),!H._isValid())return U.isFunction(M)&&nn(M,H,""),!!Y&&void 0;var G=arguments,q=!1,re=function(se){return U.isFunction(M)&&ha(M,H,H.__HTTPPostResponseString,se,G),!1};return U.isString(A)&&""!=A?(Y&&(q=function(se,ce){bs(D,H.__HTTPPostResponseString,ce,G)}),pu(H,P0,mC).call(H,w,-1,T,A,4,q,re,B)):(ns(H),re())}},{key:"HTTPUploadThroughPostAsMultiPagePDF",value:function(w,T,A,D,M,B){var H=this,Y=!1;if(U.isFunction(D)&&(Y=!0),H._resetErr(),!H._isValid())return U.isFunction(M)&&nn(M,H,""),!!Y&&void 0;var G=arguments,q=!1,re=function(se){U.isFunction(M)&&ha(M,H,H.__HTTPPostResponseString,se,G)};return U.isString(A)&&""!=A?(Y&&(q=function(se,ce){bs(D,H.__HTTPPostResponseString,ce,G)}),pu(H,P0,mC).call(H,w,-2,T,A,4,q,re,B)):(ns(H),re(),!!Y&&void 0)}},{key:"HTTPUploadThroughPostAsMultiPageTIFF",value:function(w,T,A,D,M,B){var H=this,Y=!1;if(U.isFunction(D)&&(Y=!0),H._resetErr(),!H._isValid())return U.isFunction(M)&&nn(M,H,""),!!Y&&void 0;var G=arguments,q=!1,re=function(se){U.isFunction(M)&&ha(M,H,H.__HTTPPostResponseString,se,G)};return U.isString(A)&&""!=A?(Y&&(q=function(se,ce){bs(D,H.__HTTPPostResponseString,ce,G)}),pu(H,P0,mC).call(H,w,-2,T,A,2,q,re,B)):(ns(H),re(),!!Y&&void 0)}},{key:"_innerHTTPDownloadThroughGet",value:function(w,T,A,D,M,B){var H,Y,G=this,q=G._GetHttpHeadersAndClear(),re=G.IfShowProgressBar,se=zn.combineUrl(G,T,A),ce=!1;if(U.isFunction(M)&&(ce=!0),void 0===se)return _l(G),U.isFunction(B)&&nn(B,G),!!ce&&void 0;if(!pn.checkProductKey(G,{Core:!0})||!pn.checkPDFProductKeyWhenNeeds(G,D))return U.isFunction(B)&&nn(B,G),!!ce&&void 0;ge.cancelFrom=Zn.HTTPDownload;var ve=null===(H=ge.progressContext)||void 0===H?void 0:H.IfShowCancelDialogWhenImageTransfer,Te=G._getCurrentDocumentName(),Ue=G._getCurrentDefaultTagName();return U.log("_innerHTTPDownloadThroughGet.currentFileName:"+Te+", tag="+Ue),re&&ce?(G.__IfShowCancelDialogWhenImageTransfer&&(ge.progressContext.__cancelBeforObjectCreated=!0),ge.showProgress(G,w,G.__IfShowCancelDialogWhenImageTransfer)):ce&&ge.hideProgress(),G._OnPercentDone([0,-1,Lr.Downloading,"http"]),Y=zn.loadHttpBlob(G,"get",se,ce,function(je){ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=ve),re&&ce&&zp(!1),G._OnPercentDone([0,-1,Lr.Loading]);var Ee=D;Ee!=Ce.DWT.EnumDWT_ImageType.IT_BMP&&Ee!=Ce.DWT.EnumDWT_ImageType.IT_JPG&&Ee!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&Ee!=Ce.DWT.EnumDWT_ImageType.IT_PNG&&Ee!=Ce.DWT.EnumDWT_ImageType.IT_PDF&&Ee!=Ce.DWT.EnumDWT_ImageType.IT_J2K&&(Ee=-1),je.currentFileName=Te,je.currentTagName=Ue;var Oe=G.__GetLoadEventsNum();return G.__LoadImageFromBytesV1(je,Ee,"",Oe,ce,function(){return re&&ce&&ge.closeProgress(null,w),U.isFunction(M)&&M(),!0},function(){return re&&ce&&ge.closeProgress(null,w),U.isFunction(B)&&nn(B,G),!1})},function(){return ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=ve),re&&ce&&ge.closeProgress(null,w),U.isFunction(B)&&nn(B,G),!1},function(je){var Ee=0===je.total?100:Math.round(100*je.loaded/je.total);[je.loaded," / ",je.total].join(""),Ee>=100&&je.loaded<je.total&&(Ee=99),G._OnPercentDone([0,Ee,"","http"])},q),ce?void 0:!!Y}},{key:"LoadImage",value:function(w,T,A){var D=this,M=!1;if(U.isFunction(T)&&(M=!0),D._resetErr(),!D._isValid())return U.isFunction(A)&&nn(A,D),!!M&&void 0;var B,H,Y,G=zn.replaceLocalFilename(w),q=zn.getImageType(G);T&&U.isFunction(T)&&(H=function(ce){T()}),A&&U.isFunction(A)&&(Y=function(ce){A(ce.code,ce.message)}),B=D.__GetLoadEventsNum(),""==G&&(D.__bOpenFileNow=!0);var re=D._getCurrentDocumentName(),se=D._getCurrentDefaultTagName();return D.__innerLoadImage("LoadImage",It(G,B,1,re,se),q,!0,1,H,Y)}},{key:"LoadImageEx",value:function(w,T,A,D){var M=this,B=!1;if(U.isFunction(A)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;var H,Y,G,q=zn.replaceLocalFilename(w),re=T;if(A&&U.isFunction(A)&&(Y=function(Ue){A()}),D&&U.isFunction(D)&&(G=function(Ue){D(Ue.code,Ue.message)}),!de.bAndroid){re==Ce.DWT.EnumDWT_ImageType.IT_ALL&&(re=-1),H=M.__GetLoadEventsNum(),""==q&&(M.__bOpenFileNow=!0);var se=M._getCurrentDocumentName(),ce=M._getCurrentDefaultTagName();return M.__innerLoadImage("LoadImageEx",It(q,re,H,1,se,ce),re,!0,1,Y,G)}var ve=ft.one(".d-loadImage");if(0==ve.length){var Te=document.createElement("input");Te._stwain=M,Te.setAttribute("type","file"),Te.setAttribute("multiple","multiple"),Te.style="position:absolute;top:-2px;left:-2px;width:1px;height:1px;",Te.className="d-loadImage",Te.setAttribute("accept",T==Ce.DWT.EnumDWT_ImageType.IT_BMP?"image/bmp":T==Ce.DWT.EnumDWT_ImageType.IT_JPG?"image/jpeg":T==Ce.DWT.EnumDWT_ImageType.IT_TIF?"image/tiff":T==Ce.DWT.EnumDWT_ImageType.IT_PNG?"image/png":T==Ce.DWT.EnumDWT_ImageType.IT_PDF?".pdf":T==Ce.DWT.EnumDWT_ImageType.IT_J2K?".jp2,.j2k,.j2c":Po.bMobile?"image/jpeg,image/png,image/tiff,image/tif":"image/*,.pdf,.jp2,.j2k,.j2c"),Te.ondoubleclick=function(){this.files.length>0&&this._stwain.LoadImageFromBinary(this.files,Y,G),this.value="",this._stwain=null,Te&&Te.parentElement.removeChild(Te)},Te.onchange=function(){this.files.length>0&&this._stwain.LoadImageFromBinary(this.files,Y,G),this.value="",this._stwain=null,Te&&Te.parentElement.removeChild(Te)},document.body.appendChild(Te),Te.click()}else ve[0].setAttribute("accept",T==Ce.DWT.EnumDWT_ImageType.IT_BMP?"image/bmp":T==Ce.DWT.EnumDWT_ImageType.IT_JPG?"image/jpeg":T==Ce.DWT.EnumDWT_ImageType.IT_TIF?"image/tiff":T==Ce.DWT.EnumDWT_ImageType.IT_PNG?"image/png":T==Ce.DWT.EnumDWT_ImageType.IT_PDF?".pdf":T==Ce.DWT.EnumDWT_ImageType.IT_J2K?".jp2,.j2k,.j2c":Po.bMobile?"image/jpeg,image/png,image/tiff,image/tif":"image/*,.pdf,.jp2,.j2k,.j2c"),ve[0].value="",ve[0]._stwain=M,ve[0].click()}},{key:"HTTPDownload",value:function(w,T,A,D){var M=this,B=!1;if(U.isFunction(A)&&(B=!0),M._resetErr(),!M._isValid())return U.isFunction(D)&&nn(D,M),!!B&&void 0;var H=zn.getImageType(T);return M._innerHTTPDownloadThroughGet("HTTPDownload",w,T,H,A,D)}},{key:"HTTPDownloadEx",value:function(w,T,A,D,M){var B=this,H=!1;return U.isFunction(D)&&(H=!0),B._resetErr(),B._isValid()?B._innerHTTPDownloadThroughGet("HTTPDownloadEx",w,T,A,D,M):(U.isFunction(M)&&nn(M,B),!!H&&void 0)}},{key:"getFormateDate",value:function(){var w=new Date,T=w.getFullYear(),A=w.getMonth()+1,D=w.getDate(),M=w.getHours(),B=w.getMinutes(),H=w.getSeconds();return A<=9&&(A="0"+A),D<=9&&(D="0"+D),M<=9&&(M="0"+M),B<=9&&(B="0"+B),H<=9&&(H="0"+H),{currentTime_title:T+"-"+A+"-"+D+" "+M+":"+B+":"+H,currentTime_info:A+"/"+D+"/"+T+" "+M+":"+B+":"+H}}},{key:"__shareImagesInner",value:function(w,T,A,D){var M=navigator;M.canShare&&M.canShare({files:w})&&M.share({files:w,title:T,text:this.getFormateDate().currentTime_info}).then(function(){U.isFunction(A)&&A()}).catch(function(B){U.isFunction(D)&&D(B)})}},{key:"ShareImages",value:(x=yt(W.mark(function w(T,A,D){var M,B,H,Y,G,q,re,se,ce;return W.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(M=this,!de.bAndroid){ve.next=39;break}if(D!=Ti.IT_ALL&&D!=Ti.IT_MULTIPAGE_PDF&&D!=Ti.IT_MULTIPAGE_TIF){ve.next=5;break}throw Cle(M),{code:M._errorCode,message:M._errorString};case 5:if(!((B=A.sort(function(Te,Ue){return Te-Ue})).length>0)){ve.next=37;break}if(H="IMAGE File",D==Ti.IT_PDF&&(H="PDF File"),Y=bP(T,D),U.isUndefined(Y)&&(Y=T),D!=Ti.IT_PDF&&D!=Ti.IT_TIF){ve.next=15;break}return ve.abrupt("return",new ft.Promise(function(Te,Ue){M.ConvertToBlob(B,D,function(je,Ee,Oe){var He=[new File([je],Y,{type:je.type})];M.__shareImagesInner(He,H,function(){Te()},function(we){Ue({code:0!=we.code?we.code:2201,message:we.message})})},function(){Ue({code:M._errorCode,message:M._errorString})})}));case 15:G=[],q=Y,ve.t0=D,ve.next=ve.t0===Ti.IT_BMP?20:ve.t0===Ti.IT_JPG?22:ve.t0===Ti.IT_PNG?24:26;break;case 20:return re=".bmp",ve.abrupt("break",27);case 22:return re=".jpg",ve.abrupt("break",27);case 24:return re=".png",ve.abrupt("break",27);case 26:re=".jpg";case 27:Y&&Y.lastIndexOf(".")>0&&(q=Y.substring(0,Y.lastIndexOf(".")),re=Y.substring(Y.lastIndexOf("."),Y.length)),se=W.mark(function Te(Ue){return W.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:return je.next=2,new ft.Promise(function(Ee,Oe){M.ConvertToBlob([B[Ue]],D,function(He,we,ue){G.push(0==Ue?new File([He],q+re,{type:He.type}):new File([He],q+Ue+re,{type:He.type})),Ee()},function(){Oe({code:M._errorCode,message:M._errorString})})});case 2:case"end":return je.stop()}},Te)}),ce=0;case 31:if(!(ce<B.length)){ve.next=36;break}return ve.delegateYield(se(ce),"t1",33);case 33:ce++,ve.next=31;break;case 36:M.__shareImagesInner(G,H);case 37:ve.next=41;break;case 39:throw wt(M,-2617,"ShareImages is only supported on Android devices."),{code:M._errorCode,message:M._errorString};case 41:case"end":return ve.stop()}},w,this)})),function(w,T,A){return x.apply(this,arguments)})},{key:"Addon",get:function(){return this.__addon}},{key:"LoadDibFromClipboard",value:function(w,T){var A,D,H,M=this,B=!1;return U.isFunction(w)&&(B=!0),M._resetErr(),M._isValid()?M._bRemoteMode?(wt(M,-2609,"LoadDibFromClipboard is not supported when Object is created by CreateRemoteScanObjectAsync."),U.isFunction(T)&&nn(T,M),!!B&&void 0):(w&&U.isFunction(w)&&(A=function(Y){w()}),T&&U.isFunction(T)&&(D=function(Y){T(Y.code,Y.message)}),H=M.__GetLoadEventsNum(),M.__innerLoadImage("LoadDibFromClipboard",It(H,1),-1,!0,1,A,D)):(U.isFunction(T)&&nn(T,M),!!B&&void 0)}},{key:"__innerGetBarcodeResultAsyncFunction",value:function(w){var T=ge.NewBarcodeResult();return w&&(T._errorCode=w.exception,T._errorString=w.description,T._resultlist=w.result,T._Count=w.result.length),T}},{key:"__innerGetOCRResultAsyncFunction",value:function(w){var T=ge.NewOCRResult(this);return w&&(T._errorCode=w.exception,T._errorString=w.description,T._resultlist=w.result),T}},{key:"__innerFTPUpload",value:function(w,T,A,D){return ge.cancelFrom=Zn.FTPUpload,pu(this,K9,Qhe).call(this,w,T,!0,A,D)}},{key:"_GetHttpHeadersAndClear",value:function(){var w=this.__httpHeaderMap;return this.__httpHeaderMap={},w||(w={}),w}},{key:"_asyncUploadCmd",value:function(w){var T,A=this,D=w.url,M=w.asyncSuccessFunc,B=w.asyncFailureFunc,H=A.IfShowCancelDialogWhenImageTransfer,Y=null===(T=ge.progressContext)||void 0===T?void 0:T.IfShowCancelDialogWhenImageTransfer,G=w.method,q=w.serverIds,re=w.headers,se=w.formData,ce=w.enumImageType,ve=w.dataFormat,Te=w.fileName,Ue=w.saveSetup,je=w.retry,Ee=w.bOnlyResponseEmptyIsOK,Oe=w.objUploadFileStatus,He=function(we,ue,pe){A.IfShowCancelDialogWhenImageTransfer=H,ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=Y);var ye=[];if(U.isArray(q)&&U.each(q,function(me){var Se=A._ImgManager.convertServerIdToClientIndex(me);Se>-1&&ye.push(Se)}),0!=we&&ue&&(A._errorCode=we,A._errorString=ue),pe&&(A.__HTTPPostResponseString=pe),U.isFunction(B))try{B(ye)}catch(me){}return!1};return U.isNumber(je)&&je>0||(je=0),0!=A._errorCode?He(A._errorCode,A._errorString,A.__HTTPPostResponseString):(A.__HTTPPostResponseString="",A.IfShowCancelDialogWhenImageTransfer=!0,ge.progressContext.IfShowCancelDialogWhenImageTransfer=A.IfShowCancelDialogWhenImageTransfer,C._innerHTTPUpload(A,G,D,re,se,q,ce,ve,Te,Ue,je,Ee,Oe,function(we){if(A.IfShowCancelDialogWhenImageTransfer=H,ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=Y),U.isFunction(M)){var ue=[];U.isArray(q)&&U.each(q,function(pe){var ye=A._ImgManager.convertServerIdToClientIndex(pe);ye>-1&&ue.push(ye)});try{bs(M,we,ue)}catch(pe){}we=null}return!0},He))}}],[{key:"_innerHTTPUpload",value:function(w,T,A,D,M,B,H,Y,G,q,re,se,ce,ve,Te){var Ue=parseInt(H),je=parseInt(Y),Ee=G,Oe=A,He=w._segementUploadThreshold;if(U.isUndefined(H))return Gl(w),U.isFunction(Te)&&Te(w._errorCode,w._errorString,""),!1;w._resetErr(),ge.cancelFrom=Zn.HTTPUpload;var we,ue=function(ye,me,Se){return 0!=ye&&me&&(w._errorCode=ye,w._errorString=me),Se&&(w.__HTTPPostResponseString=Se),ge.needShowTwiceShowDialog=!1,w.IfShowProgressBar&&ge.closeProgress(null,T),U.isFunction(Te)&&Te(w._errorCode,w._errorString,w.__HTTPPostResponseString),!1},pe=w._createHttpUploaderConfig();if(pe.objUploadStatus=ce,Ee=bP(Ee,Ue),ge.needShowTwiceShowDialog=!0,w.IfShowProgressBar?(ge.showProgress(w,T,!1),ge.progressContext&&(ge.progressContext._onPercent=function(ye){var me=0;ye&&(me=Math.floor(ye.loaded/ye.total*100))>100&&(me=100),ge.progressBarOnPercentDone(-1,"Transferring...","",me,"")})):ge.hideProgress(),je==Ce.DWT.EnumDWT_UploadDataFormat.Binary){if(ce&&ce.bCancel)return ce.st=2,lu(w),ue(w._errorCode,w._errorString);w._OnPercentDone([0,-1,Lr.Encoding,"http"]),w._convertToBlobForUpload(Ue,B,q,4,function(ye,me,Se){if(we=function(_t){return ge.needShowTwiceShowDialog=!1,w.IfShowProgressBar&&ge.closeProgress(null,T),U.isFunction(ve)&&bs(ve,_t),!0},ce&&ce.bCancel)return ce.st=2,lu(w),ue(w._errorCode,w._errorString);if(!ye||ye.size<=0)return ns(w),ue(w._errorCode,w._errorString);var We=w.__maxUploadImageSize;if(ye.size>We&&-1!=We)return ff(w),ue(w._errorCode,w._errorString);if(0!=w._errorCode)return ue(w._errorCode,w._errorString);if(Ce.DWT.IfAddMD5InUploadHeader&&me&&""!=me&&(D["dwt-md5"]=me),He>0&&ye.size>He){w._OnPercentDone([0,-1,Lr.Uploading,"http",Ee]);var ze=new xf,Be=new fd;return w.__remoteFilename&&""!=w.__remoteFilename&&(Be.remoteFilename=w.__remoteFilename),Be.url=Oe,Be.method=T,Be.content=ye,ye=null,Be.contentType=w._strHttpContentTypeFieldValue,Be.headers=D,Be.fileName=Ee,Be.httpFormData=M,Be.retry=re,Be.bOnlyResponseEmptyIsOK=se,Be.blockSize=w._moduleSize,ze.httpPostUploadFragment(pe,Be,we,ue)}var $e=new xf,Ge=new fd;w.__remoteFilename&&""!=w.__remoteFilename&&(Ge.remoteFilename=w.__remoteFilename),Ge.url=Oe,Ge.method=T,Ge.content=ye,ye=null,Ge.contentType=w._strHttpContentTypeFieldValue,Ge.headers=D,Ge.fileName=Ee,Ge.httpFormData=M,Ge.retry=re,Ge.bOnlyResponseEmptyIsOK=se,Ge.blockSize=w._moduleSize,pe.objUploadStatus=ce,$e.httpPostUpload(pe,Ge,we,ue)},ue)}else je==Ce.DWT.EnumDWT_UploadDataFormat.Base64&&w._convertToBase64ByServerIdsWithUI(T,B,Ue,q,4,function(ye){var me;if(!ye||ye.getLength()<=0)return ns(w),ue(w._errorCode,w._errorString);if(we=function(){return ge.needShowTwiceShowDialog=!1,w.IfShowProgressBar&&ge.closeProgress(null,T),U.isFunction(ve)&&bs(ve,ye),!0},He>0&&ye.getLength()>He){me=ye.getMD5(),Ce.DWT.IfAddMD5InUploadHeader&&(D["dwt-md5"]=me),w._OnPercentDone([0,-1,Lr.Uploading,"http"]);var Se=new fd;w.__remoteFilename&&""!=w.__remoteFilename&&(Se.remoteFilename=w.__remoteFilename),Se.url=Oe,Se.method=T,Se.content=ye.getData(0,ye.getLength()),Se.headers=D,Se.fileName=Ee,Se.httpFormData=M,Se.retry=re,Se.bOnlyResponseEmptyIsOK=se,Se.blockSize=w._moduleSize,Se.offset=0,(new xf).httpPostUploadFragment(pe,Se,we,ue)}else{var We;if(me=ye.getMD5(),Ce.DWT.IfAddMD5InUploadHeader&&(D["dwt-md5"]=me),!(We=ye.getData(0,ye.getLength()))||""==We)return ns(w),ue(w._errorCode,w._errorString);var ze=new fd;w.__remoteFilename&&""!=w.__remoteFilename&&(ze.remoteFilename=w.__remoteFilename),ze.url=Oe,ze.method=T,ze.content=We,ze.headers=D,ze.fileName=Ee,ze.httpFormData=M,ze.retry=re,ze.bOnlyResponseEmptyIsOK=se,ze.blockSize=w._moduleSize,(new xf).httpPostUpload(pe,ze,we,ue)}},ue)}}]);var x}(A$e);function mC(y,C,x,w,T,A,D,M){var B,H,Y=this,G="HTTPUploadThroughPostEx",q=Y._GetHttpHeadersAndClear(),re=zn.combineUrl(Y,y,x),se=[],ce=function(Oe){U.isFunction(D)&&D(Oe)},Te=!1;if(U.isFunction(A)&&(Te=!0),Y.__HTTPPostResponseString="",U.isNumber(C)){if(C<-2)return kt(Y),ce(C),!!Te&&void 0}else if(!U.isArray(C))return kt(Y),ce(C),!!Te&&void 0;if(!U.isString(w)||""==w)return ns(Y),ce(),!!Te&&void 0;if(U.isUndefined(T))return Gl(Y),ce(C),!!Te&&void 0;if(T==Ce.DWT.EnumDWT_ImageType.IT_BMP||T==Ce.DWT.EnumDWT_ImageType.IT_JPG||T==Ce.DWT.EnumDWT_ImageType.IT_PNG||T==Ce.DWT.EnumDWT_ImageType.IT_J2K){if(-1==C&&Y._ImgManager.count()>1||U.isArray(C)&&C.length>1)return z1(Y),ce(C),!!Te&&void 0;U.isArray(C)?se.push(C[0]):se.push(-1==C?0:C)}else{if(T!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&T!=Ce.DWT.EnumDWT_ImageType.IT_PDF)return Gl(Y),ce(C),!!Te&&void 0;if(-1==C){if(0==Y._ImgManager.count())return ea(Y),ce(),!!Te&&void 0;for(H=0;H<Y._ImgManager.count();H++)se.push(H)}else if(-2==C)se=Y._ImgManager.getSelectedClientIndexArray();else if(U.isArray(C))for(H=0;H<C.length;H++)se.push(C[H]);else se.push(C)}if(""===y)return O7(Y),ce(se),!!Te&&void 0;if(U.isUndefined(re)||""===re)return _l(Y),ce(se),!!Te&&void 0;if(!U.isString(re))return CS(Y),ce(se),!!Te&&void 0;if(0!=re.indexOf("http://")&&0!=re.indexOf("https://")&&(re=ge.detect.ssl?"https://"+re:"http://"+re),!Y._checkIndices(se)&&-1!=se)return ce(se),!!Te&&void 0;var Ue=[];if(U.isArray(se)&&U.each(se,function(Oe){var He=Y._ImgManager.convertClientIndexToServerId(Oe);-1!=He&&Ue.push(He)}),Y._resetErr(),!Y._isValid())return ce(se),!!Te&&void 0;if(!Te){ge.cancelFrom=Zn.HTTPUpload;var je=this.IfShowProgressBar,Ee=function(Oe,He,we){return 0!=Oe&&He&&(Y._errorCode=Oe,Y._errorString=He),we&&(Y.__HTTPPostResponseString=we),ge.needShowTwiceShowDialog=!1,je&&ge.closeProgress(null,G),ce(se),!1};return ge.needShowTwiceShowDialog=!0,je?ge.showProgress(Y,G,!1):ge.hideProgress(),Y._OnPercentDone([0,-1,Lr.Encoding,"http"]),Y._dwtConvertToBlobSync(T,Ue,!1,function(Oe,He){if(ge.needShowTwiceShowDialog=!1,Oe){var we=Y.__maxUploadImageSize;if(Oe.size>we&&-1!=we)return ff(Y),Ee(Y._errorCode,Y._errorString),!1;Ce.DWT.IfAddMD5InUploadHeader&&He&&""!=He&&(q["dwt-md5"]=He),Oe instanceof File?Oe.fileName=w:Oe.name=w,je&&zp(Y.__IfShowCancelDialogWhenImageTransfer);var ue=Y._createHttpUploaderConfig(),pe=new fd;return Y.__remoteFilename&&""!=Y.__remoteFilename&&(pe.remoteFilename=Y.__remoteFilename),pe.url=re,pe.method=G,pe.content=Oe,pe.contentType=Y._strHttpContentTypeFieldValue,pe.headers=q,pe.bAsync=!1,pe.httpFormData=Tm(Y.httpFormFields),pe.blockSize=Y._moduleSize,(new xf).httpPostUpload(ue,pe,function(me){return je&&ge.closeProgress(null,G),me},Ee)}var ye={};return L7(ye),Ee(ye._errorCode,ye._errorString),!1},Ee)}B={method:"HTTPUploadThroughPostEx",url:re,serverIds:Ue,headers:q,formData:Tm(Y.httpFormFields),enumImageType:T,saveSetup:!1,fileName:w,retry:0,bOnlyResponseEmptyIsOK:!0,objUploadFileStatus:!1,dataFormat:Ce.DWT.EnumDWT_UploadDataFormat.Binary,asyncSuccessFunc:A,asyncFailureFunc:ce},this._asyncUploadCmd(B)}function Jhe(y,C,x,w,T){var A=this;if(C)return A._innerFunRaw("SaveSelectedImagesToBytes",It(0,0,y,x),C,!0,!0,function(H){if(U.isFunction(w)){var Y=new Blob([H],{type:A._strHttpContentTypeFieldValue});w(Y),Y=null}},T),!0;var M=A._innerFunRaw("SaveSelectedImagesToBytes",It(0,0,y,x),C,!0,!1);if(0==A._errorCode){var B=w(M);return M=null,B}return M=null,T(),!1}function M$e(){return this._resetErr(),!!this._isValid()&&(this._innerSend("SetCancel",null,!0),!0)}function Qhe(y,C,x,w,T){var A=this;if(!U.isFunction(w))return this._innerFun(y,C);A.IfShowProgressBar?(ge.showProgress(A,y,x),x&&ge.progressContext&&ge.progressContext.on("cancel",function(){pu(A,Khe,M$e).call(A)})):ge.hideProgress(),this._innerSend(y,C,!0,function(){ge.closeProgress(null,y),U.isFunction(w)&&w()},function(D){U.isFunction(T)&&T(A._errorCode,A._getErrorString()),ge.closeProgress(null,y),D&&U.error(D)})}function Zhe(y,C,x,w,T){var A,D=this,M=!1;if(U.isFunction(w)&&(M=!0),!pn.checkProductKey(D,{Core:!0})||!pn.checkPDFProductKeyWhenNeeds(D,x))return U.isFunction(T)&&nn(T,D),!!M&&void 0;if(ge.cancelFrom=Zn.FTPDownload,!M){var B=D._getCurrentDocumentName(),H=D._getCurrentDefaultTagName();(A=D.__innerLoadImageFun(y,C,1,B,H))&&D._canConsume()&&Ce.DWT.lcvrf(D);var Y=D._ImgManager.getCurrentImageIndex();return Y>=0&&D._innerRefreshUI(Y),A}pu(D,K9,Qhe).call(D,y,C,!0,function(){var G=D._ImgManager.getCurrentImageIndex();G>=0&&D._innerRefreshUI(G),D._canConsume()&&Ce.DWT.lcvrf(D),U.isFunction(w)&&w()},T)}function efe(y,C,x,w){if(0==y._ImgManager.count())return ea(y),U.isFunction(w)&&w(C),!1;if(U.isNumber(C)){if(isNaN(C)||C<-2||C>=y._ImgManager.count())return kt(y),U.isFunction(w)&&w(C),!1}else{if(!U.isArray(C))return kt(y),U.isFunction(w)&&w(C),!1;var T;for(T=0;T<C.length;T++){var A=C[T];if(isNaN(A)||!U.isNumber(A)||A<0||A>=y._ImgManager.count())return lle(y),U.isFunction(w)&&w(C),!1}}if(x==Ce.DWT.EnumDWT_ImageType.IT_BMP||x==Ce.DWT.EnumDWT_ImageType.IT_JPG||x==Ce.DWT.EnumDWT_ImageType.IT_PNG||x==Ce.DWT.EnumDWT_ImageType.IT_J2K)(-1==C&&y._ImgManager.count()>1||U.isArray(C)&&C.length>1)&&(z1(y),U.isFunction(w)&&w(C));else if(x!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&x!=Ce.DWT.EnumDWT_ImageType.IT_PDF)return Gl(y),U.isFunction(w)&&w(C),!1;return!0}function Tm(y){var C;return y&&(C=new FormData,U.each(y,function(x,w){x instanceof Blob?C.append(w,x,x.name):C.append(w,x)})),C}var SP,wf=function(y){function C(){return l(this,C),D=this,B=arguments,M=qn(M=C),$a(D,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(H){return!1}}()?Reflect.construct(M,B||[],qn(D).constructor):M.apply(D,B));var D,M,B}return qa(C,y),g(C,[{key:"Viewer",get:function(){return this._viewer}},{key:"BindViewer",value:function(D){var M=this,B=D;return Ce.DWT.UseDefaultViewer?(U.isString(D)&&(B=U.get(D),U.show(B)),M._config.container!=B&&(M._config.container=B,Ghe(M)),M._UIView.BindView(D)):(wt(M,-2439,"You cannot call the method bindViewer() when Dynamsoft.DWT.UseDefaultViewer is set to false."),!1)}},{key:"UnbindViewer",value:function(){return this._innerUnbindViewer(!1)}},{key:"AddText",value:function(D,M,B,H,Y,G,q,re){var ce=parseInt(D);if(!ta(this,ce))return!1;var ve=ed.RGB2BGR(Y),Te=ed.RGB2BGR(G),Ue=this._ImgManager.convertClientIndexToServerId(ce);return-1==Ue?(kt(this),!1):this._innerFun("AddText",It(Ue,M,B,H,ve,Te,q,re))}},{key:"CreateTextFont",value:function(D,M,B,H,Y,G,q,re,se,ce,ve,Te,Ue,je){return this._resetErr(),!!this._isValid()&&this._innerFun("CreateTextFont",It(D,M,B,H,Y,G,q,re,se,ce,ve,Te,Ue,je))}},{key:"CopyToClipboard",value:function(D){var M=parseInt(D);return!!ta(this,M)&&qS(this,"CopyToClipboard",M,null,null,!1,!1)}},{key:"CopyToClipboardAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var H,q,B=parseInt(D);return isNaN(B)?(Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):B<0||B>=M._ImgManager.count()?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):-1==(q=(H=M)._ImgManager.convertClientIndexToServerId(B))?(kt(H),ft.Promise.reject({code:H._errorCode,message:H._errorString})):H._innerFunV2("CopyToClipboard",It(q))}},{key:"getView",value:function(){return this._UIView}},{key:"Erase",value:function(D,M,B,H,Y,G,q){var re=this;if(!U.isFunction(G)){var se,ce=parseInt(D);if(!ta(re,ce,q))return!1;var ve=re._ImgManager.convertClientIndexToServerId(ce);return-1==ve?(kt(re),U.isFunction(q)&&q(re._errorCode,re._getErrorString()),!1):(re.getView().ClearSelectedAreas(),(se=1==re._innerFun("Erase",It(ve,M,B,H,Y)))?U.isFunction(G)&&G():U.isFunction(q)&&q(re._errorCode,re._getErrorString()),se)}re.EraseAsync(D,M,B,H,Y).then(G,function(Te){re._wrappeAsyncFailed(re,Te,q)})}},{key:"EraseAsync",value:function(D,M,B,H,Y){var G=this;if(G._resetErr(),!G._isValid())return ft.Promise.reject({code:G._errorCode,message:G._errorString});var q=parseInt(D);if(isNaN(q))return Jn(G),ft.Promise.reject({code:G._errorCode,message:G._errorString});if(q<0||q>=G._ImgManager.count())return kt(G),ft.Promise.reject({code:G._errorCode,message:G._errorString});var re=G._ImgManager.convertClientIndexToServerId(q);return-1==re?(kt(G),ft.Promise.reject({code:G._errorCode,message:G._errorString})):(G.getView().ClearSelectedAreas(),G._innerFunV2("Erase",It(re,M,B,H,Y),!0).then(function(se){if(1!=se)throw{code:G._errorCode,message:G._errorString}}))}},{key:"GetImageBitDepth",value:function(D){var M=this,B=parseInt(D);if(!ta(M,B))return!1;var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),!1):M._innerFun("GetImageBitDepth",It(H))}},{key:"GetImageWidth",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return!1;var B=parseInt(D);if(isNaN(B))return Jn(M),-1;if(B<0||B>=M._ImgManager.count())return kt(M),-1;var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),-1):M._innerFun("GetImageWidth",It(H))}},{key:"GetImageHeight",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return!1;var B=parseInt(D);if(isNaN(B))return Jn(M),-1;if(B<0||B>=M._ImgManager.count())return kt(M),-1;var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),-1):M._innerFun("GetImageHeight",It(H))}},{key:"GetImageSize",value:function(D,M,B){var H=this;if(H._resetErr(),!H._isValid())return!1;var Y=parseInt(D);if(isNaN(Y))return Jn(H),-1;if(Y<0||Y>=H._ImgManager.count())return kt(H),-1;var G=H._ImgManager.convertClientIndexToServerId(Y);return-1==G?(kt(H),-1):H._innerFun("GetImageSize",It(G,M,B))}},{key:"GetImageSizeWithSpecifiedType",value:function(D,M){var B=this;if(B._resetErr(),!B._isValid())return!1;var H=parseInt(D);if(isNaN(H))return Jn(B),-1;if(H<0||H>=B._ImgManager.count())return kt(B),-1;var Y=B._ImgManager.convertClientIndexToServerId(H);return-1==Y?(kt(B),-1):B._innerFun("GetImageSizeWithSpecifiedType",It(Y,M))}},{key:"GetImageXResolution",value:function(D){var M=this,B=parseInt(D);if(!ta(M,B))return!1;var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),!1):M._innerFun("GetImageXResolution",It(H))}},{key:"GetImageYResolution",value:function(D){var M=this,B=parseInt(D);if(!ta(M,B))return!1;var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),!1):M._innerFun("GetImageYResolution",It(H))}},{key:"SelectAllImages",value:function(){var D,M=this,B=M._getHowManyImagesInBuffer(),H=[];if(M._resetErr(),!M._isValid())return!1;for(D=0;D<B;D++)H.push(D);return M._ImgManager.setSelectedClientIndexArray(H),H}},{key:"SelectImages",value:function(D){var M=this;return M._resetErr(),!!M._isValid()&&M._ImgManager.setSelectedClientIndexArray(D)}},{key:"GetSkewAngle",value:function(D,M,B){var H,Y=this;if(!U.isFunction(M)){var G=parseInt(D);return!!ta(Y,G,B)&&(H=qS(Y,"GetSkewAngle",G,M,B,!0,!1),0==Y._errorCode?(zn.refreshImageAfterInvokeFun(Y,G),H):0)}Y.GetSkewAngleAsync(D).then(M,function(q){Y._wrappeAsyncFailed(Y,q,B)})}},{key:"GetSkewAngleAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("GetSkewAngle",It(H),!0).then(function(Y){var G=Y;return U.isArray(Y)&&(G=Y.length>0?Y[0]:0),zn.refreshImageAfterInvokeFun(M,B),G})}},{key:"GetSkewAngleEx",value:function(D,M,B,H,Y){var G=this,q=parseInt(D);if(!ta(G,q))return!1;var re=G._ImgManager.convertClientIndexToServerId(q);return-1==re?(kt(G),!1):G._innerFun("GetSkewAngleEx",It(re,M,B,H,Y))}},{key:"GetSkewAngleFromBinaryAsync",value:function(D,M,B,H){var Y=this;if(Y._resetErr(),!Y._isValid())return ft.Promise.reject({code:Y._errorCode,message:Y._errorString});var G=this._imageBufferWrapper.getCustomDataByIndex(D),q=this._imageBufferWrapper.getMetadataByIndex(D),re=this._ImgManager.convertClientIndexToServerId(D),ce=U.stringify([U.stringify({imageId:re,serverId:re,bufferLen:M.size,imageType:Ti.IT_BMP,width:q.width,height:q.height,bit:q.bitDepth,xres:q.resolutionX,yres:q.resolutionY,uidFromServer:G.uidFromServer})]);return this._innerSendBlob("GetSkewAngleFromBinary",ce,M,!0,!0,B,H)}},{key:"IsBlankImageEx",value:function(D,M,B,H,Y,G){var q;if(!ta(this,q=parseInt(D)))return!1;var se=this._ImgManager.convertClientIndexToServerId(q);return-1==se?(kt(this),!1):this._innerFun("IsBlankImageEx",It(se,M,B,H,Y,G))}},{key:"MirrorAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("Mirror",It(H),!0).then(function(Y){if(1!=Y)throw{code:M._errorCode,message:M._errorString};zn.refreshImageAfterInvokeFun(M,B),M.getView().ClearSelectedAreas()})}},{key:"Mirror",value:function(D,M,B){var H=this;if(!U.isFunction(M)){var Y=parseInt(D);return!!ta(H,Y,B)&&qS(H,"Mirror",Y,M,B,!1,!0)}H.MirrorAsync(D).then(M,function(G){H._wrappeAsyncFailed(H,G,B)})}},{key:"RemoveAllImages",value:function(){return this._removeAllImages("RemoveAllImages")}},{key:"RemoveAllImagesAsync",value:function(){return this._removeAllImagesAsync("RemoveAllImagesAsync",!0)}},{key:"RemoveImageAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("RemoveImage",It(H),!0).then(function(Y){return!(!Y&&-1033!=M._errorCode||(M._OnBitmapChanged(["c1",""+H,3,M._ImgManager.getCurrentImageIndex(),M._ImgManager.count()]),0))})}},{key:"Rotate",value:function(D,M,B,H,Y){return this.RotateEx(D,M,B,-1,H,Y)}},{key:"_wrappeAsyncFailed",value:function(D,M,B){M&&(D._errorCode=M.code,D._errorString=M.message),U.isFunction(B)&&B(D._errorCode,D._getErrorString())}},{key:"RotateEx",value:function(D,M,B,H,Y,G){var q=this;if(!U.isFunction(Y)){if(q._resetErr(),!q._isValid())return!1;var re,se=parseInt(D);if(isNaN(se))return Jn(q),U.isFunction(G)&&G(q._errorCode,q._getErrorString()),!1;if(se<0||se>=q._ImgManager.count())return kt(q),U.isFunction(G)&&G(q._errorCode,q._getErrorString()),!1;var ce=q._ImgManager.convertClientIndexToServerId(se);return-1==ce?(kt(q),U.isFunction(G)&&G(q._errorCode,q._getErrorString()),!1):((re=1==q._innerFun("RotateEx",It(ce,M,B,H)))?(zn.refreshImageAfterInvokeFun(q,se),q.getView().ClearSelectedAreas(),U.isFunction(Y)&&Y()):U.isFunction(G)&&G(q._errorCode,q._getErrorString()),re)}q.RotateExAsync(D,M,B,H).then(Y,function(ve){q._wrappeAsyncFailed(q,ve,G)})}},{key:"RotateLeft",value:function(D,M,B){return this.RotateEx(D,-90,!0,-1,M,B)}},{key:"RotateRight",value:function(D,M,B){return this.RotateEx(D,90,!0,-1,M,B)}},{key:"RotateAsync",value:function(D,M,B){return this.RotateExAsync(D,M,B,-1)}},{key:"RotateExAsync",value:function(D,M,B,H){var Y=this;if(Y._resetErr(),!Y._isValid())return ft.Promise.reject({code:Y._errorCode,message:Y._errorString});var G=parseInt(D);if(isNaN(G))return Jn(Y),ft.Promise.reject({code:Y._errorCode,message:Y._errorString});if(G<0||G>=Y._ImgManager.count())return kt(Y),ft.Promise.reject({code:Y._errorCode,message:Y._errorString});var q=Y._ImgManager.convertClientIndexToServerId(G);return-1==q?(kt(Y),ft.Promise.reject({code:Y._errorCode,message:Y._errorString})):Y._innerFunV2("RotateEx",It(q,M,B,H),!0).then(function(re){if(1!=re&&1!=re)throw{code:Y._errorCode,message:Y._errorString};zn.refreshImageAfterInvokeFun(Y,G),Y.getView().ClearSelectedAreas()})}},{key:"RotateLeftAsync",value:function(D){return this.RotateExAsync(D,-90,!0,-1)}},{key:"RotateRightAsync",value:function(D){return this.RotateExAsync(D,90,!0,-1)}},{key:"ChangeImageSize",value:function(D,M,B,H,Y,G){var q=this;if(!U.isFunction(Y)){var re,se=parseInt(D),ce=1*M,ve=1*B;if(!ta(q,se,G))return!1;if(ce<=0||ve<=0)return sle(q),U.isFunction(G)&&G(q._errorCode,q._getErrorString()),!1;var Te=q._ImgManager.convertClientIndexToServerId(se);return-1==Te?(kt(q),U.isFunction(G)&&G(q._errorCode,q._getErrorString()),!1):((re=1==q._innerFun("ChangeImageSize",It(Te,ce,ve,H)))?(zn.refreshImageAfterInvokeFun(q,se),U.isFunction(Y)&&Y()):U.isFunction(G)&&G(q._errorCode,q._getErrorString()),re)}q.ChangeImageSizeAsync(D,M,B,H).then(Y,function(Ue){q._wrappeAsyncFailed(q,Ue,G)})}},{key:"ChangeImageSizeAsync",value:function(D,M,B,H){var Y=this,G=parseInt(D),q=1*M,re=1*B;if(Y._resetErr(),!Y._isValid())return ft.Promise.reject({code:Y._errorCode,message:Y._errorString});if(isNaN(G))return Jn(Y),ft.Promise.reject({code:Y._errorCode,message:Y._errorString});if(G<0||G>=Y._ImgManager.count())return kt(Y),ft.Promise.reject({code:Y._errorCode,message:Y._errorString});if(q<=0||re<=0)return sle(Y),ft.Promise.reject({code:Y._errorCode,message:Y._errorString});var se=Y._ImgManager.convertClientIndexToServerId(G);return-1==se?(kt(Y),ft.Promise.reject({code:Y._errorCode,message:Y._errorString})):Y._innerFunV2("ChangeImageSize",It(se,q,re,H),!0).then(function(ce){if(1!=ce)throw{code:Y._errorCode,message:Y._errorString};zn.refreshImageAfterInvokeFun(Y,G)})}},{key:"Flip",value:function(D,M,B){var H=this;if(!U.isFunction(M)){var Y=parseInt(D);return!!ta(H,Y,B)&&qS(H,"Flip",Y,M,B,!1,!0)}H.FlipAsync(D).then(M,function(G){H._wrappeAsyncFailed(H,G,B)})}},{key:"FlipAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("Flip",It(H),!0).then(function(Y){if(1!=Y)throw{code:M._errorCode,message:M._errorString};zn.refreshImageAfterInvokeFun(M,B),M.getView().ClearSelectedAreas()})}},{key:"OutputSelectedAreaAsync",value:(A=yt(W.mark(function D(M,B,H,Y){var G,q,re,se,ce,ve,Te,Ue,je,Ee,Oe,He,we,ue;return W.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(re="OutputSelectedArea",(q=this)._resetErr(),q._isValid()){pe.next=4;break}throw{code:q._errorCode,message:q._errorString};case 4:if(se=0,ce=0,ve=0,Te=0,!isNaN(M)){pe.next=8;break}throw Jn(q),{code:q._errorCode,message:q._errorString};case 8:if(H==Ti.IT_BMP||H==Ti.IT_JPG||H==Ti.IT_TIF||H==Ti.IT_PNG||H==Ti.IT_PDF){pe.next=11;break}throw Wi(q),{code:q._errorCode,message:q._errorString};case 11:if(Y==bf.Blob||Y==bf.Base64){pe.next=14;break}throw Wi(q),{code:q._errorCode,message:q._errorString};case 14:if(!(M<0||M>=q._ImgManager.count())){pe.next=17;break}throw kt(q),{code:q._errorCode,message:q._errorString};case 17:if(-1!=(Ue=q._ImgManager.convertClientIndexToServerId(M))){pe.next=21;break}throw kt(q),{code:q._errorCode,message:q._errorString};case 21:return Ee=(je=Y==bf.Base64)?"text":"arraybuffer",B&&(ge.isNumber(B.x)&&(se=B.x),ge.isNumber(B.y)&&(ce=B.y),ge.isNumber(B.width)&&(ve=B.width),ge.isNumber(B.height)&&(Te=B.height)),He=U.stringify([{index:Ue,left:se,top:ce,width:ve,height:Te}]),we="["+He+","+H+","+Y+"]",ue=null===(G=ge.progressContext)||void 0===G?void 0:G.IfShowCancelDialogWhenImageTransfer,pe.prev=27,q.IfShowProgressBar?ge.showProgress(q,re,!1):ge.hideProgress(),q._OnPercentDone(je?[0,-1,Lr.ConvertingToBase64]:[0,-1,Lr.ConvertingToBlob]),ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=!1),pe.next=33,q._sendDataByHttpAsync(re,we,Ee,!0);case 33:Oe=pe.sent;case 34:return pe.prev=34,ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=ue),q.IfShowProgressBar&&ge.closeProgress(null,re),pe.finish(34);case 38:if(!je){pe.next=51;break}if(!Oe){pe.next=48;break}if(!yc(Oe)){pe.next=44;break}return q._errorCode=Oe.exception,q._errorString=Oe.description,pe.abrupt("return","");case 44:if(!(U.isArray(Oe.result)&&Oe.result.length>0&&U.isString(Oe.result[0]))){pe.next=46;break}return pe.abrupt("return",Oe.result[0]);case 46:pe.next=49;break;case 48:return pe.abrupt("return","");case 49:pe.next=52;break;case 51:return pe.abrupt("return",new Blob([Oe],{type:RB(H)}));case 52:case"end":return pe.stop()}},D,this,[[27,,34,38]])})),function(D,M,B,H){return A.apply(this,arguments)})},{key:"Crop",value:function(D,M,B,H,Y,G,q){var re=this;if(!U.isFunction(G)){var se,ce=parseInt(D);if(!ta(re,ce,q))return!1;var ve,Te,Ue=re._ImgManager.convertClientIndexToServerId(ce);return-1==Ue?(kt(re),U.isFunction(q)&&q(re._errorCode,re._getErrorString()),!1):(se=1==re._innerFun("Crop",It(Ue,M,B,H,Y)),ve=re._errorCode,Te=re._getErrorString(),re.getView().ClearSelectedAreas(),re._errorCode=ve,re._errorString=Te,se?(zn.refreshImageAfterInvokeFun(re,ce),U.isFunction(G)&&G()):U.isFunction(q)&&q(ve,Te),se)}re.CropAsync(D,M,B,H,Y).then(G,function(je){re._wrappeAsyncFailed(re,je,q)})}},{key:"CropAsync",value:function(D,M,B,H,Y){var G=this;if(G._resetErr(),!G._isValid())return ft.Promise.reject({code:G._errorCode,message:G._errorString});var q=parseInt(D);if(isNaN(q))return Jn(G),ft.Promise.reject({code:G._errorCode,message:G._errorString});if(q<0||q>=G._ImgManager.count())return kt(G),ft.Promise.reject({code:G._errorCode,message:G._errorString});var re=G._ImgManager.convertClientIndexToServerId(q);return-1==re?(kt(G),ft.Promise.reject({code:G._errorCode,message:G._errorString})):G._innerFunV2("Crop",It(re,M,B,H,Y),!0).then(function(se){var ce,ve;if(ce=G._errorCode,ve=G._getErrorString(),G.getView().ClearSelectedAreas(),G._errorCode=ce,G._errorString=ve,1!=se)throw{code:G._errorCode,message:G._errorString};return zn.refreshImageAfterInvokeFun(G,q),!0})}},{key:"CropToClipboard",value:function(D,M,B,H,Y){var G,q=this,re=parseInt(D);if(!ta(q,re))return!1;var se=q._ImgManager.convertClientIndexToServerId(re);return-1==se?(kt(q),!1):(q.getView().ClearSelectedAreas(),(G=1==q._innerFun("CropToClipboard",It(se,M,B,H,Y)))&&zn.refreshImageAfterInvokeFun(q,re),G)}},{key:"CutFrameToClipboard",value:function(D,M,B,H,Y){var G,q=this,re=parseInt(D);if(!ta(q,re))return!1;var se=q._ImgManager.convertClientIndexToServerId(re);return-1==se?(kt(q),!1):(q.getView().ClearSelectedAreas(),(G=1==q._innerFun("CutFrameToClipboard",It(se,M,B,H,Y)))&&zn.refreshImageAfterInvokeFun(q,re),G)}},{key:"CutToClipboard",value:function(D){var M,B=this,H=parseInt(D);if(!ta(B,H))return!1;var Y=B._ImgManager.convertClientIndexToServerId(H);return-1==Y?(kt(B),!1):((M=1==B._innerFun("CutToClipboard",It(Y)))&&B._OnBitmapChanged(["c1",""+Y,3,B._ImgManager.getCurrentImageIndex(),B._ImgManager.count()]),M)}},{key:"CutFrameToClipboardAsync",value:function(D,M,B,H,Y){var G=this;if(G._resetErr(),!G._isValid())return ft.Promise.reject({code:G._errorCode,message:G._errorString});var q=parseInt(D);if(isNaN(q))return Jn(G),ft.Promise.reject({code:G._errorCode,message:G._errorString});if(q<0||q>=G._ImgManager.count())return kt(G),ft.Promise.reject({code:G._errorCode,message:G._errorString});var re=G._ImgManager.convertClientIndexToServerId(q);return-1==re?(kt(G),ft.Promise.reject({code:G._errorCode,message:G._errorString})):G._innerFunV2("CutFrameToClipboard",It(re,M,B,H,Y)).then(function(se){var ce=1==se;if(!ce)throw{code:G._errorCode,message:G._errorString};return zn.refreshImageAfterInvokeFun(G,q),ce})}},{key:"CropToClipboardAsync",value:function(D,M,B,H,Y){var G=this;if(G._resetErr(),!G._isValid())return ft.Promise.reject({code:G._errorCode,message:G._errorString});var q=parseInt(D);if(isNaN(q))return Jn(G),ft.Promise.reject({code:G._errorCode,message:G._errorString});if(q<0||q>=G._ImgManager.count())return kt(G),ft.Promise.reject({code:G._errorCode,message:G._errorString});var re=G._ImgManager.convertClientIndexToServerId(q);return-1==re?(kt(G),ft.Promise.reject({code:G._errorCode,message:G._errorString})):G._innerFunV2("CropToClipboard",It(re,M,B,H,Y)).then(function(se){var ce=1==se;if(!ce)throw{code:G._errorCode,message:G._errorString};return zn.refreshImageAfterInvokeFun(G,q),ce})}},{key:"CutToClipboardAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("CutToClipboard",It(H)).then(function(Y){var G=1==Y;if(!G)throw{code:M._errorCode,message:M._errorString};return M._OnBitmapChanged(["c1",""+H,3,M._ImgManager.getCurrentImageIndex(),M._ImgManager.count()]),G})}},{key:"SetDPI",value:function(D,M,B,H,Y,G,q){var re,se=this,ce=!1;U.isFunction(G)&&(ce=!0);var ve=parseInt(D);if(!ta(se,ve,q))return!!ce&&void 0;var Te=se._ImgManager.convertClientIndexToServerId(ve);return-1==Te?(kt(se),U.isFunction(q)&&q(se._errorCode,se._getErrorString()),!!ce&&void 0):((re=1==se._innerFun("SetDPI",It(Te,M,B,H,Y)))?U.isFunction(G)&&G():U.isFunction(q)&&q(se._errorCode,se._getErrorString()),ce?void 0:re)}},{key:"MoveImage",value:function(D,M){var B=this;if(B._resetErr(),!B._isValid())return!1;var H=parseInt(D),Y=parseInt(M);return isNaN(H)||isNaN(Y)?(Jn(B),!1):H<0||H>=B._ImgManager.count()||Y<0||Y>=B._ImgManager.count()?(kt(B),!1):B._ImgManager.moveImage(H,Y)}},{key:"SwitchImage",value:function(D,M){var B=this;if(B._resetErr(),!B._isValid())return!1;var H=parseInt(D),Y=parseInt(M);return isNaN(H)||isNaN(Y)?(Jn(B),!1):H<0||H>=B._ImgManager.count()||Y<0||Y>=B._ImgManager.count()?(kt(B),!1):B._ImgManager.switchImage(H,Y)}},{key:"CloseWorkingProcess",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._innerFun("CloseWorkerProcess")}},{key:"RemoveAllSelectedImages",value:function(){var D=this;if(D._resetErr(),!D._isValid())return!1;var M=!0,B=D._ImgManager.getCurrentImageIndex(),H=D._ImgManager.getSelectedClientIndexArray(),Y=[];if(U.isArray(H)&&U.each(H,function(q){var re=D._ImgManager.convertClientIndexToServerId(q);-1!=re&&Y.push(re)}),0==Y.length&&B>=0){var G=D._ImgManager.convertClientIndexToServerId(B);Y.push(G)}return Y.length>0&&(M=D._innerFun("RemoveAllSelectedImages",It(Y.join(",")))),M&&U.each(Y,function(q){D._OnBitmapChanged(["c1",""+q,3,D._ImgManager.getCurrentImageIndex(),D._ImgManager.count()])}),M}},{key:"RemoveAllSelectedImagesAsync",value:function(){var D=this;if(D._resetErr(),!D._isValid())return ft.Promise.reject({code:D._errorCode,message:D._errorString});var M=D._ImgManager.getCurrentImageIndex(),B=D._ImgManager.getSelectedClientIndexArray(),H=[];if(U.isArray(B)&&U.each(B,function(G){var q=D._ImgManager.convertClientIndexToServerId(G);-1!=q&&H.push(q)}),0==H.length&&M>=0){var Y=D._ImgManager.convertClientIndexToServerId(M);H.push(Y)}return H.length>0?D._innerFunV2("RemoveAllSelectedImages",It(H.join(","),!0)).then(function(G){G&&U.each(H,function(q){D._OnBitmapChanged(["c1",""+q,3,D._ImgManager.getCurrentImageIndex(),D._ImgManager.count()])})}):ft.Promise.resolve()}},{key:"TagImages",value:function(D,M){var B=this;if(B._resetErr(),!B._isValid())return!1;var H=!0,Y=B._ImgManager.count();return U.isArray(D)?U.isString(M)&&""!=M?(U.each(D,function(G){if(isNaN(G)||G<0||G>=Y)return kt(B),H=!1}),H&&B._ImgManager.addImageTag(D,M)):(wt(B,-2394,"Invalid tag name."),!1):(Y1(B),!1)}},{key:"ClearImageTags",value:function(D){var M=this;return M._resetErr(),!!M._isValid()&&(-1==D||D>=M._getHowManyImagesInBuffer()?(kt(M),!1):M._ImgManager.removeImageTag(D))}},{key:"SetDefaultTag",value:function(D){var M=this;return M._resetErr(),!!M._isValid()&&M._ImgManager.setDefaultTag(D)}},{key:"FilterImagesByTag",value:function(D,M,B){var H,Y=this,G=!1;if(U.isFunction(M)&&(G=!0),Y._resetErr(),!Y._isValid())return!!G&&void 0;U.isFunction(B)&&(H=function(){B({code:Y._errorCode,message:Y._errorString})});var q=Y._ImgManager.showImagesByFilter(D,M,H);return G?void 0:q}},{key:"ClearFilter",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._ImgManager.clearFilter()}},{key:"CreateDocument",value:function(D){var M=this;return M._resetErr(),!!M._isValid()&&(D&&""!=D?U.isString(D)?M._ImgManager.CreateFile(D):(bS(M),!1):(U.isNumber(D)?bS(M):W7(M),!1))}},{key:"OpenDocument",value:function(D){var M=this;return M._resetErr(),!!M._isValid()&&(D&&""!=D?U.isString(D)?M._ImgManager.OpenFile(D):(bS(M),!1):(U.isNumber(D)?bS(M):W7(M),!1))}},{key:"RemoveDocument",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return!1;var B=M._ImgManager.GetServerIdsByFileName(D);return B.length>0&&M._innerFun("RemoveAllSelectedImages",It(B.join(","))),M._ImgManager.RemoveFile(D)}},{key:"RenameDocument",value:function(D,M){var B=this;return B._resetErr(),!!B._isValid()&&(U.isString(D)&&U.isString(M)?D&&""!=D&&M&&""!=M?B._ImgManager.RenameFile(D,M):(W7(B),!1):(bS(B),!1))}},{key:"GetDocumentInfoList",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._ImgManager.GetFileInfoList()}},{key:"MoveToDocumentAsync",value:(T=yt(W.mark(function D(M,B,H,Y){var G,q,re,se,ce,ve,Te,Ue,je,Ee;return W.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if((G=this)._resetErr(),G._isValid()){Oe.next=4;break}throw{code:G._errorCode,message:G._errorString};case 4:if(!U.isUndefined(M)&&0!=M.length){Oe.next=7;break}throw PA(G),{code:G._errorCode,message:G._errorString};case 7:if(!U.isUndefined(B)&&0!=B.length){Oe.next=10;break}throw RA(G),{code:G._errorCode,message:G._errorString};case 10:q=G._ImgManager.GetFileInfoList(),ce=0;case 12:if(!(ce<q.length)){Oe.next=20;break}if(q[ce].name!=M){Oe.next=17;break}return re=q[ce],Oe.abrupt("break",20);case 17:ce++,Oe.next=12;break;case 20:ve=0;case 21:if(!(ve<q.length)){Oe.next=29;break}if(q[ve].name!=B){Oe.next=26;break}return se=q[ve],Oe.abrupt("break",29);case 26:ve++,Oe.next=21;break;case 29:if(!U.isUndefined(re)){Oe.next=32;break}throw PA(G),{code:G._errorCode,message:G._errorString};case 32:if(!U.isUndefined(se)){Oe.next=35;break}throw RA(G),{code:G._errorCode,message:G._errorString};case 35:if(Te=[],!U.isUndefined(H)){Oe.next=40;break}if(re.imageIds.length>0)for(je=0;je<re.imageIds.length;je++)Te.push(je);Oe.next=60;break;case 40:if(!U.isArray(H)){Oe.next=53;break}if(G._checkIndices(H,re.imageIds.length)){Oe.next=43;break}throw{code:G._errorCode,message:G._errorString};case 43:if(Te=H,U.isUndefined(Y)){Oe.next=51;break}if(!U.isNumber(Y)){Oe.next=49;break}Y<0?Ue=0:se.imageIds.length>Y&&(Ue=Y),Oe.next=51;break;case 49:throw Wi(G),{code:G._errorCode,message:G._errorString};case 51:Oe.next=60;break;case 53:if(!U.isNumber(H)){Oe.next=58;break}if(re.imageIds.length>0)for(Ee=0;Ee<re.imageIds.length;Ee++)Te.push(Ee);H<0?Ue=0:se.imageIds.length>H&&(Ue=H),Oe.next=60;break;case 58:throw Wi(G),{code:G._errorCode,message:G._errorString};case 60:return Oe.abrupt("return",new ft.Promise(function(He,we){0==Te.length||G._ImgManager.MoveImageToFile(M,Te,B,Ue)?He():we({code:G._errorCode,message:G._errorString})}));case 61:case"end":return Oe.stop()}},D,this)})),function(D,M,B,H){return T.apply(this,arguments)})},{key:"CopyToDocumentAsync",value:(w=yt(W.mark(function D(M,B,H,Y){var G,q,re,se,ce,ve,Te,Ue;return W.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:if((G=this)._resetErr(),G._isValid()){je.next=4;break}throw{code:G._errorCode,message:G._errorString};case 4:if(!U.isUndefined(M)&&0!=M.length){je.next=7;break}throw PA(G),{code:G._errorCode,message:G._errorString};case 7:if(!U.isUndefined(B)&&0!=B.length){je.next=10;break}throw RA(G),{code:G._errorCode,message:G._errorString};case 10:q=G._ImgManager.GetFileInfoList(),ce=0;case 12:if(!(ce<q.length)){je.next=20;break}if(q[ce].name!=M){je.next=17;break}return re=q[ce],je.abrupt("break",20);case 17:ce++,je.next=12;break;case 20:ve=0;case 21:if(!(ve<q.length)){je.next=29;break}if(q[ve].name!=B){je.next=26;break}return se=q[ve],je.abrupt("break",29);case 26:ve++,je.next=21;break;case 29:if(!U.isUndefined(re)){je.next=32;break}throw PA(G),{code:G._errorCode,message:G._errorString};case 32:if(!U.isUndefined(se)){je.next=35;break}throw RA(G),{code:G._errorCode,message:G._errorString};case 35:if(Te=[],!U.isUndefined(H)){je.next=40;break}re.imageIds.length>0&&U.isArray(re.imageIds)&&U.each(re.imageIds,function(Ee){var Oe=G._uidFromServer2ServerId(Ee);-1!=Oe&&Te.push(Oe)}),je.next=60;break;case 40:if(!U.isArray(H)){je.next=53;break}if(G._checkIndices(H,re.imageIds.length)){je.next=43;break}throw{code:G._errorCode,message:G._errorString};case 43:if(U.each(H,function(Ee){var Oe=G._uidFromServer2ServerId(re.imageIds[Ee]);-1!=Oe&&Te.push(Oe)}),U.isUndefined(Y)){je.next=51;break}if(!U.isNumber(Y)){je.next=49;break}Y<0?Ue=0:se.imageIds.length>Y&&(Ue=Y),je.next=51;break;case 49:throw Wi(G),{code:G._errorCode,message:G._errorString};case 51:je.next=60;break;case 53:if(!U.isNumber(H)){je.next=58;break}re.imageIds.length>0&&U.isArray(re.imageIds)&&U.each(re.imageIds,function(Ee){var Oe=G._uidFromServer2ServerId(Ee);-1!=Oe&&Te.push(Oe)}),H<0?Ue=0:se.imageIds.length>H&&(Ue=H),je.next=60;break;case 58:throw Wi(G),{code:G._errorCode,message:G._errorString};case 60:return je.abrupt("return",new ft.Promise(function(Ee,Oe){var He="copyToDocument",we=se.imageIds.length;if(0==Te.length)Ee();else{G.IfShowProgressBar?Mp(!1):ge.hideProgress();var ue=G.IfShowCancelDialogWhenImageTransfer;ge.cancelFrom=Zn.LoadImage,G.IfShowCancelDialogWhenImageTransfer=!1,ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=!1),ge.cancelFrom=Zn.Other,G._innerConvertToBlobWithUI(He,Ce.DWT.EnumDWT_ImageType.IT_PDF,Te,!1,function(pe,ye){var me;pe.currentFileName=B,pe.currentTagName="",pe.bNeedClearCurrentTagName=!0,G.IfShowProgressBar?(Mp(!1),ge.showProgress(G,He,!1),ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=!1)):ge.hideProgress(),ge.cancelFrom=Zn.LoadImage,G.Addon&&G.Addon.PDF&&(me=G.Addon.PDF.GetReaderOptions(),G.Addon.PDF.SetReaderOptions({convertMode:Ce.DWT.EnumDWT_ConvertMode.CM_IMAGEONLY})),G._innerLoadImageFromBinary(pe,0,!0,!0,function(){if(G.Addon&&G.Addon.PDF&&me&&G.Addon.PDF.SetReaderOptions(me),G.IfShowCancelDialogWhenImageTransfer=ue,G.IfShowProgressBar&&ge.closeProgress(null,He),U.isUndefined(Ue))Ee();else{for(var Se=[],We=0;We<Te.length;We++)Se.push(we+We);0==Se.length||G._ImgManager.MoveImageToFile(B,Se,B,Ue)?Ee():Oe({code:G._errorCode,message:G._errorString})}},function(){G.Addon&&G.Addon.PDF&&me&&G.Addon.PDF.SetReaderOptions(me),G.IfShowCancelDialogWhenImageTransfer=ue,G.IfShowProgressBar&&ge.closeProgress(null,He),Oe({code:G._errorCode,message:G._errorString})})},function(){G.IfShowCancelDialogWhenImageTransfer=ue,Oe({code:G._errorCode,message:G._errorString})})}}));case 61:case"end":return je.stop()}},D,this)})),function(D,M,B,H){return w.apply(this,arguments)})},{key:"Invert",value:function(D,M,B){var H=this,Y=!1;if(U.isFunction(M)&&(Y=!0),!Y){var G=parseInt(D);return!!ta(H,G,B)&&qS(H,"Invert",G,M,B,!1,!0)}H.InvertAsync(D).then(M,function(q){H._wrappeAsyncFailed(H,q,B)})}},{key:"InvertAsync",value:function(D){return this._invert(D)}},{key:"RenameTag",value:function(D,M){var B=this;return B._resetErr(),!!B._isValid()&&(U.isUndefined(D)?(_l(B),!1):0==D.length?(wt(B,-2517,"Old tag name is required."),!1):U.isUndefined(M)||0==M.length?(wt(B,-2518,"New tag name is required."),!1):B._ImgManager.renameTag(D,M))}},{key:"RemoveTag",value:function(D,M){var B=this;return B._resetErr(),!!B._isValid()&&(U.isUndefined(D)||0==D.length?(_l(B),!1):U.isUndefined(M)||U.isArray(M)?B._ImgManager.removeTag(D,M):(Y1(B),!1))}},{key:"GetTagList",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._ImgManager.getTagList()}},{key:"GetTagListByIndex",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return[];var B=parseInt(D);return isNaN(B)?(Jn(M),[]):B<0||B>=M._ImgManager.count()||-1==M._ImgManager.convertClientIndexToServerId(B)?(kt(M),[]):M._ImgManager.getTagListByIndex(B)}},{key:"GetImageBitDepthAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("GetImageBitDepth",It(H))}},{key:"GetImageWidthAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("GetImageWidth",It(H))}},{key:"GetImageHeightAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("GetImageHeight",It(H))}},{key:"GetImageSizeAsync",value:function(D,M,B){var H=this;if(H._resetErr(),!H._isValid())return ft.Promise.reject({code:H._errorCode,message:H._errorString});var Y=parseInt(D);if(isNaN(Y))return Jn(H),ft.Promise.reject({code:H._errorCode,message:H._errorString});if(Y<0||Y>=H._ImgManager.count())return kt(H),ft.Promise.reject({code:H._errorCode,message:H._errorString});var G=H._ImgManager.convertClientIndexToServerId(Y);return-1==G?(kt(H),ft.Promise.reject({code:H._errorCode,message:H._errorString})):H._innerFunV2("GetImageSize",It(G,M,B))}},{key:"GetImageSizeWithSpecifiedTypeAsync",value:function(D,M){var B=this;if(B._resetErr(),!B._isValid())return ft.Promise.reject({code:B._errorCode,message:B._errorString});var H=parseInt(D);if(isNaN(H))return Jn(B),ft.Promise.reject({code:B._errorCode,message:B._errorString});if(H<0||H>=B._ImgManager.count())return kt(B),ft.Promise.reject({code:B._errorCode,message:B._errorString});var Y=B._ImgManager.convertClientIndexToServerId(H);return-1==Y?(kt(B),ft.Promise.reject({code:B._errorCode,message:B._errorString})):B._innerFunV2("GetImageSizeWithSpecifiedType",It(Y,M))}},{key:"GetImageXResolutionAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("GetImageXResolution",It(H))}},{key:"GetImageYResolutionAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("GetImageYResolution",It(H))}},{key:"ChangeBrightnessAsync",value:function(D,M){var B=this,H=parseInt(D);if(!B._isValid())return ft.Promise.reject({code:B._errorCode,message:B._errorString});if(M<-1e3||M>1e3)return da(B),ft.Promise.reject({code:B._errorCode,message:B._errorString});var Y=B._ImgManager.convertClientIndexToServerId(H);return-1==Y?(kt(B),ft.Promise.reject({code:B._errorCode,message:B._errorString})):B._innerFunV2("ChangeBrightness",It(Y,M))}},{key:"ChangeContrastAsnyc",value:function(D,M){var B=this,H=parseInt(D);if(!B._isValid())return ft.Promise.reject({code:B._errorCode,message:B._errorString});if(M<-1e3||M>1e3)return da(B),ft.Promise.reject({code:B._errorCode,message:B._errorString});var Y=B._ImgManager.convertClientIndexToServerId(H);return-1==Y?(kt(B),ft.Promise.reject({code:B._errorCode,message:B._errorString})):B._innerFunV2("ChangeContrast",It(Y,M))}},{key:"GetImageAsync",value:function(D,M,B,H,Y){var G=this;if(G._resetErr(),!G._isValid())return ft.Promise.reject({code:G._errorCode,message:G._errorString});var q=parseInt(D);if(isNaN(q))return Jn(G),ft.Promise.reject({code:G._errorCode,message:G._errorString});if(q<0||q>=G._ImgManager.count())return kt(G),ft.Promise.reject({code:G._errorCode,message:G._errorString});var re,se=G._ImgManager.convertClientIndexToServerId(q);return-1==se?(kt(G),ft.Promise.reject({code:G._errorCode,message:G._errorString})):(U.isNumber(M)?re=It(se,M):U.isNumber(B)&&U.isNumber(H)?re=It(se,B,H):U.isNumber(Y)&&(re=It(se,-1,-1,Y)),G._sendDataByHttpAsync("GetImageByIndex",re,"blob"))}},{key:"GetImageInfoAsync",value:function(D){var M=this;if(M._resetErr(),!M._isValid())return ft.Promise.reject({code:M._errorCode,message:M._errorString});var B=parseInt(D);if(isNaN(B))return Jn(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});if(B<0||B>=M._ImgManager.count())return kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString});var H=M._ImgManager.convertClientIndexToServerId(B);return-1==H?(kt(M),ft.Promise.reject({code:M._errorCode,message:M._errorString})):M._innerFunV2("GetImageInfo",It(H)).then(function(Y){var G=0,q=0,re=Y;if(U.isArray(Y)&&1==Y.length&&(re=Y[0]),U.isString(re)){var se=re.split(",");G=parseInt(se[0]),q=parseInt(se[1])}return{width:G,height:q}})}},{key:"IfShowUI",get:function(){return this._resetErr(),this._isValid()?this._innerFun("IfShowUI"):vt},set:function(D){this._setIfShowUI(D)}},{key:"IfShowFileDialog",get:function(){return this._getIfShowFileDialog()},set:function(D){this._setIfShowFileDialog(D)}},{key:"checkErrorString",value:function(){var D=this._errorCode;if(-2115===D)return!0;if(-2003===D&&!Ce.DWT.IfHttpPostErrorNoWindow){var M=window.open("","ErrorMessage","height=500,width=750,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no");null==M||M.document.writeln(this.__HTTPPostResponseString)}return 0===D}},{key:"OverlayRectangle",value:function(D,M,B,H,Y,G,q){var re,se=this;return se._resetErr(),!!se._isValid()&&(se._isNoViewer()?se._nouiNotSupport("OverlayRectangle"):M>H||B>Y||M==H&&B==Y?(wt(se,-2375,"The left or top or right or bottom you entered is invalid."),!1):(re=U.isNumber(G)?ed.getColor(G):G,se._UIView.OverlayRectangle(D,M,B,H,Y,re,q)))}},{key:"SetViewMode",value:function(D,M){var B=this;if(B._resetErr(),!B._isValid())return!1;if(B._isNoViewer())return B._nouiNotSupport("SetViewMode");if(U.isString(D)||U.isString(M)||D<-1&&M<-1)return da(B),vt;var H=Math.floor(D),Y=Math.floor(M);return B._UIView.SetViewMode(H,Y),!0}},{key:"ShowImageEditor",value:function(D,M,B,H){var Y=this;return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("ShowImageEditor"):Yl.isServerInvalid(Y)?vt:Y._UIView.GetWebViewer().webViewer.imageEditor?Y.ShowImageEditorEx(-1,-1,-1,-1,3):D&&M&&B?Y.ShowImageEditorEx(-1,-1,M,B,0,!0,D,H):Y.ShowImageEditorEx(-1,-1,-1,-1,0,!1))}},{key:"ShowImageEditorEx",value:function(D,M,B,H,Y,G,q,re){var se=this;return se._resetErr(),!!se._isValid()&&(se._isNoViewer()?se._nouiNotSupport("ShowImageEditorEx"):se._UIView.ShowImageEditorEx(D,M,B,H,Y,G,q,re))}},{key:"SetSelectedImageArea",value:function(D,M,B,H,Y){var G=this;if(G._resetErr(),!G._isValid())return!1;if(G._isNoViewer())return G._nouiNotSupport("SetSelectedImageArea");var q=parseInt(D);return isNaN(q)||q<0||q>=G._ImgManager.count()?(kt(G),!1):!Yl.isServerInvalid(G)&&G._UIView.SetSelectedImageArea(M,B,H,Y)}},{key:"first",value:function(){var D=this,M=D._ImgManager.count();return D._resetErr(),!!D._isValid()&&(D._isNoViewer()?D._nouiNotSupport("first"):(M>0&&(D._UIView.Go(0),ch.__innerRefreshFromUIView(D,D._ImgManager.getCurrentImageIndex())),Lt))}},{key:"previous",value:function(){var D=this,M=D._ImgManager.count();return D._resetErr(),!!D._isValid()&&(D._isNoViewer()?D._nouiNotSupport("previous"):(M>0&&(D._UIView.__Previous(),ch.__innerRefreshFromUIView(D,D._ImgManager.getCurrentImageIndex())),Lt))}},{key:"next",value:function(){var D=this,M=D._ImgManager.count();return D._resetErr(),!!D._isValid()&&(D._isNoViewer()?D._nouiNotSupport("next"):(M>0&&(D._UIView.__Next(),ch.__innerRefreshFromUIView(D,D._ImgManager.getCurrentImageIndex())),Lt))}},{key:"last",value:function(){var D=this,M=D._ImgManager.count();return D._resetErr(),!!D._isValid()&&(D._isNoViewer()?D._nouiNotSupport("last"):(M>0&&(D._UIView.Go(M-1),ch.__innerRefreshFromUIView(D,D._ImgManager.getCurrentImageIndex())),Lt))}},{key:"_isBindViewer",value:function(){return!(!this._viewer||!this._viewer.webViewer)&&this._viewer.webViewer.bindViewUI}},{key:"_isNoViewer",value:function(){return!this._isBindViewer()}},{key:"_innerUnbindViewer",value:function(D){var M=this;M.__funResize&&(U.removeEventListener(window,"resize",M.__funResize),M.__funResize=vt),M._viewer&&(D?M._viewer.webViewer.dispose():M._viewer.unbind()),M._config.container=null}},{key:"_unload_viewer",value:function(){var D=this;if(D._isBindViewer())D._innerUnbindViewer(!0);else{var M,B=null===(M=D._containerElement)||void 0===M?void 0:M.id;B&&delete Ce.DWT.ContainerMap[B]}D._ImgManager&&(D._ImgManager.dispose(),D._ImgManager=null),D._UIView&&(D._UIView.dispose(),D._UIView=null),D._viewer=null}},{key:"_innerRefreshUI",value:function(D,M,B,H,Y){var G=this;return 4==Y&&G._isBindViewer()&&(0==G._ImgManager.bImageJustChangedInEditor?G._ImgManager.bImageChangedInViewer=!0:(G._ImgManager.bImageJustChangedInEditor=!1,G._ImgManager.bImageChangedInViewer=!1)),B&&G._ImgManager.refresh(D,G._ImgManager.count(),!0,H),U.isFunction(G.__OnRefreshUI)&&G.__OnRefreshUI(G._ImgManager.getCurrentImageIndex(),G._ImgManager.count()),!0}},{key:"updateImage",value:(x=yt(W.mark(function D(M,B){var H,Y,G,q;return W.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(Y=this,!U.isUndefined(M)&&0!=M.length){re.next=6;break}throw wt(Y,-2853,"The imageId cannot be empty."),{code:Y._errorCode,message:Y._errorString};case 6:if(U.isString(M)){re.next=9;break}throw fle(Y),{code:Y._errorCode,message:Y._errorString};case 9:if(-1!=(G=Y._uidFromServer2ServerId(M))){re.next=13;break}throw Ile(Y),{code:Y._errorCode,message:Y._errorString};case 13:if(!U.isUndefined(B)){re.next=18;break}throw wVe(Y),{code:Y._errorCode,message:Y._errorString};case 18:if(B instanceof Blob){re.next=21;break}throw SVe(Y),{code:Y._errorCode,message:Y._errorString};case 21:return re.next=23,tfe(B);case 23:return q=re.sent,re.next=26,Y._updateImage(G,q);case 26:null===(H=Y._UIView.GetWebViewer())||void 0===H||null===(H=H.webViewer)||void 0===H||H.resetImageEditorButton();case 27:case"end":return re.stop()}},D,this)})),function(D,M){return x.apply(this,arguments)})}],[{key:"ProcessGetBlobByQueue",value:function(){if(C._getblob_queue.length>0&&!C._processing_getblob_queue){C._processing_getblob_queue=!0;var D=C._getblob_queue.shift(),M=D[0],H=D[2];M._convertToBlobForUpload(Ce.DWT.EnumDWT_ImageType.IT_PNG,[D[1]],!1,4,function(Y,G,q){var re=q[1][0],se=M._ImgManager.getImageIdMap(re);if(se){var ce={imageId:re,serverId:re,uidFromServer:se.uidFromServer,uuid:se.uuid,imageUrl:URL.createObjectURL(Y),minImageUrl:URL.createObjectURL(Y)};Y=null,M._ImgManager.UpdateImage(ce,H)}C._processing_getblob_queue=!1,setTimeout(C.ProcessGetBlobByQueue,0)},function(Y){C._processing_getblob_queue=!1,setTimeout(C.ProcessGetBlobByQueue,0)})}}},{key:"_getContainer",value:function(D){return D._containerElement}},{key:"_setContainer",value:function(D,M){return D._containerElement=M}},{key:"_closeImageEditorUI",value:function(D){if(U.isFunction(D.__CloseImageEditorUI))try{D.__CloseImageEditorUI()}catch(M){Fr(M)}}}]);var x,w,T,A}(k$e);function qS(y,C,x,w,T,A,D){var M,B=y._ImgManager.convertClientIndexToServerId(x);if(-1==B)return kt(y),U.isFunction(T)&&T(y._errorCode,y._errorString),!1;if(M=y._innerFun(C,It(B)),A)return M;var H=1==M;return H?(D&&(zn.refreshImageAfterInvokeFun(y,x),y.getView().ClearSelectedAreas()),U.isFunction(w)&&w()):U.isFunction(T)&&T(y._errorCode,y._errorString),H}function tfe(y){return U.isFunction(y.arrayBuffer)?y.arrayBuffer():new ge.Promise(function(C,x){if(Ce.navInfoSync.bIE||Ce.navInfoSync.bSafari){var w=new FileReader;w.onload=function(){C(w.result)},w.onerror=function(A){x(A)},w.readAsArrayBuffer(y)}else{var T;wt(T={},-2856,"Cannot convert blob to array buffer."),x({code:T._errorCode,message:T._errorString})}})}Dn(wf,"_processing_getblob_queue",!1),Dn(wf,"_getblob_queue",[]),function(y){y.normal=0,y.balance=1}(SP||(SP={}));var nfe="data:image/gif;base64,R0lGODlhZABkAKUAAPyOFPzKjPyuVPzmxPy+dPyeNPzarPz27PzSnPy2ZPymRPzGhPyWJPzu3PzixPzOnPyyZPzChPyiRPzevPz+/PzWrPy6dPyqVPzOlPyyXPzq1PzCfPyiPPzetPz69PzWpPy6bPyqTPyaLPySHPzKlPyuXPzmzPy+fPyePPzatPz29PzSpPy2bPymTPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCQAxACwAAAAAZABkAAAG/sCYcEgsGo/IpHLJbDqf0Kh0Sq1ar9hslXI4aEwHFUVLLicpjUBrBACMFKTG2Ewne1Khtl4fSnnqgFYUFSJ7hgAiFXOBjE8mDIeHIyaNlUweGZGRGX+WnkYTL5qHIhOfp0MubKN7Iy6oUhQwDSYmDTBPHiyshyydsEwUJgslCiIFCgkPcpcJvIYJv8BJBy4okW8r0kceIM97LIvTRw0Cq5ojBNtGqt9uC08qGisnBA9g4loHAt8jESpKJhT6VqqJMALn3AiYsE7QAneIFCVRkelbiYZFKDhooanAinxWHFyDKABXEhMJ0VFiAkMBqwITQE6hEAGinhRKBg3UlEim/pENzwQcyAKDn00AJ3wKucMxUogKGIsc2DlqhIMsGjgcBRBC6dI0Cla9IaHBKxEHKTWRyGKCqjsUZpeqOFArTFwiK9JGIsDW7TcOd7FU0HuIL5asWwVELfPo2wOiELYuCHzFQ4FnIzRkoYCBsCYGVz3lZZVuMRQNLiGyGOrpQORRClZuHv2tgAPKWNBA0KvgdhkPJzzrYfDBNB0uKwowYDCCQYETMHA78RDB7x6P42J4MFFhhQPWgA4YKJGWAQgHxrObkdXhhAAOHDK4wKd+GgUKHu5Lr8+/v///AAYo4IAEAgODBhNoYFKBdVCgAQkKMDdCcwq40EB6DDoBAwbW/rUhwgMLZlhFA7vxMkICmolIxQEhCLeHUCpK4YEzNvkiIhomOGACDKYNdhQDFWR4wAMCiMKAAA+AZ8QBFR2VgZIBwsACJHswwEKIRAi0FSKmDEjBLtiEYwQFJGzZBgb7eWICabIN4QEBZiKFISxAsRLBkmBumQCU/pXASwZL0rjlagMaNQqgRbwZpzoDnsDLnRmVaSYJaVoygGeTHKHlVgV5mWcvMjG5JQR8/icllcOBgCURKaDqDgM4MXgAAgJAciQCpbopqDs2ZugBDDnaYhwMF7jYxggwxihFAxm4OAIEKSq77AMdIoJBA9JW4UEDLkQ4IYUWzpmtEgcmuOq4/uimq+66/qHhwAQfVDABGOxGodECFyjnBgMoZBAAM/UuAcMJl6HDAQniZiuMVt9AAHDAQ1AwAcPuCIAtxENo0JRNECTs664QjUApxg7EycHFp/x64XpNbjVCAJVS4cAGJQhggR9kaFCtRecCsqmHk2mxgqtbFdAmIw5Y94EWNcUJAKyWeFDnISF4fIQFTrcRZCUw+BmJCNFagXXWWzdSFE9HUzG1mQwYYIkKYx+iQK5RPGAsKyKEVkkK1r2SRdJOh4ByIx48ZEgJdEfhwcYuJ/UJBSu0UIAIEriQuBQVxFnAALBsR68ZBzBuEwExC0hBBzt31LMRKqRAAAEpAESgYgfU2sSB3kscsOueBXqQnDshxOTECocsXeDpokeCImWv7QFBhlxUEIIIEx7LgAgQoBeF13sgeqMJD7gAAgEurPAwFHYb8hjGT4iqB6nsPyELkSWAWHr8+Oev//789+8/u0EAACH5BAkJADEALAAAAABkAGQAAAb+wJhwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+0uPY1JJ+XQeLxob2OhYAAAjNaika5fKYPL6M0HjC4DFHaDUSYofYgAKCaEjUweAomJAmeOlkYOe5J9Iw6Xn0MEm4kEoJ8UCqOICoKmUB4aJiYNrU4UHKp9HLWuSwcBAhwoBQolFZVMFC25fC28vUceFQWSIyEOz0gWzG8W0EoeLm6jIilNmdyeUBQNsg3IXhXjqhyMX5G5lK8uF8IKJ3S8HKDGjQU8JA5wjeKgzkmDEprejECBrYsLbm/KJXOgJ9Gfik5g4EtUwJ4WSBjfLDiIpEGENm8YKIgQ0NaKiKRYVtGgEGP+Ahi2NExIkWKChmy+QKgKUROLA4IYBTQddCCEqpJbBhxKKQCoowMXVC3aokFCSgAsDljycELVhalWUKZ0gTQNBQPzEI2IUJdKBZxiB3xSsQHwm65dPFhlNmKDzkEwXIjowwAC3CxPmbXwCspDCgICLrBYoRYNhRRQPba4bImChwMHPPTVYoLFZEQcInD+tjbFAgglSrAgYeIxb0KvYcA4MPu48+fQo0ufTr269evYs1t3DaOBdxiytXOB8VnBixEiJJwwsFt8lQEl8vJhUEKweyoUKvTcxMFA8/tG5HdbLiJU8B+AQzSwXy4csDYdBTBoAMOBF521gHYutcBBCBv+OCgEDANiVEB70lHgQAs4tRBIEvKcBUcF1x1QgiQllHbEAi6+EcF16HjUkBHb5OiNdRiMgkESSgl5HQmjkJAEji7uxaNhfvxYRItnMQCjdQeM1IcANhoBoosjXodHKn2oOBuUKV2YXQMnhCBBCAAxoWBKDYoHoYQHCshNgQciKER+CybCgYGCRuFAfJLQZ2WiIVVAgAQijPCCBARUQCKktnjQ3XfhcSrqqKSWauqpqBbhqSwTppqMCScoUIAIBRTQAgm0uGqEBw5AQCUcAAWaKAUPpLaJAiClSsEKL2AkwaOknmZsLkyl2oCXGFkgrHb5/aoKAx7aQcG2T3gwY47+ALgAigoYXCBHuFIc4G0urDThGmyhTqHCYm+gYJ8WDqD7RgHhHjABBhFYAEIEGEwQ5hMBJFICuUoYIDAAIpi06wolTFtACSsYF80yej1sRQUXZ3wEOyHIhwgDTAXqAZqImFzFBBcTvOsEhW6CwgSBioIbxUnAcLEEB5loFp7JKqHBVhkhelLP3IAgJrbcXGDzEb3uEUIKIktBAQnzbjLCv0NEIPCOnXqQ7xYN0JwSBM+Mia4Im4JCrMtXPfpA2aOM8IBzB5wAeEYrPENBAhcDkADRaHhAAN+IFBCymCQLvNlzKjygwK8jCJACUnderAC8l7CDweecQKBpXWU1zoFdBiWCYUIFKZgQ22xxN346qR6EdbEAKpQqtMCllDrB4dVMYCoF/LoYAuTVpUD5t+acKnmOJ4QtKAwgMD8CC3mPWvj180WwdakeIICi2S0g4P2o7KwgAE6hr5ArKEEAACH5BAkJADAALAAAAABkAGQAhfyOFPzKjPyuVPzmxPyeNPzarPy+dPz27PzSnPymRPy2ZPzGhPyWJPzu3PzixPzOnPyiRPzevPzChPz+/PzWrPyqVPy6dPzOlPyyXPzq1PyiPPzetPzCfPz69PzWpPyqTPy6bPyaLPySHPzKlPyuXPzmzPyePPzatPy+fPz29PzSpPymTPy2bPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJhwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+16v+CweAydRCyVjyUyIbujkwYGQK9jGu23Xtkg1f8AJA17hEYdLSKAdSItHYWPMA0Jin8Jg5CEA4mUdCIlmIQRnH8OoGUvJSUHeVAlm5yepkwTLyMaIrgMCQWrT5KjAJaySh0OK5QiGBmsS4evgCIBjsNHZhrAApdNfZyCVRPTYS/HwAAszEq0JM8iguhNcQYrGiwO71oj5XQMEWURIAIqrLk36wSDPyIWhNsy4Zo+ACgIisngEGG/Lg0OPqxwoFCAZ3a8OAA5StieDhY4aViYxdXDYNreTDDACQJLLC806hPQkdD+A5IAQHiZ8OGhCAkSxZFDmOELBaCAQjR91KCCRhEJ2Hw5oKAcI1AHEKBA8QAPmAkZKowSAaInqAlJtcRhobNOiBYvqOkxY0FAghUCUMTUK/NAhgYp4hJezLix48eQI0ueTLmy5cuYM397kaFEhheKNS+Z4ICDAA0mNAjgYE/0lA4oQigSEQLFTdd8BJTLhrvJCxZQF7HI2zvJBA/B/zBQEVov3OYHILwM5jZyBw8QQkDwcLuIg+l0SklOseBVwhRL8oEfMdmB7D8ELiahCd6A5AkXKD1IigI8APuRTfCAfkkF4B97kkXwnl3yIfEdeOJFdoAE5klQ3REHTPJSAhf+PnZddtt1R8QEKtQ1ynLNUQNOir8lB4AIwxW3RAO6YTOYjEd0YMCCf9QmIo5EFCOBABBoAIEAEjjwI5BF0JJKCaAxKeWUVFZp5ZVYPgHOCy8kluURL5yAAgYkCICBAWWN8VwHHcAFSgoPJGDiiyZIEGUXHTSgAgYmMMCABiBEcKceHZSgITAhULBkFAdcIN1sHyi61wmP6sPAA4s68ducPbaQ4hUlVPRQCB58ikQHfujDSKZXZOgfAARESEUHC0yXqKlwGPgqABiwikQJJoAnAHFgvFCpf7HMKgGyJ4hBAacvcVBFA0X5ZwGuTsy0ax0QYAtDCTy+tBIYB8yxLaz+Nzox0qsMZFqMCi20oIKSS7yg1rkhfDLFusj+SIstDOCSiwYjDFoEjecCkC8VA7jwKgESdUCBqIpowB2GqW4bQrrbHDqdAgR18AC0yu1nSErnjjvFASC8ylw1Jb7kQqlGjOAiMBhYcUK45ZjUpAPBTmdCa0RkQMC5DUrRQcsvMXDBPSnQVx9L2u66gq9INHAsMCx0KEQGPOvjwo0NhF0OAxR4S4ShXmFArBEIbIuAESTejBAKXk/RAAhhi0CABOglwcK2LOT4gNmzWZA3FSkUYEECIYjAQAgfJLlkta9WcKoKR59t4Rd5luCAAyWYxcRS/q1g3AAKBFfBCVi7kbFpfyQ0U0ILkIcQAgH0OODlYhxsK20THXAGZeyhbJt0cS9Q/JAGb8sooN2LmCzlC+a+pED0QJaw9SgQTEVlHB8kJ8IKplv5ggS3zKaBnV/CUOgICiRAAAEJKDBCCcj3NsEBDThMA3qBiSAAACH5BAkJAC8ALAAAAABkAGQAhfyOFPzKjPyuVPzmxPyeNPy+dPzarPz27PzSnPymRPy2ZPzGhPyWJPzu3PzOnPyiRPzChPzixPz+/PzWrPyqVPy6dPzOlPyyXPzq1PyiPPzCfPzevPz69PzWpPyqTPy6bPyaLPySHPzKlPyuXPzmzPyePPy+fPzatPz29PzSpPymTPy2bPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+wJdwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+16v+CweEwum4sS1yYg2rgk53gzIgDYQ5SIfI9sJOyAAAkNfIVCEgWBgSZwhnsNKoqAKoSOchh/koIYlnKQmoKVnU4SHByNUoghmoyjTRwRDiwBKSSoUA0PkoOuTC4VBKsAIRkWKFN0gHh6vUouI5ohEAepaiIBbreppdpeHB+gww7dcQ0LCSUFtmERBOEAKtSFB3WADwNgEg7vw5yFKZJWkMPCYQE/ABsMXZAEYuAVDiwOJiwETlEJh1YkpBAGKoSoPScktfpCIsM7AfL4cFgRiMLHLhJEMAAFYgNGMhIiFKgwISX+GBQaOAICkYJDszIHHCQQFmLEBqNHy0g4QGJDhAYHbkbdyrWr169gw4odS7as2bNow3BwgcEF1LRVOJwoQCHBgwQUCpx4C7fJ1BPBopXoqRWuBAwrhEZbgaEw1QEkfH5t4EFxRw8v0TQokAGE5wcFGhR2hKLeQUAjJA9BkcKdJAIpVPfiUMAyvxAF+AopaPvOAt29NoA4zXDiEAkTZr5r0WF0HBQmeh80wZfyacxRG5gkLimDKAknpAcKccK5mQjcoxmXYJD4AvNlEKTXlGLISu4rgFuKOF9RAPsVnfaBfo6I0J8iLBwHAXcQEGgIQAcCUt8h4Z1GHnxkoBfhMMz+CGHdQS5lt92B3hGBXAv8MIchGSgkEqEJkvEWTgi/cSXcgQQYRwRrrikC2zFc0dZfCBUQKMFmnXmWQWgrxnEABfN5IFsRLpAQAQkujPXhQSF44E9fSByW2G2MNSmWBChMUIJtIQyWFZhOyEVXAhngpZeDcCpxAFsuTJnnn4AGKuigUJRyAgsfrLDABG+MUYoLDTTgliMSkGCCcoooEAGQXhyQQgEjJKDCBRA8pVIKI2oCwjQwRTACpoAQ8EFmY3AgAoq3KYBnFBykMFw4GXSIkwOwvhMCdVqcUKwmJdBKUgnpMdAcFgek+s6AZHBgQn8jZHmFBdzVRMYBy3Kp4xT+B0TCHbJiTPCimS+Q0ONp3Y6x4IEe7LrEjdzxIkaA82WgrxIn/Eqcv0uU0kAEKaRw1SlMsHRgCQMn0U56FHjrzAkCCBWCACf4KcS2+FaMhAuZEFeByC808EG5ADAwqxIQ9odtFYhwx0AKGLmggnjwaGxEAxFOAG/LBvOTmp6m8YNSmAvNl8CXVlgANAAgCGuErVffIcJA/BIXgggmKwGdeAwggNGW1zl7NncXCH3FASIkrUwGey1RIXfkJeGCAl2X2EUDJqhQAggElOCBBXIfAVF/LDhIG8x2MHCBs1hMNcAGG5DA6RLf9FekEr2+KkkICYjQeCcoSJzeCiynsYFdBgJkUIIABUzQQNlnCDkfu0yUYoopR4uhT3/jDBqB3fxkTegBUROnAMtwXXxajoQe4sDVISSf/QsQUR5z5N/bd4IKyzKgQt7lE+GpAnXhpUBs7YcJKQYH8F6/IUEAACH5BAkJADAALAAAAABkAGQAhfyOFPzKjPyuVPzmxPy+dPyeNPzarPz27Py2ZPymRPzSnPzGhPyWJPzu3PzixPzOnPyyZPzChPyiRPzevPz+/Py6dPyqVPzOlPyyXPzq1PzCfPyiPPzetPz69Py6bPyqTPzWrPyaLPySHPzKlPyuXPzmzPy+fPyePPzatPz29Py2bPymTPzSpPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJhwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+16v+CweEwum5EUynkd7Uwuo0mHTVemTCEAIGRK1f9FFyJ6eiIjUhQdBygBJgQLIA0daoBPFAWEhCeUTm4qDJmFJCAHnJVKBy6hAAwHTwcLeauEDCoNp0yXq5tOLxWDs6EfGbhLI8CFh00HHsHBw6bFRAd4enyuuQHOzirYXB0ZICgN0VEHb3FzTS+y26sMIOVWvgUMLgUt8lBpUC3uzgLUZWmAKRQGb2QObPjn7FaWDghmGdLnxUE7hqFYaMlwMROJF2ZAgMK4SoMWFKpmJSBW5gEykoRUaOEwctVKMw9qwtTjQQv+wWAQEIoRuTPTAi0UTMxiwIJilxIdYYLY0gGCThcBnHbp8KGoHgYgtxx4IGBDAggG6LDwCkCFQKQvSmQoRUdh0RATtErbR5SkiAhv92LpkBOjiApCBWMZqzPY4bCKvxk4sS1EgMSRs1AYKyCECwagQyRoQS6zGAoZULB4AKKEH9OwY8ueTbu27duyOzRAYQJDAgwmxgXGHYVCgxYFQ+ErTbz4BAHuBOS1xM82BQ7JtxWYroTCCwcXTDxw8EJvsRIpGYYo0X0CBmQMMHCH3YHETgzDh6DITqgAB9koNPYPAyggwY4zIUAWGUReITAcBRq4o4F5dWQggVc3FXHACu7+rIBZMRNEpd4ERmSw0DYbsBSZAenB5EJaRZjozgkqKhagVwzAOE0C7iTwIS4heoWXERC6YwKFdGTAY1EZFnFgMAnSB0GD+cGw3ywFFBjbjTDBkwQF7tUU33ymHWAfTCRUKYR3DoygwQjkIVlJCQIiyF4TaciJC5j8BbOdnriBacFLoYhgAZnN4dnAAn0CsBygicKgGwe9/RbcC2pGqummnHbq6aeghlpcnqJa8p0CLWjwwASSkKFbBhmUd8oLCghA6AYBZAApniAgkIAEG6ygwp11NGCVYxY4sOuXDRBA6B6XLUtFA0tWxoG0RVDgQLWzfLTGC2f+E4JDWbxgwT/+BGBrSWEYEZApFC7944IDZrwAHUknDPBQo7OooG4TEzzrTj5YZCCwSgqCQcEDRXnwmhUoHLzKBsSGQUEERXl7RcQYUYyInEllnPAUJUgcSgLkMnFACRMowAIHJfxIBAUjFNXNYiLOAsG7QnTggAonIHOCB3IwEfBOC/DcRAUMiaAREx2MwO8JF7wrI0khaInFT9Hp1UEEJgMAWHcthJ3JzkiBwK8eTSrBsTsi/KdEBueO+A0HXa0iggoD6HVA3v98IDOYOWcyURfe4SHC4gwUwAJdTIDQ4jYvLsFnZSMoTYXPE0xQApJFkjSh5RlU0GcIGCibWQcqwORWEz4HUAFdBhioAMnDkaUQEUkOWpLCCy8coDkgFDBNUgX/mnaMYQGUOgRUGK3n/JqtM+TB8IkesDYhG4wsKpjc2oSo8xSUAMGzIkBQAvabJsIB0CGEcIIKciTf3AHeT69/qUEAACH5BAkJADAALAAAAABkAGQAhfyOFPzKjPyuVPzmxPy+dPzarPyeNPz27PzSnPy2ZPymRPzGhPyWJPzu3PzixPzOnPyyZPzChPzevPyiRPz+/PzWrPy6dPzOlPyyXPzq1PzCfPzetPyiPPz69PzWpPy6bPyqTPyaLPySHPzKlPyuXPzmzPy+fPzatPyePPz29PzSpPy2bPymTPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJhwSCwaj0gk5dDYPBaRx6ZxoCSv2Kx2yx2mThYDYExGfU6prnrN5r5WIbKcHFq92vg8m1ICzf9kLCVWeoWGRnwTgIsACoOHkIYHAoyMAgeRmXgPlZUPmqBdL3GdiyF3oalXDyKliyKfqrJFFBiujBiEs7MvLLeLLKhYFMS6u2olHL+AHCVXFC8lJw8PFQ4NxsdZJSjLfyjOSC8qGKRjDCAB2Npayd5zzUgZAgyvCifZ7EYvCu9yCsKGUHAgphODB/n0CbTlbwyEbIluicCnEAmnhrCMHFjR6haLBqAodMjQoEPCfea8nTIiod4vEQE6ZDrQwqUBFSeLXPSWkVb+gncfI1Fo0fGcBC0HSLy7ZKSDi3cMHERK4VIOiZwCSyj6pcBBvgYNcUIqwQxkFj5+SolwlJCsvxFY1WRgFhDLm5R/6tQl4vbdhbhdOhSUswIwkQMbLCiDZ+EEpiQvGlYwvIWCh6IAGJjtsiSDhCcLpGSogkXwuxBShUrAwGHChwwKKUR4h2HvoRePKw7AaxBhxVkdZv8SYPu3phckMDMyANv4rgYClP/hcNT5sQYmeJ9b8cj6sQ4lIgwGECKBBNLe2RE7kCHDC5Pp48ufT7++/fv48+vfn17kAfj8aQKNBAGY8IEJI2zwAmUBnlWBAE/J4QIJHsjUYB4paFDVHwz+RJDbhWq88FMpdmxxgAMbOFCcfR0Q5YoILViYBAUFgGBACAYIQNF+DWhnymZHdPBAhGQcJCN+wv2iwRUlaBdCOPh10M0yKBxZRAuMtKBfBj4yEkJzRyi1CAn6ObChK1ElwRAgGJR5ZilpIoHlIlrmx6VKYBrRJCBP6ielN1UmISSRY7jwgJX2aeDNks8UIMCNKAhQAIPO9fhLCEBC5oAEKjbYonSAwIgoiFgckACocohQIqlqZPhmkRp8yCoXFKgA4RwuCCDWrHu8sMEIBByY4IK86uEfgMUmq+yyzDbr7LPQRqveqNIicYAEF0SgwQgnZFotER2sFkJRISiAQBr+qXQQzQMqjEZpJiks8CoAqq6jyQEBTDnGPejq08ECpdR2nAWAMDCCrLtsMO8cdULy6SIM7HjMAWt2shIkBFWiAMKqnNDlHw0XQsEIpUA5y8ioAvLQIR0QUEoF2gS3DAj96tEBwZ2oELOiv4DAMRsdBFBKaruMvMxVkLRUiQErItGBA9kucIEE1B5RwcJ/RBDJARBUMkLVR5RQTkciGICByVc00M+LaBfSQFpziGBB00V04IGPIagA9hCsuFKYJhlAkJIBC9BNBAUeLy2xoCuUokCeW//6gQUPOLB33WtrfDkMDVT8R1fvqtFBCshyccItJ2gBTQvjxv1a6No07ndgFw2MgAEIIJCwQHf3UZB5JwqEnsLP9VGwWCkcwH4hJa6Q+S0Mc5YSsrQZpEyGCJBHS8EHpVigPIgvQICqCBAY3mwDFrzJgAXZP39ABQmQUkcFxH/r3wH4l/78/vz3T0QQACH5BAkJADAALAAAAABkAGQAhfyOFPzKjPyuVPzmxPy+dPzarPyeNPz27PzSnPy2ZPymRPzGhPyWJPzu3PzixPzOnPyyZPzChPzevPz+/PzWrPy6dPyqVPzOlPyyXPzq1PzCfPzetPyiPPz69PzWpPy6bPyqTPyaLPySHPzKlPyuXPzmzPy+fPzatPyePPz29PzSpPy2bPymTPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJhwSCwaj8ikcslsOp9QZad08lBOpUN0y+1CDyoMx8UQhVAYldbLbnMnDpAIQK/TRSDJxM3vIzsUDHaDdQwUHX6JfRMUIYSPACEUe4qVXSUKkJAKJZaeUB0EmpoEiJ+nShkuo5AMGahsGRQBEREXFGtLCKyaKrBREx0nJCFlcyIMKCslpkgQvJAQv09wAnOaIgQNlEYc0I8c003CBt8CA9xEjt+DBuMlFA8PHg4pihMn5ewsr0Yo7IPCKZlQYgUHYwwMWDiRjg0cfQBZ5BqCAaAdDEoORBD0SESCbW5SWLBYR0NDFSTp+EJyQBQrCw3cFEhJx0AnIhk4AnSFZML+iGusEjR7I4AmABER0nWoQJKAvSMlvEETcYJNiXU0BcTEKfUbpz8RAIKYGEWFzpQoBhRhhJWVpIZDGoAAaMCBlwVAUzLYYATQ2VaHkmRoy4vBSi4mjN6hcGSCBBZ57YhgoUdJicisRIzwklixiAJJwGBAYcwFBxJqmJT4m3lzlwCYAbqQsOQAFQoeTgx4yiQDRGiGvARSzOGmpRdF2RX30uA3SQxkE/mMDWnFUGAJjIp4ADdRAxbfGKhl44A6Lw5bP00owPpR0jYdVqTc3l1Rhwft62SLzqVBcnYirFBfJcIoEBsHI/DWBhzgfSMCBun9MkEDD5BgAAMJWRBBCQP+vpFBJrwECJI4QkzwQgYllJDBiJUcsAAK1DHAgQodkojKBBksIMAYyITAQQIPsGjjkEO8UIIEJ5wgQQkKEunkk1BGKeWUVFZp5ZVYZvlGCjVq6UcHDrTwAQQftODAdV76QRAGIQBlBgYcpplIBwWYZwiacr5xAmGEhFBAlyUaKWSe30HDQoQ9NbAChgysMKiWEwTAzgg1vlDRRS/kCcMBXZ3X5FoqRCYCjXm+YB4hImSaRAedDWICnleWYJFxR4TySCl5ZmBRPz2ZNYhhgEZpKoCqJvECCYOQUGyaKYAIjQL8EWFiBYxW8EKwUU7QwqSATujAtZrG1SArh4brxXr+fA7iJ6zmjjMcYOy228SabZkBQZzytpFCmBWQ2YIEn+br0AHxCmzwwQgnrPDCDDfs8MMQRywxlPhoAAEGBKQ28R8SyCGZASoU7EYHDaQI7pMdqJDuURFEy0cDC4DAAQcCjCDyJxKsTAcDNltygMf6vUrkBHOxYgCifMTXEaVDnnBqHRFUchUkAiw7jQlP06FAJe8SshyJE1xaGLZO+PqITTaGHR7ZTTiwMghIw8IUNAIlcsB/kkVwsyIUZA0AAZasRgjcRB7gXEd2VUKQAMUwEEICLg/UwAgGiqDACI8qEeooIgjtyb5WMPOGA+PWwYID2HawESQiQBC3lRkUTQhgP1+MwGfnr1fJ6iieO0FyBCxgyIEJZ+b6jyYo8LoxDOVxnvjyzPPy/PKCa8IArRsjN0rV0AtxX34McNe9EAd8gJkIH0QesbYw3oFCC2wzjOMDC0TwQAbxj6///vz3v38QACH5BAkJADAALAAAAABkAGQAhfyOFPzKjPyuVPzmxPy+dPyeNPzarPz27Py2ZPymRPzSpPzGhPyWJPzu3PzixPzOnPyyZPzChPyiRPzevPz+/Py6dPyqVPzOlPyyXPzq1PzCfPyiPPzetPz69Py6bPyqTPzWpPyaLPySHPzKlPyuXPzmzPy+fPyePPzatPz29Py2bPymTPzGjPyWLPzy5PzWrP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJhwSCwaj8ikcslsOp/QqHRKrUI7pcmk1LF6v9ZOxlNgmBmFSqYLbruRjQgDQK/TGZrGe/92YeyAdCIkLnyGYRWBigAVbIePThQXc4uADBcUkJpLDR+Vih96m6NGKJSfdgwopFMUHQcZEw4NBx2ZSx0LqIoLjqxMFA0KAiKpHigut0gHCLuBCAe/TR0vFsWKDBgOSgckzoAk0dJKFAstuxsoykXM33bQTi4vASwKa3wdLNe7IS/rQx0iuKvTawmFEipEFFMoIsEEX14ogDjnbkMJJKYGqsKloMAiBgsKgWmwYiAdBP+EdBoYasmLEJ9EsIDY6sE+dyIyHKEw4ub+JwYjUhJx4REVgwlfOpQ0SccEkg4evnmgSYSCiW8JhEI54NPdCqowXJDoameQyCQulu4ScdFKCaZ1Cpw10kDDKUsmRClxUHTtAy8c4NIpoDOJGBVlzhTwUEJrkZfuFniZIBgA4SYHsmwR5wQFTGcyvWSofGKuoRInvolQ4OXAXZaO2xzwBFovlQ7N4F4YZdOZii8UXrx2xsD2oxS0PxVo60UsUw2x3zhIXamFArBRKPAdKMA4JAoZMAwHcOIF9ikGPu/6wJxVBwUWToQIUWCFBtNggm/YJaDxOCEHDIACCrNEV8VBHpAFQAgRePcfKeAtsMIJBRRwwgcKNGDgg5r+UOBCA7RsyOGIJJZoIoQUiHjiHh5OcMECESwwwgTJrDiKCyYkEMI+IoSQgAn42ejGARf0pUiPF3AmZBsuRAVaBUEuOcUBEJgEj5RhaKBgJSJocJ6JWJiwwgYrmOAAWMGpN1AL/mB5kDeAiNBfSgf8IRgGStpYwn6LWGTEBFuuhdSSDViASndFEFAZHQQsmU+gAIiwwDrUVbYBoQk4s4JtkK6lIikTUGTUNkMsWkeeJaLgziqlmgoAqiSq+g2rQnSKighfjuPAeIGEQKoQfJJGqFqfJGBbIos2KuSjt7KwDqCViTCokA0IcKhxdVaGJ5YDBBvIBgMYkSZc/Xz6y0H+xMQ55xEB2VpWBLmS2IEDJnywwQdmntfOQCrAimUUDSQImgcO/ivFASMYGUiPI/hr8BQuaLBCCKcwEEKZDj9MhYccPMDCAiw8gIy5GkORIsklp6zyyiy37PLLMMcs88wcvvKhC7bQLAV4ERQVQgUToCyFGA3E26EDxNIRggJCR4KCAAVsgEFhHGaQHCAFcPAIBQrcxADV43SgwScCRPlFCgoDgIDRfBxQqSIhTLvHW98WvEkDkL5wCGWBXPZfA7uwZohrgQjA9h4uqBkIA1obUk6cckvTAbKLtHTIASxQUgDTHFIwgeJ1iBDUdwfIckDTQlBwwOkbd7S4CaifW0JlACp4EIB/Oz/9GQMfjJ7yC2+XV4ULE7wAAgpFq7wdICG0pzMuuT1z+MwNZKqIsc83kYEEi0gAdvbLXG2HBRmDL4Q+C7NgPhPOAVL2+kwEzEAxDBAMfzxamH3//vz37///AFxREAAAO2l6MlNnMjJPaEJTY1lvVkpORFI0dmF6ek1tK1ZrditmL1VXWmxseUxSc0NPYk4vVU5kVVRWeThHRmlpUWNqNWQ=",Sf={loaderBarClassName:"ds-dwt-loaderBar",loaderBarBackgroundColor:"",loaderBarSource:de.bIE?nfe:ge.loaderBarSource,loaderBarSourceIE:nfe,loaderBarWidth:120,loaderBarHeight:120,errorMessages:{limitReachedForZoomIn:"Error: You have reached the limit for zooming in",limitReachedForZoomOut:"Error: You have reached the limit for zooming out",insufficientParas:"Error: Not enough parameters.",invalidAngle:"Error: The angle you entered is invalid.",invalidIndex:"Error: The index you entered is invalid.",invalidHeightOrWidth:"Error: The height or width you entered is invalid.",imageNotChanged:"Error: You have not changed the current image."},generalMessages:{checkingDWTVersion:"Checking WebTwain version ...",updatingDService:"Dynamsoft Service is updating ...",downloadingDWTModule:"Downloading the Dynamic Web TWAIN module.",refreshNeeded:"Please REFRESH your browser.",downloadNeeded:"Please download and install the Dynamic Web TWAIN.",DWTmoduleLoaded:"The Dynamic Web TWAIN module is loaded."},customProgressText:{upload:"Uploading...",download:"Downloading...",load:"Loading...",decode:"Processing...",decodeTIFF:"Processing tiff...",decodePDF:"Processing pdf...",encode:"Processing...",encodeTIFF:"Processing tiff...",encodePDF:"Processing pdf...",transfer:"Transferring...",canvasLoading:"Loading ..."},buttons:{titles:{previous:"Previous Image",next:"Next Image",print:"Print Image",scan:"Acquire new Image(s)",load:"Load local Image(s)",rotateleft:"Rotate Left",rotate:"Rotate",rotateright:"Rotate Right",deskew:"Deskew",crop:"Crop Selected Area",cut:"Cut Selected Area",changeimagesize:"Change Image Size",flip:"Flip Image",mirror:"Mirror Image",zoomin:"Zoom In",originalsize:"Show Original Size",zoomout:"Zoom Out",stretch:"Stretch Mode",fit:"Fit Window",fitw:"Fit Horizontally",fith:"Fit Vertically",hand:"Hand Mode",rectselect:"Select Mode",zoom:"Click to Zoom In",restore:"Restore Original Image",save:"Save Changes",close:"Close the Editor",removeall:"Remove All Images",removeselected:"Remove All Selected Images"},bShowAllButtons:!0,visibility:{scan:!0,load:!0,print:!0,removeall:!0,removeselected:!0,rotateleft:!0,rotate:!0,rotateright:!0,deskew:!0,crop:!0,cut:!0,changeimagesize:!0,flip:!0,mirror:!0,zoomin:!0,originalsize:!0,zoomout:!0,stretch:!0,fit:!0,fitw:!0,fith:!0,hand:!0,rectselect:!0,zoom:!0,restore:!0,save:!0,close:!0}},dialogText:{dlgRotateAnyAngle:["Angle :","Interpolation:","Keep size","  OK  ","Cancel"],dlgChangeImageSize:["New Height :","New Width :","Interpolation:","  OK  ","Cancel"],saveChangedImage:["You have changed the image, do you want to keep the change(s)?","  Yes  ","  No  "],selectSource:["Select Source:","Select","Cancel","There is no source available!"]}},Ms=U.mix({},Sf);function ife(){var y;Ce.DWT&&(y=Ce.DWT.CustomizableDisplayInfo),y&&(U.isString(y.loaderBarSource)&&""!=y.loaderBarSource?ge.loaderBarSource=y.loaderBarSource:de.bIE?(ge.loaderBarSource=Sf.loaderBarSourceIE,ge.loaderBarSourceIE=Sf.loaderBarSourceIE):ge.loaderBarSource=Sf.loaderBarSource,ge.loaderBarClassName=U.isString(y.loaderBarClassName)&&""!=y.loaderBarClassName?y.loaderBarClassName:Sf.loaderBarClassName,ge.loaderBarBackgroundColor=U.isString(y.loaderBarBackgroundColor)?y.loaderBarBackgroundColor:Sf.loaderBarBackgroundColor,ge.loaderBarWidth=y.loaderBarWidth?y.loaderBarWidth:Sf.loaderBarWidth,ge.loaderBarHeight=y.loaderBarHeight?y.loaderBarHeight:Sf.loaderBarHeight)}var rfe=!0;function Q9(y){var C=y,x=window;if(x.ShadowRoot)for(;C;){if(C instanceof x.ShadowRoot)return C;C=C.parentNode}return null}function Z9(y){var C=window;return!!(C.ShadowRoot&&y instanceof C.ShadowRoot)}ge._funsAfterConfigLoaded=[],ge._safePromptCustomMsg=function(y){y&&y()};var pd,eW,tW,nW,iW,rW,oW,sW,aW,lW,cW,uW,dW,hW,fW,pW,gW,mW,vW,yW,_W,CW,ofe,Yp,KS,bW,xW,bc=lr,uh={background:"#434246",topMenuBorder:"",innerBorder:"",promptToSaveChange:!0,buttons:Ms.buttons,dialogText:Ms.dialogText},F$e=function(){return g(function C(x,w){l(this,C);var T=this;T._stwain=x,T._ImgManager=x._ImgManager,T.zoomInStep=1.2,T.zoomOutStep=.8,T.MIN_ZOOM=.02,T.MAX_ZOOM=65,T.MAX_ROWS=128,T.MAX_COLUMNS=128,T.__MousewheelValue=0,this._Init(w)},[{key:"_Init",value:function(C){var x=this;if(x.borderWidth=U.isUndefined(C.borderWidth)?1:C.borderWidth,x.BackgroundColorByDefault=C.BackgroundColor?C.BackgroundColor:"#FFFFFF",C.BackgroundColor=x.BackgroundColorByDefault,x.BackgroundFillColor=x.BackgroundColorByDefault,C.onTopImageInTheViewChanged=function(T){U.isFunction(x._stwain.__OnTopImageInTheViewChanged)&&x._stwain.__OnTopImageInTheViewChanged(T.index,T.bByScrollBar)},C.onGetImageInfo=function(T){return{width:x._stwain.GetImageWidth(T),height:-1}},!x._stwain._viewer&&Ce.DWT.UseDefaultViewer){var w={viewerContainer:{},viewerEvents:{topPageChanged:function(T,A){x.__topPageChanged(T,A,x)},click:function(T){x.__click(T,x)},rightclick:function(T){x.__rightclick(T,x)},dblclick:function(T){x.__dblclick(T,x)},mousemove:function(T){x.__mousemove(T,x)},pageAreaSelected:function(T,A){x.__pageAreaSelected(T,A,x)},pageAreaUnselected:function(T){x.__pageAreaUnselected(T,x)},dragdone:function(T){x.__dragdone(T,x)},onDrop:function(T){x.__onDrop(T,x)},pageChange:function(T){x.__pageChange(T,x)},bufferChanged:function(T,A){x.__bufferChanged(x,T,A)},onBind:function(T){x.__onBindViewer(T)},onUnBind:function(T){x.__onUnBindViewer(T)},save:function(T,A,D,M){return x.__save(x,T,A,D,M)}},viewerError:{setError:function(T,A){x.__setError(T,A,x)}},imageEditorEvents:{acquire:function(T){x.__acquire(x,T)},loadImage:function(){x.__loadImage(x)},deskew:function(T,A){x.__deskew(x,T,A)},removeImage:function(){x.__remove(x)},removeAllImage:function(){x.__removeAll(x)},close:function(){x.__close(x)}},imageEditorServerCallback:{rotateRight:function(){x.__rotateRightForServer(x)},rotate:function(T,A,D){x.__rotateForServer(x,T,A,D)},rotateLeft:function(){x.__rotateLeftForServer(x)},deskew:function(T){x.__deskewForServer(x)},crop:function(T){x.__cropForServer(x,T)},erase:function(T){x.__eraseForServer(x,T)},changeImageSize:function(T,A,D){x.__changeImageSizeForServer(x,T,A,D)},flip:function(){x.__flipForServer(x)},mirror:function(){x.__mirrorForServer(x)},restore:function(T){x.__restoreForServer(x,T)},save:function(T){return x.__saveForServer(x,T)}},beforeImageEditorCreated:function(T){x.__beforeImageEditorCreated(T)}};C.Container&&(ft.isNodeList(C.Container)||U.isArray(C.Container)&&C.Container.length>0)&&(w.viewerContainer={container:C.Container[0],width:qs(C.Width),height:qs(C.Height)}),x._stwain._viewer=new Ce.DWTViewer(gC._getBuffer(x._ImgManager),w)}else C.Container&&(ft.isNodeList(C.Container)||U.isArray(C.Container)&&C.Container.length>0)&&x.__onBindViewer(C.Container[0]);x.__InitEvents(C)}},{key:"dispose",value:function(){}},{key:"__InitEvents",value:function(C){var x=this;U.isFunction(C.onTopImageInTheViewChanged)&&(x.onTopImageInTheViewChanged=C.onTopImageInTheViewChanged),U.isFunction(C.onGetImageInfo)&&(x.onGetImageInfo=C.onGetImageInfo),U.isFunction(C.onZoomChanged)&&(x.onZoomChanged=C.onZoomChanged),U.isFunction(C.onMouseMove)&&(x.onMouseMove=C.onMouseMove),U.isFunction(C.onMouseClick)&&(x.onMouseClick=C.onMouseClick),U.isFunction(C.onMouseRightClick)&&(x.onMouseRightClick=C.onMouseRightClick),U.isFunction(C.onMouseDoubleClick)&&(x.onMouseDoubleClick=C.onMouseDoubleClick),U.isFunction(C.onImageAreaDeSelected)&&(x.onImageAreaDeSelected=C.onImageAreaDeSelected),U.isFunction(C.onImageAreaSelected)&&(x.onImageAreaSelected=C.onImageAreaSelected),U.isFunction(C.onBufferChanged)&&(x.onBufferChanged=C.onBufferChanged),U.isFunction(C.onSelected)&&(x.onSelected=C.onSelected),U.isFunction(C.onRefreshUI)&&(x.onRefreshUI=C.onRefreshUI),U.isFunction(C.onResetCurrentIndex)&&(x.onResetCurrentIndex=C.onResetCurrentIndex)}},{key:"GetWebViewer",value:function(){return this._stwain._viewer}},{key:"SetSelectedImageArea",value:function(C,x,w,T){if(null!=this.GetWebViewer()){var A=[],D={};return D.left=C,D.top=x,D.right=w,D.bottom=T,A.push(D),this.GetWebViewer().setSelectedAreas(A)}return!1}},{key:"OverlayRectangle",value:function(C,x,w,T,A,D,M){var B=this;return!!B._stwain._isNoViewer()||null!=B.GetWebViewer()&&B.GetWebViewer().webViewer.overlayRectangle(C,x,w,T,A,D,M)}},{key:"ChangeImageViewSize",value:function(C,x){var w=this;return C>=0&&(w.GetWebViewer(),w.GetWebViewer().width=C),x>=0&&(w.GetWebViewer(),w.GetWebViewer().height=x),!0}},{key:"ChangeSize",value:function(C,x){var w=this;return w.GetWidth()!=C&&w.SetWidth(C),w.GetHeight()!=x&&w.SetHeight(x),!0}},{key:"GetWidth",value:function(){return this.GetWebViewer().width}},{key:"SetWidth",value:function(C){var x=C;return this._stwain._isNoViewer()||(this.GetWebViewer().width=x),!0}},{key:"GetHeight",value:function(){return this.GetWebViewer().height}},{key:"SetHeight",value:function(C){var x=C;return this._stwain._isNoViewer()||(this.GetWebViewer().height=x),!0}},{key:"SetViewMode",value:function(C,x){var w=this;return w._stwain._isNoViewer()?w._stwain._nouiNotSupport("SetViewMode"):w.GetWebViewer().setViewMode(C,x)}},{key:"SetIfFitWindowAndType",value:function(C){var x;if(null!=this.GetWebViewer()){switch(C){case 1:x="height";break;case 2:x="width";break;default:x="window"}this.GetWebViewer().fitWindow(x)}return!0}},{key:"GetAllowMultiSelect",value:function(){return!this._stwain._isNoViewer()&&this.GetWebViewer().selectionMode}},{key:"SetAllowMultiSelect",value:function(C){return this._stwain._isNoViewer()||(this.GetWebViewer().selectionMode=C?1:0),!0}},{key:"GetFitWindowType",value:function(){return this._stwain._isNoViewer(),0}},{key:"SetSelectionRectAspectRatio",value:function(C){return this.GetWebViewer().selectionRectAspectRatio=C,!0}},{key:"GetSelectionRectAspectRatio",value:function(){return this.GetWebViewer().selectionRectAspectRatio}},{key:"SetFitWindowType",value:function(C){return this._stwain._isNoViewer()||this.SetIfFitWindowAndType(C),!0}},{key:"GetIfFitWindow",value:function(){return this._stwain._isNoViewer(),!0}},{key:"SetIfFitWindow",value:function(C){var x=this;return x._stwain._isNoViewer()||(C?x.GetWebViewer().fitWindow("window"):x.GetWebViewer().zoom=1),!0}},{key:"GetImageMargin",value:function(){return this._stwain._isNoViewer()?0:this.GetWebViewer().pageMargin}},{key:"SetImageMargin",value:function(C){return this._stwain._isNoViewer()||(this.GetWebViewer().pageMargin=C),!0}},{key:"GetSelectionImageBorderColor",value:function(){return this.GetWebViewer().selectedPageBorder}},{key:"SetSelectionImageBorderColor",value:function(C){var x=C;return U.isNumber(x)&&(x=ed.getColor(x)),-1==x.indexOf("1px solid")&&(x="1px solid "+x),this.GetWebViewer().selectedPageBorder=x,!0}},{key:"GetZoom",value:function(){return this.GetWebViewer().zoom}},{key:"SetZoom",value:function(C,x,w){var T=this;return C<T.MIN_ZOOM&&(C=T.MIN_ZOOM),C>T.MAX_ZOOM&&(C=T.MAX_ZOOM),null!=T.GetWebViewer()&&(T.GetWebViewer().zoom=C),!0}},{key:"ZoomIn",value:function(C,x){var w=this,T=w._ImgManager.getImageIdMap(w._ImgManager.convertClientIndexToServerId(w._ImgManager.getCurrentImageIndex()));if(!T)return!1;var A=w.GetWebViewer().zoom,D=Math.floor(100*A*w.zoomInStep)+1;return 1<D&&D<2501?qs(T.imageWidth*A)>15e3||qs(T.imageHeight*A)>15e3?(lr.output(w,Ms.errorMessages.limitReachedForZoomIn),alert(Ms.errorMessages.limitReachedForZoomIn),!1):(w.SetZoom(D/100,C,x),!0):(lr.output(w,Ms.errorMessages.limitReachedForZoomIn),alert(Ms.errorMessages.limitReachedForZoomIn),!1)}},{key:"ZoomOut",value:function(){var C=this,x=C.GetWebViewer().zoom,w=Math.floor(100*x*C.zoomOutStep)-1;return 1<w&&w<6501?(C.SetZoom(w/100),!0):(lr.output(C,Ms.errorMessages.limitReachedForZoomOut),alert(Ms.errorMessages.limitReachedForZoomOut),!1)}},{key:"GetMouseShape",value:function(){return this._stwain._isNoViewer()?0:"crosshair"!=this.GetWebViewer().cursor}},{key:"SetMouseShape",value:function(C){return this._stwain._isNoViewer()||(this.GetWebViewer().cursor=C?"pointer":"crosshair"),!0}},{key:"GetShowPageNumber",value:function(){return!this._stwain._isNoViewer()&&this.GetWebViewer().showPageNumber}},{key:"SetShowPageNumber",value:function(C){return this._stwain._isNoViewer()||(this.GetWebViewer().showPageNumber=C),!0}},{key:"SetBackgroundFillColor",value:function(C){return this.BackgroundFillColor=C,!0}},{key:"GetBackgroundColor",value:function(){return this.GetWebViewer().background}},{key:"SetBackgroundColor",value:function(C){var x=C;return this._stwain._isNoViewer()||(this.GetWebViewer().background=x),!0}},{key:"Go",value:function(C){return this.GetWebViewer().gotoPage(C)}},{key:"__Previous",value:function(){return this.Go(this._ImgManager.getCurrentImageIndex()-1),!0}},{key:"__Next",value:function(){return this.Go(this._ImgManager.getCurrentImageIndex()+1),!0}},{key:"__fireEvent",value:function(C,x){if(U.isFunction(this[C]))try{return this[C](x)}catch(w){Fr(w)}return!0}},{key:"GetIfAutoScroll",value:function(){return this.GetWebViewer().ifAutoScroll}},{key:"SetIfAutoScroll",value:function(C){return this.GetWebViewer().ifAutoScroll=C,!0}},{key:"BindView",value:function(C){var x,w=C;return U.isString(C)?w=U.get(C):U.isDOM(w)&&(w.id&&""!=w.id||(w.id=["dwt_",U.getRandom()].join(""))),(x=this.GetWebViewer().bind(w))&&this.GetWebViewer().show(),x}},{key:"GetIfShowVideoContainer",value:function(){var C=this,x=C.GetWebViewer();return U.isUndefined(x)?(Ce.DWT.UseDefaultViewer?U7(C._stwain):AA(C._stwain),!1):x.webViewer.getIfShowVideoContainer()}},{key:"ShowVideoContainer",value:function(C){var x=this,w=x.GetWebViewer();return U.isUndefined(w)?(Ce.DWT.UseDefaultViewer?U7(x._stwain):AA(x._stwain),!1):w.webViewer.showVideoContainer(C)}},{key:"UpdateVideoContainer",value:function(C){var x=this,w=x.GetWebViewer();return U.isUndefined(w)?(Ce.DWT.UseDefaultViewer?U7(x._stwain):AA(x._stwain),!1):w.webViewer.updateVideoImage(C)}},{key:"ClearSelectedAreas",value:function(){var C=this.GetWebViewer();if(C)return C.clearSelectedAreas()}},{key:"OnCloseImageEditor",value:function(){return!!this.GetWebViewer().webViewer.imageEditor&&(this.GetWebViewer().createImageEditor().dispose(),!0)}},{key:"ShowImageEditorEx",value:function(C,x,w,T,A,D,M,B){var H=this;if(this._stwain._isNoViewer())return H._stwain._nouiNotSupport("ShowImageEditorEx");switch(A){case 0:case 1:case 2:break;case 3:if(H.OnCloseImageEditor())return!0}var Y,G=document;if(wf._getContainer(H._stwain)==M&&(D=!1),M){var q=Ce.DWT.ContainerMap;if(q){var re,se=Object.keys(q);for(re=0;re<se.length;re++)if(se[re]==M.id){D=!1;break}}}if(D&&M&&(U.isDOM(M)?Y=M:Z9(M)?(Y=document.createElement("div"),M.appendChild(Y)):(Y=G.getElementById(M))&&"DIV"!=Y.nodeName&&(D=!1)),D&&M&&U.isDOM(M)){var ce=Q9(M);if(ce){var ve,Te,Ue=ge.timestamp;return(ve=G.createElement("link")).href=[Ce.DWT.ResourcesPath,"/src/dynamsoft.webtwain.viewer.css",Ue].join(""),ve.rel="stylesheet",ve.async=!0,(Te=G.createElement("link")).href=[Ce.DWT.ResourcesPath,"/src/dynamsoft.webtwain.css",Ue].join(""),Te.rel="stylesheet",Te.async=!0,U.scriptOnload(ve,function(){U.scriptOnload(Te,function(){return H.ShowImageEditor(Y,D,w,T)}),ce.appendChild(Te)}),ce.appendChild(ve),!0}}return H.ShowImageEditor(Y,D,w,T)}},{key:"ShowImageEditor",value:function(C,x,w,T){var A=this;return C&&w&&T?(uh.element=C,uh.width=w,uh.height=T):(uh.element=void 0,uh.width=void 0,uh.height=void 0),uh.border=A.GetWebViewer().border,uh.selectionRectAspectRatio=A.GetWebViewer().selectionRectAspectRatio,uh.workMode=SP.normal,A.GetWebViewer().createImageEditor(uh),0!=A._stwain.ErrorCode&&(A.GetWebViewer().webViewer.imageEditor&&A.GetWebViewer().webViewer.imageEditor.dispose(),A.GetWebViewer().createImageEditor(uh)),A.GetWebViewer().webViewer.imageEditor&&A.GetWebViewer().webViewer.imageEditor.show(),!0}},{key:"__beforeImageEditorCreated",value:function(C){var x=Ce.DWT.CustomizableDisplayInfo;if(!U.isUndefined(x)){if(!U.isUndefined(x.buttons)){var w=x.buttons.titles;U.isUndefined(w)||(U.isUndefined(w.previous)||(C.buttons.titles.previous=w.previous),U.isUndefined(w.next)||(C.buttons.titles.next=w.next),U.isUndefined(w.print)||(C.buttons.titles.print=w.print),U.isUndefined(w.scan)||(C.buttons.titles.scan=w.scan),U.isUndefined(w.load)||(C.buttons.titles.load=w.load),U.isUndefined(w.rotateleft)||(C.buttons.titles.rotateleft=w.rotateleft),U.isUndefined(w.rotate)||(C.buttons.titles.rotate=w.rotate),U.isUndefined(w.rotateright)||(C.buttons.titles.rotateright=w.rotateright),U.isUndefined(w.deskew)||(C.buttons.titles.deskew=w.deskew),U.isUndefined(w.crop)||(C.buttons.titles.crop=w.crop),U.isUndefined(w.cut)||(C.buttons.titles.cut=w.cut),U.isUndefined(w.changeimagesize)||(C.buttons.titles.changeimagesize=w.changeimagesize),U.isUndefined(w.flip)||(C.buttons.titles.flip=w.flip),U.isUndefined(w.mirror)||(C.buttons.titles.mirror=w.mirror),U.isUndefined(w.zoomin)||(C.buttons.titles.zoomin=w.zoomin),U.isUndefined(w.originalsize)||(C.buttons.titles.originalsize=w.originalsize),U.isUndefined(w.zoomout)||(C.buttons.titles.zoomout=w.zoomout),U.isUndefined(w.stretch)||(C.buttons.titles.stretch=w.stretch),U.isUndefined(w.fit)||(C.buttons.titles.fit=w.fit),U.isUndefined(w.fitw)||(C.buttons.titles.fitw=w.fitw),U.isUndefined(w.fith)||(C.buttons.titles.fith=w.fith),U.isUndefined(w.hand)||(C.buttons.titles.hand=w.hand),U.isUndefined(w.rectselect)||(C.buttons.titles.rectselect=w.rectselect),U.isUndefined(w.zoom)||(C.buttons.titles.zoom=w.zoom),U.isUndefined(w.restore)||(C.buttons.titles.restore=w.restore),U.isUndefined(w.save)||(C.buttons.titles.save=w.save),U.isUndefined(w.close)||(C.buttons.titles.close=w.close),U.isUndefined(w.removeall)||(C.buttons.titles.removeall=w.removeall),U.isUndefined(w.removeselected)||(C.buttons.titles.removeselected=w.removeselected));var T=x.buttons.bShowAllButtons;U.isUndefined(T)||(C.buttons.bShowAllButtons=T);var A=x.buttons.visibility;U.isUndefined(A)||(U.isUndefined(A.scan)||(C.buttons.visibility.scan=A.scan),U.isUndefined(A.load)||(C.buttons.visibility.load=A.load),U.isUndefined(A.print)||(C.buttons.visibility.print=A.print),U.isUndefined(A.removeall)||(C.buttons.visibility.removeall=A.removeall),U.isUndefined(A.removeselected)||(C.buttons.visibility.removeselected=A.removeselected),U.isUndefined(A.rotateleft)||(C.buttons.visibility.rotateleft=A.rotateleft),U.isUndefined(A.rotate)||(C.buttons.visibility.rotate=A.rotate),U.isUndefined(A.rotateright)||(C.buttons.visibility.rotateright=A.rotateright),U.isUndefined(A.deskew)||(C.buttons.visibility.deskew=A.deskew),U.isUndefined(A.crop)||(C.buttons.visibility.crop=A.crop),U.isUndefined(A.cut)||(C.buttons.visibility.cut=A.cut),U.isUndefined(A.changeimagesize)||(C.buttons.visibility.changeimagesize=A.changeimagesize),U.isUndefined(A.flip)||(C.buttons.visibility.flip=A.flip),U.isUndefined(A.mirror)||(C.buttons.visibility.mirror=A.mirror),U.isUndefined(A.zoomin)||(C.buttons.visibility.zoomin=A.zoomin),U.isUndefined(A.originalsize)||(C.buttons.visibility.originalsize=A.originalsize),U.isUndefined(A.zoomout)||(C.buttons.visibility.zoomout=A.zoomout),U.isUndefined(A.stretch)||(C.buttons.visibility.stretch=A.stretch),U.isUndefined(A.fit)||(C.buttons.visibility.fit=A.fit),U.isUndefined(A.fitw)||(C.buttons.visibility.fitw=A.fitw),U.isUndefined(A.fith)||(C.buttons.visibility.fith=A.fith),U.isUndefined(A.hand)||(C.buttons.visibility.hand=A.hand),U.isUndefined(A.rectselect)||(C.buttons.visibility.rectselect=A.rectselect),U.isUndefined(A.zoom)||(C.buttons.visibility.zoom=A.zoom))}var D=x.dialogText;U.isUndefined(D)||(U.isUndefined(D.dlgRotateAnyAngle)||(C.dialogText.dlgRotateAnyAngle=D.dlgRotateAnyAngle),U.isUndefined(D.dlgChangeImageSize)||(C.dialogText.dlgChangeImageSize=D.dlgChangeImageSize),U.isUndefined(D.saveChangedImage)||(C.dialogText.saveChangedImage=D.saveChangedImage),U.isUndefined(D.selectSource)||(C.dialogText.selectSource=D.selectSource))}}},{key:"__topPageChanged",value:function(C,x,w){w.__fireEvent("onTopImageInTheViewChanged",{index:C,bByScrollBar:x})}},{key:"__click",value:function(C,x){x.__fireEvent("onMouseClick",{e:C,x:C.imageX,y:C.imageY,index:x._ImgManager.getCurrentImageIndex()})}},{key:"__rightclick",value:function(C,x){x.__fireEvent("onMouseRightClick",{e:C,x:C.imageX,y:C.imageY,index:x._ImgManager.getCurrentImageIndex()})}},{key:"__dblclick",value:function(C,x){x.__fireEvent("onMouseDoubleClick",{e:C,x:C.imageX,y:C.imageY,index:x._ImgManager.getCurrentImageIndex()})}},{key:"__mousemove",value:function(C,x){x.__fireEvent("onMouseMove",{e:C,x:C.imageX,y:C.imageY,index:x._ImgManager.getCurrentImageIndex()})}},{key:"__pageAreaSelected",value:function(C,x,w){var T=w,A=1;if(x&&x.length>0){var D=x[x.length-1];D.index&&(A=qs(D.index)+1),T.__fireEvent("onImageAreaSelected",{index:C,left:qs(D.x),top:qs(D.y),right:qs(D.x+D.width),bottom:qs(D.y+D.height),areaIndex:A})}}},{key:"__pageAreaUnselected",value:function(C,x){x.__fireEvent("onImageAreaDeSelected",C)}},{key:"__dragdone",value:function(C,x){var w=x;U.isFunction(w._stwain.__OnIndexChangeDragDropDone)&&w._stwain.__OnIndexChangeDragDropDone(C)}},{key:"__onDrop",value:function(C,x){var w=x;w.GetWebViewer().webViewer.acceptDrop&&w.__dropEvent(C,w)}},{key:"__dropEvent",value:function(C,x){var w,T,A=x,D=function(q){A._stwain._bIfShowProgressBar&&ge.closeProgress(null),q&&lr.output(null,q+" was loaded successfully!")},M=function(q,re,se){A._stwain._bIfShowProgressBar&&ge.closeProgress(null),A._stwain._errorCode=q,A._stwain._errorString=re,Wce({code:q,message:re}),se&&lr.output(null,se+" failed to load. Error code: "+q+"Error String: "+re)};try{for(var B=C.dataTransfer.files,H=0;H<B.length;H++){if(0==(w=B[H]).type.length){var Y=void 0,G=w.name.indexOf(".");switch(G>0&&(Y=w.name.substring(G+1)),Y){case"bmp":T=Ce.DWT.EnumDWT_ImageType.IT_BMP;break;case"jpg":case"jpeg":T=Ce.DWT.EnumDWT_ImageType.IT_JPG;break;case"tif":case"tiff":T=Ce.DWT.EnumDWT_ImageType.IT_TIF;break;case"png":T=Ce.DWT.EnumDWT_ImageType.IT_PNG;break;case"pdf":T=Ce.DWT.EnumDWT_ImageType.IT_PDF;break;case"jp2":case"j2k":case"j2c":T=Ce.DWT.EnumDWT_ImageType.IT_J2K;break;default:lr.output(null,w.name+" failed to load because the file type is not supported!"),T=-1,nle(A._stwain)}}else switch(w.type){case"image/bmp":T=Ce.DWT.EnumDWT_ImageType.IT_BMP;break;case"image/jpg":case"image/jpeg":T=Ce.DWT.EnumDWT_ImageType.IT_JPG;break;case"image/tif":case"image/tiff":T=Ce.DWT.EnumDWT_ImageType.IT_TIF;break;case"image/png":T=Ce.DWT.EnumDWT_ImageType.IT_PNG;break;case"application/pdf":T=Ce.DWT.EnumDWT_ImageType.IT_PDF;break;case"image/jp2":T=Ce.DWT.EnumDWT_ImageType.IT_J2K;break;default:lr.output(null,w.name+" failed to load because the file type is not supported!"),T=-1,nle(A._stwain)}-1!=T&&(A._stwain._bIfShowProgressBar?ge.showProgress(A._stwain,"DropLoading",A._stwain.IfShowCancelDialogWhenImageTransfer):ge.hideProgress(),A._stwain._OnPercentDone([0,-1,Lr.Loading]),A._stwain.Addon&&A._stwain.Addon.PDF&&pn.checkProductKey(A._stwain,{PDFRasterizer:!0},!0),function(q){var re=new FileReader;re.readAsDataURL(q),re.onload=function(){var se=A._stwain.__GetLoadEventsNum();A._stwain.__LoadImageFromBytesV2(q,T,"",!0,0,q.size,!1,se,D,M)},re.onerror=function(se){h0(A._stwain),A._stwain._errorString=this.error,M(A._stwain._errorCode,A._stwain._getErrorString())}}(B[H]))}}catch(q){U.error(q.stack||q,"error"),setTimeout(function(){throw q},0)}}},{key:"__pageChange",value:function(C,x){var w,T=x,A=T._ImgManager.count();U.log("OnPagination"),A<=0?ea(T._stwain):1!=A&&(!/^\d+$/.test(C)||C<=0?alert(Ms.errorMessages.invalidIndex):((w=qs(C)-1)<0?w=0:w>=A&&(w=A-1),w!=T._ImgManager.getCurrentImageIndex()&&T.GetWebViewer().gotoPage(w)))}},{key:"__bufferChanged",value:function(C,x,w){var T,A=C,D=[],M=-1,B=[];x.operation&&(x.action=x.operation);for(var H=0;H<A._ImgManager.count();H++)(T=A._ImgManager.getCustomDataByIndex(H))&&T.serverId&&D.push(this._ImgManager._serverId2uidFromServer(T.serverId));if(x.imageIds=D,x.curIndex>=0&&(T=A._ImgManager.getCustomDataByIndex(x.curIndex))&&T.serverId&&(M=this._ImgManager._serverId2uidFromServer(T.serverId)),x.currentId=M,"modify"==x.operation&&""!=x.afterStatus.modifiedUid){var Y=A._ImgManager.getIndexByUid(x.afterStatus.modifiedUid);Y>=0&&(T=A._ImgManager.getCustomDataByIndex(Y))&&T.serverId&&(x.modifiedId=this._ImgManager._serverId2uidFromServer(T.serverId))}if(x.afterStatus.selectedUids)for(var G=0;G<x.afterStatus.selectedUids.length;G++){var q=x.afterStatus.selectedUids[G];if(q&&-1!=q){var re=A._ImgManager.getIndexByUid(x.afterStatus.selectedUids[G]);re>=0&&(T=A._ImgManager.getCustomDataByIndex(re))&&T.serverId&&B.push(this._ImgManager._serverId2uidFromServer(T.serverId))}}x.selectedIds=B,U.mix(x,{}),delete x.uids,delete x.currentUid,delete x.selectedUids,delete x.afterStatus,delete x.beforeStatus,delete x.operation,delete x.curIndex,delete x.docUid,A.__fireEvent("onBufferChanged",x)}},{key:"__setError",value:function(C,x,w){var T=w;T._stwain._errorCode=C,T._stwain._errorString=x}},{key:"__acquire",value:function(C,x){var w=C;try{var A,T=!1;1==Ce.DWT.IfConfineMaskWithinTheViewer&&(Ce.DWT.IfConfineMaskWithinTheViewer=!1,T=!0),A=U.isArray(x)&&x.length>=3?x:Ms.dialogText.selectSource,w._stwain._selectSourceAsync("SelectSourceAsync",null,A).then(function(){return w._stwain.AcquireImageAsync({IfShowUI:!0,IfCloseSourceAfterAcquire:!0})}).then(function(){T&&(Ce.DWT.IfConfineMaskWithinTheViewer=!0)}).catch(function(D){U.log("User did not select a source"),T&&(Ce.DWT.IfConfineMaskWithinTheViewer=!0)})}catch(D){}}},{key:"__loadImage",value:function(C){try{var x=C,w=null;Ce.DWT.IfConfineMaskWithinTheViewer&&(w=!0,Ce.DWT.IfConfineMaskWithinTheViewer=!1),x._stwain._containerElement=void 0,x._stwain.IfShowFileDialog=!0,x._stwain.Addon&&x._stwain.Addon.PDF&&pn.checkProductKey(x._stwain,{PDFRasterizer:!0},!0),x._stwain.LoadImageEx("",5,function(){U.log("Loaded an image successfully."),null!=w&&(Ce.DWT.IfConfineMaskWithinTheViewer=w)},function(T,A){U.log("Loading failed with the error: "+A),null!=w&&(Ce.DWT.IfConfineMaskWithinTheViewer=w)})}catch(T){}}},{key:"__print",value:function(C){var x=C;is(x._stwain),x._ImgManager.getCurrentImageIndex()<0||x._ImgManager.PrintCurrentImage()}},{key:"__save",value:(y=yt(W.mark(function C(x,w,T,A,D){var M,B,H,Y,G;return W.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(B="save",is((M=x)._stwain),!(M._ImgManager.count()<=0||M._ImgManager.getCurrentImageIndex()<0)){q.next=4;break}return q.abrupt("return");case 4:return M._stwain._containerElement=void 0,H=M.__getViewerElement(M,D),Bo(B,H),q.prev=7,Y=this._ImgManager.getIndexByUid(w),G=this._ImgManager.convertClientIndexToServerId(Y),q.next=12,M._stwain._updateImage(G,T,A);case 12:if(!q.sent){q.next=19;break}return q.next=16,M._stwain.__saveToViewerAfterUpdate(w,A);case 16:q.next=20;break;case 19:case 20:q.next=24;break;case 22:q.prev=22,q.t0=q.catch(7);case 24:return q.prev=24,T=null,Gr(B),q.finish(24);case 28:return q.abrupt("return",void 0);case 29:case"end":return q.stop()}},C,this,[[7,22,24,28]])})),function(C,x,w,T,A){return y.apply(this,arguments)})},{key:"__getViewerElement",value:function(C,x){var w,T=C;if(x)if(T.GetWebViewer().webViewer.imageEditor){var A=T.GetWebViewer().createImageEditor();w="dwt-viewer-imageEditor-fullScreen"==A.inner.containerElement.className?{_containerElement:document.body}:{_containerElement:A.inner.containerElement}}else w=T._stwain;else w=T._stwain;return w}},{key:"__deskew",value:function(C,x,w){var T=this,A="deskew";is(T._stwain);var D=T._ImgManager.getCurrentImageIndex();if(T._ImgManager.count()<=0||D<0)bc.output(T,"No image in Buffer");else{var M=T.__getViewerElement(T,!0);Bo(A,M),T._stwain.GetSkewAngleFromBinaryAsync(D,x,function(B){w(B[0]),Gr(A)},function(){Gr(A)})}}},{key:"__remove",value:function(C){var x=this;is(x._stwain),x._ImgManager.count()<=0||x._ImgManager.getCurrentImageIndex()<0?bc.output(x,"No image in Buffer"):x._stwain.RemoveAllSelectedImages()}},{key:"__removeAll",value:function(C){var x=this;is(x._stwain),x._ImgManager.count()<=0||x._ImgManager.getCurrentImageIndex()<0?bc.output(x,"No image in Buffer"):x._stwain.RemoveAllImages()}},{key:"__onBindViewer",value:function(C){C&&(wf._setContainer(this._stwain,C),C.id&&(Ce.DWT.ContainerMap[C.id]=this._stwain))}},{key:"__onUnBindViewer",value:function(C){if(C){var x=wf._getContainer(this._stwain);x&&(x.innerHTML=""),wf._setContainer(this._stwain,null),C.id&&C.id in Ce.DWT.ContainerMap&&delete Ce.DWT.ContainerMap[C.id]}}},{key:"__close",value:function(C){is(this._stwain),wf._closeImageEditorUI(this._stwain)}},{key:"__rotateRightForServer",value:function(C){var x=this;is(x._stwain);var w=x._ImgManager.getCurrentImageIndex();x._ImgManager.count()<=0||w<0?bc.output(x,"No image in Buffer"):x._stwain.RotateRight(w)}},{key:"__rotateForServer",value:function(C,x,w,T){var A=this;is(A._stwain);var D=A._ImgManager.getCurrentImageIndex();A._ImgManager.count()<=0||D<0?bc.output(A,"No image in Buffer"):A._stwain.RotateEx(D,x,T,w)}},{key:"__rotateLeftForServer",value:function(C){var x=this;is(x._stwain);var w=x._ImgManager.getCurrentImageIndex();x._ImgManager.count()<=0||w<0?bc.output(x,"No image in Buffer"):x._stwain.RotateLeft(w)}},{key:"__deskewForServer",value:function(C){var x=this;is(x._stwain);var w=x._ImgManager.getCurrentImageIndex();x._ImgManager.count()<=0||w<0?bc.output(x,"No image in Buffer"):x._stwain.GetSkewAngleAsync(w).then(function(T){x._stwain.RotateEx(w,T,!0,5,function(){},function(){})})}},{key:"__cropForServer",value:function(C,x){var w=this;is(w._stwain);var T=w._ImgManager.getCurrentImageIndex();if(w._ImgManager.count()<=0||T<0)bc.output(w,"No image in Buffer");else{var A=x.left,D=x.top,M=A+x.width,B=D+x.height;w._stwain.Crop(T,qs(A),qs(D),qs(M),qs(B))}}},{key:"__eraseForServer",value:function(C,x){var w=this;is(w._stwain);var T=w._ImgManager.getCurrentImageIndex();if(w._ImgManager.count()<=0||T<0)bc.output(w,"No image in Buffer");else{var A=x.left,D=x.top,M=A+x.width,B=D+x.height;w._stwain.CutFrameToClipboard(T,qs(A),qs(D),qs(M),qs(B))}}},{key:"__changeImageSizeForServer",value:function(C,x,w,T){var A=this;is(A._stwain);var D=A._ImgManager.getCurrentImageIndex();A._ImgManager.count()<=0||D<0?bc.output(A,"No image in Buffer"):A._stwain.ChangeImageSize(D,x,w,T)}},{key:"__flipForServer",value:function(C){var x=this;is(x._stwain);var w=x._ImgManager.getCurrentImageIndex();x._ImgManager.count()<=0||w<0?bc.output(x,"No image in Buffer"):x._stwain.Flip(w)}},{key:"__mirrorForServer",value:function(C){var x=this;is(x._stwain);var w=x._ImgManager.getCurrentImageIndex();x._ImgManager.count()<=0||w<0?bc.output(x,"No image in Buffer"):x._stwain.Mirror(w)}},{key:"__restoreForServer",value:function(C,x){var w=C;if(is(w._stwain),w._ImgManager.count()<=0||w._ImgManager.getCurrentImageIndex()<0)bc.output(w,"No image in Buffer");else{var T=w._ImgManager.getIndexByUid(x);T>=0&&w.__RestoreImageInner(w,T)}}},{key:"__saveForServer",value:function(C,x){var w=C;return new ft.Promise(function(T,A){is(w._stwain),(w._ImgManager.count()<=0||w._ImgManager.getCurrentImageIndex()<0)&&(bc.output(w,"No image in Buffer"),T());var D=w._ImgManager.getIndexByUid(x);D>=0?w.__SaveImageInner(w,D,!0,function(){T()}):T()})}},{key:"__RestoreImageInner",value:function(C,x,w){var T=C,A=T._ImgManager.getImageIdMap(T._ImgManager.convertClientIndexToServerId(x));A&&T.__OnGetImageFromServerForEdit(A,x,1,function(D,M,B){if(D){U.log("__RestoreImageInner: "+[D.uuid].join(","));var H=U.clone(D);H.imageId=D.serverId,T._ImgManager.UpdateImage(H,B)}if(-1==(D&&D.serverId))return w&&w(),!1;w&&w()})}},{key:"__SaveImageInner",value:function(C,x,w,T){var A=C,D=A._ImgManager.getImageIdMap(A._ImgManager.convertClientIndexToServerId(x));return D&&A.__OnGetImageFromServerForEdit(D,x,2,function(M,B,H){if(M){if(1==w&&(U.log("__SaveImageInner: "+[M.uuid].join(",")),A._ImgManager.getCurrentImageIndex()==B)){var Y=U.clone(M);Y.imageId=M.serverId,A._ImgManager.UpdateImage(Y,H)}if(-1==M.serverId)return T&&T(),!1}return T&&T(),!0}),!0}},{key:"__OnGetImageFromServerForEdit",value:function(C,x,w,T){var A=this;if(T&&A._ImgManager.getBaseUrl){var D=A._ImgManager.convertClientIndexToServerId(x);if(-1==D)return!1;Ce.DWT.ConnectWithSocket?T():ru({method:"GET",xhrFields:{withCredentials:!0},url:lr.getUrlByAct(A._ImgManager.getBaseUrl,D,w),onSuccess:function(M){var B;C.ticks=Date.now(),B=Ce.navInfoSync.bMobile?lr.getImageUrl(A._ImgManager.getBaseUrl,D,Math.round(C.iImageControlWidth*devicePixelRatio),Math.round(C.iImageControlHeight*devicePixelRatio),C.ticks):lr.getImageUrl(A._ImgManager.getBaseUrl,D,qs(C.iImageControlWidth),qs(C.iImageControlHeight),C.ticks),C.imageUrl=lr.getImageUrl(A._ImgManager.getBaseUrl,D,-1,-1,C.ticks),C.minImageUrl=B;var H=A._ImgManager.GetMetaDataByIndex(x);if(H){var Y=A._ImgManager.getImageIdMap(D);H.width=Y&&Y.width?Y.width:A._stwain.GetImageWidth(x),H.height=Y&&Y.height?Y.height:A._stwain.GetImageHeight(x)}T(C,x,H)},onError:function(){}})}return!0}}]);var y}(),sfe=function(y){function C(x,w){var T,D,M,B;l(this,C),D=this,B=[w],M=qn(M=C);var A=T=$a(D,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(H){return!1}}()?Reflect.construct(M,B||[],qn(D).constructor):M.apply(D,B));return A._stwain=x,A.bImageJustChangedInEditor=!1,A.bImageChangedInViewer=!1,T}return qa(C,y),g(C,[{key:"getUidByIndex",value:function(x){return this._buffer.getUidByIndex(x)}},{key:"dispose",value:function(){return!0}},{key:"append",value:function(x,w,T,A,D){var M,B,H,Y,G,q=this;(this._buffer.isActiveFile||!U.isUndefined(D))&&A.currentFileName&&A.currentFileName.length>0?G=B=q.getCountByDocumentName(A.currentFileName):(B=q.count(),G=q.getCountByDocumentName(q.GetCurrentFileName())),H=q.getCurrentImageIndex();for(var re=B-1;re>=x;re--)Y=q.convertClientIndexToServerId(re),q.removeByServerId(Y,re);return B<x?q._updateUIAfterAdd(M=G,w,T,A,!0):(Y=q.convertClientIndexToServerId(M=H>=B-1?0:H+1),q.removeByServerId(Y,M),q._updateUIAfterAdd(M,w,T,A,M==x-1))}},{key:"insertBefore",value:function(x,w,T,A,D){var M,B=1*x;return(B<0||B>w)&&(B=-1),B>=(M=this.count())&&(B=M),this._updateUIAfterAdd(B,T,A,D,!1)}},{key:"exists",value:function(x){return!U.isUndefined(this.getImageIdMap(x))}},{key:"insert",value:function(x,w,T,A,D){var M,B=1*x;return(B<0||B>w)&&(B=-1),B>=(M=this.count())&&(B=M),this._updateUIAfterAdd(B,T,A,D,!1)}},{key:"moveImage",value:function(x,w,T){return this._buffer.moveImage(x,w)}},{key:"switchImage",value:function(x,w){return this._buffer.switchImage(x,w)}},{key:"setSelectedClientIndexArray",value:function(x){return this._buffer.selectImages(x)}},{key:"getSelectedClientIndexArray",value:function(x){return this._buffer.getSelectedImagesIndices()}},{key:"showImagesByFilter",value:function(x,w,T){return this._buffer.filterImagesByTag(x,w,T)}},{key:"clearFilter",value:function(){return this._buffer.clearFilter()}},{key:"removeImageTag",value:function(x){return this._buffer.removeImageTag(x)}},{key:"addImageTag",value:function(x,w){return this._buffer.tagImages(x,w)}},{key:"getCurrentTag",value:function(){var x;return 0==(x=this._buffer.getCurrentTag())?"":x}},{key:"renameTag",value:function(x,w){return this._buffer.renameTag(x,w)}},{key:"removeTag",value:function(x,w){return this._buffer.removeTag(x,w)}},{key:"getTagList",value:function(){return this._buffer.getTagList()}},{key:"getTagListByIndex",value:function(x){return this._buffer.getTagListByIndex(x)}},{key:"OpenFile",value:function(x){return this._buffer.openDocument(x)}},{key:"CreateFile",value:function(x){return this._buffer.createDocument(x)}},{key:"GetCurrentFileName",value:function(){return this._buffer.getCurrentFileName()}},{key:"RemoveFile",value:function(x){return this._buffer.removeDocument(x)}},{key:"RenameFile",value:function(x,w){return this._buffer.renameDocument(x,w)}},{key:"GetFileInfoList",value:function(){return this._buffer.getDocumentInfoList()}},{key:"MoveImageToFile",value:function(x,w,T,A){return this._buffer.moveImageToFile(x,w,T,A)}},{key:"GetServerIdsByFileName",value:function(x){var w,T=this,A=[];return(w=T.GetFileInfoList())?U.each(w,function(D){if(x==D.name){if(D.imageIds)for(var M=0;M<D.imageIds.length;M++){var B=D.imageIds[M];if(B&&-1!=B){var H=T._stwain._uidFromServer2ServerId(B);H>0&&A.push(H)}}return!1}}):A=[],A}},{key:"insertImage",value:function(x,w,T){this._buffer.insertImage(w,x,T)}},{key:"GetMetaDataByIndex",value:function(x){return this._buffer.getMetadataByUid(this._buffer.getUidByIndex(x))}},{key:"RefreshAllImages",value:function(x,w){for(var T,A,D,M=this,B=0;B<M.count();B++){T=M.convertClientIndexToServerId(B);var H=M.getImageIdMap(T);if(H){D=M.GetMetaDataByIndex(B),A=Ce.navInfoSync.bMobile?lr.getImageUrl(M._baseUrl,T,Math.round(x*devicePixelRatio),Math.round(w*devicePixelRatio),Date.now()):lr.getImageUrl(M._baseUrl,T,x,w,Date.now());var Y=U.clone(H);Y.imageId=T,Y.minImageUrl=A,M._buffer.updateImage(Y,D)}}}},{key:"UpdateData",value:function(x,w){var A=this.getImageIdMap(x);if(A){var D=U.clone(A);D.imageId=x,this._buffer.updateImage(D,w)}return!0}},{key:"UpdateImage",value:function(x,w){return this._buffer.updateImage(x,w),!0}},{key:"_setDataImageControl",value:function(x,w,T){var A,D,M,B,H=this;if(T)M=x;else if(M=(D=H.getCustomDataByIndex(x)).serverId,B=D.uidFromServer,M<=0)return!1;return(A=H.getImageIdMap(M))||((A=new KA).serverId=M,A.uidFromServer=B,H._serverIdMap[M]=A,H._uidMap[B]=A),null!=A&&(A.bIsDirty=!0),H.__GetImageAndAttach(A,M,!0,!1,!1,x,w),!0}},{key:"__AttachImages",value:function(){var x,w,T,A=this;w=A.count();for(var D=0;D<w;D++)(x=A.convertClientIndexToServerId(D))>=0&&(T=A.getImageIdMap(x))&&A.__GetImageAndAttach(T,x,!0,!1,!1,0)}},{key:"AddImage",value:function(x,w,T,A,D){var M,B=this,H=1*x;return!(w<=0||((M=new KA).bIsDirty=!0,M.serverId=w,M.uidFromServer=T,B._serverIdMap[w]=M,B._uidMap[T]=M,w>=0&&B.__GetImageAndAttach(M,w,!1,!0,D,H,A),0))}},{key:"OnGetImageByURL",value:function(x,w,T,A,D,M,B,H){return w.imageUrl&&""!=w.imageUrl?(w.iImageControlWidth=T,w.iImageControlHeight=A,w.bAddImage=D,w.bAppendImage=M,w.index=B,this._attachImagesForControl(w,H),!0):this.OnGetImageFromServer(x,w,T,A,D,M,B,H)}},{key:"OnGetImageFromServer",value:function(x,w,T,A,D,M,B,H){var Y,G,q=this,re=q._baseUrl;if(re){if(x<=0)return!1;w.bIsDirty&&(w.ticks=Date.now()),U.isUndefined(T)&&(T=-1),U.isUndefined(A)&&(A=-1),w.iImageControlWidth=T,w.iImageControlHeight=A,w.bAddImage=D,w.bAppendImage=M,w.index=B,Ce.DWT.ConnectWithSocket&&q._stwain._isBindViewer()?(q._attachImagesForControl(w,H),wf._getblob_queue.push([q._stwain,x,H]),wf.ProcessGetBlobByQueue()):(Y=lr.getImageUrl(re,x,-1,-1,w.ticks),G=Ce.navInfoSync.bMobile?lr.getImageUrl(re,x,Math.round(T*devicePixelRatio),Math.round(A*devicePixelRatio),w.ticks):lr.getImageUrl(re,x,T,A,w.ticks),w.imageUrl=Y,w.minImageUrl=G,q._attachImagesForControl(w,H))}return!0}},{key:"getBaseUrl",get:function(){return this._baseUrl}},{key:"_attachImagesForControl",value:function(x,w){var T,A,D=this;if((A=U.clone(x)).imageId=A.serverId,A.bAddImage){if(T=w.currentFileName.length>0?D._buffer.addImage(A,w,w.currentFileName):D._buffer.addImage(A,w)){var M=HB(T,1)[0],B=this.getImageIdMap(A.serverId);B&&(B.uuid=M);var H=this._buffer.getCustomDataByUid(M);H&&(H.serverId&&A&&A.serverId&&(H.serverId=A.serverId),H.uidFromServer&&(H.uidFromServer=A.uidFromServer))}}else D._buffer.updateImage(A,w);return!0}},{key:"_updateUIAfterAdd",value:function(x,w,T,A,D){return!(w<0)&&this.AddImage(x,w,T,A,D)}},{key:"__GetImageAndAttach",value:function(x,w,T,A,D,M,B){var H,Y,G,re,q=this;q._stwain._isBindViewer()?(G=q._stwain.Viewer.height>=400?q._stwain.Viewer.height:400,Y=q._stwain.Viewer.width>=400?q._stwain.Viewer.width:400):(Y=-1,G=-1),re=!!T||1==x.bIsDirty;var se=null===(H=q.getImageIdMap(w))||void 0===H?void 0:H.uuid;se&&-1!=se&&x.iImageControlWidth==Y&&x.iImageControlHeight==G&&0==x.bIsDirty||q.__SetArrayControlLoadImage(w,x,Y,G,re,A,D,M,B)}},{key:"__SetArrayControlLoadImage",value:function(x,w,T,A,D,M,B,H,Y){D?this.OnGetImageFromServer(x,w,T,A,M,B,H,Y):this.OnGetImageByURL(x,w,T,A,M,B,H,Y)}},{key:"GetServerIdList",value:function(){var x,w,T,A=this,D=[];if(x=A._buffer.getDocumentContents(A._buffer.getCurrentDocument()))for(var M=0;M<x.length;M++)(w=x[M])&&-1!=w&&(T=A._buffer.getCustomDataByUid(w))&&D.push(T.serverId);return D}}])}(gC),L$e=function(y){var C=y||window.event,x=!0;return U.each(ft.Events.registedObjs,function(w){U.each(ft.Events.registedClass,function(T){if(w instanceof T&&w.bFocus&&w.handlerKeyDown&&!(x=w.handlerKeyDown(C)))return!1})}),x};function wW(y,C){for(var x in C)C.hasOwnProperty(x)&&!U.isUndefined(C[x])&&(y.hasOwnProperty(x)&&!U.isUndefined(y[x])||(y[x]=C[x]));return y}q1(function(){U.addEventListener(document.documentElement,"keydown",L$e)}),wW(Ce.DWT,su),wW(Ce.DWT,fVe),Ce.DWT.CertificateConfig?wW(Ce.DWT.CertificateConfig,A7):Ce.DWT.CertificateConfig=A7,Ce.DWT.RegisterEvent=function(y,C){return U.isFunction(C)&&(Ce.DWT[y]=C),!0},function(y){y.CAP_NONE=0,y.CAP_XFERCOUNT=1,y.ICAP_COMPRESSION=256,y.ICAP_PIXELTYPE=257,y.ICAP_UNITS=258,y.ICAP_XFERMECH=259,y.CAP_AUTHOR=4096,y.CAP_CAPTION=4097,y.CAP_FEEDERENABLED=4098,y.CAP_FEEDERLOADED=4099,y.CAP_TIMEDATE=4100,y.CAP_SUPPORTEDCAPS=4101,y.CAP_EXTENDEDCAPS=4102,y.CAP_AUTOFEED=4103,y.CAP_CLEARPAGE=4104,y.CAP_FEEDPAGE=4105,y.CAP_REWINDPAGE=4106,y.CAP_INDICATORS=4107,y.CAP_SUPPORTEDCAPSEXT=4108,y.CAP_PAPERDETECTABLE=4109,y.CAP_UICONTROLLABLE=4110,y.CAP_DEVICEONLINE=4111,y.CAP_AUTOSCAN=4112,y.CAP_THUMBNAILSENABLED=4113,y.CAP_DUPLEX=4114,y.CAP_DUPLEXENABLED=4115,y.CAP_ENABLEDSUIONLY=4116,y.CAP_CUSTOMDSDATA=4117,y.CAP_ENDORSER=4118,y.CAP_ALARMS=4120,y.CAP_ALARMVOLUME=4121,y.CAP_AUTOMATICCAPTURE=4122,y.CAP_TIMEBEFOREFIRSTCAPTURE=4123,y.CAP_TIMEBETWEENCAPTURES=4124,y.CAP_CLEARBUFFERS=4125,y.CAP_MAXBATCHBUFFERS=4126,y.CAP_DEVICETIMEDATE=4127,y.CAP_POWERSUPPLY=4128,y.CAP_CAMERAPREVIEWUI=4129,y.CAP_SERIALNUMBER=4132,y.CAP_PRINTER=4134,y.CAP_PRINTERENABLED=4135,y.CAP_PRINTERINDEX=4136,y.CAP_PRINTERMODE=4137,y.CAP_PRINTERSTRING=4138,y.CAP_PRINTERSUFFIX=4139,y.CAP_LANGUAGE=4140,y.CAP_FEEDERALIGNMENT=4141,y.CAP_FEEDERORDER=4142,y.CAP_REACQUIREALLOWED=4144,y.CAP_BATTERYMINUTES=4146,y.CAP_BATTERYPERCENTAGE=4147,y.CAP_CAMERASIDE=4148,y.CAP_SEGMENTED=4149,y.CAP_CAMERAENABLED=4150,y.CAP_CAMERAORDER=4151,y.CAP_MICRENABLED=4152,y.CAP_FEEDERPREP=4153,y.CAP_FEEDERPOCKET=4154,y.CAP_AUTOMATICSENSEMEDIUM=4155,y.CAP_CUSTOMINTERFACEGUID=4156,y.ICAP_AUTOBRIGHT=4352,y.ICAP_BRIGHTNESS=4353,y.ICAP_CONTRAST=4355,y.ICAP_CUSTHALFTONE=4356,y.ICAP_EXPOSURETIME=4357,y.ICAP_FILTER=4358,y.ICAP_FLASHUSED=4359,y.ICAP_GAMMA=4360,y.ICAP_HALFTONES=4361,y.ICAP_HIGHLIGHT=4362,y.ICAP_IMAGEFILEFORMAT=4364,y.ICAP_LAMPSTATE=4365,y.ICAP_LIGHTSOURCE=4366,y.ICAP_ORIENTATION=4368,y.ICAP_PHYSICALWIDTH=4369,y.ICAP_PHYSICALHEIGHT=4370,y.ICAP_SHADOW=4371,y.ICAP_FRAMES=4372,y.ICAP_XNATIVERESOLUTION=4374,y.ICAP_YNATIVERESOLUTION=4375,y.ICAP_XRESOLUTION=4376,y.ICAP_YRESOLUTION=4377,y.ICAP_MAXFRAMES=4378,y.ICAP_TILES=4379,y.ICAP_BITORDER=4380,y.ICAP_CCITTKFACTOR=4381,y.ICAP_LIGHTPATH=4382,y.ICAP_PIXELFLAVOR=4383,y.ICAP_PLANARCHUNKY=4384,y.ICAP_ROTATION=4385,y.ICAP_SUPPORTEDSIZES=4386,y.ICAP_THRESHOLD=4387,y.ICAP_XSCALING=4388,y.ICAP_YSCALING=4389,y.ICAP_BITORDERCODES=4390,y.ICAP_PIXELFLAVORCODES=4391,y.ICAP_JPEGPIXELTYPE=4392,y.ICAP_TIMEFILL=4394,y.ICAP_BITDEPTH=4395,y.ICAP_BITDEPTHREDUCTION=4396,y.ICAP_UNDEFINEDIMAGESIZE=4397,y.ICAP_EXTIMAGEINFO=4399,y.ICAP_MINIMUMHEIGHT=4400,y.ICAP_MINIMUMWIDTH=4401,y.ICAP_AUTODISCARDBLANKPAGES=4404,y.ICAP_FLIPROTATION=4406,y.ICAP_BARCODEDETECTIONENABLED=4407,y.ICAP_SUPPORTEDBARCODETYPES=4408,y.ICAP_BARCODEMAXSEARCHPRIORITIES=4409,y.ICAP_BARCODESEARCHPRIORITIES=4410,y.ICAP_BARCODESEARCHMODE=4411,y.ICAP_BARCODEMAXRETRIES=4412,y.ICAP_BARCODETIMEOUT=4413,y.ICAP_ZOOMFACTOR=4414,y.ICAP_PATCHCODEDETECTIONENABLED=4415,y.ICAP_SUPPORTEDPATCHCODETYPES=4416,y.ICAP_PATCHCODEMAXSEARCHPRIORITIES=4417,y.ICAP_PATCHCODESEARCHPRIORITIES=4418,y.ICAP_PATCHCODESEARCHMODE=4419,y.ICAP_PATCHCODEMAXRETRIES=4420,y.ICAP_PATCHCODETIMEOUT=4421,y.ICAP_FLASHUSED2=4422,y.ICAP_IMAGEFILTER=4423,y.ICAP_NOISEFILTER=4424,y.ICAP_OVERSCAN=4425,y.ICAP_AUTOMATICBORDERDETECTION=4432,y.ICAP_AUTOMATICDESKEW=4433,y.ICAP_AUTOMATICROTATE=4434,y.ICAP_JPEGQUALITY=4435,y.ICAP_FEEDERTYPE=4436,y.ICAP_ICCPROFILE=4437,y.ICAP_AUTOSIZE=4438,y.ICAP_AUTOMATICCROPUSESFRAME=4439,y.ICAP_AUTOMATICLENGTHDETECTION=4440,y.ICAP_AUTOMATICCOLORENABLED=4441,y.ICAP_AUTOMATICCOLORNONCOLORPIXELTYPE=4442,y.ICAP_COLORMANAGEMENTENABLED=4443,y.ICAP_IMAGEMERGE=4444,y.ICAP_IMAGEMERGEHEIGHTTHRESHOLD=4445,y.ICAP_SUPPORTEDEXTIMAGEINFO=4446}(pd||(pd={})),function(y){y.TWLG_DAN=0,y.TWLG_DUT=1,y.TWLG_ENG=2,y.TWLG_FCF=3,y.TWLG_FIN=4,y.TWLG_FRN=5,y.TWLG_GER=6,y.TWLG_ICE=7,y.TWLG_ITN=8,y.TWLG_NOR=9,y.TWLG_POR=10,y.TWLG_SPA=11,y.TWLG_SWE=12,y.TWLG_USA=13,y.TWLG_USERLOCALE=-1,y.TWLG_AFRIKAANS=14,y.TWLG_ALBANIA=15,y.TWLG_ARABIC=16,y.TWLG_ARABIC_ALGERIA=17,y.TWLG_ARABIC_BAHRAIN=18,y.TWLG_ARABIC_EGYPT=19,y.TWLG_ARABIC_IRAQ=20,y.TWLG_ARABIC_JORDAN=21,y.TWLG_ARABIC_KUWAIT=22,y.TWLG_ARABIC_LEBANON=23,y.TWLG_ARABIC_LIBYA=24,y.TWLG_ARABIC_MOROCCO=25,y.TWLG_ARABIC_OMAN=26,y.TWLG_ARABIC_QATAR=27,y.TWLG_ARABIC_SAUDIARABIA=28,y.TWLG_ARABIC_SYRIA=29,y.TWLG_ARABIC_TUNISIA=30,y.TWLG_ARABIC_UAE=31,y.TWLG_ARABIC_YEMEN=32,y.TWLG_BASQUE=33,y.TWLG_BYELORUSSIAN=34,y.TWLG_BULGARIAN=35,y.TWLG_CATALAN=36,y.TWLG_CHINESE=37,y.TWLG_CHINESE_HONGKONG=38,y.TWLG_CHINESE_PRC=39,y.TWLG_CHINESE_SINGAPORE=40,y.TWLG_CHINESE_SIMPLIFIED=41,y.TWLG_CHINESE_TAIWAN=42,y.TWLG_CHINESE_TRADITIONAL=43,y.TWLG_CROATIA=44,y.TWLG_CZECH=45,y.TWLG_DANISH=0,y.TWLG_DUTCH=1,y.TWLG_DUTCH_BELGIAN=46,y.TWLG_ENGLISH=2,y.TWLG_ENGLISH_AUSTRALIAN=47,y.TWLG_ENGLISH_CANADIAN=48,y.TWLG_ENGLISH_IRELAND=49,y.TWLG_ENGLISH_NEWZEALAND=50,y.TWLG_ENGLISH_SOUTHAFRICA=51,y.TWLG_ENGLISH_UK=52,y.TWLG_ENGLISH_USA=13,y.TWLG_ESTONIAN=53,y.TWLG_FAEROESE=54,y.TWLG_FARSI=55,y.TWLG_FINNISH=4,y.TWLG_FRENCH=5,y.TWLG_FRENCH_BELGIAN=56,y.TWLG_FRENCH_CANADIAN=3,y.TWLG_FRENCH_LUXEMBOURG=57,y.TWLG_FRENCH_SWISS=58,y.TWLG_GERMAN=6,y.TWLG_GERMAN_AUSTRIAN=59,y.TWLG_GERMAN_LUXEMBOURG=60,y.TWLG_GERMAN_LIECHTENSTEIN=61,y.TWLG_GERMAN_SWISS=62,y.TWLG_GREEK=63,y.TWLG_HEBREW=64,y.TWLG_HUNGARIAN=65,y.TWLG_ICELANDIC=7,y.TWLG_INDONESIAN=66,y.TWLG_ITALIAN=8,y.TWLG_ITALIAN_SWISS=67,y.TWLG_JAPANESE=68,y.TWLG_KOREAN=69,y.TWLG_KOREAN_JOHAB=70,y.TWLG_LATVIAN=71,y.TWLG_LITHUANIAN=72,y.TWLG_NORWEGIAN=9,y.TWLG_NORWEGIAN_BOKMAL=73,y.TWLG_NORWEGIAN_NYNORSK=74,y.TWLG_POLISH=75,y.TWLG_PORTUGUESE=10,y.TWLG_PORTUGUESE_BRAZIL=76,y.TWLG_ROMANIAN=77,y.TWLG_RUSSIAN=78,y.TWLG_SERBIAN_LATIN=79,y.TWLG_SLOVAK=80,y.TWLG_SLOVENIAN=81,y.TWLG_SPANISH=11,y.TWLG_SPANISH_MEXICAN=82,y.TWLG_SPANISH_MODERN=83,y.TWLG_SWEDISH=12,y.TWLG_THAI=84,y.TWLG_TURKISH=85,y.TWLG_UKRANIAN=86,y.TWLG_ASSAMESE=87,y.TWLG_BENGALI=88,y.TWLG_BIHARI=89,y.TWLG_BODO=90,y.TWLG_DOGRI=91,y.TWLG_GUJARATI=92,y.TWLG_HARYANVI=93,y.TWLG_HINDI=94,y.TWLG_KANNADA=95,y.TWLG_KASHMIRI=96,y.TWLG_MALAYALAM=97,y.TWLG_MARATHI=98,y.TWLG_MARWARI=99,y.TWLG_MEGHALAYAN=100,y.TWLG_MIZO=101,y.TWLG_NAGA=102,y.TWLG_ORISSI=103,y.TWLG_PUNJABI=104,y.TWLG_PUSHTU=105,y.TWLG_SERBIAN_CYRILLIC=106,y.TWLG_SIKKIMI=107,y.TWLG_SWEDISH_FINLAND=108,y.TWLG_TAMIL=109,y.TWLG_TELUGU=110,y.TWLG_TRIPURI=111,y.TWLG_URDU=112,y.TWLG_VIETNAMESE=113}(eW||(eW={})),function(y){y.TWSS_NONE=0,y.TWSS_A4LETTER=1,y.TWSS_B5LETTER=2,y.TWSS_USLETTER=3,y.TWSS_USLEGAL=4,y.TWSS_A5=5,y.TWSS_B4=6,y.TWSS_B6=7,y.TWSS_USLEDGER=9,y.TWSS_USEXECUTIVE=10,y.TWSS_A3=11,y.TWSS_B3=12,y.TWSS_A6=13,y.TWSS_C4=14,y.TWSS_C5=15,y.TWSS_C6=16,y.TWSS_4A0=17,y.TWSS_2A0=18,y.TWSS_A0=19,y.TWSS_A1=20,y.TWSS_A2=21,y.TWSS_A4=1,y.TWSS_A7=22,y.TWSS_A8=23,y.TWSS_A9=24,y.TWSS_A10=25,y.TWSS_ISOB0=26,y.TWSS_ISOB1=27,y.TWSS_ISOB2=28,y.TWSS_ISOB3=12,y.TWSS_ISOB4=6,y.TWSS_ISOB5=29,y.TWSS_ISOB6=7,y.TWSS_ISOB7=30,y.TWSS_ISOB8=31,y.TWSS_ISOB9=32,y.TWSS_ISOB10=33,y.TWSS_JISB0=34,y.TWSS_JISB1=35,y.TWSS_JISB2=36,y.TWSS_JISB3=37,y.TWSS_JISB4=38,y.TWSS_JISB5=2,y.TWSS_JISB6=39,y.TWSS_JISB7=40,y.TWSS_JISB8=41,y.TWSS_JISB9=42,y.TWSS_JISB10=43,y.TWSS_C0=44,y.TWSS_C1=45,y.TWSS_C2=46,y.TWSS_C3=47,y.TWSS_C7=48,y.TWSS_C8=49,y.TWSS_C9=50,y.TWSS_C10=51,y.TWSS_USSTATEMENT=52,y.TWSS_BUSINESSCARD=53,y.TWSS_MAXSIZE=54}(tW||(tW={})),function(y){y.TWON_NONE=0,y.TWON_ARRAY=3,y.TWON_ENUMERATION=4,y.TWON_ONEVALUE=5,y.TWON_RANGE=6}(nW||(nW={})),function(y){y.TWTY_INT8=0,y.TWTY_INT16=1,y.TWTY_INT32=2,y.TWTY_UINT8=3,y.TWTY_UINT16=4,y.TWTY_int=5,y.TWTY_BOOL=6,y.TWTY_FIX32=7,y.TWTY_FRAME=8,y.TWTY_STR32=9,y.TWTY_STR64=10,y.TWTY_STR128=11,y.TWTY_STR255=12}(iW||(iW={})),function(y){y.TWFA_NONE=0,y.TWFA_LEFT=1,y.TWFA_CENTER=2,y.TWFA_RIGHT=3}(rW||(rW={})),function(y){y.TWFO_FIRSTPAGEFIRST=0,y.TWFO_LASTPAGEFIRST=1}(oW||(oW={})),function(y){y.TWPR_IMPRINTERTOPBEFORE=0,y.TWPR_IMPRINTERTOPAFTER=1,y.TWPR_IMPRINTERBOTTOMBEFORE=2,y.TWPR_IMPRINTERBOTTOMAFTER=3,y.TWPR_ENDORSERTOPBEFORE=4,y.TWPR_ENDORSERTOPAFTER=5,y.TWPR_ENDORSERBOTTOMBEFORE=6,y.TWPR_ENDORSERBOTTOMAFTER=7}(sW||(sW={})),function(y){y.TWPM_SINGLESTRING=0,y.TWPM_MULTISTRING=1,y.TWPM_COMPOUNDSTRING=2}(aW||(aW={})),function(y){y.TWBR_THRESHOLD=0,y.TWBR_HALFTONE=1,y.TWBR_CUSTHALFTONE=2,y.TWBR_DIFFUSION=3}(lW||(lW={})),function(y){y.TWBO_LSBFIRST=0,y.TWBO_MSBFIRST=1}(cW||(cW={})),function(y){y.TWFT_RED=0,y.TWFT_GREEN=1,y.TWFT_BLUE=2,y.TWFT_NONE=3,y.TWFT_WHITE=4,y.TWFT_CYAN=5,y.TWFT_MAGENTA=6,y.TWFT_YELLOW=7,y.TWFT_BLACK=8}(uW||(uW={})),function(y){y.TWFL_NONE=0,y.TWFL_OFF=1,y.TWFL_ON=2,y.TWFL_AUTO=3,y.TWFL_REDEYE=4}(dW||(dW={})),function(y){y.TWFR_BOOK=0,y.TWFR_FANFOLD=1}(hW||(hW={})),function(y){y.TWIF_NONE=0,y.TWIF_AUTO=1,y.TWIF_LOWPASS=2,y.TWIF_BANDPASS=3,y.TWIF_HIGHPASS=4,y.TWIF_TEXT=3,y.TWIF_FINELINE=4}(fW||(fW={})),function(y){y.TWLP_REFLECTIVE=0,y.TWLP_TRANSMISSIVE=1}(pW||(pW={})),function(y){y.TWLS_RED=0,y.TWLS_GREEN=1,y.TWLS_BLUE=2,y.TWLS_NONE=3,y.TWLS_WHITE=4,y.TWLS_UV=5,y.TWLS_IR=6}(gW||(gW={})),function(y){y.TWNF_NONE=0,y.TWNF_AUTO=1,y.TWNF_LONEPIXEL=2,y.TWNF_MAJORITYRULE=3}(mW||(mW={})),function(y){y.TWOR_ROT0=0,y.TWOR_ROT90=1,y.TWOR_ROT180=2,y.TWOR_ROT270=3,y.TWOR_PORTRAIT=0,y.TWOR_LANDSCAPE=3,y.TWOR_AUTO=4,y.TWOR_AUTOTEXT=5,y.TWOR_AUTOPICTURE=6}(vW||(vW={})),function(y){y.TWOV_NONE=0,y.TWOV_AUTO=1,y.TWOV_TOPBOTTOM=2,y.TWOV_LEFTRIGHT=3,y.TWOV_ALL=4}(yW||(yW={})),function(y){y.TWPF_CHOCOLATE=0,y.TWPF_VANILLA=1}(_W||(_W={})),function(y){y.TWPC_CHUNKY=0,y.TWPC_PLANAR=1}(CW||(CW={})),function(y){y.TWBP_DISABLE=-2,y.TWBP_AUTO=-1}(ofe||(ofe={})),function(y){y.Info=1,y.Error=2,y.NotInstalledError=3}(Yp||(Yp={})),function(y){y.Binary=0,y.Base64=1}(KS||(KS={})),function(y){y.TWPT_BW=0,y.TWPT_GRAY=1,y.TWPT_RGB=2,y.TWPT_PALLETE=3,y.TWPT_CMY=4,y.TWPT_CMYK=5,y.TWPT_YUV=6,y.TWPT_YUVK=7,y.TWPT_CIEXYZ=8,y.TWPT_LAB=9,y.TWPT_SRGB=10,y.TWPT_SCRGB=11,y.TWPT_INFRARED=16}(bW||(bW={})),function(y){y.TWUN_INCHES=0,y.TWUN_CENTIMETERS=1,y.TWUN_PICAS=2,y.TWUN_POINTS=3,y.TWUN_TWIPS=4,y.TWUN_PIXELS=5,y.TWUN_MILLIMETERS=6}(xW||(xW={})),U.mix(Ce.DWT,{EnumDWT_DeviceType:Zt,EnumDWT_Cap:pd,EnumDWT_CapLanguage:eW,EnumDWT_CapSupportedSizes:tW,EnumDWT_CapType:nW,EnumDWT_CapValueType:iW,EnumDWT_CapFeederAlignment:rW,EnumDWT_CapFeederOrder:oW,EnumDWT_CapPrinter:sW,EnumDWT_CapPrinterMode:aW,EnumDWT_CapBitdepthReduction:lW,EnumDWT_CapBitOrder:cW,EnumDWT_CapFilterType:uW,EnumDWT_CapFlash:dW,EnumDWT_CapFlipRotation:hW,EnumDWT_CapImageFilter:fW,EnumDWT_CapLightPath:pW,EnumDWT_CapLightSource:gW,EnumDWT_CapNoiseFilter:mW,EnumDWT_CapORientation:vW,EnumDWT_CapOverscan:yW,EnumDWT_CapPixelFlavor:_W,EnumDWT_CapPlanarChunky:CW,EnumDWT_ImageType:Ti,EnumDWT_ImageFormatType:bf,EnumDWT_ResponseType:hu,EnumDWT_SourceMatchField:_0,EnumDWT_UploadDataFormat:KS,EnumDWT_WorkMode:SP,EnumDWT_ConvertMode:gr,EnumDWT_PixelType:bW,EnumDWT_UnitType:xW});var JS,dh,TP,IP,QS,EP,Vo=Ce.DWT;Vo.EnumPDF_Page={Page_Default:0,Page_Custom:1,Page_A4:2,Page_A4_Reverse:3,Page_A3:4,Page_A3_Reverse:5,Page_Letter:6,Page_Letter_Reverse:7,Page_Legal:8,Page_Legal_Reverse:9},Vo.EnumDWT_BorderStyle={TWBS_NONE:0,TWBS_SINGLEFLAT:1,TWBS_SINGLE3D:2},Vo.EnumDWT_MessageType={TWQC_GET:1,TWQC_SET:2,TWQC_GETDEFAULT:4,TWQC_GETCURRENT:8,TWQC_RESET:16},Vo.EnumDWT_TransferMode={TWSX_NATIVE:0,TWSX_FILE:1,TWSX_MEMORY:2},Vo.EnumDWT_FileFormat={TWFF_TIFF:0,TWFF_PICT:1,TWFF_BMP:2,TWFF_XBM:3,TWFF_JFIF:4,TWFF_FPX:5,TWFF_TIFFMULTI:6,TWFF_PNG:7,TWFF_SPIFF:8,TWFF_EXIF:9,TWFF_PDF:10,TWFF_JP2:11,TWFF_JPN:12,TWFF_JPX:13,TWFF_DEJAVU:14,TWFF_PDFA:15,TWFF_PDFA2:16},Vo.EnumDWT_TIFFCompressionType={TIFF_AUTO:0,TIFF_NONE:1,TIFF_RLE:2,TIFF_FAX3:3,TIFF_T4:3,TIFF_FAX4:4,TIFF_T6:4,TIFF_LZW:5,TIFF_JPEG:7,TIFF_PACKBITS:32773},Vo.EnumDWT_InterpolationMethod={IM_NEARESTNEIGHBOUR:1,IM_BILINEAR:2,IM_BICUBIC:3,IM_BESTQUALITY:5},Vo.EnumDWT_PDFCompressionType={PDF_AUTO:0,PDF_FAX3:1,PDF_FAX4:2,PDF_LZW:3,PDF_RLE:4,PDF_JPEG:5,PDF_JP2000:6,PDF_JBIG2:7},Vo.EnumDWT_ShowMode={SW_ACTIVE:0,SW_MAX:1,SW_MIN:2,SW_CLOSE:3,SW_IFLIVE:4},Vo.EnumDWT_DUPLEX={TWDX_NONE:0,TWDX_1PASSDUPLEX:1,TWDX_2PASSDUPLEX:2},Vo.EnumDWT_MagType={TWMD_MICR:0,TWMD_RAW:1,TWMD_INVALID:2},Vo.EnumDWT_DataSourceStatus={TWDSS_CLOSED:0,TWDSS_OPENED:1,TWDSS_ENABLED:2,TWDSS_ACQUIRING:3},function(y){y.enumFitWindow=0,y.enumFitWindowHeight=1,y.enumFitWindowWidth=2}(JS||(JS={})),Vo.EnumDWT_FitWindowType={enumFitWindow:JS.enumFitWindow,enumFitWindowHeight:JS.enumFitWindowHeight,enumFitWindowWidth:JS.enumFitWindowWidth},Vo.EnumDWT_PlatformType={enumUnknown:Rn.enumUnknown,enumWindow:Rn.enumWindow,enumMac:Rn.enumMac,enumLinux:Rn.enumLinux,enumEmbed:Rn.enumEmbed,enumChromeOS:Rn.enumChromeOS,enumHarmonyOS:Rn.enumHarmonyOS,enumAndroid:Rn.enumAndroid,enumiOS:Rn.enumiOS},function(y){y.Default=0,y.Hand=1,y.Crosshair=2,y.Zoom=3,y.NWResize=4,y.EResize=5,y.NResize=6,y.Resize=7,y.Move=8}(dh||(dh={})),Vo.EnumDWT_MouseShape={Default:dh.Default,Hand:dh.Hand,Crosshair:dh.Crosshair,Zoom:dh.Zoom,NWResize:dh.NWResize,EResize:dh.EResize,NResize:dh.NResize,Resize:dh.Resize,Move:dh.Move},Vo.EnumDWT_Language={English:0,French:1,Arabic:2,Spanish:3,Portuguese:4,German:5,Italian:6,Russian:7,Chinese:8},Vo.EnumDWT_InitMsg={Info:Yp.Info,Error:Yp.Error,NotInstalledError:Yp.NotInstalledError},Vo.EnumDWT_Driver={TWAIN:Mi.TWAIN,ICA:Mi.ICA,SANE:Mi.SANE,TWAIN_AND_ICA:Mi.TWAIN_AND_ICA,TWAIN_AND_TWAIN64:Mi.TWAIN_AND_TWAIN64,TWAIN64:Mi.TWAIN64},Vo.EnumDWT_CompressionType={TWCP_NONE:0,TWCP_PACKBITS:1,TWCP_GROUP31D:2,TWCP_GROUP31DEOL:3,TWCP_GROUP32D:4,TWCP_GROUP4:5,TWCP_JPEG:6,TWCP_LZW:7,TWCP_JBIG:8,TWCP_PNG:9,TWCP_RLE4:10,TWCP_RLE8:11,TWCP_BITFIELDS:12,TWCP_ZIP:13,TWCP_JPEG2000:14},function(y){y.Single=0,y.Multiple=1}(TP||(TP={})),Vo.EnumDWT_SelectionMode={Single:TP.Single,Multiple:TP.Multiple},Vo.EnumDWT_ConfirmExitType={Cancel:0,Exit:1,SaveAndExit:2},Vo.EnumDWT_WebsocketReadyState={CONNECTING:rd.CONNECTING,OPEN:rd.OPEN,CLOSING:rd.CLOSING,CLOSED:rd.CLOSED},function(y){y.TwainService=1}(IP||(IP={})),Vo.EnumDWT_ServiceType={TwainService:IP.TwainService},function(y){y.default=0,y.standard=1,y.supported=2}(QS||(QS={})),Vo.EnumDWT_ExtImageInfo={default:QS.default,standard:QS.standard,supported:QS.supported};var DP=20230506,SW=function(){if(Ce.dcp){var y=Ce.dcp.dcpJSVer;if(U.isNumber(y))return y>=DP}return!1};if(SW())SW=EP,DP=EP;else{var os=$n.detect,vC={_checkService:function(y,C){os.dcpStatus=os.EnumDCP_DetectStatus.CheckingServiceVer,TW(null,"DSVersion").then(y,C)},_checkUpdateFile:function(y,C){TW(null,"CheckUpdateFile").then(y,C)},_updateService:function(y,C){TW(null,"UpdateService").then(y,C)},_getDSUpdateZipUrl:function(){var y,C,x="";return y="Win",de.bMac?y="Mac":de.bLinux&&(y="Linux"),C=de.bFileSystem?"":"?t="+U.now(),de.bWin&&$n.b64bit&&(x="_x64"),[Ce.DWT.ResourcesPath,"/dist/serviceupdate/",y,"DSUpdate_",ele().join("."),x,".zip",C].join("")},getPorts:function(y,C){var x="GetPorts",w="dwasm2_"+U1();return afe(y,x,{id:U.guid(),method:x,version:w,parameter:[C]},vS)},_getStatusString:function(y,C){var x,w,T="";return y==os.EnumDCP_DetectStatus.Init?"Getting manager version":y==os.EnumDCP_DetectStatus.Connected?(C&&(T=C),"Getting manager version succeeded and the version is "+T):y==os.EnumDCP_DetectStatus.CheckingManagerVer?"Getting manager version":y==os.EnumDCP_DetectStatus.CheckingServiceVer?"Getting service version":y==os.EnumDCP_DetectStatus.NotInstalled?"Dynamsoft Service Not Installed":y==os.EnumDCP_DetectStatus.UpdateSkipped?"Update skipped":y==os.EnumDCP_DetectStatus.CheckedService?(C&&(T=C),"Getting service version succeeded and the version is "+T):y==os.EnumDCP_DetectStatus.VerifyingZip?"Verifying the update package":y==os.EnumDCP_DetectStatus.VerifiedZip?"Update package verified":y==os.EnumDCP_DetectStatus.UpdatingService?"Updating the service":y==os.EnumDCP_DetectStatus.UpdateSucceed?"Update succeeded":y==os.EnumDCP_DetectStatus.UpdateFailed?(w=".",C&&C.length>0?("."==C.slice(C.length-1)&&(w=""),x=" with the error: "+C):x="","The update failed"+x+w):""},_sendStatusEvent:function(y,C){var x=!!y,w=window;U.isFunction(w.OnGetServiceUpdateStatus)&&w.OnGetServiceUpdateStatus(x,os.dcpStatus,vC._getStatusString(os.dcpStatus,C))},_getErr:function(y){var C,x="";try{U.isString(y)?(C=y.replace(/\0/g,""),C=U.parse(C)):y&&(C=y),"description"in C&&(x=C.description)}catch(w){}return x},_funShowUpgradeDialogWhenUpdateFailed:function(y,C){return os.bConnected=!0,os.dcpStatus=os.EnumDCP_DetectStatus.UpdateFailed,y&&y(),C&&C(),vC._sendStatusEvent(!0),!0},_funUpdateFailed:function(y,C,x,w){var T,A;return os.bConnected=!0,os.dcpStatus=os.EnumDCP_DetectStatus.UpdateFailed,y&&y(),200==w?(T="The update failed.",A=vC._getStatusString(os.dcpStatus,vC._getErr(x))):A=T="The update failed. The error code is "+w,C&&C(!0,T),vC._sendStatusEvent(!0,A),!0},getDSPath:function(y,C){return Hl.getDSPath(C)},getLinuxHTML5DebPath:function(){return Hl.getDSPath(".deb")},getLinuxHTML5RpmPath:function(){return Hl.getDSPath(".rpm")},getBinaryFileInfo:function(y,C){var x="GetBinaryFileInfo",w={id:U.guid(),method:x,version:"dwasm2_"+U1(),parameter:[]},T=U.stringify(w),A=function(B,H,Y){var G;B&&(G=U.parse(B)),G?y(G):C(B,H,Y)};if(Ce.DWT.ConnectWithSocket&&de.bHTML5Edition){var D=Up.getWsUrl(Ce.DWT.Host,de.bSSL?$n.SSLPort:$n.Port);return Up.postStringDataByWSUrl(D,T).then(A,C),!0}var M=[SA(),"/",x,"?type=1&dsver=",D7().join(""),"&ts=",U.now()].join("");Op.getHttpClientForDcp().request(T,M,{},500).then(A,C)}};U.mix($n,vC),Ce.dcp=$n,Ce.dcp.dcpJSVer=DP,SW=EP,DP=EP}function TW(y,C,x,w){var T;return T={id:U.guid(),method:C,version:"dwasm2_"+U1(),parameter:[]},"VersionInfo"==C&&(T.version="dwasm2_"+xo.getVersionStrForCheck()),pn.isLongKey(x)&&(T.productKey=x),afe(y,C,T,vS,w)}function afe(y,C,x,w,T){return IW.apply(this,arguments)}function IW(){return IW=yt(W.mark(function y(C,x,w,T,A){var D,M,B,H,G,q,re,se;return W.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return D=U.stringify(w),$n.detect.bConnected=!1,M=[SA(),"/",x,"?type=1&dsver=",D7().join(""),"&ts=",U.now()].join(""),B=Op.getHttpClient(C,(H=de.bSSL)?$n.SSLPort:$n.Port,H),G={},A&&!de.bSSL&&(G.redirect="manual"),ce.prev=8,ce.next=11,B.request(D,M,G,T);case 11:q=ce.sent,ce.next=21;break;case 14:if(ce.prev=14,ce.t0=ce.catch(8),!A||de.bSSL){ce.next=20;break}if((ce.t0&&ce.t0.code)!=Xn.HTTPRedirected){ce.next=20;break}throw Tle();case 20:throw ce.t0;case 21:if(q&&(re=U.parse(q)),!(re&&"exception"in re&&"description"in re)){ce.next=24;break}throw{code:re.exception,message:re.description};case 24:if(!re||!("result"in re)){ce.next=30;break}if(!$n.detect.bConnected){ce.next=27;break}return ce.abrupt("return",re.result);case 27:return $n.detect.bConnected=!0,$n.detect.dcpStatus=$n.detect.EnumDCP_DetectStatus.Connected,ce.abrupt("return",re.result);case 30:throw zl(se={}),Qi(se);case 33:case"end":return ce.stop()}},y,null,[[8,14]])})),IW.apply(this,arguments)}function lfe(y){var C=Date.parse(y+"T00:00:00");return""!=y&&!isNaN(C)&&!!Ce.DWT.CheckCertExpired&&(new Date).getTime()>=C-864e5*Ce.DWT.CertificateConfig.UpdateDaysBeforeExpired}Ce.DWT.__innerCheckCertDate=function(y){lfe(y)&&(U.isFunction(Ce.OnCertExpired)&&Ce.OnCertExpired(y),setTimeout(function(){Ce.DWT.UpdateCert(Ce.DWT.CertificateConfig.URL,Ce.OnUpdateCertSuccess,Ce.OnUpdateCertFailure)},5e3))},Ce.DWT.__innerUpdateCert=function(y,C,x,w){var T=[SA(),"/LoadZipFromBytes?type=",4,"&dsver=",D7().join(""),"&ts=",U.now()].join("");Op.getHttpClientForDcp(null,C).request(y,T,{},3e4).then(x,function(A){U.isFunction(w)&&w(A)})},Ce.DWT.__innerReboot=function(y,C){var x=[SA(),"/admin?ts=",U.now()].join(""),w='{"id":"'+(new Date).getTime().toString()+'","method":"Reboot","parameter":[],"version":"dwasm2_'+U1()+'"}';Op.getHttpClientForDcp().request(w,x,{},3e4).then(y,C)},Ce.DWT.UpdateCert=function(y,C,x){U.isString(y)&&""!=y?X1(y,{mode:"cors",dataType:"arraybuffer"}).then(function(w){Ce.DWT.__innerUpdateCert(w,!1,function(T){var A;try{var D=ge.parse(T);D.description&&(A={code:D.exception,message:D.description})}catch(B){var M;zl(M={}),M=Qi(M)}A?ge.isFunction(x)&&x(A):(Ce.DWT.CheckCertExpired=!1,U.isFunction(C)&&C())},function(T){de.bSSL?Ce.DWT.__innerUpdateCert(w,!0,C,x):U.isFunction(x)&&x(T)})},x):U.isFunction(x)&&x()};var EW={Errors:{FilePathSyntaxIncorrect:function(y){y._errorCode=-3123,y._errorString="The filename, directory name, or volume label syntax is incorrect."}},checkFilePath:function(y,C){return U.isString(C)&&0!=C.length?U.startsWith(C,"http://")||U.startsWith(C,"https://")||U.startsWith(C,"ftp://")?(ge.File.Errors.FilePathSyntaxIncorrect(y),vt):Lt:(h0(y),vt)}};EW.checkFolder=EW.checkFilePath,ge.File=EW,ge.showProgress=function(){},ge.closeProgress=function(){};var ZS,N$e=document.location.protocol,B$e=location.hostname,cfe=de.bSSL;function ufe(){var y=A7;if(Ce.DWT.CertificateConfig){var C=Ce.DWT.CertificateConfig;U.isString(C.URL)||(C.URL=y.URL),(!U.isNumber(C.UpdateDaysBeforeExpired)||C.UpdateDaysBeforeExpired<=0)&&(C.UpdateDaysBeforeExpired=y.UpdateDaysBeforeExpired)}else Ce.DWT.CertificateConfig=y;(function O$e(){var y;rfe&&(Ms=U.mix({},Sf),Ce.DWT&&(y=Ce.DWT.CustomizableDisplayInfo),y&&(y.errorMessages&&U.mix(Ms.errorMessages,y.errorMessages),y.generalMessages&&U.mix(Ms.generalMessages,y.generalMessages),y.customProgressText&&U.mix(Ms.customProgressText,y.customProgressText),y.buttons&&(y.buttons.titles&&U.mix(Ms.buttons.titles,y.buttons.titles),y.buttons.bShowAllButtons&&U.mix(Ms.buttons.bShowAllButtons,y.buttons.bShowAllButtons),y.buttons.visibility&&U.mix(Ms.buttons.visibility,y.buttons.visibility)),y.dialogText&&U.mix(Ms.dialogText,y.dialogText)),ife(),rfe=!1)})(),U.isString(Ce.DWT.ProductKey)&&(Ce.DWT.ProductKey=U.trim(Ce.DWT.ProductKey)),Ce.navInfo&&(de.bMac||de.bWin)&&(Ce.navInfo.bEmbed=!1,Ce.navInfo.bArm64=!1,Ce.navInfo.bMips64=!1),Ce.DWT.Debug&&(U.debug=!0)}function dfe(){return DW.apply(this,arguments)}function DW(){return DW=yt(W.mark(function y(){var C,x,w;return W.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!ge.detect.cssLoaded){T.next=2;break}return T.abrupt("return",ge.Promise.resolve());case 2:if(x="",de.bFileSystem||(x=ge.timestamp),w=[[C=Ce.DWT.ResourcesPath,"/src/dynamsoft.webtwain.css",x].join("")],St.bHTML5Edition&&Ce.DWT.UseDefaultViewer&&w.push([C,"/src/dynamsoft.webtwain.viewer.css",x].join("")),!St.bHTML5Edition||de.bFileSystem){T.next=9;break}return T.next=9,U$e(w);case 9:return T.abrupt("return",new ge.Promise(function(A,D){var M=!0;de.bSafari?(U.addAllCss(w,!1,function(B){B||M&&(D({code:-2804,message:"Loading the WebTwain css files failed."}),M=!1)}),ge.detect.cssLoaded=Lt,A()):U.addAllCss(w,!1,function(B){if(B)return ge.detect.cssLoaded=Lt,void A();M&&(M=!1,D({code:-2804,message:"Loading the WebTwain css files failed."}))})}));case 10:case"end":return T.stop()}},y)})),DW.apply(this,arguments)}function U$e(y){return AW.apply(this,arguments)}function AW(){return AW=yt(W.mark(function y(C){var x,w;return W.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:x=!0,T.prev=1,w=0,w=0;case 4:if(!(w<C.length)){T.next=15;break}return T.next=7,ge.fetch(C[w]);case 7:if(!(T.sent.indexOf("* Author: Dynamsoft Support Team")>0)){T.next=10;break}return T.abrupt("continue",12);case 10:return x=!1,T.abrupt("break",15);case 12:w++,T.next=4;break;case 15:T.next=20;break;case 17:T.prev=17,T.t0=T.catch(1),x=!1;case 20:if(x){T.next=22;break}throw{code:-2804,message:"Loading the WebTwain css files failed."};case 22:return T.abrupt("return",x);case 23:case"end":return T.stop()}},y,null,[[1,17]])})),AW.apply(this,arguments)}function hfe(){if(St.loadResourcePath||!St.loadingResourcePath)return ZS&&ZS(),void(ZS=null);setTimeout(hfe,100)}function yC(y){if(lo("Loading css..."),ufe(),St.loadResourcePath||St.loadingResourcePath)return St.loadResourcePath?dfe():St.loadResourcePath||!St.loadingResourcePath?ge.Promise.resolve():(ZS=null,new ge.Promise(function(M){ZS=M,setTimeout(hfe,100)}));St.loadingResourcePath=!0,(Ce.DWT.Port>0||Ce.DWT.SSLPort>0)&&(ge.detect.ports=[{port:Ce.DWT.Port,ssl:!1},{port:Ce.DWT.SSLPort,ssl:!0}],sd.removeItem("DWT_port"),sd.removeItem("DWT_ssl")),U.each(ge._funsAfterConfigLoaded,function(M){try{U.isFunction(M)&&M()}catch(B){}});var C=U.sizzle(".dynamsoft_waiting");if(C&&C.length>0){var x=C[0];x.parentNode&&x.parentNode.removeChild(x)}var w=Ce.DWT.ResourcesPath,T="";de.bFileSystem||(T=ge.timestamp);var A=Lt,D=[];return de.bSafari&&(A=vt),D.push([w,"/dynamsoft.webtwain.install.js",T].join("")),Ce.DWT.bNpm&&(D=[]),St.bHTML5Edition&&Ce.DWT.UseDefaultViewer&&(lo("Loading the viewer script..."),D.push([w,"/src/dynamsoft.webtwain.viewer.js",T].join(""))),Ce.DWT.bChromeExtension&&(D=[]),dfe().then(function(){return 0==D.length?(ffe(),St.loadResourcePath=!0,void(St.loadingResourcePath=!1)):new ge.Promise(function(M,B){U.addScripts(D,A,!1,function(H){var Y=H;if(St.bHTML5Edition&&Ce.DWT.UseDefaultViewer&&!U.isFunction(Ce.DWTViewer)&&(Y=!1),de.bIE&&St.bActiveXEdition&&(U.isFunction(Ce.DWT._innerLoad)||(Y=!1)),!Y)return St.loadingResourcePath=!1,void B({code:-2803,message:"Loading the WebTwain JavaScript source files failed."});ffe(),St.loadResourcePath=!0,St.loadingResourcePath=!1,Ce.DWT.OnWebTwainWillInit&&Ce.DWT.OnWebTwainWillInit(),M()})})})}function ffe(){if(!ge.bNode&&!de.bJSDom&&U.isArray(Ce.aryAddonReadyFun)){for(var y=0,C=function(){var x=Ce.aryAddonReadyFun[y];if(U.isFunction(x))try{x(ge)}catch(w){U.log(w.stack||w,"error"),setTimeout(function(){throw w},0)}};y<Ce.aryAddonReadyFun.length;y++)C();Ce.aryAddonReadyFun=[]}}U.mix(ge,{detect:{ssl:cfe,dcpStatus:0,dcpCallbackType:0,arySTwains:[],bFirst:Lt,bOK:vt,__dialog:vt,cssLoaded:vt,viewerScriptLoaded:vt,bNoControlEvent:vt,bNeedUpgradeEvent:vt,bPromptJSOrServerOutdated:vt,detectType:cfe?1:"http:"===N$e||""===B$e?0:-1,tryTimes:0,ports:[{port:Ce.DWT.SSLPort,ssl:Lt},{port:Ce.DWT.Port,ssl:vt}],cUrlIndex:0,urls:[],onNoControl:vt,needUpgrade:vt,OnDetectNext:vt,OnCreatWS:vt,bMaskShow:vt},page:{bUnload:vt}}),ge.Addon_Events=[],ge.Addon_Sendback_Events=[];var e3=[],t3=[];function PW(){var y,C=e3.length;for(y=0;y<C;y++)e3[y]();e3.splice(0),t3.splice(0),n3=0}function pfe(){if(n3>0&&(new Date).getTime()-n3>RW){var y,C={code:-2802,message:"The file dynamsoft.webtwain.config.js timed out while loading."},x=Ce.DWT.Containers;x&&0!==x.length||(_le(y={}),C={code:y._errorCode,message:y._errorString}),function(H){var Y,G=t3.length;for(Y=0;Y<G;Y++)t3[Y](H);e3.splice(0),t3.splice(0),n3=0}(C)}else if(Ce.DWT.Containers||Ce.DWT.ProductKey||Ce.DWT.licenseServer||Ce.DWT.organizationID||Ce.DWT.handshakeCode||Ce.DWT.bNpm||0==Ce.DWT.AutoLoad){if(St.dwtConfigLoading)return;if(St.dwtConfigLoaded)return void PW();St.dwtConfigLoading=!0;var w=de.bFileSystem,T=Po.basePath,A=Ce.DWT.ResourcesPath,D="";if(U.isArray(Ce.DWT.Containers)||(Ce.DWT.Containers=[]),!w&&(void 0!==A&&""!=A||(A=T),A.length>0&&"/"==A.charAt(A.length-1)&&(A=A.substr(0,A.length-1)),D=ge.timestamp,Ce.DWT.ResourcesPath=A),de.bIE){var M=de.IEVersion;if((""===M||M>=10)&&Ce.DWT.IfUseActiveXForIE10Plus){de.bHTML5Edition=false,St.bHTML5Edition=false,St.bActiveXEdition=!0,St.bChromeEdition=St.bHTML5Edition}}St.bActiveXEdition?U.addScript([A,"/src/dynamsoft.webtwain.activex.js",D].join(""),!0,!1,function(){St.dwtConfigLoaded=!0,St.dwtConfigLoading=!1,PW()}):(St.dwtConfigLoaded=!0,St.dwtConfigLoading=!1,PW())}else setTimeout(pfe,100)}var gfe,RW=3e3,n3=0;function AP(y){return lo("Loading the config script..."),St.dwtConfigLoaded?ge.Promise.resolve():(y&&(RW=1e3*parseInt(y))<1&&(RW=1),new ge.Promise(function(C,x){e3.push(C),t3.push(x),q1(function(){n3=(new Date).getTime(),setTimeout(pfe,100)})}))}function mfe(){var y;(y=Ce.DWT.WebTwainIdMap)&&U.each(y,function(C,x){C&&C._OnPageBlur&&C._OnPageBlur()})}if(St.bActiveXEdition){var vfe=function(){var y,C,x,w,T;if(Ce.DWT.lunload(),ge.closeAll&&ge.closeAll(),w=Ce.DWT.ContainerMap)for(T=Object.keys(w),y=0;y<T.length;y++)(x=T[y])&&x in w&&(C=w[x])&&(C.__unload(),delete w[x]);if(w=Ce.DWT.WebTwainIdMap)for(T=Object.keys(w),y=0;y<T.length;y++)(x=T[y])&&x in w&&(C=w[x])&&(C.__unload(),delete w[x]);for(y=0;y<ge.product.unloadQueue.length;y++){var A=ge.product.unloadQueue[y];ge.isFunction(A)&&A()}return ge.product.unloadQueue.splice(0),ge.detect.arySTwains.splice(0),ge.Promise.resolve()};Ce.DWT.Unload=function(){vfe();try{Ce.DWT.CloseDialog(),ge._zdgb_xkz_dhk(),ge.closeProgress(null,""),ge.hideMask()}catch(y){}},Ce.DWT.Load=function(){if(!ge.product.bDWTLoading)return ge.product.bDWTLoading=!0,ge.detect.axAutoLoadDone=!1,AP().then(yC).then(vfe).then(function(){return Ce.DWT._innerLoad()}).then(function(){ge.product.bDWTLoading=!1,ge.detect.axAutoLoadDone=!0},function(y){ge.product.bDWTLoading=!1,ge.detect.axAutoLoadDone=!1,GA(y)})},Ce.DWT.ConnectToTheService=Ce.DWT.Load,Ce.DWT.CheckConnectToTheService=function(y,C,x,w){ge.product.bActiveXEdition?ge.isFunction(w)&&w():ge.isFunction(x)&&x()},Ce.DWT.CreateDWTObject=function(y,C,x,w,T,A){return ge._safePromptCustomMsg(function(){A&&A("Error: This browser is currently not supported.")}),!1},Ce.DWT.CreateDWTObjectEx=function(y,C,x){return ge._safePromptCustomMsg(function(){x&&x("Error: This browser is currently not supported.")}),!1},Ce.DWT.CreateRemoteScanObjectAsync=function(){var y={};return wt(y,-2433,"The ActiveX edition does not support this method or property."),ge.Promise.reject({code:y._errorCode,message:y._errorString})},Ce.DWT.DeleteDWTObject=function(y){return!1}}function MW(){return!(function(y){if(U.isString(y)){if("localhost"==y||"127.0.0.1"==y)return!0;var C=y.split(".");if(4==C.length&&/^(([1-9]?\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}([1-9]?\d|1\d{2}|2[0-4]\d|25[0-5])$/.test(y)){var x=parseInt(C[0]),w=parseInt(C[1]);if(127==x||10==x||169==x&&254==w||172==x&&w>=16&&w<=31||192==x&&168==w)return!0}}return!1}(location.hostname)||de.bSSL||de.bFileSystem||!((de.bChrome||de.bEdge)&&parseInt(de.strBrowserVersion)>=94))}function yfe(y,C,x,w){return OW.apply(this,arguments)}function OW(){return OW=yt(W.mark(function y(C,x,w,T){var A,D;return W.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(x!=Jr.GET_TASKID){M.next=4;break}return M.abrupt("return",T.taskId);case 4:if(x!=Jr.ONMESSAGE_PROCESS_DATA){M.next=8;break}return M.abrupt("return",U.parse(C));case 8:if(x!=Jr.ONMESSAGE_GET_TASKID){M.next=13;break}if(!T||!T.client){M.next=11;break}return M.abrupt("return",T.client.getRequestTaskId());case 11:M.next=20;break;case 13:if(x!=Jr.HANDLE_RAW_MESSAGE){M.next=20;break}if(A=null==T?void 0:T.userData){M.next=17;break}return M.abrupt("return",!1);case 17:return(D=C).indexOf("Version not found")>=0||D.indexOf("Function not found")>=0?U.isFunction(A.fFun)&&A.fFun():U.isFunction(A.sFun)&&A.sFun(D),M.abrupt("return",D);case 20:case"end":return M.stop()}},y)})),OW.apply(this,arguments)}function _fe(){St.loadResourcePath?(lo(ice),gfe()):setTimeout(_fe,100)}function PP(){return St.loadResourcePath?(lo(ice),ge.Promise.resolve()):new ge.Promise(function(y,C){gfe=y,setTimeout(_fe,100)})}function Cfe(y){var C,x,w=y.WebTwainId,T=y.Host,A=y.Port,D=y.SSLPort;return(x={}).id=U.isString(w)&&""!==w?w:w=Fce(),U.isDOM(y.Container)?(U.isString((C=y.Container).id)&&""!==C.id||(C.id=["dwt_node_",U.getRandom()].join("")),x.container=C,x.bNoViewer=!1):x.bNoViewer=!0,x.bNoViewer?(x.width=0,x.height=0):(x.width=U.isUndefined(y.Width)?C.style.width?C.style.width:300:y.Width,x.height=U.isUndefined(y.Height)?C.style.height?C.style.height:300:y.Height),x.dmService=y.dmService,U.isString(T)&&""!=T||(T=Ya()),x.host=T,A||(A=Ce.DWT.Port),x.port=A,D||(D=Ce.DWT.SSLPort),x.sslPort=D,x}function bfe(y,C,x){if(y){var w=null!=C?C:270,T=null!=x?x:350;w<=0&&(w=270),T<=0&&(T=350),ft.one(y).before(ge.install._strNonInstallDIV);var A=U.get(ge.install._divDWTNonInstallContainerID);A&&(A.style.width=w,A.style.height=T),U.show(ge.install._divDWTNonInstallContainerID)}}function Xp(y){var C=Hl.getDSPath();if(""!=ge.install._divDWTemessageContainer&&U.hide(ge.install._divDWTemessageContainer),de.bMac)y?U.isFunction(Ce.OnWebTwainNeedUpgradeCallback)&&Ce.OnWebTwainNeedUpgradeCallback(St.name,{default:C},St.bHTML5Edition,Rn.enumMac,de.bIE,de.bSafari,ge.detect.ssl,Po.strIEVersion):U.isFunction(Ce.OnWebTwainNotFoundOnMacCallback)&&Ce.OnWebTwainNotFoundOnMacCallback(St.name,C,St.bHTML5Edition,de.bIE,de.bSafari,ge.detect.ssl,Po.strIEVersion);else if(de.bLinux||Ce.navInfo.bEmbed||de.bChromeOS||Po.bMobile){var x,w,T=Hl.getEnumPlatform();if(Ce.navInfo.bEmbed||de.bAndroid||de.bChromeOS||de.bHarmonyOS?x=C:(x=Hl.getLinuxHTML5DebPath(),w=Hl.getLinuxHTML5RpmPath()),y){if(de.bAndroid)U.isFunction(Ce.OnWebTwainNeedUpgradeOnAndroidCallback)&&Ce.OnWebTwainNeedUpgradeOnAndroidCallback(St.name,C,ge.detect.ssl);else if(U.isFunction(Ce.OnWebTwainNeedUpgradeCallback)){var A={default:x};de.bLinux&&(A.deb=x,A.rpm=w),Ce.OnWebTwainNeedUpgradeCallback(St.name,A,St.bHTML5Edition,T,de.bIE,de.bSafari,ge.detect.ssl,Po.strIEVersion)}}else de.bAndroid?U.isFunction(Ce.OnWebTwainNotFoundOnAndroidCallback)&&Ce.OnWebTwainNotFoundOnAndroidCallback(St.name,C,ge.detect.ssl,!1):U.isFunction(Ce.OnWebTwainNotFoundOnLinuxCallback)&&Ce.OnWebTwainNotFoundOnLinuxCallback(St.name,x,w,St.bHTML5Edition,de.bIE,de.bSafari,ge.detect.ssl,Po.strIEVersion,T)}else(de.bChrome||de.bSafari||de.bFirefox||de.bOpera||Ce.DWT.IfUseActiveXForIE10Plus==fe||!Ce.DWT.ActiveXInstallWithCAB&&de.bIE)&&(y?U.isFunction(Ce.OnWebTwainNeedUpgradeCallback)&&Ce.OnWebTwainNeedUpgradeCallback(St.name,{default:C},St.bHTML5Edition,Rn.enumWindow,de.bIE,de.bSafari,ge.detect.ssl,Po.strIEVersion):U.isFunction(Ce.OnWebTwainNotFoundOnWindowsCallback)&&Ce.OnWebTwainNotFoundOnWindowsCallback(St.name,C,St.bHTML5Edition,de.bIE,de.bSafari,ge.detect.ssl,Po.strIEVersion))}Ce.DWT.GetWebTwain=Ce.DWT.GetWebTwainEx=function(y){var C=y,x=Ce.DWT.WebTwainIdMap;if(!C){var w=Object.keys(x);return w.length>0?x[C=w[0]]:void 0}if(C in x)return x[C];var T=Ce.DWT.ContainerMap;return C in T?T[C]:void 0},Ce.DWT.NeedCheckWebTwainBySocket=MW,Ce.DWT.CheckWebTwainBySocket=function(y,C,x){var w,T,A,B,H,Y,G,q,re,se,ce,ve,Te,D=ge.detect.urls;if(D&&D.length>0){var M=D[0];w=M.host||Ya(),T=M.port,A=M.ssl}else mc(w=Ya())?(A=!(!de.bSSL||!de.bSafari),w=xo.hostForCheckCert):A=de.bSSL,T=A?Ce.DWT.SSLPort:Ce.DWT.Port;B=Op.getWsClient(w,T,A,!0),H=y,Y=C,G=x,re=U.now(),ce={id:se=U.guid(),method:"VersionInfo",version:[St.getDWTPrefix(),xo.getVersionStrForCheck()].join("")},ve=yfe,Te=M7,q={client:B,userData:{cmdId:se,cmd:null,sFun:H,fFun:Y,rawData:!0},taskId:re},B.setRetry(0),B.request(U.stringify(ce),ve,q,Te).then(function(Ue){return B.dispose(),Ue},function(){U.isFunction(G)&&G(),B.dispose()})},Ce.DWT.IsLocalServiceConnected=function(){return new ge.Promise(function(y,C){var x,w=Ya();U.each(ge.detect.ports,function(T){de.bSSL?T.ssl&&(x=T.port):T.ssl||(x=T.port)}),Ce.DWT.CheckConnectToTheService(w,x,function(T,A,D){y(!0)},function(){C(!1)})})},ge.detect.onNoControl=function(y,C,x,w){w&&w._bRemoteMode&&!w._bNotShowMessage?U.isFunction(Ce.OnRemoteWebTwainNotFoundCallback)&&Ce.OnRemoteWebTwainNotFoundCallback(St.name,w._serverInfo.server,w._serverInfo.port,w._serverInfo.ssl,Po.bMobile):(bfe(y,C,x),Xp(!1))};var xfe,wfe=!1;function H$e(y,C){mc(y)&&(sd.item("DWT_port",C),sd.item("DWT_ssl",de.bSSL?"true":"false"))}function FW(y,C,x,w,T){return Sfe.apply(this,arguments)}function Sfe(){return(Sfe=yt(W.mark(function y(C,x,w,T,A){var M,B,H,Y,G,q,re,se,ce,ve,Te,Ue,je,Ee,Oe,He,we,ue,pe,ye,me,Se,We,ze,Be,$e;return W.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:if(Ce.DWT.OnWebTwainInitMessage&&Ce.DWT.OnWebTwainInitMessage("Checking WebTwain version ...",Yp.Info),B=!1,H=!1,Y=!1,G=Ce.DWT.ConnectWithSocket,A&&(A.bRemoteServer&&(Y=!0),A.bConnectWithSocket&&(G=!0),A.bCheckCert&&(H=!0)),q=U.now(),re=['{"id":"',U.guid(),'","method":"VersionInfo","version":"',St.getDWTPrefix(),xo.getVersionStrForCheck(),'"}'].join(""),se=!G&&!de.bSSL,Ge.prev=6,!G){Ge.next=18;break}return ve=U.now(),Te=yfe,Ue={client:ce,userData:{cmdId:ve,cmd:null,sFun:null,fFun:null,rawData:!0},taskId:ve},(ce=Op.getWsClient(C,x,w)).setRetry(0),Ge.next=14,ce.request(re,Te,Ue,T);case 14:M=Ge.sent,B=!0,Ge.next=25;break;case 18:return je="fa/VersionInfo?v=1&ts="+q,Ee=Op.getHttpClient(C,x,w),Oe={},se&&(Oe.redirect="manual"),Ge.next=24,Ee.request(re,je,Oe,T);case 24:M=Ge.sent;case 25:Ge.next=43;break;case 27:if(Ge.prev=27,Ge.t0=Ge.catch(6),U.log(["check DWT Version failed",U.stringify(Ge.t0)]),!B){Ge.next=33;break}Ge.next=43;break;case 33:if(!se){Ge.next=37;break}if((Ge.t0&&Ge.t0.code)!=Xn.HTTPRedirected){Ge.next=37;break}throw Tle();case 37:throw xS(He={}),Ce.DWT.OnWebTwainInitMessage&&Ce.DWT.OnWebTwainInitMessage(He._errorString,Yp.Error),{code:He._errorCode,message:He._errorString};case 43:if(we="",ue="",pe={},ye=!1,M&&(me=U.parse(M)),!me||!("exception"in me)){Ge.next=50;break}yc(me)?(pe._errorCode=me.exception,pe._errorString=me.description):pe._errorCode=Xn.CommonError,Ge.next=92;break;case 50:if(!me||!("result"in me)){Ge.next=91;break}if(!(U.isArray(me=me.result)&&me.length>0)){Ge.next=88;break}if(Se=me[0],We=me.length>2?me[2]:0,ze=me.length>3?me[3]:"",ue=me.length>4?me[4]:"",""!==(we=me.length>1?me[1]:"")){Ge.next=85;break}if(Be="The WebTwain version is: "+Se,Ce.DWT.OnWebTwainInitMessage&&Ce.DWT.OnWebTwainInitMessage(Be,Yp.Info),"32"==We&&mc(C)&&($n.b64bit=!1),mc(C)&&(Ce.DWT.li({instanceMode:Ce.DWT.EnumInstance.dwt_desktop},"")||""!=ze&&(Ce.DWT.lsmid(ze,""),Ce.DWT.lsmid2b(ze))),(U.isFunction(Ce.DWT.OnSSLCertInfo)||U.isFunction(Ce.OnSSLCertInfo))&&(""!=ue&&($e=Date.parse(ue+"T00:00:00"),$e=isNaN($e)?null:new Date($e)),wfe||(U.isFunction(Ce.DWT.OnSSLCertInfo)?Ce.DWT.OnSSLCertInfo($e):U.isFunction(Ce.OnSSLCertInfo)&&Ce.OnSSLCertInfo($e)),wfe=!0),!H){Ge.next=72;break}if(""!=ue){Ge.next=69;break}throw{code:Xn.SSLCertInvalid,message:"The Dynamsoft Service SSL certificate is invalid."};case 69:if(!lfe(ue)){Ge.next=72;break}throw{code:Xn.SSLCertExpired,message:"The Dynamsoft Service SSL certificate has expired."};case 72:if(!U.isString(Se)||""==Se){Ge.next=82;break}if(lo(zVe),!Y&&!Jce(Se,St.getServerVersionInfo(!0))){Ge.next=78;break}return Ge.abrupt("return",{host:C,port:x,bSSL:w,version:Se,certExpiredDate:$e});case 78:lo(oce),H1(pe);case 80:Ge.next=83;break;case 82:ye=!0;case 83:Ge.next=86;break;case 85:"Version not found"===we?H1(pe):CVe(pe,we);case 86:Ge.next=89;break;case 88:ye=!0;case 89:Ge.next=92;break;case 91:ye=!0;case 92:throw ye&&zl(pe),Ce.DWT.OnWebTwainInitMessage&&Ce.DWT.OnWebTwainInitMessage(pe._errorString,Yp.Error),{code:pe._errorCode,message:pe._errorString};case 95:case"end":return Ge.stop()}},y,null,[[6,27]])}))).apply(this,arguments)}function Tfe(y,C,x){return LW.apply(this,arguments)}function LW(){return LW=yt(W.mark(function y(C,x,w){var T,A,D,M,B,H;return W.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!St.bDWTChecked){Y.next=2;break}return Y.abrupt("return");case 2:return D=de.bSSL?w:x,T=de.bSSL?w:x,A=de.bSSL,Y.prev=5,Y.next=8,Ife(C,T,A,Lt);case 8:M=Y.sent,Y.next=18;break;case 11:if(Y.prev=11,Y.t0=Y.catch(5),Y.t0.code!=Xn.MustUpgrade){Y.next=16;break}throw Xp(!0),Y.t0;case 16:return Y.next=18,z$e(C,x,w);case 18:if(!MW()||Ce.DWT.ConnectWithSocket){Y.next=21;break}return Y.next=21,Y$e(C,D);case 21:return B=M.host,H=M.port,ge.detect.dcpStatus=2,H$e(B,H),Y.next=26,vce(!1,!0);case 26:if(!Xa()||!mc(C)){Y.next=30;break}if(Ce.DWT.li({instanceMode:Ce.DWT.EnumInstance.dwt_desktop},"")){Y.next=30;break}throw{code:-2827,message:"Failed to get Machine ID."};case 30:St.bDWTChecked=!0;case 31:case"end":return Y.stop()}},y,null,[[5,11]])})),LW.apply(this,arguments)}function Ife(y,C,x,w){return Efe.apply(this,arguments)}function Efe(){return(Efe=yt(W.mark(function y(C,x,w,T){var A;return W.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return lo(GVe),x||U.each(ge.detect.ports,function(M){de.bSSL?M.ssl&&(x=M.port):M.ssl||(x=M.port)}),D.prev=2,D.next=5,FW(C,x,w,T?M7:vS,{bConnectWithSocket:T});case 5:A=D.sent,D.next=12;break;case 8:throw D.prev=8,D.t0=D.catch(2),ge.detect.dcpStatus=3,D.t0;case 12:return lo(YVe),!xo.versionInfoFromServer&&mc(A.host)&&(xo.versionInfoFromServer=A.version),D.abrupt("return",A);case 15:case"end":return D.stop()}},y,null,[[2,8]])}))).apply(this,arguments)}function G$e(y,C,x,w,T){Dfe(y,C,{bRemoteServer:!0,bConnectWithSocket:x},w,T)}function Dfe(y,C,x,w,T){var A=0,D=y,M=C,B=ge.detect.ssl,H=w,Y=T;if(U.isFunction(D)&&U.isFunction(M))for(H=D,Y=M,D=Ya(),A=0;A<ge.detect.ports.length;A++)if(de.bSSL&&ge.detect.ports[A].ssl||!de.bSSL&&!ge.detect.ports[A].ssl){M=ge.detect.ports[A].port,B=de.bSSL;break}D||(D=Ya()),FW(D,M,B,vS,x).then(function(G){var q=G.host,re=G.port,se=G.version;U.isFunction(H)&&H(q,re,se)},function(G){U.isFunction(Y)&&Y(G)})}function z$e(y,C,x){return NW.apply(this,arguments)}function NW(){return NW=yt(W.mark(function y(C,x,w){var T,A,D,M,B,H,Y;return W.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(T=de.bSSL?w:x,!de.bSSL||de.bSafari||de.bMobile||de.bAndroid){G.next=45;break}if(G.prev=2,!Ce.DWT.ConnectWithSocket&&1==Ce.DWT.IfCheckCORS){G.next=7;break}throw xS(A={}),{code:A._errorCode,message:A._errorString};case 7:return G.next=9,BW(C,T,!1);case 9:case 28:G.next=43;break;case 11:if(G.prev=11,G.t0=G.catch(2),(D=G.t0.code)!=Xn.CORSErrorFromService&&D!=Xn.SSLCertExpired&&D!=Xn.SSLCertInvalid){G.next=18;break}throw G.t0;case 18:if(D!=Xn.MustUpgrade){G.next=21;break}throw Xp(!0),G.t0;case 21:if(G.prev=21,1==Ce.DWT.IfCheckCert){G.next=26;break}throw xS(M={}),{code:M._errorCode,message:M._errorString};case 26:return G.next=28,FW(j1,x,!1,M7,{bConnectWithSocket:!0,bCheckCert:!0});case 31:if(G.prev=31,G.t1=G.catch(21),(B=G.t1.code)!=Xn.CORSErrorFromService&&B!=Xn.SSLCertExpired&&B!=Xn.SSLCertInvalid){G.next=38;break}throw G.t1;case 38:if(B!=Xn.MustUpgrade){G.next=41;break}throw Xp(!0),G.t1;case 41:throw mc(C)?Xp(!1):U.isFunction(Ce.OnRemoteWebTwainNotFoundCallback)&&Ce.OnRemoteWebTwainNotFoundCallback(St.name,C,T,de.bSSL,Po.bMobile),G.t1;case 43:case 52:G.next=66;break;case 45:if(G.prev=45,!Ce.DWT.ConnectWithSocket&&0!=Ce.DWT.IfCheckCORS){G.next=50;break}throw xS(H={}),{code:H._errorCode,message:H._errorString};case 50:return G.next=52,BW(C,T,!1);case 54:if(G.prev=54,G.t2=G.catch(45),(Y=G.t2.code)!=Xn.CORSErrorFromService&&Y!=Xn.SSLCertExpired&&Y!=Xn.SSLCertInvalid){G.next=61;break}throw G.t2;case 61:if(Y!=Xn.MustUpgrade){G.next=64;break}throw Xp(!0),G.t2;case 64:throw mc(C)?Xp(!1):U.isFunction(Ce.OnRemoteWebTwainNotFoundCallback)&&Ce.OnRemoteWebTwainNotFoundCallback(St.name,C,T,de.bSSL,Po.bMobile),G.t2;case 66:throw j7();case 67:case"end":return G.stop()}},y,null,[[2,11],[21,31],[45,54]])})),NW.apply(this,arguments)}function Y$e(y,C){return Afe.apply(this,arguments)}function Afe(){return(Afe=yt(W.mark(function y(C,x){return W.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",BW(C,x,!0));case 1:case"end":return w.stop()}},y)}))).apply(this,arguments)}function BW(y,C,x){return Pfe.apply(this,arguments)}function Pfe(){return(Pfe=yt(W.mark(function y(C,x,w){var T,A,D;return W.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(M.prev=0,Ce.DWT.ConnectWithSocket){M.next=5;break}return M.next=4,Ife(C,x,de.bSSL,vt);case 4:T=M.sent;case 5:M.next=14;break;case 7:throw M.prev=7,M.t0=M.catch(0),A=M.t0,(D=M.t0.code)==Xn.ResponseDataTypeError||D==Xn.HTSTError||D==Xn.CORSError||D==Xn.SSLCertExpired||D==Xn.SSLCertInvalid||D==Xn.MustUpgrade||(D==Xn.CORSErrorFromService?U.isFunction(Ce.OnCorsConfigError)&&Ce.OnCorsConfigError(M.t0.message):mc(C)&&w&&MW()&&(D=(A={code:Xn.CORSError,message:'The Connection from the insecure (HTTP) web page to the local "Dynamsoft Service" failed!'}).code)),D==Xn.CORSError&&U.isFunction(Ce.OnHTTPCorsError)&&Ce.OnHTTPCorsError(A.message),A;case 14:return M.abrupt("return",T);case 15:case"end":return M.stop()}},y,null,[[0,7]])}))).apply(this,arguments)}function WW(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function Im(y,C,x){return C.has(y),x}!function(y){y.DoNotCheck=0,y.Check127=1,y.CheckLocalDynamsoftCert=2}(xfe||(xfe={}));var X$e=new WeakSet,i3=new WeakSet,r3=new WeakSet,$$e=function(y){function C(){var H,re,se,ce;l(this,C);for(var Y=arguments.length,G=new Array(Y),q=0;q<Y;q++)G[q]=arguments[q];return re=this,se=C,ce=[].concat(G),se=qn(se),WW(H=$a(re,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(ve){return!1}}()?Reflect.construct(se,ce||[],qn(re).constructor):se.apply(re,ce)),r3),WW(H,i3),WW(H,X$e),H}return qa(C,y),g(C,[{key:"SetCookie",value:function(H){return this._cookie=H,document.cookie=H,Lt}},{key:"LoadImageFromBase64Binary",value:function(H,Y,G,q){var re=this,se=!1;if(U.isFunction(G)&&(se=!0),re._resetErr(),!re._isValid())return U.isFunction(q)&&nn(q,re),!!se&&void 0;if(!H)return Wi(re),U.isFunction(q)&&nn(q,re),!!se&&void 0;var ce,ve,Te,Ue,je,Se,Ee=H,Oe="LoadImageFromBase64Binary",He=Y,we=1;if(Ee instanceof Y9&&U.isFunction(Ee.getLength)&&U.isFunction(Ee.getData)&&(Ee=Ee.getData(0,Ee.getLength())),U.isString(Ee))if(-1!=Ee.indexOf("data:image/bmp"))He=0;else if(-1!=Ee.indexOf("data:image/jpeg"))He=1;else if(-1!=Ee.indexOf("data:image/tif"))He=2;else if(-1!=Ee.indexOf("data:image/png"))He=3;else if(-1!=Ee.indexOf("data:application/pdf"))He=4;else if(-1!=Ee.indexOf("data:image/jp2"))He=14;else{var ue=Ee.substr(0,64),pe=U.base64.decode(ue,!0);Ue=Ce.DWT.EnumDWT_ImageType,je=Te=pe,(Te instanceof ArrayBuffer||Te instanceof Array)&&(je=new Uint8Array(Te.slice(0,12))),He=37==(Se=je)[0]&&80==Se[1]&&68==Se[2]&&70==Se[3]?Ue.IT_PDF:function(Se){return 73==Se[0]&&73==Se[1]&&42==Se[2]&&0==Se[3]||77==Se[0]&&77==Se[1]&&0==Se[2]&&42==Se[3]}(je)?Ue.IT_TIF:function(Se){return 137==Se[0]&&80==Se[1]&&78==Se[2]&&71==Se[3]}(je)?Ue.IT_PNG:function(Se){return 255==Se[0]&&216==Se[1]}(je)?Ue.IT_JPG:function(Se){return 66==Se[0]&&77==Se[1]}(je)?Ue.IT_BMP:function(Se){return 0==Se[0]&&0==Se[1]&&0==Se[2]&&12==Se[3]&&106==Se[4]&&80==Se[5]&&32==Se[6]&&32==Se[7]||255==Se[0]&&79==Se[1]&&255==Se[2]&&81==Se[3]}(je)?Ue.IT_J2K:Ue.IT_PNG}if(He!=Ce.DWT.EnumDWT_ImageType.IT_BMP&&He!=Ce.DWT.EnumDWT_ImageType.IT_JPG&&He!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&He!=Ce.DWT.EnumDWT_ImageType.IT_PNG&&He!=Ce.DWT.EnumDWT_ImageType.IT_PDF&&He!=Ce.DWT.EnumDWT_ImageType.IT_J2K&&(He=-1),!pn.checkProductKey(re,{Core:!0})||!pn.checkPDFProductKeyWhenNeeds(re,He))return U.isFunction(q)&&nn(q,re),!!se&&void 0;if(U.isString(Ee)&&-1!=Ee.indexOf("base64,")&&(Ee=Ee.substr(Ee.indexOf("base64,")+7)),ve=re.__GetLoadEventsNum(),!se){var ye=re._getCurrentDocumentName(),me=re._getCurrentDefaultTagName();return(ce=re.__innerLoadImageFun(Oe,It(Ee,He,ve,we),we,ye,me))&&re._canConsume()&&Ce.DWT.lcvrf(re),ce}ge.cancelFrom=Zn.LoadImage,re.IfShowProgressBar?ge.showProgress(re,Oe,re.__IfShowCancelDialogWhenImageTransfer):ge.hideProgress(),re.__bLoadingImage=!0,re._innerSend(Oe,It(Ee,He,ve,we=0),!0,function(){if(ge.closeProgress(null,Oe),re.__bLoadingImage=!1,re._isBindViewer()){var Se=re._ImgManager.getCurrentImageIndex();Se>=0&&re._innerRefreshUI(Se)}re._canConsume()&&Ce.DWT.lcvrf(re),G&&G(Ee,Y)},function(){ge.closeProgress(null,Oe),re.__bLoadingImage=!1,U.isFunction(q)&&q(re._errorCode,re._getErrorString(),Ee,Y)})}},{key:"SaveSelectedImagesToBytes",value:function(H,Y){return yS(this),vt}},{key:"LoadImageFromBytes",value:function(H,Y,G){return yS(this),vt}},{key:"SetImageWidth",value:function(H,Y,G,q){var re,se=this,ce=!1;if(U.isFunction(G)&&(ce=!0),se._resetErr(),!se._isValid())return!!ce&&void 0;var ve=parseInt(H);if(isNaN(ve))return Jn(se),U.isFunction(q)&&q(se._errorCode,se._getErrorString()),!!ce&&void 0;if(ve<0||ve>=se._ImgManager.count())return kt(se),U.isFunction(q)&&q(se._errorCode,se._getErrorString()),!!ce&&void 0;if(U.isUndefined(Y))return Wi(se),U.isFunction(q)&&q(se._errorCode,se._getErrorString()),!!ce&&void 0;var Te=se._ImgManager.convertClientIndexToServerId(ve);return-1==Te?(kt(se),U.isFunction(q)&&q(se._errorCode,se._getErrorString()),!!ce&&void 0):((re=1==se._innerFun("SetImageWidth",It(Te,Y)))?U.isFunction(G)&&G():U.isFunction(q)&&q(se._errorCode,se._getErrorString()),ce?void 0:re)}},{key:"HTTPDownloadStreamThroughPost",value:function(H,Y){return yS(this),vt}},{key:"HTTPUploadStreamThroughPost",value:function(H,Y,G,q,re){return yS(this),vt}},{key:"HTTPUploadThroughPutDirectly",value:function(H,Y,G,q,re){return yS(this),!1}},{key:"SetCustomDSDataEx",value:function(H){return this._resetErr(),!!this._isValid()&&this._innerFun("SetCustomDSDataEx",It(H))}},{key:"SetCustomDSData",value:function(H){if(this._resetErr(),!this._isValid())return!1;var Y=zn.replaceLocalFilename(H);return this._innerFun("SetCustomDSData",It(Y))}},{key:"GetCustomDSDataEx",value:function(){var H=this;return H._resetErr(),!!H._isValid()&&H._innerFun("GetCustomDSDataEx")}},{key:"GetCustomDSData",value:function(H){var Y=this;if(Y._resetErr(),!Y._isValid())return!1;var G=zn.replaceLocalFilename(H);return Y._innerFun("GetCustomDSData",It(G))}},{key:"on",value:function(H,Y){return this.registerEvent(H,Y)}},{key:"off",value:function(H,Y){return this.unregisterEvent(H,Y)}},{key:"ConvertToBW",value:function(H,Y,G){var q=this,re=!1;if(U.isFunction(Y)&&(re=!0),q._resetErr(),!q._isValid())return!!re&&void 0;if(!pn.checkProductKey(q,{Core:!0}))return U.isFunction(G)&&G(q._errorCode,q._getErrorString()),!!re&&void 0;var se=parseInt(H);if(isNaN(se))return Jn(q),U.isFunction(G)&&G(q._errorCode,q._getErrorString()),!!re&&void 0;if(se<0||se>=q._ImgManager.count())return kt(q),U.isFunction(G)&&G(q._errorCode,q._getErrorString()),!!re&&void 0;var ce=q.ChangeBitDepth(H,1,!0);return ce?U.isFunction(Y)&&Y():U.isFunction(G)&&G(q._errorCode,q._getErrorString()),re?void 0:ce}},{key:"LoadImageFromBinary",value:function(H,Y,G){var q,re,se=this,ce="LoadImageFromBinary",ve=!1;U.isFunction(Y)&&(ve=!0);var Te=null===(q=ge.progressContext)||void 0===q?void 0:q.IfShowCancelDialogWhenImageTransfer;return ve&&(se.IfShowProgressBar?(ge.showProgress(se,ce,!1),ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=!1)):ge.hideProgress()),re=se._innerLoadImageFromBinary(H,0,!0,ve,function(){ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=Te),U.isFunction(Y)&&(se.IfShowProgressBar&&ge.closeProgress(null,ce),Y())},function(Ue,je){ge.progressContext&&(ge.progressContext.IfShowCancelDialogWhenImageTransfer=Te),U.isFunction(Y)&&se.IfShowProgressBar&&ge.closeProgress(null,ce),U.isFunction(G)&&G(Ue,je)}),ve?void 0:re}},{key:"EnableSourceUI",value:function(H,Y){var G=this;return G._resetErr(),!!G._isValid()&&(G._innerSend("EnableSourceUI",null,!0,H,Y),!0)}},{key:"GetIfShowVideoContainer",value:function(){return this._UIView.GetIfShowVideoContainer()}},{key:"ShowVideoContainer",value:function(H){return this._UIView.ShowVideoContainer(H)}},{key:"UpdateVideoContainer",value:function(H){return this._UIView.UpdateVideoContainer(H)}},{key:"ChangeBitDepth",value:function(H,Y,G){var q,re=this;if(re._resetErr(),!re._isValid())return!1;if(q=parseInt(H),isNaN(q))return Jn(re),!1;if(q<0||q>=re._ImgManager.count())return kt(re),!1;var se=re._ImgManager.convertClientIndexToServerId(q);return-1==se?(kt(re),!1):re._innerFun("ChangeBitDepth",It(se,Y,G))}},{key:"ConvertToGrayScale",value:function(H,Y,G){var q,re=this,se=!1;if(U.isFunction(Y)&&(se=!0),re._resetErr(),!re._isValid())return!!se&&void 0;var ce=parseInt(H);if(isNaN(ce))return Jn(re),U.isFunction(G)&&G(re._errorCode,re._getErrorString()),!!se&&void 0;if(ce<0||ce>=re._ImgManager.count())return kt(re),U.isFunction(G)&&G(re._errorCode,re._getErrorString()),!!se&&void 0;var ve=re._ImgManager.convertClientIndexToServerId(ce);return-1==ve?(kt(re),U.isFunction(G)&&G(re._errorCode,re._getErrorString()),!!se&&void 0):((q=1==re._innerFun("ConvertToGrayScale",It(ve)))?(zn.refreshImageAfterInvokeFun(re,ce),U.isFunction(Y)&&Y()):U.isFunction(G)&&G(re._errorCode,re._getErrorString()),se?void 0:q)}},{key:"ClearTiffCustomTag",value:function(){var H=this;return H._resetErr(),!!H._isValid()&&(H._aryTiffTag.splice(0,H._aryTiffTag.length),H._innerFun("ClearTiffCustomTag"))}},{key:"SetTiffCustomTag",value:function(H,Y,G){var q=this;if(q._resetErr(),!q._isValid())return!1;if(U.isUndefined(H)||U.isUndefined(Y))return Wi(q),!1;var re,se=1*H;if(re=U.isString(Y)?U.replaceAll(Y,'"','\\"'):Y,se<=0||se>2147483647)return wt(q,-2378,"Invalid value for the tiff tag code."),!1;var ce,ve=0,Te=!1,Ue=q._aryTiffTag.length;for(ve=0;ve<Ue;ve++)(ce=q._aryTiffTag[ve]).tag==se&&(ce.Content=Y,ce.UseBase64Encoding=G,Te=!0);return!Te&&Ue>=32?(wt(q,-2428,"Tiff tag count has exceeded the limit."),!1):q._innerFun("SetTiffCustomTag",It(se,re,G))}},{key:"IsBlankImage",value:function(H){var Y,G=this;if(G._resetErr(),!G._isValid())return!1;if(Y=parseInt(H),isNaN(Y))return Jn(G),!1;if(Y<0||Y>=G._ImgManager.count())return kt(G),!1;var q=G._ImgManager.convertClientIndexToServerId(Y);return-1==q?(kt(G),!1):G._innerFun("IsBlankImage",It(q,vt))}},{key:"IsBlankImageExpress",value:function(H){var Y=this;if(Y._resetErr(),!Y._isValid())return!1;var G=parseInt(H);if(isNaN(G))return Jn(Y),!1;if(G<0||G>=Y._ImgManager.count())return kt(Y),!1;var q=Y._ImgManager.convertClientIndexToServerId(G);return-1==q?(kt(Y),!1):Y._innerFun("IsBlankImage",It(q,Lt))}},{key:"SetOpenSourceTimeout",value:function(H){var Y=this;return Y._resetErr(),!!Y._isValid()&&Y._innerFun("SetOpenSourceTimeout",It(H))}},{key:"GetImageURL",value:function(H,Y,G,q,re){var se=this;if(se._resetErr(),!se._isValid())return!1;var ce,ve,Te,Ue,je=H,Ee=parseInt(Y),Oe=parseInt(G);if(q?(ce="",ve="dwt://"):(ce=se._httpUrl,ve="dwt/"),Ue=se._bScanForProxyRemote?xo.getVersionStrForCheck():St.getServerVersionInfo(),Te=[ce,ve,St.getDWTPrefix(),Ue,"/img?id=",se._clientId],U.isUndefined(je)||null===je)return cle(se),"";if(re)Te.push("&index=-1&width=-1&height=-1&webcam="),Te.push(re);else{if(je=parseInt(je),isNaN(je))return Jn(se),"";if(je<-1||je>=se._ImgManager.count())return kt(se),"";var He=se._ImgManager.convertClientIndexToServerId(je);if(-1==He)return"";Te.push("&index="),Te.push(He),Ee>0&&Oe>0?(Te.push("&width="),Te.push(Ee),Te.push("&height="),Te.push(Oe)):Te.push("&width=-1&height=-1"),Po.bMobile&&Te.push("&type=1&quality=85")}if(Te.push("&t="),Te.push((new Date).getTime()),Te=Te.join(""),de.bFileSystem&&Te.indexOf("dwt://")<0){var we=new Image;we.crossOrigin="anonymous",we.src=Te,we=null}return Te}},{key:"GetImagePartURL",value:function(H,Y,G){var q=this;if(q._resetErr(),!q._isValid())return!1;var re=parseInt(H);return isNaN(re)?(Jn(q),""):re<0||re>=q._ImgManager.count()?(kt(q),""):this.GetImageURL(re,Y,G,!0)}},{key:"SetLanguage",value:function(H){var Y=this;return Y._resetErr(),!!Y._isValid()&&Y._innerFun("SetLanguageForSecurity",It(H))}},{key:"GetLicenseInfo",value:function(H,Y){var G=this;G.__licenseInfo?U.isFunction(H)&&H(G.__licenseInfo):G._innerFunRaw("GetLicenseInfo",It(0),Lt,vt,Lt,function(q){q?q.exception?U.isFunction(Y)&&Y(q.exception):(U.isArray(q.result)&&q.result.length>0&&TB(G,q.result[0]),U.isFunction(H)&&H(G.__licenseInfo)):U.isFunction(Y)&&Y()},Y)}},{key:"SetProductKeyAsync",value:function(H){return this._setProductKeyAsync(H)}},{key:"GetVersionInfoAsync",value:function(){return ft.Promise.resolve(xo.versionInfoFromServer)}},{key:"isUsingActiveX",value:function(){return!1}},{key:"SetLTSLicenseAsync",value:function(H){return this._setLTSLicenseAsync(H)}},{key:"Print",value:function(H){var Y=this;return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("Print"):H?(Y._innerSend("PrintEx",It(!0),!0,function(){},function(){}),!0):(Y._ImagePrint.Print(),!0))}},{key:"PrintEx",value:function(H){var Y=this;return Y._resetErr(),!!Y._isValid()&&!!Y._checkIndices(H)&&(Y._isNoViewer()?Y._nouiNotSupport("Print"):(Y._ImagePrint.PrintEx(H),!0))}},{key:"IsBlankImageAsync",value:(B=yt(W.mark(function H(Y,G){var q,re,se,ce;return W.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(q=this,Hl.getEnumPlatform()==Rn.enumWindow){ve.next=5;break}throw wt(q,-2905,"This API is not supported on the current operating system. Please contact your system administrator."),{code:this._errorCode,message:this._getErrorString()};case 5:return se={minBlockHeight:20,maxBlockHeight:30},G&&(U.isNumber(G.minBlockHeight)&&G.minBlockHeight>=0&&(se.minBlockHeight=G.minBlockHeight),U.isNumber(G.maxBlockHeight)&&G.maxBlockHeight>=0&&(se.maxBlockHeight=G.maxBlockHeight)),re={command:"isBlankImage",parameter:{index:Y,minHeight:se.minBlockHeight,maxHeight:se.maxBlockHeight}},ve.next=10,q.RunCommandAsync(re);case 10:if(!((ce=ve.sent)&&ge.isArray(ce.result)&&ce.result.length>0)){ve.next=13;break}return ve.abrupt("return",ce.result[0]);case 13:return ve.abrupt("return",!1);case 14:case"end":return ve.stop()}},H,this)})),function(H,Y){return B.apply(this,arguments)})},{key:"httpUploadBlob",value:function(H,Y,G,q){var re=this,se="httpUploadBlob",ce=Y,ve=G,Te=null,Ue=null,je=hu.Text;if(re._resetErr(),!re._isValid())return ge.Promise.reject({code:re._errorCode,message:re._errorString});if(U.isUndefined(H)||""===H)return _l(re),ge.Promise.reject({code:re._errorCode,message:re._errorString});if(!U.isString(H))return CS(re),ge.Promise.reject({code:re._errorCode,message:re._errorString});if(!(ce instanceof Blob))return Wi(re),ge.Promise.reject({code:re._errorCode,message:re._errorString});var Ee=ce.type.toLocaleLowerCase();if("image/jpeg"!=Ee&&"image/jpg"!=Ee&&"image/png"!=Ee&&"image/bmp"!=Ee&&"application/pdf"!=Ee&&"image/tiff"!=Ee&&"image/tif"!=Ee)return wt(re,-2845,"Only Blob of JPEG, PNG, BMP, TIFF and PDF image types can be uploaded."),ge.Promise.reject({code:re._errorCode,message:re._errorString});q&&(Te=new FormData,U.each(q.formFields,function(ue,pe){var ye=ue.name,me=ue.value;U.isString(ye)&&(me instanceof Blob?Te.append(ye,me,ue.fileName):Te.append(ye,me))}),Ue={},U.each(q.headers,function(ue,pe){U.isString(ue.name)&&(Ue[ue.name]=ue.value)}),q.responseType&&(je=q.responseType));var Oe=re._createHttpUploaderConfig(),He=new xf,we=new fd;return we.url=H,we.method=se,we.content=ce,ce=null,we.contentType=re._strHttpContentTypeFieldValue,we.headers=Ue,we.fileName=ve,we.httpFormData=Te,re.__remoteFilename&&""!=re.__remoteFilename&&(we.remoteFilename=re.__remoteFilename),we.retry=1,we.bOnlyResponseEmptyIsOK=!1,we.responseType=je,Oe.objUploadStatus=void 0,re.IfShowProgressBar&&ge.showProgress(re,se,!1),new ge.Promise(function(ue,pe){He.httpPostUpload(Oe,we,function(ye){re.IfShowProgressBar&&ge.closeProgress(re,se,!1),ue(ye)},function(ye,me){re.IfShowProgressBar&&ge.closeProgress(re,se,!1),pe({code:ye,message:me})})})}},{key:"saveBlob",value:(M=yt(W.mark(function H(Y,G){var q,re,se,ce,ve;return W.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:if(se=Y,(q=this)._resetErr(),q._isValid()){Te.next=4;break}throw{code:q._errorCode,message:q._errorString};case 4:if(!U.isString(Y)&&null!=Y){Te.next=7;break}Te.next=9;break;case 7:case 21:throw Wi(q),{code:q._errorCode,message:q._errorString};case 9:if(!(G instanceof Blob)){Te.next=21;break}if("image/jpeg"!=(ve=G.type.toLocaleLowerCase())&&"image/jpg"!=ve&&"image/png"!=ve&&"image/bmp"!=ve&&"application/pdf"!=ve&&"image/tiff"!=ve&&"image/tif"!=ve){Te.next=14;break}Te.next=16;break;case 14:throw wt(q,-2844,"Only Blob of JPEG, PNG, BMP, TIFF and PDF image types can be saved."),{code:q._errorCode,message:q._errorString};case 16:return Te.next=18,tfe(G);case 18:ce=Te.sent,Te.next=23;break;case 23:return se||(se=""),se=zn.replaceLocalFilename(se),re=It(se),Te.next=28,new ge.Promise(function(Ue,je){q._innerSendBlobByWS("SaveBlobToFile",re,ce,function(Ee){Ue(Ee)},function(Ee){je({code:q._errorCode,message:q._errorString})})});case 28:case"end":return Te.stop()}},H,this)})),function(H,Y){return M.apply(this,arguments)})},{key:"createLocalStorage",value:(D=yt(W.mark(function H(Y){var G,re,se,ce;return W.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if((G=this)._resetErr(),G._isValid()){ve.next=4;break}throw{code:G._errorCode,message:G._errorString};case 4:if(re="CreateLocalStorage",se=null,!Y){ve.next=12;break}if(ce=Y.password,!1!==Im(this,i3,RP).call(this,ce)){ve.next=9;break}throw{code:G._errorCode,message:G._errorString};case 9:se=JSON.stringify([JSON.stringify(Y)]),ve.next=13;break;case 12:se='["{}"]';case 13:return ve.next=15,new ge.Promise(function(Te,Ue){G._innerSend(re,se,!1,function(je){if(U.isArray(je)&&je.length>0){var Ee=je[0];Ee&&U.isString(Ee.uid)&&Te(Ee.uid)}else zl(G),Ue({code:G._errorCode,message:G._errorString})},function(){Ue({code:G._errorCode,message:G._errorString})})});case 15:return ve.abrupt("return",ve.sent);case 17:case"end":return ve.stop()}},H,this)})),function(H){return D.apply(this,arguments)})},{key:"localStorageExist",value:(A=yt(W.mark(function H(Y){var G,q;return W.wrap(function(se){for(;;)switch(se.prev=se.next){case 0:if(q="LocalStorageExist",(G=this)._resetErr(),G._isValid()){se.next=4;break}throw{code:G._errorCode,message:G._errorString};case 4:if(0!=Im(G,r3,kP).call(G,Y)){se.next=6;break}throw{code:G._errorCode,message:G._errorString};case 6:return se.next=8,new ge.Promise(function(ce,ve){G._innerSend(q,It(Y),!1,function(Te){if(U.isArray(Te)&&Te.length>0){var Ue=Te[0];(U.isBoolean(Ue)||U.isNumber(Ue))&&ce(!!Ue)}else zl(G),ve({code:G._errorCode,message:G._errorString})},function(){ve({code:G._errorCode,message:G._errorString})})});case 8:return se.abrupt("return",se.sent);case 10:case"end":return se.stop()}},H,this)})),function(H){return A.apply(this,arguments)})},{key:"saveToLocalStorage",value:(T=yt(W.mark(function H(Y){var G,q,re;return W.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(q="SaveToLocalStorage",re=null,(G=this)._resetErr(),G._isValid()){ce.next=4;break}throw{code:G._errorCode,message:G._errorString};case 4:if(U.isObject(Y)){ce.next=7;break}throw Wi(G),{code:G._errorCode,message:G._errorString};case 7:if(!1!==Im(G,r3,kP).call(G,Y.uid)&&!1!==Im(this,i3,RP).call(this,Y.password)){ce.next=9;break}throw{code:G._errorCode,message:G._errorString};case 9:if(!U.isUndefined(Y.indices)){ce.next=13;break}Y.indices=Wje(G),ce.next=19;break;case 13:if(!U.isArray(Y.indices)||0!=Y.indices.length){ce.next=16;break}ce.next=19;break;case 16:if(G._checkIndices(Y.indices)){ce.next=18;break}throw{code:G._errorCode,message:G._errorString};case 18:Y.indices=_m(G,Y.indices);case 19:return re=JSON.stringify([JSON.stringify(Y)]),ce.next=22,new ge.Promise(function(ve,Te){G._innerSend(q,re,!1,function(Ue){if(U.isArray(Ue)&&Ue.length>0){var je=Ue[0];je&&je.imageIds&&ve(je.imageIds)}else zl(G),Te({code:G._errorCode,message:G._errorString})},function(){Te({code:G._errorCode,message:G._errorString})})});case 22:return ce.abrupt("return",ce.sent);case 24:case"end":return ce.stop()}},H,this)})),function(H){return T.apply(this,arguments)})},{key:"loadFromLocalStorage",value:(w=yt(W.mark(function H(Y){var G,q,re,ce;return W.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(q="LoadFromLocalStorage",re=null,(G=this)._resetErr(),G._isValid()){ve.next=4;break}throw{code:G._errorCode,message:G._errorString};case 4:if(U.isObject(Y)){ve.next=7;break}throw Wi(G),{code:G._errorCode,message:G._errorString};case 7:if(!1!==Im(G,r3,kP).call(G,Y.uid)&&!1!==Im(this,i3,RP).call(this,Y.password)){ve.next=9;break}throw{code:G._errorCode,message:G._errorString};case 9:return(ce=U.clone(Y)).documentName=G._getCurrentDocumentName(),ce.tagName=G._getCurrentDefaultTagName(),re=JSON.stringify([JSON.stringify(ce)]),ge.showProgress(G,q,!1),ge.progressBarOnPercentDone(-1,"Processing...","",0,""),ve.next=17,new ge.Promise(function(Te,Ue){G._innerSend(q,re,!1,function(je){var Ee;ge.closeProgress(null,q),U.isArray(je)&&je.length>0?(Ee=je[0])&&Ee.mapImageIds&&Te(Ee.mapImageIds):(!1===Ee&&0!=G._errorCode||zl(G),Ue({code:G._errorCode,message:G._errorString}))},function(){ge.closeProgress(null,q),Ue({code:G._errorCode,message:G._errorString})})});case 17:return ve.abrupt("return",ve.sent);case 19:case"end":return ve.stop()}},H,this)})),function(H){return w.apply(this,arguments)})},{key:"removeLocalStorage",value:(x=yt(W.mark(function H(Y){var G,q,re;return W.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(q="RemoveLocalStorage",re=null,(G=this)._resetErr(),G._isValid()){ce.next=4;break}throw{code:G._errorCode,message:G._errorString};case 4:if(U.isObject(Y)){ce.next=7;break}throw Wi(G),{code:G._errorCode,message:G._errorString};case 7:if(!1!==Im(G,r3,kP).call(G,Y.uid)&&!1!==Im(this,i3,RP).call(this,Y.password)){ce.next=9;break}throw{code:G._errorCode,message:G._errorString};case 9:return Y&&(re=JSON.stringify([JSON.stringify(Y)])),ce.next=12,new ge.Promise(function(ve,Te){G._innerSend(q,re,!1,function(Ue){if(U.isArray(Ue)&&Ue.length>0){var je=Ue[0];(U.isBoolean(je)||U.isNumber(je))&&ve(!!je)}else zl(G),Te({code:G._errorCode,message:G._errorString})},function(){Te({code:G._errorCode,message:G._errorString})})});case 12:return ce.abrupt("return",ce.sent);case 14:case"end":return ce.stop()}},H,this)})),function(H){return x.apply(this,arguments)})}]);var x,w,T,A,D,M,B}(wf);function RP(y){if(!U.isUndefined(y)){if(!U.isString(y))return wt(this,-2850,"The password is not a string."),!1;if(y.length>32)return wt(this,-2849,"The password must not exceed 32 characters in length."),!1}return!0}function kP(y){return U.isUndefined(y)||""==y?(wt(this,-2846,"The uid cannot be empty."),!1):!!U.isString(y)||(wt(this,-2847,"The uid is invalid."),!1)}function k0(y,C,x,w){var T;0!==x&&1!==x?T=x:(T={},x&&(T.set=1==w?function(A){var D=1*A;return!U.isNumber(D)||isNaN(D)?(da(y),vt):(y._resetErr(),!!y._isValid()&&y._innerFun(C,It(D)))}:2==w?function(A){return U.isBoolean(A)?(y._resetErr(),!!y._isValid()&&y._innerFun(C,It(A))):(da(y),vt)}:function(A){return U.isString(A)?(y._resetErr(),!!y._isValid()&&y._innerFun(C,It(A))):(da(y),vt)})),T.get||(T.get=function(){return y._resetErr(),!!y._isValid()&&y._innerFun(C)}),C in y||Object.defineProperty(y,C,T)}function q$e(y,C){var x="undefined"!=typeof Symbol&&y[Symbol.iterator]||y["@@iterator"];if(!x){if(Array.isArray(y)||(x=function(B,H){if(B){if("string"==typeof B)return kfe(B,H);var Y=Object.prototype.toString.call(B).slice(8,-1);if("Object"===Y&&B.constructor&&(Y=B.constructor.name),"Map"===Y||"Set"===Y)return Array.from(B);if("Arguments"===Y||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Y))return kfe(B,H)}}(y))||C&&y&&"number"==typeof y.length){x&&(y=x);var w=0,T=function(){};return{s:T,n:function(){return w>=y.length?{done:!0}:{done:!1,value:y[w++]}},e:function(B){throw B},f:T}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var A,D=!0,M=!1;return{s:function(){x=x.call(y)},n:function(){var B=x.next();return D=B.done,B},e:function(B){M=!0,A=B},f:function(){try{D||null==x.return||x.return()}finally{if(M)throw A}}}}function kfe(y,C){(null==C||C>y.length)&&(C=y.length);for(var x=0,w=new Array(C);x<C;x++)w[x]=y[x];return w}function J$e(y,C,x){return C.has(y),x}var Mfe=new WeakSet,Ofe=function(){return g(function x(w,T,A,D){l(this,x),function K$e(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}(this,Mfe),Dn(this,"serverUrl",void 0),this.serverUrl=w,this.bLocal=mc(w),this.clientId=null!=A?A:U.guid(),this.bGlobal=T,this.serverName=D,this.bLicenseOK=!1},[{key:"checkSource",value:function(x){if(!x)throw{code:-1003,message:"Source Manager unable to find the specified Source"}}},{key:"parseResultDefault",value:function(x){var w;if(U.isObject(x)&&x.exception&&0!=x.exception)throw{code:x.exception,message:null!==(w=x.description)&&void 0!==w?w:"general error"};if(x&&U.isArray(x.result)&&x.result.length>0){var T=x.result[x.result.length-1];try{return JSON.parse(T)}catch(A){return T}}throw x}},{key:"_requestAsync",value:(C=yt(W.mark(function x(w,T,A){var D,M,B,H,Y,G,q,re,se,ce;return W.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(!Ce.DWT.ConnectWithSocket){ve.next=12;break}return ve.next=3,J$e(this,Mfe,Q$e).call(this);case 3:return M=0,w&&(M=w.cmdId),B={client:D=ve.sent,userData:{command:w},taskId:M},H=eqe,ve.next=9,D.request(U.stringify(w),H,B);case 9:return U.isString(Y=ve.sent)&&(Y=U.parse(Y)),ve.abrupt("return",Y);case 12:return G=[Jle(),"/",w.method].join(""),T&&(re=T),se=(ce=this).serverUrl?Up.getDDMUrl(ce.serverUrl,ce.bGlobal,[Kle,w.method].join("")):Up.getModuleUrl(G),ve.prev=16,ve.next=19,X1(se,{method:"post",dataType:"json",body:U.stringify(w),fetchRaw:null!=A&&A,timeout:re});case 19:q=ve.sent,ve.next=25;break;case 22:throw ve.prev=22,ve.t0=ve.catch(16),ve.t0;case 25:return ve.abrupt("return",q);case 26:case"end":return ve.stop()}},x,this,[[16,22]])})),function(x,w,T){return C.apply(this,arguments)})},{key:"_resetLicense",value:(y=yt(W.mark(function x(w,T,A){return W.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:case"end":return D.stop()}},x)})),function(x,w,T){return y.apply(this,arguments)})}]);var y,C}();function Q$e(){return Ffe.apply(this,arguments)}function Ffe(){return(Ffe=yt(W.mark(function y(){var C,x,w,A,D,M,B,H;return W.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if((C=this)._wsClient){Y.next=10;break}return x=new g0,(w=this.serverUrl)?(D="/",A=ge.detect.ssl?"ddm/18626/":"ddm/18625/",U.endsWith(w,"/")&&(D=""),U.startsWith(w,"https://")||U.startsWith(w,"wss://")?(x.ssl=!0,M=U.startsWith(w,"https://")?U.replaceAll(w,"https://",""):U.replaceAll(w,"wss://",""),w=M+D+A):U.startsWith(w,"http://")||U.startsWith(w,"ws://")?(x.ssl=!1,B=U.startsWith(w,"http://")?U.replaceAll(w,"http://",""):U.replaceAll(w,"ws://",""),w=B+D+A):(x.ssl=ge.detect.ssl,x.port=x.ssl?$n.SSLPort:$n.Port),x.server=w):(x.ssl=ge.detect.ssl,x.server=Ya(),x.port=x.ssl?$n.SSLPort:$n.Port),x.useWS=!0,x.protocol=$n.wsProtocol,H=gf.Instance.getClient(x),Y.next=9,H.testConnection();case 9:C._wsClient=H;case 10:return Y.abrupt("return",C._wsClient);case 11:case"end":return Y.stop()}},y,this)}))).apply(this,arguments)}Dn(Ofe,"logLevel",-1);var Lfe,Z$e=function(y){function C(){var w,M,B,H;l(this,C);for(var T=arguments.length,A=new Array(T),D=0;D<T;D++)A[D]=arguments[D];return M=this,B=C,H=[].concat(A),B=qn(B),Dn(w=$a(M,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Y){return!1}}()?Reflect.construct(B,H||[],qn(M).constructor):B.apply(M,H)),"_bInited",!1),w}return qa(C,y),g(C,[{key:"getDynamsoftService",value:(x=yt(W.mark(function w(T,A,D,M){var B,H,Y,G,q,re,se,ce,ve,Te,Ue,je,Ee,Oe,He;return W.wrap(function(we){for(;;)switch(we.prev=we.next){case 0:return D=null!==(B=D)&&void 0!==B&&B,M=null!==(H=M)&&void 0!==H?H:30,Y={id:this.clientId,cmdId:U.guid(),method:"SearchScanner",parameter:[1,"_privet._tcp.local.",!1,!0,D,M,T,A],version:Fp},we.prev=5,we.next=8,this._requestAsync(Y,3e4,!1);case 8:G=we.sent,this._bInited=!0,we.next=19;break;case 12:if(we.prev=12,we.t0=we.catch(5),!this.bLocal){we.next=18;break}throw f0(q={}),{code:q._errorCode,message:q._errorString};case 18:throw{code:-2604,message:"Failed to connect to the Proxy Service. Please make sure the Proxy Service is configured successfully, Dynamsoft Service is running, or the certificate is valid."};case 19:re=[],se=this.parseResultDefault(G),ce=q$e(se),we.prev=22,ce.s();case 24:if((ve=ce.n()).done){we.next=40;break}if(!((Te=ve.value).service_type&&Te.service_type==Ja.ST_UNKNOWN||Te.type&&"dynamsoft_private_cloud_scan"!=Te.type&&"twaindirect"!=Te.type)){we.next=30;break}return we.abrupt("continue",38);case 30:if(!Te.service_type){we.next=38;break}we.t1=Te.service_type,we.next=we.t1===Ja.ST_DYNAMSOFT_SERVICE?34:38;break;case 34:return(Ue=Te.modules)&&U.isArray(Ue)&&U.isString(Ue[0])&&(je=Ue[0].split(",")).length>=3&&je[0]>=1&&je[1]>=8&&je[2]>0&&(Te.bGlobalFind=!0,Ee=Nfe(this.serverUrl,Te),re.push(Ee)),Te.bGlobalFind||(He=null!==(Oe=null==Te?void 0:Te.ty)&&void 0!==Oe?Oe:"",U.warn(["The Dynamsoft Service on [",He,"] is old version."].join(""))),we.abrupt("break",38);case 38:we.next=24;break;case 40:we.next=45;break;case 42:we.prev=42,we.t2=we.catch(22),ce.e(we.t2);case 45:return we.prev=45,ce.f(),we.finish(45);case 48:return we.abrupt("return",re);case 49:case"end":return we.stop()}},w,this,[[5,12],[22,42,45,48]])})),function(w,T,A,D){return x.apply(this,arguments)})},{key:"dispose",value:function(){var w={id:this.clientId,cmdId:U.guid(),method:"dispose",version:Fp};this._requestAsync(w,500)}}]);var x}(Ofe);function Nfe(y,C){var x=new EB;return x.server=y,x.attrs=C,x}function eqe(y,C,x,w){return UW.apply(this,arguments)}function UW(){return UW=yt(W.mark(function y(C,x,w,T){var A,D;return W.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(x!=Jr.GET_TASKID){M.next=4;break}return M.abrupt("return",T.taskId);case 4:if(x!=Jr.ONMESSAGE_PROCESS_DATA){M.next=8;break}return M.abrupt("return",U.parse(C));case 8:if(x!=Jr.ONMESSAGE_GET_TASKID){M.next=13;break}if(!T||!T.client){M.next=11;break}return M.abrupt("return",T.client.getRequestTaskId());case 11:M.next=20;break;case 13:if(x!=Jr.HANDLE_RAW_MESSAGE){M.next=20;break}if(A=null==T?void 0:T.userData){M.next=17;break}return M.abrupt("return",!1);case 17:return(D=C).indexOf("Version not found")>=0||D.indexOf("Function not found")>=0?U.isFunction(A.fFun)&&A.fFun():U.isFunction(A.sFun)&&A.sFun(D),M.abrupt("return",D);case 20:case"end":return M.stop()}},y)})),UW.apply(this,arguments)}function tqe(y,C){var x="undefined"!=typeof Symbol&&y[Symbol.iterator]||y["@@iterator"];if(!x){if(Array.isArray(y)||(x=function(B,H){if(B){if("string"==typeof B)return Bfe(B,H);var Y=Object.prototype.toString.call(B).slice(8,-1);if("Object"===Y&&B.constructor&&(Y=B.constructor.name),"Map"===Y||"Set"===Y)return Array.from(B);if("Arguments"===Y||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Y))return Bfe(B,H)}}(y))||C&&y&&"number"==typeof y.length){x&&(y=x);var w=0,T=function(){};return{s:T,n:function(){return w>=y.length?{done:!0}:{done:!1,value:y[w++]}},e:function(B){throw B},f:T}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var A,D=!0,M=!1;return{s:function(){x=x.call(y)},n:function(){var B=x.next();return D=B.done,B},e:function(B){M=!0,A=B},f:function(){try{D||null==x.return||x.return()}finally{if(M)throw A}}}}function Bfe(y,C){(null==C||C>y.length)&&(C=y.length);for(var x=0,w=new Array(C);x<C;x++)w[x]=y[x];return w}function Wfe(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function VW(y,C,x){return C.has(y),x}function Ufe(y){var C,x=Ja.ST_UNKNOWN;return y==Zt.ESCLSCANNER?x=Ja.ST_ESCL:y==Zt.WIFIDIRECTSCANNER?x=Ja.ST_WIFI_DIRECT:((C=y)==Zt.TWAINSCANNER||C==Zt.WIATWAINSCANNER||C==Zt.TWAINX64SCANNER||C==Zt.ICASCANNER||C==Zt.SANESCANNER)&&(x=Ja.ST_DYNAMSOFT_SERVICE),x}!function(y){y.SAM_ANONYMOUS=0,y.SAM_PWD=1}(Lfe||(Lfe={}));var jW=new WeakSet,Vfe=new WeakSet,OP=function(y){function C(){var Y,se,ce,ve;l(this,C);for(var G=arguments.length,q=new Array(G),re=0;re<G;re++)q[re]=arguments[re];return se=this,ce=C,ve=[].concat(q),ce=qn(ce),Wfe(Y=$a(se,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Te){return!1}}()?Reflect.construct(ce,ve||[],qn(se).constructor):ce.apply(se,ve)),Vfe),Wfe(Y,jW),Dn(Y,"_bInited",!1),Dn(Y,"_currentDevice",void 0),Y}return qa(C,y),g(C,[{key:"getSources",value:(H=yt(W.mark(function Y(G,q,re){var se,ce,ve,Te,Ue,je,Ee,Oe,He,we,ue,pe,ye,me;return W.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(ve="",Te=!1,Ue=[],je=!1,((Ee=null!=G?G:xB)&Zt.ESCLSCANNER)==Zt.ESCLSCANNER&&(ve="_uscan._tcp.local."),(Ee&Zt.WIFIDIRECTSCANNER)==Zt.WIFIDIRECTSCANNER&&(Te=!0),0!=ve.length||Te){Se.next=9;break}return Se.abrupt("return",[]);case 9:return q=null!==(se=q)&&void 0!==se&&se,re=null!==(ce=re)&&void 0!==ce?ce:30,Oe={id:this.clientId,cmdId:U.guid(),method:"SearchScanner",parameter:[1,ve,Te,je,q,re],version:Fp},Se.next=14,this._requestAsync(Oe,3e4,!1);case 14:if(He=Se.sent,this._bInited=!0,we=this.parseResultDefault(He),U.isArray(we)){Se.next=19;break}throw{code:-2612,message:"The devices must be an Array."};case 19:ue=tqe(we),Se.prev=20,ue.s();case 22:if((pe=ue.n()).done){Se.next=48;break}if(!((ye=pe.value).service_type&&ye.service_type==Ja.ST_UNKNOWN||ye.type&&"dynamsoft_private_cloud_scan"!=ye.type&&"twaindirect"!=ye.type)){Se.next=28;break}return Se.abrupt("continue",46);case 28:if(!ye.service_type){Se.next=46;break}Se.t0=ye.service_type,Se.next=Se.t0===Ja.ST_DYNAMSOFT_SERVICE?32:Se.t0===Ja.ST_ESCL||Se.t0===Ja.ST_WIFI_DIRECT?33:46;break;case 32:return Se.abrupt("break",46);case 33:return(me=new od).name="",me.displayName="",me.deviceType=0,me.isSystemDefaultPrinter=!1,ye.service_type==Ja.ST_ESCL?me.deviceType=Zt.ESCLSCANNER:ye.service_type==Ja.ST_WIFI_DIRECT&&(me.deviceType=Zt.WIFIDIRECTSCANNER),me.name=ye.ty,ye.hostname&&ye.hostname.length>ye.ty.length&&(me.name=ye.hostname),me.displayName=(ye.service_type==Ja.ST_ESCL?"eSCL-":"")+me.name,this.bGlobal||(ye.url=this.serverUrl,this.serverName&&(me.displayName=me.displayName+" on ["+this.serverName+"]")),me.serviceInfo=Nfe(this.serverUrl,ye),Ue.push(me),Se.abrupt("break",46);case 46:Se.next=22;break;case 48:Se.next=53;break;case 50:Se.prev=50,Se.t1=Se.catch(20),ue.e(Se.t1);case 53:return Se.prev=53,ue.f(),Se.finish(53);case 56:return Se.abrupt("return",Ue);case 57:case"end":return Se.stop()}},Y,this,[[20,50,53,56]])})),function(Y,G,q){return H.apply(this,arguments)})},{key:"getCapabilitiesAsync",value:(B=yt(W.mark(function Y(G){var q,re;return W.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return this.checkSource(G),(G.deviceType&Zt.ESCLSCANNER)!=Zt.ESCLSCANNER&&(G.deviceType&Zt.WIFIDIRECTSCANNER)!=Zt.WIFIDIRECTSCANNER||(this._currentDevice=G),q=Ufe(G.deviceType),re={id:this.clientId,cmdId:U.guid(),method:"SendRequestToScanner",parameter:["getCapabilities",U.stringify({UUID:G.serviceInfo.attrs.UUID,service_type:q,ty:G.name})],version:Fp},ce.next=6,this._requestAsync(re,0);case 6:return ce.abrupt("return",this.parseResultDefault(ce.sent));case 8:case"end":return ce.stop()}},Y,this)})),function(Y){return B.apply(this,arguments)})},{key:"selectSourceAsync",value:(M=yt(W.mark(function Y(G){var q;return W.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return re.next=2,this.getCapabilitiesAsync(G);case 2:if(!(q=re.sent)&&""!=q){re.next=5;break}return re.abrupt("return",!0);case 5:case"end":return re.stop()}},Y,this)})),function(Y){return M.apply(this,arguments)})},{key:"versionInfo",value:(D=yt(W.mark(function Y(){var G,q;return W.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return G={id:this.clientId,cmdId:U.guid(),method:"VersionInfo",version:Fp},re.next=3,this._requestAsync(G,5e3);case 3:return q=re.sent,this._bInited=!0,re.abrupt("return",q);case 6:case"end":return re.stop()}},Y,this)})),function(){return D.apply(this,arguments)})},{key:"getLicenseInfo",value:function(Y,G,q){return this._resetLicense(Y,G,q)}},{key:"getImageAsArrayBuffer",value:(A=yt(W.mark(function Y(G,q){return W.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return re.abrupt("return",VW(this,jW,jfe).call(this,G,q));case 1:case"end":return re.stop()}},Y,this)})),function(Y,G){return A.apply(this,arguments)})},{key:"getImageToDWT",value:(T=yt(W.mark(function Y(G,q,re){return W.wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return se.abrupt("return",VW(this,jW,jfe).call(this,G,q,re));case 1:case"end":return se.stop()}},Y,this)})),function(Y,G,q){return T.apply(this,arguments)})},{key:"acquireImage",value:(w=yt(W.mark(function Y(G,q,re){var se,ce,ve,Te,Ue,je,Ee;return W.wrap(function(He){for(;;)switch(He.prev=He.next){case 0:G=null!==(se=G)&&void 0!==se?se:this._currentDevice,this.checkSource(G),this._currentDevice=G,ce=Ufe(G.deviceType),ve=["scan",U.stringify({UUID:G.serviceInfo.attrs.UUID,service_type:ce})],Te=VW(this,Vfe,nqe).call(this,q),ve[2]=U.stringify(Te),Ue={id:this.clientId,cmdId:U.guid(),method:"SendRequestToScanner",parameter:ve,version:Fp},je=0;case 10:if(!(je<5)){He.next=33;break}return He.prev=11,He.next=14,this._requestAsync(Ue,0);case 14:return Ee=this.parseResultDefault(He.sent),U.isObject(Ee)&&(Ee.device=G,Ee.scanOptions=Te),He.abrupt("break",33);case 20:if(He.prev=20,He.t0=He.catch(11),-1004!=He.t0.code&&-1001!=He.t0.code){He.next=29;break}if(!(je>=4)){He.next=25;break}throw He.t0;case 25:return He.next=27,new ge.Promise(function(we,ue){setTimeout(we,2e3)});case 27:He.next=30;break;case 29:throw He.t0;case 30:je++,He.next=10;break;case 33:return He.abrupt("return",Ee);case 34:case"end":return He.stop()}},Y,this,[[11,20]])})),function(Y,G,q){return w.apply(this,arguments)})},{key:"_resetLicense",value:(x=yt(W.mark(function Y(G,q,re){var se,ce,ve,Te;return W.wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return this.longKeyOrShortkey=G,this.cu=q,U.isNumber(OP.logLevel)||(OP.logLevel=-1),se=null!=q?q:"",ce={id:this.clientId,cmdId:U.guid(),method:"GetLicenseInfo",parameter:[G,C.logLevel,se,re],version:Fp},Ue.prev=5,Ue.next=8,this._requestAsync(ce,1e4);case 8:return ve=Ue.sent,this._bInited=!0,Ue.abrupt("return",this.parseResultDefault(ve));case 13:if(Ue.prev=13,Ue.t0=Ue.catch(5),!this.bLocal){Ue.next=19;break}throw f0(Te={}),{code:Te._errorCode,message:Te._errorString};case 19:throw{code:-2604,message:"Failed to connect to the Proxy Service. Please make sure the Proxy Service is configured successfully, Dynamsoft Service is running, or the certificate is valid."};case 20:case"end":return Ue.stop()}},Y,this,[[5,13]])})),function(Y,G,q){return x.apply(this,arguments)})}]);var x,w,T,A,D,M,B,H}(Z$e);function jfe(y,C,x){return Hfe.apply(this,arguments)}function Hfe(){return(Hfe=yt(W.mark(function y(C,x,w){var T,A,D,M,H;return W.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(null!=C&&C.device){Y.next=2;break}throw{code:-1011,message:"Operation out of expected sequence"};case 2:return w=null!==(T=w)&&void 0!==T?T:{ver:"",clientId:""},(A=["getImage",U.stringify({UUID:C.device.serviceInfo.attrs.UUID,service_type:x})])[2]=U.stringify(C.scanOptions),A[3]=C.scanJobs,A[4]=C.scanId,A[5]=w._clientId,A[6]=w._ver,D={id:this.clientId,cmdId:U.guid(),method:"SendRequestToScanner",parameter:A,version:Fp},Y.next=12,this._requestAsync(D,0,!0);case 12:if(!((M=Y.sent).headers.get("content-type").indexOf("image/")>=0)){Y.next=20;break}return Y.next=17,M.arrayBuffer();case 17:return Y.abrupt("return",Y.sent);case 20:return Y.next=22,M.json();case 22:if("boolean"!=typeof(H=this.parseResultDefault(Y.sent))){Y.next=28;break}return Y.abrupt("return",null);case 28:return Y.abrupt("return",H);case 29:case"end":return Y.stop()}},y,this)}))).apply(this,arguments)}function nqe(y){var C=[];if(y){U.isNumber(y.PixelType)&&(C.push({capability:pd.ICAP_PIXELTYPE,curValue:y.PixelType}),Ce.DWT.EnumDWT_PixelType.TWPT_BW==y.PixelType&&(C.push({capability:32771,curValue:"application/octet-stream"}),C.push({capability:32772,curValue:"application/octet-stream"})));var x=y.Resolution;x||(x=300),C.push({capability:pd.ICAP_XRESOLUTION,curValue:x}),C.push({capability:pd.ICAP_YRESOLUTION,curValue:x}),void 0!==y.Brightness&&C.push({capability:pd.ICAP_BRIGHTNESS,curValue:y.Brightness}),void 0!==y.XferCount&&C.push({capability:pd.CAP_XFERCOUNT,curValue:y.XferCount}),void 0!==y.Contrast&&C.push({capability:pd.ICAP_CONTRAST,curValue:y.Contrast}),void 0!==y.TransferMode&&C.push({capability:pd.ICAP_XFERMECH,curValue:y.TransferMode}),void 0!==y.IfFeederEnabled&&C.push({capability:pd.CAP_FEEDERENABLED,curValue:y.IfFeederEnabled?1:0}),void 0!==y.IfDuplexEnabled&&C.push({capability:pd.CAP_DUPLEXENABLED,curValue:y.IfDuplexEnabled?1:0})}return C}var Gfe=function(y,C,x){2==x&&U.each(C,function(w,T){Ui(y,w,{get:function(){return y._resetErr(),y._isValid()?Lt:vt},set:function(A){return y._resetErr(),y._isValid()?Lt:vt}})})},zfe=function(y,C){U.each(C,function(x,w){k0(y,x,1,2)})},Yfe=function(y,C){U.each(C,function(x,w){k0(y,x,1,1)})},Xfe=function(y,C){U.each(C,function(x,w){k0(y,x,0)})},$fe=function(y,C){U.each(C,function(x,w){k0(y,x,1)})};ge.DynamicLoadAddonFuns=[],ge.attachAddon=function(y){var C=!1;return U.each(ge.DynamicLoadAddonFuns,function(x){U.isFunction(x)&&(x(y),C=!0)}),!xo.bFullEdition&&y.__addon&&delete y.__addon.Camera,C};var qfe=g(function y(C,x,w){l(this,y),this.Url=C,this.Width=x,this.Height=w}),oqe=function(){return g(function C(x){l(this,C),this._stwain=x,this._ImgManager=x._ImgManager},[{key:"Print",value:function(){var C=this;if(C.count()<=0)return!1;var x,w=[];for(x=0;x<C.count();x++)w.push(x);return C.PrintEx(w)}},{key:"PrintCurrentImage",value:function(){var C,x,w,T=this;if(!((C=T._ImgManager.getCurrentImageIndex())<0))return-1==(w=T._ImgManager.convertClientIndexToServerId(C))?(kt(T),!1):(x=lr.getImageUrl(T._ImgManager.getBaseUrl,w,-1,-1),T.__PrintInner(x,w,C))}},{key:"PrintEx",value:function(C){var x=this;if(!(x.count()<=0)){var w=[];return Ce.DWT.ConnectWithSocket?x.__GetPrintUrlforSocket(C,w):x.__GetPrintUrlforHttp(C,w),!0}}},{key:"__PrintInner",value:function(C,x,w){var T=this,A=T._ImgManager.getImageIdMap(x),D=[];if(!A)return!1;var M=U.clone(A),B=M.width;(U.isUndefined(M.width)||M.width<=0)&&(M.width=T.getImageWidthFromServer(w));var H=M.height;(U.isUndefined(M.height)||M.height<=0)&&(M.height=T.getImageHeightFromServer(w));var Y=new qfe(C,M.width,M.height);return D.push(Y),M.width=B,M.height=H,lr.print(D),!0}},{key:"__GetPrintUrl",value:function(C,x,w){var T,A,D=this,M=0,B=0;return(T=D._ImgManager.getImageIdMap(x))&&(!T.width||T.width<=0?T.width=D.getImageWidthFromServer(w):M=T.width,!T.height||T.height<=0?T.height=D.getImageHeightFromServer(w):B=T.height,A=new qfe(C,T.width,T.height),T.width=M,T.height=B),A}},{key:"__GetPrintUrlforHttp",value:(y=yt(W.mark(function C(x,w){var T,A,D,M,B,H,Y,q,re;return W.wrap(function(se){for(;;)switch(se.prev=se.next){case 0:T=this,A=0;case 2:if(!(A<x.length)){se.next=23;break}if(-1==(M=T._ImgManager.convertClientIndexToServerId(D=x[A]))){se.next=20;break}if(B=void 0,!(Ce.navInfoSync.bMac&&Ce.navInfoSync.bSafari||Ce.navInfoSync.bFirefox)){se.next=17;break}if(!(H=T._stwain._ImgManager.getImageIdMap(M))){se.next=17;break}if(!(Y=H.uuid)||-1==Y){se.next=17;break}return se.next=14,T._stwain.Viewer.webViewer.myDvs.getImageData(Y,{type:"blob"});case 14:q=window.URL||window.webkitURL,B=q.createObjectURL(se.sent);case 17:B||(B=lr.getImageUrl(T._ImgManager.getBaseUrl,M,-1,-1)),re=T.__GetPrintUrl(B,M,D),w.push(re);case 20:A++,se.next=2;break;case 23:lr.print(w);case 24:case"end":return se.stop()}},C,this)})),function(C,x){return y.apply(this,arguments)})},{key:"__GetPrintUrlforSocket",value:function(C,x){var w,T=this,A=ft.Promise.resolve(0),D=0;return U.each(C,function(M){A=A.then(function(){var B=T._ImgManager.convertClientIndexToServerId(M);-1!=B&&T._ImgManager.getImageData(M).then(function(H){if(D++,!H){var Y={};return Jn(Y),void Fr(Y._errorString)}w=Bp(H.oriData)?URL.createObjectURL(new Blob([H.oriData])):H.oriData instanceof Blob?URL.createObjectURL(H.oriData):H.oriData;var G=T.__GetPrintUrl(w,B,M);x.push(G),C.length==D&&lr.print(x)})})}),!0}},{key:"__GetPrintUrlforMobileEx",value:function(C,x){var w,T=this,A=ft.Promise.resolve(0),D=0;return U.each(C,function(M){A=A.then(function(){var B=T._ImgManager.convertClientIndexToServerId(M);-1!=B&&T._ImgManager.getImageData(M).then(function(H){if(D++,!H){var Y={};return Jn(Y),void Fr(Y._errorString)}w=Bp(H.oriData)?URL.createObjectURL(new Blob([H.oriData])):H.oriData instanceof Blob?URL.createObjectURL(H.oriData):H.oriData;var G=T.__GetPrintUrl(w,B,M);x.push(G),C.length==D&&lr.print(x)})})}),!0}},{key:"count",value:function(){return this._ImgManager.count()}},{key:"getImageHeightFromServer",value:function(C){var x,w,T,A=this,D=1*C;return x=A.count(),D<0||D>x?0:(T=A._ImgManager.convertClientIndexToServerId(D),(w=A._ImgManager.getImageIdMap(T))&&w.imageHeight?w.imageHeight:A._stwain.GetImageHeight(D))}},{key:"getImageWidthFromServer",value:function(C){var x,w,T,A=this,D=1*C;return x=A.count(),D<0||D>x?0:(T=A._ImgManager.convertClientIndexToServerId(D),(w=A._ImgManager.getImageIdMap(T))&&w.imageWidth?w.imageWidth:A._stwain.GetImageWidth(D))}}]);var y}();function M0(y,C){(function(x,w){if(w.has(x))throw new TypeError("Cannot initialize the same private elements twice on an object")})(y,C),C.add(y)}function Os(y,C,x){return C.has(y),x}ge.detect.viewerScriptLoaded=Lt;var HW=new WeakSet,GW=new WeakSet,Kfe=new WeakSet,Jfe=new WeakSet,sqe=new WeakSet,gu=new WeakSet,FP=new WeakSet,Qfe=function(y){function C(T){var A,D,M,B,H,Y;return l(this,C),D=this,B=[T],M=qn(M=C),M0(A=$a(D,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Y){return!1}}()?Reflect.construct(M,B||[],qn(D).constructor):M.apply(D,B)),FP),M0(A,gu),M0(A,sqe),M0(A,Jfe),M0(A,Kfe),M0(A,GW),M0(A,HW),A._ImgManager=new sfe(A,A._imageBufferWrapper),A._imageBufferWrapper=A._ImgManager,A._ImagePrint=new oqe(A),A._config=H=T||{},A._destroying=vt,A._iServiceType=IP.TwainService,A.__addon={},A._bNoMask=vt,A._bNotShowMessage=vt,A._bSelectedSourceByServer=vt,A._bKeepAwake=vt,A._bAx=vt,H.container&&(A._containerElement=H.container),A.__IfShowCancelDialogWhenImageTransfer=Lt,A._errorCode=0,A._errorString="",A.__bLoadingImage=vt,A.__bAcquireImageNow=vt,A.__bOpenFileNow=vt,A.__defaultSourceName="",A.__sourceCount=0,A._bConnecting=vt,A.__licenseInfo=void 0,A.__strProductName=Ce.DWT.ProductName,A.__productKey="",A._moduleSize=1048576,A._driverType=Mi.TWAIN,A.__maxUploadImageSize=-1,A._bServerPercentDone=Lt,A._bSSL=de.bSSL,A._bRegistedLoad=!1,A._logLevel=0,A._scaleDownThreshold=0,A._pdfWriteSetting={},A.__serverPlatform=Rn.enumUnknown,A._reconnectTimeSpan=xo.LocaleReconnectTimeSpan,A._bRemoteMode||(A.httpFormFields={},A.HTTPPassword="",A.HTTPPort=ge.detect.ssl?443:80,A.HTTPUserName="",A.__HTTPPostResponseString="",A.__remoteFilename="RemoteFile",A.__httpHeaderMap=vt,A._segementUploadThreshold=A._b64bit?4294967296:524288e3,A._aryTiffTag=[],A._tiffCompressionType=Ce.DWT.EnumDWT_TIFFCompressionType.TIFF_AUTO,A._jpgQuality=80,A._pdfConvertMode=3,A._pdfOptions={convertMode:gr.CM_AUTO,password:"",renderOptions:{renderAnnotations:!1,resolution:200,maxWidth:0,maxHeight:0,renderGrayscale:!1}}),function rqe(y){var C=y;C._bRemoteMode||(Ui(C,"ProductKey",{get:function(){return Ce.DWT.ProductKey},set:function(x){return U.isString(x)?(C._resetErr(),!!C._isValid()&&C._setProductKey(x,!1)):(da(C),vt)}}),Ui(C,"ProductName",{get:function(){return C.__strProductName}}),Ui(C,"VersionInfo",{get:function(){return su.JSVersion}}),Ui(C,"DefaultSourceName",{get:function(){var x=C._getDefaultDevice();return x?x.displayName:""}}),Ui(C,"ImageCaptureDriverType",{get:function(){return C._resetErr(),C._isValid()?C._driverType:0},set:function(x){var w=!1,T=!1,A=!1;if(C._bRemoteMode?C.__serverPlatform==Rn.enumWindow?A=!0:C.__serverPlatform==Rn.enumLinux?T=!0:C.__serverPlatform==Rn.enumMac&&(w=!0):(w=de.bMac,T=de.bLinux,A=de.bWin),C._resetErr(),!C._isValid())return!1;if(""!==x){var D=1*x,M=!1;if(D<Mi.TWAIN||D>Mi.TWAIN64)return DA(C),vt;if(A){if(D===Mi.TWAIN_AND_TWAIN64)C._b64bit&&(C._driverType=D);else if(D!=Mi.TWAIN&&D!=Mi.TWAIN64)return DA(C),vt;C._b64bit||(D=Mi.TWAIN),C._driverType=D,M=!0}else if(T)C._driverType=D=Mi.SANE,M=!0;else if(w){if(D!==Mi.TWAIN_AND_ICA&&D!=Mi.ICA&&D!=Mi.TWAIN&&D!=Mi.TWAIN64)return DA(C),vt;C._driverType=D,M=!0}return M&&(C._curDevice=null,C.__devices=null),!0}return DA(C),vt}}),Ui(C,"HTTPPostResponseString",{get:function(){return C._resetErr(),C._isValid()&&C.__HTTPPostResponseString?C.__HTTPPostResponseString:""}}),Ui(C,"IfAppendImage",{get:function(){return C._resetErr(),!!C._isValid()&&C.__IfAppendImage},set:function(x){return C._resetErr(),!!C._isValid()&&(U.isBoolean(x)?C.__IfAppendImage=x:(da(C),vt))}}),Ui(C,"FTPPort",{get:function(){return C._resetErr(),C._isValid()?C._innerFun("FTPPort"):0},set:function(x){return C._resetErr(),!!C._isValid()&&(""!==x?C._innerFun("FTPPort",It(1*x)):void 0)}}),Ui(C,"JPEGQuality",{get:function(){return C._resetErr(),C._isValid()?C._innerFun("JPEGQuality"):0},set:function(x){var w=1*x;return w>=100?w=100:w<0&&(w=0),C._resetErr(),!!C._isValid()&&C._innerFun("JPEGQuality",It(w))}}),k0(C,"TIFFCompressionType",1,1),k0(C,"BufferMemoryLimit",1,1),Ui(C,"LogLevel",{get:function(){return C._resetErr(),C._isValid()?C._innerFun("LogLevel"):0},set:function(x){if(C._resetErr(),!C._isValid())return!1;var w=1*x;return C._logLevel=w,OP.logLevel=C._logLevel,C._innerFun("LogLevel",It(w))}}),Ui(C,"HttpContentTypeFieldValue",{get:function(){return C._resetErr(),C._isValid()?C._strHttpContentTypeFieldValue:""},set:function(x){return C._resetErr(),!!C._isValid()&&(C._strHttpContentTypeFieldValue=x,x)}}),Ui(C,"BrokerProcessType",{get:function(){return C._resetErr(),C._isValid()?1:0},set:function(x){return C._resetErr(),!!C._isValid()}}),Ui(C,"BorderStyle",{get:function(){return C._resetErr(),!!C._isValid()&&0},set:function(x){return C._resetErr(),C._isValid(),!1}}),Ui(C,"HttpFieldNameOfUploadedImage",{get:function(){return C._resetErr(),C._isValid()?C.__remoteFilename:""},set:function(x){return C._resetErr(),C._isValid()?C.__remoteFilename=x:""}}),Ui(C,"style",{get:function(){return C._isValid()?C.__style:""}}),Ui(C,"ScaleDownThreshold",{get:function(){return C._resetErr(),C._isValid()?C._scaleDownThreshold:0},set:function(x){var w=1*x;return!U.isNumber(w)||isNaN(w)?(da(self),vt):(C._resetErr(),!!C._isValid()&&(C._scaleDownThreshold=x))}}),Ui(C,"CurrentImageIndexInBuffer",{get:function(){return C._isValid()&&C._ImgManager?C._ImgManager.getCurrentImageIndex():0},set:function(x){var w=1*x;return C._resetErr(),!!C._isValid()&&(w>=0&&w<C._ImgManager.count()&&(C._ImgManager.setSelectedClientIndexArray([w]),C._isBindViewer()&&ch.__innerRefreshFromUIView(C,C._ImgManager.getCurrentImageIndex())),!0)}}),Ui(C,"SelectedImagesIndices",{get:function(){return C._resetErr(),C._isValid()?C._ImgManager.count()<=0?[]:C._ImgManager.getSelectedClientIndexArray():[]}}),Ui(C,"MaxImagesInBuffer",{get:function(){return C._resetErr(),C._isValid()?C.__maxImagesInBuffer:0},set:function(x){var w=1*x;return C._resetErr(),!!C._isValid()&&(w>0&&w<32768?C.__maxImagesInBuffer=w:wt(C,-1010,"Data parameter out of supported range."),C.__maxImagesInBuffer)}}),Ui(C,"IfSSL",{get:function(){return C._bSSL},set:function(x){return C._bSSL=x,C._innerFun("IfSSL",It(x)),!0}}),k0(C,"IfAllowLocalCache",1,2),Ui(C,"UseLocalService",{get:function(){return!0}}),Ui(C,"PDFCompressionType",{get:function(){return C._resetErr(),!!C._isValid()&&C._innerFun("PDFCompressionType")},set:function(x){var w=1*x;return w==Ce.DWT.EnumDWT_PDFCompressionType.PDF_FAX3&&(w=Ce.DWT.EnumDWT_PDFCompressionType.PDF_FAX4),C._resetErr(),!!C._isValid()&&C._innerFun("PDFCompressionType",It(w))}}),C._setProductKey=function(x,w,T,A){var D=!0,M=x,B=function(Y){Y||(C.__licenseInfo=void 0);var G=!0;return A||(G=pn.checkProductKey(C,{Core:!0})),U.isFunction(T)&&T(),G};if(C._resetErr(),!C._isValid())return!1;if(M=U.isString(M)?U.trim(M):"",Ce.DWT.ProductKey=M,""==M)D=!1,B();else{pn.reparseProductKey();var H=Ce.DWT.licenseException;if(0!=H.code)return C.__licenseInfo=void 0,C._errorCode=H.code,C._errorString=H.message,U.isFunction(T)&&T(),!1;C._innerFunRaw("ProductKey",It(M),w,!1,!1,function(Y){var G;G=U.isArray(Y)?Y[0]:Y,U.isArray(Y)&&Y.length>=3&&"1"===Y[1]&&U.isFunction(Ce.DWT.ShowMessage)&&Ce.DWT.ShowMessage(Y[2],{width:510,height:272,headerStyle:1,seconds:10}),w||(D=G),C.__licenseInfo=void 0,C.GetLicenseInfo(function(){C._setConvertMode(C._pdfConvertMode),B(!0)},B)},function(){w||(D=!1),B()})}return D},$fe(C,["ProxyServer"]),$fe(C,["CapValueString","CapDescription","FTPPassword","FTPUserName","PDFAuthor","PDFCreationDate","PDFCreator","PDFKeywords","PDFModifiedDate","PDFProducer","PDFSubject","PDFTitle","PDFVersion"]),Xfe(C,["Manufacturer","ProductFamily","ImageBitsPerPixel","ImageLength","ImageWidth","ImageXResolution","ImageYResolution"]),Xfe(C,["BlankImageCurrentStdDev","CapDefaultIndex","CapDefaultValue","DataSourceStatus","Duplex","PendingXfers","ImageLayoutDocumentNumber","ImageLayoutFrameBottom","ImageLayoutFrameLeft","ImageLayoutFrameNumber","ImageLayoutFrameRight","ImageLayoutFrameTop","ImageLayoutPageNumber","ImagePixelType","MagData","MagType","IfFeederLoaded","IfPaperDetectable","IfUIControllable"]),zfe(C,["AllowPluginAuthentication","IfModalUI","IfScanInNewThread","_AutoCropMethod","IfSortBySelectionOrder"]),zfe(C,["IfDisableSourceAfterAcquire","IfDuplexEnabled","IfFeederEnabled","IfPASVMode","IfAutoBright","IfAutoDiscardBlankpages","IfAutoFeed","IfAutomaticBorderDetection","IfAutomaticDeskew","IfAutoScan","IfShowIndicator","IfUseTwainDSM","IfTiffMultiPage"]),Yfe(C,["MaxInternetTransferThreads"]),Yfe(C,["BlankImageMaxStdDev","BlankImageThreshold","BitDepth","Brightness","PageSize","PixelType","Resolution","Capability","CapCurrentIndex","CapCurrentValue","CapMaxValue","CapMinValue","CapNumItems","CapStepSize","CapType","CapValue","CapValueType","Contrast","PixelFlavor","TransferMode","Unit","XferCount"]),Gfe(C,["AsyncMode","EnableInteractiveZoom","IfThrowException","ImageEditorIfEnableEnumerator","ImageEditorIfReadonly","ImageEditorIfModal","ImageEditorWindowTitle","IfShowPrintUI","VScrollBar"],2),Gfe(C,["IfOpenImageWithGDIPlus"]))}(A),Ui(Y=A,"Width",{get:function(){return Y._resetErr(),Y._isValid()?Y._isNoViewer()?(Y._nouiNotSupport("Width"),""):Y._UIView.GetWidth():""},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("Width"):Y._UIView.SetWidth(G))}}),Ui(Y,"Height",{get:function(){return Y._resetErr(),Y._isValid()?Y._isNoViewer()?(Y._nouiNotSupport("Height"),""):Y._UIView.GetHeight():""},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("Height"):Y._UIView.SetHeight(G))}}),Ui(Y,"AllowMultiSelect",{get:function(){return Y._resetErr(),Y._isValid()?Y._isNoViewer()?Y._nouiNotSupport("AllowMultiSelect"):Y._UIView.GetAllowMultiSelect():""},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("AllowMultiSelect"):void Y._UIView.SetAllowMultiSelect(G))}}),Ui(Y,"BackgroundColor",{get:function(){return Y._resetErr(),Y._isValid()?Y._isNoViewer()?(Y._nouiNotSupport("BackgroundColor"),""):Y._UIView.GetBackgroundColor():""},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("BackgroundColor"):Y._UIView.SetBackgroundColor(G))}}),Ui(Y,"BackgroundFillColor",{get:function(){if(Y._resetErr(),!Y._isValid())return"";if(Y._isNoViewer())return Y._nouiNotSupport("BackgroundFillColor"),"";var G=Y._innerFun("BackgroundFillColor");return ed.BGR2RGB(G)},set:function(G){if(Y._resetErr(),!Y._isValid())return!1;if(Y._isNoViewer())return Y._nouiNotSupport("BackgroundFillColor");var q,re=1*G;return!U.isNumber(re)||U.isNaN(re)?(da(Y),vt):(q=ed.RGB2BGR(re),Y._innerFun("BackgroundFillColor",It(q)))}}),Ui(Y,"FitWindowType",{get:function(){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?(Y._nouiNotSupport("FitWindowType"),0):Y._UIView.GetFitWindowType())},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("FitWindowType"):Y._UIView.SetFitWindowType(1*G))}}),Ui(Y,"IfFitWindow",{get:function(){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("IfFitWindow"):Y._UIView.GetIfFitWindow())},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("IfFitWindow"):Y._UIView.SetIfFitWindow(!!G))}}),Ui(Y,"ImageMargin",{get:function(){return Y._resetErr(),Y._isValid()?Y._isNoViewer()?(Y._nouiNotSupport("ImageMargin"),0):Y._UIView.GetImageMargin():0},set:function(G){if(Y._resetErr(),!Y._isValid())return!1;if(Y._isNoViewer())return Y._nouiNotSupport("ImageMargin");var q=parseInt(G);return!isNaN(q)&&Y._UIView.SetImageMargin(q)}}),Ui(Y,"MouseX",{get:function(){return Y._resetErr(),Y._isValid()?Y._isNoViewer()?(Y._nouiNotSupport("MouseX"),0):Y.__MouseX:0}}),Ui(Y,"MouseY",{get:function(){return Y._resetErr(),Y._isValid()?Y._isNoViewer()?(Y._nouiNotSupport("MouseY"),0):Y.__MouseY:0}}),Ui(Y,"SelectionImageBorderColor",{get:function(){return Y._resetErr(),Y._isValid()?Y._isNoViewer()?(Y._nouiNotSupport("SelectionImageBorderColor"),""):Y._UIView.GetSelectionImageBorderColor():""},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("SelectionImageBorderColor"):Y._UIView.SetSelectionImageBorderColor(G))}}),Ui(Y,"Zoom",{get:function(){return Y._resetErr(),Y._isValid()?Y._isNoViewer()?(Y._nouiNotSupport("Zoom"),0):Y._UIView.GetZoom():0},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("Zoom"):Y._UIView.SetZoom(G))}}),Ui(Y,"MouseShape",{get:function(){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("MouseShape"):Y._UIView.GetMouseShape())},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("MouseShape"):Y._UIView.SetMouseShape(G))}}),Ui(Y,"SelectionRectAspectRatio",{get:function(){return Y._resetErr(),Y._isValid()?Y._isNoViewer()?(Y._nouiNotSupport("SelectionRectAspectRatio"),0):Y._UIView.GetSelectionRectAspectRatio():0},set:function(G){if(Y._resetErr(),!Y._isValid())return!1;if(Y._isNoViewer())return Y._nouiNotSupport("SelectionRectAspectRatio");var q=parseFloat(G);return q>=0&&(Y._UIView.SetSelectionRectAspectRatio(q),!0)}}),Ui(Y,"ShowPageNumber",{get:function(){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("ShowPageNumber"):Y._UIView.GetShowPageNumber())},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("ShowPageNumber"):Y._UIView.SetShowPageNumber(G))}}),Ui(Y,"IfAutoScroll",{get:function(){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("IfAutoScroll"):Y._UIView.GetIfAutoScroll())},set:function(G){return Y._resetErr(),!!Y._isValid()&&(Y._isNoViewer()?Y._nouiNotSupport("IfAutoScroll"):Y._UIView.SetIfAutoScroll(G))}}),A._innerInitEvents(H),A}return qa(C,y),g(C,[{key:"GetImageDataAsync",value:function(T){return this._ImgManager.getImageData(T)}},{key:"SetCustomDataAsync",value:function(T,A){return this._ImgManager.setCustomData(T,A)}},{key:"style",get:function(){return this.__style}},{key:"GetSourceNamesAsync",value:(w=yt(W.mark(function T(A){var D;return W.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if((D=this)._resetErr(),D._isValid()){M.next=4;break}throw{code:D._errorCode,message:D._errorString};case 4:return Bo("GetSourceNamesAsync",D),M.prev=5,M.next=8,D._getSourceCountAsync(D._driverType);case 8:M.next=13;break;case 10:throw M.prev=10,M.t0=M.catch(5),M.t0;case 13:return M.prev=13,Gr("GetSourceNamesAsync"),M.finish(13);case 16:if(!A){M.next=20;break}return M.abrupt("return",Os(D,HW,Zfe).call(D));case 20:return M.abrupt("return",Os(D,GW,epe).call(D));case 21:case"end":return M.stop()}},T,this,[[5,10,13,16]])})),function(T){return w.apply(this,arguments)})},{key:"SelectSourceAsync",value:function(T){return this._selectSourceAsync("SelectSourceAsync",T,Ms.dialogText.selectSource)}},{key:"SelectSourceByIndexAsync",value:function(T){return this._selectSourceByIndexAsync("SelectSourceByIndex",T)}},{key:"OpenSourceAsync",value:function(){return this._openSourceAsync("OpenSourceAsync")}},{key:"CloseSourceAsync",value:function(){return this._closeSourceAsync("CloseSourceAsync")}},{key:"OpenSourceManagerAsync",value:function(){var T=this;return T._resetErr(),T._isValid()?T._innerFunV2("OpenSourceManager"):ge.Promise.reject({code:T._errorCode,message:T._errorString})}},{key:"CloseSourceManagerAsync",value:function(){var T=this;return T._resetErr(),T._isValid()?T._innerFunV2("CloseSourceManager"):ge.Promise.reject({code:T._errorCode,message:T._errorString})}},{key:"AcquireImage",value:function(T,A,D){var M,B=this,H=null,Y=null;return B._resetErr(),!!B._isValid()&&(U.isUndefined(D)&&(U.isFunction(T)&&U.isFunction(A)||U.isFunction(T)&&U.isUndefined(A)||U.isFunction(T)&&null==A||null==T&&U.isFunction(A))?(M={},U.isFunction(T)&&(H=T),U.isFunction(A)&&(Y=function(G){G&&G.code&&(B._errorCode=G.code,B._errorString=G.message),A(B._errorCode,B._errorString)})):(M=U.isUndefined(T)||null==T?{}:U.clone(T),U.isFunction(A)&&(H=function(){A(M)}),U.isFunction(D)&&(Y=function(G){G&&G.code&&(B._errorCode=G.code,B._errorString=G.message),D(M,B._errorCode,B._errorString)})),H||(H=function(){}),Y||(Y=function(G){G&&G.code&&(B._errorCode=G.code,B._errorString=G.message)}),B.AcquireImageAsync(M).then(H,Y),!Yl.isServerInvalid(B))}},{key:"GetDevicesAsync",value:function(T,A,D){return this._getDevicesAsync("GetDevicesAsync",T,A,D)}},{key:"SelectDeviceAsync",value:function(T,A){var D=this;return D._resetErr(),D._isValid()?this._selectDeviceAsync("SelectDeviceAsync",T,A):ge.Promise.reject({code:D._errorCode,message:D._errorString})}},{key:"AcquireImageAsync",value:function(T){return fa(qn(C.prototype),"_acquireImage",this).call(this,this._curDevice,T)}},{key:"ImageIDToIndex",value:function(T){return this._uidFromServer2index(T)}},{key:"IndexToImageID",value:function(T){return this._index2uidFromServer(T)}},{key:"RemoveImage",value:function(T){return this._removeImage("RemoveImage",T)}},{key:"_innerGetSourceNamesSync",value:function(T){var A=this;return A._getSourceCountSync(),T?Os(A,HW,Zfe).call(A):Os(A,GW,epe).call(A)}},{key:"getCapabilities",value:function(T,A,D){var M,B,H,Y=this;return ge.isFunction(T)?(B=T,H=A):(M=T,B=A,H=D),!U.isUndefined(M)&&(!U.isArray(M)||U.isArray(M)&&M.indexOf(null)>=0||U.isString(M)&&0==M.trim().length)?(Wi(Y),void(U.isFunction(H)&&H(Y._errorCode,Y._getErrorString()))):this._dwtGetCapabilities(M,B,H)}},{key:"setCapabilities",value:function(T,A,D){return this._dwtSetCapabilities(T,A,D)}},{key:"CancelAllPendingTransfers",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CancelAllPendingTransfers")}},{key:"CloseSource",value:function(){var T=this;if(T._resetErr(),!T._isValid())return!1;var A=T._innerFun("CloseSource");return A&&(T._curDevice=null),A}},{key:"CloseSourceManager",value:function(){var T=this;return T._resetErr(),!!T._isValid()&&T._innerFun("CloseSourceManager")}},{key:"SelectDevice",value:function(T,A){var D,M=this;if(M._resetErr(),Ce.DWT.ConnectWithSocket)return wt(M,-2400,"SelectDevice doesn't work under current settings."),!1;var B,H=null===(D=this._dmService.attrs)||void 0===D?void 0:D.UUID;if(H&&(null===(B=T.serviceInfo.attrs)||void 0===B?void 0:B.UUID)!=H){var Y,G=(null===(Y=T.serviceInfo.attrs)||void 0===Y?void 0:Y.url)||T.serviceInfo.server;if(!(G&&G.indexOf(H)>-1))return yle(M),!1}var q=!1;try{(q=Os(this,Kfe,aqe).call(this,T.strDevice,A))&&(this._curDevice=T,this._bSelectedSourceByServer=!1)}catch(re){q=!1,this._errorCode=Xn.CommonError,re&&re.message&&(this._errorString=re.message)}return q}},{key:"DisableSource",value:function(){var T=this;return T._resetErr(),!!T._isValid()&&T._innerFun("DisableSource")}},{key:"FeedPage",value:function(){var T=this;return T._resetErr(),!!T._isValid()&&T._innerFun("FeedPage")}},{key:"GetDeviceType",value:function(){var T=this;return T._resetErr(),!!T._isValid()&&T._innerFun("GetDeviceType")}},{key:"GetSourceNameItems",value:function(T){var A=this;return A._resetErr(),!!A._isValid()&&(A.__sourceCount<0&&(A.__sourceCount=0),T<A.__sourceCount&&T>=0?A._getSourceNameByIndex(T):"")}},{key:"SourceNameItems",value:function(T){var A=this;return A._resetErr(),!!A._isValid()&&A.GetSourceNameItems(T)}},{key:"GetSourceNames",value:function(T){return this._innerGetSourceNamesSync(T)}},{key:"getSourceCount",value:function(T){return this._getSourceCountAsync(T)}},{key:"GetSourceCountAsync",value:function(T){return this._getSourceCountAsync(T)}},{key:"GetSourceType",value:function(T){var B,H,A=this,D=parseInt(T);return A._resetErr(),isNaN(D)?(Wi(A),!1):(null==A.__devices&&A.GetSourceNames(!1),D>=A.__devices.length||D<0?(kt(A),!1):(B=Mi.TWAIN,(H=A.__devices[D].deviceType&Cje)==Zt.TWAINSCANNER||H==Zt.WIATWAINSCANNER||(H==Zt.TWAINX64SCANNER?B=Mi.TWAIN64:H==Zt.ICASCANNER?B=Mi.ICA:H==Zt.SANESCANNER?B=Mi.SANE:(H&Zt.TWAINX64SCANNER)==Zt.TWAINX64SCANNER?(H&Zt.TWAINSCANNER)!=Zt.TWAINSCANNER&&(H&Zt.WIATWAINSCANNER)!=Zt.WIATWAINSCANNER||(B=Mi.TWAIN_AND_TWAIN64):(H&Zt.ICASCANNER)==Zt.ICASCANNER&&((H&Zt.TWAINSCANNER)!=Zt.TWAINSCANNER&&(H&Zt.WIATWAINSCANNER)!=Zt.WIATWAINSCANNER||(B=Mi.TWAIN_AND_ICA))),B))}},{key:"OpenSource",value:function(){var T=this;return T._resetErr(),!!T._isValid()&&(T._bRemoteMode?(wt(T,-2610,"OpenSource is not supported when Object is created by CreateRemoteScanObjectAsync. Please use OpenSourceAsync instead."),!1):T._innerFun("OpenSource"))}},{key:"OpenSourceManager",value:function(){var T=this;return T._resetErr(),!!T._isValid()&&T._innerFun("OpenSourceManager")}},{key:"ResetImageLayout",value:function(){var T=this;return T._resetErr(),!!T._isValid()&&T._innerFun("ResetImageLayout")}},{key:"RewindPage",value:function(){var T=this;return T._resetErr(),!!T._isValid()&&T._innerFun("RewindPage")}},{key:"SelectSource",value:function(T,A){var D=this,M=!1;if(U.isFunction(T)&&(M=!0),D._resetErr(),!D._isValid())return!!M&&void 0;var B=Mi.TWAIN;if(!M){if(D._bRemoteMode)return wt(D,-2438,"SelectSource cannot be used synchronously when Object is created by CreateRemoteScanObjectAsync. Please use SelectSourceAsync instead."),!1;if(D._driverType==Mi.TWAIN_AND_TWAIN64)return wt(D,-2429,"The method SelectSource() must be invoked asynchronously (i.e. with callback functions) when ImageCaptureDriverType is set to TWAIN_AND_ICA or TWAIN_AND_TWAIN64."),!1;D._driverType!=Mi.ICA&&D._driverType!=Mi.SANE&&D._driverType!=Mi.TWAIN64||(B=D._driverType);var G=$A(B,de.bWin,de.bLinux,de.bMac,de.bAndroid);return D._bSelectedSourceByServer=!0,D._curDevice=null,D._innerFun("SelectSource",It(G))}D._driverType!=Mi.ICA&&D._driverType!=Mi.SANE&&D._driverType!=Mi.TWAIN64&&D._driverType!=Mi.TWAIN_AND_TWAIN64||(B=D._driverType);var se=$A(B,de.bWin,de.bLinux,de.bMac,de.bAndroid);D.SelectSourceAsync(se).then(function(){U.isFunction(T)&&T()},function(ce){ce&&ce.code&&(D._errorCode=ce.code,D._errorString=ce.message),U.isFunction(A)&&A(D._errorCode,D._getErrorString())})}},{key:"GetSourceTypeAsync",value:function(T){var A=this,D=1*T;return A._resetErr(),A._isValid()?ge.Promise.resolve(A.GetSourceType(D)):ge.Promise.reject({code:A._errorCode,message:A._errorString})}},{key:"SetFileXferInfo",value:function(T,A){var D,M,B=this;return B._resetErr(),!!B._isValid()&&(D=de.bFileSystem?T.replace(/<%/g,"<%25"):T,M=zn.replaceLocalFilename(D),B._innerFun("SetFileXferInfo",It(M,A)))}},{key:"SetImageLayout",value:function(T,A,D,M){var B=this;return B._resetErr(),!!B._isValid()&&B._innerFun("SetImageLayout",It(T,A,D,M))}},{key:"CapGet",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGet")}},{key:"CapGetCurrent",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetCurrent")}},{key:"CapGetDefault",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetDefault")}},{key:"CapGetFrameBottom",value:function(T){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetFrameBottom",It(T))}},{key:"CapGetFrameLeft",value:function(T){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetFrameLeft",It(T))}},{key:"CapGetFrameRight",value:function(T){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetFrameRight",It(T))}},{key:"CapGetFrameTop",value:function(T){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetFrameTop",It(T))}},{key:"CapGetHelp",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetHelp")}},{key:"CapGetLabel",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetLabel")}},{key:"CapGetLabels",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetLabels")}},{key:"CapIfSupported",value:function(T){return this._resetErr(),!!this._isValid()&&this._innerFun("CapIfSupported",It(T))}},{key:"CapReset",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapReset")}},{key:"CapSet",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapSet")}},{key:"CapSetFrame",value:function(T,A,D,M,B){return this._resetErr(),!!this._isValid()&&this._innerFun("CapSetFrame",It(T,A,D,M,B))}},{key:"GetCapItems",value:function(T){return this._resetErr(),!!this._isValid()&&this._innerFun("GetCapItems",It(T))}},{key:"GetCapItemsString",value:function(T){return this._resetErr(),!!this._isValid()&&this._innerFun("GetCapItemsString",It(T))}},{key:"SetCapItems",value:function(T,A){return this._resetErr(),!!this._isValid()&&this._innerFun("SetCapItems",It(T,A))}},{key:"SetCapItemsString",value:function(T,A){return this._resetErr(),!!this._isValid()&&this._innerFun("SetCapItemsString",It(T,A))}},{key:"GenerateURLForUploadData",value:function(T,A,D,M,B){var H=this,Y=[];if(A==Ce.DWT.EnumDWT_ImageType.IT_BMP||A==Ce.DWT.EnumDWT_ImageType.IT_JPG||A==Ce.DWT.EnumDWT_ImageType.IT_PNG){if(!U.isArray(T))return Y1(H),U.isFunction(M)&&M(H._errorCode,H._getErrorString(),"",T,A),"";if(T.length>1)return z1(H),U.isFunction(M)&&M(H._errorCode,H._getErrorString(),"",T,A),"";if(!H._checkIndices(T))return M(H._errorCode,H._getErrorString(),"",T,A),!1;var G=H._ImgManager.convertClientIndexToServerId(T[0]);-1!=G&&Y.push(G)}else{if(A!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&A!=Ce.DWT.EnumDWT_ImageType.IT_PDF)return U.isArray(T)?Gl(H):Y1(H),U.isFunction(M)&&M(H._errorCode,H._getErrorString(),H.__HTTPPostResponseString,T,A),"";var q,re;if(U.isArray(T)){if(!H._checkIndices(T))return M(H._errorCode,H._getErrorString(),"",T,A),!1;q=T}else{if(-1!=T)return Y1(H),U.isFunction(M)&&M(H._errorCode,H._getErrorString(),H.__HTTPPostResponseString,T,A),"";for(q=[],re=0;re<H._ImgManager.count();re++)q.push(re)}U.each(q,function(se){var ce=H._ImgManager.convertClientIndexToServerId(se);-1!=ce&&Y.push(ce)})}return U.isFunction(D)&&U.isFunction(M)?(H._asyncGenerateURLForUploadData(Y,A,B,D,function(se){M(H._errorCode,H._getErrorString(),H.__HTTPPostResponseString,se,A)}),!0):this._syncGenerateURLForUploadData(Y,A,B)}},{key:"_syncGenerateURLForUploadData",value:function(T,A,D){var M,B=this,H=!1,Y=$n.managerVersion.join(""),G=D,q=",";U.isString(G)&&""!=G||(G="",q="");var re=["[",'"dcp","dwasm_'+Y,'",',A,',"',T.join(","),'"',q,G,"]"].join("");return(M=this._innerFunRaw("GenerateURLForUploadData",re,!1,!1,!0))&&U.isArray(M.result)&&M.result.length>1&&1==M.result[0]&&(H=["dcp://dwasm_",Y,"/file/",M.result[1]].join("")),U.isArray(T)&&U.each(T,function(ve){B._ImgManager.convertServerIdToClientIndex(ve)}),0==H?(B7(B),""):H}},{key:"_asyncGenerateURLForUploadData",value:function(T,A,D,M,B){var H=this,Y=A,G=function(){if(U.isFunction(B)){var Te=[];U.isArray(T)&&U.each(T,function(Ue){var je=H._ImgManager.convertServerIdToClientIndex(Ue);je>-1&&Te.push(je)}),B(Te)}return""},q=",";if(Y==Ce.DWT.EnumDWT_ImageType.IT_BMP||Y==Ce.DWT.EnumDWT_ImageType.IT_JPG||Y==Ce.DWT.EnumDWT_ImageType.IT_PNG){if(T.length>1)return z1(H),G(),""}else if(Y!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&Y!=Ce.DWT.EnumDWT_ImageType.IT_PDF)return Gl(H),G(),"";var re=!1,se=$n.managerVersion.join(""),ce=D;U.isString(ce)&&""!=ce||(ce="",q="");var ve=["[",'"dcp","dwasm_'+se,'",',Y,',"',T.join(","),'"',q,ce,"]"].join("");return this._innerFunRaw("GenerateURLForUploadData",ve,!0,!1,!0,function(Te){if(Te&&U.isArray(Te.result)&&Te.result.length>0?1==Te.result[0]&&Te.result.length>1?re=["dcp://dwasm_",se,"/file/",Te.result[1]].join(""):void 0!==Te.exception&&void 0!==Te.description?(H._errorCode=Te.exception,H._errorString=Te.description):B7(H):B7(H),0==re)return G(),"";if(U.isFunction(M)){var je=[];U.isArray(T)&&U.each(T,function(Ee){var Oe=H._ImgManager.convertServerIdToClientIndex(Ee);Oe>-1&&je.push(Oe)}),M(re,je,A)}return re},G)}},{key:"SelectSourceByIndex",value:function(T){var A=this,D=parseInt(T);return A._resetErr(),isNaN(D)?(Wi(A),!1):(null==A.__devices&&A.GetSourceNames(!1),D>=A.__devices.length||D<0?(kt(A),!1):A.SelectDevice(A.__devices[D]))}},{key:"EnableSource",value:function(T,A,D){var M=this;return M._resetErr(),!!M._isValid()&&M.AcquireImage(T,A,D)}},{key:"SourceCount",get:function(){return this._getSourceCountSync()}},{key:"CurrentSourceName",get:function(){return this._curDevice?this._curDevice.displayName:""}},{key:"checkStartScanParams",value:function(T,A){var D=this;if(!T)return wt(D,-2381,"scanSetup is invalid."),!1;if(!U.isUndefined(A.transferMode)&&0!=T.transferMode&&1!=T.transferMode&&2!=T.transferMode)return wt(D,-2382,"Scanner setup error: Invalid Transfer Mode."),!1;if(T.transferMode==Ce.DWT.EnumDWT_TransferMode.TWSX_FILE){if(!T.fileXfer)return wt(D,-2383,"Scanner setup error: fileXfer is invalid."),!1;if(!U.isString(T.fileXfer.fileName)||""==T.fileXfer.fileName)return function(M){wt(M,-2384,"Scanner setup error: Invalid fileName in fileXfer.")}(D),!1;if(!U.isNumber(T.fileXfer.fileFormat)||T.fileXfer.fileFormat<0||T.fileXfer.fileFormat>16)return function(M){wt(M,-2385,"Scanner setup error: Invalid fileFormat in fileXfer.")}(D),!1}if(A){if(!U.isString(A.type)||""==A.type)return function(M){wt(M,-2387,"Output setup error: Invalid type in outputSetup.")}(D),!1;if(!A.httpParams)return function(M){wt(M,-2386,"Output setup error: Invalid httpParams in outputSetup.")}(D),!1;if(T.transferMode!=Ce.DWT.EnumDWT_TransferMode.TWSX_FILE&&U.isUndefined(A.format))return function(M){wt(M,-2390,"Output setup error: Invalid format in outputSetup.")}(D),!1;if(!U.isString(A.httpParams.url)||""==A.httpParams.url)return function(M){wt(M,-2388,"Output setup error: Invalid url in outputSetup.httpParams.")}(D),!1;if(!U.isString(A.httpParams.fileName)||""==A.httpParams.fileName)return function(M){wt(M,-2389,"Output setup error: Invalid fileName in outputSetup.httpParams.")}(D),!1}return!0}},{key:"startScan",value:function(T){var A,D=this,M=T;if(D._resetErr(),!D._isValid())return!1;if(1==D._startScanFlag)return wt(A={},-2432,"Operation in progress, please try again when the current operation has finished."),ge.Promise.reject({code:A._errorCode,message:A._errorString});D._startScanFlag=!0,U.isObject(M)||(M={});var B,H,Y,G=!1,q=!1,re=!0,se=!0,ce=!0,ve=!1,Te=M.onFinally,Ue=[],je=[],Ee=0,Oe=1,He=[],we={type:"http",format:Ce.DWT.EnumDWT_ImageType.IT_PDF,reTries:3,useUploader:!1,singlePost:!0,showProgressBar:!0,removeAfterOutput:!0,httpParams:{url:"",headers:{},formFields:{},remoteName:"RemoteFile",fileName:""}},ue=U.clone(M),pe=M;if(Y=ue.funcScanStatus,delete ue.funcScanStatus,ue.bfuncScanStatus=!!U.isFunction(Y),ue.outputSetup){var ye={pdfSetup:{},tiffSetup:{}};cqe(ue.outputSetup,we),H=ue.outputSetup,delete ue.outputSetup,H.pdfSetup&&(H.format!=Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF&&H.format!=Ce.DWT.EnumDWT_ImageType.IT_PDF||U.mix(ye.pdfSetup,H.pdfSetup)),H.tiffSetup&&(H.format!=Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF&&H.format!=Ce.DWT.EnumDWT_ImageType.IT_TIF||U.mix(ye.tiffSetup,H.tiffSetup)),H.format!=Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF&&H.format!=Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF||(H.singlePost=!0),H.httpParams&&U.isNumber(H.httpParams.threads)&&(Oe=H.httpParams.threads),G=U.stringify(ye),q=D.checkStartScanParams(ue,H)}else(H=we).type="",q=D.checkStartScanParams(ue,!1);if(!q)return new ge.Promise(function(jn,hi){re&&(hi({code:D._errorCode,message:D._getErrorString(),response:""}),re=!1,D._startScanFlag=!1)});H.funcHttpUploadStatus&&(ve=H.funcHttpUploadStatus);var me,Se,We,ze,Be,$e,Ge=D.__remoteFilename,_t=D.MaxUploadImageSize,Ct=D.IfShowProgressBar,Ut=D.__OnPostTransferAsync,Tn=D.__OnPostAllTransfers,mn=D.__OnHttpUploadStatus,bt=D.__insertingIndex,At=D.__IfAppendImage,Tt=D.httpFormFields,Bt=D._tiffCompressionType,Qt=!1,yn=H.showProgressBar;if(me=function(jn){var hi=!0;U.each(He,function(jt,xs){-1==jt.st&&(hi=!1)}),hi?Se(jn):setTimeout(function(){me(jn)},200)},Se=function(jn){jn.__OnPostTransferAsync=Ut,jn.__OnPostAllTransfers=Tn,jn.__OnHttpUploadStatus=mn,jn.__remoteFilename=Ge,jn.__maxUploadImageSize=_t,jn.IfShowProgressBar=Ct,jn.__insertingIndex=bt,jn.__IfAppendImage=At,jn.httpFormFields=Tt,jn._tiffCompressionType=Bt,Ce.FileUploader&&(Ce.FileUploader.nextLoopTime=600),jn._startScanFlag=!1},We=function(jn,hi,jt){se?(hi(jt),me(jn)):setTimeout(function(){We(jn,hi,jt)},200)},ze=function(jn,hi){Qt=!0,re&&(re=!1,se||D._innerSendCmd("CancelAllPendingTransfers"),We(D,jn,hi))},Be=function(jn,hi,jt,xs){if(U.isFunction(ve)){var qp,Er=hi,Rr=0;U.isNumber(xs)&&xs>0&&(Rr=xs),qp={fileName:Er,percentage:jt,statusCode:Rr,responseString:jn.__HTTPPostResponseString},setTimeout(function(){ve(qp)},10)}},D.__HTTPPostResponseString="",D.IfShowProgressBar=yn,U.isNumber(ue.insertingIndex)&&ue.insertingIndex>-1&&(D.__insertingIndex=ue.insertingIndex,D.__IfAppendImage=!1),D.__OnHttpUploadStatus=!!U.isFunction(ve)&&ve,H.useUploader&&!Ce.FileUploader)return new ge.Promise(function(jn,hi){wt(D,-2380,"Please make sure the Uploader Module has been installed.");var jt={code:D._errorCode,message:D._getErrorString(),response:""};se=!0,ze(hi,jt)});if(B=H.reTries,H.useUploader){if(H.httpParams&&($e=H.httpParams.url),!U.startsWith($e,"http://")&&!U.startsWith($e,"https://")){var un=window.location.href,Ir=un.lastIndexOf("/");un=un.substring(0,Ir+1),H.httpParams.url=un+$e}}else H.httpParams&&(U.each(H.httpParams.headers,function(jn,hi){D.SetHTTPHeader(hi,jn)}),U.each(H.httpParams.formFields,function(jn,hi){D.SetHTTPFormField(hi,jn)}));return H.httpParams&&""!==H.httpParams.remoteName&&(D.__remoteFilename=H.httpParams.remoteName),new ge.Promise(function(jn,hi){H.useUploader?Ce.FileUploader.Init(0,function(jt){jn({uploadManager:jt})},function(jt,xs){D._errorCode=jt,D._errorString=xs,se=!0,ze(hi,{code:jt,message:xs,response:D.__HTTPPostResponseString})}):jn({})}).then(function(jn){return new ge.Promise(function(hi,jt){var xs=function Er(){(ue.transferMode==Ce.DWT.EnumDWT_TransferMode.TWSX_FILE?Ee==je.length:Ee==Ue.length)?(ge.closeProgress(null,"Scan Upload"),Qt=!0,hi(pe),Se(D)):setTimeout(Er,100)};Y&&U.isFunction(Y)&&(D.__OnPreAllTransfersAsync=function(Er){Y(Er)}),D.registerEvent("OnPostTransferAsync",function(Er){var Rr,jo,Dm,Qa,xl,Sa,md=H.httpParams&&H.httpParams.url,ws=D._uidFromServer2ServerId(Er.imageId),Ta=H.singlePost,Ho=ue.transferMode==Ce.DWT.EnumDWT_TransferMode.TWSX_FILE,vd=H.removeAfterOutput,pa=0;if(ce&&(se=!1,ce=!1),Ho?(pa=je.length,je.push(Er.path)):(pa=Ue.length,Ue.push(ws)),Y&&U.isFunction(Y)){var l3={event:"postTransfer",bScanCompleted:!1,result:{currentPageNum:pa+1}};setTimeout(function(){Y(l3)},10)}if(Qt)return!1;if("http"==H.type)if(H.httpParams&&(jo=Cc(H.httpParams.fileName,pa+1),Dm=Cc(H.httpParams.remoteName,pa+1)),Ta||"http"!=H.type);else if(H.httpParams&&U.isNumber(H.httpParams.maxSizeLimit)&&(D.__maxUploadImageSize=H.httpParams.maxSizeLimit),H.useUploader){yn?(Ce.FileUploader.nextLoopTime=300,ge.showProgress(D,"Scan Upload",D.__IfShowCancelDialogWhenImageTransfer)):ge.hideProgress(),Qa=function(Go,Oi){return D.__HTTPPostResponseString=Oi,Be(D,Go._fileName,100,200),D._OnPercentDone([0,100,"","http",Go._fileName]),yn&&ge.closeProgress(null,"Scan Upload"),!Ho&&H.removeAfterOutput?setTimeout(function(){D._ImgManager.convertServerIdToClientIndex(ws)>-1?Os(D,gu,gd).call(D,ws,function(){Ee++},function(){Ee++}):Ee++},100):Ee++,!0};var Am,_i=jn.uploadManager;if(xl=function(){var Go,Oi;if(yn)for(Oi=Ho?je.length:Ue.length,Go=0;Go<Oi;Go++)ge.closeProgress(null,"Scan Upload");!Ho&&H.removeAfterOutput&&setTimeout(function(){D._ImgManager.convertServerIdToClientIndex(ws)>-1&&Os(D,gu,gd).call(D,ws)},100),_i.CancelAllUpload();var yd={code:D._errorCode,message:D._getErrorString(),response:D.__HTTPPostResponseString};return ze(jt,yd),!1},Sa=function(Go,Oi,yd,hh){var cr=303;Oi==_C.TRANS_SERVICE_ERROR_404?cr=404:Oi==_C.TRANS_SERVICE_ERROR_500?cr=500:Oi==_C.TRANS_SERVICE_ERROR_503&&(cr=503),D._errorCode=Oi,D._errorString=yd,D.__HTTPPostResponseString=hh,Be(D,jo,100,cr),xl()},Am=function(){D.__HTTPPostResponseString="",Be(D,jo,100,303),xl()},Ho){var Ia=_i.CreateJob(),c3=Ia.FormField;H.httpParams&&(U.each(H.httpParams.headers,function(Go,Oi){Ia.HttpHeader[Oi]=Go}),U.each(H.httpParams.formFields,function(Go,Oi){c3.Add(Oi,Go)})),Ia.ServerUrl=md,Ia.bDeleteFile=vd,Ia.reTries=B,H.httpParams&&U.isNumber(H.httpParams.maxSizeLimit)&&(Ia.maxSizeLimit=H.httpParams.maxSizeLimit),Ia._fileName=jo,Ia.SourceValue.Add(Er.path,jo,Dm),Ia.ImageType=ue.fileXfer.fileFormat,Ia.ThreadNum=Oe,Ia.OnRunSuccess=Qa,Ia.OnRunFailure=Sa,(yn||U.isFunction(ve))&&(Ia.OnUploadTransferPercentage=function(Go,Oi){Oi>0&&Oi<=100&&(D._OnPercentDone([0,Oi,"","http",Go._fileName]),U.isFunction(ve)&&Be(D,Go._fileName,Oi,0))},ge.cancelFrom=Zn.Scan,yn&&Os(D,FP,zW).call(D,xl),D._OnPercentDone([0,-1,Lr.Uploading,"http",jo]),Be(D,jo,0,0)),_i.Run(Ia)}else(Rr=H.format)==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF?Rr=Ce.DWT.EnumDWT_ImageType.IT_PDF:Rr==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF&&(Rr=Ce.DWT.EnumDWT_ImageType.IT_TIF),ge.cancelFrom=Zn.Scan,yn&&Os(D,FP,zW).call(D,xl),D._OnPercentDone([0,-1,Lr.Encoding,"http",jo]),D._asyncGenerateURLForUploadData([ws],Rr,G,function(Go){var Oi=_i.CreateJob(),yd=Oi.FormField;H.httpParams&&(U.each(H.httpParams.headers,function(hh,cr){Oi.HttpHeader[cr]=hh}),U.each(H.httpParams.formFields,function(hh,cr){yd.Add(cr,hh)})),Oi.ServerUrl=md,Oi.bDeleteFile=vd,Oi.reTries=B,H.httpParams&&U.isNumber(H.httpParams.maxSizeLimit)&&(Oi.maxSizeLimit=H.httpParams.maxSizeLimit),Oi._fileName=jo,Oi.SourceValue.Add(Go,jo,Dm),Oi.ImageType=Rr,Oi.ThreadNum=Oe,Oi.OnRunSuccess=Qa,Oi.OnRunFailure=Sa,(yn||U.isFunction(ve))&&(Oi.OnUploadTransferPercentage=function(hh,cr){cr>0&&cr<=100&&(D._OnPercentDone([0,cr,"","http",hh._fileName]),U.isFunction(ve)&&Be(D,hh._fileName,cr,0))},D._OnPercentDone([0,-1,Lr.Uploading,"http",jo]),Be(D,jo,0,0)),_i.Run(Oi)},Am)}else{var mu={id:ws,st:-1,bCancel:!1};if(He.push(mu),0==pa&&(yn?ge.showProgress(D,"Scan Upload",D.__IfShowCancelDialogWhenImageTransfer):ge.hideProgress()),Ho)Qa=function(Go){return mu.st=0,!Ho&&H.removeAfterOutput?setTimeout(function(){D._ImgManager.convertServerIdToClientIndex(ws)>-1?Os(D,gu,gd).call(D,ws,function(){Ee++},function(){Ee++}):Ee++},100):Ee++,!0},xl=function(){!Ho&&H.removeAfterOutput&&setTimeout(function(){D._ImgManager.convertServerIdToClientIndex(ws)>-1&&Os(D,gu,gd).call(D,ws)},100);var Go={code:D._errorCode,message:D._getErrorString(),response:D.__HTTPPostResponseString};return ge.closeProgress(null,"Scan Upload"),2==mu.st||(mu.st=1,U.each(He,function(Oi,yd){-1==Oi.st&&(Oi.bCancel=!0)}),ze(jt,Go)),!1},D._innerUploadDirectly(md,Er.path,jo,yn,vd,B,!1,mu,Qa,xl);else{if(Qa=function(Go,Oi){return mu.st=0,!Ho&&H.removeAfterOutput?setTimeout(function(){D._ImgManager.convertServerIdToClientIndex(ws)>-1?Os(D,gu,gd).call(D,ws,function(){Ee++},function(){Ee++}):Ee++},100):Ee++,!0},xl=function(Go){!Ho&&H.removeAfterOutput&&setTimeout(function(){D._ImgManager.convertServerIdToClientIndex(ws)>-1&&Os(D,gu,gd).call(D,ws)},100);var Oi={code:D._errorCode,message:D._getErrorString(),response:D.__HTTPPostResponseString};return ge.closeProgress(null,"Scan Upload"),2==mu.st||(mu.st=1,U.each(He,function(yd,hh){-1==yd.st&&(yd.bCancel=!0)}),ze(jt,Oi)),!1},U.isUndefined(Rr=H.format)){var NP=D._ImgManager.convertServerIdToClientIndex(ws);return Gl(D),xl([NP]),!1}Rr==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF?Rr=Ce.DWT.EnumDWT_ImageType.IT_PDF:Rr==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF&&(Rr=Ce.DWT.EnumDWT_ImageType.IT_TIF);var BP={method:"startScan",url:md,serverIds:[ws],headers:D._GetHttpHeadersAndClear(),formData:Tm(D.httpFormFields),enumImageType:Rr,saveSetup:G,fileName:jo,dataFormat:KS.Binary,retry:B,bOnlyResponseEmptyIsOK:!1,objUploadFileStatus:mu,asyncSuccessFunc:Qa,asyncFailureFunc:xl};D._asyncUploadCmd(BP)}}}),D.__OnPostAllTransfers=function(){var Er,Rr,jo=-1,Dm=KS.Binary,Qa=H.httpParams.url,xl=H.singlePost,Sa=ue.transferMode==Ce.DWT.EnumDWT_TransferMode.TWSX_FILE,md=H.removeAfterOutput;if(Y&&U.isFunction(Y)&&(Rr={event:"postTransfer",bScanCompleted:!0,result:{currentPageNum:jo=Sa?je.length:Ue.length}},setTimeout(function(){Y(Rr)},10)),0==jo)return wt(D,-1029,"Source has nothing to capture."),void setTimeout(function(){se=!0,Te&&U.isFunction(Te)&&Te();var cr={code:D._errorCode,message:D._getErrorString(),response:D.__HTTPPostResponseString};ze(jt,cr)},1e3);if(jo>0&&-1029==D._errorCode)D._errorCode=0;else if(0!=D._errorCode){se=!0,Te&&U.isFunction(Te)&&Te();var ws={code:D._errorCode,message:D._getErrorString(),response:D.__HTTPPostResponseString};return void ze(jt,ws)}if("http"==H.type&&xl&&"http"==H.type){var Ta,Ho,vd,pa=Ue;if(H.httpParams&&U.isNumber(H.httpParams.maxSizeLimit)&&(D.__maxUploadImageSize=H.httpParams.maxSizeLimit),H.useUploader){var l3,Am=jn.uploadManager,_i=Am.CreateJob(),Ia=_i.FormField;if(yn?(Ce.FileUploader.nextLoopTime=300,ge.showProgress(D,"Scan Upload",D.__IfShowCancelDialogWhenImageTransfer)):ge.hideProgress(),Ta=function(cr,Gi){var ss=cr._fileName;return ss||(ss=""),D._bServerPercentDone=!0,D.__HTTPPostResponseString=Gi,Be(D,ss,100,200),D._OnPercentDone([0,100,"","http"]),yn&&ge.closeProgress(null,"Scan Upload"),!Sa&&H.removeAfterOutput?setTimeout(function(){Ee=0,U.each(pa,function(ql){D._ImgManager.convertServerIdToClientIndex(ql)>-1?Os(D,gu,gd).call(D,ql,function(){Ee++},function(){Ee++}):Ee++}),setTimeout(xs,100)},100):(Qt=!0,hi(pe),Se(D)),!0},Ho=function(){yn&&ge.closeProgress(null,"Scan Upload"),Am.CancelAllUpload(),D._bServerPercentDone=!0;var cr={code:D._errorCode,message:D._getErrorString(),response:D.__HTTPPostResponseString};return ze(jt,cr),!Sa&&H.removeAfterOutput&&setTimeout(function(){U.each(pa,function(Gi){D._ImgManager.convertServerIdToClientIndex(Gi)>-1&&Os(D,gu,gd).call(D,Gi)})},100),!1},vd=function(cr,Gi,ss,ql){var Kl=303;Gi==_C.TRANS_SERVICE_ERROR_404?Kl=404:Gi==_C.TRANS_SERVICE_ERROR_500?Kl=500:Gi==_C.TRANS_SERVICE_ERROR_503&&(Kl=503),D._errorCode=Gi,D._errorString=ss,D.__HTTPPostResponseString=ql,Be(D,"",100,Kl),Ho()},l3=function(){D.__HTTPPostResponseString="",Be(D,"",100,303),Ho()},yn&&(ge.cancelFrom=Zn.Scan,Os(D,FP,zW).call(D,Ho)),Sa)H.httpParams&&(U.each(H.httpParams.headers,function(cr,Gi){_i.HttpHeader[Gi]=cr}),U.each(H.httpParams.formFields,function(cr,Gi){Ia.Add(Gi,cr)})),_i.ServerUrl=Qa,_i.bDeleteFile=md,_i.reTries=B,H.httpParams&&U.isNumber(H.httpParams.maxSizeLimit)&&(_i.maxSizeLimit=H.httpParams.maxSizeLimit),U.each(je,function(cr,Gi){var ss,ql;H.httpParams&&(ss=Cc(H.httpParams.fileName,Gi+1),ql=Cc(H.httpParams.remoteName,Gi+1)),_i.SourceValue.Add(cr,ss,ql)}),_i.ImageType=ue.fileXfer.fileFormat,_i.ThreadNum=Oe,_i.OnRunSuccess=Ta,_i.OnRunFailure=vd,(yn||U.isFunction(ve))&&(_i.OnUploadTransferPercentage=function(cr,Gi){Gi>0&&Gi<=100&&(D._OnPercentDone([0,Gi,"","http"]),U.isFunction(ve)&&Be(D,"",Gi,0))},D._OnPercentDone([0,-1,Lr.Uploading,"http"]),Be(D,"",0,0)),Am.Run(_i);else if((Er=H.format)==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF||Er==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF)Er==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF?Er=Ce.DWT.EnumDWT_ImageType.IT_PDF:Er==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF&&(Er=Ce.DWT.EnumDWT_ImageType.IT_TIF),D._OnPercentDone([0,-1,Lr.Encoding,"http"]),D._asyncGenerateURLForUploadData(pa,Er,G,function(cr){var Gi,ss;H.httpParams&&(U.each(H.httpParams.headers,function(ql,Kl){_i.HttpHeader[Kl]=ql}),U.each(H.httpParams.formFields,function(ql,Kl){Ia.Add(Kl,ql)})),_i.ServerUrl=Qa,_i.bDeleteFile=md,_i.reTries=B,H.httpParams&&U.isNumber(H.httpParams.maxSizeLimit)&&(_i.maxSizeLimit=H.httpParams.maxSizeLimit),H.httpParams&&(Gi=Cc(H.httpParams.fileName,1),ss=Cc(H.httpParams.remoteName,1)),_i._fileName=Gi,_i.SourceValue.Add(cr,Gi,ss),_i.ImageType=Er,_i.ThreadNum=Oe,_i.OnRunSuccess=Ta,_i.OnRunFailure=vd,(yn||U.isFunction(ve))&&(_i.OnUploadTransferPercentage=function(ql,Kl){Kl>0&&Kl<=100&&(D._OnPercentDone([0,Kl,"","http",Gi]),U.isFunction(ve)&&Be(D,Gi,Kl,0))},D._OnPercentDone([0,-1,Lr.Uploading,"http",Gi])),Am.Run(_i)},l3);else{var c3=pa.length,mu=0,NP=0,BP="";yn&&(D._bServerPercentDone=!1),D._OnPercentDone([0,-1,Lr.Encoding,"http"]),U.each(pa,function(cr,Gi){var ss,ql;H.httpParams&&(ss=Cc(H.httpParams.fileName,Gi+1),ql=Cc(H.httpParams.remoteName,Gi+1)),D._asyncGenerateURLForUploadData([cr],Er,G,function(Kl){NP=(mu+1)/c3*100,BP=[mu+1,"/",c3].join(""),D._OnPercentDone([0,NP,BP,"http"]),_i.SourceValue.Add(Kl,ss,ql),++mu>=c3&&(yn&&(D._bServerPercentDone=!0),H.httpParams&&(U.each(H.httpParams.headers,function(WP,Pm){_i.HttpHeader[Pm]=WP}),U.each(H.httpParams.formFields,function(WP,Pm){Ia.Add(Pm,WP)})),_i.ServerUrl=Qa,_i.bDeleteFile=md,_i.reTries=B,H.httpParams&&U.isNumber(H.httpParams.maxSizeLimit)&&(_i.maxSizeLimit=H.httpParams.maxSizeLimit),_i.ImageType=Er,_i.ThreadNum=Oe,_i.OnRunSuccess=Ta,_i.OnRunFailure=vd,(yn||U.isFunction(ve))&&(_i.OnUploadTransferPercentage=function(WP,Pm){Pm>0&&Pm<=100&&(D._OnPercentDone([0,Pm,"","http"]),U.isFunction(ve)&&Be(D,"",Pm,0))},D._OnPercentDone([0,-1,Lr.Uploading,"http"])),Am.Run(_i))},l3)})}}else if(Sa)Ta=function(cr){return D._bServerPercentDone=!0,!Sa&&H.removeAfterOutput?setTimeout(function(){Ee=0,U.each(pa,function(Gi){D._ImgManager.convertServerIdToClientIndex(Gi)>-1?Os(D,gu,gd).call(D,Gi,function(){Ee++},function(){Ee++}):Ee++}),setTimeout(xs,100)},100):(Qt=!0,hi(pe),Se(D)),!0},Ho=function(cr){D._bServerPercentDone=!0;var Gi={code:D._errorCode,message:D._getErrorString(),response:D.__HTTPPostResponseString};return ze(jt,Gi),!Sa&&H.removeAfterOutput&&setTimeout(function(){U.each(pa,function(ss){D._ImgManager.convertServerIdToClientIndex(ss)>-1&&Os(D,gu,gd).call(D,ss)})},100),!1},D._innerUploadFilesDirectly(Qa,je,H.httpParams&&H.httpParams.fileName,yn,md,B,!1,Ta,Ho);else{Ta=function(cr,Gi){return D._bServerPercentDone=!0,!Sa&&H.removeAfterOutput?setTimeout(function(){Ee=0,U.each(pa,function(ss){D._ImgManager.convertServerIdToClientIndex(ss)>-1?Os(D,gu,gd).call(D,ss,function(){Ee++},function(){Ee++}):Ee++}),setTimeout(xs,100)},100):(Qt=!0,hi(pe),Se(D)),!0},Ho=function(cr){D._bServerPercentDone=!0;var Gi={code:D._errorCode,message:D._getErrorString(),response:D.__HTTPPostResponseString};return ze(jt,Gi),!Sa&&H.removeAfterOutput&&setTimeout(function(){U.each(pa,function(ss){D._ImgManager.convertServerIdToClientIndex(ss)>-1&&Os(D,gu,gd).call(D,ss)})},100),!1},Er=H.format;var yd,Go=D._GetHttpHeadersAndClear(),Oi=Tm(D.httpFormFields);Er==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF||Er==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF?(Er==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF?Er=Ce.DWT.EnumDWT_ImageType.IT_PDF:Er==Ce.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF&&(Er=Ce.DWT.EnumDWT_ImageType.IT_TIF),H.httpParams&&(yd=Cc(H.httpParams.fileName,1),Cc(H.httpParams.remoteName,1)),D._asyncUploadCmd({method:"startScan",url:Qa,headers:Go,formData:Oi,serverIds:pa,enumImageType:Er,saveSetup:G,fileName:yd,dataFormat:Dm,retry:B,bOnlyResponseEmptyIsOK:!1,objUploadFileStatus:!1,asyncSuccessFunc:Ta,asyncFailureFunc:Ho})):pa.length>0&&D._asyncUploadFilesCmd(Qa,pa,Go,Oi,Er,H.httpParams&&H.httpParams.fileName,G,yn,B,!1,Ta,Ho)}}se=!0,Te&&U.isFunction(Te)&&Te()};var qp=function(){if("http"!=H.type)return Qt=!0,hi(pe),void Se(D);H.singlePost?setTimeout(function(){if(!se&&D._startScanFlag)return Qt=!0,hi(pe),void Se(D)},300):setTimeout(xs,100)};Os(D,Jfe,lqe).call(D,ue,qp,function(Er){if(-1029==D._errorCode&&(ue.transferMode==Ce.DWT.EnumDWT_TransferMode.TWSX_FILE?je.length>0:Ue.length>0))return D._errorCode=0,qp();var Rr={code:D._errorCode,message:D._getErrorString(),response:D.__HTTPPostResponseString};ze(jt,Rr)})})})}},{key:"_innerInitEvents",value:function(T){this.__OnWSReconnect=T.onWSReconnect||null,this.__OnWSClose=T.onWSClose||null,this.__OnWSMessage=T.onWSMessage||null,this.__OnWSError=T.onWSError||null,this.__OnPercentDone=T.onPercentDone||"",this.__OnPrintMsg=T.onPrintMsg||"",this.__OnResult=T.onResult||"",this.__OnAfterOperate=T.onAfterOperate||"",this.__OnBeforeOperate=T.onBeforeOperate||"",this.__OnOperateStatus=T.onOperateStatus||"",this.__OnBitmapChanged=T.onBitmapChanged||"",this.__OnGetFilePath=T.onGetFilePath||"",this.__OnPreAllTransfers=T.onPreAllTransfers||"",this.__OnPreTransfer=T.onPreTransfer||"",this.__OnPostLoad=T.onPostLoad||"",this.__OnPostTransfer=T.onPostTransfer||"",this.__OnPostAllTransfers=T.onPostAllTransfers||"",this.__OnSourceUIClose=T.onSourceUIClose||"",this.__OnTransferCancelled=T.onTransferCancelled||"",this.__OnTransferError=T.onTransferError||"",this.__OnInternetTransferPercentage=T.onInternetTransferPercentage||"",this.__OnInternetTransferPercentageEx=T.onInternetTransferPercentageEx||"",this.__OnRemoteScanStatusAsync=T.onRemoteScanStatusAsync||""}}],[{key:"create",value:(x=yt(W.mark(function T(A){var D;return W.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return D=new C(A),M.next=3,Yl.STwainConnectToServer(D);case 3:return M.abrupt("return",D);case 4:case"end":return M.stop()}},T)})),function(T){return x.apply(this,arguments)})}]);var x,w}($$e);function Zfe(){var y,C,x=[],w=this.__devices.length;for(y=0;y<w;y++){var T=this.__devices[y],A=T.deviceType,D={ProductName:"",DeviceInfo:{},DriverType:"",IsCurrentSource:!1,IsDefaultSource:!1,Manufacturer:"",ProductFamily:"",ProtocolMajor:0,ProtocolMinor:0,SupportedGroups:0,Version:{Country:0,Info:"",Language:0,MajorNum:0,MinorNum:0}},M=void 0,B=U.clone(T.deviceInfo);(C=A)==Zt.TWAINSCANNER||C==Zt.WIATWAINSCANNER||C==Zt.TWAINX64SCANNER?(A==Zt.TWAINSCANNER?M="TWAIN":A==Zt.WIATWAINSCANNER?M="WIATWAIN":A==Zt.TWAINX64SCANNER&&(M="TWAIN64"),D.Manufacturer=B.Manufacturer,D.ProductFamily=B.ProductFamily,D.ProtocolMajor=B.ProtocolMajor,D.ProtocolMinor=B.ProtocolMinor,D.SupportedGroups=B.SupportedGroups,D.Version=B.Version):A==Zt.SANESCANNER?(M="SANE",D.DeviceInfo=B):A==Zt.ICASCANNER?(M="ICA",D.DeviceInfo=B):A==Zt.ESCLSCANNER?(M="eSCL",D.DeviceInfo=B):A==Zt.WIFIDIRECTSCANNER?(M="WiFiScanner",D.DeviceInfo=B):A==Zt.WIASCANNER&&(M="WIA",D.DeviceInfo=B),D.ProductName=T.displayName,D.DriverType=M,x.push(D)}return x}function epe(){var y,C=this,x=[],w=0;for(C.__devices&&(w=C.__devices.length),y=0;y<w;y++)x.push(C.__devices[y].displayName);return x}function aqe(y,C){var x=["[",y,",",null!=C?C:_0.SMF_NAME,"]"].join("");return this._innerFun("SelectSourceEx",x)}function lqe(y,C,x){var w,T,A=this,D=null,M=null;if(T=U.isUndefined(y)||null==y?{}:y,A._resetErr(),!A._isValid())return!1;if(U.isFunction(C)&&(D=function(){C(T)}),U.isFunction(x)&&(M=function(q,re){x(q,re,T)}),!pn.checkProductKey(A,{Core:!0}))return U.isFunction(M)&&M(A._errorCode,A._errorString),!1;for(var B=0,H=0;H<XA.length;H++){var Y=["__",XA[H]].join("");U.isFunction(A[Y])&&(B|=1<<H)}if(T.EnableEvents=B,T.scanner){var G=T.scanner;U.isString(G)||U.isString(G.strDevice)&&(T.device=G.strDevice,delete T.scanner)}return w=["[",U.stringify(T),"]"].join(""),A.__bAcquireImageNow=!0,A.__innerAcquireOrLoadImageAsync("StartScan",w,!1,!0).then(D,function(q){A._errorCode=q.code,A._errorString=q.message,U.isFunction(M)&&M(q.code,q.message)}),!0}function gd(y,C,x){var w=this;return w._innerFunRaw("RemoveImage",It(y),!0,!1,!0,function(){w._OnBitmapChanged(["c1",""+y,3,w._ImgManager.getCurrentImageIndex(),w._ImgManager.count()]),U.isFunction(C)&&C()},x)}function zW(y){var C=this;C.IfShowCancelDialogWhenImageTransfer?(ge.progressContext&&ge.progressContext.on("cancel",function(){lu(C),y()}),zp(!0)):zp(!1)}var _C={TRANS_SERVICE_ERROR_404:12,TRANS_SERVICE_ERROR_500:13,TRANS_SERVICE_ERROR_503:14},cqe=function y(C,x){if(!U.isUndefined(C)&&!U.isUndefined(x)&&null!=C&&null!=x){for(var w in x)C.hasOwnProperty(w)?"object"===p(C[w])&&y(C[w],x[w]):C[w]=x[w];return C}};function uqe(y){return YW.apply(this,arguments)}function YW(){return YW=yt(W.mark(function y(C){var x,w,T,D,M,B,H,Y;return W.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(D=null===(x=C.container)||void 0===x?void 0:x.id,M=window,!(w=Ce.DWT.GetWebTwain(C.id))&&D&&(T=Ce.DWT.GetWebTwain(D)),!w&&!T){G.next=8;break}throw B={},w?xle(B):wle(B),{code:B._errorCode,message:B._errorString};case 8:return Ce.DWT.UseDefaultViewer||(C.container=null),C.bNoViewer=!((q=C.container)&&!U.isString(q)?Lt:vt),G.prev=10,G.next=13,Qfe.create(C);case 13:H=G.sent,G.next=22;break;case 16:throw G.prev=16,G.t0=G.catch(10),(Y=G.t0&&G.t0.code)==Xn.ResponseDataTypeError||Y==Xn.HTSTError||Y==Xn.CORSError||Y==Xn.CORSErrorFromService||Y==Xn.SSLCertExpired||Y==Xn.SSLCertInvalid||(Y==Xn.MustUpgrade?Xp(!0):Y==Xn.ModuleNotExists&&hqe(H)),H&&H.dispose(),G.t0;case 22:return G.prev=22,M.DCP_DWT_OnClickCloseInstall&&M.DCP_DWT_OnClickCloseInstall(!1,!0),G.finish(22);case 25:return tpe(H),G.abrupt("return",H);case 27:case"end":return G.stop()}var q},y,null,[[10,16,22,25]])})),YW.apply(this,arguments)}function dqe(y,C){if(U.isFunction(Ce.OnWebTwainNeedUpgradeCallback)){var x,w,T={};if(w=Hl.getDSPath(),de.bWin)x=Rn.enumWindow;else if(Ce.navInfo.bEmbed||de.bAndroid||de.bChromeOS||de.bHarmonyOS||de.biPhone||de.biPad)de.bAndroid?x=Rn.enumAndroid:(T.deb=w,x=de.biPhone||de.biPad?Rn.enumiOS:de.bChromeOS?Rn.enumChromeOS:de.bHarmonyOS?Rn.enumHarmonyOS:Rn.enumEmbed);else if(de.bLinux){var A=Hl.getLinuxHTML5DebPath(),D=Hl.getLinuxHTML5RpmPath();w=A,T.deb=A,T.rpm=D,x=Rn.enumLinux}else x=Rn.enumMac;T.default=w;var M=ft.one(".dynamsoft-dialog-license");M&&M.getEL()&&(M.getEL().style.display="none"),ge.detect.needUpgrade=Lt,Ce.OnWebTwainNeedUpgradeCallback(St.name,T,St.bHTML5Edition,x,de.bIE,de.bSafari,ge.detect.ssl,Po.strIEVersion,ge.detect.bPromptJSOrServerOutdated,y,C)}}function tpe(y){return XW.apply(this,arguments)}function XW(){return XW=yt(W.mark(function y(C){var x,T;return W.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(C&&!C._blts){A.next=2;break}return A.abrupt("return");case 2:if(-2207==C.ErrorCode&&(ge.detect.bPromptJSOrServerOutdated=Lt,U.isFunction(Ce.DWT.OnWebTwainNeedUpgradeWebJavascript)&&Ce.DWT.OnWebTwainNeedUpgradeWebJavascript(C.ErrorString)),!xo.versionInfoFromServer){A.next=7;break}x=xo.versionInfoFromServer,A.next=10;break;case 7:return A.next=9,C._getVersionInfoAsync();case 9:x=A.sent;case 10:if(ge.detect.bNeedUpgradeEvent||Dje(x)){A.next=19;break}if(ge.detect.bNeedUpgradeEvent=Lt,!U.isFunction(Ce.DWT.OnWebTwainNeedUpgrade)){A.next=15;break}if(!Ce.DWT.OnWebTwainNeedUpgrade()){A.next=15;break}return A.abrupt("return");case 15:if(!C._bRemoteMode){A.next=18;break}return U.isFunction(Ce.OnRemoteWebTwainNeedUpgradeCallback)&&Ce.OnRemoteWebTwainNeedUpgradeCallback(St.name,C._serverInfo.server,C._serverInfo.port,C._serverInfo.ssl),A.abrupt("return");case 18:(St.bHTML5Edition&&C._isBindViewer()||!St.bHTML5Edition)&&((T=C._containerElement)&&(ft.one(T).before(ge.install._strNonInstallDIV),U.show(ge.install._divDWTNonInstallContainerID)),""!=ge.install._divDWTemessageContainer&&U.hide(ge.install._divDWTemessageContainer),dqe());case 19:case"end":return A.stop()}},y)})),XW.apply(this,arguments)}function hqe(y){if(!ge.detect.bNoControlEvent){var C,x=0,w=0;y&&(x=y._width,w=y._height,C=y._containerElement),y&&y._bRemoteMode?y._bNotShowMessage||U.isFunction(Ce.OnRemoteWebTwainNotFoundCallback)&&Ce.OnRemoteWebTwainNotFoundCallback(St.name,y._serverInfo.server,y._serverInfo.port,y._serverInfo.ssl,Po.bMobile):(bfe(C,x,w),Xp(!1)),ge.detect.bNoControlEvent=!0}}var $p=function(y){function C(q){var re,ce,ve;l(this,C),ve=[q],ce=qn(ce=C),(re=$a(this,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Ue){return!1}}()?Reflect.construct(ce,ve||[],qn(this).constructor):ce.apply(this,ve)))._bServerPercentDone=!0,re._bScanForProxyRemote=Lt;var Te=Yl.getServerImageUrlPrefix(re);return gC._setBaseUrl(re._imageBufferWrapper,Te),re}return qa(C,y),g(C,[{key:"getDevices",value:function(q,re,se){return this._getDevices(q,re,se)}},{key:"_connnect",value:(G=yt(W.mark(function q(){var re;return W.wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return re=this,se.abrupt("return",new ge.Promise(function(ce,ve){G$e(re._serverInfo.server,re._serverInfo.port,void 0,function(Te,Ue,je){re._strRemoteServiceVer=je,ce()},ve)}));case 2:case"end":return se.stop()}},q,this)})),function(){return G.apply(this,arguments)})},{key:"acquireImage",value:function(q,re){return fa(qn(C.prototype),"_acquireImage",this).call(this,q,re)}},{key:"_acquireImageForSendTo",value:function(q,re,se,ce){return fa(qn(C.prototype),"_acquireImageForSendTo",this).call(this,q,re,se,ce)}},{key:"getCapabilities",value:function(q,re,se){return this._getCapabilities(q,re,se)}},{key:"setCapabilities",value:function(q,re,se){return this._setCapabilities(q,re,se)}},{key:"closeSource",value:function(){return this._closeSource()}},{key:"setBufferMemoryLimit",value:(Y=yt(W.mark(function q(re){var se;return W.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(se=this,U.isNumber(re)&&!isNaN(re)){ve.next=4;break}throw da(se),{code:se._errorCode,message:se._errorString};case 4:if(se._resetErr(),se._isValid()){ve.next=7;break}throw{code:se._errorCode,message:se._errorString};case 7:return ve.next=9,se._innerFunV2("BufferMemoryLimit",It(re));case 9:return ve.abrupt("return",ve.sent);case 11:case"end":return ve.stop()}},q,this)})),function(q){return Y.apply(this,arguments)})},{key:"setIfAllowLocalCache",value:(H=yt(W.mark(function q(re){var se;return W.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(se=this,U.isBoolean(re)){ve.next=4;break}throw da(self),{code:se._errorCode,message:se._errorString};case 4:if(se._resetErr(),se._isValid()){ve.next=7;break}throw{code:se._errorCode,message:se._errorString};case 7:return ve.next=9,se._innerFunV2("IfAllowLocalCache",It(re));case 9:return ve.abrupt("return",ve.sent);case 11:case"end":return ve.stop()}},q,this)})),function(q){return H.apply(this,arguments)})},{key:"howManyImagesInBuffer",get:function(){return this._imageBufferWrapper.count()}},{key:"currentImageIndexInBuffer",get:function(){return this._imageBufferWrapper.getCurrentImageIndex()},set:function(q){this._imageBufferWrapper.setCurrentImageIndex(q)}},{key:"saveImages",value:(B=yt(W.mark(function q(re,se,ce,ve){var Te;return W.wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:if(Te="saveImages",this._checkIndices(se)){Ue.next=3;break}throw{code:this._errorCode,message:this._getErrorString()};case 3:return this._containerElement=ve,Ue.next=6,this._saveImages(Te,re,se,ce);case 6:case"end":return Ue.stop()}},q,this)})),function(q,re,se,ce){return B.apply(this,arguments)})},{key:"getImages",value:function(q,re,se,ce){if(!this._checkIndices(q))throw{code:this._errorCode,message:this._getErrorString()};return this._containerElement=ce,this._getImages("getImages",q,re,se)}},{key:"removeImages",value:(M=yt(W.mark(function q(re){var se,ce,ve,Ue;return W.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:if(this._checkIndices(re)){je.next=2;break}throw{code:this._errorCode,message:this._getErrorString()};case 2:for(se=re.sort(function(Ee,Oe){return Oe-Ee}),ce=[],ve=0;ve<se.length;ve++)(Ue=this._imageBufferWrapper.convertClientIndexToServerId(se[ve]))>0&&ce.push(Ue);if(0!=ce.length){je.next=7;break}return je.abrupt("return");case 7:return je.next=9,this._innerFunV2("RemoveAllImages",It(ce.join(",")));case 9:if(!je.sent&&-1033!=this._errorCode){je.next=16;break}if(this._imageBufferWrapper.removeImages(se)){je.next=14;break}throw this._imageBufferWrapper.getError();case 14:je.next=17;break;case 16:throw{code:this._errorCode,message:this._errorString};case 17:case"end":return je.stop()}},q,this)})),function(q){return M.apply(this,arguments)})},{key:"updateImage",value:function(q,re,se){var ce=this._imageBufferWrapper.getIndexByUid(q),ve=this._imageBufferWrapper.convertClientIndexToServerId(ce);return fa(qn(C.prototype),"_updateImage",this).call(this,ve,re,se)}},{key:"getSkewAngleFromBinaryAsync",value:function(q,re,se,ce){if(this._resetErr(),!this._isValid())return ge.Promise.reject({code:this._errorCode,message:this._errorString});var Te=this._imageBufferWrapper.getCustomDataByIndex(q),Ue=this._imageBufferWrapper.getMetadataByIndex(q),je=this._imageBufferWrapper.convertClientIndexToServerId(q),Oe=U.stringify([U.stringify({imageId:je,serverId:je,bufferLen:re.size,imageType:Ti.IT_BMP,width:Ue.width,height:Ue.height,bit:Ue.bitDepth,xres:Ue.resolutionX,yres:Ue.resolutionY,uidFromServer:Te.uidFromServer})]);return this._innerSendBlob("GetSkewAngleFromBinary",Oe,re,!0,!0,se,ce)}},{key:"httpUpload",value:(D=yt(W.mark(function q(re,se,ce,ve,Te,Ue,je){var Ee,Oe;return W.wrap(function(He){for(;;)switch(He.prev=He.next){case 0:if((Ee=this)._resetErr(),Ee._isValid()){He.next=4;break}throw{code:Ee._errorCode,message:Ee._errorString};case 4:if(!U.isUndefined(re)&&""!==re){He.next=9;break}throw _l(Ee),{code:Ee._errorCode,message:Ee._errorString};case 9:if(U.isString(re)){He.next=12;break}throw CS(Ee),{code:Ee._errorCode,message:Ee._errorString};case 12:if(Ee._checkIndices(se)){He.next=14;break}throw{code:Ee._errorCode,message:Ee._errorString};case 14:if(0!=(Oe=_m(Ee,se)).length){He.next=18;break}throw Jn(Ee),{code:Ee._errorCode,message:Ee._errorString};case 18:if(!U.isUndefined(ce)){He.next=21;break}throw Gl(Ee),{code:Ee._errorCode,message:Ee._errorString};case 21:if(ce!=Ce.DWT.EnumDWT_ImageType.IT_BMP&&ce!=Ce.DWT.EnumDWT_ImageType.IT_JPG&&ce!=Ce.DWT.EnumDWT_ImageType.IT_PNG){He.next=27;break}if(!(Oe.length>1)){He.next=25;break}throw z1(Ee),{code:Ee._errorCode,message:Ee._errorString};case 25:He.next=32;break;case 27:if(ce!=Ce.DWT.EnumDWT_ImageType.IT_TIF&&ce!=Ce.DWT.EnumDWT_ImageType.IT_PDF){He.next=30;break}He.next=32;break;case 30:throw Gl(Ee),{code:Ee._errorCode,message:Ee._errorString};case 32:if(!(U.isUndefined(ve)||ve!=Ce.DWT.EnumDWT_UploadDataFormat.Binary&&ve!=Ce.DWT.EnumDWT_UploadDataFormat.Base64)){He.next=35;break}throw ule(Ee),{code:Ee._errorCode,message:Ee._errorString};case 35:return He.next=37,new ge.Promise(function(we,ue){var pe,ye,me=parseInt(ce),Se=parseInt(ve);null!=Ue&&Ue.formFields&&(pe=new FormData,U.each(null==Ue?void 0:Ue.formFields,function(We,ze){var Be=We.name,$e=We.value;U.isString(Be)&&($e instanceof Blob?pe.append(Be,$e,We.fileName):pe.append(Be,$e))})),null!=Ue&&Ue.headers&&(ye={},U.each(null==Ue?void 0:Ue.headers,function(We,ze){U.isString(We.name)&&(ye[We.name]=We.value)})),Ee._containerElement=je,C._innerHTTPUpload(Ee,"httpUpload",re,null==Ue?void 0:Ue.responseType,ye,pe,Oe,me,Se,Te,void 0,0,!1,void 0,function(We){if(U.isFunction(we)){var ze=[];U.isArray(Oe)&&U.each(Oe,function(Be){var $e=Ee._imageBufferWrapper.convertServerIdToClientIndex(Be);$e>-1&&ze.push($e)});try{bs(we,We,ze)}catch(Be){}}return We=null,!0},function(We){if(U.isFunction(ue))try{ue(We)}catch(ze){}return!1})});case 37:return He.abrupt("return",He.sent);case 38:case"end":return He.stop()}},q,this)})),function(q,re,se,ce,ve,Te,Ue){return D.apply(this,arguments)})},{key:"getCustomDataByIndex",value:function(q){return this._imageBufferWrapper.getCustomDataByIndex(q)}},{key:"getIndexByUid",value:function(q){return this._imageBufferWrapper.getIndexByUid(q)}},{key:"getProfile",value:function(q){return fa(qn(C.prototype),"_getProfile",this).call(this,q)}},{key:"setProfile",value:function(q,re){return fa(qn(C.prototype),"_setProfile",this).call(this,q,re)}},{key:"imageIDToIndex",value:function(q){return this._uidFromServer2index(q)}},{key:"indexToImageID",value:function(q){return this._index2uidFromServer(q)}},{key:"rotate",value:function(q,re,se,ce){var ve=this;if(ve._resetErr(),!ve._isValid())return ge.Promise.reject({code:ve._errorCode,message:ve._errorString});var Te=parseInt(q);if(isNaN(Te))return Jn(ve),ge.Promise.reject({code:ve._errorCode,message:ve._errorString});if(Te<0||Te>=ve.howManyImagesInBuffer)return kt(ve),ge.Promise.reject({code:ve._errorCode,message:ve._errorString});var Ue=ve._imageBufferWrapper.convertClientIndexToServerId(Te);return-1==Ue?(kt(ve),ge.Promise.reject({code:ve._errorCode,message:ve._errorString})):ve._innerFunV2("RotateEx",It(Ue,re,se,ce),!0).then(function(je){})}},{key:"crop",value:function(q,re){var se=this;if(se._resetErr(),!se._isValid())return ge.Promise.reject({code:se._errorCode,message:se._errorString});var ce=parseInt(q);if(isNaN(ce))return Jn(se),ge.Promise.reject({code:se._errorCode,message:se._errorString});if(ce<0||ce>=se.howManyImagesInBuffer)return kt(se),ge.Promise.reject({code:se._errorCode,message:se._errorString});var ve=se._imageBufferWrapper.convertClientIndexToServerId(ce);return-1==ve?(kt(se),ge.Promise.reject({code:se._errorCode,message:se._errorString})):se._innerFunV2("Crop",It(ve,re.x,re.y,re.x+re.width,re.y+re.height),!0).then(function(Oe){})}},{key:"_createHttpUploaderConfig",value:function(){var q=this,re=new Uhe;return re.IfShowProgressBar=q.IfShowProgressBar,re.IfShowCancelDialogWhenImageTransfer=q.IfShowCancelDialogWhenImageTransfer,re.MaxUploadImageSize=q.MaxUploadImageSize,re.HTTPRequestswithCredentials=q.HTTPRequestswithCredentials,re.onPercent=function(se){q._OnPercentDone(se)},re.onHttpUploadStatus=function(se){},re}},{key:"_OnReady",value:(A=yt(W.mark(function q(){var re,se,ce;return W.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return mc((re=this)._serverInfo.server)&&(sd.item("DWT_port",re._serverInfo.port),sd.item("DWT_ssl",re._serverInfo.ssl?"true":"false")),re._bNoMask||Bo("OnReady",re),ve.prev=3,ve.next=6,fa(qn(C.prototype),"_OnReady",this).call(this);case 6:return ve.next=8,re._innerActiveUI(re._uuidForActiveUI);case 8:return se=ve.sent,ve.next=11,re._OnActiveUI(se);case 11:(ce=re._id)&&!Ce.DWT.WebTwainIdMap[ce]&&(Ce.DWT.WebTwainIdMap[ce]=re),ve.next=20;break;case 15:throw ve.prev=15,ve.t0=ve.catch(3),ve.t0&&(re._errorCode=ve.t0.code,re._errorString=ve.t0.message),re.dispose(),ve.t0;case 20:return ve.prev=20,re._bNoMask||Gr("OnReady"),ve.finish(20);case 23:case"end":return ve.stop()}},q,this,[[3,15,20,23]])})),function(){return A.apply(this,arguments)})},{key:"_isBindViewer",value:function(){return this._bBindViewer}},{key:"_isNoViewer",value:function(){return!this._isBindViewer()}},{key:"getServiceInfo",value:function(){return fa(qn(C.prototype),"getServiceInfo",this).call(this)}},{key:"setViewerInfo",value:function(q){this._bBindViewer=q}},{key:"setViewerControlInfo",value:function(q){this._controlWidth=q.width,this._controlHeight=q.height}}],[{key:"create",value:(T=yt(W.mark(function q(re){var se;return W.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return se=new C(re),ce.next=3,Yl.STwainConnectToServer(se);case 3:return ce.abrupt("return",se);case 4:case"end":return ce.stop()}},q)})),function(q){return T.apply(this,arguments)})},{key:"_getBuffer",value:function(q){return gC._getBuffer(q._imageBufferWrapper)}},{key:"_setError",value:function(q,re,se){q._errorCode=re,q._errorString=se}},{key:"createByServiceInfo",value:(w=yt(W.mark(function q(re,se,ce){var ve,Te,Ue;return W.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:return Te={id:U.guid(),dmService:se,bNoViewer:!0,bNoMask:null==se||null===(ve=se.attrs)||void 0===ve?void 0:ve.bNoMask,bNotShowMessage:!0},(Ue=new C(Te))._uuidForActiveUI=re,Ue._bLicenseErrorDispose=!1,ce&&(Ue._containerElement=ce),je.next=7,Ue._connnect();case 7:return je.next=9,Yl.STwainConnectToServer(Ue);case 9:return je.abrupt("return",Ue);case 10:case"end":return je.stop()}},q)})),function(q,re,se){return w.apply(this,arguments)})},{key:"checkOnlineByServiceInfo",value:(x=yt(W.mark(function q(re){var se,ce;return W.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return se={id:U.guid(),dmService:re,bNoViewer:!0,bNoMask:!0,bNotShowMessage:!0},ve.prev=1,ce=new C(se),ve.next=5,ce._connnect();case 5:return ce._bReady=!0,ce._wsClient||(ce._wsClient=new J7(null)),ce.dispose(),ve.abrupt("return",!0);case 11:return ve.prev=11,ve.t0=ve.catch(1),U.warn(ve.t0),ve.abrupt("return",!1);case 15:case"end":return ve.stop()}},q,null,[[1,11]])})),function(q){return x.apply(this,arguments)})},{key:"_isReady",value:function(q){return q._bReady}},{key:"_innerHTTPUpload",value:function(q,re,se,ce,ve,Te,Ue,je,Ee,Oe,He,we,ue,pe,ye,me){var Se=Oe,We=se;if(U.isUndefined(je))return Gl(q),void(U.isFunction(me)&&me({code:q._errorCode,message:q._errorString}));ge.cancelFrom=Zn.HTTPUpload;var ze,Be=function(Ge,_t,Ct){ge.needShowTwiceShowDialog=!1,q.IfShowProgressBar&&ge.closeProgress(null,re),U.isFunction(me)&&me({code:Ge,message:_t,response:Ct})},$e=q._createHttpUploaderConfig();if($e.objUploadStatus=pe,Se=bP(Se,je),ge.needShowTwiceShowDialog=!0,q.IfShowProgressBar?(ge.showProgress(q,re,!1),ge.progressContext&&(ge.progressContext._onPercent=function(Ge){var _t=0;Ge&&(_t=Math.floor(Ge.loaded/Ge.total*100))>100&&(_t=100),ge.progressBarOnPercentDone(-1,"Transferring...","",_t,"")})):ge.hideProgress(),Ee==Ce.DWT.EnumDWT_UploadDataFormat.Binary){if(pe&&pe.bCancel)return pe.st=2,lu(q),void Be(q._errorCode,q._errorString);$e.onPercent([0,-1,Lr.Encoding,"http"]),q._convertToBlobForUpload(je,Ue,He,4,function(Ge,_t,Ct){if(ze=function(bt){return ge.needShowTwiceShowDialog=!1,q.IfShowProgressBar&&ge.closeProgress(null,re),U.isFunction(ye)&&bs(ye,bt),bt=null,!0},pe&&pe.bCancel)return pe.st=2,lu(q),Be(q._errorCode,q._errorString);if(!Ge||Ge.size<=0)return ns(q),Be(q._errorCode,q._errorString);var Ut=q.__maxUploadImageSize;if(Ge.size>Ut&&-1!=Ut)return ff(q),Be(q._errorCode,q._errorString);if(0!=q._errorCode)return Be(q._errorCode,q._errorString);Ce.DWT.IfAddMD5InUploadHeader&&_t&&""!=_t&&(ve["dwt-md5"]=_t);var Tn=new xf,mn=new fd;mn.url=We,mn.method=re,mn.content=Ge,Ge=null,mn.contentType=q._strHttpContentTypeFieldValue,mn.headers=ve,mn.fileName=Se,mn.httpFormData=Te,mn.retry=we,mn.bOnlyResponseEmptyIsOK=ue,mn.responseType=ce,$e.objUploadStatus=pe,Tn.httpPostUpload($e,mn,ze,Be)},Be)}else Ee==Ce.DWT.EnumDWT_UploadDataFormat.Base64&&q._convertToBase64ByServerIdsWithUI(re,Ue,je,He,4,function(Ge){var _t,Ct;if(!Ge||Ge.getLength()<=0||(ze=function(Tn){return ge.needShowTwiceShowDialog=!1,q.IfShowProgressBar&&ge.closeProgress(null,re),U.isFunction(ye)&&bs(ye,Tn),!0},_t=Ge.getMD5(),Ce.DWT.IfAddMD5InUploadHeader&&(ve["dwt-md5"]=_t),!(Ct=Ge.getData(0,Ge.getLength()))||""==Ct))return ns(q),Be(q._errorCode,q._errorString);var Ut=new fd;Ut.url=We,Ut.method=re,Ut.content=Ct,Ct=null,Ut.headers=ve,Ut.fileName=Se,Ut.httpFormData=Te,Ut.retry=we,Ut.bOnlyResponseEmptyIsOK=ue,Ut.responseType=ce,(new xf).httpPostUpload($e,Ut,ze,Be)},Be)}}]);var x,w,T,A,D,M,B,H,Y,G}(Vhe),$W=lr,fqe=function(){return g(function ue(pe){var ye=this;l(this,ue),this._serverUrl=pe,this._defaultDSScanClient=null,this._dsScanClientsMap={},this._serviceInfos=null,this._id=U.guid(),this.onBufferChanged=null,this.onPostTransferAsync=null,this._errorCode=0,this._errorString="",this._bDispose=!1,this._needSetLogLevel=!1,this._logLevel=-1,this._showProgressBar=!0,this._checkServerUrl(),this._id&&!Ce.DWT.RemoteScanIdMap[this._id]&&(Ce.DWT.RemoteScanIdMap[this._id]=this),this._uuidForRemoteScanObject="",ge.dlgProgress||ge.initProgress(null),this._viewer=Ce.DWT.UseDefaultViewer?new Ce.DWTViewerEx(null,{viewerEvents:{bufferChanged:function(Se,We){ye.__bufferChanged(ye,Se,We)},save:function(Se,We,ze,Be){return ye.__save(Se,We,ze,Be)},rotate:function(Se,We,ze){return ye.__rotate(Se,We,ze)},crop:function(Se,We,ze,Be,$e){return ye.__crop(Se,{x:We,y:ze,width:Be,height:$e})}},viewerError:{setError:function(Se,We){ye._defaultDSScanClient?$p._setError(ye._defaultDSScanClient,Se,We):0==Se&&""==We||(ye._errorCode=Se,ye._errorString=We)}},imageEditorEvents:{deskew:function(Se,We){ye.__deskew(ye,Se,We)},removeImage:function(){ye.__remove(ye)},removeAllImage:function(){ye.__removeAll(ye)},close:function(){ye.__close(ye)}},imageEditorUiConfig:{buttons:{visibility:{scan:!1,load:!1}}},beforeImageEditorCreated:function(Se){ye.__beforeImageEditorCreated(Se)}}):null},[{key:"Viewer",get:function(){return this._viewer}},{key:"_disposeDSClientByKey",value:(we=yt(W.mark(function ue(pe){var ye;return W.wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(!(ye=this._dsScanClientsMap[pe])){me.next=10;break}if(ye.isDestroy){me.next=9;break}if(!ye.__unload){me.next=8;break}return me.next=6,ye.__unload();case 6:me.next=9;break;case 8:ye.dispose();case 9:delete this._dsScanClientsMap[pe];case 10:case"end":return me.stop()}},ue,this)})),function(ue){return we.apply(this,arguments)})},{key:"_checkServerUrl",value:function(){var ue=this._serverUrl;if(ue&&U.isString(ue)&&U.startsWith(location.href,"https://")&&U.startsWith(ue,"http://")){var pe={};throw wt(pe,-2436,'Mixed Content: The page at "'+location.href+'" was loaded over HTTPS, but requested an insecure resource "'+ue+'/ddm/18625/ddm/SearchScanner". This request has been blocked; the content must be served over HTTPS.'),Qi(pe)}if(!U.isString(ue)||""==ue){var ye={};throw wt(ye,-2545,"The  proxy server URL is invalid."),Qi(ye)}}},{key:"getDynamsoftService",value:(He=yt(W.mark(function ue(pe){var ye,me,Se,We,ze,Be,$e,Ge,_t,Ct,Ut,Tn,mn,bt,At,Tt,Bt,Qt,yn;return W.wrap(function(un){for(;;)switch(un.prev=un.next){case 0:if(!this._bDispose){un.next=4;break}throw vc(ye={}),Qi(ye);case 4:if(me=this._serverUrl,this._checkServerUrl(),Se=new OP(me,!0),Bo("getDynamsoftService",this.getViewerElement()),un.prev=8,!pe&&this._serviceInfos){un.next=68;break}if(We=null,ze=this._serviceInfos,this._serviceInfos=[],Be="",$e="",!Xa()){un.next=30;break}return un.next=16,this._setRemoteUuid();case 16:return un.prev=16,un.next=19,HA(Ce.DWT.EnumInstance.dwt_desktop,"");case 19:(Ge=un.sent)&&(Be=Ge.ar,$e=this._uuidForRemoteScanObject),un.next=28;break;case 23:throw un.prev=23,un.t0=un.catch(16),sue(_t={},un.t0),{code:_t._errorCode,message:_t._errorString};case 28:un.next=31;break;case 30:Be=St.refProductKey;case 31:return un.next=33,Se.getDynamsoftService(Be,$e,pe);case 33:if(!(We=un.sent)){un.next=68;break}Ut=[],Ct=0;case 37:if(!(Ct<We.length)){un.next=65;break}return bt=DB(We[Ct]),At=null!==(Tn=null==bt||null===(mn=bt.attrs)||void 0===mn?void 0:mn.ty)&&void 0!==Tn?Tn:"",un.next=42,$p.checkOnlineByServiceInfo(bt);case 42:if(!un.sent){un.next=60;break}if(bt.attrs=bt.attrs||{},bt.attrs.bNoMask=!0,bt.attrs.bNotShowMessage=!0,!ze){un.next=57;break}Tt=void 0,Tt=0;case 50:if(!(Tt<ze.length)){un.next=57;break}if(!this.isSameService(bt,ze[Tt])){un.next=54;break}return ze.splice(Tt,1),un.abrupt("break",57);case 54:Tt++,un.next=50;break;case 57:this._serviceInfos.push(bt),un.next=61;break;case 60:At+="(x)";case 61:Ut.push(At);case 62:Ct++,un.next=37;break;case 65:if(U.log("Find Dynamsoft Services:"),U.log(Ut.join(", ")),ze)for(Bt=0;Bt<ze.length;Bt++)(yn=null===(Qt=ze[Bt])||void 0===Qt||null===(Qt=Qt.attrs)||void 0===Qt?void 0:Qt.UUID)&&this._disposeDSClientByKey(yn);case 68:this._needSetLogLevel&&-1!=this._logLevel&&this.setLogLevel(this._logLevel),un.next=74;break;case 71:throw un.prev=71,un.t1=un.catch(8),un.t1;case 74:un.prev=74,Gr("getDynamsoftService");try{Se._bInited&&Se.dispose()}catch(Ir){}return un.finish(74);case 78:return un.abrupt("return",this._serviceInfos);case 79:case"end":return un.stop()}},ue,this,[[8,71,74,78],[16,23]])})),function(ue){return He.apply(this,arguments)})},{key:"getDefaultDynamsoftService",value:function(){if(this._bDispose){var ue={};throw vc(ue),Qi(ue)}return this._defaultDSScanClient?this._defaultDSScanClient.getServiceInfo():null}},{key:"setDefaultDynamsoftService",value:(Oe=yt(W.mark(function ue(pe){var ye,me,Se,We;return W.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(!this._bDispose){ze.next=4;break}throw vc(ye={}),Qi(ye);case 4:if(null!==pe){ze.next=7;break}return this._defaultDSScanClient=null,ze.abrupt("return");case 7:if(pe&&pe instanceof EB){ze.next=11;break}throw Wi(me={}),{code:me._errorCode,message:me._errorString};case 11:return Se=this.getViewerElement(),ze.next=14,this._createDSClientByServiceInfo(pe,!0,Se._containerElement);case 14:if(!(We=ze.sent)){ze.next=18;break}return ze.next=18,this._innerSetDefault(We);case 18:case"end":return ze.stop()}},ue,this)})),function(ue){return Oe.apply(this,arguments)})},{key:"_innerSetDefault",value:(Ee=yt(W.mark(function ue(pe){var ye,me,Se;return W.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if(!pe){We.next=11;break}if($p._isReady(pe)){We.next=5;break}throw Se=null!==(ye=null===(me=pe.getServiceInfo())||void 0===me||null===(me=me.attrs)||void 0===me?void 0:me.name)&&void 0!==ye?ye:"",f0(pe,Se),{code:pe._getErrorCode(),message:pe._getErrorString()};case 5:this._defaultDSScanClient=pe,this._defaultDSScanClient.IfShowProgressBar=this._showProgressBar,this.Viewer&&this.Viewer.webViewer&&this.Viewer.webViewer.bindViewUI&&this._defaultDSScanClient.setViewerInfo(this.Viewer.webViewer.bindViewUI),this.__setViewerControlInfo(),this._registEventToDefaultDS(),this._viewer&&this._viewer.webViewer.setBufferService($p._getBuffer(this._defaultDSScanClient));case 11:case"end":return We.stop()}},ue,this)})),function(ue){return Ee.apply(this,arguments)})},{key:"__setViewerControlInfo",value:function(){this.Viewer.webViewer.bindViewUI&&this.Viewer.width&&this.Viewer.width>0&&this.Viewer.height&&this.Viewer.height>0&&this._defaultDSScanClient.setViewerControlInfo({width:this.Viewer.width,height:this.Viewer.height})}},{key:"__beforeImageEditorCreated",value:function(ue){var pe=Ce.DWT.CustomizableDisplayInfo;if(!U.isUndefined(pe)){if(!U.isUndefined(pe.buttons)){var ye=pe.buttons.titles;U.isUndefined(ye)||(U.isUndefined(ye.previous)||(ue.buttons.titles.previous=ye.previous),U.isUndefined(ye.next)||(ue.buttons.titles.next=ye.next),U.isUndefined(ye.print)||(ue.buttons.titles.print=ye.print),U.isUndefined(ye.scan)||(ue.buttons.titles.scan=ye.scan),U.isUndefined(ye.load)||(ue.buttons.titles.load=ye.load),U.isUndefined(ye.rotateleft)||(ue.buttons.titles.rotateleft=ye.rotateleft),U.isUndefined(ye.rotate)||(ue.buttons.titles.rotate=ye.rotate),U.isUndefined(ye.rotateright)||(ue.buttons.titles.rotateright=ye.rotateright),U.isUndefined(ye.deskew)||(ue.buttons.titles.deskew=ye.deskew),U.isUndefined(ye.crop)||(ue.buttons.titles.crop=ye.crop),U.isUndefined(ye.cut)||(ue.buttons.titles.cut=ye.cut),U.isUndefined(ye.changeimagesize)||(ue.buttons.titles.changeimagesize=ye.changeimagesize),U.isUndefined(ye.flip)||(ue.buttons.titles.flip=ye.flip),U.isUndefined(ye.mirror)||(ue.buttons.titles.mirror=ye.mirror),U.isUndefined(ye.zoomin)||(ue.buttons.titles.zoomin=ye.zoomin),U.isUndefined(ye.originalsize)||(ue.buttons.titles.originalsize=ye.originalsize),U.isUndefined(ye.zoomout)||(ue.buttons.titles.zoomout=ye.zoomout),U.isUndefined(ye.stretch)||(ue.buttons.titles.stretch=ye.stretch),U.isUndefined(ye.fit)||(ue.buttons.titles.fit=ye.fit),U.isUndefined(ye.fitw)||(ue.buttons.titles.fitw=ye.fitw),U.isUndefined(ye.fith)||(ue.buttons.titles.fith=ye.fith),U.isUndefined(ye.hand)||(ue.buttons.titles.hand=ye.hand),U.isUndefined(ye.rectselect)||(ue.buttons.titles.rectselect=ye.rectselect),U.isUndefined(ye.zoom)||(ue.buttons.titles.zoom=ye.zoom),U.isUndefined(ye.restore)||(ue.buttons.titles.restore=ye.restore),U.isUndefined(ye.save)||(ue.buttons.titles.save=ye.save),U.isUndefined(ye.close)||(ue.buttons.titles.close=ye.close),U.isUndefined(ye.removeall)||(ue.buttons.titles.removeall=ye.removeall),U.isUndefined(ye.removeselected)||(ue.buttons.titles.removeselected=ye.removeselected));var me=pe.buttons.bShowAllButtons;U.isUndefined(me)||(ue.buttons.bShowAllButtons=me);var Se=pe.buttons.visibility;U.isUndefined(Se)||(U.isUndefined(Se.scan)||(ue.buttons.visibility.scan=Se.scan),U.isUndefined(Se.load)||(ue.buttons.visibility.load=Se.load),U.isUndefined(Se.print)||(ue.buttons.visibility.print=Se.print),U.isUndefined(Se.removeall)||(ue.buttons.visibility.removeall=Se.removeall),U.isUndefined(Se.removeselected)||(ue.buttons.visibility.removeselected=Se.removeselected),U.isUndefined(Se.rotateleft)||(ue.buttons.visibility.rotateleft=Se.rotateleft),U.isUndefined(Se.rotate)||(ue.buttons.visibility.rotate=Se.rotate),U.isUndefined(Se.rotateright)||(ue.buttons.visibility.rotateright=Se.rotateright),U.isUndefined(Se.deskew)||(ue.buttons.visibility.deskew=Se.deskew),U.isUndefined(Se.crop)||(ue.buttons.visibility.crop=Se.crop),U.isUndefined(Se.cut)||(ue.buttons.visibility.cut=Se.cut),U.isUndefined(Se.changeimagesize)||(ue.buttons.visibility.changeimagesize=Se.changeimagesize),U.isUndefined(Se.flip)||(ue.buttons.visibility.flip=Se.flip),U.isUndefined(Se.mirror)||(ue.buttons.visibility.mirror=Se.mirror),U.isUndefined(Se.zoomin)||(ue.buttons.visibility.zoomin=Se.zoomin),U.isUndefined(Se.originalsize)||(ue.buttons.visibility.originalsize=Se.originalsize),U.isUndefined(Se.zoomout)||(ue.buttons.visibility.zoomout=Se.zoomout),U.isUndefined(Se.stretch)||(ue.buttons.visibility.stretch=Se.stretch),U.isUndefined(Se.fit)||(ue.buttons.visibility.fit=Se.fit),U.isUndefined(Se.fitw)||(ue.buttons.visibility.fitw=Se.fitw),U.isUndefined(Se.fith)||(ue.buttons.visibility.fith=Se.fith),U.isUndefined(Se.hand)||(ue.buttons.visibility.hand=Se.hand),U.isUndefined(Se.rectselect)||(ue.buttons.visibility.rectselect=Se.rectselect),U.isUndefined(Se.zoom)||(ue.buttons.visibility.zoom=Se.zoom))}var We=pe.dialogText;U.isUndefined(We)||(U.isUndefined(We.dlgRotateAnyAngle)||(ue.dialogText.dlgRotateAnyAngle=We.dlgRotateAnyAngle),U.isUndefined(We.dlgChangeImageSize)||(ue.dialogText.dlgChangeImageSize=We.dlgChangeImageSize),U.isUndefined(We.saveChangedImage)||(ue.dialogText.saveChangedImage=We.saveChangedImage),U.isUndefined(We.selectSource)||(ue.dialogText.selectSource=We.selectSource))}}},{key:"__bufferChanged",value:function(ue,pe,ye){var me,Se=ue,We=[],ze=-1,Be=[];pe.operation&&(pe.action=pe.operation);for(var $e=0;$e<Se.howManyImagesInBuffer;$e++)(me=Se._defaultDSScanClient.getCustomDataByIndex($e))&&me.uidFromServer&&We.push(me.uidFromServer);if(pe.imageIds=We,pe.curIndex>=0&&(me=Se._defaultDSScanClient.getCustomDataByIndex(pe.curIndex))&&me.uidFromServer&&(ze=me.uidFromServer),pe.currentId=ze,pe.afterStatus.selectedUids)for(var Ge=0;Ge<pe.afterStatus.selectedUids.length;Ge++){var _t=pe.afterStatus.selectedUids[Ge];if(_t&&-1!=_t){var Ct=Se._defaultDSScanClient.getIndexByUid(pe.afterStatus.selectedUids[Ge]);Ct>=0&&(me=Se._defaultDSScanClient.getCustomDataByIndex(Ct))&&me.serverId&&Be.push(me.uidFromServer)}}pe.selectedIds=Be,U.mix(pe,{}),delete pe.uids,delete pe.currentUid,delete pe.selectedUids,delete pe.afterStatus,delete pe.beforeStatus,delete pe.operation,delete pe.curIndex,delete pe.docUid,Se.__fireEvent("onBufferChanged",pe)}},{key:"__acquire",value:function(ue,pe){var ye=ue;ye._stwain.SelectSource(function(){ye._stwain.CloseSource(),ye._stwain.OpenSource(),ye._stwain.IfShowUI=!0,1==Ce.DWT.IfConfineMaskWithinTheViewer?(Ce.DWT.IfConfineMaskWithinTheViewer=!1,ye._stwain.AcquireImage({},function(){Ce.DWT.IfConfineMaskWithinTheViewer=!0},function(){})):ye._stwain.AcquireImage()},function(){U.log("User did not select a source")})}},{key:"__remove",value:(je=yt(W.mark(function ue(pe){var ye,me;return W.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(ye=this,!this._defaultDSScanClient){Se.next=10;break}if(is(this._defaultDSScanClient),!(ye.howManyImagesInBuffer<=0||ye.currentImageIndexInBuffer<0)){Se.next=6;break}return $W.output(ye,"No image in Buffer"),Se.abrupt("return",!0);case 6:return me=$p._getBuffer(this._defaultDSScanClient),Se.next=9,this._defaultDSScanClient.removeImages(me.getSelectedImagesIndices());case 9:return Se.abrupt("return",Se.sent);case 10:return Se.abrupt("return",!1);case 11:case"end":return Se.stop()}},ue,this)})),function(ue){return je.apply(this,arguments)})},{key:"__removeAll",value:(Ue=yt(W.mark(function ue(pe){return W.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(!this._defaultDSScanClient){ye.next=4;break}return is(this._defaultDSScanClient),ye.next=4,this._defaultDSScanClient._removeAllImagesAsync("removeAllImages",!0);case 4:return ye.abrupt("return",!1);case 5:case"end":return ye.stop()}},ue,this)})),function(ue){return Ue.apply(this,arguments)})},{key:"__save",value:(Te=yt(W.mark(function ue(pe,ye,me,Se){var We,ze,Be;return W.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(ze="save",Be=(We=this).__getViewerElementForViewer(We,Se),Bo(ze,Be),$e.prev=3,is(We._defaultDSScanClient),!(We.howManyImagesInBuffer<=0||We.currentImageIndexInBuffer<0)){$e.next=8;break}return $W.output(We,"No image in Buffer"),$e.abrupt("return");case 8:return $e.next=10,We._defaultDSScanClient.updateImage(pe,ye,me);case 10:return $e.next=13,We._defaultDSScanClient.__saveToViewerAfterUpdate(pe,me);case 13:$e.next=17;break;case 15:$e.prev=15,$e.t0=$e.catch(3);case 17:return $e.prev=17,Gr(ze),$e.finish(17);case 20:case"end":return $e.stop()}},ue,this,[[3,15,17,20]])})),function(ue,pe,ye,me){return Te.apply(this,arguments)})},{key:"__getViewerElementForViewer",value:function(ue,pe){var ye,me=ue;if(pe)if(me._viewer.webViewer.imageEditor){var Se=me._viewer.createImageEditor();ye="dwt-viewer-imageEditor-fullScreen"==Se.inner.containerElement.className?{_containerElement:document.body}:{_containerElement:Se.inner.containerElement}}else ye=me.getViewerElement();else ye=me.getViewerElement();return ye}},{key:"__close",value:function(ue){var pe=ue;if(U.isFunction(pe.__CloseImageEditorUI))try{pe.__CloseImageEditorUI()}catch(ye){Fr(ye)}}},{key:"__deskew",value:function(ue,pe,ye){var me=this,Se="deskew";if(is(me._defaultDSScanClient),me.howManyImagesInBuffer<=0||me.currentImageIndexInBuffer<0)$W.output(me,"No image in Buffer");else{var We=me.__getViewerElementForViewer(me,!0);Bo(Se,We),me._defaultDSScanClient.getSkewAngleFromBinaryAsync(me.currentImageIndexInBuffer,pe,function(ze){ye(ze[0]),Gr(Se)},function(){Gr(Se)})}}},{key:"__rotate",value:(ve=yt(W.mark(function ue(pe,ye,me){return W.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:return is(this._defaultDSScanClient),We.next=4,this._makeSureDefaultServiceInfo();case 4:if(this._defaultDSScanClient){We.next=6;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 6:return We.next=8,this._defaultDSScanClient.rotate(pe,ye,me,-1);case 8:return We.abrupt("return",We.sent);case 10:case"end":return We.stop()}},ue,this)})),function(ue,pe,ye){return ve.apply(this,arguments)})},{key:"__crop",value:(ce=yt(W.mark(function ue(pe,ye){return W.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return is(this._defaultDSScanClient),Se.next=4,this._makeSureDefaultServiceInfo();case 4:if(this._defaultDSScanClient){Se.next=6;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 6:return Se.next=8,this._defaultDSScanClient.crop(pe,ye);case 8:return Se.abrupt("return",Se.sent);case 10:case"end":return Se.stop()}},ue,this)})),function(ue,pe){return ce.apply(this,arguments)})},{key:"__fireEvent",value:function(ue,pe){return!U.isFunction(this[ue])||this[ue](pe)}},{key:"getDevices",value:(se=yt(W.mark(function ue(pe){var ye,me,Se,We,ze,Be,$e,Ge,_t,Ct,Ut,Tn,mn,bt,At,Tt,Bt,Qt,yn,un,Ir,jn,hi;return W.wrap(function(jt){for(;;)switch(jt.prev=jt.next){case 0:if(!this._bDispose){jt.next=4;break}throw vc(me={}),Qi(me);case 4:if(Se=[],We="getDevices",ze=this.getViewerElement(),Be=!1,Ge=null==pe?void 0:pe.serviceInfo,_t=null!==(ye=null==pe?void 0:pe.deviceType)&&void 0!==ye?ye:ES,Bo(We,ze),jt.prev=6,Ut=!1,Tn=[],this._serviceInfos){jt.next=12;break}return jt.next=12,this.getDynamsoftService();case 12:if(!Ge){jt.next=25;break}return jt.next=15,this._createDSClientByServiceInfo(Ge,!0);case 15:if(!(bt=jt.sent)){jt.next=21;break}Tn.push(bt),Ut=!1,jt.next=23;break;case 21:throw bVe(null==Ge||null===(At=Ge.attrs)||void 0===At?void 0:At.ty);case 23:jt.next=37;break;case 25:if(!this._serviceInfos){jt.next=37;break}mn=0;case 27:if(!(mn<this._serviceInfos.length)){jt.next=36;break}return Tt=this._serviceInfos[mn],jt.next=31,this._createDSClientByServiceInfo(Tt);case 31:(Bt=jt.sent)&&Tn.push(Bt);case 33:mn++,jt.next=27;break;case 36:Ut=!0;case 37:mn=0;case 38:if(!(mn<Tn.length)){jt.next=60;break}return Qt=void 0,jt.prev=40,jt.next=43,Tn[mn].getDevices(_t,null==pe?void 0:pe.refresh,Be);case 43:if(U.isArray(Qt=jt.sent)&&Qt.length>0)for($e=0;$e<Qt.length;$e++)Se.push(Qt[$e]);jt.next=52;break;case 47:if(jt.prev=47,jt.t0=jt.catch(40),!Be){jt.next=51;break}throw jt.t0;case 51:Ct=jt.t0;case 52:return jt.prev=52,yn=null,this._defaultDSScanClient&&(yn=null===(un=this._defaultDSScanClient.getServiceInfo())||void 0===un||null===(un=un.attrs)||void 0===un?void 0:un.UUID,this._defaultDSScanClient.isDestroy&&(this._disposeDSClientByKey(yn),this._defaultDSScanClient=null,yn=null)),Ut&&(jn=Tn[mn].getServiceInfo(),(hi=null==jn||null===(Ir=jn.attrs)||void 0===Ir?void 0:Ir.UUID)&&hi!=yn&&this._disposeDSClientByKey(hi)),jt.finish(52);case 57:mn++,jt.next=38;break;case 60:jt.next=65;break;case 62:throw jt.prev=62,jt.t1=jt.catch(6),jt.t1;case 65:return jt.prev=65,Gr(We),Ct&&Ce.DWT.lsetException(Ct.code,Ct.message),jt.finish(65);case 69:return jt.abrupt("return",Se);case 70:case"end":return jt.stop()}},ue,this,[[6,62,65,69],[40,47,52,57]])})),function(ue){return se.apply(this,arguments)})},{key:"acquireImage",value:(re=yt(W.mark(function ue(pe,ye){var me,Se,We,ze,Be,$e,Ge,_t,Ct,Ut,Tn,mn,bt,At;return W.wrap(function(Tt){for(;;)switch(Tt.prev=Tt.next){case 0:if(!(me=this)._bDispose){Tt.next=5;break}throw vc(Se={}),Qi(Se);case 5:if(pe&&pe instanceof od){Tt.next=9;break}throw Wi(We={}),{code:We._errorCode,message:We._errorString};case 9:return Be="acquireImage",$e=me.getViewerElement(),Ge=[],Bo(Be,$e),Tt.prev=12,U.isUndefined(ye)&&(ye={}),U.isUndefined(ye.IfShowUI)&&(ye.IfShowUI=!1),U.isUndefined(ye.IfCloseSourceAfterAcquire)&&(ye.IfCloseSourceAfterAcquire=!0),_t=pe.serviceInfo,Tt.next=19,this._createDSClientByServiceInfo(_t,!0);case 19:if(!(ze=Tt.sent)){Tt.next=47;break}if(me._defaultDSScanClient){Tt.next=24;break}return Tt.next=24,me._innerSetDefault(ze);case 24:Ge.push(ze),ze!=me._defaultDSScanClient&&Ge.push(me._defaultDSScanClient),Ct=0;case 27:if(!(Ct<Ge.length)){Tt.next=36;break}if($p._isReady(Ut=Ge[Ct])){Tt.next=33;break}throw bt=null!==(Tn=null===(mn=Ut.getServiceInfo())||void 0===mn||null===(mn=mn.attrs)||void 0===mn?void 0:mn.name)&&void 0!==Tn?Tn:"",f0(Ut,bt),{code:Ut._getErrorCode(),message:Ut._getErrorString()};case 33:Ct++,Tt.next=27;break;case 36:if(me.onPostTransferAsync?ze.registerEvent("OnPostTransferAsync",me.onPostTransferAsync):ze.unregisterEvent("OnPostTransferAsync"),this.__setViewerControlInfo(),ze!=me._defaultDSScanClient){Tt.next=43;break}return Tt.next=41,ze.acquireImage(pe,ye);case 41:Tt.next=45;break;case 43:return Tt.next=45,ze._acquireImageForSendTo(Be,pe,ye,me._defaultDSScanClient);case 45:Tt.next=49;break;case 47:throw mle(null==_t||null===(At=_t.attrs)||void 0===At?void 0:At.name);case 49:Tt.next=54;break;case 51:throw Tt.prev=51,Tt.t0=Tt.catch(12),Tt.t0;case 54:return Tt.prev=54,ze&&ze.__closeRemoteScanUI(!0),Gr(Be),Tt.finish(54);case 58:case"end":return Tt.stop()}},ue,this,[[12,51,54,58]])})),function(ue,pe){return re.apply(this,arguments)})},{key:"_waitForDSValid",value:function(ue,pe){for(var ye=0,me=ue.length,Se=this;ye<me;ye++)if(!$p._isReady(ue[ye]))return void setTimeout(function(){Se._waitForDSValid(ue,pe)},xo.RemoteReconnectTimeSpan);U.isFunction(Se[pe.command])&&Se[pe.command].apply(Se,pe.parmas)}},{key:"getCapabilities",value:(q=yt(W.mark(function ue(pe){var ye,me,Se,We,ze,Be,$e;return W.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:if(!this._bDispose){Ge.next=4;break}throw vc(ye={}),Qi(ye);case 4:if(pe&&pe instanceof od){Ge.next=8;break}throw Wi(me={}),Qi(me);case 8:return We="getCapabilities",ze=[],Be=this.getViewerElement(),Bo(We,Be),Ge.prev=10,$e=pe.serviceInfo,Ge.next=14,this._createDSClientByServiceInfo($e,!0);case 14:if(Se=Ge.sent,!(Se=this._findDSClientByServiceInfo($e))){Ge.next=20;break}return Ge.next=19,Se.getCapabilities(pe);case 19:ze=Ge.sent;case 20:Ge.next=25;break;case 22:throw Ge.prev=22,Ge.t0=Ge.catch(10),Ge.t0;case 25:return Ge.prev=25,Se&&Se.__closeRemoteScanUI(!0),Gr(We),Ge.finish(25);case 29:return Ge.abrupt("return",ze);case 30:case"end":return Ge.stop()}},ue,this,[[10,22,25,29]])})),function(ue){return q.apply(this,arguments)})},{key:"setCapabilities",value:(G=yt(W.mark(function ue(pe,ye){var me,Se,We,ze,Be,$e;return W.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:if(!this._bDispose){Ge.next=4;break}throw vc(me={}),Qi(me);case 4:if(pe&&pe instanceof od){Ge.next=8;break}throw Wi(Se={}),Qi(Se);case 8:return ze="setCapabilities",Be=this.getViewerElement(),Bo(ze,Be),Ge.prev=10,$e=pe.serviceInfo,Ge.next=14,this._createDSClientByServiceInfo($e,!0);case 14:if(!(We=Ge.sent)){Ge.next=18;break}return Ge.next=18,We.setCapabilities(pe,ye);case 18:Ge.next=23;break;case 20:throw Ge.prev=20,Ge.t0=Ge.catch(10),Ge.t0;case 23:return Ge.prev=23,We&&We.__closeRemoteScanUI(!0),Gr(ze),Ge.finish(23);case 27:case"end":return Ge.stop()}},ue,this,[[10,20,23,27]])})),function(ue,pe){return G.apply(this,arguments)})},{key:"closeSource",value:(Y=yt(W.mark(function ue(pe){var ye,me,Se,We,Be;return W.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(!this._bDispose){$e.next=4;break}throw vc(ye={}),Qi(ye);case 4:if(pe&&pe instanceof od){$e.next=8;break}throw Wi(me={}),Qi(me);case 8:return Se="closeSource",We=this.getViewerElement(),Bo(Se,We),$e.prev=10,Be=this._findDSClientByServiceInfo(pe.serviceInfo),$e.next=15,Be.closeSource();case 15:$e.next=20;break;case 17:throw $e.prev=17,$e.t0=$e.catch(10),$e.t0;case 20:return $e.prev=20,Gr(Se),$e.finish(20);case 23:case"end":return $e.stop()}},ue,this,[[10,17,20,23]])})),function(ue){return Y.apply(this,arguments)})},{key:"_putDSClientToMap",value:function(ue,pe){var ye,me=null==ue||null===(ye=ue.attrs)||void 0===ye?void 0:ye.UUID;me&&(this._dsScanClientsMap[me]=pe)}},{key:"_getDSClientFromMap",value:function(ue){var pe,ye=null==ue||null===(pe=ue.attrs)||void 0===pe?void 0:pe.UUID;return ye?this._dsScanClientsMap[ye]:null}},{key:"_createDSClientByServiceInfo",value:(H=yt(W.mark(function ue(pe,ye,me){var Se,We,ze,Be;return W.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(this._serviceInfos){$e.next=3;break}return $e.next=3,this.getDynamsoftService();case 3:if(Se=this._findDSClientByServiceInfo(pe)){$e.next=20;break}return $e.next=7,this._setRemoteUuid();case 7:return $e.prev=7,$e.next=10,$p.createByServiceInfo(this._uuidForRemoteScanObject,pe,me);case 10:(Se=$e.sent)&&this._putDSClientToMap(pe,Se),$e.next=20;break;case 14:if($e.prev=14,$e.t0=$e.catch(7),$e.t0.code==Xn.MustUpgrade&&(ze=null==pe||null===(We=pe.attrs)||void 0===We?void 0:We.ty)&&(H1(Be={},ze),$e.t0.message=Be._errorString),!ye){$e.next=19;break}throw $e.t0;case 19:U.warn($e.t0);case 20:return $e.abrupt("return",Se);case 21:case"end":return $e.stop()}},ue,this,[[7,14]])})),function(ue,pe,ye){return H.apply(this,arguments)})},{key:"_makeSureDefaultServiceInfo",value:(B=yt(W.mark(function ue(){var pe;return W.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(this._serviceInfos){ye.next=3;break}return ye.next=3,this.getDynamsoftService();case 3:if(!(this._serviceInfos&&this._serviceInfos.length>0)){ye.next=8;break}return pe=this._serviceInfos[0],ye.next=7,this._createDSClientByServiceInfo(pe);case 7:return ye.abrupt("return",ye.sent);case 8:return ye.abrupt("return",null);case 9:case"end":return ye.stop()}},ue,this)})),function(){return B.apply(this,arguments)})},{key:"httpUpload",value:(M=yt(W.mark(function ue(pe,ye,me,Se,We,ze){var Be,Ge,_t;return W.wrap(function(Ct){for(;;)switch(Ct.prev=Ct.next){case 0:if(!this._bDispose){Ct.next=4;break}return vc(Be={}),Ct.abrupt("return",ge.Promise.reject(Qi(Be)));case 4:return Ge=this.getViewerElement(),_t=Ge._containerElement,Ct.next=7,this._makeSureDefaultServiceInfo();case 7:if(this._defaultDSScanClient){Ct.next=9;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 9:return Ct.next=11,this._defaultDSScanClient.httpUpload(pe,ye,me,Se,We,ze,_t);case 11:return Ct.abrupt("return",Ct.sent);case 13:case"end":return Ct.stop()}},ue,this)})),function(ue,pe,ye,me,Se,We){return M.apply(this,arguments)})},{key:"runCommand",value:function(ue){return this._defaultDSScanClient.RunCommandAsync(ue)}},{key:"removeImages",value:(D=yt(W.mark(function ue(pe){var ye,me,Se,We,ze;return W.wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:if(!this._bDispose){Be.next=4;break}return vc(ye={}),Be.abrupt("return",ge.Promise.reject(Qi(ye)));case 4:return me="removeImages",We=this.getViewerElement(),Bo(me,We),Be.prev=6,Be.next=9,this._makeSureDefaultServiceInfo();case 9:if(this._defaultDSScanClient){Be.next=11;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 11:if(!this._defaultDSScanClient){Be.next=17;break}return Be.next=14,this._defaultDSScanClient.removeImages(pe);case 14:Se=Be.sent,Be.next=21;break;case 17:if(0!=this.howManyImagesInBuffer){Be.next=21;break}if(Hhe(pe,this.howManyImagesInBuffer,ze={})){Be.next=21;break}throw{code:ze._errorCode,message:ze._errorString};case 21:Be.next=26;break;case 23:throw Be.prev=23,Be.t0=Be.catch(6),Be.t0;case 26:return Be.prev=26,Gr(me),Be.finish(26);case 29:return Be.abrupt("return",Se);case 30:case"end":return Be.stop()}},ue,this,[[6,23,26,29]])})),function(ue){return D.apply(this,arguments)})},{key:"saveImages",value:(A=yt(W.mark(function ue(pe,ye,me){var Se,ze,Be;return W.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(Se={},!this._bDispose){$e.next=4;break}return vc(Se),$e.abrupt("return",ge.Promise.reject(Qi(Se)));case 4:if(0!=this.howManyImagesInBuffer){$e.next=7;break}return ea(Se),$e.abrupt("return",ge.Promise.reject(Qi(Se)));case 7:if(U.isNumber(me)){$e.next=10;break}return Wi(Se),$e.abrupt("return",ge.Promise.reject(Qi(Se)));case 10:if(me!=Ti.IT_BMP&&me!=Ti.IT_JPG&&me!=Ti.IT_PNG){$e.next=16;break}if(!(ye.length>1)){$e.next=14;break}return wt(Se,-2623,"Saving multiple images is not allowable when the selected output format is BMP, JPG or PNG."),$e.abrupt("return",ge.Promise.reject(Qi(Se)));case 14:$e.next=26;break;case 16:if(me!=Ti.IT_TIF&&me!=Ti.IT_PDF){$e.next=19;break}$e.next=26;break;case 19:if(me!=Ti.IT_ALL&&me!=Ti.IT_MULTIPAGE_PDF&&me!=Ti.IT_MULTIPAGE_TIF){$e.next=24;break}return Cle(Se),$e.abrupt("return",ge.Promise.reject(Qi(Se)));case 24:return Gl(Se),$e.abrupt("return",ge.Promise.reject(Qi(Se)));case 26:return ze=this.getViewerElement(),Be=ze._containerElement,$e.next=29,this._makeSureDefaultServiceInfo();case 29:if(this._defaultDSScanClient){$e.next=31;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 31:return $e.next=33,this._defaultDSScanClient.saveImages(pe,ye,me,Be);case 33:return $e.abrupt("return",$e.sent);case 35:case"end":return $e.stop()}},ue,this)})),function(ue,pe,ye){return A.apply(this,arguments)})},{key:"getImages",value:(T=yt(W.mark(function ue(pe,ye,me){var Se,ze,Be;return W.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(Se={},!this._bDispose){$e.next=4;break}return vc(Se),$e.abrupt("return",ge.Promise.reject(Qi(Se)));case 4:if(0!=this.howManyImagesInBuffer){$e.next=7;break}return ea(Se),$e.abrupt("return",ge.Promise.reject(Qi(Se)));case 7:if(U.isNumber(ye)&&U.isNumber(me)){$e.next=10;break}return Wi(Se),$e.abrupt("return",ge.Promise.reject(Qi(Se)));case 10:return ze=this.getViewerElement(),Be=ze._containerElement,$e.next=13,this._makeSureDefaultServiceInfo();case 13:if(this._defaultDSScanClient){$e.next=15;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 15:return $e.next=17,this._defaultDSScanClient.getImages(pe,ye,me,Be);case 17:return $e.abrupt("return",$e.sent);case 19:case"end":return $e.stop()}},ue,this)})),function(ue,pe,ye){return T.apply(this,arguments)})},{key:"__unload",value:(w=yt(W.mark(function ue(){var pe,me,Se;return W.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if(this._viewer&&this._viewer.unbind(),!this._dsScanClientsMap){We.next=12;break}me=Object.keys(this._dsScanClientsMap),pe=0;case 5:if(!(pe<me.length)){We.next=12;break}return Se=me[pe],We.next=9,this._disposeDSClientByKey(Se);case 9:pe++,We.next=5;break;case 12:this._dsScanClientsMap=null,this._bDispose=!0;case 14:case"end":return We.stop()}},ue,this)})),function(){return w.apply(this,arguments)})},{key:"dispose",value:function(){return this.__unload()}},{key:"setLogLevel",value:function(ue){var pe,ye=this._dsScanClientsMap;if(ye){var me=Object.keys(ye);for(pe=0;pe<me.length;pe++)ye[me[pe]]._setLogLevel(ue);this._needSetLogLevel=!1,this._logLevel=-1}else this._needSetLogLevel=!0,this._logLevel=ue;return!0}},{key:"getProfile",value:(x=yt(W.mark(function ue(pe){var ye,me,Se,We;return W.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(ye="",pe&&pe instanceof od){ze.next=5;break}throw Wi(me={}),{code:me._errorCode,message:me._errorString};case 5:return ze.prev=5,Se=pe.serviceInfo,ze.next=9,this._createDSClientByServiceInfo(Se,!0);case 9:if(!(We=ze.sent)){ze.next=14;break}return ze.next=13,We.getProfile(pe);case 13:ye=ze.sent;case 14:ze.next=19;break;case 16:throw ze.prev=16,ze.t0=ze.catch(5),ze.t0;case 19:return ze.abrupt("return",ye);case 20:case"end":return ze.stop()}},ue,this,[[5,16]])})),function(ue){return x.apply(this,arguments)})},{key:"setProfile",value:(C=yt(W.mark(function ue(pe,ye){var me,Se,We,ze;return W.wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:if(me="",pe&&pe instanceof od){Be.next=5;break}throw Wi(Se={}),{code:Se._errorCode,message:Se._errorString};case 5:return Be.prev=5,We=pe.serviceInfo,Be.next=9,this._createDSClientByServiceInfo(We,!0);case 9:if(!(ze=Be.sent)){Be.next=14;break}return Be.next=13,ze.setProfile(pe,ye);case 13:me=Be.sent;case 14:Be.next=19;break;case 16:throw Be.prev=16,Be.t0=Be.catch(5),Be.t0;case 19:return Be.abrupt("return",me);case 20:case"end":return Be.stop()}},ue,this,[[5,16]])})),function(ue,pe){return C.apply(this,arguments)})},{key:"imageIDToIndex",value:function(ue){return this._defaultDSScanClient?this._defaultDSScanClient.imageIDToIndex(ue):0}},{key:"indexToImageID",value:function(ue){return this._defaultDSScanClient?this._defaultDSScanClient.indexToImageID(ue):""}},{key:"howManyImagesInBuffer",get:function(){return this._defaultDSScanClient?this._defaultDSScanClient.howManyImagesInBuffer:0}},{key:"currentImageIndexInBuffer",get:function(){return this._defaultDSScanClient?this._defaultDSScanClient.currentImageIndexInBuffer:-1},set:function(ue){this._defaultDSScanClient&&(this._defaultDSScanClient.currentImageIndexInBuffer=ue)}},{key:"showProgressBar",get:function(){return this._defaultDSScanClient?this._defaultDSScanClient.IfShowProgressBar:this._showProgressBar},set:function(ue){this._defaultDSScanClient&&(this._showProgressBar=ue,this._defaultDSScanClient.IfShowProgressBar=ue)}},{key:"registerEvent",value:function(ue,pe){if(this._bDispose){var ye={};return vc(ye),ge.Promise.reject(Qi(ye))}if(!U.isFunction(pe)){var me={};return ple(me),ge.Promise.reject(Qi(me))}if("onBufferChanged"==ue||"OnBufferChanged"==ue)this.onBufferChanged=pe;else{if("onPostTransferAsync"!=ue&&"OnPostTransferAsync"!=ue){var Se={};return dle(Se),ge.Promise.reject(Qi(Se))}this.onPostTransferAsync=pe}return this._registEventToDefaultDS(),!0}},{key:"unregisterEvent",value:function(ue,pe){if(this._bDispose){var ye={};return vc(ye),ge.Promise.reject(Qi(ye))}if("onBufferChanged"==ue||"OnBufferChanged"==ue){if(this.onBufferChanged=null,this._defaultDSScanClient)return this._defaultDSScanClient.unregisterEvent("OnBufferChanged",pe)}else{if("onPostTransferAsync"!=ue&&"OnPostTransferAsync"!=ue){var me={};return dle(me),ge.Promise.reject(Qi(me))}if(this.onPostTransferAsync=null,this._defaultDSScanClient)return this._defaultDSScanClient.unregisterEvent("OnPostTransferAsync",pe)}}},{key:"getViewerElement",value:function(){return this.Viewer&&this.Viewer.webViewer&&this.Viewer.webViewer.containerElement?{_containerElement:this.Viewer.webViewer.containerElement}:{_containerElement:document.body}}},{key:"isSameService",value:function(ue,pe){return!(!ue||!pe)&&ue.server==pe.server&&ue.attrs.UUID==pe.attrs.UUID&&ue.attrs.accessmode==pe.attrs.accessmode&&ue.attrs.name==pe.attrs.name&&ue.attrs.os==pe.attrs.os&&ue.attrs.service_type==pe.attrs.service_type&&ue.attrs.tags==pe.attrs.tags&&ue.attrs.ty==pe.attrs.ty&&ue.attrs.type==pe.attrs.type&&ue.attrs.txtvers==pe.attrs.txtvers}},{key:"_findDSClientByServiceInfo",value:function(ue){var pe,ye=this._serviceInfos;if(ye)for(pe=0;pe<ye.length;pe++){var me=ye[pe];if(this.isSameService(ue,me)){var Se=this._getDSClientFromMap(me);if(Se){var We;if($p._isReady(Se))return Se;Se.isDestroy||Se.dispose();var ze=null==me||null===(We=me.attrs)||void 0===We?void 0:We.UUID;ze&&delete this._dsScanClientsMap[ze]}break}}return null}},{key:"_setRemoteUuid",value:(y=yt(W.mark(function ue(){return W.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(!Xa()){ye.next=8;break}if(this._uuidForRemoteScanObject){ye.next=6;break}return ye.next=4,Ce.DWT.lgcuid(Ce.DWT.EnumInstance.dwt_desktop,"");case 4:this._uuidForRemoteScanObject=ye.sent;case 6:ye.next=8;break;case 8:case"end":return ye.stop()}},ue,this)})),function(){return y.apply(this,arguments)})},{key:"_registEventToDefaultDS",value:function(){this._defaultDSScanClient&&(this.onBufferChanged&&this._defaultDSScanClient.registerEvent("OnBufferChanged",this.onBufferChanged),this.onPostTransferAsync&&this._defaultDSScanClient.registerEvent("OnPostTransferAsync",this.onPostTransferAsync))}}]);var y,C,x,w,T,A,D,M,B,H,Y,G,q,re,se,ce,ve,Te,Ue,je,Ee,Oe,He,we}(),LP=!1;function qW(y,C){return KW.apply(this,arguments)}function KW(){return KW=yt(W.mark(function y(C,x){var w,T;return W.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(x&&lo(VVe),pn.isLicenseMixed(null,!0)||pn.reparseProductKey(x),0==(w=Ce.DWT.licenseException).code){A.next=6;break}throw C&&IB(w),{code:w.code,message:w.message};case 6:if(LP){A.next=14;break}if(T=!1,de.bIE&&(T=de.IEVersion<=7),T||!Xa()){A.next=14;break}if(!Ce.DWT.bChromeExtension){A.next=13;break}return LP=!0,A.abrupt("return");case 13:return A.abrupt("return",new ge.Promise(function(D,M){var H="";de.bFileSystem||(H=ge.timestamp),U.addScript([Ce.DWT.ResourcesPath,"/src/dynamsoft.lts.js",H].join(""),!0,!1,function(Y){if(Ce.LTS&&Ce.LTS._)return LP=!0,void D();if(Y){if(de.bIE)return void M({code:-2822,message:"The WebTwain JavaScript lts.js load failed."});if("error"==Y.type)return void M({code:-2822,message:"The WebTwain JavaScript lts.js load failed."})}LP=!0,D()})}));case 14:case"end":return A.stop()}},y)})),KW.apply(this,arguments)}function pqe(y,C,x){return JW.apply(this,arguments)}function JW(){return JW=yt(W.mark(function y(C,x,w){var T,A,D,M,B,H,Y,G,q,re,se;return W.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:T=Ce.DWT.Containers,A=0;case 2:if(!(A<T.length)){ce.next=52;break}if(!(D=U.clone(T[A])).ContainerId){ce.next=8;break}if(!Ce.DWT.ContainerMap[D.ContainerId]){ce.next=8;break}return ce.abrupt("continue",49);case 8:if(!D.WebTwainId){ce.next=12;break}if(!Ce.DWT.WebTwainIdMap[D.WebTwainId]){ce.next=12;break}return ce.abrupt("continue",49);case 12:if(D.Host=C,D.SSLPort=w,D.Port=x,!U.isDOM(D.Container)){ce.next=18;break}ce.next=25;break;case 18:if(!D.ContainerId){ce.next=25;break}if(U.isString(H=D.ContainerId)){ce.next=22;break}throw{code:-2806,message:'Error: The argument passed to the parameter "conatinerId" is not a string.'};case 22:if(D.Container=U.get(H),D.Container){ce.next=25;break}throw ble(H);case 25:if(!Z9(D.Container)){ce.next=32;break}return Y=document.createElement("div"),D.Container.appendChild(Y),D.Container=Y,G=Q9(Y),ce.next=32,Yce(G);case 32:return Ije(q=Cfe(D)),re=void 0,ce.prev=35,ce.next=38,Qfe.create(q);case 38:re=ce.sent,ce.next=45;break;case 41:throw ce.prev=41,ce.t0=ce.catch(35),re&&re.dispose(),ce.t0;case 45:if(0===(B=Ce.DWT.licenseException).code){ce.next=48;break}throw{code:B.code,message:B.message};case 48:M=re;case 49:A++,ce.next=2;break;case 52:se=window,M&&(se.DCP_DWT_OnClickCloseInstall&&se.DCP_DWT_OnClickCloseInstall(!1,!0),tpe(M),jhe(M)),setTimeout(function(){try{U.isFunction(Ce.DWT.OnWebTwainReady)?Ce.DWT.OnWebTwainReady():U.isFunction(se.Dynamsoft_OnReady)&&se.Dynamsoft_OnReady()}catch(ve){Fr(ve)}},100);case 55:case"end":return ce.stop()}},y,null,[[35,41]])})),JW.apply(this,arguments)}function npe(){return QW.apply(this,arguments)}function QW(){return QW=yt(W.mark(function y(){var C,x,w,T,A,D,M,B,H,Y,G,q,re,se;return W.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ge.page.bUnload=vt,ce.next=3,qW(!0,!0);case 3:if(St.bHTML5Edition){ce.next=5;break}return ce.abrupt("return",Ce.DWT._innerLoad());case 5:if((C=Ce.DWT.Containers)&&0!==C.length){ce.next=10;break}throw _le(x={}),{code:x._errorCode,message:x._errorString};case 10:A=!1,D=[],M=[],w=0;case 12:if(!(w<C.length)){ce.next=37;break}if(!(T=C[w])){ce.next=32;break}if(U.isObject(T)){ce.next=18;break}return A=!0,ce.abrupt("break",37);case 18:if(!U.isString(T.WebTwainId)||""==T.WebTwainId){ce.next=24;break}if(!$ce(D,T.WebTwainId)){ce.next=23;break}throw xle(x={}),{code:x._errorCode,message:x._errorString};case 23:D.push(T.WebTwainId);case 24:if(!U.isString(T.ContainerId)||""==T.ContainerId){ce.next=30;break}if(!$ce(M,T.ContainerId)){ce.next=29;break}throw wle(x={}),{code:x._errorCode,message:x._errorString};case 29:M.push(T.ContainerId);case 30:ce.next=34;break;case 32:return A=!0,ce.abrupt("break",37);case 34:w++,ce.next=12;break;case 37:if(!A){ce.next=41;break}throw _Ve(B={}),{code:B._errorCode,message:B._errorString};case 41:return H=Ya(),Y=Ce.DWT.Port,G=Ce.DWT.SSLPort,ce.next=44,Tfe(H,Y,G);case 44:if(!Ce.DWT.IfCheckDCP){ce.next=65;break}return q=de.bSSL?G:Y,ce.next=48,kB(H,Y,G);case 48:if(!(re=ce.sent)){ce.next=54;break}Y=re.port,G=re.sslPort,ce.next=57;break;case 54:throw zl(se={}),Qi(se);case 57:if(!Ce.dcp.bEnhancedMode){ce.next=65;break}return ce.prev=58,ce.next=61,Op.closeWsClient(H,q,de.bSSL);case 61:ce.next=65;break;case 63:ce.prev=63,ce.t0=ce.catch(58);case 65:return lo($Ve),ce.next=68,pqe(H,Y,G);case 68:case"end":return ce.stop()}},y,null,[[58,63]])})),QW.apply(this,arguments)}var gqe=new(g(function y(){l(this,y)},[{key:"InvalidValue",value:function(y){da(y)}},{key:"ParameterCannotEmpty",value:function(y){_l(y)}},{key:"Webcam_InvalidIndex",value:function(y,C){wt(y,-2315,"The index is out of range.")}},{key:"Webcam_InvalidRemoteFilename",value:function(y){wt(y,-2316,"The RemoteFile field is empty in the Webcam Download Function.")}},{key:"InvalidDestination",value:function(y){wt(y,-2318,"Invalid destination file.")}},{key:"InvalidSourceFile",value:function(y){wt(y,-2319,"Invalid source file.")}},{key:"InvalidFile",value:function(y){h0(y)}},{key:"OCR_InvalidIndex",value:function(y,C){wt(y,-2321,"The index is out of range.")}},{key:"OCR_InvalidLeftOrTopOrRightOrBottom",value:function(y){wt(y,-2322,"The left or top or right or bottom you entered is invalid.")}},{key:"OCR_InvalidOutputFormat",value:function(y){wt(y,-2323,"The OCR output format is not supported.")}},{key:"OCR_InvalidPageSetMode",value:function(y){wt(y,-2324,"The OCR page set mode is not supported.")}},{key:"IndexOutOfRange",value:function(y){kt(y)}},{key:"OCR_InvalidRemoteFilename",value:function(y){wt(y,-2379,"The RemoteFile field is empty in the OCR Download Function.")}},{key:"ImageEditorOpenCannotPlayVideo",value:function(y){wt(y,-2437,"The video can not be played while the Image Editor is open.")}},{key:"EventNotExist",value:function(y){wt(y,-2509,"The specified event doesn't exist.")}},{key:"CallbackNotAFunction",value:function(y){ple(y)}},{key:"WasmNotLoaded",value:function(y){wt(y,-2537,"The wasm not loaded.")}},{key:"WasmNotLoaded_UseWasmFalse",value:function(y){wt(y,-2538,"The wasm not loaded when Dynamsoft.DWT.UseCameraAddonWasm is set to false.")}},{key:"CannotDoWhenNoViewerJS",value:function(y){AA(y)}},{key:"LicenseNoDbr",value:function(y){wt(y,-2611,"The license for the Barcode module is invalid."),Ao(y)}}]));if(St.bHTML5Edition){var mqe=function(){var y=yt(W.mark(function C(x){var w,T,A,D,M,B,H;return W.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return ufe(),G.next=3,qW(!0,!1);case 3:if(Ce.DWT.UseDefaultViewer||(x.Container=null),!Z9(x.Container)){G.next=11;break}return T=document.createElement("div"),x.Container.appendChild(T),x.Container=T,A=Q9(T),G.next=11,Yce(A);case 11:return w=Cfe(x),G.next=14,yC();case 14:return G.next=16,PP();case 16:D=3,M=0;case 18:if(!(M<D)){G.next=35;break}return G.prev=19,G.next=22,Tfe(w.host,w.port,w.sslPort);case 22:return G.abrupt("break",35);case 25:if(G.prev=25,G.t0=G.catch(19),!(M<D-1&&G.t0.code==Xn.DWTPortNotReady)){G.next=31;break}return G.next=30,new ge.Promise(function(q,re){setTimeout(function(){q()},300)});case 30:return G.abrupt("continue",32);case 31:throw G.t0;case 32:M++,G.next=18;break;case 35:if(!Ce.DWT.IfCheckDCP){G.next=47;break}return G.next=38,kB(w.host,w.port,w.sslPort);case 38:if(!(B=G.sent)){G.next=44;break}w.port=B.port,w.sslPort=B.sslPort,G.next=47;break;case 44:throw zl(H={}),Qi(H);case 47:return lo("Creating a WebTwain instance..."),G.next=50,uqe(w);case 50:return G.abrupt("return",G.sent);case 52:case"end":return G.stop()}},C,null,[[19,25]])}));return function(C){return y.apply(this,arguments)}}(),vqe=window;Ce.DWT.OnBeforeUnload=function(y){},vqe.addEventListener("beforeunload",function(y){if(ge.isFunction(Ce.DWT.OnBeforeUnload))return Ce.DWT.OnBeforeUnload(y)}),Ce.DWT.Unload=yt(W.mark(function y(){var C;return W.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!St.bDWTLoading&&!St.bDWTUnloading){x.next=2;break}return x.abrupt("return");case 2:return St.bDWTUnloading=!0,x.prev=3,x.next=6,s3(!1,!0);case 6:x.next=11;break;case 8:x.prev=8,x.t0=x.catch(3),C=x.t0;case 11:try{Em(),Ce.DWT.CloseDialog(),ge._zdgb_xkz_dhk(),ge.closeProgress(null,""),ge.hideMask(),Eje()}catch(w){}if(St.bDWTLoading=!1,St.bDWTUnloading=!1,!C){x.next=16;break}throw C;case 16:case"end":return x.stop()}},y,null,[[3,8]])})),Ce.DWT.Load=yt(W.mark(function y(){var C,x;return W.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!St.bDWTLoading){w.next=2;break}return w.abrupt("return");case 2:if(!St.bDWTUnloading){w.next=5;break}return setTimeout(Ce.DWT.Load,500),w.abrupt("return");case 5:return St.bDWTLoading=!0,a3(),w.prev=7,w.prev=8,w.next=11,AP();case 11:return w.next=13,yC();case 13:return w.next=15,PP();case 15:w.next=21;break;case 17:throw w.prev=17,w.t0=w.catch(8),GA(w.t0),w.t0;case 21:return w.prev=21,Ce.Lib.closeProgress(),w.next=25,s3(!0,!0);case 25:w.next=31;break;case 27:return w.prev=27,w.t1=w.catch(21),w.next=31,s3();case 31:w.prev=31,Ce.DWT.CloseDialog(),C=3,x=0;case 35:if(!(x<C)){w.next=52;break}return w.prev=36,w.next=39,npe();case 39:return w.abrupt("break",52);case 42:if(w.prev=42,w.t2=w.catch(36),!(x<C-1&&w.t2.code==Xn.DWTPortNotReady)){w.next=48;break}return w.next=47,new ge.Promise(function(T,A){setTimeout(function(){T()},300)});case 47:return w.abrupt("continue",49);case 48:throw w.t2;case 49:x++,w.next=35;break;case 52:w.next=66;break;case 54:return w.prev=54,w.t3=w.catch(31),zA(w.t3.code)||ge.detect.bOK||U.asyncQueue.pushToDo(null,Ce.DWT.Load),GA(w.t3),w.prev=59,w.next=62,s3();case 62:w.next=66;break;case 64:w.prev=64,w.t4=w.catch(59);case 66:return w.prev=66,St.bDWTLoading=!1,Em(),w.finish(66);case 70:case"end":return w.stop()}},y,null,[[7,,66,70],[8,17],[21,27],[31,54],[36,42],[59,64]])})),Ce.DWT.CheckConnectToTheService=function(y,C,x,w){Dfe(y,C,null,x,w)},Ce.DWT.ConnectToTheService=function(){U.asyncQueue.start()},Ce.DWT.CreateDWTObject=function(y,C,x,w,T,A){var D,M=T,B=A;U.isFunction(C)&&U.isFunction(x)?(M=C,B=x,D={}):D={Host:C,Port:x,SSLPort:w};var H,Y=y;if(U.isString(Y)&&!(Y=U.get(Y)))return wt(H={},-2813,"Error: The ID of the target DIV for the new DWT object is invalid."),B&&B({code:H._errorCode,message:H._errorString}),vt;if(U.isDOM(Y))D.Container=Y;else{if(!U.isString(y))return U.isFunction(B)&&B({code:-2806,message:'Error: The argument passed to the parameter "conatinerId" is not a string.'}),vt;if(!U.get(y)){var q=ble(y);return U.isFunction(B)&&B(q),vt}}return D.WebTwainId=Fce(),Ce.DWT.CreateDWTObjectEx(D,M,B)},Ce.DWT.CreateDWTObjectEx=function(y,C,x){var w=arguments,T=!!y.bLoadingDialogOpened;return St.loadResourcePath?U.isString(y.WebTwainId)?(T||a3(),delete y.bLoadingDialogOpened,mqe(y).then(function(A){Em(),jhe(A),U.isFunction(C)&&C(A)},function(A){if(Em(),!ge.detect.bOK){var D=A&&A.code,M=Ce.DWT.licenseException;(D&&!zA(D)||0==M.code)&&(U.asyncQueue.stop(),U.asyncQueue.pushToDo(null,Ce.DWT.CreateDWTObjectEx,w))}U.isFunction(x)&&x(A)}),!0):(T&&Em(),x&&x({code:-2805,message:'Error: The "WebTwainId" is not a string.'}),vt):(T||(a3(),y.bLoadingDialogOpened=!0),void AP().then(yC).then(function(){setTimeout(function(){Ce.DWT.CreateDWTObjectEx(y,C,x)},100)},function(A){Em(),x(A)}))},Ce.DWT.CreateRemoteScanObjectAsync=function(){var y=yt(W.mark(function C(x){var w,T;return W.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(w=null,x){A.next=5;break}throw Wi(T={}),{code:T._errorCode,message:T._errorString};case 5:return St.bDWTLoading=!0,a3(),A.prev=7,A.next=10,yC();case 10:return A.next=12,PP();case 12:return A.next=14,qW(!1,!1);case 14:w=new fqe(x),Object.preventExtensions(w);case 16:return A.prev=16,St.bDWTLoading=!1,Em(),A.finish(16);case 20:return A.abrupt("return",w);case 21:case"end":return A.stop()}},C,null,[[7,,16,20]])}));return function(C){return y.apply(this,arguments)}}(),Ce.DWT.DeleteDWTObject=function(y){var C,x=y;return St.bHTML5Edition&&x?!!(C=U.isString(x)?Ce.DWT.GetWebTwain(x):x)&&(C.dispose(),!0):vt}}function s3(y,C){return ZW.apply(this,arguments)}function ZW(){return ZW=yt(W.mark(function y(C,x){var w,T,A,D,M,B,H;return W.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(C&&lo("Unload..."),!x){Y.next=4;break}return Y.next=4,Ce.DWT.lunload();case 4:if(ge.dlgProgress=!1,ge.detect.bOK=!1,ge.detect.bFirst=!0,!(D=Ce.DWT.WebTwainIdMap)){Y.next=32;break}M=Object.keys(D),w=0;case 11:if(!(w<M.length)){Y.next=32;break}if(!(A=M[w])||!(A in D)){Y.next=29;break}if(!(T=D[A])){Y.next=29;break}if(Y.prev=16,!T.__unload){Y.next=22;break}return Y.next=20,T.__unload();case 20:Y.next=24;break;case 22:return Y.next=24,T.dispose();case 24:Y.next=29;break;case 26:Y.prev=26,Y.t0=Y.catch(16),B=Y.t0;case 29:w++,Y.next=11;break;case 32:if(!(D=Ce.DWT.ContainerMap)){Y.next=57;break}M=Object.keys(D),w=0;case 36:if(!(w<M.length)){Y.next=57;break}if(!(A=M[w])||!(A in D)){Y.next=54;break}if(!(T=D[A])){Y.next=54;break}if(Y.prev=41,!T.__unload){Y.next=47;break}return Y.next=45,T.__unload();case 45:Y.next=49;break;case 47:return Y.next=49,T.dispose();case 49:Y.next=54;break;case 51:Y.prev=51,Y.t1=Y.catch(41),B=Y.t1;case 54:w++,Y.next=36;break;case 57:if(!(D=Ce.DWT.RemoteScanIdMap)){Y.next=82;break}M=Object.keys(D),w=0;case 61:if(!(w<M.length)){Y.next=82;break}if(!(A=M[w])||!(A in D)){Y.next=79;break}if(!(T=D[A])){Y.next=79;break}if(Y.prev=66,!T.__unload){Y.next=72;break}return Y.next=70,T.__unload();case 70:Y.next=74;break;case 72:return Y.next=74,T.dispose();case 74:Y.next=79;break;case 76:Y.prev=76,Y.t2=Y.catch(66),B=Y.t2;case 79:w++,Y.next=61;break;case 82:for(w=0;w<St.unloadQueue.length;w++)U.isFunction(H=St.unloadQueue[w])&&H();if(St.unloadQueue.splice(0),!B){Y.next=86;break}throw B;case 86:case"end":return Y.stop()}},y,null,[[16,26],[41,51],[66,76]])})),ZW.apply(this,arguments)}function a3(){St.bHTML5Edition&&(ife(),Bo("openLoadingMsg",null,{width:ge.loaderBarWidth+"px"}))}function Em(){St.bHTML5Edition&&Gr("closeLoadingMsg:")}function Jt(y,C){var x,w=this,T=0;x=U.isString(y)?document.getElementById(y):y,w.isLoaded=!1,w.displayType=0,w.progress=0,w.progressPosition=0,w.borderWidth={left:0,right:0,top:0,bottom:0},w.orientation=C.orientation||Jt.Orientation.Horizontal,w.direction=C.direction||Jt.Direction.LeftToRight,w.creationType=C.creationType||Jt.CreationType.Replace,w.value=0,w.initialValue=C.value||0,w.minValue=C.minValue||0,w.maxValue=C.maxValue||100,w.showLabel=void 0===C.showLabel||C.showLabel,w.labelText=C.labelText||"",w.width=C.width||280,w.height=C.height||20,w.borderRadius=C.borderRadius||10,w.orientation==Jt.Orientation.Horizontal&&w.borderRadius>w.height/2&&(w.borderRadius=Math.round(w.height/2)),w.orientation==Jt.Orientation.Vertical&&w.borderRadius>w.width/2&&(w.borderRadius=Math.round(w.width/2)),w.backColor=C.backColor||"",w.color=C.color||"#50a8e1",w.animationStyle=0,w.animationInterval=C.animationInterval||100;var A=["parent","background","wrapper","left","middle","right","horizontalText","verticalText","marker"];for(w.extraClassName={},T=0;T<A.length;T++)w.extraClassName[A[T]]=C.extraClassName?"string"==typeof C.extraClassName?C.extraClassName:C.extraClassName[A[T]]||"":"";w.onLoad=C.onLoad||null,w.onValueChanged=C.onValueChanged||null,w.onAnimate=C.onAnimate||null,w.creationType==Jt.CreationType.Replace?w.parentElement=x:(w.parentElement=document.createElement("DIV"),x.appendChild(w.parentElement)),w.finishLoading()}ge.Errors=gqe,q1(yt(W.mark(function y(){var C,x,w,T;return W.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if((C=window)&&(U.addEventListener(C,"focus",function(){var D;(D=Ce.DWT.WebTwainIdMap)&&U.each(D,function(M,B){M&&M._OnPageFocus&&M._OnPageFocus()})}),U.addEventListener(C,"blur",function(){de.bWin&&mfe()}),U.addEventListener(x=C.document,"visibilitychange",function(){de.bWin&&"hidden"==x.visibilityState&&mfe()})),Ce.navInfo){A.next=11;break}return A.prev=3,A.next=6,rB();case 6:Ce.navInfo=A.sent,A.next=11;break;case 9:A.prev=9,A.t0=A.catch(3);case 11:if(!1!==Ce.DWT.AutoLoad&&!St.bDWTLoading){A.next=13;break}return A.abrupt("return");case 13:return A.prev=13,A.next=16,AP();case 16:if(!(Ce.DWT.Containers&&Ce.DWT.Containers.length>0&&Ce.DWT.AutoLoad)||St.bDWTLoading){A.next=48;break}return St.bDWTLoading=!0,a3(),A.prev=20,A.next=23,yC();case 23:return A.next=25,PP();case 25:w=3,T=0;case 27:if(!(T<w)){A.next=44;break}return A.prev=28,A.next=31,npe();case 31:return A.abrupt("break",44);case 34:if(A.prev=34,A.t1=A.catch(28),!(T<w-1&&A.t1.code==Xn.DWTPortNotReady)){A.next=40;break}return A.next=39,new ge.Promise(function(D,M){setTimeout(function(){D()},300)});case 39:return A.abrupt("continue",41);case 40:throw A.t1;case 41:T++,A.next=27;break;case 44:return A.prev=44,St.bDWTLoading=!1,Em(),A.finish(44);case 48:A.next=62;break;case 50:return A.prev=50,A.t2=A.catch(13),zA(A.t2.code)||ge.detect.bOK||U.asyncQueue.pushToDo(null,Ce.DWT.Load),GA(A.t2),A.prev=55,A.next=58,s3();case 58:A.next=62;break;case 60:A.prev=60,A.t3=A.catch(55);case 62:case"end":return A.stop()}},y,null,[[3,9],[13,50],[20,,44,48],[28,34],[55,60]])}))),Jt.Orientation={Horizontal:0,Vertical:1},Jt.Direction={LeftToRight:0,RightToLeft:1,TopToBottom:0,BottomToTop:1},Jt.CreationType={Replace:0,AppendChild:1},Jt.AnimationStyle={None:0,Static:1,StaticFull:2,Custom:3,CustomFull:4,Flickering1:10,Flickering2:11,Flickering3:12,LeftToRight1:20,LeftToRight2:21,RightToLeft1:22,RightToLeft2:23,TwoWay:24},Jt.prototype.finishLoading=function(){var y,C=this;C.wrapperElement=null,C.backgroundElement=null,C.valueElement=null,C.leftElement=null,C.middleElement=null,C.rightElement=null,C.backgroundElement=document.createElement("DIV"),C.backgroundElement.className="progressbar_background"+(C.extraClassName.background?" ":"")+C.extraClassName.background,C.backgroundElement.style.cssText=C.backgroundElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius),C.parentElement.appendChild(C.backgroundElement);var x=["border-radius","border-bottom-right-radius","-moz-border-radius-bottomright","-webkit-border-bottom-right-radius","-khtml-border-radius-bottomright","-khtml-border-bottom-right-radius"],w=0,T="";for(w=0;w<x.length&&!(T=Jt._elementCurrentStyle(C.backgroundElement,x[w]))&&"string"!=typeof T;w++);""!=T&&Jt._parseInt(T)!=C.borderRadius&&(C.borderRadius=Jt._parseInt(T)),C.displayType=C.orientation==Jt.Orientation.Horizontal||C.orientation==Jt.Orientation.Vertical?0:1,C.parentElement.className=(""!=C.parentElement.className?" ":"")+"progressbar_parent dynamsoft-progressBar"+(C.extraClassName.parent?" ":"")+C.extraClassName.parent,0==C.displayType?((y=C.wrapperElement=document.createElement("DIV")).style.border="1px solid #A0A0A0",y.style.cssFloat="left",y.style.display="inline-block",y.style.width=C.width+"px",y.style.height=C.height+"px",y.style.left="0px",y.style.top=-C.height+"px",y.style.backgroundColor=C.backColor,y.style.backgroundRepeat="no-repeat",y.style.position="relative",y.style.cssText=y.style.cssText+Jt._createBorderRadiusCss(C.borderRadius),C.parentElement.appendChild(y),C.borderWidth={left:Jt._parseInt(Jt._elementCurrentStyle(y,"border-left-width")),right:Jt._parseInt(Jt._elementCurrentStyle(y,"border-right-width")),top:Jt._parseInt(Jt._elementCurrentStyle(y,"border-top-width")),bottom:Jt._parseInt(Jt._elementCurrentStyle(y,"border-bottom-width"))}):1==C.displayType&&(C.orientation==Jt.Orientation.Horizontal?C.borderRadius>C.width/2&&(C.borderRadius=C.width):C.orientation==Jt.Orientation.Vertical&&C.borderRadius>C.height/2&&(C.borderRadius=C.height),C.valueElement=document.createElement("DIV"),C.valueElement.className="",C.leftElement=document.createElement("DIV"),C.middleElement=document.createElement("DIV"),C.rightElement=document.createElement("DIV"),C.leftElement.style.border="1px solid #A0A0A0",C.leftElement.style.cssFloat="left",C.leftElement.style.display="inline-block",C.leftElement.style.backgroundColor=C.backColor,C.leftElement.style.backgroundRepeat="no-repeat",C.leftElement.style.position="relative",C.rightElement.style.border="1px solid #A0A0A0",C.rightElement.style.cssFloat="left",C.rightElement.style.display="inline-block",C.rightElement.style.backgroundColor=C.backColor,C.rightElement.style.backgroundRepeat="no-repeat",C.rightElement.style.position="relative",C.middleElement.style.border="1px solid #A0A0A0",C.middleElement.style.cssFloat="left",C.middleElement.style.display="inline-block",C.middleElement.style.overflow="hidden",C.middleElement.style.position="relative",C.valueElement.style.backgroundColor=C.backColor,C.valueElement.style.position="relative",C.orientation==Jt.Orientation.Horizontal?(C.leftElement.style.width=C.borderRadius+"px",C.leftElement.style.height=C.height+"px",C.leftElement.style.top=-C.height+"px",C.leftElement.style.left="0px",C.leftElement.style.borderRight="none",C.leftElement.style.cssText=C.leftElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius,0,0,C.borderRadius),C.rightElement.style.width=C.borderRadius+"px",C.rightElement.style.height=C.height+"px",C.rightElement.style.top=-C.height+"px",C.rightElement.style.borderLeft="none",C.rightElement.style.cssText=C.rightElement.style.cssText+Jt._createBorderRadiusCss(0,C.borderRadius,C.borderRadius,0),C.middleElement.style.width=C.width-2*C.borderRadius+"px",C.middleElement.style.height=C.height+"px",C.middleElement.style.top=-C.height+"px",C.middleElement.style.borderLeft="none",C.middleElement.style.borderRight="none",C.valueElement.style.width="0px",C.valueElement.style.height=C.height+"px"):C.orientation==Jt.Orientation.Vertical&&(C.leftElement.style.width=C.width+"px",C.leftElement.style.height=C.borderRadius+"px",C.leftElement.style.top=-C.height+"px",C.leftElement.style.left="0px",C.leftElement.style.borderBottom="none",C.leftElement.style.cssText=C.leftElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius,C.borderRadius,0,0),C.rightElement.style.width=C.width+"px",C.rightElement.style.height=C.borderRadius+"px",C.rightElement.style.top=-C.height+"px",C.rightElement.style.left="0px",C.rightElement.style.borderTop="none",C.rightElement.style.cssText=C.rightElement.style.cssText+Jt._createBorderRadiusCss(0,0,C.borderRadius,C.borderRadius),C.middleElement.style.width=C.width+"px",C.middleElement.style.height=C.height-2*C.borderRadius+"px",C.middleElement.style.top=-C.height+"px",C.middleElement.style.left="0px",C.middleElement.style.borderTop="none",C.middleElement.style.borderBottom="none",C.valueElement.style.width=C.width+"px",C.valueElement.style.height="0px"),C.middleElement.appendChild(C.valueElement),C.parentElement.appendChild(C.leftElement),C.parentElement.appendChild(C.middleElement),C.parentElement.appendChild(C.rightElement),C.orientation==Jt.Orientation.Horizontal?C.borderWidth={left:Jt._parseInt(Jt._elementCurrentStyle(C.leftElement,"border-left-width")),right:Jt._parseInt(Jt._elementCurrentStyle(C.rightElement,"border-right-width")),top:Jt._parseInt(Jt._elementCurrentStyle(C.middleElement,"border-top-width")),bottom:Jt._parseInt(Jt._elementCurrentStyle(C.middleElement,"border-bottom-width"))}:C.orientation==Jt.Orientation.Vertical&&(C.borderWidth={left:Jt._parseInt(Jt._elementCurrentStyle(C.middleElement,"border-left-width")),right:Jt._parseInt(Jt._elementCurrentStyle(C.middleElement,"border-right-width")),top:Jt._parseInt(Jt._elementCurrentStyle(C.leftElement,"border-top-width")),bottom:Jt._parseInt(Jt._elementCurrentStyle(C.rightElement,"border-bottom-width"))})),C.parentElement.style.width=C.width+C.borderWidth.left+C.borderWidth.right+"px",C.parentElement.style.height=C.height+C.borderWidth.top+C.borderWidth.bottom+"px",C.backgroundElement.style.cssFloat="left",C.backgroundElement.style.display="inline-block",C.backgroundElement.style.width=C.width+C.borderWidth.left+C.borderWidth.right+"px",C.backgroundElement.style.height=C.height+"px",C.backgroundElement.style.backgroundColor="#FFFFFF",C.backgroundElement.style.position="relative",0==C.displayType&&(C.backgroundElement.style.width=C.width+C.borderWidth.left+C.borderWidth.right+"px"),C.backgroundElement.style.top=C.borderWidth.top+"px",C.markerElement=document.createElement("DIV"),C.markerElement.style.display="inline-block",C.markerElement.style.zoom="1.0",C.markerElement.style.width=C.width+"px",C.markerElement.style.height=C.height+"px",C.markerElement.style.top=2*-C.height-C.borderWidth.top+"px",C.markerElement.style.left=C.borderWidth.left+"px",C.markerElement.style.backgroundColor=C.color,C.markerElement.style.lineHeight=C.height+"px",C.markerElement.style.position="relative",C.parentElement.appendChild(C.markerElement),C.isLoaded=!0,C.setValue(C.initialValue),null!=C.onLoad&&C.onLoad()},Jt.prototype.setValue=function(y){var C=this;if(null!==y&&y<C.minValue&&(y=C.minValue),null!==y&&y>C.maxValue&&(y=C.maxValue),null===y||(C.value=y),C.isLoaded){var x,w=0;if(C.orientation==Jt.Orientation.Horizontal){C.progressPosition=w=C.value/C.maxValue*C.width,0==C.displayType||1==C.displayType&&(C.direction==Jt.Direction.LeftToRight?C.valueElement.style.width=w<=C.borderRadius?"0px":w>=C.width-C.borderRadius?C.middleElement.style.width:w-C.borderRadius+"px":w<=C.borderRadius?C.valueElement.style.width="0px":w>=C.width-C.borderRadius?(C.valueElement.style.left="0px",C.valueElement.style.width=C.middleElement.style.width):(C.valueElement.style.left=C.width-w-C.borderRadius+"px",C.valueElement.style.width=w-C.borderRadius+"px")),w>0?(C.markerElement.style.width=C.animationStyle!=Jt.AnimationStyle.StaticFull&&C.animationStyle!=Jt.AnimationStyle.CustomFull?w+"px":C.width+"px",C.markerElement.style.visibility="visible"):(C.markerElement.style.width=C.width+"px",C.animationStyle!=Jt.AnimationStyle.StaticFull&&C.animationStyle!=Jt.AnimationStyle.CustomFull&&(C.markerElement.style.visibility="hidden")),C.markerElement.style.left=C.animationStyle!=Jt.AnimationStyle.StaticFull&&C.animationStyle!=Jt.AnimationStyle.CustomFull?C.direction==Jt.Direction.LeftToRight?C.borderWidth.left+"px":C.width-w+C.borderWidth.left+"px":C.borderWidth.left+"px";var T=2*-C.height-C.borderWidth.top;if(0==w||C.width==w)C.markerElement.style.top=T+"px",C.markerElement.style.height=C.height+"px",C.markerElement.style.cssText=C.markerElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius);else if(w<C.borderRadius){var A=C.height-2.25*(C.borderRadius-Math.sqrt(Math.pow(C.borderRadius,2)-Math.pow(C.borderRadius-w,2)));C.markerElement.style.top=T+C.height/2-A/2+"px",C.markerElement.style.height=A+"px",C.markerElement.style.cssText=C.direction==Jt.Direction.LeftToRight?C.markerElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius,0,0,C.borderRadius):C.markerElement.style.cssText+Jt._createBorderRadiusCss(0,C.borderRadius,C.borderRadius,0)}else C.width-w<C.borderRadius?(x=(2*(C.borderRadius-(C.width-w))+(C.borderRadius-Math.sqrt(Math.pow(C.borderRadius,2)-Math.pow(C.borderRadius-(C.width-w),2))))/3,C.markerElement.style.cssText=C.direction==Jt.Direction.LeftToRight?C.markerElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius,x,x,C.borderRadius):C.markerElement.style.cssText+Jt._createBorderRadiusCss(x,C.borderRadius,C.borderRadius,x)):(C.markerElement.style.top=T+"px",C.markerElement.style.height=C.height+"px",C.markerElement.style.cssText=C.direction==Jt.Direction.LeftToRight?C.markerElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius,0,0,C.borderRadius):C.markerElement.style.cssText+Jt._createBorderRadiusCss(0,C.borderRadius,C.borderRadius,0))}else if(C.orientation==Jt.Orientation.Vertical){C.progressPosition=w=C.value/C.maxValue*C.height,0==C.displayType||1==C.displayType&&(C.direction==Jt.Direction.TopToBottom?C.valueElement.style.height=w<=C.borderRadius?"0px":w>=C.height-C.borderRadius?C.middleElement.style.height:w-C.borderRadius+"px":w<=C.borderRadius?C.valueElement.style.height="0px":w>=C.height-C.borderRadius?(C.valueElement.style.top="0px",C.valueElement.style.height=C.middleElement.style.height):(C.valueElement.style.top=C.height-w-C.borderRadius+"px",C.valueElement.style.height=w+2*C.borderRadius+"px")),w>0?(C.animationStyle!=Jt.AnimationStyle.StaticFull&&C.animationStyle!=Jt.AnimationStyle.CustomFull?C.markerElement.style.height=w+"px":(C.markerElement.style.height=C.height+"px",C.markerElement.style.cssText=C.markerElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius)),C.markerElement.style.visibility="visible"):(C.markerElement.style.height="0px",C.animationStyle!=Jt.AnimationStyle.StaticFull&&C.animationStyle!=Jt.AnimationStyle.CustomFull&&(C.markerElement.style.visibility="hidden"));var M=C.borderWidth.left;if(0==w||C.height==w)C.markerElement.style.left=M+"px",C.markerElement.style.width=C.width+"px",C.markerElement.style.cssText=C.markerElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius);else if(w<C.borderRadius){var B=2.5*w;B>C.width&&(B=C.width),C.markerElement.style.left=M+C.width/2-B/2+"px",C.markerElement.style.width=B+"px",C.markerElement.style.cssText=C.direction==Jt.Direction.BottomToTop?C.markerElement.style.cssText+Jt._createBorderRadiusCss(0,0,C.borderRadius,C.borderRadius):C.markerElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius,C.borderRadius,0,0)}else C.height-w<C.borderRadius?(x=(2*(C.borderRadius-(C.height-w))+(C.borderRadius-Math.sqrt(Math.pow(C.borderRadius,2)-Math.pow(C.borderRadius-(C.height-w),2))))/3,C.markerElement.style.cssText=C.direction==Jt.Direction.BottomToTop?C.markerElement.style.cssText+Jt._createBorderRadiusCss(x,x,C.borderRadius,C.borderRadius):C.markerElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius,C.borderRadius,x,x)):(C.markerElement.style.left=M+"px",C.markerElement.style.width=C.width+"px",C.markerElement.style.cssText=C.direction==Jt.Direction.BottomToTop?C.markerElement.style.cssText+Jt._createBorderRadiusCss(0,0,C.borderRadius,C.borderRadius):C.markerElement.style.cssText+Jt._createBorderRadiusCss(C.borderRadius,C.borderRadius,0,0));C.markerElement.style.top=C.animationStyle!=Jt.AnimationStyle.StaticFull&&C.animationStyle!=Jt.AnimationStyle.CustomFull?C.direction==Jt.Direction.TopToBottom?2*-C.height-C.borderWidth.top+"px":-C.height-w-C.borderWidth.top+"px":2*-C.height-C.borderWidth.top+"px"}C.progress=C.value/C.maxValue}null!=C.onValueChanged&&C.onValueChanged()},Jt._elementCurrentStyle=function(y,C){if(y.currentStyle){var x=0,w="",T=!1;for(x=0;x<C.length;x++)"-"!=C[x].toString()?(w+=T?C[x].toString().toUpperCase():C[x].toString(),T=!1):T=!0;return y.currentStyle[C=w]}return getComputedStyle(y,null).getPropertyValue(C)},Jt._parseInt=function(y){var C=parseInt(y);return isNaN(C)&&(C=0),C},Jt._createBorderRadiusCss=function(y,C,x,w){return null!=y&&null==C&&null==x&&null==w?"; -moz-border-radius: "+y+"px; -ms-border-radius: "+y+"px; -o-border-radius: "+y+"px; -webkit-border-radius: "+y+"px; -khtml-border-radius: "+y+"px; border-radius: "+y+"px;":"; -moz-border-radius: "+(y=y||0)+"px "+(C=C||0)+"px "+(x=x||0)+"px "+(w=w||0)+"px; -ms-border-radius: "+y+"px "+C+"px "+x+"px "+w+"px; -o-border-radius: "+y+"px "+C+"px "+x+"px "+w+"px; -webkit-border-radius: "+y+"px "+C+"px "+x+"px "+w+"px; -khtml-border-radius: "+y+"px "+C+"px "+x+"px "+w+"px; border-radius: "+y+"px "+C+"px "+x+"px "+w+"px;"};var yqe=g(function y(){l(this,y),Dn(this,"handlers",{})},[{key:"on",value:function(y,C){var x=U.guid();return this.handlers[y]||(this.handlers[y]=[]),this.handlers[y].push({id:x,handler:C}),x}},{key:"off",value:function(y,C){if(this.handlers[y]){var x,w=this.handlers[y];if(C){for(x=0;x<w.length;x++)if(w[x].id==C){w.splice(x,1);break}}else w.splice(0)}}},{key:"fire",value:function(y){if(this.handlers[y]){var C,x=this.handlers[y];for(C=0;C<x.length;C++)x[C].handler();return x.length}return 0}},{key:"clear",value:function(){this.handlers={}}}]),_qe=Ce.DWT;ge.ProgressBar=Jt,ge.progressMessage="",ge.dialogShowStatus=!1,ge.needShowTwiceShowDialog=!1,ge.dlgProgress=!1,ge.cancelFrom=Zn.Other,ge.dlgRef=0,ge.initProgress=function(y){var C,x;if(!ge.dlgProgress){(x=[]).push('<dialog class="dynamsoft-dwt-dialogProgress" closed="closed" style="top:30%"><div class="ds-dwt-progressWrap">'),x.push('<h3 class="dynamsoft-finalMessage"> </h3>'),x.push('<p class="dynamsoft-desc"> </p><p class="dynamsoft-status">0%</p>'),x.push(de.bIE?'<div class="dynamsoft-progressBar" value="" max="100"></div>':'<progress class="dynamsoft-progressBar" value="" max="100"></progress>'),x.push('<br /><div style="width:100%;text-align:center"><button class="dynamsoft-btnCancel" value="cancel" autofcus>cancel</button></div>'),x.push("</div></dialog>"),(C=ft.one(".dynamsoft-dwt-dialogProgress"))&&C.getEL()&&C.remove();var w=ge.parseHTML(x.join(""));if(w&&w.length>0&&document.body.appendChild(w[0]),de.bIE){var T=ft.one(".dynamsoft-progressBar"),A=T&&T.getEL();A&&(A.objProgressBar=new Jt(A,{width:280,height:20}))}(C=ft.one(".dynamsoft-dwt-dialogProgress"))&&C.getEL()&&(ge.dlgProgress=C[0],ft.dialog.setup(ge.dlgProgress)),ge.dlgRef=0,ge.dialogShowStatus=!1,ge.cancelFrom=Zn.Other}},ge.showProgressMsg=function(){};var Cqe=function(y){function C(){return l(this,C),x=this,T=arguments,w=qn(w=C),$a(x,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(A){return!1}}()?Reflect.construct(w,T||[],qn(x).constructor):w.apply(x,T));var x,w,T}return qa(C,y),g(C)}(yqe);ge.progressContext=new Cqe;var ipe=function(){var y=ge.progressContext;if(y){var C,x=y.fire("cancel");if(x>=1)for(C=0;C<x;C++)ge.closeProgress(null,"");else y.__cancelBeforObjectCreated&&(ge.closeProgress(null,""),y.__clickCancel=!0)}};ge.hideProgress=function(){var y=ge.progressContext;y&&(y.IfShowProgressBar=!1,y.IfShowCancelDialogWhenImageTransfer=!1,y.off("cancel"),y._onPercent=null)},ge.showProgress=function(y,C,x){var w,T=y;if(T.IfShowProgressBar)if(ge.progressContext&&(ge.progressContext.IfShowProgressBar=!0,ge.progressContext.IfShowCancelDialogWhenImageTransfer=T.IfShowCancelDialogWhenImageTransfer),ge.dlgRef>0)ge.dlgRef++;else{var A;if((w=Ce.DWT.IfConfineMaskWithinTheViewer)?T._isNoViewer&&T._isNoViewer()?A=document.body:T._containerElement?A=T._containerElement:Ce.DWT.Containers&&Ce.DWT.Containers.length>0&&Ce.DWT.Containers[0].ContainerId&&(A=U.get(Ce.DWT.Containers[0].ContainerId))||(A=document.body):A=document.body,A&&A!==document.body){var D=!1,M=A.firstElementChild;if(M&&M!==ge.dlgProgress&&"dvs-root dvs-web-viewer"==M.className&&(A=M,D=!0),0==D)for(var B=0;B<A.children.length;B++)if((M=A.children[B])&&M!==ge.dlgProgress&&"dvs-root dvs-web-viewer"==M.className){A=M;break}var H=ge.progressContext;""!==A.style.position&&"static"!==A.style.position||(A.style.position="relative",H.progressContainer={el:A})}U.log("showProgress:"+C+",bCancel:"+x),ge.dlgProgress&&A.appendChild(ge.dlgProgress),Mp(x);var Y=ft.one(".dynamsoft-btnCancel");if(Y&&Y.getEL()&&(U.removeEventListener(Y[0],"click",ipe),U.addEventListener(Y[0],"click",ipe)),0==ge.dialogShowStatus){ge.dlgProgress&&(w&&A&&A!==document.body?ft.dialog.setup(ge.dlgProgress,!0):ft.dialog.setup(ge.dlgProgress),ge.dlgProgress.showModal()),ge.dialogShowStatus=!0;var G=ft.one(".dynamsoft-finalMessage"),q=ft.one(".dynamsoft-progressBar"),re=q&&q.getEL(),se=ft.one(".dynamsoft-status");G&&G.getEL()&&G.html(""),se&&se.getEL()&&se.html("0%"),re&&(de.bIE&&re.objProgressBar?re.objProgressBar.setValue(0):re.value=0)}ge.dlgRef++}else ge.hideProgress()},ge.closeProgress=function(y,C){var x=ge.progressContext;U.log("closeProgress:"+C),x&&x.IfShowProgressBar?(ge.dlgRef--,ge.dlgRef<=0&&(ge.dlgRef=0)):ge.dlgRef=0,0==ge.dlgRef&&(x.off("cancel"),x._onPercent=null,1==ge.dialogShowStatus&&(ge.dlgProgress&&(ge.dlgProgress.close(),ge.dlgProgress&&document.body.appendChild(ge.dlgProgress),x&&x.progressContainer&&x.progressContainer.el&&(x.progressContainer.el.style.position="",x.progressContainer=null)),ge.dialogShowStatus=!1),ge.cancelFrom=Zn.Other)},_qe.RemoveAllAuthorizations=function(){var y=sd.item("DWT_port"),C="http://";return"true"==sd.item("DWT_ssl")&&(C="https://"),ru({method:"GET",xhrFields:{withCredentials:!0},url:[C,Ya(),":",y,"/dwt/",St.getDWTPrefix(),St.getServerVersionInfo(),"/RemoveAllAuthorizations?t=",U.now()].join(""),async:!0}),!0};var bqe={upload:"Uploading...",download:"Downloading...",load:"Processing...",decode:"Processing...",decodeTIFF:"Processing tiff...",decodePDF:"Processing pdf...",encodeTIFF:"Processing tiff...",encodePDF:"Processing pdf...",encode:"Processing...",transfer:"Transferring..."};ge.progressBarOnPercentDone=function(y,C,x,w,T,A){var D,M=ft.one(".dynamsoft-progressBar"),B=ft.one(".dynamsoft-status"),H=ft.one(".dynamsoft-finalMessage"),Y=ft.one(".dynamsoft-desc");if(Ce.DWT.UseDefaultViewer&&Ce.DWT.IfConfineMaskWithinTheViewer&&A&&(M=ft.one(".dynamsoft-progressBar",A),B=ft.one(".dynamsoft-status",A),H=ft.one(".dynamsoft-finalMessage",A),Y=ft.one(".dynamsoft-desc",A)),ge.cancelFrom==Zn.FTPUpload||ge.cancelFrom==Zn.FTPDownload){var G=x;0==G?ge.setBtnCancelVisibleForProgress(!1):1==G&&ge.setBtnCancelVisibleForProgress(!0)}else ge.cancelFrom==Zn.HTTPUpload||ge.cancelFrom==Zn.LoadImage||ge.cancelFrom==Zn.HTTPPut?"Processing..."==C&&ge.setBtnCancelVisibleForProgress(!1):ge.cancelFrom==Zn.ConvertToBlob&&(-1==y||ge.setBtnCancelVisibleForProgress(!1),100==w&&(C="",ge.progressMessage="Processing..."));if(y<0?(ge.progressMessage=C,D=ge.progressMessage):D=""!=C&&"1/1"!=C?ge.progressMessage+"("+C+")":ge.progressMessage,H&&H.getEL()){var q="",re="";D.indexOf(" ...")&&(D=D.replace(" ...","...")),-1!=D.indexOf("(")?(q=D.substr(0,D.indexOf("(")),re=D.substr(D.indexOf("("))):q=D,U.each(bqe,function(ce,ve){-1!=ce.indexOf(q)&&(D=Ms.customProgressText[ve]+re)}),""==D&&(D="&nbsp;"),H.html(D)}if(T?(""==T||U.isUndefined(T)?T="&nbsp;":U.isString(T)&&T.length>30&&(T=T.substring(0,30)+"..."),Y.html(T)):Y.html("&nbsp;"),(w||0===w)&&(B&&B.getEL()&&B.html(w+"%"),M&&M.getEL())){var se=w;se>99&&(se=99),de.bIE?M[0].objProgressBar?M[0].objProgressBar.setValue(se):M[0].value=se:(de.bEdge&&(M[0].style.display=""),M[0].value=se)}ge.dlgRef<=0&&setTimeout(function(){M&&M.getEL()&&(de.bIE?M[0].objProgressBar?M[0].objProgressBar.setValue(0):M[0].value=0:(de.bEdge&&(M[0].style.display="none"),M[0].value=0))},1e3)};var Tf=Ce.DWT;Tf.CloseDialog=function(){var y=ge.install._dlgInstall;if(y){var C=U.sizzle(".dynamsoft-dialog-close");U.each(C,function(x,w){U.removeEventListener(x,"click",Tf.CloseDialog)}),y.open&&y.close(),document.body.removeChild(y),ge.install._dlgInstall=!1}},Tf.ShowDialog=function(y,C,x,w,T){if(!1!==x){var A,D={width:y,height:C,position:"absolute"};w?(A=['<div class="dynamsoft-dwt-dialog-body">',x,"</div>"].join(""),D.closeButton=!1):A=['<div class="ds-dwt-ui-showdlg">','<div class="dynamsoft-dwt-dialog-body">','<div class="dynamsoft-dwt-dlg-header">',T?"":'<div class="dynamsoft-dialog-close"></div>',"</div>",x,"</div>","</div>"].join(""),T&&(D.closeButton=!1),Tf.ShowMessage(A,D)}},Tf.ShowMessage=function(y,C){var x,w,T,A,D,M=ge.install,B="ds-dwt-ui-dlg",H="ds-dwt-ui-dlg-wrap",Y=screen.width,G=!0,q=0,re=!0,se=!0,ce=0,ve="fixed",Te="Error",Ue=St.bActiveXEdition,je=!1,Ee=null;if(C&&(x=C.width,w=C.height,C.seconds&&(q=C.seconds),C.headerStyle&&(ce=C.headerStyle),1==C.backgroundStyle&&(je=!0),!1===C.closeButton&&(re=!1),C.bAutoClose&&(T=C.bAutoClose,re=!0),0==C.bReadyClosed&&(G=!1),C.position&&(ve=C.position),C.caption&&(Te=C.caption),U.isFunction(C.onClose)&&(Ee=C.onClose)),x?x>Y-10&&(x=Y-10):x=Y>600?600:Y-10,w||(w="100%"),1==ce?y=['<div class="dynamsoft-dialog">','<div class="dynamsoft-dwt-dialog-body">','<div class="dynamsoft-dwt-dlg-header">',re?'<div class="dynamsoft-dialog-close"></div>':"","</div>",y,"</div></div>"].join(""):2==ce&&(y=['<div class="dynamsoft-dialog">','<div class="dynamsoft-dwt-ltsdlg-header"><span style="color:#FFF;line-height:35px;margin-left:15px">',Te,"</span>",re?'<div class="dynamsoft-dialog-close"></div>':"","</div>",'<div class="dynamsoft-dwt-ltsdlg-body" style="padding:25px 40px 20px 40px;">',y,"</div></div>"].join("")),0==U.sizzle("."+B).length){var Oe=document.createElement("div"),He=document.createElement("div"),we=document.createElement("div");if(Oe.className=B,He.className=H,He.style.margin="auto",He.style.zIndex="9999",He.style.position="relative",He.style.border="0",T&&((A=document.createElement("div")).className="dynamsoft-dialog-close",He.insertBefore(A,He.firstElementChild),(D=document.createElement("div")).className="dynamsoft-dialog-closeTimer",D.style.width="100%",D.style.height="2px",D.style.marginTop="-2px",D.style.backgroundColor="#fe8e14",He.insertBefore(D,He.firstElementChild)),He.appendChild(we),we.innerHTML=y,Oe.appendChild(He),document.body.appendChild(Oe),Ee){var ue=ft.one(".dynamsoft-dialog-close",ft.one(Oe));ue&&((ue=ue[0]).onClose=function(){U.removeEventListener(ue,"click",ue.onClose),ue.onClose=null,Ee()},U.addEventListener(ue,"click",ue.onClose))}if(ft.setBackOpacity(je?{opacity:.4,grayHex:0}:{}),Oe.bTopmost=!0,M._dlgInstall=Oe,ft.dialog.setup(M._dlgInstall,!1),de.bIE){var pe=document.createElement("iframe");pe.frameborder="0",pe.marginheight="0",pe.marginwidth="0",pe.style.border="0",pe.style.backgroundColor="transparent",pe.style.position="absolute",pe.style.left=0,pe.style.top=0,pe.style.width="100%",pe.style.height=document.body.clientHeight+"px",pe.style.margin="0 auto",pe.style.zIndex="10000",pe.src=["javas","cript:",'""'].join("");var ye=ft.one(".dynamsoft-backdrop");ye&&ye.length>0&&(ye[0].innerHTML="",ye[0].style.zIndex="10000",ye[0].appendChild(pe))}}else se=!1;var me=ft.one("."+H);if(me&&me.getEL()&&(me[0].style.width=x+"px",me[0].style.height=U.isNumber(w)&&w>0?w+"px":"100%",se||U.each(me[0].childNodes,function(ze){if("DIV"==ze.tagName&&"dynamsoft-dialog-close"!=ze.className&&"dynamsoft-dialog-closeTimer"!=ze.className)return ze.innerHTML=y,!1})),Ue){var Se=ft.one(".dynamsoft-dialog");Se&&Se.getEL()&&(Se.getEL().style.border="1px solid #999")}if(M._dlgInstall.open&&M._dlgInstall.close(),M._dlgInstall.showModal({position:ve}),M._dlgInstall.bReadyClosed=G,je&&ft.setBackOpacity({}),re){var We=U.sizzle(".dynamsoft-dialog-close");U.each(We,function(ze,Be){U.addEventListener(ze,"click",Tf.CloseDialog)}),We.length>0&&T&&q>0&&setTimeout(ge._zdgb_xkz_dhk,100)}},Tf.OnWebTwainPreExecute||(Tf.OnWebTwainPreExecute=function(y,C){var x,w,T=Ce.DWT.IfConfineMaskWithinTheViewer;if(T&&(y&&(w=y._containerElement),w||Ce.DWT.Containers&&Ce.DWT.Containers.length>0&&Ce.DWT.Containers[0].ContainerId&&(w=U.get(Ce.DWT.Containers[0].ContainerId)),w)){x=w.getBoundingClientRect();for(var A=0;A<w.children.length;A++){var D=w.children[A];if(D&&"dvs-root dvs-web-viewer"==D.className){for(D=D.firstElementChild;D;){if(U.isFunction(D.getBoundingClientRect)){x=D.getBoundingClientRect();break}D=D.nextSibling}w=D;break}}}(w===document.body||null==x||Ce.DWT.Containers&&Ce.DWT.Containers.length>1||Ce.DWT.Containers&&1==Ce.DWT.Containers.length&&(0==x.width||0==x.height))&&(T=!1,w=null);var M=null!=C?C:{};T&&(M={confined:T,wrapperEl:w}),ge.showMask(M)}),Tf.OnWebTwainPostExecute||(Tf.OnWebTwainPostExecute=function(){ft.hideMask()}),window.DCP_DWT_OnClickCloseInstall=function(y,C){C||Ce.DWT.CloseDialog();var x=U.get(ge.install._divDWTNonInstallContainerID);if(x&&x.parentNode&&x.parentNode.removeChild(x),y&&U.isDOM(y)&&U.show(y),y&&U.isString(y))U.show(y);else{var w=Ce.DWT.WebTwainIdMap;if(w){var T,A,D=Object.keys(w);for(T=0;T<D.length;T++)w[A=D[T]]._containerElement&&U.show(w[A]._containerElement)}}""!=ge.install._divDWTemessageContainer&&U.show(ge.install._divDWTemessageContainer)},(ge.__ver||0)<20230515&&(U.mix(ge,ft),ge.__ver=20230515),ge.bNode=zne,ge._defaultAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36",ge._defaultPlatform="Win64",ge.timestamp="?t=20240509141451",U.mix(ge,ed),ge.ajax=ru,ge.fetch=X1,ge.detect.showMask=_B,ge.detect.hideMask=CB,ge.env=Po,ge.product=St,ge.scannerInfo=xo,ge.License=pn,ge.BIO=mm,ge.UI.ImageUIView=F$e,ge.UI.ImageManager=sfe,Ce.MSG=Lr,Ce.navInfoSync=de,ge.domReady=q1,function y(){if(!window||document&&document.body){var C=document;if("complete"!==C.readyState)if(lB(window,"load",$1),aB)lB(C,Zle,function A(){cB(C,Zle,A),$1()});else{var x,w,T;lB(C,ece,function A(){"complete"===C.readyState&&(cB(C,ece,A),$1())}),T=(w=C&&C.documentElement)&&w.doScroll;try{x=null===window.frameElement}catch(A){x=!1}T&&x&&function A(){try{T("left"),setTimeout($1,30)}catch(D){setTimeout(A,40)}}()}else $1()}else setTimeout(y,100)}(),q1(function(){if(Ce.DWT.CustomizableDisplayInfo||(Ce.DWT.CustomizableDisplayInfo=Ms),de.bIE){Ce.DWT.CustomizableDisplayInfo.loaderBarSourceIE||(Ce.DWT.CustomizableDisplayInfo.loaderBarSourceIE=Sf.loaderBarSourceIE);try{document.execCommand("BackgroundImageCache",!1,!0)}catch(y){}}}),Ce.Ready=function(y){if(!Ce.navInfo)return rB().then(function(C){Ce.navInfo=C;try{y()}catch(x){throw U.log(x.stack||x,"error"),x}});try{y()}catch(C){throw U.log(C.stack||C,"error"),C}}}(),Ie.navInfoSync.bIE)&&(function(p){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=p();else if("function"==typeof define&&define.amd)define([],p);else{var l;"undefined"!=typeof window?l=window:"undefined"!=typeof global?l=global:"undefined"!=typeof self&&(l=self),l.Promise=p()}}(function(){return function f(g,m,v){function _(I,k){if(!m[I]){if(!g[I]){var O="function"==typeof _dereq_&&_dereq_;if(!k&&O)return O(I,!0);if(b)return b(I,!0);var j=new Error("Cannot find module '"+I+"'");throw j.code="MODULE_NOT_FOUND",j}var W=m[I]={exports:{}};g[I][0].call(W.exports,function(J){return _(g[I][1][J]||J)},W,W.exports,f,g,m,v)}return m[I].exports}for(var b="function"==typeof _dereq_&&_dereq_,S=0;S<v.length;S++)_(v[S]);return _}({1:[function(f,g,m){g.exports=function(v){function _(S){var I=new b(S),k=I.promise();return I.setHowMany(1),I.setUnwrap(),I.init(),k}var b=v._SomePromiseArray;v.any=function(S){return _(S)},v.prototype.any=function(){return _(this)}}},{}],2:[function(f,g,m){function v(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new W(16),this._normalQueue=new W(16),this._haveDrainedQueues=!1;var J=this;this.drainQueues=function(){J._drainQueues()},this._schedule=j}function I(J){for(;J.length()>0;)k(J)}function k(J){var K=J.shift();if("function"!=typeof K)K._settlePromises();else{var Q=J.shift(),ie=J.shift();K.call(Q,ie)}}var O;try{throw new Error}catch(J){O=J}var j=f("./schedule"),W=f("./queue");v.prototype.setScheduler=function(J){var K=this._schedule;return this._schedule=J,this._customScheduler=!0,K},v.prototype.hasCustomScheduler=function(){return this._customScheduler},v.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},v.prototype.fatalError=function(J,K){K?(process.stderr.write("Fatal "+(J instanceof Error?J.stack:J)+"\n"),process.exit(2)):this.throwLater(J)},v.prototype.throwLater=function(J,K){if(1===arguments.length&&(K=J,J=function(){throw K}),"undefined"!=typeof setTimeout)setTimeout(function(){J(K)},0);else try{this._schedule(function(){J(K)})}catch(Q){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},v.prototype.invokeLater=function _(J,K,Q){this._lateQueue.push(J,K,Q),this._queueTick()},v.prototype.invoke=function b(J,K,Q){this._normalQueue.push(J,K,Q),this._queueTick()},v.prototype.settlePromises=function S(J){this._normalQueue._pushOne(J),this._queueTick()},v.prototype._drainQueues=function(){I(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,I(this._lateQueue)},v.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},v.prototype._reset=function(){this._isTickUsed=!1},g.exports=v,g.exports.firstLineError=O},{"./queue":26,"./schedule":29}],3:[function(f,g,m){g.exports=function(v,_,b,S){var I=!1,k=function(J,K){this._reject(K)},O=function(J,K){K.promiseRejectionQueued=!0,K.bindingPromise._then(k,k,null,this,J)},j=function(J,K){0==(50397184&this._bitField)&&this._resolveCallback(K.target)},W=function(J,K){K.promiseRejectionQueued||this._reject(J)};v.prototype.bind=function(J){I||(I=!0,v.prototype._propagateFrom=S.propagateFromFunction(),v.prototype._boundValue=S.boundValueFunction());var K=b(J),Q=new v(_);Q._propagateFrom(this,1);var ie=this._target();if(Q._setBoundTo(K),K instanceof v){var oe={promiseRejectionQueued:!1,promise:Q,target:ie,bindingPromise:K};ie._then(_,O,void 0,Q,oe),K._then(j,W,void 0,Q,oe),Q._setOnCancel(K)}else Q._resolveCallback(ie);return Q},v.prototype._setBoundTo=function(J){void 0!==J?(this._bitField=2097152|this._bitField,this._boundTo=J):this._bitField=-2097153&this._bitField},v.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},v.bind=function(J,K){return v.resolve(K).bind(J)}}},{}],4:[function(f,g,m){var _;"undefined"!=typeof Promise&&(_=Promise);var b=f("./promise")();b.noConflict=function v(){try{Promise===b&&(Promise=_)}catch(S){}return b},g.exports=b},{"./promise":22}],5:[function(f,g,m){var v=Object.create;if(v){var _=v(null),b=v(null);_[" size"]=b[" size"]=0}g.exports=function(S){function k(Q){var oe=function I(Q,ie){var oe;if(null!=Q&&(oe=Q[ie]),"function"!=typeof oe){var le="Object "+J.classString(Q)+" has no method '"+J.toString(ie)+"'";throw new S.TypeError(le)}return oe}(Q,this.pop());return oe.apply(Q,this)}function O(Q){return Q[this]}function j(Q){var ie=+this;return 0>ie&&(ie=Math.max(0,ie+Q.length)),Q[ie]}var J=f("./util"),K=J.canEvaluate;S.prototype.call=function(Q){var ie=[].slice.call(arguments,1);return ie.push(Q),this._then(k,void 0,void 0,ie,void 0)},S.prototype.get=function(Q){var ie;if("number"==typeof Q)ie=j;else if(K){var le=(void 0)(Q);ie=null!==le?le:O}else ie=O;return this._then(ie,void 0,void 0,Q,void 0)}}},{"./util":36}],6:[function(f,g,m){g.exports=function(v,_,b,S){var I=f("./util"),k=I.tryCatch,O=I.errorObj,j=v._async;v.prototype.break=v.prototype.cancel=function(){if(!S.cancellation())return this._warn("cancellation is disabled");for(var W=this,J=W;W._isCancellable();){if(!W._cancelBy(J)){J._isFollowing()?J._followee().cancel():J._cancelBranched();break}var K=W._cancellationParent;if(null==K||!K._isCancellable()){W._isFollowing()?W._followee().cancel():W._cancelBranched();break}W._isFollowing()&&W._followee().cancel(),W._setWillBeCancelled(),J=W,W=K}},v.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},v.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},v.prototype._cancelBy=function(W){return W===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},v.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},v.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),j.invoke(this._cancelPromises,this,void 0))},v.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},v.prototype._unsetOnCancel=function(){this._onCancelField=void 0},v.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},v.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},v.prototype._doInvokeOnCancel=function(W,J){if(I.isArray(W))for(var K=0;K<W.length;++K)this._doInvokeOnCancel(W[K],J);else if(void 0!==W)if("function"==typeof W){if(!J){var Q=k(W).call(this._boundValue());Q===O&&(this._attachExtraTrace(Q.e),j.throwLater(Q.e))}}else W._resultCancelled(this)},v.prototype._invokeOnCancel=function(){var W=this._onCancel();this._unsetOnCancel(),j.invoke(this._doInvokeOnCancel,this,W)},v.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},v.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(f,g,m){g.exports=function(v){var b=f("./util"),S=f("./es5").keys,I=b.tryCatch,k=b.errorObj;return function _(O,j,W){return function(J){var K=W._boundValue();e:for(var Q=0;Q<O.length;++Q){var ie=O[Q];if(ie===Error||null!=ie&&ie.prototype instanceof Error){if(J instanceof ie)return I(j).call(K,J)}else if("function"==typeof ie){var oe=I(ie).call(K,J);if(oe===k)return oe;if(oe)return I(j).call(K,J)}else if(b.isObject(J)){for(var le=S(ie),he=0;he<le.length;++he){var _e=le[he];if(ie[_e]!=J[_e])continue e}return I(j).call(K,J)}}return v}}}},{"./es5":13,"./util":36}],8:[function(f,g,m){g.exports=function(v){function _(){this._trace=new _.CapturedTrace(S())}function S(){var O=k.length-1;return O>=0?k[O]:void 0}var I=!1,k=[];return v.prototype._promiseCreated=function(){},v.prototype._pushContext=function(){},v.prototype._popContext=function(){return null},v._peekContext=v.prototype._peekContext=function(){},_.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,k.push(this._trace))},_.prototype._popContext=function(){if(void 0!==this._trace){var O=k.pop(),j=O._promiseCreated;return O._promiseCreated=null,j}return null},_.CapturedTrace=null,_.create=function b(){return I?new _:void 0},_.deactivateLongStackTraces=function(){},_.activateLongStackTraces=function(){var O=v.prototype._pushContext,j=v.prototype._popContext,W=v._peekContext,J=v.prototype._peekContext,K=v.prototype._promiseCreated;_.deactivateLongStackTraces=function(){v.prototype._pushContext=O,v.prototype._popContext=j,v._peekContext=W,v.prototype._peekContext=J,v.prototype._promiseCreated=K,I=!1},I=!0,v.prototype._pushContext=_.prototype._pushContext,v.prototype._popContext=_.prototype._popContext,v._peekContext=v.prototype._peekContext=S,v.prototype._promiseCreated=function(){var Q=this._peekContext();Q&&null==Q._promiseCreated&&(Q._promiseCreated=this)}},_}},{}],9:[function(f,g,m){g.exports=function(v,_,b,S){function I(ct,ht){return{promise:ht}}function k(){return!1}function O(ct,ht,Ft){var Wt=this;try{ct(ht,Ft,function(rn){if("function"!=typeof rn)throw new TypeError("onCancel must be a function, got: "+de.toString(rn));Wt._attachCancellationCallback(rn)})}catch(rn){return rn}}function j(ct){if(!this._isCancellable())return this;var ht=this._onCancel();void 0!==ht?de.isArray(ht)?ht.push(ct):this._setOnCancel([ht,ct]):this._setOnCancel(ct)}function W(){return this._onCancelField}function J(ct){this._onCancelField=ct}function K(){this._cancellationParent=void 0,this._onCancelField=void 0}function Q(ct,ht){if(0!=(1&ht)){this._cancellationParent=ct;var Ft=ct._branchesRemainingToCancel;void 0===Ft&&(Ft=0),ct._branchesRemainingToCancel=Ft+1}0!=(2&ht)&&ct._isBound()&&this._setBoundTo(ct._boundTo)}function oe(){var ct=this._boundTo;return void 0!==ct&&ct instanceof v?ct.isFulfilled()?ct.value():void 0:ct}function le(){this._trace=new fe(this._peekContext())}function he(ct,ht){if(Ze(ct)){var Ft=this._trace;if(void 0!==Ft&&ht&&(Ft=Ft._parent),void 0!==Ft)Ft.attachExtraTrace(ct);else if(!ct.__stackCleaned__){var Wt=$(ct);de.notEnumerableProp(ct,"stack",Wt.message+"\n"+Wt.stack.join("\n")),de.notEnumerableProp(ct,"__stackCleaned__",!0)}}}function _e(){this._trace=void 0}function ke(ct,ht,Ft){if(bn.warnings){var Wt,rn=new Ae(ct);if(ht)Ft._attachExtraTrace(rn);else if(bn.longStackTraces&&(Wt=v._peekContext()))Wt.attachExtraTrace(rn);else{var Yn=$(rn);rn.stack=Yn.message+"\n"+Yn.stack.join("\n")}Vt("warning",rn)||P(rn,"",!0)}}function F(ct){for(var ht=[],Ft=0;Ft<ct.length;++Ft){var Wt=ct[Ft],rn="    (No stack trace)"===Wt||st.test(Wt),Yn=rn&&on(Wt);rn&&!Yn&&(ut&&" "!==Wt.charAt(0)&&(Wt="    "+Wt),ht.push(Wt))}return ht}function $(ct){var ht=ct.stack,Ft=ct.toString();return ht="string"==typeof ht&&ht.length>0?function z(ct){for(var ht=ct.stack.replace(/\s+$/g,"").split("\n"),Ft=0;Ft<ht.length;++Ft){var Wt=ht[Ft];if("    (No stack trace)"===Wt||st.test(Wt))break}return Ft>0&&"SyntaxError"!=ct.name&&(ht=ht.slice(Ft)),ht}(ct):["    (No stack trace)"],{message:Ft,stack:"SyntaxError"==ct.name?ht:F(ht)}}function P(ct,ht,Ft){var Wt;"undefined"!=typeof console&&(Wt=de.isObject(ct)?ht+mt(ct.stack,ct):ht+String(ct),"function"==typeof De?De(Wt,Ft):("function"==typeof console.log||"object"==typeof console.log)&&console.log(Wt))}function L(ct,ht,Ft,Wt){var rn=!1;try{"function"==typeof ht&&(rn=!0,"rejectionHandled"===ct?ht(Wt):ht(Ft,Wt))}catch(Yn){Re.throwLater(Yn)}"unhandledRejection"===ct?Vt(ct,Ft,Wt)||rn||P(Ft,"Unhandled rejection "):Vt(ct,Wt)}function X(ct){var ht;if("function"==typeof ct)ht="[function "+(ct.name||"anonymous")+"]";else{if(ht=ct&&"function"==typeof ct.toString?ct.toString():de.toString(ct),/\[object [a-zA-Z0-9$_]+\]/.test(ht))try{ht=JSON.stringify(ct)}catch(rn){}0===ht.length&&(ht="(empty array)")}return"(<"+function ne(ct){return ct.length<41?ct:ct.substr(0,38)+"..."}(ht)+">, no stack trace)"}function Z(){return"function"==typeof sn}function te(ct){var ht=ct.match(dn);return ht?{fileName:ht[1],line:parseInt(ht[2],10)}:void 0}function fe(ct){this._parent=ct,this._promisesCreated=0;var ht=this._length=1+(void 0===ct?0:ct._length);sn(this,fe),ht>32&&this.uncycle()}var be,Pe,De,Xe,Re=v._async,Ae=f("./errors").Warning,de=f("./util"),tt=f("./es5"),Ze=de.canAttachTrace,et=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,Qe=/\((?:timers\.js):\d+:\d+\)/,Je=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,st=null,mt=null,ut=!1,Ke=!(0==de.env("BLUEBIRD_DEBUG")||!de.env("BLUEBIRD_DEBUG")&&"development"!==de.env("NODE_ENV")),nt=!(0==de.env("BLUEBIRD_WARNINGS")||!Ke&&!de.env("BLUEBIRD_WARNINGS")),lt=!(0==de.env("BLUEBIRD_LONG_STACK_TRACES")||!Ke&&!de.env("BLUEBIRD_LONG_STACK_TRACES")),xt=0!=de.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(nt||!!de.env("BLUEBIRD_W_FORGOTTEN_RETURN"));(function(){function ct(){for(var Wt=0;Wt<Ft.length;++Wt)Ft[Wt]._notifyUnhandledRejection();ht()}function ht(){Ft.length=0}var Ft=[];Xe=function(Wt){Ft.push(Wt),setTimeout(ct,1)},tt.defineProperty(v,"_unhandledRejectionCheck",{value:ct}),tt.defineProperty(v,"_unhandledRejectionClear",{value:ht})})(),v.prototype.suppressUnhandledRejections=function(){var ct=this._target();ct._bitField=-1048577&ct._bitField|524288},v.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),Xe(this))},v.prototype._notifyUnhandledRejectionIsHandled=function(){L("rejectionHandled",be,void 0,this)},v.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},v.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},v.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var ct=this._settledValue();this._setUnhandledRejectionIsNotified(),L("unhandledRejection",Pe,ct,this)}},v.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},v.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},v.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},v.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},v.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},v.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},v.prototype._warn=function(ct,ht,Ft){return ke(ct,ht,Ft||this)},v.onPossiblyUnhandledRejection=function(ct){var ht=v._getContext();Pe=de.contextBind(ht,ct)},v.onUnhandledRejectionHandled=function(ct){var ht=v._getContext();be=de.contextBind(ht,ct)};var dt=function(){};v.longStackTraces=function(){if(Re.haveItemsQueued()&&!bn.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!bn.longStackTraces&&Z()){var ct=v.prototype._captureStackTrace,ht=v.prototype._attachExtraTrace,Ft=v.prototype._dereferenceTrace;bn.longStackTraces=!0,dt=function(){if(Re.haveItemsQueued()&&!bn.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");v.prototype._captureStackTrace=ct,v.prototype._attachExtraTrace=ht,v.prototype._dereferenceTrace=Ft,_.deactivateLongStackTraces(),bn.longStackTraces=!1},v.prototype._captureStackTrace=le,v.prototype._attachExtraTrace=he,v.prototype._dereferenceTrace=_e,_.activateLongStackTraces()}},v.hasLongStackTraces=function(){return bn.longStackTraces&&Z()};var Dt={unhandledrejection:{before:function(){var ct=de.global.onunhandledrejection;return de.global.onunhandledrejection=null,ct},after:function(ct){de.global.onunhandledrejection=ct}},rejectionhandled:{before:function(){var ct=de.global.onrejectionhandled;return de.global.onrejectionhandled=null,ct},after:function(ct){de.global.onrejectionhandled=ct}}},Rt=function(){var ct=function(Ft,Wt){if(!Ft)return!de.global.dispatchEvent(Wt);var rn;try{return rn=Ft.before(),!de.global.dispatchEvent(Wt)}finally{Ft.after(rn)}};try{if("function"==typeof CustomEvent){var ht=new CustomEvent("CustomEvent");return de.global.dispatchEvent(ht),function(Wt,rn){Wt=Wt.toLowerCase();var ki=new CustomEvent(Wt,{detail:rn,cancelable:!0});return tt.defineProperty(ki,"promise",{value:rn.promise}),tt.defineProperty(ki,"reason",{value:rn.reason}),ct(Dt[Wt],ki)}}return"function"==typeof Event?(ht=new Event("CustomEvent"),de.global.dispatchEvent(ht),function(Wt,rn){Wt=Wt.toLowerCase();var Yn=new Event(Wt,{cancelable:!0});return Yn.detail=rn,tt.defineProperty(Yn,"promise",{value:rn.promise}),tt.defineProperty(Yn,"reason",{value:rn.reason}),ct(Dt[Wt],Yn)}):((ht=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),de.global.dispatchEvent(ht),function(Ft,Wt){Ft=Ft.toLowerCase();var rn=document.createEvent("CustomEvent");return rn.initCustomEvent(Ft,!1,!0,Wt),ct(Dt[Ft],rn)})}catch(Ft){}return function(){return!1}}(),Nt=de.isNode?function(){return process.emit.apply(process,arguments)}:de.global?function(ct){var ht="on"+ct.toLowerCase(),Ft=de.global[ht];return!!Ft&&(Ft.apply(de.global,[].slice.call(arguments,1)),!0)}:function(){return!1},Ot={promiseCreated:I,promiseFulfilled:I,promiseRejected:I,promiseResolved:I,promiseCancelled:I,promiseChained:function(ct,ht,Ft){return{promise:ht,child:Ft}},warning:function(ct,ht){return{warning:ht}},unhandledRejection:function(ct,ht,Ft){return{reason:ht,promise:Ft}},rejectionHandled:I},Vt=function(ct){var ht=!1;try{ht=Nt.apply(null,arguments)}catch(Wt){Re.throwLater(Wt),ht=!0}var Ft=!1;try{Ft=Rt(ct,Ot[ct].apply(null,arguments))}catch(Wt){Re.throwLater(Wt),Ft=!0}return Ft||ht};v.config=function(ct){if("longStackTraces"in(ct=Object(ct))&&(ct.longStackTraces?v.longStackTraces():!ct.longStackTraces&&v.hasLongStackTraces()&&dt()),"warnings"in ct){var ht=ct.warnings;bn.warnings=!!ht,xt=bn.warnings,de.isObject(ht)&&"wForgottenReturn"in ht&&(xt=!!ht.wForgottenReturn)}if("cancellation"in ct&&ct.cancellation&&!bn.cancellation){if(Re.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");v.prototype._clearCancellationData=K,v.prototype._propagateFrom=Q,v.prototype._onCancel=W,v.prototype._setOnCancel=J,v.prototype._attachCancellationCallback=j,v.prototype._execute=O,$t=Q,bn.cancellation=!0}if("monitoring"in ct&&(ct.monitoring&&!bn.monitoring?(bn.monitoring=!0,v.prototype._fireEvent=Vt):!ct.monitoring&&bn.monitoring&&(bn.monitoring=!1,v.prototype._fireEvent=k)),"asyncHooks"in ct&&de.nodeSupportsAsyncResource){var Wt=!!ct.asyncHooks;bn.asyncHooks!==Wt&&(bn.asyncHooks=Wt,Wt?b():S())}return v},v.prototype._fireEvent=k,v.prototype._execute=function(ct,ht,Ft){try{ct(ht,Ft)}catch(Wt){return Wt}},v.prototype._onCancel=function(){},v.prototype._setOnCancel=function(ct){},v.prototype._attachCancellationCallback=function(ct){},v.prototype._captureStackTrace=function(){},v.prototype._attachExtraTrace=function(){},v.prototype._dereferenceTrace=function(){},v.prototype._clearCancellationData=function(){},v.prototype._propagateFrom=function(ct,ht){};var $t=function ie(ct,ht){0!=(2&ht)&&ct._isBound()&&this._setBoundTo(ct._boundTo)},on=function(){return!1},dn=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;de.inherits(fe,Error),_.CapturedTrace=fe,fe.prototype.uncycle=function(){var ct=this._length;if(!(2>ct)){for(var ht=[],Ft={},Wt=0,rn=this;void 0!==rn;++Wt)ht.push(rn),rn=rn._parent;for(Wt=(ct=this._length=Wt)-1;Wt>=0;--Wt){var Yn=ht[Wt].stack;void 0===Ft[Yn]&&(Ft[Yn]=Wt)}for(Wt=0;ct>Wt;++Wt){var Hi=Ft[ht[Wt].stack];if(void 0!==Hi&&Hi!==Wt){Hi>0&&(ht[Hi-1]._parent=void 0,ht[Hi-1]._length=1),ht[Wt]._parent=void 0,ht[Wt]._length=1;var Ji=Wt>0?ht[Wt-1]:this;ct-1>Hi?(Ji._parent=ht[Hi+1],Ji._parent.uncycle(),Ji._length=Ji._parent._length+1):(Ji._parent=void 0,Ji._length=1);for(var Or=Ji._length+1,Ga=Wt-2;Ga>=0;--Ga)ht[Ga]._length=Or,Or++;return}}}},fe.prototype.attachExtraTrace=function(ct){if(!ct.__stackCleaned__){this.uncycle();for(var ht=$(ct),Ft=ht.message,Wt=[ht.stack],rn=this;void 0!==rn;)Wt.push(F(rn.stack.split("\n"))),rn=rn._parent;(function V(ct){for(var ht=ct[0],Ft=1;Ft<ct.length;++Ft){for(var Wt=ct[Ft],rn=ht.length-1,Yn=ht[rn],ki=-1,Hi=Wt.length-1;Hi>=0;--Hi)if(Wt[Hi]===Yn){ki=Hi;break}for(Hi=ki;Hi>=0&&ht[rn]===Wt[Hi];--Hi)ht.pop(),rn--;ht=Wt}})(Wt),function Le(ct){for(var ht=0;ht<ct.length;++ht)(0===ct[ht].length||ht+1<ct.length&&ct[ht][0]===ct[ht+1][0])&&(ct.splice(ht,1),ht--)}(Wt),de.notEnumerableProp(ct,"stack",function xe(ct,ht){for(var Ft=0;Ft<ht.length-1;++Ft)ht[Ft].push("From previous event:"),ht[Ft]=ht[Ft].join("\n");return Ft<ht.length&&(ht[Ft]=ht[Ft].join("\n")),ct+"\n"+ht.join("\n")}(Ft,Wt)),de.notEnumerableProp(ct,"__stackCleaned__",!0)}};var sn=function(){var ct=/^\s*at\s*/,ht=function(Yn,ki){return"string"==typeof Yn?Yn:void 0!==ki.name&&void 0!==ki.message?ki.toString():X(ki)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,st=ct,mt=ht;var Ft=Error.captureStackTrace;return on=function(Yn){return et.test(Yn)},function(Yn,ki){Error.stackTraceLimit+=6,Ft(Yn,ki),Error.stackTraceLimit-=6}}var rn,Wt=new Error;if("string"==typeof Wt.stack&&Wt.stack.split("\n")[0].indexOf("stackDetection@")>=0)return st=/@/,mt=ht,ut=!0,function(Yn){Yn.stack=(new Error).stack};try{throw new Error}catch(Yn){rn="stack"in Yn}return"stack"in Wt||!rn||"number"!=typeof Error.stackTraceLimit?(mt=function(Yn,ki){return"string"==typeof Yn?Yn:"object"!=typeof ki&&"function"!=typeof ki||void 0===ki.name||void 0===ki.message?X(ki):ki.toString()},null):(st=ct,mt=ht,function(Yn){Error.stackTraceLimit+=6;try{throw new Error}catch(ki){Yn.stack=ki.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(De=function(ct){console.warn(ct)},de.isNode&&process.stderr.isTTY?De=function(ct,ht){console.warn((ht?"\x1b[33m":"\x1b[31m")+ct+"\x1b[0m\n")}:de.isNode||"string"!=typeof(new Error).stack||(De=function(ct,ht){console.warn("%c"+ct,ht?"color: darkorange":"color: red")}));var bn={warnings:nt,longStackTraces:!1,cancellation:!1,monitoring:!1,asyncHooks:!1};return lt&&v.longStackTraces(),{asyncHooks:function(){return bn.asyncHooks},longStackTraces:function(){return bn.longStackTraces},warnings:function(){return bn.warnings},cancellation:function(){return bn.cancellation},monitoring:function(){return bn.monitoring},propagateFromFunction:function(){return $t},boundValueFunction:function(){return oe},checkForgottenReturns:function Ve(ct,ht,Ft,Wt,rn){if(void 0===ct&&null!==ht&&xt){if(void 0!==rn&&rn._returnedNonUndefined()||0==(65535&Wt._bitField))return;Ft&&(Ft+=" ");var Yn="",ki="";if(ht._trace){for(var Hi=ht._trace.stack.split("\n"),Ji=F(Hi),Or=Ji.length-1;Or>=0;--Or){var Ga=Ji[Or];if(!Qe.test(Ga)){var ca=Ga.match(Je);ca&&(Yn="at "+ca[1]+":"+ca[2]+":"+ca[3]+" ");break}}if(Ji.length>0){var Ju=Ji[0];for(Or=0;Or<Hi.length;++Or)if(Hi[Or]===Ju){Or>0&&(ki="\n"+Hi[Or-1]);break}}}Wt._warn("a promise was created in a "+Ft+"handler "+Yn+"but was not returned from it, see http://goo.gl/rRqMUw"+ki,!0,ht)}},setBounds:function ae(ct,ht){if(Z()){for(var Ft,Wt,rn=(ct.stack||"").split("\n"),Yn=(ht.stack||"").split("\n"),ki=-1,Hi=-1,Ji=0;Ji<rn.length;++Ji)if(Or=te(rn[Ji])){Ft=Or.fileName,ki=Or.line;break}for(Ji=0;Ji<Yn.length;++Ji){var Or;if(Or=te(Yn[Ji])){Wt=Or.fileName,Hi=Or.line;break}}0>ki||0>Hi||!Ft||!Wt||Ft!==Wt||ki>=Hi||(on=function(Ga){if(et.test(Ga))return!0;var ca=te(Ga);return!!(ca&&ca.fileName===Ft&&ki<=ca.line&&ca.line<=Hi)})}},warn:ke,deprecated:function ee(ct,ht){var Ft=ct+" is deprecated and will be removed in a future version.";return ht&&(Ft+=" Use "+ht+" instead."),ke(Ft)},CapturedTrace:fe,fireDomEvent:Rt,fireGlobalEvent:Nt}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(f,g,m){g.exports=function(v){function _(){return this.value}function b(){throw this.reason}v.prototype.return=v.prototype.thenReturn=function(S){return S instanceof v&&S.suppressUnhandledRejections(),this._then(_,void 0,void 0,{value:S},void 0)},v.prototype.throw=v.prototype.thenThrow=function(S){return this._then(b,void 0,void 0,{reason:S},void 0)},v.prototype.catchThrow=function(S){if(arguments.length<=1)return this._then(void 0,b,void 0,{reason:S},void 0);var I=arguments[1],k=function(){throw I};return this.caught(S,k)},v.prototype.catchReturn=function(S){if(arguments.length<=1)return S instanceof v&&S.suppressUnhandledRejections(),this._then(void 0,_,void 0,{value:S},void 0);var I=arguments[1];I instanceof v&&I.suppressUnhandledRejections();var k=function(){return I};return this.caught(S,k)}}},{}],11:[function(f,g,m){g.exports=function(v,_){function b(){return k(this)}var I=v.reduce,k=v.all;v.prototype.each=function(O){return I(this,O,_,0)._then(b,void 0,void 0,this,void 0)},v.prototype.mapSeries=function(O){return I(this,O,_,_)},v.each=function(O,j){return I(O,j,_,0)._then(b,void 0,void 0,O,void 0)},v.mapSeries=function S(O,j){return I(O,j,_,_)}}},{}],12:[function(f,g,m){function v(Ve,ee){function ke(xe){return this instanceof ke?(W(this,"message","string"==typeof xe?xe:ee),W(this,"name",Ve),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new ke(xe)}return j(ke,Error),ke}function _(Ve){return this instanceof _?(W(this,"name","OperationalError"),W(this,"message",Ve),this.cause=Ve,this.isOperational=!0,void(Ve instanceof Error?(W(this,"message",Ve.message),W(this,"stack",Ve.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new _(Ve)}var b,S,I=f("./es5"),k=I.freeze,O=f("./util"),j=O.inherits,W=O.notEnumerableProp,J=v("Warning","warning"),K=v("CancellationError","cancellation error"),Q=v("TimeoutError","timeout error"),ie=v("AggregateError","aggregate error");try{b=TypeError,S=RangeError}catch(Ve){b=v("TypeError","type error"),S=v("RangeError","range error")}for(var oe="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),le=0;le<oe.length;++le)"function"==typeof Array.prototype[oe[le]]&&(ie.prototype[oe[le]]=Array.prototype[oe[le]]);I.defineProperty(ie.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),ie.prototype.isOperational=!0;var he=0;ie.prototype.toString=function(){var Ve=Array(4*he+1).join(" "),ee="\n"+Ve+"AggregateError of:\n";he++,Ve=Array(4*he+1).join(" ");for(var ke=0;ke<this.length;++ke){for(var xe=this[ke]===this?"[Circular AggregateError]":this[ke]+"",Le=xe.split("\n"),V=0;V<Le.length;++V)Le[V]=Ve+Le[V];ee+=(xe=Le.join("\n"))+"\n"}return he--,ee},j(_,Error);var _e=Error.__BluebirdErrorTypes__;_e||(_e=k({CancellationError:K,TimeoutError:Q,OperationalError:_,RejectionError:_,AggregateError:ie}),I.defineProperty(Error,"__BluebirdErrorTypes__",{value:_e,writable:!1,enumerable:!1,configurable:!1})),g.exports={Error,TypeError:b,RangeError:S,CancellationError:_e.CancellationError,OperationalError:_e.OperationalError,TimeoutError:_e.TimeoutError,AggregateError:_e.AggregateError,Warning:J}},{"./es5":13,"./util":36}],13:[function(f,g,m){var v=function(){return void 0===this}();if(v)g.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:v,propertyIsWritable:function(K,Q){var ie=Object.getOwnPropertyDescriptor(K,Q);return!(ie&&!ie.writable&&!ie.set)}};else{var _={}.hasOwnProperty,b={}.toString,S={}.constructor.prototype,I=function(K){var Q=[];for(var ie in K)_.call(K,ie)&&Q.push(ie);return Q};g.exports={isArray:function(K){try{return"[object Array]"===b.call(K)}catch(Q){return!1}},keys:I,names:I,defineProperty:function(K,Q,ie){return K[Q]=ie.value,K},getDescriptor:function(K,Q){return{value:K[Q]}},freeze:function(K){return K},getPrototypeOf:function(K){try{return Object(K).constructor.prototype}catch(Q){return S}},isES5:v,propertyIsWritable:function(){return!0}}}},{}],14:[function(f,g,m){g.exports=function(v,_){var b=v.map;v.prototype.filter=function(S,I){return b(this,S,I,_)},v.filter=function(S,I,k){return b(S,I,k,_)}}},{}],15:[function(f,g,m){g.exports=function(v,_,b){function S(oe,le,he){this.promise=oe,this.type=le,this.handler=he,this.called=!1,this.cancelPromise=null}function I(oe){this.finallyHandler=oe}function k(oe,le){return null!=oe.cancelPromise&&(arguments.length>1?oe.cancelPromise._reject(le):oe.cancelPromise._cancel(),oe.cancelPromise=null,!0)}function O(){return W.call(this,this.promise._target()._settledValue())}function j(oe){return k(this,oe)?void 0:(Q.e=oe,Q)}function W(oe){var le=this.promise,he=this.handler;if(!this.called){this.called=!0;var _e=this.isFinallyHandler()?he.call(le._boundValue()):he.call(le._boundValue(),oe);if(_e===b)return _e;if(void 0!==_e){le._setReturnedNonUndefined();var Ve=_(_e,le);if(Ve instanceof v){if(null!=this.cancelPromise){if(Ve._isCancelled()){var ee=new K("late cancellation observer");return le._attachExtraTrace(ee),Q.e=ee,Q}Ve.isPending()&&Ve._attachCancellationCallback(new I(this))}return Ve._then(O,j,void 0,this,void 0)}}}return le.isRejected()?(k(this),Q.e=oe,Q):(k(this),oe)}var J=f("./util"),K=v.CancellationError,Q=J.errorObj,ie=f("./catch_filter")(b);return S.prototype.isFinallyHandler=function(){return 0===this.type},I.prototype._resultCancelled=function(){k(this.finallyHandler)},v.prototype._passThrough=function(oe,le,he,_e){return"function"!=typeof oe?this.then():this._then(he,_e,void 0,new S(this,le,oe),void 0)},v.prototype.lastly=v.prototype.finally=function(oe){return this._passThrough(oe,0,W,W)},v.prototype.tap=function(oe){return this._passThrough(oe,1,W)},v.prototype.tapCatch=function(oe){var le=arguments.length;if(1===le)return this._passThrough(oe,1,void 0,W);var he,_e=new Array(le-1),Ve=0;for(he=0;le-1>he;++he){var ee=arguments[he];if(!J.isObject(ee))return v.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+J.classString(ee)));_e[Ve++]=ee}_e.length=Ve;var ke=arguments[he];return this._passThrough(ie(_e,ke,this),1,void 0,W)},S}},{"./catch_filter":7,"./util":36}],16:[function(f,g,m){g.exports=function(v,_,b,S,I,k){function j(le,he,_e,Ve){if(k.cancellation()){var ee=new v(b),ke=this._finallyPromise=new v(b);this._promise=ee.lastly(function(){return ke}),ee._captureStackTrace(),ee._setOnCancel(this)}else(this._promise=new v(b))._captureStackTrace();this._stack=Ve,this._generatorFunction=le,this._receiver=he,this._generator=void 0,this._yieldHandlers="function"==typeof _e?[_e].concat(oe):oe,this._yieldedPromise=null,this._cancellationPhase=!1}var J=f("./errors").TypeError,K=f("./util"),Q=K.errorObj,ie=K.tryCatch,oe=[];K.inherits(j,I),j.prototype._isResolved=function(){return null===this._promise},j.prototype._cleanup=function(){this._promise=this._generator=null,k.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},j.prototype._promiseCancelled=function(){if(!this._isResolved()){var le;if(void 0!==this._generator.return)this._promise._pushContext(),le=ie(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var _e=new v.CancellationError("generator .return() sentinel");v.coroutine.returnSentinel=_e,this._promise._attachExtraTrace(_e),this._promise._pushContext(),le=ie(this._generator.throw).call(this._generator,_e),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(le)}},j.prototype._promiseFulfilled=function(le){this._yieldedPromise=null,this._promise._pushContext();var he=ie(this._generator.next).call(this._generator,le);this._promise._popContext(),this._continue(he)},j.prototype._promiseRejected=function(le){this._yieldedPromise=null,this._promise._attachExtraTrace(le),this._promise._pushContext();var he=ie(this._generator.throw).call(this._generator,le);this._promise._popContext(),this._continue(he)},j.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof v){var le=this._yieldedPromise;this._yieldedPromise=null,le.cancel()}},j.prototype.promise=function(){return this._promise},j.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},j.prototype._continue=function(le){var he=this._promise;if(le===Q)return this._cleanup(),this._cancellationPhase?he.cancel():he._rejectCallback(le.e,!1);var _e=le.value;if(!0===le.done)return this._cleanup(),this._cancellationPhase?he.cancel():he._resolveCallback(_e);var Ve=S(_e,this._promise);if(Ve instanceof v||(Ve=function O(le,he,_e){for(var Ve=0;Ve<he.length;++Ve){_e._pushContext();var ee=ie(he[Ve])(le);if(_e._popContext(),ee===Q){_e._pushContext();var ke=v.reject(Q.e);return _e._popContext(),ke}var xe=S(ee,_e);if(xe instanceof v)return xe}return null}(Ve,this._yieldHandlers,this._promise),null!==Ve)){var ee=(Ve=Ve._target())._bitField;0==(50397184&ee)?(this._yieldedPromise=Ve,Ve._proxy(this,null)):0!=(33554432&ee)?v._async.invoke(this._promiseFulfilled,this,Ve._value()):0!=(16777216&ee)?v._async.invoke(this._promiseRejected,this,Ve._reason()):this._promiseCancelled()}else this._promiseRejected(new J("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(_e))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},v.coroutine=function(le,he){if("function"!=typeof le)throw new J("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var _e=Object(he).yieldHandler,Ve=j,ee=(new Error).stack;return function(){var ke=le.apply(this,arguments),xe=new Ve(void 0,void 0,_e,ee),Le=xe.promise();return xe._generator=ke,xe._promiseFulfilled(void 0),Le}},v.coroutine.addYieldHandler=function(le){if("function"!=typeof le)throw new J("expecting a function but got "+K.classString(le));oe.push(le)},v.spawn=function(le){if(k.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof le)return _("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var he=new j(le,this),_e=he.promise();return he._run(v.spawn),_e}}},{"./errors":12,"./util":36}],17:[function(f,g,m){g.exports=function(v,_,b,S,I){f("./util"),v.join=function(){var O,j=arguments.length-1;j>0&&"function"==typeof arguments[j]&&(O=arguments[j]);var W=[].slice.call(arguments);O&&W.pop();var J=new _(W).promise();return void 0!==O?J.spread(O):J}}},{"./util":36}],18:[function(f,g,m){g.exports=function(v,_,b,S,I,k){function O(ie,oe,le,he){this.constructor$(ie),this._promise._captureStackTrace();var _e=v._getContext();if(this._callback=W.contextBind(_e,oe),this._preservedValues=he===I?new Array(this.length()):null,this._limit=le,this._inFlight=0,this._queue=[],Q.invoke(this._asyncInit,this,void 0),W.isArray(ie))for(var Ve=0;Ve<ie.length;++Ve){var ee=ie[Ve];ee instanceof v&&ee.suppressUnhandledRejections()}}function j(ie,oe,le,he){if("function"!=typeof oe)return b("expecting a function but got "+W.classString(oe));var _e=0;if(void 0!==le){if("object"!=typeof le||null===le)return v.reject(new TypeError("options argument must be an object but it is "+W.classString(le)));if("number"!=typeof le.concurrency)return v.reject(new TypeError("'concurrency' must be a number but it is "+W.classString(le.concurrency)));_e=le.concurrency}return new O(ie,oe,_e="number"==typeof _e&&isFinite(_e)&&_e>=1?_e:0,he).promise()}var W=f("./util"),J=W.tryCatch,K=W.errorObj,Q=v._async;W.inherits(O,_),O.prototype._asyncInit=function(){this._init$(void 0,-2)},O.prototype._init=function(){},O.prototype._promiseFulfilled=function(ie,oe){var le=this._values,he=this.length(),_e=this._preservedValues,Ve=this._limit;if(0>oe){if(le[oe=-1*oe-1]=ie,Ve>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(Ve>=1&&this._inFlight>=Ve)return le[oe]=ie,this._queue.push(oe),!1;null!==_e&&(_e[oe]=ie);var ee=this._promise,ke=this._callback,xe=ee._boundValue();ee._pushContext();var Le=J(ke).call(xe,ie,oe,he),V=ee._popContext();if(k.checkForgottenReturns(Le,V,null!==_e?"Promise.filter":"Promise.map",ee),Le===K)return this._reject(Le.e),!0;var F=S(Le,this._promise);if(F instanceof v){var z=(F=F._target())._bitField;if(0==(50397184&z))return Ve>=1&&this._inFlight++,le[oe]=F,F._proxy(this,-1*(oe+1)),!1;if(0==(33554432&z))return 0!=(16777216&z)?(this._reject(F._reason()),!0):(this._cancel(),!0);Le=F._value()}le[oe]=Le}return++this._totalResolved>=he&&(null!==_e?this._filter(le,_e):this._resolve(le),!0)},O.prototype._drainQueue=function(){for(var ie=this._queue,oe=this._limit,le=this._values;ie.length>0&&this._inFlight<oe;){if(this._isResolved())return;var he=ie.pop();this._promiseFulfilled(le[he],he)}},O.prototype._filter=function(ie,oe){for(var le=oe.length,he=new Array(le),_e=0,Ve=0;le>Ve;++Ve)ie[Ve]&&(he[_e++]=oe[Ve]);he.length=_e,this._resolve(he)},O.prototype.preservedValues=function(){return this._preservedValues},v.prototype.map=function(ie,oe){return j(this,ie,oe,null)},v.map=function(ie,oe,le,he){return j(ie,oe,le,he)}}},{"./util":36}],19:[function(f,g,m){g.exports=function(v,_,b,S,I){var k=f("./util"),O=k.tryCatch;v.method=function(j){if("function"!=typeof j)throw new v.TypeError("expecting a function but got "+k.classString(j));return function(){var W=new v(_);W._captureStackTrace(),W._pushContext();var J=O(j).apply(this,arguments),K=W._popContext();return I.checkForgottenReturns(J,K,"Promise.method",W),W._resolveFromSyncValue(J),W}},v.attempt=v.try=function(j){if("function"!=typeof j)return S("expecting a function but got "+k.classString(j));var J,W=new v(_);if(W._captureStackTrace(),W._pushContext(),arguments.length>1){I.deprecated("calling Promise.try with more than 1 argument");var K=arguments[1],Q=arguments[2];J=k.isArray(K)?O(j).apply(Q,K):O(j).call(Q,K)}else J=O(j)();var ie=W._popContext();return I.checkForgottenReturns(J,ie,"Promise.try",W),W._resolveFromSyncValue(J),W},v.prototype._resolveFromSyncValue=function(j){j===k.errorObj?this._rejectCallback(j.e,!1):this._resolveCallback(j,!0)}}},{"./util":36}],20:[function(f,g,m){function _(J){var K;if(function v(J){return J instanceof Error&&j.getPrototypeOf(J)===Error.prototype}(J)){(K=new O(J)).name=J.name,K.message=J.message,K.stack=J.stack;for(var Q=j.keys(J),ie=0;ie<Q.length;++ie){var oe=Q[ie];W.test(oe)||(K[oe]=J[oe])}return K}return S.markAsOriginatingFromRejection(J),J}var S=f("./util"),I=S.maybeWrapAsError,O=f("./errors").OperationalError,j=f("./es5"),W=/^(?:name|message|stack|cause)$/;g.exports=function b(J,K){return function(Q,ie){if(null!==J){if(Q){var oe=_(I(Q));J._attachExtraTrace(oe),J._reject(oe)}else if(K){var le=[].slice.call(arguments,1);J._fulfill(le)}else J._fulfill(ie);J=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(f,g,m){g.exports=function(v){function _(W,J){if(!I.isArray(W))return b.call(this,W,J);var Q=O(J).apply(this._boundValue(),[null].concat(W));Q===j&&k.throwLater(Q.e)}function b(W,J){var Q=this._boundValue(),ie=void 0===W?O(J).call(Q,null):O(J).call(Q,null,W);ie===j&&k.throwLater(ie.e)}function S(W,J){if(!W){var Q=new Error(W+"");Q.cause=W,W=Q}var ie=O(J).call(this._boundValue(),W);ie===j&&k.throwLater(ie.e)}var I=f("./util"),k=v._async,O=I.tryCatch,j=I.errorObj;v.prototype.asCallback=v.prototype.nodeify=function(W,J){if("function"==typeof W){var K=b;void 0!==J&&Object(J).spread&&(K=_),this._then(K,S,void 0,this,W)}return this}}},{"./util":36}],22:[function(f,g,m){g.exports=function(){function v(){}function b(Re){Re!==$&&function _(Re,Ae){if(null==Re||Re.constructor!==b&&"undefined"!=typeof Promise&&Re.constructor!==Promise)throw new F("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof Ae)throw new F("expecting a function but got "+K.classString(Ae))}(this,Re),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(Re),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function S(Re){this.promise._resolveCallback(Re)}function I(Re){this.promise._rejectCallback(Re,!1)}function k(Re){var Ae=new b($);Ae._fulfillmentHandler0=Re,Ae._rejectionHandler0=Re,Ae._promise0=Re,Ae._receiver0=Re}var O=function(){return new F("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},j=function(){return new b.PromiseInspection(this._target())},W=function(Re){return b.reject(new F(Re))},J={},K=f("./util");K.setReflectHandler(j);var Q=function(){var Re=process.domain;return void 0===Re?null:Re},oe=function(){return{domain:Q(),async:null}},le=K.isNode&&K.nodeSupportsAsyncResource?f("async_hooks").AsyncResource:null,he=function(){return{domain:Q(),async:new le("Bluebird::Promise")}},_e=K.isNode?oe:function(){return null};K.notEnumerableProp(b,"_getContext",_e);var ke=f("./es5"),xe=f("./async"),Le=new xe;ke.defineProperty(b,"_async",{value:Le});var V=f("./errors"),F=b.TypeError=V.TypeError;b.RangeError=V.RangeError;var z=b.CancellationError=V.CancellationError;b.TimeoutError=V.TimeoutError,b.OperationalError=V.OperationalError,b.RejectionError=V.OperationalError,b.AggregateError=V.AggregateError;var $=function(){},P={},L={},X=f("./thenables")(b,$),ne=f("./promise_array")(b,$,X,W,v),Z=f("./context")(b),te=Z.create,ae=f("./debuggability")(b,Z,function(){_e=he,K.notEnumerableProp(b,"_getContext",he)},function(){_e=oe,K.notEnumerableProp(b,"_getContext",oe)}),fe=f("./finally")(b,X,L),be=f("./catch_filter")(L),Pe=f("./nodeback"),De=K.errorObj,Xe=K.tryCatch;return b.prototype.toString=function(){return"[object Promise]"},b.prototype.caught=b.prototype.catch=function(Re){var Ae=arguments.length;if(Ae>1){var de,tt=new Array(Ae-1),Ze=0;for(de=0;Ae-1>de;++de){var et=arguments[de];if(!K.isObject(et))return W("Catch statement predicate: expecting an object but got "+K.classString(et));tt[Ze++]=et}if(tt.length=Ze,"function"!=typeof(Re=arguments[de]))throw new F("The last argument to .catch() must be a function, got "+K.toString(Re));return this.then(void 0,be(tt,Re,this))}return this.then(void 0,Re)},b.prototype.reflect=function(){return this._then(j,j,void 0,this,void 0)},b.prototype.then=function(Re,Ae){if(ae.warnings()&&arguments.length>0&&"function"!=typeof Re&&"function"!=typeof Ae){var de=".then() only accepts functions but was passed: "+K.classString(Re);arguments.length>1&&(de+=", "+K.classString(Ae)),this._warn(de)}return this._then(Re,Ae,void 0,void 0,void 0)},b.prototype.done=function(Re,Ae){this._then(Re,Ae,void 0,void 0,void 0)._setIsFinal()},b.prototype.spread=function(Re){return"function"!=typeof Re?W("expecting a function but got "+K.classString(Re)):this.all()._then(Re,void 0,void 0,P,void 0)},b.prototype.toJSON=function(){var Re={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(Re.fulfillmentValue=this.value(),Re.isFulfilled=!0):this.isRejected()&&(Re.rejectionReason=this.reason(),Re.isRejected=!0),Re},b.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new ne(this).promise()},b.prototype.error=function(Re){return this.caught(K.originatesFromRejection,Re)},b.getNewLibraryCopy=g.exports,b.is=function(Re){return Re instanceof b},b.fromNode=b.fromCallback=function(Re){var Ae=new b($);Ae._captureStackTrace();var de=arguments.length>1&&!!Object(arguments[1]).multiArgs,tt=Xe(Re)(Pe(Ae,de));return tt===De&&Ae._rejectCallback(tt.e,!0),Ae._isFateSealed()||Ae._setAsyncGuaranteed(),Ae},b.all=function(Re){return new ne(Re).promise()},b.cast=function(Re){var Ae=X(Re);return Ae instanceof b||((Ae=new b($))._captureStackTrace(),Ae._setFulfilled(),Ae._rejectionHandler0=Re),Ae},b.resolve=b.fulfilled=b.cast,b.reject=b.rejected=function(Re){var Ae=new b($);return Ae._captureStackTrace(),Ae._rejectCallback(Re,!0),Ae},b.setScheduler=function(Re){if("function"!=typeof Re)throw new F("expecting a function but got "+K.classString(Re));return Le.setScheduler(Re)},b.prototype._then=function(Re,Ae,de,tt,Ze){var et=void 0!==Ze,Qe=et?Ze:new b($),Je=this._target(),st=Je._bitField;et||(Qe._propagateFrom(this,3),Qe._captureStackTrace(),void 0===tt&&0!=(2097152&this._bitField)&&(tt=0!=(50397184&st)?this._boundValue():Je===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,Qe));var mt=_e();if(0!=(50397184&st)){var ut,Ke,nt=Je._settlePromiseCtx;0!=(33554432&st)?(Ke=Je._rejectionHandler0,ut=Re):0!=(16777216&st)?(Ke=Je._fulfillmentHandler0,ut=Ae,Je._unsetRejectionIsUnhandled()):(nt=Je._settlePromiseLateCancellationObserver,Ke=new z("late cancellation observer"),Je._attachExtraTrace(Ke),ut=Ae),Le.invoke(nt,Je,{handler:K.contextBind(mt,ut),promise:Qe,receiver:tt,value:Ke})}else Je._addCallbacks(Re,Ae,Qe,tt,mt);return Qe},b.prototype._length=function(){return 65535&this._bitField},b.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},b.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},b.prototype._setLength=function(Re){this._bitField=-65536&this._bitField|65535&Re},b.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},b.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},b.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},b.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},b.prototype._isFinal=function(){return(4194304&this._bitField)>0},b.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},b.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},b.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},b.prototype._setAsyncGuaranteed=function(){if(!Le.hasCustomScheduler()){var Re=this._bitField;this._bitField=Re|(536870912&Re)>>2^134217728}},b.prototype._setNoAsyncGuarantee=function(){this._bitField=-134217729&(536870912|this._bitField)},b.prototype._receiverAt=function(Re){var Ae=0===Re?this._receiver0:this[4*Re-4+3];return Ae===J?void 0:void 0===Ae&&this._isBound()?this._boundValue():Ae},b.prototype._promiseAt=function(Re){return this[4*Re-4+2]},b.prototype._fulfillmentHandlerAt=function(Re){return this[4*Re-4+0]},b.prototype._rejectionHandlerAt=function(Re){return this[4*Re-4+1]},b.prototype._boundValue=function(){},b.prototype._migrateCallback0=function(Re){var Ae=Re._fulfillmentHandler0,de=Re._rejectionHandler0,tt=Re._promise0,Ze=Re._receiverAt(0);void 0===Ze&&(Ze=J),this._addCallbacks(Ae,de,tt,Ze,null)},b.prototype._migrateCallbackAt=function(Re,Ae){var de=Re._fulfillmentHandlerAt(Ae),tt=Re._rejectionHandlerAt(Ae),Ze=Re._promiseAt(Ae),et=Re._receiverAt(Ae);void 0===et&&(et=J),this._addCallbacks(de,tt,Ze,et,null)},b.prototype._addCallbacks=function(Re,Ae,de,tt,Ze){var et=this._length();if(et>=65531&&(et=0,this._setLength(0)),0===et)this._promise0=de,this._receiver0=tt,"function"==typeof Re&&(this._fulfillmentHandler0=K.contextBind(Ze,Re)),"function"==typeof Ae&&(this._rejectionHandler0=K.contextBind(Ze,Ae));else{var Qe=4*et-4;this[Qe+2]=de,this[Qe+3]=tt,"function"==typeof Re&&(this[Qe+0]=K.contextBind(Ze,Re)),"function"==typeof Ae&&(this[Qe+1]=K.contextBind(Ze,Ae))}return this._setLength(et+1),et},b.prototype._proxy=function(Re,Ae){this._addCallbacks(void 0,void 0,Ae,Re,null)},b.prototype._resolveCallback=function(Re,Ae){if(0==(117506048&this._bitField)){if(Re===this)return this._rejectCallback(O(),!1);var de=X(Re,this);if(!(de instanceof b))return this._fulfill(Re);Ae&&this._propagateFrom(de,2);var tt=de._target();if(tt===this)return void this._reject(O());var Ze=tt._bitField;if(0==(50397184&Ze)){var et=this._length();et>0&&tt._migrateCallback0(this);for(var Qe=1;et>Qe;++Qe)tt._migrateCallbackAt(this,Qe);this._setFollowing(),this._setLength(0),this._setFollowee(de)}else if(0!=(33554432&Ze))this._fulfill(tt._value());else if(0!=(16777216&Ze))this._reject(tt._reason());else{var Je=new z("late cancellation observer");tt._attachExtraTrace(Je),this._reject(Je)}}},b.prototype._rejectCallback=function(Re,Ae,de){var tt=K.ensureErrorObject(Re),Ze=tt===Re;if(!Ze&&!de&&ae.warnings()){var et="a promise was rejected with a non-error: "+K.classString(Re);this._warn(et,!0)}this._attachExtraTrace(tt,!!Ae&&Ze),this._reject(Re)},b.prototype._resolveFromExecutor=function(Re){if(Re!==$){var Ae=this;this._captureStackTrace(),this._pushContext();var de=!0,tt=this._execute(Re,function(Ze){Ae._resolveCallback(Ze)},function(Ze){Ae._rejectCallback(Ze,de)});de=!1,this._popContext(),void 0!==tt&&Ae._rejectCallback(tt,!0)}},b.prototype._settlePromiseFromHandler=function(Re,Ae,de,tt){var Ze=tt._bitField;if(0==(65536&Ze)){var et;tt._pushContext(),Ae===P?de&&"number"==typeof de.length?et=Xe(Re).apply(this._boundValue(),de):(et=De).e=new F("cannot .spread() a non-array: "+K.classString(de)):et=Xe(Re).call(Ae,de);var Qe=tt._popContext();0==(65536&(Ze=tt._bitField))&&(et===L?tt._reject(de):et===De?tt._rejectCallback(et.e,!1):(ae.checkForgottenReturns(et,Qe,"",tt,this),tt._resolveCallback(et)))}},b.prototype._target=function(){for(var Re=this;Re._isFollowing();)Re=Re._followee();return Re},b.prototype._followee=function(){return this._rejectionHandler0},b.prototype._setFollowee=function(Re){this._rejectionHandler0=Re},b.prototype._settlePromise=function(Re,Ae,de,tt){var Ze=Re instanceof b,et=this._bitField,Qe=0!=(134217728&et);0!=(65536&et)?(Ze&&Re._invokeInternalOnCancel(),de instanceof fe&&de.isFinallyHandler()?(de.cancelPromise=Re,Xe(Ae).call(de,tt)===De&&Re._reject(De.e)):Ae===j?Re._fulfill(j.call(de)):de instanceof v?de._promiseCancelled(Re):Ze||Re instanceof ne?Re._cancel():de.cancel()):"function"==typeof Ae?Ze?(Qe&&Re._setAsyncGuaranteed(),this._settlePromiseFromHandler(Ae,de,tt,Re)):Ae.call(de,tt,Re):de instanceof v?de._isResolved()||(0!=(33554432&et)?de._promiseFulfilled(tt,Re):de._promiseRejected(tt,Re)):Ze&&(Qe&&Re._setAsyncGuaranteed(),0!=(33554432&et)?Re._fulfill(tt):Re._reject(tt))},b.prototype._settlePromiseLateCancellationObserver=function(Re){var Ae=Re.handler,de=Re.promise,tt=Re.receiver,Ze=Re.value;"function"==typeof Ae?de instanceof b?this._settlePromiseFromHandler(Ae,tt,Ze,de):Ae.call(tt,Ze,de):de instanceof b&&de._reject(Ze)},b.prototype._settlePromiseCtx=function(Re){this._settlePromise(Re.promise,Re.handler,Re.receiver,Re.value)},b.prototype._settlePromise0=function(Re,Ae,de){var tt=this._promise0,Ze=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(tt,Re,Ze,Ae)},b.prototype._clearCallbackDataAtIndex=function(Re){var Ae=4*Re-4;this[Ae+2]=this[Ae+3]=this[Ae+0]=this[Ae+1]=void 0},b.prototype._fulfill=function(Re){var Ae=this._bitField;if(!((117506048&Ae)>>>16)){if(Re===this){var de=O();return this._attachExtraTrace(de),this._reject(de)}this._setFulfilled(),this._rejectionHandler0=Re,(65535&Ae)>0&&(0!=(134217728&Ae)?this._settlePromises():Le.settlePromises(this),this._dereferenceTrace())}},b.prototype._reject=function(Re){var Ae=this._bitField;if(!((117506048&Ae)>>>16))return this._setRejected(),this._fulfillmentHandler0=Re,this._isFinal()?Le.fatalError(Re,K.isNode):void((65535&Ae)>0?Le.settlePromises(this):this._ensurePossibleRejectionHandled())},b.prototype._fulfillPromises=function(Re,Ae){for(var de=1;Re>de;de++){var tt=this._fulfillmentHandlerAt(de),Ze=this._promiseAt(de),et=this._receiverAt(de);this._clearCallbackDataAtIndex(de),this._settlePromise(Ze,tt,et,Ae)}},b.prototype._rejectPromises=function(Re,Ae){for(var de=1;Re>de;de++){var tt=this._rejectionHandlerAt(de),Ze=this._promiseAt(de),et=this._receiverAt(de);this._clearCallbackDataAtIndex(de),this._settlePromise(Ze,tt,et,Ae)}},b.prototype._settlePromises=function(){var Re=this._bitField,Ae=65535&Re;if(Ae>0){if(0!=(16842752&Re)){var de=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,de,Re),this._rejectPromises(Ae,de)}else{var tt=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,tt,Re),this._fulfillPromises(Ae,tt)}this._setLength(0)}this._clearCancellationData()},b.prototype._settledValue=function(){var Re=this._bitField;return 0!=(33554432&Re)?this._rejectionHandler0:0!=(16777216&Re)?this._fulfillmentHandler0:void 0},"undefined"!=typeof Symbol&&Symbol.toStringTag&&ke.defineProperty(b.prototype,Symbol.toStringTag,{get:function(){return"Object"}}),b.defer=b.pending=function(){return ae.deprecated("Promise.defer","new Promise"),{promise:new b($),resolve:S,reject:I}},K.notEnumerableProp(b,"_makeSelfResolutionError",O),f("./method")(b,$,X,W,ae),f("./bind")(b,$,X,ae),f("./cancel")(b,ne,W,ae),f("./direct_resolve")(b),f("./synchronous_inspection")(b),f("./join")(b,ne,X,$,Le),b.Promise=b,b.version="3.7.2",f("./call_get.js")(b),f("./generators.js")(b,W,$,X,v,ae),f("./map.js")(b,ne,W,X,$,ae),f("./nodeify.js")(b),f("./promisify.js")(b,$),f("./props.js")(b,ne,X,W),f("./race.js")(b,$,X,W),f("./reduce.js")(b,ne,W,X,$,ae),f("./settle.js")(b,ne,ae),f("./some.js")(b,ne,W),f("./timers.js")(b,$,ae),f("./using.js")(b,W,X,te,$,ae),f("./any.js")(b),f("./each.js")(b,$),f("./filter.js")(b,$),K.toFastProperties(b),K.toFastProperties(b.prototype),k({a:1}),k({b:2}),k({c:3}),k(1),k(function(){}),k(void 0),k(!1),k(new b($)),ae.setBounds(xe.firstLineError,K.lastLineError),b}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36,async_hooks:void 0}],23:[function(f,g,m){g.exports=function(v,_,b,S,I){function O(W){var J=this._promise=new v(_);W instanceof v&&(J._propagateFrom(W,3),W.suppressUnhandledRejections()),J._setOnCancel(this),this._values=W,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var j=f("./util");return j.inherits(O,I),O.prototype.length=function(){return this._length},O.prototype.promise=function(){return this._promise},O.prototype._init=function W(J,K){var Q=b(this._values,this._promise);if(Q instanceof v){var ie=(Q=Q._target())._bitField;if(this._values=Q,0==(50397184&ie))return this._promise._setAsyncGuaranteed(),Q._then(W,this._reject,void 0,this,K);if(0==(33554432&ie))return 0!=(16777216&ie)?this._reject(Q._reason()):this._cancel();Q=Q._value()}if(null!==(Q=j.asArray(Q)))return 0===Q.length?void(-5===K?this._resolveEmptyArray():this._resolve(function k(W){switch(W){case-2:return[];case-3:return{};case-6:return new Map}}(K))):void this._iterate(Q);var oe=S("expecting an array or an iterable object but got "+j.classString(Q)).reason();this._promise._rejectCallback(oe,!1)},O.prototype._iterate=function(W){var J=this.getActualLength(W.length);this._length=J,this._values=this.shouldCopyValues()?new Array(J):this._values;for(var K=this._promise,Q=!1,ie=null,oe=0;J>oe;++oe){var le=b(W[oe],K);ie=le instanceof v?(le=le._target())._bitField:null,Q?null!==ie&&le.suppressUnhandledRejections():null!==ie?0==(50397184&ie)?(le._proxy(this,oe),this._values[oe]=le):Q=0!=(33554432&ie)?this._promiseFulfilled(le._value(),oe):0!=(16777216&ie)?this._promiseRejected(le._reason(),oe):this._promiseCancelled(oe):Q=this._promiseFulfilled(le,oe)}Q||K._setAsyncGuaranteed()},O.prototype._isResolved=function(){return null===this._values},O.prototype._resolve=function(W){this._values=null,this._promise._fulfill(W)},O.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},O.prototype._reject=function(W){this._values=null,this._promise._rejectCallback(W,!1)},O.prototype._promiseFulfilled=function(W,J){return this._values[J]=W,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},O.prototype._promiseCancelled=function(){return this._cancel(),!0},O.prototype._promiseRejected=function(W){return this._totalResolved++,this._reject(W),!0},O.prototype._resultCancelled=function(){if(!this._isResolved()){var W=this._values;if(this._cancel(),W instanceof v)W.cancel();else for(var J=0;J<W.length;++J)W[J]instanceof v&&W[J].cancel()}},O.prototype.shouldCopyValues=function(){return!0},O.prototype.getActualLength=function(W){return W},O}},{"./util":36}],24:[function(f,g,m){g.exports=function(v,_){function b($){return!Le.test($)}function S($){try{return!0===$.__isPromisified__}catch(P){return!1}}function I($,P,L){var X=ie.getDataPropertyOrDefault($,P+L,ke);return!!X&&S(X)}function W($,P,L,X,ne){for(var Z=new RegExp(F(P)+"$"),te=function O($,P,L,X){for(var ne=ie.inheritedDataKeys($),Z=[],te=0;te<ne.length;++te){var ae=ne[te],fe=$[ae],be=X===V||V(ae,fe,$);"function"!=typeof fe||S(fe)||I($,ae,P)||!X(ae,fe,$,be)||Z.push(ae,fe)}return function k($,P,L){for(var X=0;X<$.length;X+=2){var ne=$[X];if(L.test(ne))for(var Z=ne.replace(L,""),te=0;te<$.length;te+=2)if($[te]===Z)throw new Ve("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",P))}}(Z,P,L),Z}($,P,Z,L),ae=0,fe=te.length;fe>ae;ae+=2){var be=te[ae],Pe=te[ae+1],De=be+P;if(X===z)$[De]=z(be,Q,be,Pe,P,ne);else{var Xe=X(Pe,function(){return z(be,Q,be,Pe,P,ne)});ie.notEnumerableProp(Xe,"__isPromisified__",!0),$[De]=Xe}}return ie.toFastProperties($),$}var Q={},ie=f("./util"),oe=f("./nodeback"),le=ie.withAppended,he=ie.maybeWrapAsError,_e=ie.canEvaluate,Ve=f("./errors").TypeError,ke={__isPromisified__:!0},Le=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),V=function($){return ie.isIdentifier($)&&"_"!==$.charAt(0)&&"constructor"!==$},F=function($){return $.replace(/([$])/,"\\$")},z=_e?void 0:function j($,P,L,X,ne,Z){function te(){var be=P;P===Q&&(be=this);var Pe=new v(_);Pe._captureStackTrace();var De="string"==typeof fe&&this!==ae?this[fe]:$,Xe=oe(Pe,Z);try{De.apply(be,le(arguments,Xe))}catch(Re){Pe._rejectCallback(he(Re),!0,!0)}return Pe._isFateSealed()||Pe._setAsyncGuaranteed(),Pe}var ae=function(){return this}(),fe=$;return"string"==typeof fe&&($=X),ie.notEnumerableProp(te,"__isPromisified__",!0),te};v.promisify=function($,P){if("function"!=typeof $)throw new Ve("expecting a function but got "+ie.classString($));if(S($))return $;var ne=function J($,P,L){return z($,P,void 0,$,null,L)}($,void 0===(P=Object(P)).context?Q:P.context,!!P.multiArgs);return ie.copyDescriptors($,ne,b),ne},v.promisifyAll=function($,P){if("function"!=typeof $&&"object"!=typeof $)throw new Ve("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var L=!!(P=Object(P)).multiArgs,X=P.suffix;"string"!=typeof X&&(X="Async");var ne=P.filter;"function"!=typeof ne&&(ne=V);var Z=P.promisifier;if("function"!=typeof Z&&(Z=z),!ie.isIdentifier(X))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var te=ie.inheritedDataKeys($),ae=0;ae<te.length;++ae){var fe=$[te[ae]];"constructor"!==te[ae]&&ie.isClass(fe)&&(W(fe.prototype,X,ne,Z,L),W(fe,X,ne,Z,L))}return W($,X,ne,Z,L)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(f,g,m){g.exports=function(v,_,b,S){function I(ie){var oe,le=!1;if(void 0!==O&&ie instanceof O)oe=K(ie),le=!0;else{var he=J.keys(ie),_e=he.length;oe=new Array(2*_e);for(var Ve=0;_e>Ve;++Ve){var ee=he[Ve];oe[Ve]=ie[ee],oe[Ve+_e]=ee}}this.constructor$(oe),this._isMap=le,this._init$(void 0,le?-6:-3)}function k(ie){var oe,le=b(ie);return W(le)?(oe=le instanceof v?le._then(v.props,void 0,void 0,void 0,void 0):new I(le).promise(),le instanceof v&&oe._propagateFrom(le,2),oe):S("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var O,j=f("./util"),W=j.isObject,J=f("./es5");"function"==typeof Map&&(O=Map);var K=function(){function ie(he,_e){this[oe]=he,this[oe+le]=_e,oe++}var oe=0,le=0;return function(he){le=he.size,oe=0;var _e=new Array(2*he.size);return he.forEach(ie,_e),_e}}();j.inherits(I,_),I.prototype._init=function(){},I.prototype._promiseFulfilled=function(ie,oe){if(this._values[oe]=ie,++this._totalResolved>=this._length){var he;if(this._isMap)he=function(ie){for(var oe=new O,le=ie.length/2|0,he=0;le>he;++he)oe.set(ie[le+he],ie[he]);return oe}(this._values);else{he={};for(var _e=this.length(),Ve=0,ee=this.length();ee>Ve;++Ve)he[this._values[Ve+_e]]=this._values[Ve]}return this._resolve(he),!0}return!1},I.prototype.shouldCopyValues=function(){return!1},I.prototype.getActualLength=function(ie){return ie>>1},v.prototype.props=function(){return k(this)},v.props=function(ie){return k(ie)}}},{"./es5":13,"./util":36}],26:[function(f,g,m){function _(b){this._capacity=b,this._length=0,this._front=0}_.prototype._willBeOverCapacity=function(b){return this._capacity<b},_.prototype._pushOne=function(b){var S=this.length();this._checkCapacity(S+1),this[this._front+S&this._capacity-1]=b,this._length=S+1},_.prototype.push=function(b,S,I){var k=this.length()+3;if(this._willBeOverCapacity(k))return this._pushOne(b),this._pushOne(S),void this._pushOne(I);var O=this._front+k-3;this._checkCapacity(k);var j=this._capacity-1;this[O+0&j]=b,this[O+1&j]=S,this[O+2&j]=I,this._length=k},_.prototype.shift=function(){var b=this._front,S=this[b];return this[b]=void 0,this._front=b+1&this._capacity-1,this._length--,S},_.prototype.length=function(){return this._length},_.prototype._checkCapacity=function(b){this._capacity<b&&this._resizeTo(this._capacity<<1)},_.prototype._resizeTo=function(b){var S=this._capacity;this._capacity=b,function v(b,S,I,k,O){for(var j=0;O>j;++j)I[j+k]=b[j+S],b[j+S]=void 0}(this,0,this,S,this._front+this._length&S-1)},g.exports=_},{}],27:[function(f,g,m){g.exports=function(v,_,b,S){function I(j,W){var J=b(j);if(J instanceof v)return O(J);if(null===(j=k.asArray(j)))return S("expecting an array or an iterable object but got "+k.classString(j));var K=new v(_);void 0!==W&&K._propagateFrom(W,3);for(var Q=K._fulfill,ie=K._reject,oe=0,le=j.length;le>oe;++oe){var he=j[oe];(void 0!==he||oe in j)&&v.cast(he)._then(Q,ie,void 0,K,null)}return K}var k=f("./util"),O=function(j){return j.then(function(W){return I(W,j)})};v.race=function(j){return I(j,void 0)},v.prototype.race=function(){return I(this,void 0)}}},{"./util":36}],28:[function(f,g,m){g.exports=function(v,_,b,S,I,k){function O(oe,le,he,_e){this.constructor$(oe);var Ve=v._getContext();this._fn=Q.contextBind(Ve,le),void 0!==he&&(he=v.resolve(he))._attachCancellationCallback(this),this._initialValue=he,this._currentCancellable=null,this._eachValues=_e===I?Array(this._length):0===_e?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function j(oe,le){this.isFulfilled()?le._resolve(oe):le._reject(oe)}function W(oe,le,he,_e){return"function"!=typeof le?b("expecting a function but got "+Q.classString(le)):new O(oe,le,he,_e).promise()}function J(oe){this.accum=oe,this.array._gotAccum(oe);var le=S(this.value,this.array._promise);return le instanceof v?(this.array._currentCancellable=le,le._then(K,void 0,void 0,this,void 0)):K.call(this,le)}function K(oe){var Ve,le=this.array,he=le._promise,_e=ie(le._fn);he._pushContext(),(Ve=void 0!==le._eachValues?_e.call(he._boundValue(),oe,this.index,this.length):_e.call(he._boundValue(),this.accum,oe,this.index,this.length))instanceof v&&(le._currentCancellable=Ve);var ee=he._popContext();return k.checkForgottenReturns(Ve,ee,void 0!==le._eachValues?"Promise.each":"Promise.reduce",he),Ve}var Q=f("./util"),ie=Q.tryCatch;Q.inherits(O,_),O.prototype._gotAccum=function(oe){null!=this._eachValues&&oe!==I&&this._eachValues.push(oe)},O.prototype._eachComplete=function(oe){return null!==this._eachValues&&this._eachValues.push(oe),this._eachValues},O.prototype._init=function(){},O.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},O.prototype.shouldCopyValues=function(){return!1},O.prototype._resolve=function(oe){this._promise._resolveCallback(oe),this._values=null},O.prototype._resultCancelled=function(oe){return oe===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof v&&this._currentCancellable.cancel(),this._initialValue instanceof v&&this._initialValue.cancel()))},O.prototype._iterate=function(oe){this._values=oe;var le,he,_e=oe.length;void 0!==this._initialValue?(le=this._initialValue,he=0):(le=v.resolve(oe[0]),he=1),this._currentCancellable=le;for(var Ve=he;_e>Ve;++Ve){var ee=oe[Ve];ee instanceof v&&ee.suppressUnhandledRejections()}if(!le.isRejected())for(;_e>he;++he)le=le._then(J,void 0,void 0,{accum:null,value:oe[he],index:he,length:_e,array:this},void 0),0==(127&he)&&le._setNoAsyncGuarantee();void 0!==this._eachValues&&(le=le._then(this._eachComplete,void 0,void 0,this,void 0)),le._then(j,j,void 0,le,this)},v.prototype.reduce=function(oe,le){return W(this,oe,le,null)},v.reduce=function(oe,le,he,_e){return W(oe,le,he,_e)}}},{"./util":36}],29:[function(f,g,m){var v,j,W,J,K,_=f("./util"),S=_.getNativePromise();if(_.isNode&&"undefined"==typeof MutationObserver){var I=global.setImmediate,k=process.nextTick;v=_.isRecentNode?function(j){I.call(global,j)}:function(j){k.call(process,j)}}else if("function"==typeof S&&"function"==typeof S.resolve){var O=S.resolve();v=function(j){O.then(j)}}else v="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)||!("classList"in document.documentElement)?"undefined"!=typeof setImmediate?function(j){setImmediate(j)}:"undefined"!=typeof setTimeout?function(j){setTimeout(j,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:(j=document.createElement("div"),W={attributes:!0},J=!1,K=document.createElement("div"),new MutationObserver(function(){j.classList.toggle("foo"),J=!1}).observe(K,W),function(oe){var le=new MutationObserver(function(){le.disconnect(),oe()});le.observe(j,W),J||(J=!0,K.classList.toggle("foo"))});g.exports=v},{"./util":36}],30:[function(f,g,m){g.exports=function(v,_,b){function S(O){this.constructor$(O)}var I=v.PromiseInspection;f("./util").inherits(S,_),S.prototype._promiseResolved=function(O,j){return this._values[O]=j,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},S.prototype._promiseFulfilled=function(O,j){var W=new I;return W._bitField=33554432,W._settledValueField=O,this._promiseResolved(j,W)},S.prototype._promiseRejected=function(O,j){var W=new I;return W._bitField=16777216,W._settledValueField=O,this._promiseResolved(j,W)},v.settle=function(O){return b.deprecated(".settle()",".reflect()"),new S(O).promise()},v.allSettled=function(O){return new S(O).promise()},v.prototype.settle=function(){return v.settle(this)}}},{"./util":36}],31:[function(f,g,m){g.exports=function(v,_,b){function S(K){this.constructor$(K),this._howMany=0,this._unwrap=!1,this._initialized=!1}function I(K,Q){if((0|Q)!==Q||0>Q)return b("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var ie=new S(K),oe=ie.promise();return ie.setHowMany(Q),ie.init(),oe}var k=f("./util"),O=f("./errors").RangeError,j=f("./errors").AggregateError,W=k.isArray,J={};k.inherits(S,_),S.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var K=W(this._values);!this._isResolved()&&K&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},S.prototype.init=function(){this._initialized=!0,this._init()},S.prototype.setUnwrap=function(){this._unwrap=!0},S.prototype.howMany=function(){return this._howMany},S.prototype.setHowMany=function(K){this._howMany=K},S.prototype._promiseFulfilled=function(K){return this._addFulfilled(K),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},S.prototype._promiseRejected=function(K){return this._addRejected(K),this._checkOutcome()},S.prototype._promiseCancelled=function(){return this._values instanceof v||null==this._values?this._cancel():(this._addRejected(J),this._checkOutcome())},S.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var K=new j,Q=this.length();Q<this._values.length;++Q)this._values[Q]!==J&&K.push(this._values[Q]);return K.length>0?this._reject(K):this._cancel(),!0}return!1},S.prototype._fulfilled=function(){return this._totalResolved},S.prototype._rejected=function(){return this._values.length-this.length()},S.prototype._addRejected=function(K){this._values.push(K)},S.prototype._addFulfilled=function(K){this._values[this._totalResolved++]=K},S.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},S.prototype._getRangeError=function(K){return new O("Input array must contain at least "+this._howMany+" items but contains only "+K+" items")},S.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},v.some=function(K,Q){return I(K,Q)},v.prototype.some=function(K){return I(this,K)},v._SomePromiseArray=S}},{"./errors":12,"./util":36}],32:[function(f,g,m){g.exports=function(v){function _(W){void 0!==W?(W=W._target(),this._bitField=W._bitField,this._settledValueField=W._isFateSealed()?W._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}_.prototype._settledValue=function(){return this._settledValueField};var b=_.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},S=_.prototype.error=_.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},I=_.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},k=_.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},O=_.prototype.isPending=function(){return 0==(50397184&this._bitField)},j=_.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};_.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},v.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},v.prototype._isCancelled=function(){return this._target().__isCancelled()},v.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},v.prototype.isPending=function(){return O.call(this._target())},v.prototype.isRejected=function(){return k.call(this._target())},v.prototype.isFulfilled=function(){return I.call(this._target())},v.prototype.isResolved=function(){return j.call(this._target())},v.prototype.value=function(){return b.call(this._target())},v.prototype.reason=function(){var W=this._target();return W._unsetRejectionIsUnhandled(),S.call(W)},v.prototype._value=function(){return this._settledValue()},v.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},v.PromiseInspection=_}},{}],33:[function(f,g,m){g.exports=function(v,_){var j=f("./util"),W=j.errorObj,J=j.isObject,K={}.hasOwnProperty;return function b(Q,ie){if(J(Q)){if(Q instanceof v)return Q;var oe=function I(Q){try{return function S(Q){return Q.then}(Q)}catch(ie){return W.e=ie,W}}(Q);if(oe===W){ie&&ie._pushContext();var le=v.reject(oe.e);return ie&&ie._popContext(),le}if("function"==typeof oe)return function k(Q){try{return K.call(Q,"_promise0")}catch(ie){return!1}}(Q)?(le=new v(_),Q._then(le._fulfill,le._reject,void 0,le,null),le):function O(Q,ie,oe){var _e=new v(_),Ve=_e;oe&&oe._pushContext(),_e._captureStackTrace(),oe&&oe._popContext();var ee=!0,ke=j.tryCatch(ie).call(Q,function le(xe){_e&&(_e._resolveCallback(xe),_e=null)},function he(xe){_e&&(_e._rejectCallback(xe,ee,!0),_e=null)});return ee=!1,_e&&ke===W&&(_e._rejectCallback(ke.e,!0,!0),_e=null),Ve}(Q,oe,ie)}return Q}}},{"./util":36}],34:[function(f,g,m){g.exports=function(v,_,b){function S(Q){this.handle=Q}function I(Q){return clearTimeout(this.handle),Q}function k(Q){throw clearTimeout(this.handle),Q}var O=f("./util"),j=v.TimeoutError;S.prototype._resultCancelled=function(){clearTimeout(this.handle)};var W=function(Q){return J(+this).thenReturn(Q)},J=v.delay=function(Q,ie){var oe,le;return void 0!==ie?(oe=v.resolve(ie)._then(W,null,null,Q,void 0),b.cancellation()&&ie instanceof v&&oe._setOnCancel(ie)):(oe=new v(_),le=setTimeout(function(){oe._fulfill()},+Q),b.cancellation()&&oe._setOnCancel(new S(le)),oe._captureStackTrace()),oe._setAsyncGuaranteed(),oe};v.prototype.delay=function(Q){return J(Q,this)},v.prototype.timeout=function(Q,ie){Q=+Q;var oe,le,he=new S(setTimeout(function(){oe.isPending()&&function(Q,ie,oe){var le;le="string"!=typeof ie?ie instanceof Error?ie:new j("operation timed out"):new j(ie),O.markAsOriginatingFromRejection(le),Q._attachExtraTrace(le),Q._reject(le),null!=oe&&oe.cancel()}(oe,ie,le)},Q));return b.cancellation()?(le=this.then(),(oe=le._then(I,k,void 0,he,void 0))._setOnCancel(he)):oe=this._then(I,k,void 0,he,void 0),oe}}},{"./util":36}],35:[function(f,g,m){g.exports=function(v,_,b,S,I,k){function O(ke){setTimeout(function(){throw ke},0)}function W(ke,xe){var V=0,F=ke.length,z=new v(I);return function Le(){if(V>=F)return z._fulfill();var $=function j(ke){var xe=b(ke);return xe!==ke&&"function"==typeof ke._isDisposable&&"function"==typeof ke._getDisposer&&ke._isDisposable()&&xe._setDisposable(ke._getDisposer()),xe}(ke[V++]);if($ instanceof v&&$._isDisposable()){try{$=b($._getDisposer().tryDispose(xe),ke.promise)}catch(P){return O(P)}if($ instanceof v)return $._then(Le,O,null,null,null)}Le()}(),z}function J(ke,xe,Le){this._data=ke,this._promise=xe,this._context=Le}function K(ke,xe,Le){this.constructor$(ke,xe,Le)}function Q(ke){return J.isDisposer(ke)?(this.resources[this.index]._setDisposable(ke),ke.promise()):ke}function ie(ke){this.length=ke,this.promise=null,this[ke-1]=null}var oe=f("./util"),le=f("./errors").TypeError,he=f("./util").inherits,_e=oe.errorObj,Ve=oe.tryCatch,ee={};J.prototype.data=function(){return this._data},J.prototype.promise=function(){return this._promise},J.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():ee},J.prototype.tryDispose=function(ke){var xe=this.resource(),Le=this._context;void 0!==Le&&Le._pushContext();var V=xe!==ee?this.doDispose(xe,ke):null;return void 0!==Le&&Le._popContext(),this._promise._unsetDisposable(),this._data=null,V},J.isDisposer=function(ke){return null!=ke&&"function"==typeof ke.resource&&"function"==typeof ke.tryDispose},he(K,J),K.prototype.doDispose=function(ke,xe){return this.data().call(ke,ke,xe)},ie.prototype._resultCancelled=function(){for(var ke=this.length,xe=0;ke>xe;++xe){var Le=this[xe];Le instanceof v&&Le.cancel()}},v.using=function(){var ke=arguments.length;if(2>ke)return _("you must pass at least 2 arguments to Promise.using");var xe=arguments[ke-1];if("function"!=typeof xe)return _("expecting a function but got "+oe.classString(xe));var Le,V=!0;2===ke&&Array.isArray(arguments[0])?(ke=(Le=arguments[0]).length,V=!1):(Le=arguments,ke--);for(var F=new ie(ke),z=0;ke>z;++z){var $=Le[z];if(J.isDisposer($)){var P=$;($=$.promise())._setDisposable(P)}else{var L=b($);L instanceof v&&($=L._then(Q,null,null,{resources:F,index:z},void 0))}F[z]=$}var X=new Array(F.length);for(z=0;z<X.length;++z)X[z]=v.resolve(F[z]).reflect();var ne=v.all(X).then(function(te){for(var ae=0;ae<te.length;++ae){var fe=te[ae];if(fe.isRejected())return _e.e=fe.error(),_e;if(!fe.isFulfilled())return void ne.cancel();te[ae]=fe.value()}Z._pushContext(),xe=Ve(xe);var be=V?xe.apply(void 0,te):xe(te),Pe=Z._popContext();return k.checkForgottenReturns(be,Pe,"Promise.using",Z),be}),Z=ne.lastly(function(){var te=new v.PromiseInspection(ne);return W(F,te)});return F.promise=Z,Z._setOnCancel(F),Z},v.prototype._setDisposable=function(ke){this._bitField=131072|this._bitField,this._disposer=ke},v.prototype._isDisposable=function(){return(131072&this._bitField)>0},v.prototype._getDisposer=function(){return this._disposer},v.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},v.prototype.disposer=function(ke){if("function"==typeof ke)return new K(ke,this,S());throw new le}}},{"./errors":12,"./util":36}],36:[function(f,g,m){function v(){try{var Ae=P;return P=null,Ae.apply(this,arguments)}catch(de){return $.e=de,$}}function b(Ae){return null==Ae||!0===Ae||!1===Ae||"string"==typeof Ae||"number"==typeof Ae}function j(Ae,de,tt){return b(Ae)||F.defineProperty(Ae,de,{value:tt,configurable:!0,enumerable:!1,writable:!0}),Ae}function oe(Ae){try{return Ae+""}catch(de){return"[no string representation]"}}function le(Ae){return Ae instanceof Error||null!==Ae&&"object"==typeof Ae&&"string"==typeof Ae.message&&"string"==typeof Ae.name}function Ve(Ae){return le(Ae)&&F.propertyIsWritable(Ae,"stack")}function ee(Ae){return{}.toString.call(Ae)}var P,F=f("./es5"),z="undefined"==typeof navigator,$={e:{}},L="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null,ne=function(){var Ae=[Array.prototype,Object.prototype,Function.prototype],de=function(et){for(var Qe=0;Qe<Ae.length;++Qe)if(Ae[Qe]===et)return!0;return!1};if(F.isES5){var tt=Object.getOwnPropertyNames;return function(et){for(var Qe=[],Je=Object.create(null);null!=et&&!de(et);){var st;try{st=tt(et)}catch(nt){return Qe}for(var mt=0;mt<st.length;++mt){var ut=st[mt];if(!Je[ut]){Je[ut]=!0;var Ke=Object.getOwnPropertyDescriptor(et,ut);null!=Ke&&null==Ke.get&&null==Ke.set&&Qe.push(ut)}}et=F.getPrototypeOf(et)}return Qe}}var Ze={}.hasOwnProperty;return function(et){if(de(et))return[];var Qe=[];e:for(var Je in et)if(Ze.call(et,Je))Qe.push(Je);else{for(var st=0;st<Ae.length;++st)if(Ze.call(Ae[st],Je))continue e;Qe.push(Je)}return Qe}}(),Z=/this\s*\.\s*\S+\s*=/,te=/^[a-z$_][a-z$_0-9]*$/i,ae="stack"in new Error?function(Ae){return Ve(Ae)?Ae:new Error(oe(Ae))}:function(Ae){if(Ve(Ae))return Ae;try{throw new Error(oe(Ae))}catch(de){return de}},fe=function(Ae){return F.isArray(Ae)?Ae:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var be="function"==typeof Array.from?function(Ae){return Array.from(Ae)}:function(Ae){for(var de,tt=[],Ze=Ae[Symbol.iterator]();!(de=Ze.next()).done;)tt.push(de.value);return tt};fe=function(Ae){return F.isArray(Ae)?Ae:null!=Ae&&"function"==typeof Ae[Symbol.iterator]?be(Ae):null}}var Xe,Ae,Pe="undefined"!=typeof process&&"[object process]"===ee(process).toLowerCase(),De="undefined"!=typeof process&&void 0!==process.env,Re={setReflectHandler:function(Ae){Xe=Ae},isClass:function J(Ae){try{if("function"==typeof Ae){var de=F.names(Ae.prototype),tt=F.isES5&&de.length>1,Ze=de.length>0&&!(1===de.length&&"constructor"===de[0]),et=Z.test(Ae+"")&&F.names(Ae).length>0;if(tt||Ze||et)return!0}return!1}catch(Qe){return!1}},isIdentifier:function Q(Ae){return te.test(Ae)},inheritedDataKeys:ne,getDataPropertyOrDefault:function O(Ae,de,tt){if(!F.isES5)return{}.hasOwnProperty.call(Ae,de)?Ae[de]:void 0;var Ze=Object.getOwnPropertyDescriptor(Ae,de);return null!=Ze?null==Ze.get&&null==Ze.set?Ze.value:tt:void 0},thrower:function W(Ae){throw Ae},isArray:F.isArray,asArray:fe,notEnumerableProp:j,isPrimitive:b,isObject:function S(Ae){return"function"==typeof Ae||"object"==typeof Ae&&null!==Ae},isError:le,canEvaluate:z,errorObj:$,tryCatch:function _(Ae){return P=Ae,v},inherits:function(Ae,de){function tt(){for(var et in this.constructor=Ae,this.constructor$=de,de.prototype)Ze.call(de.prototype,et)&&"$"!==et.charAt(et.length-1)&&(this[et+"$"]=de.prototype[et])}var Ze={}.hasOwnProperty;return tt.prototype=de.prototype,Ae.prototype=new tt,Ae.prototype},withAppended:function k(Ae,de){var tt,Ze=Ae.length,et=new Array(Ze+1);for(tt=0;Ze>tt;++tt)et[tt]=Ae[tt];return et[tt]=de,et},maybeWrapAsError:function I(Ae){return b(Ae)?new Error(oe(Ae)):Ae},toFastProperties:function K(Ae){function de(){}function tt(){return typeof Ze.foo}de.prototype=Ae;var Ze=new de;return tt(),tt(),Ae},filledRange:function ie(Ae,de,tt){for(var Ze=new Array(Ae),et=0;Ae>et;++et)Ze[et]=de+et+tt;return Ze},toString:oe,canAttachTrace:Ve,ensureErrorObject:ae,originatesFromRejection:function _e(Ae){return null!=Ae&&(Ae instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===Ae.isOperational)},markAsOriginatingFromRejection:function he(Ae){try{j(Ae,"isOperational",!0)}catch(de){}},classString:ee,copyDescriptors:function ke(Ae,de,tt){for(var Ze=F.names(Ae),et=0;et<Ze.length;++et){var Qe=Ze[et];if(tt(Qe))try{F.defineProperty(de,Qe,F.getDescriptor(Ae,Qe))}catch(Je){}}},isNode:Pe,hasEnvVariables:De,env:function xe(Ae){return De?process.env[Ae]:void 0},global:L,getNativePromise:function Le(){if("function"==typeof Promise)try{if("[object Promise]"===ee(new Promise(function(){})))return Promise}catch(de){}},contextBind:function V(Ae,de){if(null===Ae||"function"!=typeof de||de===Xe)return de;null!==Ae.domain&&(de=Ae.domain.bind(de));var tt=Ae.async;if(null!==tt){var Ze=de;de=function(){var et=new Array(2).concat([].slice.call(arguments));return et[0]=Ze,et[1]=this,tt.runInAsyncScope.apply(tt,et)}}return de}};Re.isRecentNode=Re.isNode&&(process.versions&&process.versions.node?Ae=process.versions.node.split(".").map(Number):process.version&&(Ae=process.version.split(".").map(Number)),0===Ae[0]&&Ae[1]>10||Ae[0]>0),Re.nodeSupportsAsyncResource=Re.isNode&&function(){var Ae=!1;try{Ae="function"==typeof f("async_hooks").AsyncResource.prototype.runInAsyncScope}catch(tt){Ae=!1}return Ae}(),Re.isNode&&Re.toFastProperties(process);try{throw new Error}catch(Ae){Re.lastLineError=Ae}g.exports=Re},{"./es5":13,async_hooks:void 0}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)),Ie.DWT.bNpm=!0,Ie.DWT.dbrCanvasMaxWH=4096,Ie.aryAddonReadyFun=[],Ie.AddonReady=function(p){Ie.aryAddonReadyFun.push(p)},(Ie=self.Dynamsoft||{}).DWT=Ie.DWT||{},Ie.DBR=Ie.DBR||{},Ie.aryAddonReadyFun=Ie.aryAddonReadyFun||[],Ie.AddonReady=Ie.AddonReady||function(p){Ie.aryAddonReadyFun.push(p)},function(){Ie.BarcodeReaderAddon=Ie.BarcodeReaderAddon||{};var p=Ie.BarcodeReaderAddon;p.Version="9.6.1.0312",p._decoding=!1,p._decodeQueue=[],p._decodeNext=function(){var l,u;0==p._decodeQueue.length?p._decoding=!1:(l=(u=p._decodeQueue[0]).method,u=u.args,p._decodeQueue.splice(0,1),l.apply(null,u))},p._defaultRuntimeSettingsStr="",p._defaultTemplateStr="",p._activeXInstance=!1,p.BarcodeReaderException=function(){var u,l=Ie.DBR.EnumErrorCode.DBR_UNKNOWN;return(u="number"==typeof(u=arguments[0])?(l=u,new Error(arguments[1])):new Error(u)).code=l,u},p.RemoveNonPrintableChar=function(l){return Ie.Lib.isString(l)?l.replace(/[^\x20-\x7E]|(\\")/g,""):l},p.errors={webcamNotInstalled:"The Webcam add-on not installed.",nonServiceNotSupportWebcamDecode:"The BarcodeReader add-on does not support reading barcodes from video streams.",decodeResultEmpty:"decode result is empty.",ServiceEditionNotSupportDbr:"The BarcodeReader add-on does not support your Operating System.",ServiceEditionNotSupportWasmMode:"You cannot call this method on this WebTwain instance."},p._activeXMaxIEVersion=9,p.logLevel=3,Ie.DBR.EnumAccompanyingTextRecognitionMode={ATRM_GENERAL:1,ATRM_SKIP:0},Ie.DBR.EnumBarcodeColourMode={BICM_DARK_ON_LIGHT:1,BICM_LIGHT_ON_DARK:2,BICM_DARK_ON_DARK:4,BICM_LIGHT_ON_LIGHT:8,BICM_DARK_LIGHT_MIXED:16,BICM_DARK_ON_LIGHT_DARK_SURROUNDING:32,BICM_SKIP:0},Ie.DBR.EnumBarcodeComplementMode={BCM_AUTO:1,BCM_GENERAL:2,BCM_SKIP:0},Ie.DBR.EnumBarcodeFormat={BF_ALL:-32505857,BF_ONED:2047,BF_GS1_DATABAR:260096,BF_CODE_39:1,BF_CODE_128:2,BF_CODE_93:4,BF_CODABAR:8,BF_ITF:16,BF_EAN_13:32,BF_EAN_8:64,BF_UPC_A:128,BF_UPC_E:256,BF_INDUSTRIAL_25:512,BF_CODE_39_EXTENDED:1024,BF_GS1_DATABAR_OMNIDIRECTIONAL:2048,BF_GS1_DATABAR_TRUNCATED:4096,BF_GS1_DATABAR_STACKED:8192,BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:16384,BF_GS1_DATABAR_EXPANDED:32768,BF_GS1_DATABAR_EXPANDED_STACKED:65536,BF_GS1_DATABAR_LIMITED:131072,BF_PATCHCODE:262144,BF_PDF417:33554432,BF_QR_CODE:67108864,BF_DATAMATRIX:134217728,BF_AZTEC:268435456,BF_MAXICODE:536870912,BF_MICRO_QR:1073741824,BF_MICRO_PDF417:524288,BF_GS1_COMPOSITE:-2147483648,BF_NULL:0},Ie.DBR.EnumBarcodeFormat_2={BF2_NULL:0,BF2_POSTALCODE:32505856,BF2_NONSTANDARD_BARCODE:1,BF2_USPSINTELLIGENTMAIL:1048576,BF2_POSTNET:2097152,BF2_PLANET:4194304,BF2_AUSTRALIANPOST:8388608,BF2_RM4SCC:16777216,BF2_DOTCODE:2},Ie.DBR.EnumBinarizationMode={BM_AUTO:1,BM_LOCAL_BLOCK:2,BM_SKIP:0},Ie.DBR.EnumClarityCalculationMethod={ECCM_CONTRAST:1},Ie.DBR.EnumClarityFilterMode={CFM_GENERAL:1},Ie.DBR.EnumColourClusteringMode={CCM_AUTO:1,CCM_GENERAL_HSV:2,CCM_SKIP:0},Ie.DBR.EnumColourConversionMode={CICM_GENERAL:1,CICM_SKIP:0},Ie.DBR.EnumConflictMode={CM_IGNORE:1,CM_OVERWRITE:2},Ie.DBR.EnumDeformationResistingMode={DRM_AUTO:1,DRM_GENERAL:2,DRM_SKIP:0},Ie.DBR.EnumDPMCodeReadingMode={DPMCRM_AUTO:1,DPMCRM_GENERAL:2,DPMCRM_SKIP:0},Ie.DBR.EnumErrorCode={DBR_SYSTEM_EXCEPTION:1,DBR_SUCCESS:0,DBR_UNKNOWN:-1e4,DBR_NO_MEMORY:-10001,DBR_NULL_REFERENCE:-10002,DBR_LICENSE_INVALID:-10003,DBR_LICENSE_EXPIRED:-10004,DBR_FILE_NOT_FOUND:-10005,DBR_FILETYPE_NOT_SUPPORTED:-10006,DBR_BPP_NOT_SUPPORTED:-10007,DBR_INDEX_INVALID:-10008,DBR_BARCODE_FORMAT_INVALID:-10009,DBR_CUSTOM_REGION_INVALID:-10010,DBR_MAX_BARCODE_NUMBER_INVALID:-10011,DBR_IMAGE_READ_FAILED:-10012,DBR_TIFF_READ_FAILED:-10013,DBR_QR_LICENSE_INVALID:-10016,DBR_1D_LICENSE_INVALID:-10017,DBR_DIB_BUFFER_INVALID:-10018,DBR_PDF417_LICENSE_INVALID:-10019,DBR_DATAMATRIX_LICENSE_INVALID:-10020,DBR_PDF_READ_FAILED:-10021,DBR_PDF_DLL_MISSING:-10022,DBR_PAGE_NUMBER_INVALID:-10023,DBR_CUSTOM_SIZE_INVALID:-10024,DBR_CUSTOM_MODULESIZE_INVALID:-10025,DBR_RECOGNITION_TIMEOUT:-10026,DBR_JSON_PARSE_FAILED:-10030,DBR_JSON_TYPE_INVALID:-10031,DBR_JSON_KEY_INVALID:-10032,DBR_JSON_VALUE_INVALID:-10033,DBR_JSON_NAME_KEY_MISSING:-10034,DBR_JSON_NAME_VALUE_DUPLICATED:-10035,DBR_TEMPLATE_NAME_INVALID:-10036,DBR_JSON_NAME_REFERENCE_INVALID:-10037,DBR_PARAMETER_VALUE_INVALID:-10038,DBR_DOMAIN_NOT_MATCHED:-10039,DBR_RESERVEDINFO_NOT_MATCHED:-10040,DBR_AZTEC_LICENSE_INVALID:-10041,DBR_LICENSE_DLL_MISSING:-10042,DBR_LICENSEKEY_NOT_MATCHED:-10043,DBR_REQUESTED_FAILED:-10044,DBR_LICENSE_INIT_FAILED:-10045,DBR_PATCHCODE_LICENSE_INVALID:-10046,DBR_POSTALCODE_LICENSE_INVALID:-10047,DBR_DPM_LICENSE_INVALID:-10048,DBR_FRAME_DECODING_THREAD_EXISTS:-10049,DBR_STOP_DECODING_THREAD_FAILED:-10050,DBR_SET_MODE_ARGUMENT_ERROR:-10051,DBR_LICENSE_CONTENT_INVALID:-10052,DBR_LICENSE_KEY_INVALID:-10053,DBR_LICENSE_DEVICE_RUNS_OUT:-10054,DBR_GET_MODE_ARGUMENT_ERROR:-10055,DBR_IRT_LICENSE_INVALID:-10056,DBR_MAXICODE_LICENSE_INVALID:-10057,DBR_GS1_DATABAR_LICENSE_INVALID:-10058,DBR_GS1_COMPOSITE_LICENSE_INVALID:-10059,DBR_DOTCODE_LICENSE_INVALID:-10061,DMERR_FAILED_TO_REACH_LTS:-20200},Ie.DBR.EnumGrayscaleTransformationMode={GTM_INVERTED:1,GTM_ORIGINAL:2,GTM_SKIP:0},Ie.DBR.EnumImagePixelFormat={IPF_Binary:0,IPF_BinaryInverted:1,IPF_GrayScaled:2,IPF_NV21:3,IPF_RGB_565:4,IPF_RGB_555:5,IPF_RGB_888:6,IPF_ARGB_8888:7,IPF_RGB_161616:8,IPF_ARGB_16161616:9,IPF_ABGR_8888:10,IPF_ABGR_16161616:11,IPF_BGR_888:12},Ie.DBR.EnumImagePreprocessingMode={IPM_AUTO:1,IPM_GENERAL:2,IPM_GRAY_EQUALIZE:4,IPM_GRAY_SMOOTH:8,IPM_SHARPEN_SMOOTH:16,IPM_MORPHOLOGY:32,IPM_SKIP:0},Ie.DBR.EnumIMResultDataType={IMRDT_IMAGE:1,IMRDT_CONTOUR:2,IMRDT_LINESEGMENT:4,IMRDT_LOCALIZATIONRESULT:8,IMRDT_REGIONOFINTEREST:16,IMRDT_QUADRILATERAL:32},Ie.DBR.EnumIntermediateResultSavingMode={IRSM_MEMORY:1,IRSM_FILESYSTEM:2,IRSM_BOTH:4},Ie.DBR.EnumIntermediateResultType={IRT_NO_RESULT:0,IRT_ORIGINAL_IMAGE:1,IRT_COLOUR_CLUSTERED_IMAGE:2,IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE:4,IRT_TRANSFORMED_GRAYSCALE_IMAGE:8,IRT_PREDETECTED_REGION:16,IRT_PREPROCESSED_IMAGE:32,IRT_BINARIZED_IMAGE:64,IRT_TEXT_ZONE:128,IRT_CONTOUR:256,IRT_LINE_SEGMENT:512,IRT_FORM:1024,IRT_SEGMENTATION_BLOCK:2048,IRT_TYPED_BARCODE_ZONE:4096,IRT_PREDETECTED_QUADRILATERAL:8192},Ie.DBR.EnumLocalizationMode={LM_SKIP:0,LM_AUTO:1,LM_CONNECTED_BLOCKS:2,LM_LINES:8,LM_STATISTICS:4,LM_SCAN_DIRECTLY:16,LM_STATISTICS_MARKS:32,LM_STATISTICS_POSTAL_CODE:64},Ie.DBR.EnumPDFReadingMode={PDFRM_RASTER:1,PDFRM_AUTO:2,PDFRM_VECTOR:4},Ie.DBR.EnumQRCodeErrorCorrectionLevel={QRECL_ERROR_CORRECTION_H:0,QRECL_ERROR_CORRECTION_L:1,QRECL_ERROR_CORRECTION_M:2,QRECL_ERROR_CORRECTION_Q:3},Ie.DBR.EnumRegionPredetectionMode={RPM_AUTO:1,RPM_GENERAL:2,RPM_GENERAL_RGB_CONTRAST:4,RPM_GENERAL_GRAY_CONTRAST:8,RPM_GENERAL_HSV_CONTRAST:16,RPM_SKIP:0},Ie.DBR.EnumResultCoordinateType={RCT_PIXEL:1,RCT_PERCENTAGE:2},Ie.DBR.EnumResultType={RT_STANDARD_TEXT:0,RT_RAW_TEXT:1,RT_CANDIDATE_TEXT:2,RT_PARTIAL_TEXT:3},Ie.DBR.EnumScaleUpMode={SUM_AUTO:1,SUM_LINEAR_INTERPOLATION:2,SUM_NEAREST_NEIGHBOUR_INTERPOLATION:4,SUM_SKIP:0},Ie.DBR.EnumTerminatePhase={TP_REGION_PREDETECTED:1,TP_IMAGE_PREPROCESSED:2,TP_IMAGE_BINARIZED:4,TP_BARCODE_LOCALIZED:8,TP_BARCODE_TYPE_DETERMINED:16,TP_BARCODE_RECOGNIZED:32},Ie.DBR.EnumTextAssistedCorrectionMode={TACM_AUTO:1,TACM_VERIFYING:2,TACM_VERIFYING_PATCHING:4,TACM_SKIP:0},Ie.DBR.EnumTextFilterMode={TFM_AUTO:1,TFM_GENERAL_CONTOUR:2,TFM_SKIP:0},Ie.DBR.EnumTextResultOrderMode={TROM_CONFIDENCE:1,TROM_POSITION:2,TROM_FORMAT:4,TROM_SKIP:0},Ie.DBR.EnumTextureDetectionMode={TDM_AUTO:1,TDM_GENERAL_WIDTH_CONCENTRATION:2,TDM_SKIP:0}}(),Ie.AddonReady(function(p,l){var u,f=Ie.BarcodeReaderAddon;function g(m){return m&&m instanceof ArrayBuffer}f.Class=function(){function m(_){this._runtimeSettings=null,this._initSettingsContent=null,this._tplContentArr=[],this._stwain=_}var v;return m.prototype._decodeBlob=function(_,b){var S=this;return new p.Promise(function(I){if(!(_ instanceof Blob))throw TypeError("'_decodeBlob(blob, templateName)': Type of 'blob' should be 'Blob'.");I()}).then(function(){return S._innerDecode(0,_,b)})},m.prototype._decodeArrayBuffer=function(_,b){var S=this;return new p.Promise(function(I){if(!(_ instanceof ArrayBuffer))throw TypeError("'_decodeBlob(arrayBuffer, templateName)': Type of 'arrayBuffer' should be 'ArrayBuffer'.");I()}).then(function(){return S._innerDecode(0,_,b)})},m.prototype._decodeUint8Array=function(_,b){var S=this;return new p.Promise(function(I){if(!(_ instanceof Uint8Array||self.Uint8ClampedArray&&_ instanceof Uint8ClampedArray))throw TypeError("'_decodeBlob(uint8Array, templateName)': Type of 'uint8Array' should be 'Uint8Array'.");I()}).then(function(){return S._innerDecode(0,_,b)})},m.prototype._decodeImage=function(_,b){var S=this;return new p.Promise(function(I){if(!(_ instanceof HTMLImageElement))throw TypeError("'_decodeImage(image, templateName)': Type of 'image' should be 'HTMLImageElement'.");if(_.crossOrigin&&"anonymous"!=_.crossOrigin)throw"cors";b=b||"",I()}).then(function(){return"data:image/"==_.src.substring(0,11)?S._decodeBase64(_.src,b):S._decodeUrl(_.src,b).catch(function(I){return 3<=f.logLevel&&console&&console.warn&&(console.warn("'_decodeImage(image, templateName)': Image src not available. Use '_decodeCanvas' instead."),console.warn(I)),self.HTMLCanvasElement?((I=document.createElement("canvas")).width=_.naturalWidth,I.height=_.naturalHeight,I.getContext("2d").drawImage(_,0,0),S._decodeCanvas(I,b)):p.Promise.reject(Error("'_decodeImage(image, templateName)': Browser not support HTMLCanvasElement."))})})},m.prototype._decodeCanvas=function(_,b){var S=this;return new p.Promise(function(I){if(!(_ instanceof HTMLCanvasElement))throw TypeError("'_decodeCanvas(canvas, templateName)': Type of 'canvas' should be 'HTMLCanvasElement'.");if(_.crossOrigin&&"anonymous"!=_.crossOrigin)throw"cors";b=b||"",_.toBlob?_.toBlob(function(k){I(k)}):_.msToBlob?_.msToBlob(function(k){I(k)}):I(_.toDataURL())}).then(function(I){return _.toBlob||_.msToBlob?S._decodeBlob(I,b):S._decodeBase64(I,b)})},m.prototype._decodeVideo=function(_){var b,S=this,I=arguments;return new p.Promise(function(k){if(!(_ instanceof HTMLVideoElement))throw TypeError("'_decodeVideo(video [ [, sx, sy, sWidth, sHeight], dWidth, dHeight] [, templateName] )': Type of 'video' should be 'HTMLVideoElement'.");if(_.crossOrigin&&"anonymous"!=_.crossOrigin)throw"cors";I.length<=2?(O=j=0,W=K=_.videoWidth,J=Q=_.videoHeight):Q=I.length<=4?(O=j=0,W=_.videoWidth,J=_.videoHeight,K=I[1],I[2]):(O=I[1],j=I[2],W=I[3],J=I[4],K=I[5],I[6]),b="string"==typeof I[I.length-1]?I[I.length-1]:"";var O,j,W,J,K,Q,ie=document.createElement("canvas");ie.width=K,ie.height=Q,ie.getContext("2d").drawImage(_,O,j,W,J,0,0,K,Q),k(ie)}).then(function(k){return S._decodeCanvas(k,b)})},m.prototype._decodeBase64=m.prototype.decodeBase64String=function(_,b){var S=this;return new p.Promise(function(I){if(!("string"==typeof _||"object"==typeof _&&_ instanceof String))throw TypeError("'decodeBase64(base64Str, templateName)': Type of 'base64Str' should be 'String'.");"data:image/"==_.substring(0,11)&&(_=_.substring(_.indexOf(",")+1)),I()}).then(function(){return S._innerDecode(1,_,b)})},m.prototype._decodeUrl=function(_,b){var S=this;return _&&_.indexOf&&(0==_.indexOf("dwt://")||0==_.indexOf("dcs://"))?S._decodeDynamsoftServiceInnerUrl(_,b):new p.Promise(function(I,k){var O;if(!("string"==typeof _||"object"==typeof _&&_ instanceof String))throw TypeError("'_decodeUrl(url, templateName)': Type of 'url' should be 'String'.");b=b||"",f._activeXInstance?((O=new ActiveXObject("MSXML2.XMLHTTP")).open("GET",_,!0),O.overrideMimeType?O.overrideMimeType("text/plain; charset=x-user-defined"):O.setRequestHeader("Accept-Charset","x-user-defined"),O.onreadystatechange=function(){4==O.readyState&&I(new VBArray(O.responseBody).toArray())},O.send("")):((O=new XMLHttpRequest).open("GET",_,!0),O.responseType="arraybuffer",O.send(),O.onloadend=function(){I(this.response)},O.onerror=function(){k(Error(O.error))})}).then(function(I){return f._activeXInstance?S._activeXDecodeArray(I,b):S._decodeArrayBuffer(I,b)})},m.prototype._decodeDynamsoftServiceInnerUrl=function(_,b){var S=this;return new p.Promise(function(I){if(!("string"==typeof _||"object"==typeof _&&_ instanceof String))throw TypeError("'_decodeUrl(url, templateName)': Type of 'innerUrl' should be 'String'.");if(0!=_.indexOf("dwt://")&&0!=_.indexOf("dcs://"))throw TypeError("'_decodeDynamsoftServiceInnerUrl(innerUrl, templateName)': 'innerUrl' should start with 'dwt://' or 'dcs://'.");I()}).then(function(){return S._innerDecode(4e3,_,b)})},m.prototype._activeXDecodeArray=function(_,b){var S=this;return new p.Promise(function(I,k){if(!(_ instanceof Array))throw TypeError("'_activeXDecodeArray(array, templateName)': Type of 'array' should be 'Array'.");b=b||"";try{I(Ie.Lib.btoa(String.fromCharCode.apply(String,_)))}catch(O){k(O)}}).then(function(I){return S._decodeBase64(I,b)})},m.prototype._activeXDecodeHandle=function(_,b){var S=this;return new p.Promise(function(I){b=b||"",I()}).then(function(){return S._innerDecode(4001,_,b)})},m.prototype._decode=m.prototype.decode=function(_,b){return f._activeXInstance?"string"==typeof _||_ instanceof String?this._activeXDecodeHandle(_,b):p.Promise.reject(TypeError("'_decode(source, templateName)' in activeX: Type of 'source' should be 'String(partUrl)'.")):self.Blob&&_ instanceof Blob?this._decodeBlob(_,b):self.ArrayBuffer&&_ instanceof ArrayBuffer?this._decodeArrayBuffer(_,b):self.Uint8Array&&_ instanceof Uint8Array||self.Uint8ClampedArray&&_ instanceof Uint8ClampedArray?this._decodeUint8Array(_,b):_ instanceof Array?this._activeXDecodeArray(_,b):self.HTMLImageElement&&_ instanceof HTMLImageElement?this._decodeImage(_,b):self.HTMLCanvasElement&&_ instanceof HTMLCanvasElement?this._decodeCanvas(_,b):self.HTMLVideoElement&&_ instanceof HTMLVideoElement?this._decodeVideo(_,b):isNaN(_)?"string"==typeof _||_ instanceof String?"data:image/"==_.substring(0,11)?this._decodeBase64(_,b):this._decodeUrl(_,b):p.Promise.reject(TypeError("'_decode(source, templateName)' in H5: Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'.")):this._activeXDecodeHandle(_,b)},m.prototype._innerServiceCmd=function(_,b){var S=this._stwain;return new p.Promise(function(I,k){var O,j={method:"ReadBarcode",parameter:[Ie.Lib.product.refProductKey,4002,"",""],updateSettings:_,initSettingsContent:b};f._activeXInstance?I(f._activeXInstance.Process(p.stringify(j),location.protocol+"//"+location.host)):(S._blts?(O="",S&&S._bRemoteMode&&S._dmService&&S._dmService.attrs&&S._dmService.attrs.UUID&&(O=S._dmService.attrs.UUID),Ie.DWT.lglic(Ie.DWT.EnumInstance.dwt_desktop,O).then(function(W){return j.parameter.push(W.ar),j.parameter.push(W.cu),j.parameter.push(0),j.parameter.push(""),p.stringify(j)})):p.Promise.resolve(p.stringify(j))).then(function(W){return p.fetch(S._dbrUrlRoot+"ReadBarcode",{mode:"cors",method:"post",body:W,dataType:"arrayBuffer"})}).then(function(W){g(W)?I(String.fromCharCode.apply(null,new Uint8Array(W))):I(W)},function(W){var J="Init template & runtimeSettings failed.";W&&(J=[J," Http info: ",W.errorString," (",W.httpCode,")"].join("")),k(J)})})},m.prototype._innerDecode=function(_,b,S,I){var k=this;return k._runtimeSettings&&0==k._runtimeSettings.expectedBarcodesCount&&(k._runtimeSettings.expectedBarcodesCount=512),new p.Promise(function(O,j){function W(oe,le,he){try{var _e,Ve,ee,ke,xe=v&&v(oe);for(xe&&xe.textResults||j(new f.BarcodeReaderException(xe.exception,xe.description)),p.product.bHTML5Edition&&he&&he.config.data&&(_e=p.parse(he.config.data),p.isArray(_e.parameter))&&2<_e.parameter.length&&4e3==_e.parameter[1]&&(4<_e.parameter.length&&_e.parameter[4]?xe.textResults.imageid=_e.parameter[4]:0<=(ke=(ee=_e.parameter[2]).indexOf("&index="))&&(xe.textResults.imageid=ee.substring(ke+7,ee.indexOf("&t=")))),Ve=0;Ve<xe.textResults.length;Ve++){var Le=xe.textResults[Ve];Le.BarcodeText=Le.barcodeText,xe.exception!=Ie.DBR.EnumErrorCode.DBR_SUCCESS&&(Le.exception=xe.exception)}xe.exception!=Ie.DBR.EnumErrorCode.DBR_SUCCESS&&(xe.textResults.exception=xe.exception,xe.textResults.description=xe.description),f._activeXInstance&&xe.records&&(Ie.Lib.each(xe.records,function(V,F){Ie.DWT.lavrf(F,V,Ie.DWT.EnumInstance.dwt_desktop)}),Ie.DWT.lavrf_(1,Ie.DWT.EnumInstance.dwt_desktop)),O(xe.textResults)}catch(V){j(V)}}var J,K,Q={method:"ReadBarcode",parameter:[Ie.Lib.product.refProductKey,_,0!=_?b:null,S||""],updateSettings:k._runtimeSettings,conflictMode:1==k.conflictMode?"ignore":"overwrite",initSettingsContent:k._initSettingsContent,tplContent:function(){if(S)for(var oe=0;oe<k._tplContentArr.length;++oe)if(S==k._tplContentArr[oe].ImageParameter.Name)return p.stringify(k._tplContentArr[oe]);return null}()},ie=k._stwain;f._activeXInstance?ie._blts?Ie.DWT.lglic(Ie.DWT.EnumInstance.dwt_desktop,"").then(function(oe){Q.parameter.push(oe.ar),Q.parameter.push(oe.cu),Q.parameter.push(0),Q.parameter.push(""),W(f._activeXInstance.Process(p.stringify(Q),location.protocol+"//"+location.host))}):W(f._activeXInstance.Process(p.stringify(Q),location.protocol+"//"+location.host)):(J=ie._dbrUrlRoot+"ReadBarcode",0==_&&(J+="/LoadZipFromBytes?cmd="+encodeURIComponent(p.stringify(Q))),(0==_?p.Promise.resolve(b):ie._blts?(K="",ie&&ie._bRemoteMode&&ie._dmService&&ie._dmService.attrs&&ie._dmService.attrs.UUID&&(K=ie._dmService.attrs.UUID),Ie.DWT.lglic(Ie.DWT.EnumInstance.dwt_desktop,K).then(function(oe){return Q.parameter.push(oe.ar),Q.parameter.push(oe.cu),Q.parameter.push(0),Q.parameter.push([p.product.getDWTPrefix(),p.product.getServerVersionInfo(),"/verify?id=",I,"&t=",p.getRandom()].join("")),p.stringify(Q)})):p.Promise.resolve(p.stringify(Q))).then(function(oe){return p.fetch(J,{mode:"cors",method:"post",body:oe,dataType:"arrayBuffer"})}).then(function(oe,le,he){g(oe)?W(String.fromCharCode.apply(null,new Uint8Array(oe)),0,he):W(oe,0,he)},function(oe){var le="ReadBarcode request fail.";oe&&(le=[le," Http info: ",oe.errorString," (",oe.httpCode,")"].join("")),j(Error(le))}))})},v=f._handleRetJsonString=function(_){var b;if("string"==typeof _||"object"==typeof _&&_ instanceof String)try{b=p.parse(_)}catch(S){b=p.parse(f.RemoveNonPrintableChar(_))}else b=_;if(!b)throw f.BarcodeReaderException(Ie.DBR.EnumErrorCode.DBR_UNKNOWN,f.errors.decodeResultEmpty);if("textResults"in b&&p.isArray(b.textResults)||b.exception==Ie.DBR.EnumErrorCode.DBR_SUCCESS)return b;throw f.BarcodeReaderException(b.exception,b.description)},m.prototype.getAllParameterTemplateNames=function(){for(var _=[],b=0;b<this._tplContentArr.length;++b)_.push(this._tplContentArr[b].ImageParameter.Name);return _},m.prototype.getRuntimeSettings=function(){return this._runtimeSettings||(this._runtimeSettings=p.parse(f._defaultRuntimeSettingsStr)),p.Promise.resolve(this._runtimeSettings)},m.prototype.updateRuntimeSettings=function(_){var b,S=this;if("string"==typeof _||"object"==typeof _&&_ instanceof String){if("speed"==_||"balance"==_||"coverage"==_||"default"==_)return S.initRuntimeSettingsWithString("speed"==_?'{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":["BF2_POSTALCODE","BF2_DOTCODE"],"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":3,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_STATISTICS_MARKS"},{"Mode":"LM_STATISTICS_POSTAL_CODE"}],"MaxAlgorithmThreadCount":4,"Name":"bestSpeed","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":2300,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"Mode":"TFM_SKIP"}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}':"balance"==_?'{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":["BF2_POSTALCODE","BF2_DOTCODE"],"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":5,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_STATISTICS"},{"Mode":"LM_STATISTICS_MARKS"},{"Mode":"LM_STATISTICS_POSTAL_CODE"}],"MaxAlgorithmThreadCount":4,"Name":"balance","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":2300,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"MinImageDimension":65536,"Mode":"TFM_GENERAL_CONTOUR","Sensitivity":0}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}':"coverage"==_?'{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":["BF2_POSTALCODE","BF2_DOTCODE"],"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":9,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"},{"Mode":"GTM_INVERTED"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_SCAN_DIRECTLY","ScanDirection":0,"ScanStride":0},{"Mode":"LM_STATISTICS"},{"Mode":"LM_LINES"},{"Mode":"LM_STATISTICS_MARKS"},{"Mode":"LM_STATISTICS_POSTAL_CODE"}],"MaxAlgorithmThreadCount":4,"Name":"coverage","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":214748347,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"MinImageDimension":65536,"Mode":"TFM_GENERAL_CONTOUR","Sensitivity":0}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}':'{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":null,"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":9,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_SCAN_DIRECTLY","ScanDirection":0,"ScanStride":0},{"Mode":"LM_STATISTICS"},{"Mode":"LM_LINES"}],"MaxAlgorithmThreadCount":4,"Name":"default","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":2300,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"MinImageDimension":65536,"Mode":"TFM_GENERAL_CONTOUR","Sensitivity":0}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}');b=_}else{if("object"!=typeof _)throw TypeError("'setTemplateSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");b=p.stringify(_)}return _=p.parse(b),S._runtimeSettings=_,S._initSettingsContent=null,S._innerServiceCmd(S._runtimeSettings,null).then(function(I){return I=f._handleRetJsonString(I),S._runtimeSettings=I.settings,S._runtimeSettings||(S._runtimeSettings=p.parse(f._defaultRuntimeSettingsStr)),I.settings})},m.prototype.resetRuntimeSettings=function(){var _=this;return _._runtimeSettings=p.parse(f._defaultRuntimeSettingsStr),_._initSettingsContent=null,_._innerServiceCmd(_._runtimeSettings,null).then(function(b){return b=f._handleRetJsonString(b),_._runtimeSettings=b.settings,_._runtimeSettings||(_._runtimeSettings=p.parse(f._defaultRuntimeSettingsStr)),b.settings})},m.prototype.outputSettingsToString=function(_){if(!_)return f._defaultTemplateStr;for(var b=0;b<this._tplContentArr.length;++b)if(_==this._tplContentArr[b].ImageParameter.Name)return p.stringify(this._tplContentArr[b])},m.prototype.initRuntimeSettingsWithString=function(_){var b=this;if(p.isString(_))return b._runtimeSettings=null,b._initSettingsContent=p.parse(_),b._innerServiceCmd(null,b._initSettingsContent).then(function(S){return S=f._handleRetJsonString(S),b._runtimeSettings=S.settings,b._runtimeSettings||(b._runtimeSettings=p.parse(f._defaultRuntimeSettingsStr)),S.settings});throw TypeError("'initRuntimeSettingsWithString(settings)': Type of 'settings' should be 'String'.")},m}(),f._dbr_ax=!1,f._dbr=!1,f._initH5=function(m,v,_){return new p.Promise(function(b,S){m._bRemoteMode&&m._dmService&&m._dmService.attrs&&m._dmService.attrs.url&&(m._dbrUrlRoot=m._dmService.attrs.url+"dcp/dbr_"+f.Version.replace(/\./g,"")+"/"),m._dbrUrlRoot||(m._dbrUrlRoot=Ie.DWT.NetManager.getModuleUrl("dcp/dbr_"+f.Version.replace(/\./g,"")+"/"));var I=5,k={method:"POST",url:m._dbrUrlRoot+"VersionInfo?t="+p.getRandom(),data:'{"method":"VersionInfo"}',onSuccess:function(){b()},onError:function(){if(--I<=0)return S("Failed to connect to the Barcode Reader Add-on, the library may be missing in the Dynamsoft Service directory.");setTimeout(function(){p.ajax(k)},300)},dataType:"json",async:!0,timeout:800};p.ajax(k)}).then(function(){return f._dbr=new f.Class(m),f._dbr._innerServiceCmd(null,null)}).then(function(b){try{var S=f._handleRetJsonString(b);f._dbr._runtimeSettings=S.settings,f._defaultRuntimeSettingsStr=p.stringify(S.settings),f._defaultTemplateStr=p.stringify(S.outputSettings),v(f._dbr)}catch(I){_(Error("Init template & runtimeSettings failed: "+I.message)||I)}},function(b){_(b)})},f.dbrInitPromiseFun=function(m){return new p.Promise(function(v,_){f.innerDbrInit(m,v,_)})},f.innerDbrInit=function(m,v,_){var b=!1,S=!1,I=(p.product.bHTML5Edition?b=!0:S=!0,Ie.BarcodeReaderAddon);if(b){if(I._dbr)return void v(I._dbr)}else if(S&&I._dbr_ax)return void v(I._dbr_ax);if(b&&I._initH5(m,v,_),S){if(S={method:"ReadBarcode",parameter:[Ie.Lib.product.refProductKey,4002,"",""]},!(b=Ie.navInfoSync).bIE)return _(Error("The DBR init error."));try{I._activeXInstance=new ActiveXObject("DBRModule.AtlDBR");var O=I._activeXInstance.Process(p.stringify(S),location.protocol+"//"+location.host),j=p.parse(O);return j?"settings"in j?(I._dbr_ax=new I.Class(m),I._dbr_ax._runtimeSettings=j.settings,I._defaultRuntimeSettingsStr=p.stringify(j.settings),"outputSettings"in j&&(I._defaultTemplateStr=p.stringify(j.outputSettings)),void v(I._dbr_ax)):_(Error(j.description||"The DBR init error.")):_(Error("The DBR init error."))}catch(W){return _(Error("The DBR .dll is missing or not accessible: "+(W.message||W)))}}},p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(m){if(u=m._b64bit?"dbrx64_"+Ie.BarcodeReaderAddon.Version+".dll":"dbr_"+Ie.BarcodeReaderAddon.Version+".dll",p.product.bHTML5Edition)try{m._innerSend("GetAddOnVersion",p.html5.Funs.makeParams("barcodereader",u),!0,!1,!1).catch(function(){})}catch(b){}function v(b){return!p.License.checkProductKey(b,{Core:!0})||!!(Ie.navInfoSync.bMac||Ie.navInfoSync.bLinux||Ie.Lib.env.bMobile)&&(b._errorCode=Ie.DBR.EnumErrorCode.DBR_UNKNOWN,b._errorString=f.errors.ServiceEditionNotSupportDbr,!0)}var _={BarcodeReader:{decode:function(b){return v(m)?p.Promise.reject(f.BarcodeReaderException(m._errorCode,m._errorString)):!p.isNumber(b)||b<0||b>=m.HowManyImagesInBuffer?(p.Errors.IndexOutOfRange(m),p.Promise.reject(f.BarcodeReaderException(m._errorCode,m._errorString))):new p.Promise(function(S){f._decoding?f._decodeQueue.push({method:S,args:[b]}):(f._decoding=!0,S(b))}).then(function(S){var I;if(p.product.bHTML5Edition){if(-1==(I=m._ImgManager.convertClientIndexToServerId(S)))throw p.Errors.IndexOutOfRange(m),setTimeout(f._decodeNext,0),f.BarcodeReaderException(m._errorCode,m._errorString)}else I=S;return new p.Promise(function(k,O){f.dbrInitPromiseFun(m).then(function(j){var W;if(!p.product.bHTML5Edition)return J=m.GetImagePartURL(W=I,-1,-1),j._innerDecode(4001,J,"").then(function(K){K.imageid=m.IndexToImageID(W),setTimeout(f._decodeNext,0),k(K)},function(K){setTimeout(f._decodeNext,0),O(K)});W=m._ImgManager.convertServerIdToClientIndex(I);var J=m.GetImagePartURL(W,-1,-1);return j._innerDecode(4e3,J,"",m._clientId).then(function(K){K.imageid=m.IndexToImageID(W),setTimeout(f._decodeNext,0),k(K),m._blts&&Ie.DWT.lcvrf(m)},function(K){setTimeout(f._decodeNext,0),O(K)})},function(j){setTimeout(f._decodeNext,0),O(j)})})})},resetRuntimeSettings:function(){return v(m)?p.Promise.reject(f.BarcodeReaderException(m._errorCode,m._errorString)):f.dbrInitPromiseFun(m).then(function(b){return b.resetRuntimeSettings()})},getRuntimeSettings:function(b){return v(m)?p.Promise.reject(f.BarcodeReaderException(m._errorCode,m._errorString)):!p.isString(b)||"speed"!=b&&"balance"!=b&&"coverage"!=b&&"default"!=b?f.dbrInitPromiseFun(m).then(function(S){return S.getRuntimeSettings()}):this.updateRuntimeSettings(b)},updateRuntimeSettings:function(b){return v(m)?p.Promise.reject(f.BarcodeReaderException(m._errorCode,m._errorString)):f.dbrInitPromiseFun(m).then(function(S){return S.updateRuntimeSettings(b)})},initRuntimeSettingsWithString:function(b){return v(m)?p.Promise.reject(f.BarcodeReaderException(m._errorCode,m._errorString)):f.dbrInitPromiseFun(m).then(function(S){return S.initRuntimeSettingsWithString(b)})}}};p.product.bHTML5Edition?(m.__addon=m.__addon||{},p.mix(m.__addon,_)):(m.Addon=m.Addon||{},p.mix(m.Addon,_))})}),(Ie=self.Dynamsoft||{}).DWT=Ie.DWT||{},Ie.aryAddonReadyFun=Ie.aryAddonReadyFun||[],Ie.AddonReady=Ie.AddonReady||function(p){Ie.aryAddonReadyFun.push(p)},Ie.DWT.EnumDWT_ConvertMode={CM_RENDERALL:1,CM_IMAGEONLY:2,CM_AUTO:3,CM_RENDERALLWITHANNOTATION:4},Ie.DWT.EnumDWT_PDFCompressionType={PDF_AUTO:0,PDF_FAX3:1,PDF_FAX4:2,PDF_LZW:3,PDF_RLE:4,PDF_JPEG:5,PDF_JP2000:6,PDF_JBIG2:7},Ie.AddonReady(function(p,l){var u,f;p.product.bHTML5Edition&&(u={code:-2830,message:"The PDF resolution must be a positive number."},p.DynamicLoadAddonFuns)&&p.DynamicLoadAddonFuns.push(function(g){var m,v=p.html5.Funs;f=g.__serverPlatform==Ie.DWT.EnumDWT_PlatformType.enumMac?g._b64bit?"libDynamicPdfCorex64_"+Ie.DWT.PdfVersion+".dylib":"libDynamicPdfCore_"+Ie.DWT.PdfVersion+".dylib":g.__serverPlatform==Ie.DWT.EnumDWT_PlatformType.enumLinux||g.__serverPlatform==Ie.DWT.EnumDWT_PlatformType.enumEmbed||g.__serverPlatform==Ie.DWT.EnumDWT_PlatformType.enumChromeOS?"libDynamicPdfCore_"+Ie.DWT.PdfVersion+".so":g._b64bit?"DynamicPdfCorex64_"+Ie.DWT.PdfVersion+".dll":"DynamicPdfCore_"+Ie.DWT.PdfVersion+".dll";try{g._innerSend("GetAddOnVersion",v.makeParams("pdf",f),!0,!1,!1).catch(function(){})}catch(_){}m={PDF:{IsModuleInstalled:function(){var _=g;return _._resetErr(),""!=_._innerFun("GetAddOnVersion",v.makeParams("pdf",f))},IsModuleInstalledAsync:function(){var _=g;return _._resetErr(),_._innerFunV2("GetAddOnVersion",v.makeParams("pdf",f)).then(function(b){return""!=b})},ConvertToImage:function(k,b,S,I){k=v.replaceLocalFilename(k);var O="ConvertPDFToImage",j=g;return j._resetErr(),v.showMask(O),j._innerSend(O,v.makeParams(k,b),!0,function(W){return v.hideMask(O),S&&S(),!0},function(W){return v.hideMask(O),I&&I(),!1}),!0},SetPassword:function(_){var b=g,S=_||"";return b._resetErr(),!!b._checkPDFPasswordValue(S)&&(S=b._mixSavedPdfReaderOptions({password:S}),(S=b._setReaderOptions(S,!1))&&(b._pdfOptions.password=_),S)},SetConvertMode:function(_){return g._setConvertMode(_)},SetConvertModeAsync:function(_){return g._setConvertModeAsync(_)},GetConvertMode:function(){var _=g;return _._resetErr(),_._pdfConvertMode},SetResolution:function(_){var b=g,S=_;return b._resetErr(),S=b._mixSavedPdfReaderOptions({renderOptions:{resolution:S}}),(S=b._setReaderOptions(S,!1))&&(b._pdfOptions.renderOptions.resolution=_),S},SetResolutionAsync:function(_){var b=g;return b._resetErr(),!Ie.Lib.isNumber(_)||_<=0?Ie.Lib.Promise.reject(u):b._innerFunV2("SetPDFResolution",v.makeParams(_)).then(function(S){S&&(b._pdfOptions.renderOptions.resolution=_)})},SetReaderOptions:function(_){return g._setReaderOptions(_,!0)},GetReaderOptions:function(){var _,b=g;return b._resetErr(),_=g._innerFun("GetPDFReaderOptions"),_=Ie.Lib.parse(_),b._pdfOptions=b._mixSavedPdfReaderOptions(_),Ie.Lib.clone(b._pdfOptions)},IsTextBasedPDF:function(k,b,S){var I=g;return I._resetErr(),k=v.replaceLocalFilename(k),k=g._innerFun("IsTextBasedPDF",v.makeParams(k)),0==I.ErrorCode?p.isFunction(b)&&b(k):p.isFunction(S)&&S(I.ErrorCode,I.ErrorString),k},Write:{Setup:function(b){b=(b=b)||{version:15};var S=(2<p.stringify(b).length&&(p.isNumber(b.version)?1<=b.version&&b.version<2&&(b.version=parseInt(10*b.version)):b.version=15),p.isNumber(b.compression)&&b.compression==Ie.DWT.EnumDWT_PDFCompressionType.PDF_FAX3&&(b.compression=Ie.DWT.EnumDWT_PDFCompressionType.PDF_FAX4),g);return S._resetErr(),!(b.password&&(p.isNumber(b.password)&&(b.password=b.password.toString()),!S._checkPDFPasswordValue(b.password)))&&(b=p.stringify(b),b=p.replaceAll(b,'"','\\"'),S._innerFun("SetPDFSettings",['["',b,'"]'].join("")))}}}},g.__addon=g.__addon||{},p.mix(g.__addon,m)})}),Ie.AddonReady(function(p,l){p.product.bActiveXEdition&&p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(u){var f,g,m;if(!u.getSWebTwain()||!u.getSWebTwain().Addon)return!1;Ie.navInfoSync.bWin&&(m=!Ie.navInfo.bOSx64||Ie.navInfo.bWOW64?"DynamicPdfCore_"+Ie.DWT.PdfVersion+".dll":"DynamicPdfCorex64_"+Ie.DWT.PdfVersion+".dll"),g=u.getSWebTwain(),f={PDF:{IsModuleInstalled:function(){var v=g.GetAddOnVersion("pdf",m);return p.setErrorString(u),""!=v},IsModuleInstalledAsync:function(){var v=g.GetAddOnVersion("pdf",m);return p.setErrorString(u),p.Promise.resolve(""!=v)},ConvertToImage:function(v,_,b,S){return v=g.ConvertPDFToImage(v,_),p.wrapperRet(u,v,b,S)},SetPassword:function(v){return v=g.SetPDFPassword(v),p.wrapperRet(u,v)},SetConvertMode:function(v){return u._setConvertMode(v)},SetConvertModeAsync:function(v){return Promise.resolve(u._setConvertMode(v))},GetConvertMode:function(){return u._resetErr(),u._pdfConvertMode},SetResolution:function(v){return v=g.SetPDFResolution(v),p.wrapperRet(u,v)},SetResolutionAsync:function(v){return v=g.SetPDFResolution(v),p.Promise.resolve(p.wrapperRet(u,v))},SetReaderOptions:function(){return!1},GetReaderOptions:function(){return{}},IsTextBasedPDF:function(v){return v=g.IsTextBasedPDF(v),p.wrapperRet(u,v)}}},u.Addon=u.Addon||{},p.mix(u.Addon,f)})}),(Ie=self.Dynamsoft||{}).DWT=Ie.DWT||{},Ie.aryAddonReadyFun=Ie.aryAddonReadyFun||[],Ie.AddonReady=Ie.AddonReady||function(p){Ie.aryAddonReadyFun.push(p)},Ie.DWT.OCRVerInName="10.0.0.0618",function(){for(var p=[Ie.DWT],l=0;l<1;l++){var u=p[l];u.EnumDWT_OCRLanguage={OCRL_ENG:"eng",OCRL_ARA:"ara",OCRL_CHI_SIM:"chi_sim",OCRL_CHI_TRA:"chi_tra",OCRL_HIN:"hin",OCRL_URD:"urd",OCRL_SPA:"spa",OCRL_FRA:"fra",OCRL_MSA:"msa",OCRL_IND:"ind",OCRL_RUS:"rus",OCRL_BEN:"ben",OCRL_POR:"por",OCRL_PAN:"pan",OCRL_DEU:"deu",OCRL_JPN:"jpn",OCRL_FAS:"fas",OCRL_SWA:"swa",OCRL_JAV:"jav",OCRL_TEL:"tel",OCRL_TUR:"tur",OCRL_KOR:"kor",OCRL_MAR:"mar",OCRL_TAM:"tam",OCRL_VIE:"vie",OCRL_ITA:"ita",OCRL_THA:"tha"},u.EnumDWT_OCRPageSetMode={OCRPSM_OSD_ONLY:0,PSM_AUTO_OSD:1,PSM_AUTO_ONLY:2,PSM_AUTO:3,PSM_SINGLE_COLUMN:4,PSM_SINGLE_BLOCK_VERT_TEXT:5,PSM_SINGLE_BLOCK:6,PSM_SINGLE_LINE:7,PSM_SINGLE_WORD:8,PSM_CIRCLE_WORD:9,PSM_SINGLE_CHAR:10},u.EnumDWT_OCROutputFormat={OCROF_TEXT:0,OCROF_PDFPLAINTEXT:1,OCROF_PDFIMAGEOVERTEXT:2,OCROF_PDFPLAINTEXT_PDFX:3,OCROF_PDFIMAGEOVERTEXT_PDFX:4},u.EnumDWT_OCRDownloadType={OCRDT_Dll:0,OCRDT_LANGUAGE:1}}}(),Ie.DWT.OCRLanguageData_eng="4113088",Ie.DWT.OCRLanguageData_ara="1432056",Ie.DWT.OCRLanguageData_chi_sim="2469156",Ie.DWT.OCRLanguageData_chi_tra="2366642",Ie.DWT.OCRLanguageData_hin="1122751",Ie.DWT.OCRLanguageData_urd="1398718",Ie.DWT.OCRLanguageData_spa="2294433",Ie.DWT.OCRLanguageData_fra="1130365",Ie.DWT.OCRLanguageData_msa="1747801",Ie.DWT.OCRLanguageData_ind="1122661",Ie.DWT.OCRLanguageData_rus="3861738",Ie.DWT.OCRLanguageData_ben="855841",Ie.DWT.OCRLanguageData_por="1982756",Ie.DWT.OCRLanguageData_pan="497721",Ie.DWT.OCRLanguageData_deu="1525436",Ie.DWT.OCRLanguageData_jpn="2471260",Ie.DWT.OCRLanguageData_fas="431500",Ie.DWT.OCRLanguageData_swa="2167651",Ie.DWT.OCRLanguageData_jav="2982741",Ie.DWT.OCRLanguageData_tel="2769654",Ie.DWT.OCRLanguageData_tur="4550554",Ie.DWT.OCRLanguageData_kor="1677415",Ie.DWT.OCRLanguageData_mar="2118233",Ie.DWT.OCRLanguageData_tam="3237963",Ie.DWT.OCRLanguageData_vie="531275",Ie.DWT.OCRLanguageData_ita="2701314",Ie.DWT.OCRLanguageData_tha="1072600",Ie.DWT.OCRLanguageData={},Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_ENG]=Ie.DWT.OCRLanguageData_eng,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_ARA]=Ie.DWT.OCRLanguageData_ara,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_CHI_TRA]=Ie.DWT.OCRLanguageData_chi_tra,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_CHI_SIM]=Ie.DWT.OCRLanguageData_chi_sim,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_HIN]=Ie.DWT.OCRLanguageData_hin,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_URD]=Ie.DWT.OCRLanguageData_urd,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_SPA]=Ie.DWT.OCRLanguageData_spa,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_FRA]=Ie.DWT.OCRLanguageData_fra,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_MSA]=Ie.DWT.OCRLanguageData_msa,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_IND]=Ie.DWT.OCRLanguageData_ind,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_RUS]=Ie.DWT.OCRLanguageData_rus,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_BEN]=Ie.DWT.OCRLanguageData_ben,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_POR]=Ie.DWT.OCRLanguageData_por,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_PAN]=Ie.DWT.OCRLanguageData_pan,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_DEU]=Ie.DWT.OCRLanguageData_deu,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_JPN]=Ie.DWT.OCRLanguageData_jpn,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_FAS]=Ie.DWT.OCRLanguageData_fas,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_SWA]=Ie.DWT.OCRLanguageData_swa,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_JAV]=Ie.DWT.OCRLanguageData_jav,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_TEL]=Ie.DWT.OCRLanguageData_tel,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_TUR]=Ie.DWT.OCRLanguageData_tur,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_KOR]=Ie.DWT.OCRLanguageData_kor,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_MAR]=Ie.DWT.OCRLanguageData_mar,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_TAM]=Ie.DWT.OCRLanguageData_tam,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_VIE]=Ie.DWT.OCRLanguageData_vie,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_ITA]=Ie.DWT.OCRLanguageData_ita,Ie.DWT.OCRLanguageData[Ie.DWT.EnumDWT_OCRLanguage.OCRL_THA]=Ie.DWT.OCRLanguageData_tha,function(p){function l(){var u=this;u._text="",u._fontName="",u._fontSize="",u._left=0,u._top=0,u._right=0,u._bottom=0}l.prototype.GetText=function(){return this._text},l.prototype.GetFontName=function(){return this._fontName},l.prototype.GetFontSize=function(){return this._fontSize},l.prototype.GetWordRect=function(){var u=this;return u._left+","+u._top+","+u._right+","+u._bottom},p.NewWordBasicResult=function(){return new l}}(Ie.Lib),function(p){function l(){var u=this;u._count=0,u._left=0,u._top=0,u._right=0,u._bottom=0,u._wordlist=[]}l.prototype.GetWordCount=function(){return this._count},l.prototype.GetLineRect=function(){var u=this;return u._left+","+u._top+","+u._right+","+u._bottom},l.prototype.GetWordContent=function(u){var f=this,g=f._wordlist.length;return f._errorCode<0?"":null==u||g<=u||u<0?(Ie.Lib.Errors.OCR_InvalidIndex(f,"GetWordContent"),""):((g=Ie.Lib.NewWordBasicResult())._text=f._wordlist[u].text,g._fontName=f._wordlist[u].fontname,g._fontSize=f._wordlist[u].fontsize,g._left=f._wordlist[u].rect[0],g._top=f._wordlist[u].rect[1],g._right=f._wordlist[u].rect[2],g._bottom=f._wordlist[u].rect[3],g)},p.NewLineBasicResult=function(){return new l}}(Ie.Lib),function(p){function l(){this._count=0,this._linelist=[]}l.prototype.GetLineCount=function(){return this._count},l.prototype.GetLineContent=function(u){var f=this,g=f._linelist.length;return f._errorCode<0?"":null==u||g<=u||u<0?(Ie.Lib.Errors.OCR_InvalidIndex(f,"GetLineContent"),""):((g=Ie.Lib.NewLineBasicResult())._count=f._linelist[u].words.length,g._left=f._linelist[u].rect[0],g._top=f._linelist[u].rect[1],g._right=f._linelist[u].rect[2],g._bottom=f._linelist[u].rect[3],g._wordlist=f._linelist[u].words,g)},p.NewPageBasicResult=function(){return new l}}(Ie.Lib),function(p){function l(){this._count=0,this._pagelist=[]}l.prototype.GetPageCount=function(){return this._count},l.prototype.GetPageContent=function(u){var f=this,g=f._pagelist.length;return f._errorCode<0?"":null==u||g<=u||u<0?(Ie.Lib.Errors.OCR_InvalidIndex(f,"GetPageContent"),""):((g=Ie.Lib.NewPageBasicResult())._count=f._pagelist[u].lines.length,g._linelist=f._pagelist[u].lines,g)},p.NewPageSetBasicResult=function(){return new l}}(Ie.Lib),function(p){function l(u){var f=this;f._errorCode=0,f._errorString="",f._resultlist=[],f._stwain=u}l.prototype.GetErrorCode=function(){return this._errorCode},l.prototype.GetErrorString=function(){return this._errorString},l.prototype.GetFormat=function(){return this._resultlist[0].format},l.prototype.GetInput=function(){var u=this._resultlist[0].input;if(u){var f=Number(u);if(!isNaN(f))return this._stwain._ImgManager.convertServerIdToClientIndex(f)}return u},l.prototype.GetPageSetCount=function(){return this._resultlist[0].pagesets.length},l.prototype.GetPageSetContent=function(u){var f=this,g=f._resultlist[0].pagesets.length;return f._errorCode<0?"":null==u||g<=u||u<0?(Ie.Lib.Errors.OCR_InvalidIndex(f,"GetPageSetContent"),""):((g=Ie.Lib.NewPageSetBasicResult())._count=f._resultlist[0].pagesets[u].pages.length,g._pagelist=f._resultlist[0].pagesets[u].pages,g)},l.prototype.Get=function(){return this._stwain._innerFun("GetOCRRestult")},l.prototype.Save=function(u){return u=p.html5.Funs.replaceLocalFilename(u),this._stwain._innerFun("SaveOCRRestult",p.html5.Funs.makeParams(u))},p.NewOCRBasicResult=function(u){return new l(u)}}(Ie.Lib),function(p){function l(){var u=this;u.UnicodeFontName="",u.UseDetectedFont=!0,u.MinFontSizeforMoreAccurateResult=0,u.OCRLanguage=Ie.DWT.EnumDWT_OCRLanguage.OCRL_ENG,u.PageSetMode=Ie.DWT.EnumDWT_OCRPageSetMode.PSM_AUTO,u.OutputFormat=Ie.DWT.EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT}l.prototype.GetUnicodeFontName=function(){return this.UnicodeFontName},l.prototype.SetUnicodeFontName=function(u){return p.isString(u)||(u=""),this.UnicodeFontName=u,!0},l.prototype.GetUseDetectedFont=function(){return!!this.UseDetectedFont},l.prototype.SetUseDetectedFont=function(u){return this.UseDetectedFont=!!u,!0},l.prototype.GetMinFontSizeforMoreAccurateResult=function(){return this.MinFontSizeforMoreAccurateResult},l.prototype.SetMinFontSizeforMoreAccurateResult=function(u){return this.MinFontSizeforMoreAccurateResult=u=(u=+u)<0?0:u,!0},l.prototype.GetOCRLanguage=function(){return this.OCRLanguage},l.prototype.SetOCRLanguage=function(u){return p.isString(u)||(u=""),this.OCRLanguage=u,!0},l.prototype.GetPageSetMode=function(){return this.PageSetMode},l.prototype.SetPageSetMode=function(u){return((u=+u)<0||u>Ie.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_CHAR)&&(u=Ie.DWT.EnumDWT_OCRPageSetMode.PSM_AUTO),this.PageSetMode=u,!0},l.prototype.GetOutputFormat=function(){return this.OutputFormat},l.prototype.SetOutputFormat=function(u){return((u=+u)<0||u>Ie.DWT.EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT_PDFX)&&(u=Ie.DWT.EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT),this.OutputFormat=u,!0},p.NewOptions=function(){return new l}}(Ie.Lib),Ie.AddonReady(function(p,l){var u;p.product.bHTML5Edition&&p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(f){var g,m,v,_=p.html5.Funs,b=p.NewOptions();v=p.html5.Funs,u=p.env.bMac?"DynamicOCR_"+Ie.DWT.OCRVerInName+".dylib":p.env.bLinux?"DynamicOCR_"+Ie.DWT.OCRVerInName+".so":Ie.dcp.b64bit?"DynamicOCRx64_"+Ie.DWT.OCRVerInName+".dll":"DynamicOCR_"+Ie.DWT.OCRVerInName+".dll",(m=f)._isMobileMode()||m._innerSend("GetAddOnVersion",v.makeParams("ocr",u),!0,!1,!1),m.__innerOCRBasicReadFunction=function(S,I,k,O,j,W,J,K,Q,ie,oe){return p.isFunction(ie)?this.__innerOCRBasicAsyncReadFunction(S,I,k,O,j,W,J,K,Q,ie,oe):this.__innerOCRSyncReadFunction(S,Q)},m.__innerGetOCRBasicResultAsyncFunction=function(S){var I=Ie.Lib.NewOCRBasicResult(this);return S&&(I._errorCode=S.exception,I._errorString=S.description,I._resultlist=S.result),I},m.__innerOCRBasicAsyncReadFunction=function(S,I,k,O,j,W,J,K,Q,ie,oe){var le=this;return v.showMask(S),le._innerSend(S,Q,!0,function(he){var _e;0==he.exception?(p.isFunction(ie)&&(-1!=I?(_e=le._convertServerIdToGuid(I),1==O?ie(_e,j,W,J,K,le.__innerGetOCRBasicResultAsyncFunction(he)):ie(_e,le.__innerGetOCRBasicResultAsyncFunction(he))):""!=k?ie(k,le.__innerGetOCRBasicResultAsyncFunction(he)):ie(le.__innerGetOCRBasicResultAsyncFunction(he))),p.License.isLTS()&&Ie.DWT.lcvrf(m)):p.isFunction(oe)&&oe(he.exception,he.description),v.hideMask(S)},function(he){v.hideMask(S)}),!0},m.__innerOCRSyncReadFunction=function(S,I){return S=this._innerFunRaw(S,I,!1,!1),(I=p.NewOCRBasicResult())._errorCode=this._errorCode,I._errorString=this._errorString,S&&p.isArray(S)&&(I._resultlist=S,I._Count=S.length,p.License.isLTS())&&Ie.DWT.lcvrf(m),I},m.__IsOCRBasicModuleInstalled=function(){return""!=m._innerFun("GetAddOnVersion",v.makeParams("ocr",u)).split("|")[0]},m.__innerBasicDownload=function(S,I,k,O,j){function W(){return K.IfShowProgressBar&&p.closeProgress(null,"Download"),p.isFunction(O)&&O(),!0}function J(){return K.IfShowProgressBar&&p.closeProgress(null,"Download"),p.isFunction(j)&&j(K.ErrorCode,K.ErrorString),!1}var K=m;if(p.cancelFrome=2,S=S.toString(),!p.License.checkProductKey(K,{Core:!0})||!p.License.checkProductKey(K,{OCR:!0},!0))return J();I!=Ie.DWT.EnumDWT_OCRDownloadType.OCRDT_Dll&&K._innerFun("SetOCRLanguage",v.makeParams(k));var Q=K._innerFun("GetAddOnVersion",v.makeParams("ocr",u)).split("|");if(I==Ie.DWT.EnumDWT_OCRDownloadType.OCRDT_Dll){if(""!=Q[0])return W(),!0}else if((k=Ie.DWT.OCRLanguageData[k])&&Q[1]==k)return W(),!0;if(!S||""==S)return p.Errors.OCR_InvalidRemoteFilename(K),J(),!1;if(v.isServerInvalid(K))return J(),!1;K.IfShowProgressBar&&p.showProgress(K,"Download",!0);var ie=!0;K._OnPercentDone(I==Ie.DWT.EnumDWT_OCRDownloadType.OCRDT_Dll?[0,-1,"Downloading OCR Module...","http"]:[0,-1,"Downloading OCR Language Data...","http"]),p.isFunction(O)||(ie=!1),v.loadHttpBlob(K,"get",S,ie,function(oe){K._OnPercentDone([0,-1,"Loading..."]);var le=100;I==Ie.DWT.EnumDWT_OCRDownloadType.OCRDT_LANGUAGE&&(le=101),K.__LoadImageFromBytes(oe,le,"",ie,W,J)},function(){K.IfShowProgressBar&&p.closeProgress(null,"Download"),J()},function(oe){var le=0===oe.total?100:Math.round(100*oe.loaded/oe.total);[oe.loaded," / ",oe.total].join(""),K._OnPercentDone([0,le,"","http"])})},g={OCR:{SetUnicodeFontName:function(S){var I=f;return I._resetErr(),I._isMobileMode()?I._mobileNotSupport("Addon.OCR.SetUnicodeFontName"):b.SetUnicodeFontName(S)},GetUnicodeFontName:function(){var S=f;return S._resetErr(),S._isMobileMode()?S._mobileNotSupport("Addon.OCR.GetUnicodeFontName"):b.GetUnicodeFontName()},SetIfUseDetectedFont:function(S){var I=f;return I._resetErr(),I._isMobileMode()?I._mobileNotSupport("Addon.OCR.SetIfUseDetectedFont"):b.SetUseDetectedFont(S)},GetIfUseDetectedFont:function(){var S=f;return S._resetErr(),S._isMobileMode()?S._mobileNotSupport("Addon.OCR.GetIfUseDetectedFont"):b.GetUseDetectedFont()},SetMinFontSizeforMoreAccurateResult:function(S){var I=f;return I._resetErr(),I._isMobileMode()?I._mobileNotSupport("Addon.OCR.SetMinFontSizeforMoreAccurateResult"):b.SetMinFontSizeforMoreAccurateResult(S)},GetMinFontSizeforMoreAccurateResult:function(){var S=f;return S._resetErr(),S._isMobileMode()?S._mobileNotSupport("Addon.OCR.GetMinFontSizeforMoreAccurateResult"):b.GetMinFontSizeforMoreAccurateResult()},SetLanguage:function(S){var I=f;return I._resetErr(),I._isMobileMode()?I._mobileNotSupport("Addon.OCR.SetLanguage"):b.SetOCRLanguage(S)},IsModuleInstalled:function(){var S=f;return S._resetErr(),S._isMobileMode()?S._mobileNotSupport("Addon.OCR.IsModuleInstalled"):S.__IsOCRBasicModuleInstalled()},SetPageSetMode:function(S){var I=f;return I._resetErr(),I._isMobileMode()?I._mobileNotSupport("Addon.OCR.SetPageSetMode"):(S=+S)==Ie.DWT.EnumDWT_OCRPageSetMode.OCRPSM_OSD_ONLY||S==Ie.DWT.EnumDWT_OCRPageSetMode.PSM_AUTO_OSD||S==Ie.DWT.EnumDWT_OCRPageSetMode.PSM_AUTO_ONLY||S==Ie.DWT.EnumDWT_OCRPageSetMode.PSM_AUTO||S==Ie.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_COLUMN||S==Ie.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_BLOCK_VERT_TEXT||S==Ie.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_BLOCK||S==Ie.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_LINE||S==Ie.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_WORD||S==Ie.DWT.EnumDWT_OCRPageSetMode.PSM_CIRCLE_WORD||S==Ie.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_CHAR?b.SetPageSetMode(S):(Ie.Lib.Errors.OCR_InvalidPageSetMode(I),!1)},SetOutputFormat:function(S){var I=f;return I._resetErr(),I._isMobileMode()?I._mobileNotSupport("Addon.OCR.SetOutputFormat"):(S=+S)==Ie.DWT.EnumDWT_OCROutputFormat.OCROF_TEXT||S==Ie.DWT.EnumDWT_OCROutputFormat.OCROF_PDFPLAINTEXT||S==Ie.DWT.EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT||S==Ie.DWT.EnumDWT_OCROutputFormat.OCROF_PDFPLAINTEXT_PDFX||S==Ie.DWT.EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT_PDFX?b.SetOutputFormat(S):(Ie.Lib.Errors.OCR_InvalidOutputFormat(I),!1)},Recognize:function(S,I,k){var O=f;return O._resetErr(),O._isMobileMode()?O._mobileNotSupport("Addon.OCR.Recognize"):p.License.checkProductKey(O,{OCR:!0},!0)?(S=O._ImgManager.convertClientIndexToServerId(S),O.__innerOCRBasicReadFunction("OCRRecognize",S,"",0,0,0,0,0,_.makeParams(0,S,"",0,0,0,0,b.GetUnicodeFontName(),b.GetUseDetectedFont(),b.GetMinFontSizeforMoreAccurateResult(),b.GetOCRLanguage(),b.GetPageSetMode(),b.GetOutputFormat(),""),I,k)):(p.isFunction(k)&&k(O._errorCode,O._errorString),!1)},RecognizeRect:function(S,I,k,O,j,W,J){var K,Q=f;return Q._resetErr(),Q._isMobileMode()?Q._mobileNotSupport("Addon.OCR.RecognizeRect"):!I&&0!=I||!k&&0!=k||!O&&0!=O||!j&&0!=j?(K=Ie.Lib.NewOCRBasicResult(Q),Ie.Lib.Errors.OCR_InvalidLeftOrTopOrRightOrBottom(K,"RecognizeRect"),void J(K.GetErrorCode(),K.GetErrorString())):p.License.checkProductKey(Q,{OCR:!0},!0)?(K=Q._ImgManager.convertClientIndexToServerId(S),Q.__innerOCRBasicReadFunction("OCRRecognize",K,"",1,I,k,O,j,_.makeParams(0,K,"",I,k,O,j,b.GetUnicodeFontName(),b.GetUseDetectedFont(),b.GetMinFontSizeforMoreAccurateResult(),b.GetOCRLanguage(),b.GetPageSetMode(),b.GetOutputFormat(),""),W,J)):(p.isFunction(J)&&J(Q._errorCode,Q._errorString),!1)},RecognizeFile:function(S,I,k){var O=f;return O._resetErr(),O._isMobileMode()?O._mobileNotSupport("Addon.OCR.RecognizeFile"):(S=_.replaceLocalFilename(S),p.License.checkProductKey(O,{OCR:!0},!0)?O.__innerOCRBasicReadFunction("OCRRecognize",-1,S,0,0,0,0,0,_.makeParams(1,-1,S,0,0,0,0,b.GetUnicodeFontName(),b.GetUseDetectedFont(),b.GetMinFontSizeforMoreAccurateResult(),b.GetOCRLanguage(),b.GetPageSetMode(),b.GetOutputFormat(),""),I,k):(p.isFunction(k)&&k(O._errorCode,O._errorString),!1))},RecognizeSelectedImages:function(S,I){var k,O,j,W=f;return W._resetErr(),W._isMobileMode()?W._mobileNotSupport("Addon.OCR.RecognizeSelectedImages"):p.License.checkProductKey(W,{OCR:!0},!0)?(j=[],(k=W)._ImgManager.count()<=0||(O=k._ImgManager.getCurrentImageIndex(),k._ImgManager.convertClientIndexToServerId(O),O=k._ImgManager.getSelectedClientIndexArray(),p.isArray(O)&&p.each(O,function(J){J=k._ImgManager.convertClientIndexToServerId(J),j.push(J)})),O=j,W.__innerOCRBasicReadFunction("OCRRecognize",-1,"",0,0,0,0,0,_.makeParams(2,-1,"",0,0,0,0,b.GetUnicodeFontName(),b.GetUseDetectedFont(),b.GetMinFontSizeforMoreAccurateResult(),b.GetOCRLanguage(),b.GetPageSetMode(),b.GetOutputFormat(),O.join(",")),S,I)):(p.isFunction(I)&&I(W._errorCode,W._errorString),!1)},Download:function(S,I,k){var O=f;return O._resetErr(),O._isMobileMode()?O._mobileNotSupport("Addon.OCR.Download"):O.__innerBasicDownload(S,Ie.DWT.EnumDWT_OCRDownloadType.OCRDT_Dll,b.GetOCRLanguage(),I,k)},DownloadLangData:function(S,I,k){var O=f;return O._resetErr(),O._isMobileMode()?O._mobileNotSupport("Addon.OCR.DownloadLangData"):O.__innerBasicDownload(S,Ie.DWT.EnumDWT_OCRDownloadType.OCRDT_LANGUAGE,b.GetOCRLanguage(),I,k)}}},f.__addon=f.__addon||{},p.mix(f.__addon,g)})}),(Ie=self.Dynamsoft||{}).DWT=Ie.DWT||{},Ie.aryAddonReadyFun=Ie.aryAddonReadyFun||[],Ie.AddonReady=Ie.AddonReady||function(p){Ie.aryAddonReadyFun.push(p)},Ie.ProOCRVerInName="1.2.0.0806",function(p){function l(){var u=this;u._text="",u._left=0,u._top=0,u._right=0,u._bottom=0}l.prototype.GetText=function(){return this._text},l.prototype.GetLetterRect=function(){var u=this;return u._left+","+u._top+","+u._right+","+u._bottom},p.NewLetterResult=function(){return new l}}(Ie.Lib),function(p){function l(){var u=this;u._count=0,u._letterlist=[],u._zoneCount=0,u._zoneWords=[]}l.prototype.GetLettersCount=function(){return this._count},l.prototype.GetZoneCount=function(){return this._zoneCount},l.prototype.GetLetterContent=function(u){var f=this;if(f._errorCode<0)return"";if(null==u||u>=f._count||u<0)return Ie.Lib.Errors.OCR_InvalidIndex(f,"GetLetterContent"),"";var m=Ie.Lib.NewLetterResult();return m._text=f._letterlist[u].letter,m._left=f._letterlist[u].boundary[0],m._top=f._letterlist[u].boundary[1],m._right=f._letterlist[u].boundary[2],m._bottom=f._letterlist[u].boundary[3],m},l.prototype.GetZoneContent=function(u){var f=this;return f._errorCode<0?"":null==u||u>=f._zoneCount||u<0?(Ie.Lib.Errors.OCR_InvalidIndex(f,"GetZoneContent"),""):f._zoneWords[u]},p.NewPageResult=function(){return new l}}(Ie.Lib),function(p){function l(){var u=this;u._input=0,u._message="",u._page=-1}l.prototype.GetInput=function(){return this._input},l.prototype.GetMessage=function(){return this._message},l.prototype.GetPage=function(){return this._page},p.NewErrorInfo=function(){return new l}}(Ie.Lib),function(p){function l(u){var f=this;f._errorCode=0,f._errorString="",f._errorlist=[],f._request="",f._ocrTotalCount=0,f._alreadyOCRCount=0,f._resultlist=[],f._resultZoneDetail=[],f._stwain=u}l.prototype.GetErrorCode=function(){return this._errorCode},l.prototype.GetErrorString=function(){return this._errorString},l.prototype.GetInput=function(){var u=this;if(u._request&&u._request.input){var f=u._request.input;if(f){var g=Number(f);if(!isNaN(g))return u._stwain._ImgManager.convertServerIdToClientIndex(g)}return f}return""},l.prototype.GetErrorDetailList=function(){var u=this,f=0;u._errorlist&&(f=u._errorlist.length);for(var g=[],m=0;m<f;m++){var v=Ie.Lib.NewErrorInfo();v._input=u._errorlist[m].input,v._message=u._errorlist[m].message,v._page=u._errorlist[m].page,g.push(v)}return g},l.prototype.GetOCRTotalCount=function(){return this._ocrTotalCount?this._ocrTotalCount:0},l.prototype.GetAlreadyOCRCount=function(){return this._alreadyOCRCount?this._alreadyOCRCount:0},l.prototype.GetPageCount=function(){var u=this;return u._resultlist&&u._resultlist.length?u._resultlist.length:0},l.prototype.GetPageContent=function(u){var f=this,g=0;if(f._resultlist&&(g=f._resultlist.length),null==u||u>=g||u<0)return Ie.Lib.Errors.OCR_InvalidIndex(f,"GetPageContent"),"";var m=Ie.Lib.NewPageResult();return f._resultlist?(m._count=f._resultlist[u].length,m._letterlist=f._resultlist[u]):m._count=0,f._resultZoneDetail?(m._zoneCount=f._resultZoneDetail[u].length,m._zoneWords=f._resultZoneDetail[u]):m._zoneCount=0,m},l.prototype.Get=function(){return this._stwain._innerFun("GetOCRRestult")},l.prototype.Save=function(u){var g=p.html5.Funs.replaceLocalFilename(u);return this._stwain._innerFun("SaveOCRRestult",p.html5.Funs.makeParams(g))},p.NewOCRProResult=function(u){return new l(u)}}(Ie.Lib),function(p){for(var l=[Ie.DWT],u=0;u<1;u++){var f=l[u];f.EnumDWT_OCRProRecognitionModule={OCRPM_AUTO:"AUTO",OCRPM_MOSTACCURATE:"MOSTACCURATE",OCRPM_BALANCED:"BALANCED",OCRPM_FASTEST:"FASTEST"},f.EnumDWT_OCRProOutputFormat={OCRPFT_TXTS:"TXTS",OCRPFT_TXTCSV:"TXTCSV",OCRPFT_TXTF:"TXTF",OCRPFT_XML:"XML",OCRPFT_IOTPDF:"IOTPDF",OCRPFT_IOTPDF_MRC:"IOTPDF_MRC"},f.EnumDWT_OCRProPDFVersion={OCRPPDFV_0:"1.0",OCRPPDFV_1:"1.1",OCRPPDFV_2:"1.2",OCRPPDFV_3:"1.3",OCRPPDFV_4:"1.4",OCRPPDFV_5:"1.5",OCRPPDFV_6:"1.6",OCRPPDFV_7:"1.7"},f.EnumDWT_OCRProPDFAVersion={OCRPPDFAV_1A:"pdf/a-1a",OCRPPDFAV_1B:"pdf/a-1b",OCRPPDFAV_2A:"pdf/a-2a",OCRPPDFAV_2B:"pdf/a-2b",OCRPPDFAV_2U:"pdf/a-2u",OCRPPDFAV_3A:"pdf/a-3a",OCRPPDFAV_3B:"pdf/a-3b",OCRPPDFAV_3U:"pdf/a-3u"},f.EnumDWT_OCRProType={OCRDT_File:0,OCRDT_Index:1},f.EnumDWT_OCRFindTextFlags={OCRFT_WHOLEWORD:1,OCRFT_MATCHCASE:2,OCRFT_FUZZYMATCH:4},f.EnumDWT_OCRFindTextAction={OCRFT_HIGHLIGHT:0,OCRFT_STRIKEOUT:1,OCRFT_MARKFORREDACT:2}}}("undefined"!=typeof window&&window),function(p){function l(){var u=this;u.FindText="",u.FindTextFlags=Ie.DWT.EnumDWT_OCRFindTextFlags.OCRFT_WHOLEWORD,u.FindTextAction=Ie.DWT.EnumDWT_OCRFindTextAction.OCRFT_MARKFORREDACT}p.NewRedaction=function(){return new l}}(Ie.Lib),Ie.WebTwain={Addon:{OCRPro:{}}},function(p){function l(){var u=this;u.RecognitionModule="",u.Languages="eng",u.OutputFormat="",u.PDFVersion="",u.PDFAVersion="",u.LicenseChecker="",u.Redaction=Ie.Lib.NewRedaction()}p.NewSettings=function(){return new l}}(Ie.WebTwain.Addon.OCRPro),function(){function p(l,u,f,g){var m=this;m.left=l,m.top=u,m.right=f,m.bottom=g}Ie.WebTwain.Addon.OCRPro.NewOCRZone=function(l,u,f,g){return new p(l,u,f,g)}}(),Ie.AddonReady(function(p,l){if(p.product.bHTML5Edition){var v=function(ee,ke,xe,Le){var V=p.NewOCRProResult(ee);V._errorCode=ke,V._errorString=xe;var F=p.NewErrorInfo();return F.input=Le,F.message=V._errorString,F.page=0,V._errorlist=[F],V};p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(ee){var xe,Le,ke=p.html5.Funs;Le=p.env.bMac?"DynamicOCRPro_"+Ie.ProOCRVerInName+".dylib":p.env.bLinux?"DynamicOCRPro_"+Ie.ProOCRVerInName+".so":Ie.dcp.b64bit?"DynamicOCRProx64_"+Ie.ProOCRVerInName+".dll":"DynamicOCRPro_"+Ie.ProOCRVerInName+".dll",function g(ee){var ke=p.html5.Funs;ee.__innerGetOCRProResultAsyncFunction=function(xe){var Le=Ie.Lib.NewOCRProResult(this);return xe&&(Le._errorCode=xe.code,Le._errorString=xe.message,Le._request=xe.request,Le._errorlist=xe.errorList,Le._ocrTotalCount=xe.ocrTotalCount,Le._alreadyOCRCount=xe.alreadyOCRCount,Le._resultlist=xe.resultDetail,Le._resultZoneDetail=xe.resultZoneDetail),Le},ee.__innerIsOCRTrial=function(xe,Le){var V=this,F=function(){var z=!1;if(V.__licenseInfo.Detail)for(var $=0;$<V.__licenseInfo.Detail.length;$++)"10"==V.__licenseInfo.Detail[$].EnumLicenseType&&"TRUE"==V.__licenseInfo.Detail[$].Trial&&(z=!0);return xe(z)};return V.__licenseInfo&&V.__licenseInfo.Detail?F():V.GetLicenseInfo(F,Le)},ee.__innerOCRReadFunction=function(xe,Le,V,F,z,$,P,L){return this.__innerOCRAsyncReadFunction(xe,Le,V,F,z,$,P,L)},ee.__innerOCRAsyncReadFunction=function(xe,Le,V,F,z,$,P,L){var X=this;return ke.showMask(xe),X._innerSend(xe,$,!0,function(te){0==te.code?(p.isFunction(P)&&(-1!=Le?1==F?P(Le,z,X.__innerGetOCRProResultAsyncFunction(te)):P(Le,X.__innerGetOCRProResultAsyncFunction(te)):""!=V?P(V,X.__innerGetOCRProResultAsyncFunction(te)):P(X.__innerGetOCRProResultAsyncFunction(te))),p.License.isLTS()&&Ie.DWT.lcvrf(ee)):p.isFunction(L)&&L(te.code,te.message,X.__innerGetOCRProResultAsyncFunction(te)),ke.hideMask(xe)},function(te){ke.hideMask(xe)}),!0},ee.__innerGetRequestJson=function(xe,Le,V,F,z){var P,L="[{";for(L+='"id":"'+ee.clientId+'",',L+='"method":"OCRProRecognize",',L+='"dllName":"'+z+'",',L+='"productkey":"'+Ie.DWT.ProductKey+'",',L+=xe==Ie.DWT.EnumDWT_OCRProType.OCRDT_File?'"inputType":"file",':'"inputType":"index",',L+='"input":[',P=0;P<Le.length;P++)L+=xe==Ie.DWT.EnumDWT_OCRProType.OCRDT_File?'"'+Le[P]+'"':Le[P],P+1<Le.length&&(L+="|");if(L+="],",L+='"settings":{',L+='"recognitionMethod": "Page"',V&&(V.RecognitionModule&&V.RecognitionModule.length>0&&(L+=',"recognitionModule":"'+V.RecognitionModule+'"'),V.Languages&&V.Languages.length>0&&(L+=',"languages":"'+V.Languages+'"'),V.OutputFormat&&V.OutputFormat.length>0&&(L+=',"outputFormat":"'+V.OutputFormat+'"'),V.PDFVersion&&V.PDFVersion.length>0&&(L+=',"pdfVersion":"'+V.PDFVersion+'"'),V.PDFAVersion&&V.PDFAVersion.length>0&&(L+=',"pdfAVersion":"'+V.PDFAVersion+'"'),V.Redaction&&V.Redaction.FindText&&V.Redaction.FindText.length>0)){var X=parseInt(V.Redaction.FindTextFlags),ne=parseInt(V.Redaction.FindTextAction);if(!isNaN(X)&&!isNaN(ne)){L+=',"redaction":{';var Z=V.Redaction.FindText;L+='"findText":"'+(Z=Z.replace(/\"/g,'\\"'))+'"',L+=',"findTextFlags":'+X,L+=',"findTextAction":'+ne,L+="}"}}for(L+="},",L+='"zones":[',P=0;P<F.length;P++)L+="["+F[P].left+","+F[P].top+","+F[P].right+","+F[P].bottom+"]",P+1<F.length&&(L+=",");return L+="],",(L+='"outputFile":""')+"}]"},ee.__LoadImageFromBytesForDownloadInner=function(xe,Le,V,F,z,$,P,L,X){var Z,ae,ne=ee;ae=xe>=F?Le.slice(Z=$*F,z):Le.slice(Z=xe*$,(xe+1)*$),ne.__LoadImageFromBytes(ae,V,"",P,function(){xe>=F?Ie.Lib.isFunction(L)&&L():ne.__LoadImageFromBytesForDownloadInner(xe+=1,Le,V,F,z,$,P,L,X)},function(){Ie.Lib.isFunction(X)&&X()},Z,z)},ee.__LoadImageFromBytesForDownload=function(xe,Le,V,F,z,$){var P=ee,L=2e6,X=xe.size||xe.length,ne=parseInt(X/L);0==X%L&&(ne-=1),P.__LoadImageFromBytesForDownloadInner(0,xe,Le,ne,X,L,F,z,$)}}(ee),xe={OCRPro:{Settings:!1,Recognize:function(V,F,z){var P,L,$=[],Z=ee;if(Z._resetErr(),Z._isMobileMode())return Z._mobileNotSupport("Addon.OCRPro.Recognize");if(P=parseInt(V),p.isNaN(P)||!p.isNumber(P))return L=v(ee,-2201,"Invalid parameter type.",V),p.isFunction(z)?z(L._errorCode,L._errorString,L):p.Errors.WebviewerError(ee,L._errorString,L._errorCode),!1;var te=ee._ImgManager.convertClientIndexToServerId(P);if(-1==te)return p.isFunction(z)&&(p.Errors.IndexOutOfRange(ee),L=v(ee,ee._errorCode,ee._errorString,V),z(L._errorCode,L._errorString,L)),!1;if(!p.License.checkProductKey(ee,{OCRPro:!0},!0))return p.isFunction(z)&&(L=v(ee,ee._errorCode,ee._errorString,V),z(L._errorCode,L._errorString,L)),!1;$.push(te);var ae=[],fe=this.Settings,be=ee.__innerGetRequestJson(Ie.DWT.EnumDWT_OCRProType.OCRDT_Index,$,fe,ae,Le);return ee.__innerIsOCRTrial(function(Pe){return Pe||p.License.isLTS()?ee.__innerOCRReadFunction("OCRProRecognize",V,"",0,ae,be,F,z):I(fe.LicenseChecker,ee,"OCRProRecognize",V,"",0,ae,be,F,z)},z)},RecognizeRect:function(V,F,z,$){var L,X,P=[],te=ee;if(te._resetErr(),te._isMobileMode())return te._mobileNotSupport("Addon.OCRPro.RecognizeRect");if(L=parseInt(V),p.isNaN(L)||!p.isNumber(L))return X=v(ee,-2201,"Invalid parameter type.",V),p.isFunction($)?$(X._errorCode,X._errorString,X):p.Errors.WebviewerError(ee,X._errorString,X._errorCode),!1;var ae=ee._ImgManager.convertClientIndexToServerId(L),fe=ee._ImgManager.GetImageWidth(L),be=ee.GetImageHeight(L);if(-1==ae)return p.isFunction($)&&(p.Errors.IndexOutOfRange(ee),X=v(ee,ee._errorCode,ee._errorString,V),$(X._errorCode,X._errorString,X)),!1;if(!p.License.checkProductKey(ee,{OCRPro:!0},!0))return p.isFunction($)&&(X=v(ee,ee._errorCode,ee._errorString,V),$(X._errorCode,X._errorString,X)),!1;if(fe>0&&be>0)for(var Pe,De,Xe,Re,Ae,de,tt=0;tt<F.length;tt++)(De=(Pe=F[tt]).left)<0&&(De=0),(Xe=Pe.top)<0&&(Xe=0),(Re=Pe.right)<0&&(Re=0),(Ae=Pe.bottom)<0&&(Ae=0),De>Re&&(de=De,De=Re,Re=de),Xe>Ae&&(de=Xe,Xe=Ae,Ae=de),Re>fe&&(Re=fe),Ae>be&&(Ae=be),Pe.left=De,Pe.top=Xe,Pe.right=Re,Pe.bottom=Ae;P.push(ae);var Ze=this.Settings,et=ee.__innerGetRequestJson(Ie.DWT.EnumDWT_OCRProType.OCRDT_Index,P,Ze,F,Le);return ee.__innerIsOCRTrial(function(Qe){return Qe||p.License.isLTS()?ee.__innerOCRReadFunction("OCRProRecognize",V,"",1,F,et,z,$):I(Ze.LicenseChecker,ee,"OCRProRecognize",V,"",1,F,et,z,$)},$)},RecognizeFile:function(V,F,z){var P,L,X,$=ee;if($._resetErr(),$._isMobileMode())return $._mobileNotSupport("Addon.OCRPro.RecognizeFile");if(0==V.length)return p.isFunction(z)&&((P=Ie.Lib.NewOCRProResult(ee))._errorCode=-2201,P._errorString="File name cannot be empty.",X=[],(L=Ie.Lib.NewErrorInfo()).input=V,L.message=P._errorString,L.page=0,X.push(L),P._errorlist=X,z(P._errorCode,P._errorString,P)),!1;if(!p.License.checkProductKey(ee,{OCRPro:!0},!0))return p.isFunction(z)&&((P=Ie.Lib.NewOCRProResult(ee))._errorCode=ee._errorCode,P._errorString=ee._errorString,X=[],(L=Ie.Lib.NewErrorInfo()).input=V,L.message=P._errorString,L.page=0,X.push(L),P._errorlist=X,z(P._errorCode,P._errorString,P)),!1;var ne=ke.replaceLocalFilename(V),Z=[];ne.indexOf("|")>0?Z=ne.split("|"):ne.indexOf(";")>0?Z=ne.split(";"):ne.indexOf(",")>0&&(Z=ne.split(","));var te=[];if(Z.length>0)for(var ae=0;ae<Z.length;ae++)te.push(Z[ae]);else te.push(ne);var fe=[],be=this.Settings,Pe=ee.__innerGetRequestJson(Ie.DWT.EnumDWT_OCRProType.OCRDT_File,te,be,fe,Le);ee.__innerIsOCRTrial(function(De){return De||p.License.isLTS()?ee.__innerOCRReadFunction("OCRProRecognize",-1,V,0,fe,Pe,F,z):I(be.LicenseChecker,ee,"OCRProRecognize",-1,V,0,fe,Pe,F,z)},z)},RecognizeSelectedImages:function(V,F){var z,$,P,L=ee;if(L._resetErr(),L._isMobileMode())return L._mobileNotSupport("Addon.OCRPro.RecognizeSelectedImages");if(!p.License.checkProductKey(ee,{OCRPro:!0},!0)){if(p.isFunction(F)){var X=Ie.Lib.NewOCRProResult(ee);X._errorCode=ee._errorCode,X._errorString=ee._errorString,$=[],(P=Ie.Lib.NewErrorInfo()).input="",P.message=X._errorString,P.page=0,$.push(P),X._errorlist=$,F(X._errorCode,X._errorString,X)}return!1}var ne=[],Z=this.Settings,te=function(ee){var Le,V,ke=[];return ee._ImgManager.count()<=0||(Le=ee._ImgManager.getCurrentImageIndex(),ee._ImgManager.convertClientIndexToServerId(Le),V=ee._ImgManager.getSelectedClientIndexArray(),p.isArray(V)&&p.each(V,function(F){var z=ee._ImgManager.convertClientIndexToServerId(F);ke.push(z)})),ke}(ee),ae=ee.__innerGetRequestJson(Ie.DWT.EnumDWT_OCRProType.OCRDT_Index,te,Z,ne,Le);return ee.__innerIsOCRTrial(function(fe){z=fe||p.License.isLTS()?ee.__innerOCRReadFunction("OCRProRecognize",-1,"",0,ne,ae,V,F):I(Z.LicenseChecker,ee,"OCRProRecognize",-1,"",0,ne,ae,V,F)},F),z},IsModuleInstalled:function(){var V=ee;return V._resetErr(),V._isMobileMode()?V._mobileNotSupport("Addon.OCRPro.IsModuleInstalled"):""!=V._innerFun("GetAddOnVersion",ke.makeParams("proocr",Le))},Download:function(V,F,z){var $=ee;if($._resetErr(),$._isMobileMode())return $._mobileNotSupport("Addon.OCRPro.Download");var L=function(){return p.isFunction(F)&&F(),!0},X=function(){return p.isFunction(z)&&z($.ErrorCode,$.ErrorString),!1};if(!p.License.checkProductKey($,{Core:!0})||!p.License.checkProductKey($,{OCRPro:!0},!0))return X();if(this.IsModuleInstalled())return L(),!0;if(!V||""==V||!p.isString(V))return p.Errors.OCR_InvalidRemoteFilename($),X(),!1;if(ke.isServerInvalid($))return X(),!1;p.cancelFrome=2,p.showProgress($,"Download",!0);var Z=!0;return $._OnPercentDone([0,-1,"Downloading OCR Resources...","http"]),p.isFunction(F)||(Z=!1),ke.loadHttpBlob($,"get",V,Z,function(te){$._OnPercentDone([0,-1,"Loading..."]),$.__LoadImageFromBytesForDownload(te,102,"",Z,L,X)},function(){p.closeProgress("Download"),X()},function(te){var ae=0===te.total?100:Math.round(100*te.loaded/te.total);[te.loaded," / ",te.total].join(""),$._OnPercentDone([0,ae,"","http"])})}}},ee.__addon=ee.__addon||{},p.mix(ee.__addon,xe)}),Ie.WebTwain.Addon.OCRPro.NewOCRReadPara=function(ee,ke,xe,Le,V,F,z,$,P,L){return new b(ee,ke,xe,Le,V,F,z,$,P,L)},Ie.WebTwain.Addon.OCRPro.NewOCRError=function(){return new j},Ie.Lib.mix(Ie.Lib.Errors,{OCR_LicenseCheckerEmpty:function(ee){var xe="LicenseChecker cannot be empty.";ee.errorString=xe,ee.responseText=_e("false;-2601;"+xe+";")},OCR_LicenseCheckerNotConnect:function(ee){var xe="Cannot connect to the LicenseChecker, please check and make sure it's set correctly.";ee.errorString=xe,ee.responseText=_e("false;-2602;"+xe+";")},OCR_AccessDenied:function(ee){var xe="Access denied.";ee.errorString=xe,ee.responseText=_e("false;-2603;"+xe+";")},OCR_LicenseCheckerError:function(ee,ke){var Le="Error occured in '"+ke+"'.";ee.errorString=Le,ee.responseText=_e("false;-2604;"+Le+";")},OCR_HTTPError:function(ee,ke){var Le="HTTP Error "+ke+".";ee.errorString=Le,ee.responseText=_e("false;-2605;"+Le+";")},OCR_LicenseCheckerUnauthorized:function(ee,ke){var Le="You do not have permission to view this directory or page using the credentials you supplied (access denied due to Access Control Lists). Ask the Web server's administrator to give you access to '"+ke+"'.";ee.errorString=Le,ee.responseText=_e("false;-2606;"+Le+";")},__last:!1});var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Q=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1)}function b(ee,ke,xe,Le,V,F,z,$,P,L){var X=this;X.STWAIN=ke,X.AjaxFunctionUrl=ee,X.FunctionName=xe,X.ImageIndex=Le,X.FileNames=V,X.Type=F,X.AryZone=z,X.JsonString=$,X.OnSuccess=P,X.OnFailure=L}function S(ee,ke){var xe="",Le=ee.responseText;if(0==Le.length){var V=Ie.WebTwain.Addon.OCRPro.NewOCRError();Ie.Lib.Errors.OCR_LicenseCheckerError(V,ke.AjaxFunctionUrl),Le=V.responseText}xe=function Ve(ee){return function he(ee){var ke,xe,Le,V,F,z;for(ke="",Le=ee.length,xe=0;xe<Le;)switch(V=ee.charCodeAt(xe++),V>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:ke+=ee.charAt(xe-1);break;case 12:case 13:F=ee.charCodeAt(xe++),ke+=String.fromCharCode((31&V)<<6|63&F);break;case 14:F=ee.charCodeAt(xe++),z=ee.charCodeAt(xe++),ke+=String.fromCharCode((15&V)<<12|(63&F)<<6|(63&z)<<0)}return ke}(function oe(ee){var ke,xe,Le,V,F,z,$;for(z=ee.length,F=0,$="";F<z;){do{ke=Q[255&ee.charCodeAt(F++)]}while(F<z&&-1==ke);if(-1==ke)break;do{xe=Q[255&ee.charCodeAt(F++)]}while(F<z&&-1==xe);if(-1==xe)break;$+=String.fromCharCode(ke<<2|(48&xe)>>4);do{if(61==(Le=255&ee.charCodeAt(F++)))return $;Le=Q[Le]}while(F<z&&-1==Le);if(-1==Le)break;$+=String.fromCharCode((15&xe)<<4|(60&Le)>>2);do{if(61==(V=255&ee.charCodeAt(F++)))return $;V=Q[V]}while(F<z&&-1==V);if(-1==V)break;$+=String.fromCharCode((3&Le)<<6|V)}return $}(ee))}(Le);var F=xe.split(";");1==F.length?ke.OnFailure(-1,Le,Ie.Lib.NewOCRProResult()):"true"==F[0]?ke.STWAIN.__innerOCRReadFunction(ke.FunctionName,ke.ImageIndex,ke.FileNames,ke.Type,ke.AryZone,ke.JsonString,function($,P,L){Ie.Lib.isUndefined(L)?Ie.Lib.isUndefined(P)?(ke.OnSuccess($),k(ke.AjaxFunctionUrl,$.GetPageCount())):(ke.OnSuccess($,P),k(ke.AjaxFunctionUrl,P.GetPageCount())):(ke.OnSuccess($,P,L),k(ke.AjaxFunctionUrl,L.GetPageCount()))},ke.OnFailure):ke.OnFailure(F[1],F[2],Ie.Lib.NewOCRProResult())}function I(ee,ke,xe,Le,V,F,z,$,P,L){return J(ee,"DTW_AjaxMethod=CheckLicense&Productkey="+_e(Ie.DWT.ProductKey),S,Ie.WebTwain.Addon.OCRPro.NewOCRReadPara(ee,ke,xe,Le,V,F,z,$,P,L))}function k(ee,ke){J(ee,"DTW_AjaxMethod=WriteOCRCount&OCRCount="+_e(ke+""),O,null)}function O(ee,ke){}function j(){this.responseText="",this.errorString=""}function J(ee,ke,xe,Le){var V=Ie.WebTwain.Addon.OCRPro.NewOCRError();if(""==ee)return Ie.Lib.Errors.OCR_LicenseCheckerEmpty(V),alert(V.errorString),xe(V,Le),!1;var F=function W(){var ee=null,ke=window;try{ee=new ke.ActiveXObject("Msxml2.XMLHTTP")}catch(xe){try{ee=new ke.ActiveXObject("Microsoft.XMLHTTP")}catch(Le){ee=new XMLHttpRequest}}return ee}();return F.open("POST",ee,!0),F.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),F.onreadystatechange=function(){if(4==F.readyState){if(200!=F.status)return 401==F.status?(Ie.Lib.Errors.OCR_LicenseCheckerUnauthorized(V,Le.AjaxFunctionUrl),xe(V,Le),!1):404==F.status?(Ie.Lib.Errors.OCR_LicenseCheckerNotConnect(V),alert(V.errorString),xe(V,Le),!1):403==F.status?(Ie.Lib.Errors.OCR_AccessDenied(V),xe(V,Le),!1):(Ie.Lib.Errors.OCR_HTTPError(V,F.status),xe(V,Le),!1);null!=xe&&"function"==typeof xe&&xe(F,Le)}},F&&ke&&F.send(ke),!0}function _e(ee){return function ie(ee){var ke,xe,Le,V,F,z;for(Le=ee.length,xe=0,ke="";xe<Le;){if(V=255&ee.charCodeAt(xe++),xe==Le){ke+=K.charAt(V>>2),ke+=K.charAt((3&V)<<4),ke+="==";break}if(F=ee.charCodeAt(xe++),xe==Le){ke+=K.charAt(V>>2),ke+=K.charAt((3&V)<<4|(240&F)>>4),ke+=K.charAt((15&F)<<2),ke+="=";break}z=ee.charCodeAt(xe++),ke+=K.charAt(V>>2),ke+=K.charAt((3&V)<<4|(240&F)>>4),ke+=K.charAt((15&F)<<2|(192&z)>>6),ke+=K.charAt(63&z)}return ke}(function le(ee){var ke,xe,Le,V;for(ke="",Le=ee.length,xe=0;xe<Le;xe++)(V=ee.charCodeAt(xe))>=1&&V<=127?ke+=ee.charAt(xe):V>2047?(ke+=String.fromCharCode(224|V>>12&15),ke+=String.fromCharCode(128|V>>6&63),ke+=String.fromCharCode(128|V>>0&63)):(ke+=String.fromCharCode(192|V>>6&31),ke+=String.fromCharCode(128|V>>0&63));return ke}(ee))}}),(Ie=self.Dynamsoft||{}).DWT=Ie.DWT||{},Ie.aryAddonReadyFun=Ie.aryAddonReadyFun||[],Ie.AddonReady=Ie.AddonReady||function(p){Ie.aryAddonReadyFun.push(p)},Ie.WebcamVerForActiveX="15.0.0.0625",Ie.WebcamVerInName="15.0.0.0625",function(){for(var p=[Ie.DWT],l=0;l<1;l++){var u=p[l];u.EnumDWT_VideoRotateMode={VRM_NONE:0,VRM_90_DEGREES_CLOCKWISE:1,VRM_180_DEGREES_CLOCKWISE:2,VRM_270_DEGREES_CLOCKWISE:3,VRM_FLIP_VERTICAL:4,VRM_FLIP_HORIZONTAL:5},u.EnumDWT_VideoProperty={VP_BRIGHTNESS:0,VP_CONTRAST:1,VP_HUE:2,VP_SATURATION:3,VP_SHARPNESS:4,VP_GAMMA:5,VP_COLORENABLE:6,VP_WHITEBALANCE:7,VP_BACKLIGHTCOMPENSATION:8,VP_GAIN:9},u.EnumDWT_CameraControlProperty={CCP_PAN:0,CCP_TILT:1,CCP_ROLL:2,CCP_ZOOM:3,CCP_EXPOSURE:4,CCP_IRIS:5,CCP_FOCUS:6}}}(),Ie.Lib.WebcamErrors={InvalidParameter:function(p){p._errorCode=-10001,p._errorString="The parameter is invalid."},VideoNotPlayingWhenCapture:function(p){p._errorCode=-10002,p._errorString="To capture an image, the video must be playing."},VideoNotPlayingWhenGetURL:function(p){p._errorCode=-10003,p._errorString="To get the url for the current frame, the video must be playing."},Success:function(p){p._errorCode=0,p._errorString="Successful."}},function(p){function l(u){var f=this;f._Count=0,f._resultlist=[],f._stwain=u}l.prototype.GetCount=function(){return p.WebcamErrors.Success(this._stwain),this._Count-1},l.prototype.Get=function(u){var f=this;return f._resultlist.length-1<=u||u<0?(Ie.Lib.Errors.Webcam_InvalidIndex(f._stwain,"Get"),""):(p.WebcamErrors.Success(f._stwain),f._resultlist[u])},l.prototype.GetCurrent=function(){var u=this,f=u._resultlist.length;return 0==f?(Ie.Lib.Errors.Webcam_InvalidIndex(u._stwain,"GetCurrent"),""):(p.WebcamErrors.Success(u._stwain),u._resultlist[f-1])},p.NewWebcamValue=function(u){return new l(u)}}(Ie.Lib),function(p){function l(u){var f=this;f._Count=0,f._resultlist=[],f._stwain=u}l.prototype.GetValue=function(){var u=this;return 0==u._resultlist.length?(Ie.Lib.Errors.Webcam_InvalidIndex(u._stwain,""),""):(p.WebcamErrors.Success(u._stwain),u._resultlist[0].current)},l.prototype.GetIfAuto=function(){var u=this;return 0==u._resultlist.length?(Ie.Lib.Errors.Webcam_InvalidIndex(u._stwain,""),!1):(p.WebcamErrors.Success(u._stwain),"true"==u._resultlist[0].auto)},p.NewWebcamSetting=function(u){return new l(u)}}(Ie.Lib),function(p){function l(u){var f=this;f._Count=0,f._resultlist=[],f._stwain=u}l.prototype.GetMinValue=function(){var u=this;return 0==u._resultlist.length?(Ie.Lib.Errors.Webcam_InvalidIndex(u._stwain,""),""):u._resultlist[0].min},l.prototype.GetMaxValue=function(){var u=this;return 0==u._resultlist.length?(Ie.Lib.Errors.Webcam_InvalidIndex(u._stwain,""),""):u._resultlist[0].max},l.prototype.GetSteppingDelta=function(){var u=this;return 0==u._resultlist.length?(Ie.Lib.Errors.Webcam_InvalidIndex(u._stwain,""),0):u._resultlist[0].step},l.prototype.GetDefaultValue=function(){var u=this;return 0==u._resultlist.length?(Ie.Lib.Errors.Webcam_InvalidIndex(u._stwain,""),0):u._resultlist[0].defaultValue},l.prototype.GetIfAuto=function(){var u=this;return 0==u._resultlist.length?(Ie.Lib.Errors.Webcam_InvalidIndex(u._stwain,""),!1):"true"==u._resultlist[0].auto},p.NewWebcamMoreSetting=function(u){return new l(u)}}(Ie.Lib),Ie.AddonReady(function(p,l){p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(u){u._innerSetWebcamValue=function(f){var g=p.NewWebcamValue(u);return f&&p.isArray(f)&&(g._resultlist=f,g._Count=f.length),g},u._innerSetWebcamSetting=function(f){var g=p.NewWebcamSetting(u);return f&&p.isArray(f)&&(g._resultlist=f,g._Count=f.length),g},u._innerSetWebcamMoreSetting=function(f){var g=p.NewWebcamMoreSetting(u);return f&&p.isArray(f)&&(g._resultlist=f,g._Count=f.length),g}}),p.Addon_Events.push("OnFrameCaptured"),p.Addon_Events.push("OnCaptureSuccess"),p.Addon_Events.push("OnCaptureError")}),Ie.AddonReady(function(p,l){p.product.bHTML5Edition&&p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(u){var f,g=p.html5.Funs,m=p.env.bMac?"DynamicWebcam_"+Ie.WebcamVerInName+".dylib":p.env.bLinux?"DynamicWebcam_"+Ie.WebcamVerInName+".so":u._b64bit?"DynamicWebcamx64_"+Ie.WebcamVerInName+".dll":"DynamicWebcam_"+Ie.WebcamVerInName+".dll";try{u._innerSend("GetAddOnVersion",g.makeParams("webcam",m),!0,!1,!1)}catch(v){}(f=u)._innerWebcamValueFunction=function(v,_){return v=this._innerFunRaw(v,_,!1,!1),this._innerSetWebcamValue(v)},f._innerWebcamSettingFunction=function(v,_){return v=this._innerFunRaw(v,_,!1,!1),this._innerSetWebcamSetting(v)},f._innerWebcamMoreSettingFunction=function(v,_){return v=this._innerFunRaw(v,_,!1,!1),this._innerSetWebcamMoreSetting(v)},f._OnCaptureSuccess=function(v){Ie.Lib.isFunction(this.__OnCaptureSuccess)&&this.__OnCaptureSuccess()},f._OnCaptureError=function(b){var _=b[1];b=b[2],Ie.Lib.isFunction(this.__OnCaptureError)&&this.__OnCaptureError(_,b)},f._OnFrameCaptured=function(v){var _,b=this,S=Ie.Lib;b.__videoPause||(_=(_=b.__videoQuality)||60,b.__videoDest&&b.__videoDest.UpdateVideoContainer(b.GetImageURL(-1,-1,-1,0,_))),S.isFunction(b.__OnFrameCaptured)&&b.__OnFrameCaptured(v)},f={Webcam:{IsModuleInstalled:function(){var v=u;return v._resetErr(),""!=v._innerFun("GetAddOnVersion",g.makeParams("webcam",m))},Download:function(v,_,b){function S(){return u.IfShowProgressBar&&p.closeProgress(null,"Download"),Ie.Lib.isFunction(_)&&_(),!0}function I(){return u.IfShowProgressBar&&p.closeProgress(null,"Download"),Ie.Lib.isFunction(b)&&b(u._errorCode,u._errorString),!1}var k=u;if(k._resetErr(),Ie.Lib.cancelFrome=2,!p.License.checkProductKey(u,{Webcam:!0},!0))return I();if(this.IsModuleInstalled())return S();if(!v||""==v)return Ie.Lib.Errors.Webcam_InvalidRemoteFilename(k),I();if(g.isServerInvalid(k))return I(),!1;u.IfShowProgressBar&&p.showProgress(k,"Download",!0);var O=!0;return k._OnPercentDone([0,-1,"Downloading Webcam Module...","http"]),Ie.Lib.isFunction(_)||(O=!1),g.loadHttpBlob(k,"get",v,O,function(j){k._OnPercentDone([0,-1,"Loading..."]),k.__LoadImageFromBytesV1(j,100,"",0,O,S,I)},function(){I()},function(j){var W=0===j.total?100:Math.round(100*j.loaded/j.total);[j.loaded," / ",j.total].join(""),k._OnPercentDone([0,W,"","http"])})},GetSourceList:function(){var v,_=u;return _._resetErr(),p.License.checkProductKey(_,{Webcam:!0},!0)?(v=_._innerFunRaw("GetWebcamSourceList"),0==_.ErrorCode&&v&&1<v.length&&v.splice(v.length-1,1),v):[]},SelectSource:function(v){var _=u;return _._resetErr(),!!p.License.checkProductKey(_,{Webcam:!0},!0)&&_._innerFun("SelectWebcam",g.makeParams(v))},CloseSource:function(){var v=u;return v._resetErr(),this._clear(),v._innerFun("StopCapture")},GetFramePartURL:function(){var v=u;return v._resetErr(),this._isPlaying()?v.GetImageURL(-1,-1,-1,!0,v.__videoQuality):(p.WebcamErrors.VideoNotPlayingWhenGetURL(v),"")},GetFrameURL:function(){var v=u;return v._resetErr(),this._isPlaying()?v.GetImageURL(-1,-1,-1,0,v.__videoQuality):(p.WebcamErrors.VideoNotPlayingWhenGetURL(v),"")},PlayVideo:function(v,_,b,S,I){function k(){return W._clear(),Ie.Lib.isFunction(I)&&I(u._errorCode,u._errorString),!1}var O=u,j=(O._resetErr(),60),W=this;return Ie.DWT.UseDefaultViewer?v?p.License.checkProductKey(u,{Webcam:!0},!0)?(O.__videoDest=v,O.__videoDest.ShowVideoContainer(!0),Ie.Lib.isFunction(b)&&(u.__OnFrameCaptured=b),u.__videoPause?(u.__videoPause=!1,p.isFunction(S)&&S()):(u.__videoPause=!1,u.__videoQuality=_?j=(j=+_)<1?60:j:j,u._innerSend("PlayVideo",g.makeParams(!0),!0,S,k)),!0):k():(Ie.Lib.Errors.ParameterCannotEmpty(u),k()):(Ie.Lib.Errors.CannotDoWhenNoViewerJS(u),!1)},PauseVideo:function(){var v=u;return v._resetErr(),this._isPlaying()&&(v.__videoPause=!0),!0},_clear:function(){var v=u;v.__videoPause=!1,v.__OnFrameCaptured=!1,v.__videoQuality=60,v.__videoDest&&v.__videoDest.ShowVideoContainer(!1),v.__videoDest=!1},_isPlaying:function(){return u.GetIfShowVideoContainer()},StopVideo:function(){var v=u,_=(v._resetErr(),this._clear(),v._innerFun("PlayVideo",g.makeParams(!1,0)));return v._innerFun("StopCapture"),_},CaptureImage:function(v,_){var b=u;if(b._resetErr(),!p.License.checkProductKey(b,{Webcam:!0},!0))return p.isFunction(_)&&_(b._errorCode,b._errorString),!1;function S(){g.hideMask(I),p.isFunction(_)&&_(b._errorCode,b._errorString)}var I="CaptureImage";g.showMask(I),b.__OnCaptureError=S,b._innerSend(I,g.makeParams(!1),!0,function(){g.hideMask(),0==b.ErrorCode?(g.hideMask(I),p.isFunction(v)&&setTimeout(v,0),p.License.isLTS()&&Ie.DWT.lcvrf(u)):S()},S)},GetMediaType:function(){var v=u;return v._resetErr(),v._innerWebcamValueFunction("GetMediaType")},SetMediaType:function(v){var _=u;return _._resetErr(),p.isString(v)?_._innerFun("SetMediaType",g.makeParams(v)):(p.Errors.InvalidValue(_),!1)},GetResolution:function(){var v;if((v=u)._resetErr(),(v=v._innerWebcamValueFunction("GetResolution"))&&v._resultlist){var _,b,S=v._resultlist,I=[],k=[];for(""==(b=0<S.length?S[S.length-1]:b)&&0<S.length&&(b=S[0]),_=0;_<S.length-1;_++){for(var O,j=(O=S[_]).toLowerCase().split("x"),W=(K=J=W=void 0,{value:O,p1:parseInt(j[0]),p2:parseInt(j[1])}),J=I,K=J.length-1;0<=K&&J[K].p1>=W.p1&&!(J[K].p1==W.p1&&J[K].p2<W.p2);)J[K+1]=J[K],K--;J[K+1]=W}for(_=0;_<I.length;_++)k.push(O=I[_].value);b&&k.push(b),v._resultlist=k,k=I=null}return v},SetResolution:function(v){var _=u;return _._resetErr(),p.isNumber(v)||p.isString(v)?_._innerFun("SetResolution",g.makeParams(v)):(p.Errors.InvalidValue(_),!1)},GetFrameRate:function(){var v=u;return v._resetErr(),v._innerWebcamValueFunction("GetFrameRate")},SetFrameRate:function(v){var _=u;return _._resetErr(),p.isNumber(v)?u._innerFun("SetFrameRate",g.makeParams(v)):(p.Errors.InvalidValue(_),!1)},GetVideoPropertySetting:function(v){var _=u;return _._resetErr(),_._innerWebcamSettingFunction("GetWebcamVideoPropertySetting",g.makeParams(v))},GetVideoPropertyMoreSetting:function(v){var _=u;return _._resetErr(),_._innerWebcamMoreSettingFunction("GetWebcamVideoPropertyMoreSetting",g.makeParams(v))},SetVideoPropertySetting:function(v,_,b){var S=u;return S._resetErr(),S._innerFun("SetWebcamVideoPropertySetting",g.makeParams(v,_,b))},SetVideoRotateMode:function(v){var _=u;return _._resetErr(),_._innerFun("SetVideoRotateMode",g.makeParams(v))},GetCameraControlPropertySetting:function(v){var _=u;return _._resetErr(),_._innerWebcamSettingFunction("GetWebcamCameraControlSetting",g.makeParams(v))},GetCameraControlPropertyMoreSetting:function(v){var _=u;return _._resetErr(),_._innerWebcamMoreSettingFunction("GetWebcamCameraControlMoreSetting",g.makeParams(v))},SetCameraControlPropertySetting:function(v,_,b){var S=u;return S._resetErr(),S._innerFun("SetWebcamCameraControlPropertySetting",g.makeParams(v,_,b))}}},u.__addon=u.__addon||{},p.mix(u.__addon,f)})}),Ie.AddonReady(function(p,l){var u;p.product.bActiveXEdition&&p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(f){var g,m,v;if(!f.getSWebTwain()||!f.getSWebTwain().Addon)return!1;Ie.navInfoSync.bWin&&(u=(v=!Ie.navInfo.bOSx64||Ie.navInfo.bWOW64)?"DynamicWebcam_"+Ie.WebcamVerForActiveX+".dll":"DynamicWebcamx64_"+Ie.WebcamVerForActiveX+".dll"),g=f.getSWebTwain();try{g.GetAddOnVersion("webcam",u)}catch(_){}(v=f)._innerRead=function(_){var b;try{b=Ie.Lib.parse(_)}catch(S){}return b.result},v._innerWebcamValueFunctionPlugin=function(_){return _=this._innerRead(_),this._innerSetWebcamValue(_)},v._innerWebcamSettingFunctionPlugin=function(_){return _=this._innerRead(_),this._innerSetWebcamSetting(_)},v._innerWebcamMoreSettingFunctionPlugin=function(_){return _=this._innerRead(_),this._innerSetWebcamMoreSetting(_)},m={Webcam:{IsModuleInstalled:function(){var _=g.GetAddOnVersion("webcam",u);return p.setErrorString(f),""!=_},Download:function(_,b,S){function I(){return Ie.Lib.isFunction(b)&&b(),!0}function k(){return Ie.Lib.isFunction(S)&&S(f._errorCode,f._errorString),!1}return p.License.checkProductKey(f,{Webcam:!0},!0)?this.IsModuleInstalled()?I():_&&""!=_?(_=g.DownloadAddon(_),p.wrapperRet(f,_,I,k)):(Ie.Lib.Errors.Webcam_InvalidRemoteFilename(f),k()):k()},GetSourceList:function(){var _,b;return p.License.checkProductKey(f,{Webcam:!0},!0)?(_=g.GetWebcamSourceList(),b=[],p.setErrorString(f),0==f._errorCode&&(b=f._innerRead(_))&&1<b.length&&b.splice(b.length-1,1),b):[]},SelectSource:function(_){return!!p.License.checkProductKey(f,{Webcam:!0},!0)&&(_=g.SelectWebcam(_),p.setErrorString(f),_)},CloseSource:function(){f._playVideoDWT=null;var _=g.StopCapture();return p.setErrorString(f),_},GetFramePartURL:function(){var _;return this._isPlaying()?(_=g.GetDIB(-1),p.setErrorString(f),_):(p.WebcamErrors.VideoNotPlayingWhenGetURL(f),"")},GetFrameURL:function(){return""},PlayVideo:function(_,b,S,I,k){function O(){return f._playVideoDWT=null,Ie.Lib.isFunction(k)&&k(f.ErrorCode,f.ErrorString),!1}var j;return _&&_.getSWebTwain()?p.License.checkProductKey(f,{Webcam:!0},!0)?(j=_.getSWebTwain().CurrentHWND)?(f._playVideoDWT=_,setTimeout(function(){var W=g.RunWebcamCmd("PlayVideo",j,null,null,S);p.wrapperRet(f,W,I,O)},0),!0):(p.WebcamErrors.InvalidParameter(f),O()):O():(Ie.Lib.WebcamErrors.InvalidParameter(f),O())},PauseVideo:function(){return!0},StopVideo:function(){f._playVideoDWT=null;var _=g.RunWebcamCmd("StopVideo",0,null,null,null);return p.setErrorString(f),g.StopCapture(),_},CaptureImage:function(_,b){function S(){return Ie.Lib.isFunction(b)&&b(f.ErrorCode,f.ErrorString),!1}var I;return p.License.checkProductKey(f,{Webcam:!0},!0)?(I=g.RunWebcamCmd("Capture",0,function(){p.isFunction(_)&&setTimeout(_,0),p.License.isLTS()&&Ie.DWT.lcvrf(f)},S,null),p.setErrorString(f),I):S()},GetMediaType:function(){var _=f._innerWebcamValueFunctionPlugin(g.GetMediaType());return p.setErrorString(f),_},SetMediaType:function(_){return p.isString(_)?(_=g.SetMediaType(_),p.setErrorString(f),_):(p.Errors.InvalidValue(f),!1)},GetResolution:function(){var _=f._innerWebcamValueFunctionPlugin(g.GetResolution());if(p.setErrorString(f),_&&_._resultlist){var b,S,I=_._resultlist,k=[],O=[];for(0<I.length&&(S=I[I.length-1]),b=0;b<I.length-1;b++){for(var j,W=(j=I[b]).toLowerCase().split("x"),J=(Q=K=J=void 0,{value:j,p1:parseInt(W[0]),p2:parseInt(W[1])}),K=k,Q=K.length-1;0<=Q&&K[Q].p1>=J.p1&&!(K[Q].p1==J.p1&&K[Q].p2<J.p2);)K[Q+1]=K[Q],Q--;K[Q+1]=J}for(b=0;b<k.length;b++)O.push(j=k[b].value);S&&O.push(S),_._resultlist=O,O=k=null}return _},SetResolution:function(_){return p.isNumber(_)||p.isString(_)?(_=g.SetResolution(_),p.setErrorString(f),_):(p.Errors.InvalidValue(f),!1)},GetFrameRate:function(){var _=f._innerWebcamValueFunctionPlugin(g.GetFrameRate());return p.setErrorString(f),_},SetFrameRate:function(_){return p.isNumber(_)?(_=g.SetFrameRate(_),p.setErrorString(f),_):(p.Errors.InvalidValue(f),!1)},GetVideoPropertySetting:function(_){return _=g.GetWebcamVideoPropertySetting(_),p.setErrorString(f),f._innerWebcamSettingFunctionPlugin(_)},GetVideoPropertyMoreSetting:function(_){return _=g.GetWebcamVideoPropertyMoreSetting(_),p.setErrorString(f),f._innerWebcamMoreSettingFunctionPlugin(_)},SetVideoPropertySetting:function(_,b,S){return _=g.SetWebcamVideoPropertySetting(_,b,S),p.setErrorString(f),_},SetVideoRotateMode:function(_){return _=g.SetVideoRotateMode(_),p.setErrorString(f),_},GetCameraControlPropertySetting:function(_){return _=g.GetWebcamCameraControlSetting(_),p.setErrorString(f),f._innerWebcamSettingFunctionPlugin(_)},GetCameraControlPropertyMoreSetting:function(_){return _=g.GetWebcamCameraControlMoreSetting(_),p.setErrorString(f),f._innerWebcamMoreSettingFunctionPlugin(_)},SetCameraControlPropertySetting:function(_,b,S){return _=g.SetWebcamCameraControlPropertySetting(_,b,S),p.setErrorString(f),_},_isPlaying:function(){return!!f._playVideoDWT}}},f.Addon=f.Addon||{},p.mix(f.Addon,m)})}),function(p){p.DWT||(p.DWT={}),p.Lib||(p.Lib={})}(Ie=window.Dynamsoft||{}),Ie.aryAddonReadyFun=Ie.aryAddonReadyFun||[],Ie.AddonReady=Ie.AddonReady||function(p){Ie.aryAddonReadyFun.push(p)},Ie.AddonReady(function(p,l){Ie.DWT.EnumTransferErrorCode={TRANS_OK:0,TRANS_URL_MALFFORMAT:1,TRANS_FAILED_RESOLVE_PROXY:2,TRANS_FAILED_RESOLVE_HOST:3,TRANS_FAILED_CONNECT:4,TRANS_REMOTE_ACCESS_DENIED:5,TRANS_PARTIAL_FILE:6,TRANS_UPLOAD_FAILED:7,TRANS_READ_FAILED:8,TRANS_OUT_OF_MEMORY:9,TRANS_REMOTE_FULL_DISK:10,TRANS_OPERATION_TIMEOUT:11,TRANS_SERVICE_ERROR_404:12,TRANS_SERVICE_ERROR_500:13,TRANS_SERVICE_ERROR_503:14,TRANS_SERVICE_ERROR:15,TRANS_NOT_SEND:16,TRANS_WAITFOR_SEND:17,TRANS_SENDING:18,TRANS_PAUSE:19,TRANS_FINISHED:20,TRANS_NULL_POINTER:21,TRANS_INVALID_ID:22,TRANS_Failed:23,TRANS_SERVICE_ERROR_MORE_THAN_500:24,TRANS_SERVICE_ERROR_LESS_THAN_200:25,TRANS_SERVICE_ERROR_MORE_THAN_300:26,TRANS_CANNOT_FINDFILE:27,TRANS_ABORT:28,TRANS_NOT_FINISHED:29,TRANS_TASK_PREPARE_INIT:30,TRANS_TASK_INIT:31,TRANS_BEYOND_MAXSIZE:32};var u=Ie,f=p.guid(),g=5,m=Ie.dcp,v=[1,8,4,"0926"],_="upload_"+v.join(""),b={Version:"1.0",HttpVersion:"1.1",ServerUrl:"",FileName:"",VERIFYPEER:!1,VERIFYHOST:!1,BlockSize:10240,ThreadNum:1,OnUploadTransferPercentage:function(xe,Le){},OnRunSuccess:function(xe){},OnRunFailure:function(xe,Le,V){}},S=0,I="",O=function(){S=-2,I="Upload failed because the url to upload to is invalid."},j=function(xe,Le,V){S=-3,xe?I="Upload cancelled.":(I=Le&&""!=Le?"Upload failed with error: "+Le:"Upload failed.",Le&&""!=Le&&(I=I+"("+V+")"))},Q=function(){S=-7,I="The file name is incorrect in the upload job."},le=function(){S=0,I=""};function he(){}function _e(xe){this.job=xe}function Ve(xe){this.job=xe}he.prototype={runWaiting:0,CreateJob:function(){var xe={HttpHeader:{},documents:[],formFields:[],bEvent:!1};return p.mix(xe,b),xe.SourceValue=new _e(xe),xe.FormField=new Ve(xe),xe},Run:function(xe){var Le,V=this,F='""',z=xe.ServerUrl,$="";if(!p.isString(z)||""==z)return xe.id=-1,O(),!xe.bEvent&&p.isFunction(xe.OnRunFailure)&&(xe.bEvent=!0,xe.OnRunFailure(xe,S,I),xe.bEvent=!1),!1;if(!xe.documents||!p.isArray(xe.documents)||xe.documents.length<=0)return xe.id=-1,S=-4,I="Upload failed because the file to upload has invalid content.",!xe.bEvent&&p.isFunction(xe.OnRunFailure)&&(xe.bEvent=!0,xe.OnRunFailure(xe,S,I),xe.bEvent=!1),!1;if(!xe.ar||!xe.cu){if(Ie.Lib.License.isLicenseMixed(null,!0)||Ie.Lib.License.reparseProductKey(),0!=(L=Ie.DWT.licenseException).code)return xe.id=-1,S=L.code,I=L.message,!xe.bEvent&&p.isFunction(xe.OnRunFailure)&&(xe.bEvent=!0,xe.OnRunFailure(xe,S,I),xe.bEvent=!1),!1;if(Ie.Lib.License.isLTS())return Ie.DWT.lglic(Ie.DWT.EnumInstance.dwt_desktop,"").then(function(te){xe.ar=te.ar,xe.cu=te.cu,V.Run(xe)}),!0;p.product.refProductKey&&(F='"'+p.product.refProductKey+'"')}for(xe.Url=z,delete xe.ServerUrl,Le=0;Le<xe.documents;Le++){var P=xe.documents[Le];if(!p.isString(P.files)||""==P.files)return xe.id=-1,Q(),!xe.bEvent&&p.isFunction(xe.OnRunFailure)&&(xe.bEvent=!0,xe.OnRunFailure(xe,S,I),xe.bEvent=!1),!1;p.isString(P.remoteName)&&""!=P.remoteName||(P.remoteName="RemoteFile")}var L=xe.SourceValue,X=(delete xe.SourceValue,xe.FormField),ne=(delete xe.FormField,p.stringify(xe));return ne=p.replaceAll(ne,'"',"'"),xe.ServerUrl=z,delete xe.Url,xe.SourceValue=L,xe.FormField=X,z=['{"id":"',f,'","method":"RunUploadFile","version":"',_,'","parameter":[',F,',"',ne,'"'],xe.ar&&xe.cu?($=[',"',xe.ar,'","',xe.cu,'",0]}'].join(""),delete xe.ar,delete xe.cu,z.push($)):z.push("]}"),L=z.join(""),V.runWaiting++,Ie.FileUploader._sendCmd("RunUploadFile",L,function(Z){var te;V.runWaiting--,Z&&((te=Z.UploadId)&&0<te?(xe.id=te,u.FileUploader.map[xe.id]=xe,u.FileUploader.ids.push(Z.UploadId),xe.OnUploadTransferPercentage&&xe.OnUploadTransferPercentage(xe,0)):(te=Z.errorcode,Z=Z.errorstring,te&&Z?(S=te,I=Z):(S=-6,I="Cannot create an upload job."),!xe.bEvent&&p.isFunction(xe.OnRunFailure)&&(xe.bEvent=!0,xe.OnRunFailure(xe,S,I),xe.bEvent=!1)))},function(Z,te,ae){V.runWaiting--,u.FileUploader.parseHttpErrors(Z,te,ae),!xe.bEvent&&p.isFunction(xe.OnRunFailure)&&(xe.bEvent=!0,xe.OnRunFailure(xe,S,I),xe.bEvent=!1)}),!0},Cancel:function(xe){return!xe.id||xe.id<0?(S=-5,I="Invalid upload job id.",!xe.bEvent&&p.isFunction(xe.OnRunFailure)&&(xe.bEvent=!0,xe.OnRunFailure(xe,S,I),xe.bEvent=!1),!1):(Ie.FileUploader._sendCmd("DeleteUploadTask",'{"id":"'+f+'","method":"DeleteUploadTask","version":"'+_+'","parameter":["'+xe.id+'"]}',function(V){u.FileUploader.deleteJobById(xe.id)},function(V,F,z){u.FileUploader.parseHttpErrors(V,F,z),!xe.bEvent&&p.isFunction(xe.OnRunFailure)&&(xe.bEvent=!0,xe.OnRunFailure(xe,S,I),xe.bEvent=!1)}),!0)},CancelAllUpload:function(){var xe=u.FileUploader.ids,Le='{"id":"'+f+'","method":"DeleteUploadTask","version":"'+_+'","parameter":["'+xe.join(",")+'"]}';return 0<this.runWaiting?(S=-8,I="Can not cancel all jobs when at least one job is still being created.",!1):(this.runWaiting<0&&(this.runWaiting=0),xe.length<=0||Ie.FileUploader._sendCmd("DeleteUploadTask",Le,function(V){for(var F=0;F<xe.length;F++)u.FileUploader.deleteJobById(xe[F]);u.FileUploader.ids=[],u.FileUploader.map=[]},function(V,F,z){u.FileUploader.parseHttpErrors(V,F,z)}),!0)},OnUploadTransferPercentage:function(xe,Le){},OnRunSuccess:function(xe){},OnRunFailure:function(xe,Le,V){}},(u.SourceValue=_e).prototype.Add=function(xe,Le,V){var F=this.job;p.isString(xe)&&""!=xe?(V=V||"RemoteFile",xe=Ie.Lib.replaceAll(xe,"\\\\","\\\\"),F.documents.push({files:[xe],fileName:Le,remoteName:V})):(Q(),!F.bEvent&&p.isFunction(F.OnRunFailure)&&(F.bEvent=!0,F.OnRunFailure(F,S,I),F.bEvent=!1))},u.FormField=Ve,u.FileUploader={ids:[],map:{},port:18625,protocol:"https://",ip:"127.0.0.1",wsUrl:"",running:!(Ve.prototype.Add=function(xe,Le){var V,F,z=Le,$=xe;if(null==z&&(z=""),!p.isString($)||""==$||!p.isString(z)||(z=encodeURI(z),-1<($=encodeURI($)).indexOf("'")||-1<z.indexOf("'")))return!1;for(V=0;V<this.job.formFields.length;V++)if((F=this.job.formFields[V]).name==$)return F.value=z,!0;return this.job.formFields.push({name:$,value:z}),!0}),ws:null,nextLoopTime:600,deleteJobById:function(xe){var Le;if(le(),xe){for(Le=0;Le<u.FileUploader.ids.length;Le++)if(xe==u.FileUploader.ids[Le]){u.FileUploader.ids.splice(Le,1);break}var V=u.FileUploader.map[xe];for(V.SourceValue.job=null,delete V.SourceValue,V.FormField.job=null,delete V.FormField,delete u.FileUploader.map[xe],Le=V.documents.length-1;0<=Le;Le--)V.documents.splice(Le,1);for(Le=V.formFields.length-1;0<=Le;Le--)V.formFields.splice(Le,1);Ie.FileUploader._sendCmd("DeleteUploadTask",'{"id":"'+f+'","method":"DeleteUploadTask","version":"'+_+'","parameter":["'+xe+'"]}')}},_sendCmdByWS:function(xe,Le,V){var F=u.FileUploader.ws;return F&&F.readyState!=Ie.DWT.EnumDWT_WebsocketReadyState.CLOSING&&F.readyState!=Ie.DWT.EnumDWT_WebsocketReadyState.CLOSED||(F=Ie.DWT.NetManager.newWebsocket(u.FileUploader.wsUrl),u.FileUploader.ws=F),Ie.DWT.NetManager.postStringDataByWS(F,xe).then(function(z){(z=p.parse(z))&&"result"in z?p.isFunction(Le)&&Le(z.result):p.isFunction(V)&&V()},V),!0},_sendCmd:function(xe,Le,V,F){return Ie.DWT.ConnectWithSocket?u.FileUploader._sendCmdByWS(Le,V,F):(xe=[u.FileUploader.protocol,u.FileUploader.ip,":",u.FileUploader.port,"/dcp/",_,"/",xe,"?type=1&dsver=",v.join(""),"&ts=",p.now()].join(""),p.ajax({url:xe,method:"post",dataType:"json",processData:!1,data:Le,onSuccess:V,onError:F}))},parseHttpErrors:function(z,Le,V){var F;2==(z=z&&p.isArray(z)&&2<z.length?(F=z[1],z[2]):(F=Le,V)).state&&0==z.status?"abort"===z.statusText?j(!0):O():j(!1,F,z.status)},loadHttpBlob:function(xe,Le,V,F,z,$,P){xe={method:xe,url:Le,dataType:"blob",async:V,onSuccess:F,onError:function(L,X,ne){u.FileUploader.parseHttpErrors(L,X,ne),p.isFunction(z)&&z()}},p.isFunction($)&&(xe.beforeSend=function(L){L.addEventListener("progress",function(X){delete X.totalSize,delete X.position,$(X)},!1)}),p.ajax(xe)},_OnPercentDone:function(){},Download:function(xe,Le,V){var F;return p.isString(xe)?u.FileUploader.loadHttpBlob("get",xe,!!(F=function(){return S=-9,I="The zip file that contains the upload library (.dll) download failed.",p.isFunction(V)&&V(S,I),!1}),function(z){m.loadZip(z,100,Le,F)},F,!1):(S=-1,I="The zip file that contains the upload library (.dll) is invalid.",p.isFunction(V)&&V(S,I),!1)},Init:function(xe,Le,V){if(le(),!Ie.Lib.detect.bOK)return--g<=0?(p.isFunction(V)&&V(),void(g=5)):void setTimeout(function(){Ie.FileUploader.Init(xe,Le,V)},300);function F(){var z,$=Ie.navInfoSync.bSSL?(z="https://",Ie.dcp.SSLPort):(z="http://",Ie.dcp.Port);u.FileUploader.port=$,u.FileUploader.protocol=z,u.FileUploader.ip=Ie.DWT.Host,u.FileUploader.wsUrl=Ie.DWT.NetManager.getWsUrl(Ie.DWT.Host,$),u.FileUploader.running=!0,p.isFunction(Le)&&Le(new he),setTimeout(u.FileUploader.StatusLoop,500)}Ie.dcp.detect.bConnected?F():Ie.DWT.NetManager.checkModuleManager(F,function(){--g<=0?(p.isFunction(V)&&V(),g=5):setTimeout(function(){Ie.FileUploader.Init(xe,Le,V)},500)})},Close:function(){var xe;Ie.DWT.ConnectWithSocket&&(xe=Ie.FileUploader.ws)&&(xe.readyState!=Ie.DWT.EnumDWT_WebsocketReadyState.CLOSED&&xe.readyState!=Ie.DWT.EnumDWT_WebsocketReadyState.CLOSING&&xe.close(),Ie.FileUploader.ws=null),Ie.FileUploader.running=!1},VersionInfo:function(xe,Le){return le(),Ie.FileUploader._sendCmd("VersionInfo",'{"id":"'+f+'","method":"VersionInfo","version":"'+_+'","parameter":[]}',xe,function(F,z,$){u.FileUploader.parseHttpErrors(F,z,$),p.isFunction(Le)&&Le(S,I)}),!0},StatusLoop:function(){return le(),u.FileUploader.GetUploadStatus(),u.FileUploader.running&&setTimeout(u.FileUploader.StatusLoop,u.FileUploader.nextLoopTime),!0},GetUploadStatus:function(){var xe;return le(),u.FileUploader.ids.length<=0||(xe='{"id":"'+f+'","method":"GetUploadStatus","version":"'+_+'","parameter":["'+u.FileUploader.ids.join(",")+'"]}',Ie.FileUploader._sendCmd("GetUploadStatus",xe,function(Le){if(p.isArray(Le))for(var V=0;V<Le.length;V++){var F=(X=Le[V]).id,z=u.FileUploader.map[F],$=X.percentage,P=X.errorcode,L=X.response,X=X.errorstring;z&&(P==Ie.DWT.EnumTransferErrorCode.TRANS_FINISHED?(z.OnUploadTransferPercentage(z,100,ke(L)),!z.bEvent&&p.isFunction(z.OnRunSuccess)&&(z.bEvent=!0,z.OnRunSuccess(z,ke(L)),z.bEvent=!1),u.FileUploader.deleteJobById(F)):P==Ie.DWT.EnumTransferErrorCode.TRANS_OK||P==Ie.DWT.EnumTransferErrorCode.TRANS_NOT_SEND||P==Ie.DWT.EnumTransferErrorCode.TRANS_WAITFOR_SEND||P==Ie.DWT.EnumTransferErrorCode.TRANS_SENDING||P==Ie.DWT.EnumTransferErrorCode.TRANS_PAUSE||P==Ie.DWT.EnumTransferErrorCode.TRANS_TASK_PREPARE_INIT||P==Ie.DWT.EnumTransferErrorCode.TRANS_TASK_INIT?z.OnUploadTransferPercentage(z,$,ke(L)):(!z.bEvent&&p.isFunction(z.OnRunFailure)&&(z.bEvent=!0,z.OnRunFailure(z,P,X,ke(L)),z.bEvent=!1),u.FileUploader.deleteJobById(F)))}},function(Le,V,F){})),!0}};var ee=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function ke(xe){for(var Le,V,F,z,$=xe.length,P=0,L="";P<$;){for(;Le=ee[255&xe.charCodeAt(P++)],P<$&&-1==Le;);if(-1==Le)break;for(;V=ee[255&xe.charCodeAt(P++)],P<$&&-1==V;);if(-1==V)break;L+=String.fromCharCode(Le<<2|(48&V)>>4);do{if(61==(F=255&xe.charCodeAt(P++)))return L}while(F=ee[F],P<$&&-1==F);if(-1==F)break;L+=String.fromCharCode((15&V)<<4|(60&F)>>2);do{if(61==(z=255&xe.charCodeAt(P++)))return L}while(z=ee[z],P<$&&-1==z);if(-1==z)break;L+=String.fromCharCode((3&F)<<6|z)}return L}}),function(){var l=620;Ie.OnWebTwainNotFoundOnWindowsCallback=function(f,g,m,v,_,b,S){Ie._show_install_dialog(f,{default:g},m,Ie.DWT.EnumDWT_PlatformType.enumWindow,v,_,b,S,!1)},Ie.OnWebTwainNotFoundOnLinuxCallback=function(f,g,m,v,_,b,S,I,k){k||(k=Ie.DWT.EnumDWT_PlatformType.enumLinux),Ie._show_install_dialog(f,{default:g,deb:g,rpm:m},v,k,_,b,S,I,!1)},Ie.OnWebTwainNotFoundOnMacCallback=function(f,g,m,v,_,b,S){Ie._show_install_dialog(f,{default:g},m,Ie.DWT.EnumDWT_PlatformType.enumMac,v,_,b,S,!1)},Ie.OnWebTwainNotFoundOnAndroidCallback=function(f,g,m,v){var _={default:"https://demo.dynamsoft.com/DWT/Resources/dist/DynamsoftServiceSetup.apk"},b=Math.random(),S=Ie.DWT.ServiceInstallerLocation;if(Ie.Lib.isString(S)&&S.length>0){var I="";"/"!=S[S.length-1]&&(I="/"),_.default=[S,I,"DynamsoftServiceSetup.apk"].join("")}_.openService="intent://dynamsoft.com/#Intent;scheme=http;package=com.dynamsoft.mobilescan;S.timestamp="+b+";end",Ie.DWT.Host="local.dynamsoft.com",Ie._show_android_install_dialog(_,v)},Ie.OnMobileNotSupportCallback=function(){var f=[];Ie.DWT?(f.push('<div class="ds-dwt-ui-dlg-android" style="padding-bottom:30px">'),f.push("Service Mode does not support your Operating System, please contact the site administrator."),f.push("</div>"),Ie.DWT.ShowMessage(f.join(""),{width:335,headerStyle:1,backgroundStyle:1})):console.log("The Dynamsoft namespace is missing")},Ie.OnHTTPCorsError=function(f){var g=["<div>",f,"</div>",'<div style="margin-top:10px">To fix the issue, please update your website to HTTPS or refer to <br /><a target="_blank" href="https://www.dynamsoft.com/web-twain/docs/faq/http-insecure-websites-in-chromium-browser.html?ver=latest">this article</a> for other workarounds.</div>'].join("");Ie.DWT.ShowMessage(g,{width:l,headerStyle:2})},Ie._show_install_dialog=function(f,g,m,v,_,b,S,I,k){var j,J,O=Ie,K=Ie.DWT.EnumDWT_PlatformType,Q=v==K.enumLinux||v==K.enumEmbed||v==K.enumChromeOS||v==K.enumHarmonyOS;j=['<div class="dynamsoft-dwt-dlg-title">',k?"Please update your document scanning service":"Please download and install the Dynamic Web TWAIN service",'</div><div class="dynamsoft-dwt-dlg-title-error" style="display:none"></div>'],O.DWT?(J=Q||Ie.navInfoSync.bFirefox?"RESTART":"REFRESH",j.push('<div class="dynamsoft-dwt-installdlg-iconholder"> '),j.push('<div class="dynamsoft-dwt-installdlg-splitline" style="left: 134px"></div>'),j.push('<div class="dynamsoft-dwt-installdlg-splitline" style="left: 328px"></div>'),j.push('<img style="margin: 0px 133px 0px 0px" src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAABqxJREFUaEPlm01y2zYUxwHJe6cniHMCU7K7tnoCK8uuYp+gzglsn8DOCapuuo1ygsjr2hKz6jLKtpvY61pA/g8ARZDiBwiCnMyYM5omKQnih/fw8L7I2Qu7eNe8o9GvJ/QOKUU0GPBX+s9swrl8ZIzH9Hch5JrzwVrK/59iXF3OKThwFEUHjA1PBgM21WAa0vWSkuDZQgg+Z+z5DvxYmHBXMOAoOnoHuAtMNrKnB4AvkOQjJArJcTV5IdgCcn4Fiat7cQ8WieMnDzDG6yyenAP+Qxzf45n2V2tggE4BeYOJYsL6AsAn/CAhsYCE1k2mCQ2B6g8mUvIzjHmYjskWUj6/b6vy3sBRdAx1ZZf4TQzkN0BexfFy1gSw6l6wQwv2LrCE+PF9s5wzITbXTRcyeY8X8Hh8fIMBMAmF+gSjcxESNL8IKTi7NIv7iMWFtJsvbiNg/eLhn1jtqZnUtRDPt6ENS5nUySByPryFqp+ae66Wy/vrJhrlDKxftvdRGyWSKp+GMiRNJkz3jsdjaNeAtIw0jFSc9raTNXcCJkOClf1MRwxZXSk3Z22NR1PIXTU/muLog73g+zj+Yhi031yga4GNGq00LLvDwJCs22q2hap73ghiTkcZQa9W96O6ZyqBac9CjSFZFhEsBlQW+We6jF1ZaysuZ8vlw3nV/CqBx+Ojj2SgjBpPfhbJFlhxnN3DhYYW75fL5W0ZdCkwYPEQ/0MbqA3BdurjttWaKBqfwWHBCaJ887dx/ADHZ/cqBCanAgbhs36YwRiEcevaQtU9D//gCvdcQiNxTm/eFGlkIfBodEz7lvbrNc45GiToNRodxRQgYL8Z5yXc8Jj7AmNThFY49x1g8o3h1GPvKlU+6GLfQhKSELGYtadE06VItNNIeZR3QXdeiNX/SoGAEOLcx3VzmWCXwPR+MMzA8A7Qf61WD2f2nDLAycbHjd9w44HL5H3u6RqYfAcEHV+1DXqmvbxO5pkBhv7DwWBRl9KlF3cNbEsZW/ODbSu2wPaqdLG3bE3oAzjdy1kPzALW5xgF71DnJBry0djaZ/oA1pp0RHmzfVutt8DY6OSTnnatzn2pdFatU+/LBv5OAUJ+k9eKy+OGviRsGeGt1ipg6+z6AnXOJOE8eGof6Q9YpYi+22d+DrifiKgv4KLto4DTDELWhNeKyvOGPoG1G8sPsVXJ64oNsHa68evEd86vS7/A2rdOgqCXCZxEGH2Fgn1KOAkZE+1VEk7P4PLA2XO7Fj7WL3CSyNBn8ctU6bzYfaSpffHhjSmDVKaDXCWsHQd+UpeYq5pvfruac3jrR+/Ej67wydFmAm/KEZdCuwBnc1T6SHGdi31fGt/rMDGo42EF3pRTKoWuA87CtktE5N9lgKlEubeiYjRcyzc+K5k84wJdBRwSNg155RO2hSrM28EDKu/8deKRdAldBhwS1vYg7VSPDazyQHWJbNeFqJJ0EXBo2Oxxm24LKwGgs5WuNRoX8DLoPHAXsKamrCIlaO0vSfbVTvFsQyn7Bhew6mNhm0HcGjIbuAtYmk+SbqYykR3y5pJ4OusROojIS5oMpF55cZ6WR9pZ4/yip8WEbK0pl6bVJZaqUoWvxG1ojKEtJsKYBDxkDjwtFe0WEwoS8dWlCl9gY0SUYYRkGSTbCax+T3mpqKDUos9ks9kzSew2sNY5/Tegf+9Csnrvbr1GdBVtonypqKSYpg0NkthzHNhvQ4DaY4xG4/+wbf6N45VqSwx16QL+kLoVSktFhcAmEKDOudoCc6jJhhjHLuCXJSNLq3euBeYQEw0xhmsBvxSYJpErMFdGQCEm7TtGVjjVBfxKYNuyNmkN8p24z3N2S5VL1aQW2BgCZP74oUus6zNp32dsyRbVgovGrQXWpl5ZPwvar8/RF6zoObvf0xWWxnECts5Qc1ypf2nc5xgCON/v6aLG9nsbAWtDlvY5Yl+jh5mhlbefLh/dhM6udG+2X79nY2Ct4mmfo1491eDp3cNcJ/mC3mzvfk8v4GRfFzVvSzmYrVb/3NVB1P1/Ul3G9k4gUfqsYKKWFb0nbZvQvYGTCZvmU1IzuKJG3mgMwyTxrQJ927D55Nr6ZD4QOUVcAcBtTzahPuHvtyF6s1sD2+DIS19gT+MbiPyHGurTHUqzqp5makrDf6g719Si1ccd2JfZi4J3fByC7SJmrotWpznBgO0XaV98gKZUTp/xJN3rdXNRksQizAGKBRHzUJD2izsBLiIjjwh7UgX+WmXFoxADk1x/Xvt+tOGwiplbegNuOrGu7v8BEbL8eSr8LDEAAAAASUVORK5CYII= alt="download">'),j.push('<img style="margin: 2px 133px 2px 0px" src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAB51JREFUaEPtW91V20gU1sje5yQVhK0AY3iPUwGkgiUVhFQQqCBQQZwKAhXEvIPtrSDeCgLPizX7ffPjGY1lz0iWDQ+rc3zg6Gd0v/s/916JbItHr3d0nOdZj6+QMhuYV70WYnFuinMPPI9zI/4timw6nd7dbIss0ebCvV5vL8s67wDyBBDw2+SQ1wB/nWXzW3BgtslK/rOtAIYkB5DQF/ysFNU7pJR/CyFAtJKckmCWPT0AACWbgUGQfvc1/weT1LN45gTP7PtEQjtG+F1A8maN5vA3ArwMVD5q4iRAFtfApdS17gE+gAk5geNHRohXmhlc++mzZVjddXl/I8BU3TzvfMHjp/ql8hH/X47Hd+dNiIg90+8fYV15ZoHj/2FRzCHx+qpeG3Cvd0iufwP3IQUNtCieLptKMwbWXqfU87wL0BkYrVT/ARL/OJ3eK5NJPWoBBthPeS4uzQtvpJyfNeFyKnFV91G7hOhcguHHvF4UEjTcX6WumQy43z/85lS4+DwejxXw5zr6/T6knX81JjUcj+8/ptASBUxVEqL7U8dO+Qhve1pXjVIIaXIPzQvefUjbhnpP4dDex0xrLWAfLGzmH6jwySYesgmo2DMMbVDxa6j4W4KeTO4O1j2zFrBVYwO2F+NejLhtXdeC6UwJmh58nXqvBOxshGo8H7w0yYbMo6QRKkc6dK32MZWAtW2IH8YLfngpNhvTkBS6lwAbtz/RcXb33thmb1BN2CZpsBmWHILx32OgrWbqOD0/CMPmEuCDg8MhXvQXHriZTO433ADEyHPXdWLRYehb+U7E3CRtAwY6sWNg+A4Mpz4VJcDkLtz8Tx1+5nRSs3SSm98Zhj68/7woCmZQDzYkciMCidGXRPNznfp2f2mTfKKU1WaFRwnwwcER4+0A5y+2lRdXscXTKoJi6JsFIXEBlnaKNd7Gsiudf2dfuOFAqHq/BDiQ7l4KJ5vLtKTKldIA8+FHsp4v2V6vf5rnOdR+WXIhLcZEoKHiFZIlJCR6a7mQ8HNJ10mibG84Lw2wN2S+D5bnq+wzBF0lZQXY6bx8RNBWnnFXh1XnMCJYwDAt4YM1RYV9qOotVJXmt/ZA8gSbp5Sf/qSpGMBaVXbtmUmpBQwnha3eeGipt4B9NJSqlGJIx5qSRpr1lce26yvA1o2HL41xr43rVu2wVslRwsRGsOF37h3yCtp3ZpMLShohBxua9YfVDitMBTi0l9gibV03iT8iQ3qSAxVFBshYnZYUmcLBb9JM84B96DQylWPbAJvigPheZ8sqT0iOJNBgbiz2mbiIVSrVFrCqdXzJpoIFnSztnHO9uqbnY/QAp6nIpoyIgXUpJt8kkCFJxOKMefVeE7DGZMkoMuxCWOfgB+dNQa16PgWsq66EqzTfptqkiqFsZ4DrgNXZlbxEqNyD+s6gxKNN8voA8OEvqosNzNuQbn2waZuEVFp1caA7YeymDasUji47dYE69z03WEurxblVwC8FrHFcSrCw4cMZi19tq/RLAutUGs29Nrw0Nx+mTToAE7H5EKgRyzNmUFVxdtVet46p1Lm3VS8N22D1nz2fpeMlgCVRJcDITdEyEZ9Sc1OLKqxBMTkXQo6KQsx0r1c8hFWTXUvWc1gu8WiaWrokPi0heC6wxmE5wG7zEG9TOOnaunVase85wZJmWy5SmwffZcNTq3JKzCHY/XOqGXhl0+TKY4yG1OtL20PNAV3HTd2F+PtnFdsW3UVNRlgpdJEgra6cCiblvsoCQHgytpAPeFWy72duTf1EjI6U66EwS0U8tidQNnkTW8gCVrlpUEqtSlWbRoIYHSnXAfg384FSEc8Ytq0hRYvwzob1aJLtCPjVRV/CuN9sUFx9OIXYTe/xyrSLCudiw+CCs2pCsaS50nl5JlAJFmxQBTftEPVoAnvM0J69TUGkPq8jQ4eMhnQrCvF1pUwgcHLo6JWL5H52Ve4U7NZhVUlXOVifY16SXdlqrOKua9Eo78w5iw+YrtuHbSOX1tN1qd4/VXqx+5KbaVrKul0K8q+hliB+/VGepgnvZWLCsSJXYI+t18Z1mwVG26V8meZOB8Wz9aMDZc3grKU8xTOYoWLRTcB7FxgO1SrfBojUNYJRjaWW7/8jD5aTwegA558WTeVUbu/yvtQuxto6lteonpl5iZ2qZyrDTAjiXMperLAfLdzZNgUWImjMWLwsSRvJ/jBgow22KGDDPWRhAj3ZZhOsqZKqe58/2Zs6AxIFbIlw4ar+BGtdICn3B5O9S9M6q9ZIBswFgglWhJ05p9NnKQS2dY8Jm6ij2fGmej2xWoB1nHYTrAYERoyerrYdb81GHrU33UFsOtlbG7BNTpCYn+uMTE+n439+AnDRliT9ddgqtWVf8z6MPszPm2hXI8CWGO0hu5hO16MJGniGyqX6/OamqdQpTdS5+c3TCb938kYQb5GrI1VtHik2AuyAq894IHF/JkNvJnBOfZOAdHOk//77aAnWDPtDfbGClHSgr2f8pqI0u8E2J36Q6DN/xhOqr+5A5JQIP8FR3yQ0PVjnxg/M2qxVGr6/FQmvAmVKwEpa7lM8iY25/hCLsZMFey1h+ymehALU+1KlDlP/Axl/TQ2HYDZNAAAAAElFTkSuQmCC alt="install">'),j.push('<img src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAACBBJREFUaEPNW7tuG0cU3VkynQHbVdJF/gJTtLsEsIw06SQB7i0XqW1/gekuqSL3AUx/gaUvMAUknUXRboRUpj8gsNQEBkLu5Jx57ItLzswO9ViAEMXdmbln7p37XpFc4NXr3d9O06THJaRMtsxSt4TIf5vgtzP+jt9G/JtlyWQyeX94UWSJdU7c6/U2kqTzACB3AAGfmEseAPxBksyPsAPTmJnKY9cCGJzcAode4GO5qNaQUn4QQoBoxTnFwSSZnQEAOZtgg8D97i1+xyapsRizgzF3y0RCOkb4vATnzRzt4UcBXgQqzzVxEiCzA+BS4hp6YR+wCSmB48ONEDf1ZnDu2XO7YaHz8vlWgCm6adp5geF7elF5ju/74/H7QRsiXGP6/fuYVz6zwPF9mGVzcDxc1IMB93r3uOuvsfvgggaaZbP9ttx0gbX3yfU07QJ0go1Won8Gjj+ZTI7VkfG9ggAD7NM0FftmwUMp58/a7LIvcU3PUbqE6Oxjw7d5P8skaDh+5TunN+B+/97rQoSz5+PxWAG/qqvf74Pb6e/mSA3H4+MnPrQ4AVOUhOi+07ZTnkPb7oWKkQ8hbZ7h8YJ2H/JsQ7wnUGgPXUdrJeAyWJyZzxDhnRgN2QaUawxNG0T8ACL+PUGfnLzfXDVmJWArxgZsz7V7LuIu6r5mTGdC0NTgq8R7KeDijFCM51vXjbP1zSOnYSpH2nQt1zGNgPXZEG+NFty9LmfWJSE+dC8ANmr/RNvZMG1sRItjN1zE2fs4LvmjUIzwn+ewre08NE5kJVPb6flm3WwuAN7cvDcEwY8x4PDk5DgoAKCrCa35zhds03O+2nbVGsBAJbYNDG+AYa/8bAVwQbA6t1RS0xDi7XgQfQRtueUzVruNyQsQ9xv+/szAIRa0dn27n/SRnJHLKljhVQG8uXmf9paEvmzjF8cA5pp0UaFtR+sAXWxkMsLmP1wAXOPuRptzFAuYm2z0QA7aZVeXSZH2vTuQUHETzhIcEh1a5hyO5S4niwMsh1KmQ84jZXYDkvYHvn4npciJ9Tki5WeauKwAFzIvz2G0VUDe5tK2sHsSdobLPvHiqrPZ7JePHycE3+qC84SYnFye3aFOMoD7e2mavm6jmetUYAGEi8nI13YbMzgAURvVuSQ3/sbXr//+dHp6+rkVWgyyGjvLMpi78VABrv/oM7nOSnSZv1JJusu6mORDmuiDrwXp9arMVIAh68r6g+23fZRVNQlwWVCLdbRTIZHqGQ9dq5vEwRc+B6UohHXHmHCDkfbiFiTiE70pBhX0jiCOrXJXLmIX78tb0A/MdSEyUp4Uz6VzbdDLwOIukgW7wmoyTO5le61iYmxMBWcU3mMjIW98RS0cbDECAKYEXTY3q+YrYywB9vOby6YHATd2u0NuK80esusxgKkYIVVPfX39CmDYXxj55IHvblUBZ0Ot3ZMjwEWuyX/X4wBrd9RfKrWPTzpFHGC5zzCSnCUAcrruu8YAWzY2/BhWAGsFZA2zi8C6N2WjKz1OvsK5Zir1Qq9wwLlDNOEZViaJKtuHyib3UdeUElbBpj5zxD4TCpjrWZxrARwLIHR8FOBCxWtf07W4K0AwGQdVC4q9YDdReFtMsocCLnx8FPdilFY9yC9sdCzUYnyT9QgHvCYtvQjYTkwPTAxjYEPz7y0zc1GAQ414IdJyClf0ThmUS9xDNmCV5OEeEoVJz9d3WOJp+bmWWuPpGFOXLQUTZsoOI3BHPMxqovwLZ+9HXRX4Jug8S/nfOXNQ8PH/xFw/sFgmRKpyUuA6shgSiUVdpvU1pRXARfDgLlNYDpUmqDCNGVfsPAn7B5mKR20zmIxdUSj7FeO/tXMuSoe/zS8kAsFD2Ub5hocco8VX7gBYHmFpDqio5G/0ZiAD2aHPG5hBUVEQuKrqRZyLbRN5RCSEnAQmGFhXLsJDEt8mAdB0Hi/rDIfogsYEQP3HkAmvQmmF0NeY4rFJPAYB0Ly3QyZcBhihI8USee4wkdYhptiFLhiERHHLaAbgLyaoKZJ4Wqx1mIivXokAl0gTcFHNC9lCVj1U90404FKaNq+E5AFDyb56p07qMK7TGTYJfZWcaEzEr4PL1wlwE3eJsVZMs3Fjc6nRJZjXBbB3Mc2YKFUuhftwgGB+1wWyqrR01Q6KZwrHYS9k7OKzGelgYqJS/fOZE54givkCPoKjXKodCtVlB1dudevACq2oUqI+hLmeYRoYVmPD9Vz5fq1VY6Hku/aWB71hKXY3DSqm10EJkaEbQPVrQlr8rlYtD3bqWusA+5/yorLf8pf7lGlfMnY/sKnFklpqf5iafglnlv9yYerVyr0lTee2TJMzcWfLFFREAI2OnuvFacPZt6b04ywXOQFXK/LtOlgviuvloh5rY2AI+8lWSqETcF28+X9oB+tFAK519i506yxb0xswJ6h1sLKnit3p3lp0HcCN2UQXrX2nwq8mZtcOAqwVRNHBaiYZwDl45RKlWLCmzosCWjLQc7Xr7A0GbLQim7QRzdAj01VDfOcrAC9jgTWNh1/MPi6Em3mV8g3O66CNdLUCbInSGrKL3ioVVhrgyci8fnPYluu6naLDd57gwCR4Y8YCTY4YdsZYiijABXD1Go+KX8scYked7hDgZoiR/quzkkZS8qwmclVb+j4r/NW+EZY58QFHr/g1nrr46aJaSo6wLUG9k9D2YkcRPtisDB1B61OMa+HwMlDGt1VZzeJVPIlmbh1c0Hba/pDiVTwJfGFvqoRs6v/IOTkNXX2kbQAAAABJRU5ErkJggg== alt="scan">'),j.push('<div><span class="dynamsoft-dwt-installdlg-text" style="right: 160px">Download</span>'),j.push('<span class="dynamsoft-dwt-installdlg-text" style="right: 18px">Install</span>'),j.push('<span class="dynamsoft-dwt-installdlg-text" style="left: 140px">Scan</span>'),j.push("</div>"),j.push("</div>"),m&&Q&&(j.push('<div style="margin:10px 0 0 60px;">'),j.push('<div id="dwt-install-url-div">'),Ie.navInfo.bArm64||Ie.navInfo.bMips64||Ie.navInfoSync.bChromeOS||Ie.navInfoSync.bHarmonyOS||(j.push('<div><input id="dwt-install-url-deb" name="dwt-install-url" type="radio" onclick="Dynamsoft._dwt_change_install_url(\''+g.deb+'\')" checked="checked" /><label for="dwt-install-url-deb">64 bit .deb (For Ubuntu/Debian)</label></div>'),j.push('<div><input id="dwt-install-url-rpm" name="dwt-install-url" type="radio" onclick="Dynamsoft._dwt_change_install_url(\''+g.rpm+'\')" /><label for="dwt-install-url-rpm">64 bit .rpm (For Fedora)</label></div>')),j.push("</div></div>")),j.push('<div><a id="dwt-btn-install" target="_blank" href="'),j.push(g.default),j.push('"'),j.push(m?' html5="1"':' html5="0"'),j.push(' onclick="Dynamsoft._dcp_dwt_onclickDownloadButton()"><div class="dynamsoft-dwt-dlg-button">Download</div></a></div>'),m?_?(j.push('<div class="dynamsoft-dwt-dlg-tail" style="text-align:left; padding-left: 80px">'),j.push("If you still see the dialog after installing the Dynamsoft Service, please<br />"),j.push("1. Add the website to the zone of trusted sites.<br />"),j.push("IE | Tools | Internet Options | Security | Trusted Sites.<br />"),j.push("2. Refresh your browser."),j.push("</div>")):Q?(j.push('<div class="dynamsoft-dwt-dlg-tail">'),j.push('<div class="dynamsoft-dwt-dlg-red">After the installation, please <strong>'+J+"</strong>  your browser.</div>"),j.push("</div>")):j.push("<div><br /></div>"):(j.push('<div class="dynamsoft-dwt-dlg-tail" style="text-align:left; padding-left: 80px">'),j.push("After the installation, please<br />"),j.push("1. Restart the browser<br />"),j.push('2. Allow "DynamicWebTWAIN" add-on to run by right clicking on the Information Bar in the browser.'),j.push("</div>")),O.DWT.ShowMessage(j.join(""),{width:620,headerStyle:1})):console.log("The Dynamsoft namespace is missing"),Ie.DWT&&Ie.DWT.OnWebTwainNotFound&&Ie.DWT.OnWebTwainNotFound()},Ie._dwt_change_install_url=function(f){var g=document.getElementById("dwt-btn-install");g&&(g.href=f)};var u=0;Ie._dcp_dwt_onclickDownloadButton=function(){var f=document.getElementById("dwt-install-url-div");f&&(f.style.display="none");var g=document.getElementById("dwt-btn-install");if(g)if("1"==g.getAttribute("html5")){var m=g.parentNode,v=document.createElement("div");v.id="dwt-btn-install",v.style.textAlign="center",v.style.paddingBottom="15px",v.style.fontSize="14px",v.innerHTML='Please proceed with the installation. Once done, <a href="javascript:void(0)" onclick="Dynamsoft._dcp_dwt_onclickInstallButton()">click here to verify completion.</a>',v.setAttribute("html5","1"),m.removeChild(g),m.appendChild(v)}else(m=g.parentNode).removeChild(g);return!0},Ie._dcp_dwt_onclickInstallButton=function(){var f=document.getElementById("dwt-install-url-div");f&&(f.style.display="none");var g=Ie.Lib.one(".dynamsoft-dwt-dlg-title");g&&g.style("display","");var m=Ie.Lib.one(".dynamsoft-dwt-dlg-title-error");m&&m.style("display","none");var v=document.getElementById("dwt-btn-install");return v&&setTimeout(function(){if("1"==v.getAttribute("html5")){var _=v.parentNode,b=document.createElement("div");b.id="dwt-btn-install",b.style.textAlign="center",b.style.paddingBottom="15px",b.style.fontSize="14px",b.innerHTML="Connecting to the service...",b.setAttribute("html5","1"),_.removeChild(v),_.appendChild(b),u=new Date,setTimeout(Ie._dwt_Reconnect,10)}else(_=v.parentNode).removeChild(v)},10),!0},Ie._dwt_Reconnect=function(){var f=Ie;if((new Date-u)/1e3>10){var g=document.getElementById("dwt-btn-install");g&&(g.innerHTML='Please make sure your installation is successful. <a href="javascript:void(0)" onclick="Dynamsoft._dcp_dwt_onclickInstallButton()">Click here to try reconnecting</a>.');var m=Ie.Lib.one(".dynamsoft-dwt-dlg-title");m&&m.style("display","none");var v=Ie.Lib.one(".dynamsoft-dwt-dlg-title-error");v&&(v.html("Failed to connect to the service!"),v.style("display",""))}else if(f.DWT){var _=500;navigator.userAgent.indexOf("Safari")>-1&&(_=2e3),f.DWT.CheckConnectToTheService(function(){Ie.DWT.CloseDialog(),Ie.DWT.ConnectToTheService()},function(){Ie.DWT.NeedCheckWebTwainBySocket()?Ie.DWT.CheckWebTwainBySocket(function(){Ie.OnHTTPCorsError()},function(){setTimeout(Ie._dwt_Reconnect,_)},function(){setTimeout(Ie._dwt_Reconnect,_)}):setTimeout(Ie._dwt_Reconnect,_)})}else console.log("The Dynamsoft namespace is missing")},Ie._show_android_install_dialog=function(f,g){var m;if(Ie.DWT.bNpm&&Ie.navInfoSync.bFileSystem)return Ie._show_online_download_dialog(f,bHTML5,iPlatform);m=[],Ie.DWT?(m.push('<div class="ds-dwt-ui-dlg-android">'),m.push("<div>Please download and "),m.push(g?"update":"install"),m.push(" the <strong>DYNAMSOFT SERVICE</strong> app via the </div>"),m.push('<div><a target="_blank" href="'),m.push(f.default),m.push('" onclick="Dynamsoft._dwt_ReconnectForAndroid()">direct APK download link</a>.</div>'),m.push("</div>"),m.push('<div class="dynamsoft-dwt-dlg-tail" style="text-align:left">'),m.push("If you have "),m.push(g?"updated":"installed"),m.push(" it, please click on the button below to initiate the connection."),m.push('<a target="_blank" href="'),m.push(f.openService),m.push('" onclick="Dynamsoft._dwt_ReconnectForAndroid()"><div class="dynamsoft-dwt-dlg-button-android">Open Service</div></a>'),m.push("</div>"),m.push("</div>"),Ie.DWT.ShowMessage(m.join(""),{width:335,headerStyle:1,backgroundStyle:1})):console.log("The Dynamsoft namespace is missing"),Ie.DWT&&Ie.DWT.OnWebTwainNotFound&&Ie.DWT.OnWebTwainNotFound()},Ie._dwt_ReconnectForAndroid=function(){Ie.DWT.CheckConnectToTheService(function(f){f?(Ie.DWT.CloseDialog(),Ie.DWT.ConnectToTheService()):setTimeout(Ie._dwt_ReconnectForAndroid,500)},function(){setTimeout(Ie._dwt_ReconnectForAndroid,500)})},Ie.OnWebTwainNeedUpgradeCallback=function(f,g,m,v,_,b,S,I){Ie._show_install_dialog(f,g,m,v,_,b,S,I,!0,!0)},Ie.OnWebTwainNeedUpgradeOnAndroidCallback=function(f,g,m){Ie.OnWebTwainNotFoundOnAndroidCallback(f,g,m,!0)},Ie.OnLTSLicenseError=function(f,g){var m="";(-2440==g||-2441==g||-2443==g||-2446==g||f.indexOf("Internet connection")>-1||f.indexOf("Storage")>-1)&&(m='<div>You can register for a free 30-day trial <a href="https://www.dynamsoft.com/customer/license/trialLicense?product=dwt&deploymenttype=js" target="_blank" class="dynamsoft-major-color">here</a>. Make sure to select the product Dynamic Web TWAIN.</div>'),Ie.DWT.ShowMessage([f,m].join(""),{width:l,headerStyle:2})},Ie.OnLTSConnectionWarning=function(){var f=["Warning: You are seeing this dialog because Dynamic Web TWAIN has failed to connect to the License Tracking Server. ","A cached authorization is being used, and you can continue to use the software as usual. ","Please get connected to the network as soon as possible. ",Ie.DWT.isPublicLicense()?'<a class="dynamsoft-major-color" href="https://www.dynamsoft.com/company/contact/">Contact Dynamsoft</a> ':"Contact the site administrator ","for more information."].join("");Ie.DWT.ShowMessage(f,{width:l,caption:"Warning",headerStyle:2})},Ie.OnLTSPublicLicenseWarning=function(f){Ie.DWT.ShowMessage(f,{width:l,caption:"Warning",headerStyle:2})},Ie.OnLicenseExpiredWarning=function(f,g,m){var v,_,b='<a target="_blank" href="https://www.dynamsoft.com/store/dynamic-web-twain/#DynamicWebTWAIN">online store</a>',S="https://www.dynamsoft.com/customer/license/trialLicense?product=dwt&utm_source=in-product";g>5||!m||(g>0?(_="Warning",v=['<div style="padding:0 0 10px 0">Kindly note your trial key is expiring in ',g<=1?"1 day":parseInt(g)+" days",". Two quick steps to extend your trial:</div>",'<div style="margin:0 0 0 10px">1. <a target="_blank" href="',S,'">Request a new trial key</a> and follow the instructions to set the new key</div>','<div style="margin:0 0 0 10px">2. Refresh your scan page and try again</div>','<div style="padding:0">If you are ready to purchase a full license, please go to the ',b,".</div>"].join("")):v=['<div style="padding:0">Sorry. Your product key has expired on ',f,". You can purchase a full license at the ",b,".</div>",'<div style="padding:0">Or, you can try requesting a new product key at <a target="_blank" href="',S,'">this page</a>.</div>'].join(""),v&&Ie.DWT.ShowMessage(v,{width:l,caption:_,headerStyle:2}))},Ie.OnLicenseError=Ie.OnLicenseError||function(f,g){Ie.DWT.ShowMessage(f,{width:l,headerStyle:2})},Ie.OnCorsConfigError=function(f){var g=[f," Please contact the Administrator to configure 'Access-Control-Allow-Origin'."].join("");Ie.DWT.ShowMessage(g,{width:l,headerStyle:2})},Ie._show_online_download_dialog=function(f,g,m){var I,k,O,_=Ie.DWT.JSVersion.split(","),b=_[0]+"."+_[1],S=location.pathname;S=S.substring(0,S.lastIndexOf("/")+1),m==Ie.DWT.EnumDWT_PlatformType.enumLinux&&(arm64||mips64)&&(arm64?f.default=getDebPath("arm64"):mips64&&(f.default=getDebPath("mips64el"))),I=["https://www.dynamsoft.com/web-twain/install-dynamsoft-service/?productId=1000001","&downloadLink=https://demo.dynamsoft.com/DWT/Resources/dist/DynamsoftServiceSetup_",b,".",O=f.default.substr(f.default.length-3)].join(""),k=Ie.Lib.Path.normalize([S,f.default].join("")),m==Ie.DWT.EnumDWT_PlatformType.enumWindow&&0==k.indexOf("/")&&(k=k.substr(1)),Ie.DWT.ShowMessage(['<div class="dynamsoft-dwt-ltsdlg-body" style="padding:0 20px 20px 20px">',"<div>To support document scanning, please complete one-time installation of the DynamsoftServiceSetup.",O," on this machine.</div>","<div>You can download the file via this trust site:</div>",'<div><a id="dwt-btn-install" target="_blank" href="',I,'"><div class="dynamsoft-dwt-dlg-button">Open Site</div></a></div>','<div style="word-break: break-word;">Or, go to <br />',k," if the file exists.</div>","<div>After the installation, please <strong>REFRESH</strong>  your browser.<br /></div>","</div>"].join(""),{width:620,headerStyle:1,closeButton:!1})}}(),Ie.DWT.AutoLoad=!1,Ie.DWT.IfAddMD5InUploadHeader=!1,Ie.DWT.IfConfineMaskWithinTheViewer=!1;const Io=Ie;let r4e=(()=>{class p{constructor(){this.showDiv=!1}getShowDiv(){return this.showDiv}setShowDiv(u){this.showDiv=u}toggleShowDiv(){this.showDiv=!this.showDiv}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=ur({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();function o4e(p,l){1&p&&(Kt(0,"div",5),dr(1,"div",6),zt())}const s4e=function(){return["/barcode-reader"]};function a4e(p,l){if(1&p&&(Kt(0,"a",9),Nn(1),zt()),2&p){const u=Tu().$implicit;Dr("title",u.name+" details")("routerLink",Ad(3,s4e)),to(1),Ac("> ",u.name," ")}}const l4e=function(){return["/barcode-scanner"]};function c4e(p,l){if(1&p&&(Kt(0,"a",9),Nn(1),zt()),2&p){const u=Tu().$implicit;Dr("title",u.name+" details")("routerLink",Ad(3,l4e)),to(1),Ac("> ",u.name," ")}}const u4e=function(){return["/file-detection"]};function d4e(p,l){if(1&p&&(Kt(0,"a",9),Nn(1),zt()),2&p){const u=Tu().$implicit;Dr("title",u.name+" details")("routerLink",Ad(3,u4e)),to(1),Ac("> ",u.name," ")}}const h4e=function(){return["/camera-detection"]};function f4e(p,l){if(1&p&&(Kt(0,"a",9),Nn(1),zt()),2&p){const u=Tu().$implicit;Dr("title",u.name+" details")("routerLink",Ad(3,h4e)),to(1),Ac("> ",u.name," ")}}const p4e=function(){return["/mrz-reader"]};function g4e(p,l){if(1&p&&(Kt(0,"a",9),Nn(1),zt()),2&p){const u=Tu().$implicit;Dr("title",u.name+" details")("routerLink",Ad(3,p4e)),to(1),Ac("> ",u.name," ")}}const m4e=function(){return["/mrz-scanner"]};function v4e(p,l){if(1&p&&(Kt(0,"a",9),Nn(1),zt()),2&p){const u=Tu().$implicit;Dr("title",u.name+" details")("routerLink",Ad(3,m4e)),to(1),Ac("> ",u.name," ")}}const y4e=function(){return["/document-viewer"]};function _4e(p,l){if(1&p&&(Kt(0,"a",9),Nn(1),zt()),2&p){const u=Tu().$implicit;Dr("title",u.name+" details")("routerLink",Ad(3,y4e)),to(1),Ac("> ",u.name," ")}}const C4e=function(){return["/acquire-image"]};function b4e(p,l){if(1&p&&(Kt(0,"a",9),Nn(1),zt()),2&p){const u=Tu().$implicit;Dr("title",u.name+" details")("routerLink",Ad(3,C4e)),to(1),Ac("> ",u.name," ")}}const x4e=function(){return["/image-editor"]};function w4e(p,l){if(1&p&&(Kt(0,"a",9),Nn(1),zt()),2&p){const u=Tu().$implicit;Dr("title",u.name+" details")("routerLink",Ad(3,x4e)),to(1),Ac("> ",u.name," ")}}function S4e(p,l){if(1&p&&(Kt(0,"p"),Nn(1),zt()),2&p){const u=Tu().$implicit;to(1),Ac("Description: ",u.description,"")}}function T4e(p,l){if(1&p&&(Kt(0,"div")(1,"h3")(2,"div"),rl(3,a4e,2,4,"ng-template",8),zt(),Kt(4,"div"),rl(5,c4e,2,4,"ng-template",8),zt(),Kt(6,"div"),rl(7,d4e,2,4,"ng-template",8),zt(),Kt(8,"div"),rl(9,f4e,2,4,"ng-template",8),zt(),Kt(10,"div"),rl(11,g4e,2,4,"ng-template",8),zt(),Kt(12,"div"),rl(13,v4e,2,4,"ng-template",8),zt(),Kt(14,"div"),rl(15,_4e,2,4,"ng-template",8),zt(),Kt(16,"div"),rl(17,b4e,2,4,"ng-template",8),zt(),Kt(18,"div"),rl(19,w4e,2,4,"ng-template",8),zt()(),rl(20,S4e,2,1,"p",4),zt()),2&p){const u=l.$implicit;to(3),Dr("ngIf","reader"===u.id),to(2),Dr("ngIf","scanner"===u.id),to(2),Dr("ngIf","file-detection"===u.id),to(2),Dr("ngIf","camera-detection"===u.id),to(2),Dr("ngIf","mrz-reader"===u.id),to(2),Dr("ngIf","mrz-scanner"===u.id),to(2),Dr("ngIf","document-viewer"===u.id),to(2),Dr("ngIf","acquire-image"===u.id),to(2),Dr("ngIf","image-editor"===u.id),to(1),Dr("ngIf",u.description)}}function I4e(p,l){if(1&p&&(Kt(0,"div")(1,"h2"),Nn(2,"Examples"),zt(),rl(3,T4e,21,10,"div",7),zt()),2&p){const u=Tu();to(3),Dr("ngForOf",u.products)}}let E4e=(()=>{class p{constructor(u){this.sharedService=u,this.isLoading=!1,this.products=$Te,this.inputText="",this.processedText="",this.placeholderText="DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAxLTE2NDk4Mjk3OTI2MzUiLCJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSIsInNlc3Npb25QYXNzd29yZCI6IndTcGR6Vm05WDJrcEQ5YUoifQ=="}activate(){var u=this;return Fe(function*(){u.isLoading=!0,u.processedText=u.inputText.toUpperCase(),Yr.engineResourcePaths={std:jc("assets/dynamsoft-capture-vision-std/"),dip:jc("assets/dynamsoft-image-processing/"),core:jc("assets/dynamsoft-core/"),license:jc("assets/dynamsoft-license/"),cvr:jc("assets/dynamsoft-capture-vision-router/"),dbr:jc("assets/dynamsoft-barcode-reader/"),dce:jc("assets/dynamsoft-camera-enhancer/"),ddn:jc("assets/dynamsoft-document-normalizer/"),dlr:jc("assets/dynamsoft-label-recognizer/"),dcp:jc("assets/dynamsoft-code-parser/"),dnn:jc("assets/dynamsoft-capture-vision-dnn/"),dlrData:jc("assets/dynamsoft-label-recognizer-data/")};try{let f=""===u.inputText?u.placeholderText:u.inputText;yield ro.initLicense(f,!0),Ip.Core.engineResourcePath=jc("assets/dynamsoft-document-viewer/engine/"),yield Ip.Core.init(),Ip.setProcessingHandler("imageFilter",new Ip.ImageFilter),u.toggleDivVisibility(),Io.DWT.ProductKey=f,Io.DWT.ResourcesPath="assets/dynamic-web-twain",Io.DWT.UseLocalService=!0}catch(f){console.log(f)}u.isLoading=!1})()}toggleDivVisibility(){this.sharedService.toggleShowDiv()}get showDiv(){return this.sharedService.getShowDiv()}}return p.\u0275fac=function(u){return new(u||p)(qt(r4e))},p.\u0275cmp=Sl({type:p,selectors:[["app-product-list"]],decls:10,vars:4,consts:[["id","loading-indicator","class","loading-indicator",4,"ngIf"],["href","https://www.dynamsoft.com/customer/license/trialLicense/?product=dcv&package=cross-platform","target","_blank"],["type","text",3,"ngModel","placeholder","ngModelChange"],[3,"click"],[4,"ngIf"],["id","loading-indicator",1,"loading-indicator"],[1,"spinner"],[4,"ngFor","ngForOf"],[3,"ngIf"],[3,"title","routerLink"]],template:function(u,f){1&u&&(rl(0,o4e,2,0,"div",0),Kt(1,"div")(2,"div"),Nn(3," Get a License key from "),Kt(4,"a",1),Nn(5,"here"),zt()(),Kt(6,"input",2),oi("ngModelChange",function(m){return f.inputText=m}),zt(),Kt(7,"button",3),oi("click",function(){return f.activate()}),Nn(8,"Activate SDK"),zt()(),rl(9,I4e,4,1,"div",4)),2&u&&(Dr("ngIf",f.isLoading),to(6),Dr("ngModel",f.inputText)("placeholder",f.placeholderText),to(3),Dr("ngIf",f.showDiv))},directives:[AT,OT,hX,g4,_Y,Mb],styles:[""]}),p})();class a1{initOverlay(l){this.overlay=l,this.context=this.overlay.getContext("2d")}updateOverlay(l,u){this.overlay&&(this.overlay.width=l,this.overlay.height=u,this.clearOverlay())}clearOverlay(){this.context&&this.overlay&&(this.context.clearRect(0,0,this.overlay.width,this.overlay.height),this.context.strokeStyle="#ff0000",this.context.lineWidth=5)}drawOverlay(l,u){if(this.context){let f=l.points;this.globalPoints=f,this.context.beginPath(),this.context.moveTo(f[0].x,f[0].y),this.context.lineTo(f[1].x,f[1].y),this.context.lineTo(f[2].x,f[2].y),this.context.lineTo(f[3].x,f[3].y),this.context.lineTo(f[0].x,f[0].y),this.context.stroke(),this.context.font="18px Verdana",this.context.fillStyle="#ff0000";let g=[f[0].x,f[1].x,f[2].x,f[3].x],m=[f[0].y,f[1].y,f[2].y,f[3].y];g.sort(function(b,S){return b-S}),m.sort(function(b,S){return S-b}),this.context.fillText(u,g[0],m[0]+50)}}setPoints(l){this.globalPoints=l,this.overlay.addEventListener("mousedown",u=>this.updatePoint(u,this.context,this.overlay)),this.overlay.addEventListener("touchstart",u=>this.updatePoint(u,this.context,this.overlay)),this.drawQuad(this.context,this.overlay)}updatePoint(l,u,f){if(!this.globalPoints)return;let g=this.globalPoints;function m(S){let I=f.getBoundingClientRect(),k=f.clientWidth/f.width,O=f.clientHeight/f.height,j=S instanceof MouseEvent?S.clientX:S.touches[0].clientX,W=S instanceof MouseEvent?S.clientY:S.touches[0].clientY;return k<O?(j-=I.left,W=W-I.top-(f.clientHeight-f.height*k)/2,j/=k,W/=k):(j=j-I.left-(f.clientWidth-f.width*O)/2,W-=I.top,j/=O,W/=O),{x:Math.round(j),y:Math.round(W)}}let _=m(l),b=this;for(let S=0;S<g.length;S++)if(Math.abs(g[S].x-_.x)<10&&Math.abs(g[S].y-_.y)<10){let I=function(O){_=m(O),g[S].x=_.x,g[S].y=_.y,b.drawQuad(u,f)},k=function(){f.removeEventListener("mousemove",I),f.removeEventListener("mouseup",k),f.removeEventListener("touchmove",I),f.removeEventListener("touchend",k)};f.addEventListener("mousemove",I),f.addEventListener("mouseup",k),f.addEventListener("touchmove",I),f.addEventListener("touchend",k);break}}drawQuad(l,u){let f=this.globalPoints;if(f&&!(f.length<4)){l.clearRect(0,0,u.width,u.height),l.strokeStyle="#00ff00",l.lineWidth=2;for(let g=0;g<f.length;g++)l.beginPath(),l.arc(f[g].x,f[g].y,5,0,2*Math.PI),l.stroke();l.beginPath(),l.moveTo(f[0].x,f[0].y),l.lineTo(f[1].x,f[1].y),l.lineTo(f[2].x,f[2].y),l.lineTo(f[3].x,f[3].y),l.lineTo(f[0].x,f[0].y),l.stroke()}}}let D4e=(()=>{class p{constructor(){this.isLoaded=!1,this.overlayManager=new a1}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){u.cvr=yield pr.createInstance(),u.isLoaded=!0})()}ngOnDestroy(){var u;try{null===(u=this.cvr)||void 0===u||u.dispose()}catch(f){}}onChange(u){let g=u.currentTarget.files;if(g){let m=g.item(0);if(m){let v=new FileReader;v.onload=_=>{let b=document.getElementById("image");if(b){b.src=_.target.result;const S=new Image;S.onload=I=>{this.overlayManager.updateOverlay(S.width,S.height),this.cvr&&this.cvr.capture(m,"ReadBarcodes_Balance").then(k=>{console.log(k);let O=[],j=document.getElementById("result");try{let J,K=k.items;if(K.length>0){for(var W=0;W<K.length;++W){if(K[W].type!==io.CRIT_BARCODE)continue;let Q=K[W];O.push(Q.text),J=Q.location,console.log(J),this.overlayManager.drawOverlay(J,Q.text)}j&&(j.innerHTML=O.join(", "))}else j&&(j.innerHTML=O.join(", "))}catch(J){alert(J)}})},S.src=_.target.result}},v.readAsDataURL(m)}}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-barcode-reader"]],decls:6,vars:0,consts:[["type","file","id","file","accept","image/*",3,"change"],["id","result"],["id","imageview"],["id","image"],["id","overlay"]],template:function(u,f){1&u&&(Kt(0,"input",0),oi("change",function(m){return f.onChange(m)}),zt(),Kt(1,"div"),dr(2,"a",1),zt(),Kt(3,"div",2),dr(4,"img",3)(5,"canvas",4),zt())},styles:["#imageview[_ngcontent-%COMP%]{position:absolute;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}"]}),p})(),A4e=(()=>{class p{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isDestroyed=!1,this.overlayManager=new a1}ngOnInit(){var u=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){yield u.initBarcodeScanner()})()}ngOnDestroy(){var u,f;this.isDestroyed=!0;try{null===(u=this.cvr)||void 0===u||u.dispose(),null===(f=this.cameraEnhancer)||void 0===f||f.dispose()}catch(g){}}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let u=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(u.width,u.height)}}initBarcodeScanner(){var u=this;return Fe(function*(){var f,g,m,v;const _=yield Yo.createInstance();u.cameraEnhancer=yield Ci.createInstance(_),u.isLoaded=!0;let b=document.getElementById("videoContainer");if(b){b.append(_.getUIElement()),null===(g=null===(f=_.getUIElement().shadowRoot)||void 0===f?void 0:f.querySelector(".dce-sel-camera"))||void 0===g||g.setAttribute("style","display: none"),null===(v=null===(m=_.getUIElement().shadowRoot)||void 0===m?void 0:m.querySelector(".dce-sel-resolution"))||void 0===v||v.setAttribute("style","display: none");let S=yield u.cameraEnhancer.getAllCameras();if(u.listCameras(S),u.cvr=yield pr.createInstance(),u.isDestroyed||(u.cvr.setInput(u.cameraEnhancer),u.cvr.addResultReceiver({onCapturedResultReceived:I=>{u.overlayManager.clearOverlay();let k=[],O=document.getElementById("result");try{let W,J=I.items;if(J.length>0){for(var j=0;j<J.length;++j){if(J[j].type!==io.CRIT_BARCODE)continue;let K=J[j];k.push(K.text),W=K.location,console.log(W),u.overlayManager.drawOverlay(W,K.text)}O&&(O.innerHTML=k.join(", "))}}catch(W){alert(W)}}}),u.cvr.addResultReceiver({onDecodedBarcodesReceived:I=>{!I.barcodeResultItems.length||console.log(I)}}),u.cameraEnhancer.on("played",()=>{u.updateResolution()}),yield u.openCamera(),u.isDestroyed)||(yield u.cvr.startCapturing("ReadSingleBarcode"),u.isDestroyed))throw Error("VideoCapture Component Destroyed")}})()}openCamera(){var u=this;return Fe(function*(){if(u.overlayManager.clearOverlay(),u.videoSelect){let f=u.videoSelect.value;u.cameraEnhancer&&(yield u.cameraEnhancer.selectCamera(f),yield u.cameraEnhancer.open())}})()}listCameras(u){for(var f=0;f<u.length;++f){var g=u[f],m=document.createElement("option");m.value=g.deviceId,m.text=g.label,this.cameraInfo[g.deviceId]=g,this.videoSelect&&this.videoSelect.appendChild(m)}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-barcode-scanner"]],decls:8,vars:0,consts:[[1,"select"],["for","videoSource"],["id","videoSource",3,"change"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"],["id","result"]],template:function(u,f){1&u&&(Kt(0,"div",0)(1,"label",1),Nn(2,"Video source: "),zt(),Kt(3,"select",2),oi("change",function(){return f.openCamera()}),zt()(),Kt(4,"div",3),dr(5,"div",4)(6,"canvas",5),zt(),dr(7,"div",6))},styles:["#videoview[_ngcontent-%COMP%]{max-width:720px;max-height:720px;width:720px;height:720px;background-color:#eaeaea;position:relative}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}"]}),p})(),P4e=(()=>{class p{constructor(){this.isLoaded=!1,this.points=[],this.overlayManager=new a1}ngOnDestroy(){var u;try{null===(u=this.cvr)||void 0===u||u.dispose()}catch(f){}}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){u.cvr=yield pr.createInstance(),u.isLoaded=!0})()}onRadioChange(u){var f=this;if(!this.cvr)return;let g=u.target,m=Oh.ICM_COLOUR;"binary"===g.value?m=Oh.ICM_BINARY:"grayscale"===g.value?m=Oh.ICM_GRAYSCALE:"color"===g.value&&(m=Oh.ICM_COLOUR);let v=this.cvr;Fe(function*(){let _=yield v.getSimplifiedSettings("NormalizeDocument_Default");_.documentSettings.colourMode=m,yield f.cvr.updateSettings("NormalizeDocument_Default",_),f.normalize(f.currentFile,f.points)})()}normalize(u,f){var g=this;return Fe(function*(){if(g.cvr){let m=yield g.cvr.getSimplifiedSettings("NormalizeDocument_Default");m.roi.points=f,m.roiMeasuredInPercentage=!1,yield g.cvr.updateSettings("NormalizeDocument_Default",m),g.cvr.capture(u,"NormalizeDocument_Default").then(v=>{if(0===v.items.length)return;let _=v.items[0];document.getElementById("normalizedImage").src=_.toImage("image/jpeg").src})}})()}onChange(u){var f=this;let m=u.currentTarget.files;if(m){let v=m.item(0);if(v){this.currentFile=v;let _=new FileReader;_.onload=b=>{let S=document.getElementById("image");if(S){S.src=b.target.result;const I=new Image;I.onload=function(){var k=Fe(function*(O){if(f.overlayManager.updateOverlay(I.width,I.height),f.cvr){let j=yield f.cvr.capture(v,"DetectDocumentBoundaries_Default");j.items.length>0&&(f.points=j.items[0].location.points,f.overlayManager.setPoints(f.points))}});return function(O){return k.apply(this,arguments)}}(),I.src=b.target.result}},_.readAsDataURL(v)}}}rectify(){var u=this;return Fe(function*(){yield u.normalize(u.currentFile,u.points)})()}save(){return Fe(function*(){let f=document.getElementById("normalizedImage").src;const g=document.createElement("a");g.href=f,g.download=Date.now()+"",document.body.appendChild(g),g.click(),document.body.removeChild(g)})()}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-file-detection"]],decls:24,vars:2,consts:[["id","loading-status",2,"font-size","x-large",3,"hidden"],[1,"row"],["for","binary"],["type","radio","name","templates","value","binary",3,"change"],["for","grayscale"],["type","radio","name","templates","value","grayscale",3,"change"],["for","color"],["type","radio","name","templates","value","color",3,"checked","change"],["type","file","title","file","id","file","accept","image/*",3,"change"],[3,"click"],[1,"container"],["id","imageview"],["id","image","alt",""],["id","overlay",1,"overlay"],["id","resultview",1,"imageview"],["id","normalizedImage","alt",""]],template:function(u,f){1&u&&(Kt(0,"span",0),Nn(1,"Loading Library..."),zt(),dr(2,"br"),Kt(3,"div",1)(4,"label",2)(5,"input",3),oi("change",function(m){return f.onRadioChange(m)}),zt(),Nn(6,"Black & White "),zt(),Kt(7,"label",4)(8,"input",5),oi("change",function(m){return f.onRadioChange(m)}),zt(),Nn(9," Grayscale "),zt(),Kt(10,"label",6)(11,"input",7),oi("change",function(m){return f.onRadioChange(m)}),zt(),Nn(12," Color "),zt()(),Kt(13,"input",8),oi("change",function(m){return f.onChange(m)}),zt(),Kt(14,"button",9),oi("click",function(){return f.rectify()}),Nn(15,"Rectify"),zt(),Kt(16,"button",9),oi("click",function(){return f.save()}),Nn(17,"Save"),zt(),Kt(18,"div",10)(19,"div",11),dr(20,"img",12)(21,"canvas",13),zt(),Kt(22,"div",14),dr(23,"img",15),zt()()),2&u&&(Dr("hidden",f.isLoaded),to(11),Dr("checked",!0))},styles:["#imageview[_ngcontent-%COMP%]{position:relative;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}.container[_ngcontent-%COMP%]{align-items:center;border:3px solid rgb(255,255,255)}button[_ngcontent-%COMP%]{margin:4px}"]}),p})();const WL="VideoCapture Component Destroyed";let R4e=(()=>{class p{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isNormalized=!0,this.captured=[],this.isDestroyed=!1,this.points=[],this.isDetecting=!1,this.overlayManager=new a1}ngOnDestroy(){var u,f;this.isDestroyed=!0;try{null===(u=this.cvr)||void 0===u||u.dispose(),null===(f=this.cameraEnhancer)||void 0===f||f.dispose()}catch(g){}}ngOnInit(){var u=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){var f,g,m,v;u.cameraView=yield Yo.createInstance(),u.cameraEnhancer=yield Ci.createInstance(u.cameraView),u.isLoaded=!0;let _=document.getElementById("videoContainer");if(_){_.append(u.cameraView.getUIElement()),null===(g=null===(f=u.cameraView.getUIElement().shadowRoot)||void 0===f?void 0:f.querySelector(".dce-sel-camera"))||void 0===g||g.setAttribute("style","display: none"),null===(v=null===(m=u.cameraView.getUIElement().shadowRoot)||void 0===m?void 0:m.querySelector(".dce-sel-resolution"))||void 0===v||v.setAttribute("style","display: none");let b=yield u.cameraEnhancer.getAllCameras();if(u.listCameras(b),u.cvr=yield pr.createInstance(),u.isDestroyed)throw Error(WL);u.cvr.setInput(u.cameraEnhancer);let S=yield u.cvr.getSimplifiedSettings("DetectDocumentBoundaries_Default");if(S.capturedResultItemTypes|=io.CRIT_ORIGINAL_IMAGE,yield u.cvr.updateSettings("DetectDocumentBoundaries_Default",S),u.cvr.addResultReceiver({onCapturedResultReceived:I=>{u.overlayManager.clearOverlay();try{let j=I.items;if(j.length>0)for(var O=0;O<j.length;++O)if(j[O].type===io.CRIT_DETECTED_QUAD)u.detectedResult=j[O],u.points=u.detectedResult.location.points,u.overlayManager.drawOverlay(u.detectedResult.location,"");else if(j[O].type===io.CRIT_ORIGINAL_IMAGE&&!u.isNormalized){u.isNormalized=!0;let W=j[O];u.currentData=W.imageData,u.normalize(W.imageData,u.points),u.toggleDetection();break}}catch(j){throw j}}}),u.cameraEnhancer.on("played",()=>{u.updateResolution()}),yield u.openCamera(),u.isDestroyed||u.isDestroyed)throw Error(WL)}})()}openCamera(){var u=this;return Fe(function*(){if(u.overlayManager.clearOverlay(),u.videoSelect){let f=u.videoSelect.value;u.cameraEnhancer&&(yield u.cameraEnhancer.selectCamera(u.cameraInfo[f]),yield u.cameraEnhancer.open())}})()}listCameras(u){for(var f=0;f<u.length;++f){var g=u[f],m=document.createElement("option");m.value=g.deviceId,m.text=g.label,this.cameraInfo[g.deviceId]=g,this.videoSelect&&this.videoSelect.appendChild(m)}}onRadioChange(u){var f=this;if(!this.cvr)return;let g=u.target,m=Oh.ICM_COLOUR;"binary"===g.value?m=Oh.ICM_BINARY:"grayscale"===g.value?m=Oh.ICM_GRAYSCALE:"color"===g.value&&(m=Oh.ICM_COLOUR);let v=this.cvr;Fe(function*(){let _=yield v.getSimplifiedSettings("NormalizeDocument_Default");_.documentSettings.colourMode=m,yield f.cvr.updateSettings("NormalizeDocument_Default",_),f.normalize(f.currentData,f.points)})()}normalize(u,f){var g=this;return Fe(function*(){if(g.cvr){let m=yield g.cvr.getSimplifiedSettings("NormalizeDocument_Default");m.roi.points=f,m.roiMeasuredInPercentage=!1,yield g.cvr.updateSettings("NormalizeDocument_Default",m),g.cvr.capture(u,"NormalizeDocument_Default").then(v=>{if(0===v.items.length)return;let _=v.items[0],b=document.getElementById("normalizedImage");b.width=_.imageData.width,b.height=_.imageData.height;const S=b.getContext("2d");null==S||S.drawImage(_.toCanvas(),0,0)})}})()}captureDocument(){this.isNormalized=!1}toggleDetection(){var u,f,g;this.isDetecting?(this.isDetecting=!1,null===(u=this.cvr)||void 0===u||u.stopCapturing(),null===(f=this.cameraView)||void 0===f||f.clearAllInnerDrawingItems(),this.overlayManager.clearOverlay(),document.getElementById("detectButton").textContent="Start Detection"):(this.isDetecting=!0,document.getElementById("detectButton").textContent="Stop Detection",null===(g=this.cvr)||void 0===g||g.startCapturing("DetectDocumentBoundaries_Default"))}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let u=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(u.width,u.height)}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-camera-detection"]],decls:28,vars:2,consts:[["id","document-scanner"],["id","loading-status",2,"font-size","x-large",3,"hidden"],[1,"row"],["for","binary"],["type","radio","name","templates","value","binary",3,"change"],["for","grayscale"],["type","radio","name","templates","value","grayscale",3,"change"],["for","color"],["type","radio","name","templates","value","color",3,"checked","change"],["for","videoSource"],["id","videoSource",3,"change"],["id","detectButton",3,"click"],["id","captureButton",3,"click"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"],[1,"container"],["id","resultview"],["id","normalizedImage"]],template:function(u,f){1&u&&(Kt(0,"div",0)(1,"span",1),Nn(2,"Loading Library..."),zt(),dr(3,"br"),Kt(4,"div",2)(5,"label",3)(6,"input",4),oi("change",function(m){return f.onRadioChange(m)}),zt(),Nn(7,"Black & White "),zt(),Kt(8,"label",5)(9,"input",6),oi("change",function(m){return f.onRadioChange(m)}),zt(),Nn(10," Grayscale "),zt(),Kt(11,"label",7)(12,"input",8),oi("change",function(m){return f.onRadioChange(m)}),zt(),Nn(13," Color "),zt()(),Kt(14,"div")(15,"label",9),Nn(16,"Video Source: "),Kt(17,"select",10),oi("change",function(){return f.openCamera()}),zt()(),Kt(18,"button",11),oi("click",function(){return f.toggleDetection()}),Nn(19,"Start Detection"),zt(),Kt(20,"button",12),oi("click",function(){return f.captureDocument()}),Nn(21,"Capture Document"),zt()(),Kt(22,"div",13),dr(23,"div",14)(24,"canvas",15),zt(),Kt(25,"div",16)(26,"div",17),dr(27,"canvas",18),zt()()()),2&u&&(to(1),Dr("hidden",f.isLoaded),to(11),Dr("checked",!0))},styles:["#videoview[_ngcontent-%COMP%]{position:absolute;width:40vw;height:40vh}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}#normalizedImage[_ngcontent-%COMP%]{width:20vw;top:60%;position:absolute;z-index:2}button[_ngcontent-%COMP%]{margin:4px}"]}),p})();function k4e(p,l){1&p&&(Kt(0,"div",8),dr(1,"div",9),zt())}let M4e=(()=>{class p{constructor(){this.isLoaded=!1,this.overlayManager=new a1}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){try{yield Lu.loadSpec("MRTD_TD1_ID"),yield Lu.loadSpec("MRTD_TD2_FRENCH_ID"),yield Lu.loadSpec("MRTD_TD2_ID"),yield Lu.loadSpec("MRTD_TD2_VISA"),yield Lu.loadSpec("MRTD_TD3_PASSPORT"),yield Lu.loadSpec("MRTD_TD3_VISA"),yield gx.loadRecognitionData("MRZ"),u.cvr=yield pr.createInstance(),u.parser=yield tE.createInstance();let f=yield u.cvr.initSettings("assets/template.json");console.log(f)}catch(f){alert(f)}u.isLoaded=!0})()}ngOnDestroy(){var u;try{null===(u=this.cvr)||void 0===u||u.dispose()}catch(f){}}onChange(u){var f=this;let g=this.parser;const m=u.currentTarget;let v=document.getElementById("detection_result"),_=m.files;if(_){let b=_.item(0);if(b){let S=new FileReader;S.onload=I=>{let k=document.getElementById("image");if(k){k.src=I.target.result;const O=new Image;v.value="",O.onload=j=>{this.overlayManager.updateOverlay(O.width,O.height),this.cvr&&this.cvr.capture(b,"ReadMRZ").then(function(){var W=Fe(function*(J){let K=[];try{let ie=J.items;if(ie.length>0)for(var Q=0;Q<ie.length;++Q){if(ie[Q].type!==io.CRIT_TEXT_LINE)continue;let oe=ie[Q];f.overlayManager.drawOverlay(oe.location,""),K.push(oe.text),v.value=K.join("")+"\n";let he=yield null==g?void 0:g.parse(oe.text);v.value+=JSON.stringify(AK(he))+"\n";break}}catch(ie){alert(ie)}0===K.length&&(v.value="No MRZ detected.")});return function(J){return W.apply(this,arguments)}}())},O.src=I.target.result}},S.readAsDataURL(b)}}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-mrz-reader"]],decls:10,vars:1,consts:[["id","loading-indicator","class","loading-indicator",4,"ngIf"],["type","file","title","file","id","file","accept","image/*",3,"change"],["id","file_container",1,"container"],[1,"row"],["id","imageview",1,"imageview"],["id","image","alt",""],["id","overlay",1,"overlay"],["id","detection_result"],["id","loading-indicator",1,"loading-indicator"],[1,"spinner"]],template:function(u,f){1&u&&(rl(0,k4e,2,0,"div",0),Kt(1,"div")(2,"input",1),oi("change",function(m){return f.onChange(m)}),zt()(),Kt(3,"div",2)(4,"div",3)(5,"div",4),dr(6,"img",5)(7,"canvas",6),zt()()(),Kt(8,"div"),dr(9,"textarea",7),zt()),2&u&&Dr("ngIf",!f.isLoaded)},directives:[AT],styles:[".imageview[_ngcontent-%COMP%]{max-width:720px;max-height:720px;width:720px;height:720px;background-color:#eaeaea;position:relative}.imageview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;width:100%;height:100%;object-fit:contain}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}textarea[_ngcontent-%COMP%]{width:720px;height:200px;margin:10px auto;padding:20px;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.container[_ngcontent-%COMP%]{margin:0 auto;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}"]}),p})();function O4e(p,l){1&p&&(Kt(0,"div",9),dr(1,"div",10),zt())}const F4e=[{path:"",component:E4e},{path:"barcode-reader",component:D4e},{path:"barcode-scanner",component:A4e},{path:"file-detection",component:P4e},{path:"camera-detection",component:R4e},{path:"mrz-reader",component:M4e},{path:"mrz-scanner",component:(()=>{class p{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isDestroyed=!1,this.overlayManager=new a1}ngOnInit(){var u=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){yield Lu.loadSpec("MRTD_TD1_ID"),yield Lu.loadSpec("MRTD_TD2_FRENCH_ID"),yield Lu.loadSpec("MRTD_TD2_ID"),yield Lu.loadSpec("MRTD_TD2_VISA"),yield Lu.loadSpec("MRTD_TD3_PASSPORT"),yield Lu.loadSpec("MRTD_TD3_VISA"),yield gx.loadRecognitionData("MRZ"),u.cvr=yield pr.createInstance(),u.parser=yield tE.createInstance();let f=yield u.cvr.initSettings("assets/template.json");console.log(f),yield u.initBarcodeScanner()})()}ngOnDestroy(){var u,f;this.isDestroyed=!0;try{null===(u=this.cvr)||void 0===u||u.dispose(),null===(f=this.cameraEnhancer)||void 0===f||f.dispose()}catch(g){}}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let u=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(u.width,u.height)}}initBarcodeScanner(){var u=this;return Fe(function*(){var f,g,m,v,_,b,S;const I=yield Yo.createInstance();u.cameraEnhancer=yield Ci.createInstance(I);let k=document.getElementById("videoContainer");if(k){k.append(I.getUIElement()),null===(g=null===(f=I.getUIElement().shadowRoot)||void 0===f?void 0:f.querySelector(".dce-sel-camera"))||void 0===g||g.setAttribute("style","display: none"),null===(v=null===(m=I.getUIElement().shadowRoot)||void 0===m?void 0:m.querySelector(".dce-sel-resolution"))||void 0===v||v.setAttribute("style","display: none");let O=yield u.cameraEnhancer.getAllCameras();if(u.listCameras(O),u.isDestroyed||(null===(_=u.cvr)||void 0===_||_.setInput(u.cameraEnhancer),null===(b=u.cvr)||void 0===b||b.addResultReceiver({onCapturedResultReceived:(j=Fe(function*(W){var J;u.overlayManager.clearOverlay();let K=[],Q=document.getElementById("result");try{let oe,le=W.items;if(le.length>0)for(var ie=0;ie<le.length;++ie){if(le[ie].type!==io.CRIT_TEXT_LINE)continue;let he=le[ie];K.push(he.text),oe=he.location,u.overlayManager.drawOverlay(oe,"");let _e=yield null===(J=u.parser)||void 0===J?void 0:J.parse(he.text);Q&&(Q.innerHTML=JSON.stringify(AK(_e))+"\n");break}}catch(oe){alert(oe)}}),function(J){return j.apply(this,arguments)})}),u.cameraEnhancer.on("played",()=>{u.updateResolution()}),yield u.openCamera(),u.isDestroyed)||(yield null===(S=u.cvr)||void 0===S?void 0:S.startCapturing("ReadMRZ"),u.isDestroyed))throw Error("VideoCapture Component Destroyed");u.isLoaded=!0}var j})()}openCamera(){var u=this;return Fe(function*(){if(u.overlayManager.clearOverlay(),u.videoSelect){let f=u.videoSelect.value;u.cameraEnhancer&&(yield u.cameraEnhancer.selectCamera(f),yield u.cameraEnhancer.open())}})()}listCameras(u){for(var f=0;f<u.length;++f){var g=u[f],m=document.createElement("option");m.value=g.deviceId,m.text=g.label,this.cameraInfo[g.deviceId]=g,this.videoSelect&&this.videoSelect.appendChild(m)}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-mrz-scanner"]],decls:11,vars:1,consts:[["id","loading-indicator","class","loading-indicator",4,"ngIf"],[1,"select"],["for","videoSource"],["id","videoSource",3,"change"],[1,"container"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"],["id","result"],["id","loading-indicator",1,"loading-indicator"],[1,"spinner"]],template:function(u,f){1&u&&(rl(0,O4e,2,0,"div",0),Kt(1,"div",1)(2,"label",2),Nn(3,"Video source: "),zt(),Kt(4,"select",3),oi("change",function(){return f.openCamera()}),zt()(),Kt(5,"div",4)(6,"div",5),dr(7,"div",6)(8,"canvas",7),zt()(),Kt(9,"div"),dr(10,"textarea",8),zt()),2&u&&Dr("ngIf",!f.isLoaded)},directives:[AT],styles:["#videoview[_ngcontent-%COMP%]{max-width:720px;max-height:720px;width:720px;height:720px;background-color:#eaeaea;position:relative}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}textarea[_ngcontent-%COMP%]{width:720px;height:200px;margin:10px auto;padding:20px;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.container[_ngcontent-%COMP%]{margin:0 auto;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.loading-indicator[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#00000080;z-index:1000;display:flex;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:5px solid #fff;border-radius:50%;animation:spin 1s linear infinite;background:linear-gradient(to right,#FF0000 0%,#FF8000 17%,#FFFF00 33%,#00FF00 50%,#00FFFF 67%,#0080FF 83%,#0000FF 100%)}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]}),p})()},{path:"document-viewer",component:(()=>{class p{constructor(){}ngOnInit(){const u=Ip.Elements.getTooltip();u.DisplayMode="Display Mode",u.AnnotationSet="Add Annotation",Ip.Elements.setTooltip(u);let f=Ip.getDefaultUiConfig("editViewer",{includeAnnotationSet:!0});this.editViewer=new Ip.EditViewer({container:"document_container",uiConfig:f})}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-document-viewer"]],decls:1,vars:0,consts:[["id","document_container"]],template:function(u,f){1&u&&dr(0,"div",0)},styles:["#document_container[_ngcontent-%COMP%]{width:100%;height:100%;position:fixed;left:0}"]}),p})()},{path:"acquire-image",component:(()=>{class p{constructor(){this.sourceList=[],this.containerId="dwtcontrolContainer",this.width="600px",this.height="600px"}ngOnDestroy(){Io.DWT.Unload()}ngOnInit(){Io.DWT.Containers=[{ContainerId:this.containerId,Width:this.width,Height:this.height}],Io.DWT.Load(),Io.DWT.RegisterEvent("OnWebTwainReady",()=>{this.onReady()})}onReady(){this.dwtObject=Io.DWT.GetWebTwain(this.containerId),this.dwtObject.IfShowUI=!1,this.dwtObject.GetDevicesAsync(Io.DWT.EnumDWT_DeviceType.TWAINSCANNER|Io.DWT.EnumDWT_DeviceType.TWAINX64SCANNER|Io.DWT.EnumDWT_DeviceType.ESCLSCANNER).then(u=>{this.sourceList=u,this.selectSources=document.getElementById("sources"),this.selectSources.options.length=0;for(let f=0;f<u.length;f++)this.selectSources.options.add(new Option(u[f].displayName,f.toString()))})}acquireImage(){if(this.dwtObject)if(this.dwtObject.SourceCount>0&&this.selectSources&&this.dwtObject.SelectSourceByIndex(this.selectSources.selectedIndex)){let g=this.dwtObject,m="2";for(var u=document.getElementsByName("PixelType"),f=0;f<u.length;f++)if(u[f].checked){m=u[f].value;break}g.SelectDeviceAsync(this.sourceList[this.selectSources.selectedIndex]).then(()=>g.OpenSourceAsync()).then(()=>g.AcquireImageAsync({IfFeederEnabled:document.getElementById("ADF").checked,PixelType:m,Resolution:parseInt(document.getElementById("Resolution").value),IfDisableSourceAfterAcquire:!0})).then(()=>{g&&g.CloseSource()}).catch(v=>{console.error(v)})}else alert("No Source Available!")}openImage(){this.dwtObject||(this.dwtObject=Io.DWT.GetWebTwain("dwtcontrolContainer")),this.dwtObject.Addon.PDF.SetConvertMode(Io.DWT.EnumDWT_ConvertMode.CM_RENDERALL),this.dwtObject.LoadImageEx("",Io.DWT.EnumDWT_ImageType.IT_ALL,()=>{},()=>{})}downloadDocument(){this.dwtObject&&this.dwtObject.HowManyImagesInBuffer>0&&(this.dwtObject.IfShowFileDialog=!0,1==document.getElementById("imgTypejpeg").checked?(1==this.dwtObject.GetImageBitDepth(this.dwtObject.CurrentImageIndexInBuffer)&&this.dwtObject.ConvertToGrayScale(this.dwtObject.CurrentImageIndexInBuffer),this.dwtObject.SaveAsJPEG("DynamicWebTWAIN.jpg",this.dwtObject.CurrentImageIndexInBuffer)):1==document.getElementById("imgTypetiff").checked?this.dwtObject.SaveAllAsMultiPageTIFF("DynamicWebTWAIN.tiff",()=>{},()=>{}):1==document.getElementById("imgTypepdf").checked&&this.dwtObject.SaveAllAsPDF("DynamicWebTWAIN.pdf",()=>{},()=>{}))}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-acquire-image"]],decls:43,vars:0,consts:[[1,"row"],["for","BW"],["type","radio","value","0","name","PixelType"],["for","Gray"],["type","radio","value","1","name","PixelType"],["for","RGB"],["type","radio","value","2","name","PixelType","checked","checked"],["type","checkbox","id","ADF","checked","checked"],["id","Resolution"],["value","100"],["value","150"],["value","200"],["value","300"],["id","sources"],[3,"click"],["id","dwtcontrolContainer"],[2,"font-size","x-large"],["type","radio","value","jpg","name","ImageType","id","imgTypejpeg"],["type","radio","value","tif","name","ImageType","id","imgTypetiff"],["type","radio","value","pdf","name","ImageType","id","imgTypepdf","checked","checked"]],template:function(u,f){1&u&&(Kt(0,"div",0)(1,"label",1),dr(2,"input",2),Nn(3,"B&W "),zt(),Kt(4,"label",3),dr(5,"input",4),Nn(6,"Gray"),zt(),Kt(7,"label",5),dr(8,"input",6),Nn(9,"Color"),zt(),Kt(10,"label"),dr(11,"input",7),Nn(12,"Auto Feeder"),zt(),Kt(13,"div"),Nn(14,"\xa0\xa0"),zt(),Kt(15,"select",8)(16,"option",9),Nn(17,"100"),zt(),Kt(18,"option",10),Nn(19,"150"),zt(),Kt(20,"option",11),Nn(21,"200"),zt(),Kt(22,"option",12),Nn(23,"300"),zt()()(),dr(24,"select",13)(25,"br"),Kt(26,"button",14),oi("click",function(){return f.acquireImage()}),Nn(27,"Scan Documents"),zt(),Kt(28,"button",14),oi("click",function(){return f.openImage()}),Nn(29,"Load Documents"),zt(),dr(30,"div",15),Kt(31,"div",0)(32,"label",16),dr(33,"input",17),Nn(34,"JPEG"),zt(),Kt(35,"label",16),dr(36,"input",18),Nn(37,"TIFF"),zt(),Kt(38,"label",16),dr(39,"input",19),Nn(40,"PDF"),zt()(),Kt(41,"button",14),oi("click",function(){return f.downloadDocument()}),Nn(42,"Download Documents"),zt())},directives:[C4,x4],styles:[".row[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:left}select[_ngcontent-%COMP%]{border-radius:10px;height:30px}"]}),p})()},{path:"image-editor",component:(()=>{class p{constructor(){this.containerId="dwtcontrolContainer",this.width="600px",this.height="800px",this.isHidden=!1,this.sourceList=[]}ngOnDestroy(){Io.DWT.Unload()}ngOnInit(){Io.DWT.Containers=[{ContainerId:this.containerId,Width:this.width,Height:this.height}],Io.DWT.Load(),Io.DWT.RegisterEvent("OnWebTwainReady",()=>{this.onReady()})}onReady(){this.dwtObject=Io.DWT.GetWebTwain(this.containerId),this.dwtObject.IfShowUI=!1,this.createImageEditor(),this.dwtObject.GetDevicesAsync(Io.DWT.EnumDWT_DeviceType.TWAINSCANNER|Io.DWT.EnumDWT_DeviceType.TWAINX64SCANNER|Io.DWT.EnumDWT_DeviceType.ESCLSCANNER).then(u=>{this.sourceList=u,this.selectSources=document.getElementById("sources"),this.selectSources.options.length=0;for(let f=0;f<u.length;f++)this.selectSources.options.add(new Option(u[f].displayName,f.toString()))}),this.dwtObject.Viewer.autoChangeIndex=!0,this.dwtObject.RegisterEvent("OnBufferChanged",u=>{this.onBufferChanged(u.currentId)})}acquireImage(){if(this.dwtObject)if(this.dwtObject.SourceCount>0&&this.selectSources&&this.dwtObject.SelectSourceByIndex(this.selectSources.selectedIndex)){let u=this.dwtObject;u.SelectDeviceAsync(this.sourceList[this.selectSources.selectedIndex]).then(()=>u.OpenSourceAsync()).then(()=>u.AcquireImageAsync({})).then(()=>{u&&u.CloseSource()}).catch(f=>{console.error(f)})}else alert("No Source Available!")}createImageEditor(){this.dwtObject&&(this.imageEditor=this.dwtObject.Viewer.createImageEditor({element:document.getElementById("dwtcontrolContainerLargeViewer"),width:750,height:800,buttons:{visibility:{close:!1}}}),this.imageEditor.show())}openImage(){this.dwtObject||(this.dwtObject=Io.DWT.GetWebTwain("dwtcontrolContainer")),this.dwtObject.Addon.PDF.SetConvertMode(Io.DWT.EnumDWT_ConvertMode.CM_RENDERALL),this.dwtObject.LoadImageEx("",Io.DWT.EnumDWT_ImageType.IT_ALL,()=>{this.updatePageInfo()},()=>{})}rotateLeft(){this.dwtObject&&this.dwtObject.HowManyImagesInBuffer>0&&this.dwtObject.RotateLeft(this.dwtObject.CurrentImageIndexInBuffer)}rotateRight(){this.dwtObject&&this.dwtObject.HowManyImagesInBuffer>0&&this.dwtObject.RotateRight(this.dwtObject.CurrentImageIndexInBuffer)}mirror(){this.dwtObject&&this.dwtObject.HowManyImagesInBuffer>0&&this.dwtObject.Mirror(this.dwtObject.CurrentImageIndexInBuffer)}flip(){this.dwtObject&&this.dwtObject.HowManyImagesInBuffer>0&&this.dwtObject.Flip(this.dwtObject.CurrentImageIndexInBuffer)}showImageEditor(){if(this.dwtObject)if(0==this.dwtObject.HowManyImagesInBuffer)alert("There is no image in buffer.");else{let u=document.getElementById("imageEditor");if(!u)return;this.isHidden?(u.textContent="Hide Editor",this.imageEditor.show(),this.isHidden=!1):(u.textContent="Show Editor",this.isHidden=!0,this.imageEditor.hide())}}firstImage(){this.dwtObject&&(this.dwtObject.Viewer.first(),this.updatePageInfo())}updatePageInfo(){this.dwtObject&&document.getElementById("DW_TotalImage")&&document.getElementById("DW_CurrentImage")&&(document.getElementById("DW_TotalImage").value=this.dwtObject.HowManyImagesInBuffer.toString(),document.getElementById("DW_CurrentImage").value=(this.dwtObject.CurrentImageIndexInBuffer+1).toString())}onBufferChanged(u){this.dwtObject&&(this.dwtObject.CurrentImageIndexInBuffer=u,this.updatePageInfo())}preImage(){this.dwtObject&&(this.dwtObject.Viewer.previous(),this.updatePageInfo())}nextImage(){this.dwtObject&&(this.dwtObject.Viewer.next(),this.updatePageInfo())}lastImage(){this.dwtObject&&(this.dwtObject.Viewer.last(),this.updatePageInfo())}setMode(){if(this.dwtObject){let f=document.getElementById("DW_PreviewMode").selectedIndex;var u=f+1;this.dwtObject.Viewer.setViewMode(u,u),this.dwtObject.Viewer.cursor=0!=f?"pointer":"crosshair"}}removeSelected(){this.dwtObject&&(this.dwtObject.RemoveAllSelectedImages(),0==this.dwtObject.HowManyImagesInBuffer?(document.getElementById("DW_CurrentImage").value="0",document.getElementById("DW_TotalImage").value="0"):this.updatePageInfo())}removeAll(){this.dwtObject&&(this.dwtObject.RemoveAllImages(),document.getElementById("DW_TotalImage").value="0",document.getElementById("DW_CurrentImage").value="0")}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-image-editor"]],decls:45,vars:0,consts:[["id","sources"],[1,"row"],[3,"click"],["id","dwtcontrolContainer"],["id","dwtcontrolContainerLargeViewer"],[2,"width","800px"],["type","button","value"," |< ",2,"font-size","x-large",3,"click"],["type","button","value"," < ",2,"font-size","x-large",3,"click"],["type","text","size","2","id","DW_CurrentImage","readonly","readonly","value","0",2,"font-size","x-large"],["type","text","size","2","id","DW_TotalImage","readonly","readonly","value","0",2,"font-size","x-large"],["type","button","value"," > ",2,"font-size","x-large",3,"click"],["type","button","value"," >| ",2,"font-size","x-large",3,"click"],["size","1","id","DW_PreviewMode",2,"font-size","x-large",3,"change"],["value","0"],["value","1"],["value","2"],["value","3"],["value","4"],["id","imageEditor",3,"click"]],template:function(u,f){1&u&&(dr(0,"select",0)(1,"br"),Kt(2,"div",1)(3,"button",2),oi("click",function(){return f.acquireImage()}),Nn(4,"Scan"),zt(),Kt(5,"button",2),oi("click",function(){return f.openImage()}),Nn(6,"Load"),zt()(),Kt(7,"div",1),dr(8,"div",3)(9,"div",4),zt(),Kt(10,"div",5)(11,"input",6),oi("click",function(){return f.firstImage()}),zt(),Kt(12,"input",7),oi("click",function(){return f.preImage()}),zt(),dr(13,"input",8),Nn(14," / "),dr(15,"input",9),Kt(16,"input",10),oi("click",function(){return f.nextImage()}),zt(),Kt(17,"input",11),oi("click",function(){return f.lastImage()}),zt(),Nn(18," Preview Mode: "),Kt(19,"select",12),oi("change",function(){return f.setMode()}),Kt(20,"option",13),Nn(21,"1X1"),zt(),Kt(22,"option",14),Nn(23,"2X2"),zt(),Kt(24,"option",15),Nn(25,"3X3"),zt(),Kt(26,"option",16),Nn(27,"4X4"),zt(),Kt(28,"option",17),Nn(29,"5X5"),zt()()(),Kt(30,"div",1)(31,"button",2),oi("click",function(){return f.removeSelected()}),Nn(32,"Remove Selected"),zt(),Kt(33,"button",2),oi("click",function(){return f.removeAll()}),Nn(34,"Remove All"),zt(),Kt(35,"button",2),oi("click",function(){return f.rotateLeft()}),Nn(36,"Rotate Left"),zt(),Kt(37,"button",2),oi("click",function(){return f.rotateRight()}),Nn(38,"Rotate Right"),zt(),Kt(39,"button",2),oi("click",function(){return f.mirror()}),Nn(40,"Mirror"),zt(),Kt(41,"button",2),oi("click",function(){return f.flip()}),Nn(42,"Flip"),zt(),Kt(43,"button",18),oi("click",function(){return f.showImageEditor()}),Nn(44,"Hide Editor"),zt()())},directives:[C4,x4],styles:[".row[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:left}select[_ngcontent-%COMP%]{border-radius:10px;height:30px}"]}),p})()}];let L4e=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=gh({type:p}),p.\u0275inj=_d({imports:[[J$.forRoot(F4e)],J$]}),p})();const N4e=function(){return["/"]};let B4e=(()=>{class p{constructor(){}ngOnInit(){}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-top-bar"]],decls:3,vars:2,consts:[[3,"routerLink"]],template:function(u,f){1&u&&(Kt(0,"a",0)(1,"h1"),Nn(2,"Dynamsoft Capture Vision SDK"),zt()()),2&u&&Dr("routerLink",Ad(1,N4e))},directives:[Mb],styles:[""]}),p})(),W4e=(()=>{class p{constructor(){this.title="angular-barcode-mrz-document-scanner"}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Sl({type:p,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container"]],template:function(u,f){1&u&&(dr(0,"app-top-bar"),Kt(1,"div",0),dr(2,"router-outlet"),zt())},directives:[B4e,B4],styles:[""]}),p})(),U4e=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=gh({type:p,bootstrap:[W4e]}),p.\u0275inj=_d({providers:[],imports:[[_we,L4e,OSe]]}),p})();(function tbe(){qz=!1})(),vwe().bootstrapModule(U4e).catch(p=>console.error(p))}},fi=>{fi(fi.s=582)}]);